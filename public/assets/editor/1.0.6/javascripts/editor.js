(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ImportsCollection = require('./models/imports_collection');
var GeocodingsCollection = require('./models/geocodings_collection');
var AnalysisCollection = require('./models/analysis_collection');
var pollingsTimer = 3000;

/**
 *  Background polling default model
 *
 */

module.exports = cdb.core.Model.extend({

  defaults: {
    showGeocodingDatasetURLButton: false,
    showSuccessDetailsButton: true,
    geocodingsPolling: false, // enable geocodings polling
    importsPolling: false // enable imports polling
  },

  initialize: function(attrs, opts) {
    this.user = opts.user;
    this.vis = opts.vis;
    this.importsCollection = opts.importsCollection || new ImportsCollection(null, { user: this.user });
    this.geocodingsCollection = opts.geocodingsCollection || new GeocodingsCollection(null, { user: this.user, vis: this.vis });
    this.analysisCollection = opts.anaylysisCollection || new AnalysisCollection(null, { user: this.user });
    this._initBinds();
    this.startPollings();
  },

  _initBinds: function() {
    this.importsCollection.bind('change:state', function(mdl) {
      this.trigger('change', mdl, this);
      this._onImportsStateChange(mdl)
    }, this);
    this.importsCollection.bind('remove', function(mdl) {
      this.trigger('importRemoved', mdl, this);
    }, this);
    this.importsCollection.bind('add', function(mdl) {
      this.trigger('importAdded', mdl, this);
    }, this);

    this.geocodingsCollection.bind('change:state', function(mdl) {
      this.trigger('change', mdl, this);
      this._onGeocodingsStateChange(mdl);
    }, this);
    this.geocodingsCollection.bind('remove', function(mdl) {
      this.trigger('geocodingRemoved', mdl, this);
    }, this);
    this.geocodingsCollection.bind('add', function(mdl) {
      this.trigger('geocodingAdded', mdl, this);
    }, this);

    this.analysisCollection.bind('reset', function() {
      if (this.analysisCollection.size() > 0) {
        this.trigger('analysisAdded', this.analysisCollection, this);
      } else {
        this.trigger('analysisRemoved', this.analysisCollection, this);  
      }
    }, this); 

    this.analysisCollection.bind('change:state', function(mdl) {
      this._onAnalysisStateChange(mdl, this.analysisCollection);
    }, this);
  },

  // Helper functions

  getTotalFailedItems: function() {
    return this.importsCollection.failedItems().length + this.geocodingsCollection.failedItems().length;
  },

  removeImportItem: function(mdl) {
    if (!mdl) {
      return false;
    }
    this.importsCollection.remove(mdl);
  },

  addImportItem: function(mdl) {
    if (!mdl) {
      return false;
    }
    this.importsCollection.add(mdl);
  },

  removeGeocodingItem: function(mdl) {
    if (!mdl || !this.canAddImport()) {
      return false;
    }
    this.geocodingsCollection.remove(mdl);
  },

  addGeocodingItem: function(mdl) {
    if (!mdl || !this.canAddGeocoding()) {
      return false;
    }
    this.geocodingsCollection.add(mdl);
  },

  removeAnalysis: function() {
    this.analysisCollection.destroyCheck();
    this.analysisCollection.reset();
  },

  addAnalysis: function(array) {
    if (!array || !this.canAddAnalysis()) {
      return false;
    }
    this.analysisCollection.reset(array);
  },

  canAddImport: function() {
    return this.importsCollection.canImport();
  },

  canAddGeocoding: function() {
    return this.geocodingsCollection.canGeocode();
  },

  canAddAnalysis: function() {
    return this.analysisCollection.canStartPecan();
  },

  getTotalImports: function() {
    return this.importsCollection.size();
  },

  getTotalGeocodings: function() {
    return this.geocodingsCollection.size();
  },

  getTotalAnalysis: function() {
    return this.analysisCollection.size() > 0 ? 1 : 0;
  },

  getTotalPollings: function() {
    return this.importsCollection.size() + this.geocodingsCollection.size() + ( this.analysisCollection.isAnalyzing() ? 1 : 0 );
  },

  stopPollings: function() {
    if (this.get('geocodingsPolling')) {
      this.geocodingsCollection.destroyCheck();
    }
    if (this.get('importsPolling')) {
      this.importsCollection.destroyCheck();
    }
  },

  startPollings: function() {
    var self = this;
    // Don't start pollings inmediately, 
    // wait some seconds
    setTimeout(function() {
      if (self.get('geocodingsPolling')) {
        self.geocodingsCollection.pollCheck();
      }
      if (self.get('importsPolling')) {
        self.importsCollection.pollCheck();
      }  
    }, pollingsTimer);
  },

  // onChange functions
  _onImportsStateChange: function() {},

  _onGeocodingsStateChange: function() {},

  _onAnalysisStateChange: function() {},

  clean: function() {
    this.importsCollection.unbind(null, null, this);
    this.geocodingsCollection.unbind(null, null, this);
    this.analysisCollection.unbind(null, null, this);
    this.elder('clean');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./models/analysis_collection":3,"./models/geocodings_collection":6,"./models/imports_collection":9}],2:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ImportItemView = require('./views/imports/background_import_item_view');
var AnalysisItemView = require('./views/analysis/background_analysis_item_view');
var GeocodingItemView = require('./views/geocodings/background_geocoding_item_view');
var ImportLimitItemView = require('./views/imports/background_import_limit_view');
var ImportsModel = require('./models/imports_model');
var GeocodingModel = require('./models/geocoding_model');
var BackgroundPollingModel = require('./background_polling_model');
var BackgroundPollingHeaderView = require('./views/background_polling_header_view');

/**
 *  Background polling view
 *
 *  It will pool all polling operations that happens
 *  in Cartodb, as in imports and geocodings
 *
 */

module.exports = cdb.core.View.extend({

  className: 'BackgroundPolling',

  initialize: function() {
    this.user = this.options.user;
    this.createVis = this.options.createVis;
    this.vis = this.options.vis;
    if (!this.model) {
      this.model = new BackgroundPollingModel({}, {
        user: this.user
      });
    }
    this.template = cdb.templates.getTemplate('common/background_polling/background_polling');
    this._initBinds();
  },

  render: function() {
    this.$el.html(this.template());
    this._initViews();
    return this;
  },

  _initBinds: function() {
    this.model.bind('importAdded', this._addImport, this);
    this.model.bind('geocodingAdded', this._addGeocoding, this);
    this.model.bind('analysisAdded', this._addAnalysis, this);
    this.model.bind('analysisAdded analysisRemoved importAdded importRemoved geocodingAdded geocodingRemoved', this._checkPollingsSize, this);
    cdb.god.bind('importByUploadData', this._addDataset, this);
    cdb.god.bind('fileDropped', this._onDroppedFile, this);
    this.add_related_model(cdb.god);
  },

  _initViews: function() {
    var backgroundPollingHeaderView = new BackgroundPollingHeaderView({
      model: this.model
    });

    this.$el.prepend(backgroundPollingHeaderView.render().el);
    this.addView(backgroundPollingHeaderView);
  },

  _checkPollingsSize: function() {
    if (this.model.getTotalPollings() > 0) {
      this.show();
    } else {
      this.hide();
    }
  },

  _addAnalysis: function(collection) {

    if (this._analysisItem) {
      this._analysisItem.clean();
    }

    this._analysisItem = new AnalysisItemView({
      collection: collection,
      vis: this.vis,
      user: this.user
    });

    this._analysisItem.bind('remove', function(mdl) {
      this.model.removeAnalysis();
    }, this);

    this.$('.js-list').prepend(this._analysisItem.render().el);
    this.addView(this._analysisItem);
  },

  _addGeocoding: function(mdl) {
    var geocodingItem = new GeocodingItemView({
      showGeocodingDatasetURLButton: this.model.get('showGeocodingDatasetURLButton'),
      model: mdl,
      user: this.user
    });

    geocodingItem.bind('remove', function(mdl) {
      this.model.removeGeocodingItem(mdl);
    }, this);

    this.$('.js-list').prepend(geocodingItem.render().el);
    this.addView(geocodingItem);

    // Enable pollings again
    this.enable();
  },

  _addImport: function(m) {
    var importItem = new ImportItemView({
      showSuccessDetailsButton: this.model.get('showSuccessDetailsButton'),
      model: m,
      user: this.user
    });

    importItem.bind('remove', function(mdl) {
      this.model.removeImportItem(mdl);
    }, this);

    this.$('.js-list').prepend(importItem.render().el);
    this.addView(importItem);

    this.enable();
  },

  _addDataset: function(d) {
    if (d) {
      this._addImportsItem(d);
    }
  },

  _onDroppedFile: function(files) {
    if (files) {
      this._addImportsItem({
        type: 'file',
        value: files,
        create_vis: this.createVis
      });
    }
  },

  _addImportsItem: function(uploadData) {
    if (this.model.canAddImport()) {
      this._removeLimitItem();
    } else {
      this._addLimitItem();
      return false;
    }

    var imp = new ImportsModel({}, {
      upload: uploadData,
      user: this.user
    });
    this.model.addImportItem(imp);
  },

  // Limits view

  _addLimitItem: function() {
    if (!this._importLimit) {
      var v = new ImportLimitItemView({
        user: this.user
      });
      this.$('.js-list').prepend(v.render().el);
      this.addView(v);
      this._importLimit = v;
    }
  },

  _removeLimitItem: function() {
    var v = this._importLimit;
    if (v) {
      v.clean();
      this.removeView(v);
      delete this._importLimit;
    }
  },

  // Enable background polling checking
  // ongoing imports
  enable: function() {
    this.model.startPollings();
  },

  // Disable/stop background pollings
  disable: function() {
    this.model.stopPollings();
  },

  show: function() {
    this.$el.addClass('is-visible');
  },

  hide: function() {
    this.$el.removeClass('is-visible');
  },

  clean: function() {
    this.disable();
    this.elder('clean');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./background_polling_model":1,"./models/geocoding_model":4,"./models/imports_model":10,"./views/analysis/background_analysis_item_view":16,"./views/background_polling_header_view":18,"./views/geocodings/background_geocoding_item_view":19,"./views/imports/background_import_item_view":21,"./views/imports/background_import_limit_view":22}],3:[function(require,module,exports){
(function (global){
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var Pecan = require('cartodb-pecan');
var PecanModel = require('./pecan_model');
var batchAnalysisCount = 5;

/**
 *  Analysis collection
 *
 *  - Get the stats of the current layer
 *
 */

module.exports = Backbone.Collection.extend({

  model: PecanModel,

  initialize: function(mdls, opts) {
    this.user = opts.user;
    this._initBinds();
  },

  _initBinds: function() {
    this.bind('reset', this.pollCheck, this);
  },

  // Public methods

  canStartPecan: function() {
    return this.getTotalAnalysis() === this.getCompletedAnalysis()
  },

  pollCheck: function() {
    if (this._nextAnalysisItems) {
      _.each(this._nextAnalysisItems, function(mdl) {
        mdl.unbind(null, null, this);
      }, this);
    }

    var idleItems = _.first(this.where({ state: 'idle' }),batchAnalysisCount);

    if (idleItems.length > 0) {
      this._nextAnalysisItems = idleItems;

      _.each(this._nextAnalysisItems, function(mdl) {
        if (this.user.featureEnabled('pecan_debugging')) {
          mdl.bind('print_stats', function(stats) {
            this._printStats(stats);
          }, this);
        }
        mdl.bind('change:state', function(mdl, state) {
          if (mdl.isAnalyzed()) {
            var arePendingAnalysis = _.find(this._nextAnalysisItems, function(analysis) {
              return !analysis.isAnalyzed()
            });
            if (!arePendingAnalysis) {
              this.pollCheck();
            }
          }
        }, this);
        mdl.getData();
      }, this);
    }
  },

  _printStats: function(stats) {
    var name        = stats.column;
    var type        = stats.type;
    var weight      = stats.weight;
    var skew        = stats.skew;
    var distinct    = stats.distinct;
    var count       = stats.count;
    var null_ratio  = stats.null_ratio;
    var dist_type   = stats.dist_type;
    var calc_weight = (weight + Pecan.getWeightFromShape(dist_type)) / 2;

    var distinctPercentage = (distinct / count) * 100;

    cdb.log.info("%cAnalyzing %c" + name, "text-decoration:underline; font-weight:bold", "text-decoration:underline; font-weight:normal");

    cdb.log.info('%c · %ctype%c = ' + type, 'color:#666;', 'color: #666; font-weight:bold;', "color: #666; font-weight:normal");
    cdb.log.info('%c · %cdistinctPercentage%c = ' + distinctPercentage, 'color:#666;', 'color: #666; font-weight:bold;', "color: #666; font-weight:normal");
    cdb.log.info('%c · %ccount%c = ' + count, 'color:#666;', 'color: #666; font-weight:bold;', 'color: #666; font-weight:normal;');
    cdb.log.info('%c · %cnull ratio%c = ' + null_ratio, 'color:#666;', 'color: #666; font-weight:bold;', 'color: #666; font-weight:normal;');

    if (dist_type) {
      cdb.log.info('%c · %cdist_type%c = ' + dist_type, 'color:#666;', 'color: #666; font-weight:bold;', 'color: #666; font-weight:normal;');
      cdb.log.info('%c · %ccalc_weight%c = ' + calc_weight, 'color:#666;', 'color: #666; font-weight:bold;', 'color: #666; font-weight:normal;');
    }

    if (skew) {
      cdb.log.info("%c · %cskew%c: " + skew.toFixed(2), "color:#666;", 'color: #666; font-weight:bold;', 'color: #666; font-weight:normal;');
    }

    if (weight) {
      cdb.log.info("%c · %cweight%c: " + weight.toFixed(2), "color: #666;", "color:#666; font-weight:bold;", "color:#666;font-weight:normal");
    }

    if (stats.density) {
      cdb.log.info("%c · %cdensity%c: " + stats.density, "color:#666;", 'color: #666; font-weight:bold;', 'color: #666; font-weight:normal;');
    }

  },

  destroyCheck: function() {
    var items = this.where({ state: 'idle' });
    this.remove(items);
  },

  failedItems: function() {},

  getTotalAnalysis: function() {
    return this.size();
  },

  getSuccessfullyAnalysedColumns: function() {
    return this.where({ success: true }).length;
  },

  getCompletedAnalysis: function() {
    return this.where({ state: 'analyzed' }).length;
  },

  isAnalyzing: function() {
    return this.getCompletedAnalysis() !== this.getTotalAnalysis();
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./pecan_model":12,"cartodb-pecan":233}],4:[function(require,module,exports){
(function (global){
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var GeocodingModelPoller = require('./geocoding_model_poller');

/**
 *  Geocoding model
 *
 */
module.exports = cdb.core.Model.extend({

  options: {
    startPollingAutomatically: true
  },

  defaults: {
    kind: '',
    formatter: '',
    table_name: '',
    state: ''
  },

  url: function(method) {
    var version = cdb.config.urlVersion('geocoding', method);

    var base = '/api/' + version + '/geocodings/';
    if (this.isNew()) {
      return base;
    }
    return base + this.id;
  },

  setUrlRoot: function(urlRoot) {
    this.urlRoot = urlRoot;
  },

  initialize: function(opts) {
    var self = this;
    this._initBinds();
    _.extend(this.options, opts);
    this.poller = new GeocodingModelPoller(this);
    if (this.options.startPollingAutomatically) {
      this._checkModel();
    };
  },

  _initBinds: function() {
    this.bind('change:id', this._checkModel, this);
  },

  _checkModel: function() {
    var self = this;

    if (this.get('id')) {
      this.pollCheck();
    } else {
      this._saveModel();
    }
  },

  _saveModel: function() {
    var self = this;
    if (this.isNew()) {
      this.save({}, {
        error: function() {
          self.set({
            state: 'failed',
            error: {
              title: 'Oops, there was a problem',
              description: 'Unfortunately there was an error starting the geocoder'
            }
          });
        }
      });
    }
  },

  pollCheck: function() {
    this.poller.start();
  },

  destroyCheck: function() {
    this.poller.stop();
  },

  getError: function() {
    return this.get('error');
  },

  hasFailed: function() {
    var state = this.get('state');
    return state === "failed" || state === "reset" || state === "cancelled"
  },

  hasCompleted: function() {
    return this.get('state') === "finished"
  },

  isOngoing: function() {
    return !this.hasCompleted() && !this.hasFailed()
  },

  cancelGeocoding: function() {
    this.save({ state: 'cancelled' }, { wait:true });
  },

  resetGeocoding: function() {
    this.set('state', 'reset');
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./geocoding_model_poller":5}],5:[function(require,module,exports){
var Poller = require('./poller');

var GeocodingModelPoller = function(model) {

  var POLLING_INTERVAL = 2000;

  var options = {
    interval: POLLING_INTERVAL,
    stopWhen: function(model) {
      return model.hasFailed() || model.hasCompleted();
    },
    error: function(model) {
      model.trigger("change");
    }
  };

  Poller.call(this, model, options);
};

GeocodingModelPoller.prototype = _.extend({}, Poller.prototype);

module.exports = GeocodingModelPoller;

},{"./poller":13}],6:[function(require,module,exports){
(function (global){
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var pollTimer = 60000;
var GeocodingModel = require('./geocoding_model');

/**
 *  Geocodings collection
 *
 *  - Check ongoing geocodings in order to add them
 *  to the collection.
 *
 */

module.exports = Backbone.Collection.extend({

  model: GeocodingModel,

  url: function(method) {
    var version = cdb.config.urlVersion('geocoding', method);
    return '/api/' + version + '/geocodings';
  },

  initialize: function(mdls, opts) {
    this.user = opts.user; 
    this.vis = opts.vis;
  },

  parse: function(r) {
    var self = this;

    _.each(r.geocodings, function(data) {

      // Check if that geocoding exists...
      var geocodings = self.filter(
        function(mdl) {
          return mdl.get('id') === data.id
        }
      );

      if (geocodings.length === 0) {
        self._checkOngoingGeocoding(
          new GeocodingModel(data, { startPollingAutomatically: false })
        )
      }
    });

    return this.models
  },

  _checkOngoingGeocoding: function(mdl) {
    if (!this.vis) {
      // If there is NOT a vis, let's start polling
      // this geocoding model
      this.add(mdl);
      mdl.pollCheck();
    } else {
      var self = this;
      // If there is a vis, let's check if that
      // geocoding belongs to the visualization
      this.vis.map.layers.each(function(lyr) {
        if (lyr.table && lyr.table.id === mdl.get('table_name')) {
          self.add(mdl);
          mdl.pollCheck();
        }
      })
    }
  },

  // Public methods

  canGeocode: function() {
    return !this.any(function(m) {
      return m.isOngoing();
    });
  },

  fetchGeocodings: function() {
    var self = this;
    this.fetch({
      error: function(e) {
        self.destroyCheck();
      }
    });
  },

  pollCheck: function(i) {
    if (this.pollTimer) return;

    var self = this;
    this.pollTimer = setInterval(function() {
      self.fetchGeocodings();
    }, pollTimer);

    this.fetchGeocodings();
  },

  destroyCheck: function() {
    clearInterval(this.pollTimer);
    delete this.pollTimer;
  },

  failedItems: function() {
    return this.filter(function(item) {
      return item.hasFailed();
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./geocoding_model":4}],7:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var cdbAdmin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var ImportModelPoller = require('./import_model_poller');

/**
 *  New import model that controls
 *  the state of an import
 *
 */
module.exports = cdb.core.Model.extend({

  url: function(method) {
    var version = cdb.config.urlVersion('import', method);
    var base = '/api/' + version + '/imports';

    if (this.isNew()) {
      return base;
    }
    return base + '/' + this.id;
  },

  idAttribute: 'item_queue_id',

  initialize: function() {
    this._initBinds();
    this.poller = new ImportModelPoller(this);
  },

  _initBinds: function() {
    this.bind('change:item_queue_id', this._checkQueueId, this);
  },

  createImport: function(data) {
    var d = this._prepareData(data);
    this[d.interval === 0 ? '_createRegularImport' : '_createSyncImport'](d);
  },

  _checkQueueId: function() {
    if (this.get('item_queue_id')) {
      this.pollCheck();
    }
  },

  _prepareData: function(data) {
    var d = {
      create_vis: data.create_vis,
      privacy: data.privacy
    };

    var type = data.type;

    if (type !== 'remote') {
      _.extend(d, {
        type_guessing: data.type_guessing,
        content_guessing: data.content_guessing,
        interval: data.interval
      });
    }

    var service = data.service_name;

    // Url?
    if (type === "url") {
      _.extend(d, {
        url: data.value
      });
    }

    // Remote?
    if (type === "remote") {
      _.extend(d, {
        type: "remote",
        interval: null,
        remote_visualization_id: data.remote_visualization_id,
        create_vis: false,
        value: data.value
      });
    }

    // SQL?
    if (type === "sql") {
      _.extend(d, {
        table_name: data.table_name,
        sql: data.value
      });
    }

    // Duplicate?
    if (type === "duplication") {
      _.extend(d, {
        table_name: data.table_name,
        table_copy: data.value
      });
    }

    // Service?
    if (type === "service") {
      // If service is Twitter, service_item_id should be
      // sent stringified
      var service_item_id = (service === "twitter_search")
          ? JSON.stringify(data.service_item_id)
          : data.service_item_id;

      // User defined limits?
      if (data.user_defined_limits) {
        d.user_defined_limits = data.user_defined_limits;
      }

      _.extend(d, {
        value:            data.value,
        service_name:     data.service_name,
        service_item_id:  service_item_id
      });
    }

    return d;
  },

  _createSyncImport: function(d) {
    var self = this;
    // Create synchronization model
    var sync = new cdbAdmin.TableSynchronization(d);

    sync.save(null, {
      success: function(m) {
        self.set('item_queue_id', m.get('data_import').item_queue_id);
      },
      error: function(mdl, r, opts) {
        self._setErrorState(r);
      }
    });
  },

  _createRegularImport: function(d) {
    var self = this;

    this.save(d, {
      error: function(mdl, r, opts) {
        self._setErrorState(r);
      }
    });
  },

  _setErrorState: function(r) {
    var msg;
    try {
      msg = r && JSON.parse(r.responseText).errors.imports;
    } catch(err) {
      // e.g. if responseText is empty (seems to happen when server is down/offline)
      msg = 'Unfortunately there was an error starting the import';
    }
    this.set({
      state: 'failure',
      get_error_text: {
        title: 'There was an error',
        what_about: msg
      }
    });
  },

  pollCheck: function() {
    this.poller.start();
  },

  destroyCheck: function() {
    this.poller.stop();
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./import_model_poller":8}],8:[function(require,module,exports){
var Poller = require('./poller');

var ImportModelPoller = function(model) {

  var POLLING_INTERVAL = 2000; // Interval time between poll checkings
  var POLLING_INTERVAL_MULTIPLIER = 2.5;  // Multiply interval by this number
  var POLLING_REQUESTS_BEFORE_INTERVAL_CHANGE = 30; // Max tries until interval change

  var options = {
    interval: function(numberOfRequests) {
      if (numberOfRequests >= POLLING_REQUESTS_BEFORE_INTERVAL_CHANGE) {
        return POLLING_INTERVAL * POLLING_INTERVAL_MULTIPLIER;
      }
      return POLLING_INTERVAL;
    },
    stopWhen: function(model) {
      var state = model.get('state');
      return (state === "complete" || state === "failure");
    }
  };

  Poller.call(this, model, options);
};

ImportModelPoller.prototype = _.extend({}, Poller.prototype);

module.exports = ImportModelPoller;

},{"./poller":13}],9:[function(require,module,exports){
(function (global){
/* global cdb */
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var pollTimer = 30000;
var ImportsModel = require('./imports_model');

/**
 *  Imports collection
 *
 *  If it is fetched, it will add the import
 *
 */

module.exports = Backbone.Collection.extend({

  model: ImportsModel,

  url: function (method) {
    var version = cdb.config.urlVersion('import', method);
    return '/api/' + version + '/imports';
  },

  initialize: function (mdls, opts) {
    this.user = opts.user;
  },

  parse: function (r) {
    var self = this;

    if (r.imports.length === 0) {
      this.destroyCheck();
    } else {
      _.each(r.imports, function (id) {

        // Check if that import exists...
        var imports = self.filter(function (mdl){ return mdl.imp.get('item_queue_id') === id });

        if (imports.length === 0) {
          self.add(new ImportsModel({ id: id }, { user: self.user } ));
        }
      });
    }

    return this.models
  },

  canImport: function () {
    var importQuota = this.user.getMaxConcurrentImports();
    var total = this.size();
    var finished = 0;

    this.each(function (m) {
      if (m.hasFailed() || m.hasCompleted()) {
        ++finished;
      }
    });

    return (total - finished) < importQuota;
  },

  pollCheck: function (i) {
    if (this.pollTimer) return;

    var self = this;
    this.pollTimer = setInterval(function () {
      self.fetch();
    }, pollTimer || 2000);

    // Start doing a fetch
    this.fetch();
  },

  destroyCheck: function () {
    clearInterval(this.pollTimer);
    delete this.pollTimer;
  },

  completedItems: function () {
    return this.filter(function (item) {
      return item.hasCompleted();
    });
  },

  getCompletedItemsCount: function () {
    return this.completedItems().length;
  },

  failedItems: function () {
    return this.filter(function (item) {
      return item.hasFailed();
    });
  },

  getFailedItemsCount: function () {
    return this.failedItems().length;
  },

  allImportsCompletedOrFailed: function () {
    return this.all(function (item) {
      return item.hasCompleted() ||
        item.hasFailed();
    });
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./imports_model":10}],10:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var ImportModel = require('./import_model');
var UploadModel = require('./upload_model');

/**
 *  Upload/import model
 *
 *  It takes the control of the upload and import,
 *  listening the change of any of these steps.
 *
 *  Steps:
 *  - upload
 *  - import
 *
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    step: 'upload',
    state: ''
  },

  initialize: function (attrs, opts) {
    if (_.isEmpty(opts)) opts = {};
    this.user = opts && opts.user;
    this.upl = new UploadModel(opts.upload, { user: this.user });
    this.imp = new ImportModel(opts.import);
    this._initBinds();
    this._checkStatus();
  },

  _initBinds: function () {
    this.bind('change:import',  this._onImportChange, this);
    this.bind('change:upload',  this._onUploadChange, this);
    this.bind('change:id',      this._onIdChange, this);

    this.imp.bind('change', function () {
      this.trigger('change:import');
      this.trigger('change');
    }, this);
    this.upl.bind('change', function () {
      this.trigger('change:upload');
      this.trigger('change');
    }, this);
  },

  _destroyBinds: function () {
    this.upl.unbind(null, null, this);
    this.imp.unbind(null, null, this);
  },

  _onIdChange: function () {
    var item_queue_id = this.get('id');
    if (item_queue_id) this.imp.set('item_queue_id', item_queue_id);
    this.set('step', 'import');
  },

  _onUploadChange: function (m, i) {
    if (this.get('step') === "upload") {
      var item_queue_id = this.upl.get('item_queue_id');
      var state = this.upl.get('state');

      if (item_queue_id) this.set('id', item_queue_id);
      if (state) this.set('state', state);
    }
  },

  _onImportChange: function () {
    if (this.get('step') === "import") {
      var state = this.imp.get('state');
      if (state) this.set('state', state);
    }
  },

  _checkStatus: function () {
    if (!this.get('id') && !this.upl.isValid()) {
      this.trigger('change:upload');
      return;
    }

    if (this.upl.get('type') === 'file') {
      this.upl.upload();
    } else if (this.get('id')) {
      this.set('step', 'import');
      this.imp.set('item_queue_id', this.get('id'));
    } else if (!this.imp.get('item_queue_id') && this.upl.get('type') !== "") {
      this.set('step', 'import');
      this.imp.createImport(this.upl.toJSON());
    }
  },

  pause: function () {
    this.stopUpload();
    this.stopImport();
  },

  hasFailed: function () {
    var state = this.get('state');
    var step = this.get('step');

    return (step === 'import' && state === 'failure') ||
      (step === 'upload' && state === 'error');
  },

  hasCompleted: function () {
    var state = this.get('state') || (this.imp && this.imp.get('state'));
    var step = this.get('step');

    return step === 'import' && state === 'complete';
  },

  getWarnings: function () {
    var step = this.get('step');

    return step === 'import' ? this.imp.get('warnings') : '';
  },

  getError: function () {
    if (this.hasFailed()) {
      var step = this.get('step');
      return _.extend(
        {
          error_code: this[step === "upload" ? 'upl' : 'imp'].get('error_code'),
          item_queue_id: step === "import" ? this.imp.get('id') : '',
          original_url: step === "import" ? this.imp.get('original_url') : '',
          data_type: step === "import" ? this.imp.get('data_type') : '',
          http_response_code: step === "import" ? this.imp.get('http_response_code') : '',
          http_response_code_message: step === "import" ? this.imp.get('http_response_code_message') : ''
        }
        ,
        this[step === "upload" ? 'upl' : 'imp'].get('get_error_text')
      )
    }

    return {
      title: '',
      what_about: '',
      error_code: ''
    };
  },

  getNumberOfTablesCreated: function () {
    return this.imp.get('tables_created_count');
  },

  _getServiceName: function () {
    return this.imp.get('service_name');
  },

  isTwitterImport: function () {
    return this._getServiceName() === 'twitter_search';
  },

  isCartoImport: function () {
    return this._getDisplayName() && this._getDisplayName().match(/\.carto$/i);
  },

  _getDisplayName: function () {
    return this.imp.get('display_name');
  },

  importedVis: function () {
    if (this.get('import').derived_visualization_id) {
      return this._getMapVis();
    } else {
      return this._getDatasetVis();
    }
  },

  _getMapVis: function () {
    var derivedVisId = this.imp.get('derived_visualization_id');

    if (!derivedVisId) {
      return false;
    }

    return this._createVis({
      type: 'derived',
      id: derivedVisId
    });
  },

  _getDatasetVis: function () {
    var tableName = this.imp.get('table_name');

    if (!tableName) {
      return false;
    }

    return this._createVis({
      type: 'table',
      table: {
        name: tableName
      }
    });
  },

  _createVis: function (attrs) {
    var vis = new cdb.admin.Visualization(attrs);
    vis.permission.owner = this.user;
    return vis;
  },

  setError: function (opts) {
    var step = this.get('step');
    var stepModel = this[ step === "upload" ? 'upl' : 'imp' ];

    this.stopUpload();
    this.stopImport();

    stepModel.set(opts);

    this.set('state', 'error');
  },

  stopUpload: function () {
    this.upl.stopUpload();
  },

  stopImport: function () {
    this.imp.destroyCheck();
  },

  get: function (attr) {
    if (attr === "upload") return this.upl.toJSON();
    if (attr === "import") return this.imp.toJSON();

    return cdb.core.Model.prototype.get.call(this, attr);
  },

  // Returns a URL where the given user can be redirected
  // after the import has completed
  getRedirectUrl: function (user) {
    var vis = this.importedVis();
    if (vis) {
      return encodeURI(vis.viewUrl(user).edit());
    }
  },

  toJSON: function () {
    return {
      step: this.get('step'),
      id: this.get('id'),
      state: this.get('state'),
      upload: this.upl.toJSON(),
      import: this.imp.toJSON()
    };
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./import_model":7,"./upload_model":15}],11:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 * A special case of a geocoding model, since lon/lat geocoding is not actually going through the common async processing
 * as the rest.
 */
module.exports = cdb.core.Model.extend({

  initialize: function(attrs) {
    if (!attrs.table) throw new Error('table is required');
    if (!attrs.longitude_column) throw new Error('longitude_column is required');
    if (!attrs.latitude_column) throw new Error('latitude_column is required');
    if (!_.isBoolean(attrs.force_all_rows)) throw new Error('force_all_rows is required');

    this.set('table_name', attrs.table.get('name'));

    this._startGeocoding();
  },

  _startGeocoding: function() {
    this._changeState('isOngoing');

    var self = this;
    var table = this.get('table');
    table.save({
      longitude_column: this.get('longitude_column'),
      latitude_column: this.get('latitude_column'),
      force_all_rows: this.get('force_all_rows')
    }, {
      success: function() {
        // when finish fetch the data again and throw a signal to notify the changes
        // TODO: this should not exist, geometry_types change should be monitored
        table.trigger('geolocated');
        table.data().fetch();
        self._changeState('hasCompleted');
      },
      error: function(msg, resp) {
        var error;
        try {
          error = resp && JSON.parse(resp.responseText).errors[0];
        } catch(err) {
          // e.g. if responseText is empty (seems to happen when server is down/offline)
          error = 'Unknown error';
        }
        self.set('error', error);
        self._changeState('hasFailed');
      },
      wait: true // don't update attrs until success is triggered
    });
  },

  isOngoing: function() {
    return this.get('isOngoing');
  },

  hasCompleted: function() {
    return this.get('hasCompleted');
  },

  hasFailed: function() {
    return this.get('hasFailed');
  },

  getError: function() {
    return this.get('error');
  },

  _changeState: function(newState) {
    var changedStates = _.reduce(['isOngoing', 'hasCompleted', 'hasFailed'], function(memo, state) {
      memo[state] = state === newState;
      return memo;
    }, {});
    this.set(changedStates);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],12:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Pecan = require('cartodb-pecan');

/**
 *  Pecan model
 *
 */

module.exports = cdb.core.Model.extend({

  _PRINT_STATS: true,

  defaults: {
    table_id: '',
    column: '',
    state: 'idle'
  },

  initialize: function() {
    _.bindAll(this, "_onDescribe");
    this.sql = cdb.admin.SQL();
    this.query = 'SELECT * FROM ' + this.get("table_id");
  },

  getData: function() {
    this.sql.describe(this.query, this.get("column"), {}, this._onDescribe);
  },

  _onDescribe: function(stats) {
    var properties = {
      state: "analyzed",
      success: false
    };

    if (this._PRINT_STATS) {
      this.trigger('print_stats', stats, this);
    }

    var hasEnoughToGuess = Pecan.hasEnoughToGuess({
      stats: stats,
      isPointGeometryType: this.get('geometry_type') === 'point'
    });

    if (hasEnoughToGuess) {
      var response = Pecan.guessMap({
        tableName: this.get('table_id'),
        column: {
          stats: stats,
          geometryType: this.get('geometry_type'),
          bbox: this.get('bbox')
        },
        dependencies: {
          underscore: _
        }
      });

      if (response) {
        var overrides = {
          sql: this.query,
          success: true
        };
        properties = _.extend(properties, overrides, stats, response);
      }
    }

    if (stats.type === 'geom' && stats.bbox) {
      properties.bbox = stats.bbox;
    }

    this.set(properties);
  },

  isAnalyzed: function() {
    return this.get('state') === 'analyzed';
  },

  hasFailed: function() {
    return this.get('state') === 'failed';
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"cartodb-pecan":233}],13:[function(require,module,exports){
/*
 * Periodically fetches a model/collection. It waits for ongoing 
 * fetch requests before trying to fetch again. A stop condition
 * can be specified.
 *
 * Usage example:
 * 
 * var poller = new Poller(model, {
 *   interval: 1000,
 *   stopWhen: function(model) {
 *     return model.get('state') === 'completed';
 *   }
 * });
 * 
 * poller.start();
 *
 * // ...
 *
 * poller.stop();
 * 
 */
var Poller = function(model, options) {
  this.model = model;
  this.numberOfRequests = 0;
  this.polling = false;
  this.interval = options['interval'];
  if (typeof this.interval !== "function") {
    this.interval = function() { return options['interval']; };
  }
  this.stopWhen = options['stopWhen'];
  this.error = options['error'];
  this.autoStart = options['autoStart'];

  if (this.autoStart) {
    this.start();
  }
}

Poller.prototype.start = function() {
  if (this.timeout) {
    return;
  }

  this._scheduleFetch();
}

Poller.prototype._scheduleFetch = function() {
  this.timeout = setTimeout(this._fetch.bind(this), this.interval(this.numberOfRequests));
}

Poller.prototype._fetch = function() {
  var self = this;
  if (!self.polling) {
    self.polling = true;
    self.model.fetch({
      success: function() {
        self.polling = false;
        self.numberOfRequests++;
        if (self._continuePolling()) {
          self._scheduleFetch();
        }
      },
      error: function(e) {
        _.isFunction(self.error) && self.error(self.model);
      }
    })
  }
}

Poller.prototype._continuePolling = function() {
  return !this.stopWhen ||
    (_.isFunction(this.stopWhen) && !this.stopWhen(this.model));
}

Poller.prototype.stop = function() {
  this.polling = false;
  clearTimeout(this.timeout);
  delete(this.timeout);
}

module.exports = Poller;

},{}],14:[function(require,module,exports){

/**
 *  Default upload config
 *
 */

module.exports = {
  uploadStates: [
    'enqueued',
    'pending',
    'importing',
    'uploading',
    'guessing',
    'unpacking',
    'getting',
    'creating',
    'complete'
  ],
  fileExtensions: [
    'csv',
    'xls',
    'xlsx',
    'zip',
    'kml',
    'geojson',
    'json',
    'ods',
    'kmz',
    'tsv',
    'gpx',
    'tar',
    'gz',
    'tgz',
    'osm',
    'bz2',
    'tif',
    'tiff',
    'txt',
    'sql',
    'rar',
    'carto',
    'gpkg'
  ],
  // How big should file be?
  fileTimesBigger: 3
}

},{}],15:[function(require,module,exports){
(function (global){
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var UploadConfig = require('./upload_config');
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 * Model that let user upload files to our endpoints.
 *
 * NOTE: this model extends Backbone.Model instead of cdb.core.Model, because it's required for the
 * vendor/backbone-model-file-upload.
 */
module.exports = Backbone.Model.extend({

  url: '/api/v1/imports',

  fileAttribute: 'filename',

  defaults: {
    type: '',
    value: '',
    interval: 0,
    privacy: '',
    progress: 0,
    state: 'idle',
    service_item_id: '',
    service_name: '',
    option: '',
    content_guessing: true,
    type_guessing: true,
    create_vis: true
  },

  initialize: function(val, opts) {
    this.user = opts && opts.user;
    this._initBinds();
    // We need to validate entry attributes
    this._validate(this.attributes, { validate: true});
  },

  isValidToUpload: function() {
    return this.get('value') && this.get('state') !== 'error';
  },

  setFresh: function(d) {
    if (d && !_.isEmpty(d)) {
      // Set upload properties except create_vis (defined when created)
      this.set(_.omit(d, 'create_vis'));
    } else {
      this.clear();
    }
  },

  _initBinds: function() {
    this.bind('progress', function(progress) {
      this.set({
        progress: progress*100,
        state: 'uploading'
      });
    }, this);

    this.bind('change:value', function() {
      if (this.get('state') === "error") {
        this.set({ state: 'idle' })
        this.unset('get_error_text', { silent: true });
      }
    }, this);

    this.bind('error invalid', function(m, d) {
      this.set({
        state: 'error',
        error_code: (d && d.error_code) || '',
        get_error_text: {
          title: 'Invalid import',
          what_about: (d && d.msg) || ''
        }
      }, { silent: true });
      // We need this, if not validate will run again and again and again... :(
      this.trigger('change');
    }, this);
  },

  validate: function(attrs) {
    if (!attrs) return;

    if (attrs.type === "file") {
      // Number of files
      if (attrs.value && attrs.value.length) {
        return {
          msg: "Unfortunately only one file is allowed per upload"
        }
      }

      // File name
      var name = attrs.value.name;
      if (!name) {
        return {
          msg: "File name should be defined"
        }
      }

      // File extension
      var ext = name.substr(name.lastIndexOf('.') + 1);
      if (ext) {
        ext = ext.toLowerCase();
      }
      if (!_.contains(UploadConfig.fileExtensions, ext)) {
        return {
          msg: "Unfortunately this file extension is not allowed"
        }
      }
      // File size
      if (this.user && ((this.user.get('remaining_byte_quota') * UploadConfig.fileTimesBigger) < attrs.value.size)) {
        return {
          msg: "Unfortunately the size of the file is bigger than your remaining quota",
          error_code: 8001
        }
      }
    }

    if (attrs.type === "remote") {
      // Valid remote visualization id?
      if (!attrs.remote_visualization_id) {
        return {
          msg: "The remote visualization id was not specified"
        }

      }
      // Remote size?
      if (this.user && attrs.size && ((this.user.get('remaining_byte_quota') * UploadConfig.fileTimesBigger) < attrs.size)) {
        return {
          msg: "Unfortunately the size of the remote dataset is bigger than your remaining quota",
          error_code: 8001
        }
      }
    }

    if (attrs.type === "url") {
      // Valid URL?
      if (!Utils.isURL(attrs.value)) {
        return {
          msg: "Unfortunately the URL provided is not valid"
        }
      }
    }

    if (attrs.type === "sql") {
      if (!attrs.value) {
        return {
          msg: "Query is not provided"
        }
      }
    }

    if (attrs.type === "duplication") {
      if (!attrs.value) {
        return {
          msg: "Dataset copy is not defined"
        }
      }
    }

    if (attrs.type === "service" && attrs.service_name === "twitter_search") {
      var service_item_id = attrs.service_item_id;

      // Empty?
      if (!service_item_id || _.isEmpty(service_item_id)) {
        return {
          msg: "Twitter data is empty"
        }
      }

      // Categories?
      if (_.isEmpty(service_item_id.categories)) {
        return {
          msg: "Twitter categories are not valid"
        }
      }

      // Dates?
      var dates = service_item_id.dates;
      if (!dates || _.isEmpty(dates)) {
        return {
          msg: "Twitter dates are empty"
        }
      }
      var isToDateValid = moment(dates.fromDate) <= moment(new Date());
      if (!dates.fromDate || !dates.toDate || !isToDateValid) {
        return {
          msg: "Twitter dates are not valid"
        }
      }
    }
  },

  isValid: function() {
    return this.get('value') && this.get('state') !== "error"
  },

  upload: function() {
    if (this.get('type') === "file") {
      var self = this;
      this.xhr = this.save(
        {
          filename: this.get('value')
        },
        {
          success: function(m) {
            m.set('state', 'uploaded');
          },
          error: function(m, msg) {

            var message = 'Unfortunately there was a connection error';

            if (msg && msg.status === 429) {
              var response = JSON.parse(msg.responseText);
              message = response.errors.imports;
            }

            self.set({
              state: 'error',
              get_error_text: { title: 'There was an error', what_about: message }
            });

          },
          complete: function() {
            delete self.xhr;
          }
        }
      );
    }
  },

  stopUpload: function() {
    if (this.xhr) this.xhr.abort();
  },

  setGuessing: function(val) {
    this.set({
      type_guessing: val,
      content_guessing: val
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./upload_config":14}],16:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ViewFactory = require('../../../view_factory');
var PecanDialog = require('../../../dialogs/pecan/pecan_dialog_view');

module.exports = cdb.core.View.extend({

  className: 'ImportItem',
  tagName: 'li',

  events: {
    'click .js-abort':       '_removeItem',
    'click .js-show_dialog': '_showDialog',
    'click .js-close':       '_removeItem'
  },

  initialize: function() {
    this.user = this.options.user;
    this.vis = this.options.vis;
    this.template = cdb.templates.getTemplate('common/background_polling/views/analysis/background_analysis_item');
    this._initBinds();
  },

  render: function() {
    var totalItems    = this.collection.getTotalAnalysis();
    var totalAnalyzed = this.collection.getCompletedAnalysis();
    var totalSuccess  = this.collection.getSuccessfullyAnalysedColumns();

    var d = {
      totalSuccess: totalSuccess,
      totalItems: totalItems,
      totalAnalyzed: totalAnalyzed,
      progress: (totalAnalyzed / totalItems) * 100
    };

    this.$el.html(this.template(d));

    return this;
  },

  _initBinds: function() {
    this.collection.bind('change:state', this._onChangeState, this);
    this.add_related_model(this.collection);
  },

  _onChangeState: function() {
    var totalItems    = this.collection.getTotalAnalysis();
    var totalAnalyzed = this.collection.getCompletedAnalysis();
    var totalSuccess  = this.collection.getSuccessfullyAnalysedColumns();

    this.render();

    if (totalAnalyzed === totalItems && totalSuccess === 0) {
      this._removeItem();
    }
  },

  _showDialog: function() {

    var pecanDialog = new PecanDialog({
      clean_on_hide: true,
      vis: this.vis,
      collection:this.collection,
      user: this.user
    });

    pecanDialog.appendToBody();
  },

  _skip: function() {
    var layerID = this.vis.get("active_layer_id");
    var name;
    var activeLayer  = this.vis.map.layers.where({ id: layerID });

    if (activeLayer) {
      name = activeLayer[0].table.get("name");
    }

    var skipPencanDialog = 'pecan_' + this.user.get("username") + "_" + name;
    localStorage[skipPencanDialog] = true;
  },

  _removeItem: function() {
    this.trigger('remove', this.collection, this);
    this._skip();
    this.clean();
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../dialogs/pecan/pecan_dialog_view":185,"../../../view_factory":209}],17:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 *  Background polling header title view
 *
 *  It will contain only the title
 *
 */

module.exports = cdb.core.View.extend({

  tagName: 'h3',
  className: 'CDB-Text CDB-Size-large u-lSpace--xl',

  initialize: function() {
    this.template = cdb.templates.getTemplate('common/background_polling/views/background_polling_header_title');
    this._initBinds();
  },

  render: function() {
    this.$el.html(
      this.template({
        imports: this.model.getTotalImports(),
        geocodings: this.model.getTotalGeocodings(),
        analysis: this.model.getTotalAnalysis(),
        totalPollings: this.model.getTotalPollings()
      })
    );

    return this;
  },

  _initBinds: function() {
    this.model.bind('change analysisAdded analysisRemoved importAdded importRemoved geocodingAdded geocodingRemoved', this.render, this);
  }

});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],18:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BackgroundPollingHeaderTitleView = require('./background_polling_header_title_view');

/**
 *  Background polling header view
 *
 *  It will contain:
 *  - Badge
 *  - Title
 *
 */

module.exports = cdb.core.View.extend({

  className: "BackgroundPolling-header",

  initialize: function() {
    this.template = cdb.templates.getTemplate('common/background_polling/views/background_polling_header');
    this._initBinds();
  },

  render: function() {
    this.$el.html(this.template());
    this._initViews();
    this._updateBadges();
    return this;
  },

  _initBinds: function() {
    this.model.bind('change importAdded importRemoved geocodingAdded geocodingRemoved', this._updateBadges, this);
  },

  _initViews: function() {
    var headerTitle = new BackgroundPollingHeaderTitleView({
      model: this.model
    });
    this.$el.append(headerTitle.render().el);
    this.addView(headerTitle);
  },

  _updateBadges: function() {
    var failed = this.model.getTotalFailedItems();

    if (this.$('.BackgroundPolling-headerBadgeCount').length === 0 && failed > 0) {
      var $span = $('<span>').addClass("BackgroundPolling-headerBadgeCount Badge Badge--negative CDB-Text CDB-Size-small").text(failed);
      this.$('.BackgroundPolling-headerBadge')
        .append($span)
        .addClass('has-failures');
    } else if (this.$('.BackgroundPolling-headerBadgeCount').length > 0 && failed > 0) {
      this.$('.BackgroundPolling-headerBadgeCount').text(failed);
    } else if (failed === 0) {
      this.$('.BackgroundPolling-headerBadgeCount').remove();
      this.$('.BackgroundPolling-headerBadge').removeClass('has-failures');
    }

    // Show geocoding icon if only geocoding
    var geocodingsCount = this.model.getTotalGeocodings();
    var isGeocoding = geocodingsCount > 0 && geocodingsCount === this.model.getTotalPollings();
    this.$('.js-icon').toggleClass('CDB-IconFont-marker', isGeocoding);
    this.$('.js-icon').toggleClass('CDB-IconFont-cloud', !isGeocoding);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./background_polling_header_title_view":17}],19:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var pluralizeString = require('../../../view_helpers/pluralize_string');
var GeocodingResultDetailsView = require('./geocoding_result_details_view');

/**
 *  Geocoding item within background polling
 *
 */

module.exports = cdb.core.View.extend({

  className: 'ImportItem',
  tagName: 'li',

  events: {
    'click .js-abort': '_cancelGeocoding',
    'click .js-info': '_showDetails',
    'click .js-close': '_removeGeocoding'
  },

  initialize: function() {
    this.user = this.options.user;
    this.template = cdb.templates.getTemplate('common/background_polling/views/geocodings/background_geocoding_item');
    this._initBinds();
  },

  render: function() {
    var processedRows = this.model.get('processed_rows') || 0;
    var processableRows = this.model.get('processable_rows') || 0;
    var realRows = this.model.get('real_rows') || 0;
    var isLatLngType = this.model.get('latitude_column') && this.model.get('longitude_column');

    var d = {
      realRows: realRows,
      tableName: this.model.get('table_name'),
      canCancel: _.isFunction(this.model.cancelGeocoding),
      hasFailed: this.model.hasFailed(),
      hasCompleted: this.model.hasCompleted(),
      processedRows: processedRows,
      processableRows: processableRows,
      processableRowsFormatted: Utils.formatNumber(processableRows),
      realRowsPluralize: pluralizeString('row', 'rows', this.model.get('real_rows')),
      realRowsFormatted: Utils.formatNumber(realRows),
      processableRowsPluralize: pluralizeString('row', 'rows', processableRows),
      width: realRows > 0 ? (processableRows/realRows) : 100,
      isLatLngType: isLatLngType
    }
    this.$el.html(this.template(d));

    return this;
  },

  _initBinds: function() {
    this.model.bind('change', this.render, this);
    this.model.bind('remove', this.clean, this);
  },

  _cancelGeocoding: function() {
    this.model.cancelGeocoding();
  },

  _removeGeocoding: function() {
    this.trigger('remove', this.model, this);
    this.clean();
  },

  _showDetails: function() {
    new GeocodingResultDetailsView({
      clean_on_hide: true,
      user: this.user,
      model: this.model,
      showGeocodingDatasetURLButton: this.options.showGeocodingDatasetURLButton
    }).appendToBody();
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../view_helpers/pluralize_string":211,"./geocoding_result_details_view":20}],20:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../../views/base_dialog/view');
var pluralizeString = require('../../../view_helpers/pluralize_string');
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);

/**
 *  When a geocoding proccess finishes, this dialog displays
 *  all the info about the task (price, rows, errors, etc).
 *
 */

module.exports = BaseDialog.extend({

  className: 'Dialog BackgroundPollingDetails is-opening',

  initialize: function() {
    this.elder('initialize');
    this.user = this.options.user;
  },

  render_content: function() {
    var error = this.model.get('error') || {};

    var processedRows = this.model.get('processed_rows') || 0;
    var processableRows = this.model.get('processable_rows') || 0;
    var realRows = this.model.get('real_rows') || 0;
    var geometryType = this.model.get('geometry_type') || 'point';

    // Related to price and credits
    var price = this.model.get('price');
    var hasPrice = price !== undefined && price !== null;
    var googleUser = this.user.featureEnabled('google_maps');

    var datasetURL;
    if (this.user && this.model.get('table_name')) {
      var vis = new cdb.admin.Visualization({
        type: 'table',
        table: {
          name: this.model.get('table_name')
        }
      });
      vis.permission.owner = this.user;
      datasetURL = encodeURI(vis.viewUrl(this.user).edit());
    }

    // Select template
    var template = 'common/background_polling/views/geocodings/';
    if (this.model.hasCompleted()) {
      template += realRows === 0 ? 'geocoding_no_result_details' : 'geocoding_success_details';
    } else {
      template += 'geocoding_error_details';
    }

    return cdb.templates.getTemplate(template)({
      id: this.model.get('id'),
      geometryTypePluralize: pluralizeString(geometryType, geometryType + 's', processableRows),
      geometryType: geometryType,
      remainingQuotaFormatted: Utils.formatNumber(this.model.get('remaining_quota')),
      googleUser: googleUser,
      tableName: this.model.get('table_name'),
      state: this.model.get('state') || '',
      blockPrice: this.user.get('geocoding').block_price,
      realRows: realRows,
      realRowsFormatted: Utils.formatNumber(realRows),
      processedRows: processedRows,
      processableRows: processableRows,
      processableRowsFormatted: Utils.formatNumber(processableRows),
      hasPrice: hasPrice,
      price: price,
      customHosted: cdb.config.get('cartodb_com_hosted'),
      errorDescription: error.description,
      showGeocodingDatasetURLButton: this.options.showGeocodingDatasetURLButton && datasetURL,
      datasetURL: datasetURL
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../view_helpers/pluralize_string":211,"../../../views/base_dialog/view":213}],21:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var UploadConfig = require('../../models/upload_config');
var ErrorDetailsView = require('../../../views/error_details_view');
var WarningsDetailsView = require('../../../views/warnings_details_view');
var ViewFactory = require('../../../view_factory');
var TwitterImportDetailsDialog = require('./twitter_import_details_view');

/**
 *  Import item within background importer
 *
 */

module.exports = cdb.core.View.extend({

  className: 'ImportItem',
  tagName: 'li',

  events: {
    'click .js-abort':      '_removeItem',
    'click .js-show_error': '_showImportError',
    'click .js-show_warnings': '_showImportWarnings',
    'click .js-show_stats': '_showImportStats',
    'click .js-close':      '_removeItem'
  },

  initialize: function() {
    this.user = this.options.user;
    this._showSuccessDetailsButton = this.options.showSuccessDetailsButton;
    this.template = cdb.templates.getTemplate('common/background_polling/views/imports/background_import_item');
    this._initBinds();
  },

  render: function() {
    var upload = this.model.get('upload');
    var imp = this.model.get('import');

    var d = {
      name: '',
      state: this.model.get('state'),
      progress: '',
      service: '',
      step: this.model.get('step'),
      url: '',
      failed: this.model.hasFailed(),
      completed: this.model.hasCompleted(),
      warnings: this.model.getWarnings(),
      showSuccessDetailsButton: this._showSuccessDetailsButton,
      tables_created_count: imp.tables_created_count
    };

    // URL
    if (d.state === "complete") {
      var vis = this.model.importedVis();
      if (vis) {
        d.url = encodeURI(vis.viewUrl(this.user).edit());
      }
    }

    // Name
    if (upload.type) {
      if (upload.type === "file") {
        if (upload.value.length > 1) {
          d.name = upload.value.length + ' files';
        } else {
          d.name = upload.value.name;
        }
      }
      if (upload.type === "url" || upload.type === "remote") {
        d.name = upload.value;
      }
      if (upload.type === "service") {
        d.name = upload.value && upload.value.filename || '';
      }
      if (upload.service_name === "twitter_search") {
        d.name = 'Twitter import';
      }
      if (upload.type === "sql") {
        d.name = 'SQL';
      }
      if (upload.type === "duplication") {
        d.name = upload.table_name || upload.value;
      }
    } else {
      d.name = imp.display_name || imp.item_queue_id || 'import';
    }

    // Service
    d.service = upload.service_name;

    // Progress
    if (this.model.get('step') === 'upload') {
      d.progress = this.model.get('upload').progress;
    } else {
      d.progress = (UploadConfig.uploadStates.indexOf(d.state)/UploadConfig.uploadStates.length) * 100;
    }

    this.$el.html(this.template(d));

    return this;
  },

  _initBinds: function() {
    this.model.bind('change', this.render, this);
    this.model.bind('remove', this.clean, this);
  },

  _removeItem: function() {
    this.trigger('remove', this.model, this);
    this.model.pause();
    this.clean();
  },

  _showImportStats: function() {
    (new TwitterImportDetailsDialog({
      clean_on_hide: true,
      user: this.user,
      model: this.model
    })).appendToBody();
  },

  _showImportError: function() {
    var dialog = ViewFactory.createDialogByView(
      new ErrorDetailsView({
        err: this.model.getError(),
        user: this.user
      })
    );
    dialog.appendToBody();
  },

  _showImportWarnings: function() {
    var dialog = ViewFactory.createDialogByView(
      new WarningsDetailsView({
        warnings: this.model.getWarnings(),
        user: this.user
      })
    );
    dialog.appendToBody();
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../view_factory":209,"../../../views/error_details_view":215,"../../../views/warnings_details_view":220,"../../models/upload_config":14,"./twitter_import_details_view":23}],22:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 *  Import limit message within background importer
 *
 */

module.exports = cdb.core.View.extend({

  className: 'ImportItem ImportItem--sticky',
  tagName: 'li',

  initialize: function() {
    this.user = this.options.user;
    this.template = cdb.templates.getTemplate('common/background_polling/views/imports/background_import_limit');
  },

  render: function() {
    var importQuota = this.user.getMaxConcurrentImports();
    var isUpgradeable = !cdb.config.get('cartodb_com_hosted') && importQuota === 1;

    this.$el.html(
      this.template({
        upgradeUrl: window.upgrade_url,
        isUpgradeable: isUpgradeable,
        importQuota: importQuota
      })
    );

    return this;
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],23:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../../views/base_dialog/view');
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);

/**
 *  When a Twitter import finishes, this dialog displays
 *  all the info about the price/cost etc.
 *
 */

module.exports = BaseDialog.extend({

  className: 'Dialog TwitterImportDetails is-opening',

  initialize: function() {
    this.elder('initialize');
    this.user = this.options.user;
    this.template = cdb.templates.getTemplate('common/background_polling/views/imports/twitter_import_details');
  },

  render_content: function() {
    var imp = this.model.get('import');
    var userTwitterValues = this.user.get('twitter');
    var availableTweets = userTwitterValues.quota - userTwitterValues.monthly_use;
    var vis = this.model.importedVis();
    var url = vis && encodeURI(vis.viewUrl(this.user).edit()) || '';
    var d = {
      type: vis && vis.get('type') === "table" ? "dataset" : "map",
      mapURL: url,
      datasetTotalRows: imp.tweets_georeferenced,
      datasetTotalRowsFormatted: Utils.formatNumber(imp.tweets_georeferenced),
      tweetsCost: imp.tweets_cost,
      tweetsCostFormatted: Utils.formatNumber(imp.tweets_cost),
      availableTweets: availableTweets,
      availableTweetsFormatted: Utils.formatNumber(availableTweets),
      tweetsOverquota: imp.tweets_overquota,
      tweetsOverquotaFormatted: Utils.formatNumber(imp.tweets_overquota),
      blockSizeFormatted: Utils.formatNumber(userTwitterValues.block_size),
      blockPriceFormatted: Utils.formatNumber(userTwitterValues.block_price)
    };
    return this.template(d);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../views/base_dialog/view":213}],24:[function(require,module,exports){
(function (global){
var queue = require('queue-async');
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 * Convenient object to do async batch processing, and don't continue until all items have successfully finished.
 * In case of error it will fail immediately.
 *
 * Example usage:
 *   var batchProcess = require('../common/batch_process_items');
 *   batchProcess({
 *     items: [ ... ],
 *     done: function() {
 *       this.close();
 *     },
 *     fail: function(jqXHR, errorType, e) {
 *       this._errorMsg = 'Server response: '+ jqXHR.responseText;
 *       this.render();
 *     }
 *   });
 *
 * @param opts {Object}
 *   howManyInParallel: {Number}
 *   items: {Array} each item will be passed to processItem(item, ...
 *   processItem: {Function} given an item and a callback, should call callback() for success case, or callback(error) if something failed.
 *   fail: {Function}
 *   done: {Function} called if all items
 */
module.exports = function(opts) {
  var q = queue(opts.howManyInParallel);
  _.each(opts.items, function(item) {
    q.defer(function(callback) {
      opts.processItem(item, callback);
    });
  });

  q.awaitAll(function(error/*, result1, ..., resultN */) {
    // error and results contains outcome of the jqXHR requests above, see http://api.jquery.com/jQuery.ajax/#jqXHR
    if (error) {
      opts.fail(error);
    } else {
      opts.done();
    }
  });
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"queue-async":234}],25:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var XYZModel = require('./xyz/xyz_model.js');
var WMSModel = require('./wms/wms_model.js');
var NASAModel = require('./nasa/nasa_model.js');
var MapboxModel = require('./mapbox/mapbox_model.js');
var TileJSONModel = require('./tile_json/tile_json_view_model.js');

/**
 * View model for the add-custom-basemap view
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    map: undefined,
    baseLayers: undefined,
    tabs: undefined,
    currentView: 'tabs',
    currentTab: 'xyz'
  },

  initialize: function(attrs) {
    this.elder('initialize');
    if (!attrs.map) throw new Error('map is required');
    if (!attrs.baseLayers) throw new Error('baseLayers is required');
    this._initTabs();
    this._initBinds();
  },

  activeTabModel: function() {
    return this.get('tabs').where({ name: this.get('currentTab') })[0];
  },

  canSaveBasemap: function() {
    return this.get('currentView') === 'tabs' && this._layerToSave();
  },

  saveBasemap: function() {
    if (!this.canSaveBasemap()) return;
    this.set('currentView', 'saving');

    var layer = this._layerToSave();
    if (this.activeTabModel().hasAlreadyAddedLayer(this.get('baseLayers'))) {
      this._onLayerSaved(layer);
    } else {
      // Add to baseLayers collection before saving, so save URL resolves to the expected endpoint.
      this.get('baseLayers').add(layer);

      var self = this;
      layer.save()
      .done(function() {
        self._onLayerSaved(layer);
      })
      .fail(function() {
        // Cleanup, remove layer it could not be saved!
        self.get('baseLayers').remove(layer);
        self.set('currentView', 'saveFail');
      });
    }
  },

  _onLayerSaved: function(layer) {
    var map = this.get('map');

    var clonedLayer = layer.clone();
    clonedLayer.unset('id');
    map.changeProvider('leaflet', clonedLayer);

    var bbox = layer.get('bounding_boxes');
    if (bbox && bbox.length === 4) {
      map.setBounds([
        [bbox[1], bbox[0]],
        [bbox[3], bbox[2]]
      ]);
    }

    this.set('currentView', 'saveDone');
  },

  _initTabs: function() {
    var tabs = new Backbone.Collection([
      new XYZModel(),
      new WMSModel({
        baseLayers: this.get('baseLayers')
      }),
      new NASAModel(),
      new MapboxModel(),
      new TileJSONModel()
    ]);
    this.set({
      tabs: tabs,
      currentTab: tabs.first().get('name')
    });
  },

  _initBinds: function() {
    this.get('tabs').each(function(tabModel) {
      tabModel.bind('saveBasemap', this.saveBasemap, this);
    }, this);
  },

  _layerToSave: function() {
    return this.activeTabModel().get('layer');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./mapbox/mapbox_model.js":27,"./nasa/nasa_model.js":30,"./tile_json/tile_json_view_model.js":34,"./wms/wms_model.js":39,"./xyz/xyz_model.js":41}],26:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var BaseDialog = require('../../views/base_dialog/view.js');
var randomQuote = require('../../view_helpers/random_quote.js');
var ViewFactory = require('../../view_factory.js');
var ViewModel = require('./add_custom_basemap_model.js');
var TabsView = require('./tabs_view.js');

/**
 * Dialog to add ¯custom basemap to current map.
 */
module.exports = BaseDialog.extend({

  initialize: function() {
    this.elder('initialize');
    this.model = new ViewModel({
      map: this.options.map,
      baseLayers: this.options.baseLayers
    });
    this._initViews();
    this._initBinds();
  },

  /**
   * @override cdb.ui.common.Dialog.prototype.render
   */
  render: function() {
    BaseDialog.prototype.render.apply(this, arguments);
    this.$('.content').addClass('Dialog-contentWrapper');
    return this;
  },

  /**
   * @implements cdb.ui.common.Dialog.prototype.render_content
   */
  render_content: function() {
    var contentView = this._panes.active(this.model.get('currentView')).render();
    contentView.$el.addClass('Dialog-body Dialog-body--expanded Dialog-body--create');
    contentView.delegateEvents(); // enable events after being added to $el
    var $el = $(
      cdb.templates.getTemplate('common/dialogs/add_custom_basemap/add_custom_basemap')({
        model: this.model
      })
    );
    $el.append(contentView.el);
    return $el;
  },

  ok: function() {
    if (this.model.canSaveBasemap()) {
      this.model.saveBasemap();
    }
  },

  _initViews: function() {
    this._panes = new cdb.ui.common.TabPane({
      el: this.el
    });
    this.addView(this._panes);
    this._panes.addTab('tabs',
      new TabsView({
        model: this.model
      })
    );
    this._panes.addTab('saving',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Setting basemap…',
        quote: randomQuote()
      }).render()
    );
    this._panes.addTab('saveFail',
      ViewFactory.createByTemplate('common/templates/fail', {
        msg: ''
      }).render()
    );
    this._panes.active(this.model.get('currentView'));
  },

  _initBinds: function() {
    this.model.bind('change:currentView', this._onCurrentViewChange, this);
  },

  _onCurrentViewChange: function() {
    if (this.model.get('currentView') === 'saveDone') {
      this.close();
    } else {
      this.render();
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory.js":209,"../../view_helpers/random_quote.js":212,"../../views/base_dialog/view.js":213,"./add_custom_basemap_model.js":25,"./tabs_view.js":32}],27:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var MapboxView = require('./mapbox_view');
var MapboxToTileLayerFactory = require('./mapbox_to_tile_layer_factory');

/**
 * View model for XYZ tab content.
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    name: 'mapbox',
    label: 'Mapbox',
    currentView: 'enterURL', //, validatingInputs, valid
    lastErrorMsg: '', //set if fails to save
    layer: undefined // will be set when valid
  },

  createView: function() {
    this.set({
      currentView: 'enterURL',
      layer: undefined
    });
    return new MapboxView({
      model: this
    });
  },

  hasAlreadyAddedLayer: function(baseLayers) {
    var urlTemplate = this.get('layer').get('urlTemplate');
    return _.any(baseLayers.custom(), function(customLayer) {
      return customLayer.get('urlTemplate') === urlTemplate;
    });
  },

  save: function(url, accessToken) {
    this.set({
      currentView: 'validatingInputs',
      url: url,
      accessToken: accessToken
    });

    var self = this;
    var mf = new MapboxToTileLayerFactory({
      url: url,
      accessToken: accessToken
    });
    mf.createTileLayer({
      success: function(tileLayer) {
        self.set('layer', tileLayer);
        self.trigger('saveBasemap');
      },
      error: function(errorMsg) {
        self.set({
          currentView: 'enterURL',
          lastErrorMsg: errorMsg
        });
      }
    });
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./mapbox_to_tile_layer_factory":28,"./mapbox_view":29}],28:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * Factory to create a cdb.admin.TileLayer from a given URL and access token tuple for Mapbox.
 * Extracted from mapbox_basemap_pane to maintain current logic, since it's rather complex…
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    url: '',
    accessToken: ''
  },

  _MAPBOX: {
    version: 4,
    https: 'https://dnv9my2eseobd.cloudfront.net',
    base: 'https://a.tiles.mapbox.com/'
  },

  /**
   * @param {Object} callbacks
   *   success {Function} given a new TileLayer object
   *   error {Function} given an error explanation
   */
  createTileLayer: function(callbacks) {
    var val = this.get('url');
    var url = this._lowerXYZ(val);
    var access_token = this.get('accessToken');
    var type = 'json';
    var subdomains = ['a', 'b', 'c'];
    var mapbox_id;

    // Detects the URL's type
    if (url.indexOf('{x}') < 0 && url.indexOf('tiles.mapbox.com') !== -1) {
      mapbox_id = this._getMapBoxMapID(url);
      if (mapbox_id) {
        type = 'mapbox_id';
        url = mapbox_id;
      }
    } else if (url.indexOf('{x}') !== -1) {
      type = 'xyz';
      url = url.replace(/\{s\}/g, function() {
          return subdomains[Math.floor(Math.random() * 3)];
        })
        .replace(/\{x\}/g, '0')
        .replace(/\{y\}/g, '0')
        .replace(/\{z\}/g, '0');
    } else if (url && url.indexOf('http') < 0 && url.match(/(.*?)\.(.*)/) != null && url.match(/(.*?)\.(.*)/).length === 3) {
      type = 'mapbox_id';
      mapbox_id = val;
    } else { // If not, check https
      url = this._fixHTTPS(url);
    }

    var self = this;
    var image;
    if (type === 'mapbox') {
      callbacks.success(this._newTileLayer({ tiles: [url] }));
    } else if (type === 'xyz') {
      image = new Image();
      image.onload = function() {
        callbacks.success(self._newTileLayer({
          tiles: [self._lowerXYZ(val)]
        }));
      };
      image.onerror = function() {
        callbacks.error(self._errorToMsg());
      };
      image.src = url;
    } else if (type === 'mapbox_id') {
      var params = '?access_token=' + access_token;
      var base_url = this._MAPBOX.base + 'v' + this._MAPBOX.version + '/' + mapbox_id;
      var tile_url = base_url + '/{z}/{x}/{y}.png' + params;
      var json_url = base_url + '.json' + params;

      // JQuery has a faulty implementation of the getJSON method and doesn't return
      // a 404, so we use a timeout. TODO: replace with CORS
      var errorTimeout = setTimeout(function() {
        callbacks.error(self._errorToMsg());
      }, 5000);

      $.ajax({
        url: json_url,
        success: function(data) {
          clearTimeout(errorTimeout);
          callbacks.success(self._newTileLayer({
            tiles: [tile_url],
            attribution: data.attribution,
            minzoom: data.minzoom,
            maxzoom: data.maxzoom,
            name: data.name
          }));
        },
        error: function(e) {
          clearTimeout(errorTimeout);
          callbacks.error(self._errorToMsg(e));
        }
      });
    } else {
      callbacks.error(this._errorToMsg());
    }
  },

  _newTileLayer: function(data) {
    // Check if the respond is an array
    // In that case, get only the first
    if (_.isArray(data) && _.size(data) > 0) {
      data = _.first(data);
    }

    return new cdb.admin.TileLayer({
      urlTemplate: data.tiles[0],
      attribution: data.attribution || null,
      maxZoom: data.maxzoom || 21,
      minZoom: data.minzoom || 0,
      name: data.name || ''
    });
  },

  _errorToMsg: function(error) {
    if (typeof error === 'object' || !error) {
      if (error && error.status && error.status === 401) {
        return 'Error retrieving your basemap. Please, check your access token.';
      } else {
        return 'This value is not valid.';
      }
    }

    return error;
  },

  _lowerXYZ: function(url) {
    return url.replace(/\{S\}/g, "{s}")
      .replace(/\{X\}/g, "{x}")
      .replace(/\{Y\}/g, "{y}")
      .replace(/\{Z\}/g, "{z}");
  },

  // Extracts the Mapbox MapId from a Mapbox URL
  _getMapBoxMapID: function(url) {
    // http://d.tiles.mapbox.com/v3/{user}.{map}/3/4/3.png
    // http://a.tiles.mapbox.com/v3/{user}.{map}/page.html
    // http://a.tiles.mapbox.com/v4/{user}.{map}.*
    var reg1 = /https?:\/\/[a-z]?\.?tiles\.mapbox.com\/v(\d)\/([^\/.]*)\.([^\/.]*)/;

    // https://tiles.mapbox.com/{user}/edit/{map}?newmap&preset=Streets#3/0.00/-0.09
    var reg2 = /https?:\/\/tiles\.mapbox\.com\/(.*?)\/edit\/(.*?)(\?|#)/;

    var match = '';

    // Check first expresion
    match = url.match(reg1);

    if (match && match[1] && match[2]) {
      return match[2] + "." + match[3];
    }

    // Check second expresion
    match = url.match(reg2);

    if (match && match[1] && match[2]) {
      return match[1] + "." + match[2];
    }
  },

  /**
   * return a https url if the current application is loaded from https
   */
  _fixHTTPS: function(url, loc) {
    loc = loc || location;

    // fix the url to https or http
    if (url.indexOf('https') !== 0 && loc.protocol === 'https:') {
      // search for mapping
      var i = url.indexOf('mapbox.com');
      if (i !== -1) {
        return this._MAPBOX.https + url.substr(i + 'mapbox.com'.length);
      }
      return url.replace(/http/, 'https');
    }
    return url;
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],29:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ViewFactory = require('../../../view_factory.js');
var randomQuote = require('../../../view_helpers/random_quote.js');


/**
 * Represents the Mapbox tab content.
 */
module.exports = cdb.core.View.extend({

  events: {
    'click .js-ok': '_onClickOK',
    'keydown': '_onKeyDown',
    'keyup': '_onKeyUp'
  },

  initialize: function() {
    this.elder('initialize');
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();

    var view;
    switch (this.model.get('currentView')) {
      case 'validatingInputs':
        view = ViewFactory.createByTemplate('common/templates/loading', {
          title: 'Validating…',
          quote: randomQuote()
        });
        break;
      case 'enterURL':
      default:
        view = ViewFactory.createByTemplate('common/dialogs/add_custom_basemap/mapbox/enter_url', {
          url: this.model.get('url'),
          accessToken: this.model.get('accessToken'),
          lastErrorMsg: this.model.get('lastErrorMsg')
        });
    }
    this.addView(view);
    this.$el.append(view.render().el);

    return this;
  },

  _initBinds: function() {
    this.model.bind('change', this.render, this);
  },

  _hasValues: function() {
    return this._urlVal() && this._accessToken();
  },

  _urlVal: function() {
    return this.$('.js-url').val();
  },

  _accessToken: function() {
    return this.$('.js-access-token').val();
  },

  _onClickOK: function(ev) {
    this.killEvent(ev);
    if (this._hasValues()) {
      var url = this._urlVal();
      var accessToken = this._accessToken();
      this.model.save(url, accessToken);
    }
  },

  _onKeyDown: function(ev) {
    ev.stopPropagation();
    this.$('.js-error').removeClass('is-visible');
  },

  _onKeyUp: function(ev) {
    ev.stopPropagation();
    this.$('.js-ok').toggleClass('is-disabled', !this._hasValues());
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../view_factory.js":209,"../../../view_helpers/random_quote.js":212}],30:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var NASAView = require('./nasa_view');
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);

var TYPES = {
  day: {
    url:          'http://map1.vis.earthdata.nasa.gov/wmts-webmerc/MODIS_Terra_CorrectedReflectance_TrueColor/default/<%- date %>/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpeg',
    limit:        '2012-05-01',
    default:      '2012-05-01',
    attribution:  '<a href="http://earthdata.nasa.gov/gibs" target="_blank">NASA EOSDIS GIBS</a>',
    name:         'NASA Terra',
    maxZoom:      9,
    minZoom:      1
  },

  night: {
    url:          'http://map1.vis.earthdata.nasa.gov/wmts-webmerc/VIIRS_CityLights_2012/default/<%- date %>/GoogleMapsCompatible_Level8/{z}/{y}/{x}.jpeg',
    limit:        '2012-05-01',
    default:      '2012-05-02',
    attribution:  '<a href="http://earthdata.nasa.gov/gibs" target="_blank">NASA EOSDIS GIBS</a>',
    name:         'NASA Earth at night',
    maxZoom:      8,
    minZoom:      1
  }
};

/**
 * View model for XYZ tab content.
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    name: 'nasa',
    label: 'NASA',
    layer: undefined, //gets set on dayOrNight/date changes
    layerType: 'day',

    // for date picker
    date: undefined,
    current: undefined,
    format: 'Y-m-d' // YYYY-MM-DD
  },

  initialize: function() {
    this.elder('initialize');
    this._initBinds();
  },

  createView: function() {
    var utc = new Date().getTimezoneOffset();
    var today = moment(new Date()).utcOffset(utc).format('YYYY-MM-DD');
    var yesterday = moment(new Date()).utcOffset(utc).subtract(1, 'days').format('YYYY-MM-DD');
    this.set({
      current: today,
      date: yesterday
    });

    return new NASAView({
      model: this
    });
  },

  hasAlreadyAddedLayer: function(baseLayers) {
    var urlTemplate = this.get('layer').get('urlTemplate');
    return _.any(baseLayers.custom(), function(customLayer) {
      return customLayer.get('urlTemplate') === urlTemplate;
    });
  },

  _initBinds: function() {
    this.bind('change:date change:layerType', this._onChange, this);
  },

  _onChange: function() {
    var dateStr = this.get('date');
    var layerType = this.get('layerType');
    this.set('layer', new cdb.admin.TileLayer({
      urlTemplate: _.template(TYPES[layerType].url)({
        date: dateStr
      }),
      attribution: TYPES[layerType].attribution,
      maxZoom: TYPES[layerType].maxZoom,
      minZoom: TYPES[layerType].minZoom,
      name: TYPES[layerType].name + ' ' + dateStr
    }));
  }
});


}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./nasa_view":31}],31:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);
var DateFieldView = require('../../../edit_fields/date_field/date_field_view');
var EditFieldModel = require('../../../edit_fields/edit_field_model');

/**
 * Represents the XYZ tab content.
 */
module.exports = cdb.core.View.extend({

  options: {
    dateFormat: 'YYYY-MM-DD'
  },

  events: {
    'click .js-day': '_onChangeToDay',
    'click .js-night': '_onChangeToNight'
  },

  initialize: function() {
    this.elder('initialize');
    this.dateModel = new EditFieldModel({
      value: this.model.get('date'),
      type: 'date'
    });
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();

    this.$el.html(
      cdb.templates.getTemplate('common/dialogs/add_custom_basemap/nasa/nasa')({
        layerType: this.model.get('layerType'),
        initialDateStr: moment(this.dateModel.get('value')).format(this.options.dateFormat)
      })
    );

    this._renderDatePicker();

    return this;
  },

  _initBinds: function() {
    this.model.bind('change:layerType', function() {
      this.dateModel.set('readOnly', this.model.get('layerType') === "night");
      this.render()
    }, this);
    this.dateModel.bind('change:value', function() {
      var date = moment(this.dateModel.get('value')).format(this.options.dateFormat);
      this.model.set('date', date);
    }, this);
    this.add_related_model(this.dateModel);
  },

  _renderDatePicker: function() {
    // Date field 
    var dateField = new DateFieldView({
      model: this.dateModel,
      showTime: false,
      showGMT: false
    });
    this.addView(dateField);
    this._$datePicker().append(dateField.render().el);

    // Disabled tooltip
    if (this.dateModel.get('readOnly')) {
      this.addView(
        new cdb.common.TipsyTooltip({
          el: this._$datePicker(),
          title: function(e) {
            return $(this).attr('data-title')
          }
        })
      )
    }
  },

  _onChangeToNight: function(ev) {
    this.model.set('layerType', 'night');
  },

  _onChangeToDay: function() {
    this.model.set('layerType', 'day');
  },

  _$datePicker: function() {
    return this.$('.js-datePicker');
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../edit_fields/date_field/date_field_view":195,"../../../edit_fields/edit_field_model":199}],32:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 * View representing the tabs content of the dialog.
 */
module.exports = cdb.core.View.extend({

  events: {
    'click .js-tabs button': '_onClickTab'
  },

  initialize: function() {
    this.elder('initialize');
    this._initBinds();
  },

  render: function() {
    var $el = $(
      cdb.templates.getTemplate('common/dialogs/add_custom_basemap/tabs')({
        model: this.model
      })
    );
    $el.find('.js-tab-content').append(this._createTabContentView().el);
    this.$el.html($el);
    return this;
  },

  _initBinds: function() {
    this.model.bind('change:currentTab', this.render, this);
  },

  _createTabContentView: function() {
    if (this._currentTabView) {
      this._currentTabView.clean();
    }
    this._currentTabView = this.model.activeTabModel().createView();
    this.addView(this._currentTabView);
    return this._currentTabView.render();
  },

  _onClickTab: function(ev) {
    this.killEvent(ev);
    var name = $(ev.target).closest('button').data('name');
    if (name) {
      this.model.set('currentTab', name);
    } else {
      cdb.log.error('tab name was expected but was empty');
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],33:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 * Represents the TileJSON tab content.
 */
module.exports = cdb.core.View.extend({

  events: {
    'keydown .js-url': '_update',
    'paste .js-url': '_update'
  },

  initialize: function() {
    this.elder('initialize');
    this._lastURL = '';
  },

  render: function() {
    this.$el.html(
      cdb.templates.getTemplate('common/dialogs/add_custom_basemap/tile_json/tile_json')({
      })
    );

    return this;
  },

  _update: function(ev) {
    ev.stopPropagation();
    this._debouncedUpdate();
  },

  _debouncedUpdate: _.debounce(function() {
    this._disableOkBtn(true);
    this._indicateIsValidating(true);

    var url = this._urlWithHTTP();
    if (url === this._lastURL) {
      // Even if triggered nothing really changed so just update UI and return early
      this._indicateIsValidating(false);
      this._updateError();
      return;
    }

    this._lastURL = url;
    this._indicateIsValidating(true);
    var tileJSON = new cdb.admin.TileJSON({
      url: url
    });

    var self = this;
    tileJSON.fetch({
      success: function() {
        if (url === self._lastURL) {
          self.model.set('layer', tileJSON.newTileLayer());
          self._disableOkBtn(false);
          self._indicateIsValidating(false);
          self._updateError();
        }
      },
      error: function() {
        if (url === self._lastURL) {
          self._indicateIsValidating(false);
          // Note that this text can not be longer, or it will exceed available space of the error label.
          self._updateError('Invalid URL, please make sure it is correct');
        }
      }
    });
  }, 150),

  _disableOkBtn: function(disable) {
    this.$('.ok')[ disable ? 'addClass' : 'removeClass' ]('is-disabled');
  },

  _updateError: function(msg) {
    this.$('.js-error').text(msg)[ msg ? 'addClass' : 'removeClass' ]('is-visible');
  },

  _indicateIsValidating: function(indicate) {
    if (indicate) {
      this.$('.js-idle').hide();
      this.$('.js-validating').show();
    } else {
      this.$('.js-validating').hide();
      this.$('.js-idle').show();
    }
  },

  // So don't try to be fetched relatively to current URL path later
  _urlWithHTTP: function() {
    var str = this.$('.js-url').val();
    if (str.indexOf('http://') === -1) {
      return 'http://' + str;
    } else {
      return str;
    }
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],34:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var TileJSONView = require('./tile_json_view');

/**
 * View model for TileJSON tab content.
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    name: 'tile_json',
    label: 'TileJSON',
    layer: undefined // will be set when valid
  },

  createView: function() {
    this.set({
      layer: undefined
    });
    return new TileJSONView({
      model: this
    });
  },

  hasAlreadyAddedLayer: function(baseLayers) {
    var urlTemplate = this.get('layer').get('urlTemplate');
    return _.any(baseLayers.custom(), function(customLayer) {
      return customLayer.get('urlTemplate') === urlTemplate;
    });
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./tile_json_view":33}],35:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 * Model for an individual WMS/WMTS layer.
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    state: 'idle', //, saving, saveDone, saveFail
    layer: undefined // set after saveDone
  },

  canSave: function(baseLayers) {
    return !_.any(baseLayers.custom(), function(customLayer) {
      return customLayer.get('name') === this.get('title');
    }, this);
  },

  save: function() {
    this.set('state', 'saving');
    this._shouldBeProxied() ? this._createProxiedLayer() : this._newTileLayer();
  },

  _shouldBeProxied: function() {
    if (this.get('type') === 'wmts') {
      var supportedMatrixSets = cdb.admin.WMSService.supportedMatrixSets(this.get('matrix_sets') || []);
      return supportedMatrixSets.length > 0;
    }
    return true;
  },

  _createProxiedLayer: function() {
    var self = this;
    var w = new cdb.admin.WMSService({
      wms_url: this.url(),
      title: this.get('title'),
      name: this.get('name'),
      layer: this.get('name'),
      srs: this.get('srs'),
      bounding_boxes: this.get('llbbox'),
      type: this.get('type'), // wms/wmts
      matrix_sets: this.get('matrix_sets')
    });

    // Event tracking "WMS layer selected"
    cdb.god.trigger('metrics', 'select_wms', {
      email: window.user_data.email
    });

    var self = this;
    w.save({}, {
      success: function(m) {
        var tileLayer;
        try {
          tileLayer = m.newTileLayer();
        } catch(e) {
        }
        if (tileLayer) {
          self._setNewTileLayer(tileLayer);
        } else {
          self.set('state', 'saveFail');
        }
      },
      error: function() {
        self.set('state', 'saveFail');
      }
    });

    return w;
  },

  _setNewTileLayer: function(tileLayer) {
    this.set({
      state: 'saveDone',
      tileLayer: tileLayer
    });
  },

  _newTileLayer: function() {
    var tileLayer = cdb.admin.TileLayer.byCustomURL(this._xyzURLTemplate(), false);
    tileLayer.set({
      name: this.get('title') || this.get('name'),
      attribution: this.get('attribution'),
      bounding_boxes: this.get('llbbox')
    });
    this._setNewTileLayer(tileLayer);
    return tileLayer;
  },

  _xyzURLTemplate: function() {
    var urlTemplate = this.get('url_template') || '';
    // Convert the proxy template variables to XYZ format, http://foo.com/bar/%%(z)s/%%(x)s/%%(y)s.png"
    return urlTemplate.replace(/%%\((\w)\)s/g, '{$1}');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],36:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View for an individual layer item.
 */
module.exports = cdb.core.View.extend({

  tagName: 'li',
  className: 'List-row',

  events: {
    'click .js-add': '_onClickAdd'
  },

  render: function() {
    this.$el.html(
      cdb.templates.getTemplate('common/dialogs/add_custom_basemap/wms/layer')({
        model: this.model,
        canSave: this.model.canSave(this.options.baseLayers)
      })
    );
    return this;
  },

  _onClickAdd: function(ev) {
    this.killEvent(ev);
    if (this.model.canSave(this.options.baseLayers)) {
      this.model.save();
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],37:[function(require,module,exports){
(function (global){
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var LayerModel = require('./layer_model.js');

module.exports = Backbone.Collection.extend({

  model: LayerModel,

  fetch: function(url, callback) {
    this.url = url;

    var wmsService = new cdb.admin.WMSService({
      wms_url: url
    });

    var self = this;
    wmsService.fetch().always(function() {
      self.reset(wmsService.get('layers'));
      self.each(function(model) {
        model.set('type', wmsService.get('type')); // wms/wmts
      });
      callback();
    });
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./layer_model.js":35}],38:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var pluralizeStr = require('../../../view_helpers/pluralize_string');
var LayerView = require('./layer_view.js');

/**
 * Sub view, to select what layer to use as basemap.
 */
module.exports = cdb.core.View.extend({

  events: {
    'click .js-back': '_onClickBack'
  },

  render: function() {

    this.clearSubViews();

    var $el = $(
      cdb.templates.getTemplate('common/dialogs/add_custom_basemap/wms/select_layer')({
        searchQuery: this.model.get('searchQuery'),
        layersFound: this.model.getLayers(),
        layersAvailableCount: this.model.layersAvailableCount(),
        pluralizeStr: pluralizeStr
      })
    );
    var $list = $el.find('.js-layers');
    $list.append.apply($list, this._renderedLayers());
    this.$el.html($el);
    return this;
  },

  _renderedLayers: function() {
    return this.model.getLayers().map(function(layer) {
      var view = new LayerView({
        model: layer,
        baseLayers: this.model.get('baseLayers')
      });
      this.addView(view);
      return view.render().el;
    }, this);
  },

  _onClickBack: function(ev) {
    this.killEvent(ev);
    this.model.set('currentView', 'enterURL');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../view_helpers/pluralize_string":211,"./layer_view.js":36}],39:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var WMSView = require('./wms_view.js');
var LayersCollection = require('./layers_collection.js');

/**
 * View model for WMS/WMTS tab content.
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    name: 'wms',
    label: 'WMS/WMTS',
    currentView: 'enterURL', // [fetchingLayers, selectLayer, savingLayer]
    layersFetched: false,
    layers: undefined,
    baseLayers: undefined // expected when instantiated
  },

  initialize: function() {
    this.elder('initialize');
    this.set('layers', new LayersCollection());
    this._initBinds();
  },

  createView: function() {
    this.set({
      currentView: 'enterURL',
      layersFetched: false
    });
    return new WMSView({
      model: this
    });
  },

  fetchLayers: function(url) {
    this.set('currentView', 'fetchingLayers');
    var self = this;
    this.get('layers').fetch(url, function() {
      self.set({
        currentView: self.get('layers').length > 0 ? 'selectLayer' : 'enterURL',
        layersFetched: true
      });
    });
  },

  layersAvailableCount: function() {
    return _.difference(
      this.get('layers').pluck('title'),
      this.get('baseLayers').pluck('name')
    ).length;
  },

  get: function(name) {
    if (name === 'layer') {
      return this.get('layers')
        .find(function(m) {
          return m.get('state') === 'saveDone';
        })
        .get('tileLayer');
    } else {
      return cdb.core.Model.prototype.get.apply(this, arguments);
    }
  },

  getLayers: function() {
    if (this.get("searchQuery")) {
      var regExp = new RegExp(this.get("searchQuery"), 'i');
      return this.get("layers").filter(function(layer) {
        return layer.get("name").match(regExp);
      }, this);
    } else {
      return this.get("layers");
    }
  },

  hasAlreadyAddedLayer: function() {
    // Already added layers are disabled to be saved for each layer
    return false;
  },

  _initBinds: function() {
    this.get('layers').bind('change:state', this._onLayerStateChange, this);
  },

  _onLayerStateChange: function(_, newState) {
    switch (newState) {
      case 'saving':
        this.set('currentView', 'savingLayer');
        break;
      case 'saveDone':
        this.trigger('saveBasemap');
        break;
      case 'saveFail':
      this.set('currentView', 'saveFail');
        break;
      default:
        this.set('currentView', 'selectLayer');
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./layers_collection.js":37,"./wms_view.js":40}],40:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var randomQuote = require('../../../view_helpers/random_quote.js');
var SelectLayerView = require('./select_layer_view.js');
var ViewFactory = require('../../../view_factory.js');

/**
 * Represents the WMS/WMTS tab category.
 * Current state is defined by presence (or lack of) layers
 */
module.exports = cdb.core.View.extend({

  events: {
    'keydown .js-search-input': '_onKeyDown',
    'submit .js-search-form': 'killEvent',
    'keydown .js-url': '_update',
    'paste .js-url': '_update',
    'click .js-fetch-layers': '_onClickFetchLayers',
    'click .js-clean-search': '_onCleanSearchClick',
    'click .js-search-link': '_submitSearch'
  },

  initialize: function() {
    this.elder('initialize');
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();
    var view;

    switch (this.model.get('currentView')) {
      case 'savingLayer':
        view = ViewFactory.createByTemplate('common/templates/loading', {
          title: 'Saving layer…',
          quote: randomQuote()
        });
        break;
      case 'selectLayer':
        view = new SelectLayerView({
          model: this.model
        });
        break;
      case 'saveFail':
        view = ViewFactory.createByTemplate('common/templates/fail', {
          msg: ''
        });
        break;
      case 'fetchingLayers':
        view = ViewFactory.createByTemplate('common/templates/loading', {
          title: 'Fetching layers…',
          quote: randomQuote()
        });
        break;
      case 'enterURL':
      default:
        view = ViewFactory.createByTemplate('common/dialogs/add_custom_basemap/wms/enter_url', {
          layersFetched: this.model.get('layersFetched'),
          layers: this.model.get('layers')
        });
        break;
    }
    this.addView(view);
    this.$el.append(view.render().el);

    this.$(".js-search-input").focus();

    return this;
  },

  _showCleanSearchButton: function() {
    this.$('.js-clean-search').show();
  },

  _hideCleanSearchButton: function() {
    this.$('.js-clean-search').hide();
  },

  _initBinds: function() {
    this.model.bind('change', this.render, this);
    this.model.bind('change', this._onChangeSearchQuery, this);
    this.model.get("layers").bind('reset', this.render, this);
  },

  _update: function(ev) {
    ev.stopPropagation();
    this._debouncedUpdate();
  },

  _debouncedUpdate: _.debounce(function() {
    this._enableFetchLayersButton(!!this.$('.js-url').val());
    this.$('.js-error').removeClass('is-visible'); // resets error state when changed
  }, 100),

  _enableFetchLayersButton: function(enable) {
    this.$('.js-fetch-layers')[ enable ? 'removeClass' : 'addClass' ]('is-disabled');
  },

  _onKeyDown: function(ev) {
    var enterPressed = (ev.keyCode == $.ui.keyCode.ENTER);
    if (enterPressed) {
      this.killEvent(ev);
      this._submitSearch();
    } 
  },

  _submitSearch: function(ev) {
    this.killEvent(ev);

    this.model.set("searchQuery", this.$(".js-search-input").val());
  },

  _onChangeSearchQuery: function() {

    var searchQuery = this.model.get("searchQuery");

    if (!searchQuery) {
      this._hideCleanSearchButton();
    }
  
  },

  _onCleanSearchClick: function(ev) {
    this.killEvent(ev);
    this.model.set("searchQuery", "");
  },

  _onClickFetchLayers: function(ev) {
    this.killEvent(ev);
    var url = this.$('.js-url').val();
    if (url) {
      this.model.fetchLayers(url);
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../view_factory.js":209,"../../../view_helpers/random_quote.js":212,"./select_layer_view.js":38}],41:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var XYZView = require('./xyz_view');

/**
 * View model for XYZ tab content.
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    name: 'xyz',
    label: 'XYZ',
    tms: false,
    layer: undefined // will be set when valid
  },

  createView: function() {
    return new XYZView({
      model: this
    });
  },

  hasAlreadyAddedLayer: function(baseLayers) {
    var urlTemplate = this.get('layer').get('urlTemplate');
    return _.any(baseLayers.custom(), function(customLayer) {
      return customLayer.get('urlTemplate') === urlTemplate;
    });
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./xyz_view":42}],42:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 * Represents the XYZ tab content.
 */
module.exports = cdb.core.View.extend({

  className: 'XYZPanel',

  events: {
    'click .js-tms': '_changeTMS',
    'keydown .js-url': '_update',
    'paste .js-url': '_update'
  },

  initialize: function() {
    this.elder('initialize');
    this._lastCallSeq = 0;
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();
    this.$el.html(
      cdb.templates.getTemplate('common/dialogs/add_custom_basemap/xyz/xyz')({
      })
    );
    this._initViews();
    return this;
  },

  _initViews: function() {
    // Add TMS tooltip
    var tooltip = new cdb.common.TipsyTooltip({
      el: this.$('.js-tms'),
      title: function() {
        return $(this).data('title')
      }
    })
    this.addView(tooltip);
  },

  _initBinds: function() {
    this.model.bind('change:tms', this._setTMSCheckbox, this);
  },

  _update: function(ev) {
    ev.stopPropagation();
    this._debouncedUpdate();
  },

  _changeTMS: function(ev) {
    this.model.set('tms', !this.model.get('tms'));
    this._update(ev);
  },

  _setTMSCheckbox: function(e) {
    this.$('.js-tms .Checkbox-input')[ this.model.get('tms') ? 'addClass' : 'removeClass' ]('is-checked');
  },

  _debouncedUpdate: _.debounce(function() {
    this._disableOkBtn(true);
    this._indicateIsValidating(true);
    var layer;
    var urlErrorMsg;

    var url = this.$('.js-url').val();
    var tms = this.model.get('tms');

    if (url) {
      try {
        layer = cdb.admin.TileLayer.byCustomURL(url, tms);
      } catch (e) {
        urlErrorMsg = 'It does not look like a valid XYZ URL';
      }
    }

    this.model.set('layer', layer);
    if (layer) {
      var self = this;
      // Make sure only the last call made is the one that defines view change,
      // avoids laggy responses to indicate wrong state
      var thisCallSeq = ++this._lastCallSeq;
      layer.validateTemplateURL({
        success: function() {
          if (thisCallSeq === self._lastCallSeq) {
            self._disableOkBtn(false);
            self._indicateIsValidating(false);
            self._updateError();
          }
        },
        error: function() {
          if (thisCallSeq === self._lastCallSeq) {
            self._disableOkBtn(false);
            self._indicateIsValidating(false);
            // Note that this text can not be longer, or it will exceed available space of the error label.
            self._updateError("We couldn't validate this, if you're sure it contains data click \"add basemap\"");
          }
        }
      });
    } else if (url) {
      this._indicateIsValidating(false);
      this._updateError(urlErrorMsg);
    } else {
      this._indicateIsValidating(false);
      this._updateError();
    }
  }, 150),

  _setTMS: function(ev) {
    var $checkbox = $(ev.target).closest('.Checkbox');
    $checkbox.find('.Checkbox-input').toggleClass('is-checked');
    this._update(ev);
  },

  _disableOkBtn: function(disable) {
    this.$('.ok')[ disable ? 'addClass' : 'removeClass' ]('is-disabled');
  },

  _updateError: function(msg) {
    this.$('.js-error').text(msg)[ msg ? 'addClass' : 'removeClass' ]('is-visible');
  },

  _indicateIsValidating: function(indicate) {
    if (indicate) {
      this.$('.js-validating').show();
    } else {
      this.$('.js-validating').hide();
    }
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],43:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

module.exports = BaseDialog.extend({

  events: function () {
    return _.extend({}, BaseDialog.prototype.events, {
      'click .js-ok': '_continue'
    });
  },

  initialize: function () {
    this.elder('initialize');
    this.template = cdb.templates.getTemplate('common/dialogs/builder_features_warning/template');
  },

  render_content: function () {
    return this.template({

    });
  },

  _continue: function () {
    this.close();
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../views/base_dialog/view":213}],44:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var pluralizeString = require('../../view_helpers/pluralize_string');
var randomQuote = require('../../view_helpers/random_quote');

/**
 * Lock/unlock datasets/maps dialog.
 */
module.exports = BaseDialog.extend({

  events: function() {
    return _.extend({}, BaseDialog.prototype.events, {
      'click .js-ok': '_ok'
    });
  },

  initialize: function() {
    this.elder('initialize');
    this.options.template = this.options.template || cdb.templates.getTemplate('common/dialogs/change_lock/templates/dashboard');
    this.model.bind('change', function() {
      if (this.model.get('state') === 'ProcessItemsDone') {
        this.close();
      } else {
        this.render();
      }
    }, this);
  },

  /**
   * @implements cdb.ui.common.Dialog.prototype.render_content
   */
  render_content: function() {
    return this['_render' + this.model.get('state')]();
  },

  _renderConfirmChangeLock: function() {
    // An entity can be an User or Organization
    var itemsCount = this.model.get('items').length;
    var areLocked = this.model.get('initialLockValue');

    return this.options.template({
      model: this.model,
      itemsCount: itemsCount,
      ownerName: this.options.ownerName,
      isOwner: this.options.isOwner,
      thisOrTheseStr: itemsCount === 1 ? 'this' : 'these',
      itOrThemStr: itemsCount === 1 ? 'it' : 'them',
      areLocked: areLocked,
      positiveOrNegativeStr: areLocked ? 'positive' : 'alert',
      lockOrUnlockStr: areLocked ? 'unlock' : 'lock',
      contentTypePluralized: pluralizeString(
        this.model.get('contentType') === 'datasets' ? 'dataset' : 'map', //singular
        this.model.get('contentType'), // plural
        itemsCount
      )
    });
  },

  /**
   * @overrides BaseDialog.prototype._ok
   */
  _ok: function(e) {
    this.killEvent(e);
    this.model.inverseLock();
    this.render();
  },

  _renderProcessingItems: function() {
    var lockingOrUnlockingStr = this.model.get('initialLockValue') ? 'Unlocking' : 'Locking';
    return cdb.templates.getTemplate('common/templates/loading')({
      title: lockingOrUnlockingStr + ' ' + pluralizeString(this.model.get('contentType') === 'datasets' ? 'dataset' : 'map', this.model.get('items').length) + '…',
      quote: randomQuote()
    });
  },

  _renderProcessItemsFail: function() {
    var lockingOrUnlockingStr = this.model.get('initialLockValue') ? 'unlock' : 'lock';
    return cdb.templates.getTemplate('common/templates/fail')({
      msg: 'Failed to ' + lockingOrUnlockingStr + ' all items'
    });
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_helpers/pluralize_string":211,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213}],45:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var batchProcessItems = require('../../batch_process_items');

/**
 * View model for change lock view.
 * Manages the life cycle states for the change lock view.
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    state: 'ConfirmChangeLock',
    initialLockValue: false,
    contentType: 'datasets',
    items: undefined // a Backbone collection
  },

  initialize: function(attrs) {
    this.elder('initialize');
    this.set('items', new Backbone.Collection(attrs.items));
    if (this.get('items').chain().map(function(item) { return item.get('locked'); }).uniq().value().length > 1) {
      var errorMsg = 'It is assumed that all items have the same locked state, a user should never be able to ' +
        'select a mixed item with current UI. If you get an error with this message something is broken';
      if (window.trackJs && window.trackJs.track) {
        window.trackJs.track(errorMsg);
      } else {
        throw new Error(errorMsg);
      }
    }

    this.set('initialLockValue', this.get('items').at(0).get('locked'));
  },

  inverseLock: function() {
    this.set('state', 'ProcessingItems');

    batchProcessItems({
      howManyInParallel: 5,
      items: this.get('items').toArray(),
      processItem: this._lockItem.bind(this, !this.get('initialLockValue')),
      done: this.set.bind(this, 'state', 'ProcessItemsDone'),
      fail: this.set.bind(this, 'state', 'ProcessItemsFail')
    });
  },

  _lockItem: function(newLockedValue, item, callback) {
    item.save({ locked: newLockedValue })
      .done(function() {
        callback();
      })
      .fail(function() {
        callback('something failed');
      });
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../batch_process_items":24}],46:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var StartView = require('./start_view');
var PrivacyOptions = require('./options_collection');
var BaseDialog = require('../../views/base_dialog/view');
var randomQuote = require('../../view_helpers/random_quote');
var ViewFactory = require('../../view_factory');
var ShareView = require('./share/share_view');

/**
 * Change privacy datasets/maps dialog.
 */
var ChangePrivacyView = BaseDialog.extend({

  initialize: function() {
    this.elder('initialize');
    this._privacyOptions = PrivacyOptions.byVisAndUser(this.options.vis, this.options.user);
    this._initViews();
    this._initBinds();
  },

  /**
   * @implements cdb.ui.common.Dialog.prototype.render_content
   */
  render_content: function() {
    return this._panes.getActivePane().render().el;
  },

  ok: function() {
    var selectedOption = this._privacyOptions.selectedOption();
    if (!selectedOption.canSave()) {
      return;
    }

    var self = this;
    this._panes.active('saving');
    selectedOption.saveToVis(this.options.vis, {
      success: function() {
        self.close();
      },
      error: function() {
        self._panes.active('saveFail');
      }
    });
  },

  _initViews: function() {
    this._panes = new cdb.ui.common.TabPane({
      el: this.el
    });
    this.addView(this._panes);
    this._panes.addTab('start',
      new StartView({
        privacyOptions: this._privacyOptions,
        user: this.options.user,
        vis: this.options.vis
      })
    );
    this._panes.addTab('saving',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Saving privacy…',
        quote: randomQuote()
      }).render()
    );
    this._panes.addTab('saveFail',
      ViewFactory.createByTemplate('common/templates/fail', {
        msg: ''
      }).render()
    );
    this._panes.active('start');
  },

  _initBinds: function() {
    this._panes.bind('tabEnabled', this.render, this);
    this._panes.getPane('start').bind('clickedShare', this._openShareDialog, this);
  },

  _openShareDialog: function() {
    var view = new ShareView({
      clean_on_hide: true,
      enter_to_confirm: true,
      user: this.options.user,
      vis: this.options.vis,
      ChangePrivacyView: ChangePrivacyView
    });

    // Order matters, close this dialog before appending the share one, for side-effects to work as expected (body.is-inDialog)
    this.close();
    view.appendToBody();
  }
});

module.exports = ChangePrivacyView;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213,"./options_collection":48,"./share/share_view":55,"./start_view":57}],47:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 * Default model for a privacy option.
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    privacy: 'PUBLIC',
    disabled: false,
    selected: false,
    password: undefined
  },

  validate: function(attrs) {
    if (attrs.disabled && attrs.selected) {
      return 'Option can not be disabled and selected at the same time';
    }
  },

  classNames: function() {
    return _.chain(['disabled', 'selected'])
      .map(function(attr) { return !!this.attributes[attr] ? 'is-'+attr : undefined; }, this)
      .compact().value().join(' ');
  },

  canSave: function() {
    return !this.get('disabled');
  },

  /**
   * @param vis {Object} instance of cdb.admin.Visualization
   * @param callbacks {Object}
   */
  saveToVis: function(vis, callbacks) {
    return vis.save(this._attrsToSave(), _.extend({ wait: true }, callbacks));
  },

  /**
   * @returns {Object} attrs
   * @protected
   */
  _attrsToSave: function() {
    return _.pick(this.attributes, 'privacy', 'password');
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],48:[function(require,module,exports){
(function (global){
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var OptionModel = require('./option_model');
var PasswordOptionModel = require('./password_option_model');

/**
 * type property should match the value given from the API.
 */
var ALL_OPTIONS = [{
  privacy: 'PUBLIC',
  illustrationType: 'positive',
  iconFontType: 'unlock',
  title: 'Public',
  desc: 'Everyone can view and download it',
  alwaysEnable: true
}, {
  privacy: 'LINK',
  illustrationType: 'alert',
  iconFontType: 'unlock',
  title: 'With link',
  desc: 'Only the people with the link can view it'
}, {
  privacy: 'PASSWORD',
  illustrationType: 'alert',
  iconFontType: 'unlockWithEllipsis',
  title: 'Password protected',
  desc: 'Only the people with the password can view it'
}, {
  privacy: 'PRIVATE',
  illustrationType: 'negative',
  iconFontType: 'lock',
  title: 'Private',
  desc: 'Only you can access it'
}];


/**
 * Collection that holds the different privacy options.
 */
module.exports = Backbone.Collection.extend({

  model: function(attrs, options) {
    if (attrs.privacy === 'PASSWORD') {
      return new PasswordOptionModel(attrs, options);
    } else {
      return new OptionModel(attrs, options);
    }
  },

  initialize: function() {
    this.bind('change:selected', this._deselectLastSelected, this)
  },

  selectedOption: function() {
    return this.find(function(option) {
      return option.get('selected');
    })
  },

  passwordOption: function() {
    return this.find(function(option) {
      return option.get('privacy') === 'PASSWORD';
    })
  },

  _deselectLastSelected: function(m, isSelected) {
    if (isSelected) {
      this.each(function(option) {
        if (option !== m) {
          option.set({selected: false}, {silent: true});
        }
      });
    }
  }

}, { // Class properties:

  /**
   * Get a privacy options collection from a Vis model
   *
   * Note that since the user's permissions should change very seldom, it's reasonable to assume they will be static for
   * the collection's lifecycle, so set them on the models attrs when creating the collection.
   * collection is created.
   *
   * @param vis {Object} instance of cdb.admin.Visualization
   * @param user {Object} instance of cdb.admin.User
   * @returns {Object} instance of this collection
   */
  byVisAndUser: function(vis, user) {
    var canSelectPremiumOptions = user.get('actions')[ vis.isVisualization() ? 'private_maps' : 'private_tables' ];
    var currentPrivacy = vis.get('privacy');
    var availableOptions = vis.privacyOptions();

    return new this(
      _.chain(ALL_OPTIONS)
        .filter(function(option) {
          return _.contains(availableOptions, option.privacy);
        })
        .map(function(option) {
          // Set state that depends on vis and user attrs, they should not vary during the lifecycle of this collection
          return _.defaults({
            selected: option.privacy === currentPrivacy,
            disabled: !(option.alwaysEnable || canSelectPremiumOptions)
          }, option)
        })
        .value()
    );
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./option_model":47,"./password_option_model":49}],49:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var OptionModel = require('./option_model');

/**
 * View model for the special privacy option representing a password protected map.
 * It handles the logic related to the password that needs to be set for the option.
 */
var PasswordOptionModel = OptionModel.extend({
  
  initialize: function() {
    OptionModel.prototype.initialize.apply(this, arguments);

    // Initially a default fake password is set, but if option is selected (like switching option) it's reset
    this.set('password', PasswordOptionModel.DEFAULT_FAKE_PASSWORD);
  },

  /**
   * @override OptionModel.attrsToSave
   */
  _attrsToSave: function() {
    var attrs = OptionModel.prototype._attrsToSave.call(this);
    
    if (attrs.password === PasswordOptionModel.DEFAULT_FAKE_PASSWORD) {
      delete attrs.password;
    }
    
    return attrs;
  }, 
  
  canSave: function() {
    return OptionModel.prototype.canSave.call(this) && !_.isEmpty(this.get('password'));
  }
  
}, {
  
  DEFAULT_FAKE_PASSWORD: '!@#!@#'
  
});

module.exports = PasswordOptionModel;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./option_model":47}],50:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var PermissionView = require('./permission_view');
var UserDetailsView = require('./user_details_view');
var GroupDetailsView = require('./group_details_view');
var ViewFactory = require('../../../view_factory');

/**
 * Content view of the share dialog, lists of users to share item with.
 * - model: {Object} the share view model
 * - collection: {cdb.admin.Grantables}
 * - hasSearch: {Boolean}
 */
module.exports = cdb.core.View.extend({

  initialize: function() {
    _.each(['model', 'collection', 'pagedSearchModel'], function(name) {
      if (_.isUndefined(this.options[name])) throw new Error(name + ' is required');
    }, this);

    this._initBinds();
  },

  render: function() {
    this.clearSubViews();
    this.$el.empty();

    if (!this.options.pagedSearchModel.get('q')) {
      this._renderOrganizationPermissionView()
    }
    this._renderGrantablesViews();
    return this;
  },

  _initBinds: function() {
    this.collection.bind('reset', this.render, this);
    this.add_related_model(this.collection);

    this.options.pagedSearchModel.on('change:q', this.render, this);
    this.add_related_model(this.options.pagedSearchModel);
  },

  _renderGrantablesViews: function() {
    var dependentVisualizations = this.model.get('vis').tableMetadata().dependentVisualizations();
    this.collection.each(function(grantable) {
      this._appendView(
        new PermissionView({
          model: grantable.entity,
          permission: this.model.get('permission'),
          isWriteAccessTogglerAvailable: this.model.isWriteAccessTogglerAvailable(),
          detailsView: this._createDetailsView(
            this._detailsViewOpts.bind(this, dependentVisualizations, grantable.entity),
            grantable
          )
        })
      )
    }, this);
  },

  _renderOrganizationPermissionView: function() {
    this._appendView(
      new PermissionView({
        model: this.model.get('organization'),
        permission: this.model.get('permission'),
        isWriteAccessTogglerAvailable: this.model.isWriteAccessTogglerAvailable(),
        detailsView: ViewFactory.createByTemplate('common/dialogs/change_privacy/share/details', {
          avatarUrl: false,
          willRevokeAccess: false,
          title: 'Default settings for your Organization',
          desc: 'New users will have this permission',
          roleLabel: false
        }, {
          className: 'ChangePrivacy-shareListItemInfo'
        })
      })
    );
  },

  _appendView: function(view) {
    this.$el.append(view.render().el);
    this.addView(view);
  },

  _createDetailsView: function(detailsViewOpts, grantable) {
    var type = grantable.get('type');
    switch(type) {
      case 'user':
        return new UserDetailsView(
          detailsViewOpts([grantable.id])
        );
        break;
      case 'group':
        return new GroupDetailsView(
          detailsViewOpts(
            grantable.entity.users.chain()
              .reject(this._isCurrentUser)
              .pluck('id')
              .value()
          )
        );
        break;
      default:
        cdb.log.error('No details view for grantable model of type ' + type);
        return new cdb.core.View(detailsViewOpts());
    }
  },

  _detailsViewOpts: function(dependentVisualizations, grantableEntity, userIds) {
    return {
      className: 'ChangePrivacy-shareListItemInfo',
      model: grantableEntity,
      permission: this.model.get('permission'),
      isUsingVis: _.any(dependentVisualizations, function(vis) {
        return _.any(userIds, function(userId) {
          return userId === vis.permission.owner.id;
        })
      })
    };
  },

  _isCurrentUser: function(user) {
    return user.id === cdb.config.get('user').id;
  },

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../view_factory":209,"./group_details_view":51,"./permission_view":53,"./user_details_view":56}],51:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var pluralizeString = require('../../../view_helpers/pluralize_string')

module.exports = cdb.core.View.extend({

  initialize: function() {
    _.each(['permission', 'isUsingVis'], function(name) {
      if (_.isUndefined(this.options[name])) throw new Error(name + ' is required');
    }, this);
  },

  render: function() {
    this.$el.html(
      this.getTemplate('common/dialogs/change_privacy/share/details')({
        willRevokeAccess: this._willRevokeAccess(),
        avatarUrl: this.model.get('avatar_url'),
        title: this.model.get('display_name'),
        desc: this._desc(),
        roleLabel: false
      })
    );
    return this;
  },

  _desc: function() {
    var usersCount = this.model.users.length;
    var xMembers = pluralizeString.prefixWithCount('member', 'members', usersCount);

    if (this._willRevokeAccess()) {
      return xMembers + '. ' + pluralizeString("Member's", "Members'", usersCount) + ' maps will be affected';
    } else if (this.options.isUsingVis) {
      return xMembers + '. ' + pluralizeString('Member is', 'Members are', usersCount) + ' using this dataset';
    } else {
      return xMembers;
    }
  },

  _willRevokeAccess: function() {
    return this.options.isUsingVis && !this.options.permission.hasReadAccess(this.model);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../view_helpers/pluralize_string":211}],52:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View for an individual access toggler.
 */
module.exports = cdb.core.View.extend({

  tagName: 'span',

  events: {
    'mouseover .js-toggler.is-disabled': '_onHoverDisabledToggler',
    'mouseout .js-toggler': '_closeTooltip',
    'mouseleave .js-toggler': '_closeTooltip',
    'change .js-input': '_onChangeInput'
  },

  initialize: function() {
    _.each(['model', 'permission', 'hasAccess', 'canChangeAccess', 'toggleAccess', 'label'], function(name) {
      if (_.isUndefined(this.options[name])) throw new Error(name + ' is required');
    }, this);
  },

  render: function() {
    this.clearSubViews();
    this.$el.html(
      cdb.templates.getTemplate('common/dialogs/change_privacy/share/permission_toggler')({
        cid: this.cid,
        hasAccess: this.options.hasAccess(),
        canChangeAccess: this.options.canChangeAccess(),
        label: this.options.label
      })
    );
    return this;
  },

  _onChangeInput: function() {
    this.options.toggleAccess();
  },

  _onHoverDisabledToggler: function(ev) {
    var aclItem = this.options.permission.findRepresentableAclItem(this.model);
    if (aclItem && !aclItem.isOwn(this.model)) {
      this._tooltipView().showTipsy();
    }
  },

  _closeTooltip: function() {
    this._tooltipView().hideTipsy();
  },

  _tooltipView: function(el) {
    if (!this._tooltip) {
      this._tooltip = this._newTooltipView();
      this.addView(this._tooltip);
    }
    return this._tooltip;
  },

  _newTooltipView: function(el) {
    return new cdb.common.TipsyTooltip({
      el: this.$('.js-toggler'),
      trigger: 'manual',
      title: this._inheritedAccessTooltipText.bind(this)
    });
  },

  _inheritedAccessTooltipText: function() {
    var aclItem = this.options.permission.findRepresentableAclItem(this.model);
    var type = aclItem.get('type');
    switch(type) {
      case 'group':
        return 'Access is inherited from group ' + aclItem.get('entity').get('name');
      case 'org':
        return 'Access is inherited from organization';
      default:
        cdb.log.error('Trying to display inherited access for an unrecognized type ' + type)
        return ''
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],53:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var PermissionTogglerview = require('./permission_toggler_view');
var ViewFactory = require('../../../view_factory');

/**
 * View to change permission for a given model.
 */
module.exports = cdb.core.View.extend({

  className: 'ChangePrivacy-shareListItem',

  initialize: function() {
    _.each(['model', 'permission', 'isWriteAccessTogglerAvailable', 'detailsView'], function(name) {
      if (_.isUndefined(this.options[name])) throw new Error(name + ' is required');
    }, this);

    this._initBinds();
  },

  _initBinds: function() {
    this.options.permission.acl.bind('add remove reset change', this.render, this);
    this.add_related_model(this.options.permission);
  },

  render: function() {
    this.clearSubViews();
    this._renderDetails();
    this._renderAccessTogglers();
    return this;
  },

  _renderDetails: function() {
    this._renderView(this.options.detailsView);
  },

  _renderAccessTogglers: function() {
    var togglers = [
      this._newReadToggler()
    ];

    if (this.options.isWriteAccessTogglerAvailable) {
      togglers.unshift(this._newWriteToggler());
    }

    this._renderView(ViewFactory.createByList(togglers));
  },

  _newWriteToggler: function() {
    var p = this.options.permission;
    return new PermissionTogglerview({
      className: 'ChangePrivacy-shareListItemTogglerContainer',
      model: this.model,
      permission: p,
      label: 'Write',
      hasAccess: p.hasWriteAccess.bind(p, this.model),
      canChangeAccess: p.canChangeWriteAccess.bind(p, this.model),
      toggleAccess: this._toggleWrite.bind(this)
    });
  },

  _newReadToggler: function() {
    var p = this.options.permission;
    return new PermissionTogglerview({
      model: this.model,
      permission: p,
      label: 'Read',
      hasAccess: p.hasReadAccess.bind(p, this.model),
      canChangeAccess: p.canChangeReadAccess.bind(p, this.model),
      toggleAccess: this._toggleRead.bind(this)
    });
  },

  _renderView: function(view) {
    this.addView(view);
    this.$el.append(view.render().el)
  },

  _toggleWrite: function() {
    var p = this.options.permission;
    if (p.canChangeWriteAccess(this.model)) {
      if (p.hasWriteAccess(this.model)) {
        p.revokeWriteAccess(this.model);
      } else {
        p.grantWriteAccess(this.model);
      }
    }
  },

  _toggleRead: function() {
    var p = this.options.permission;
    if (p.canChangeReadAccess(this.model)) {
      if (p.hasReadAccess(this.model)) {
        p.revokeAccess(this.model);
      } else {
        p.grantReadAccess(this.model);
      }
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../view_factory":209,"./permission_toggler_view":52}],54:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 * View model for a share view modal.
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    vis: undefined,
    permission: undefined,
    organization: undefined
  },

  initialize: function(attrs) {
    if (!attrs.vis) throw new Error('vis is required');
    if (!attrs.organization) throw new Error('organization is required');

    var vis = this.get('vis');
    this.set('permission', vis.permission.clone());

    if (!vis.isVisualization()) {
      var self = this;
      vis.tableMetadata().fetch({
        silent: true,
        success: function() {
          self.trigger('all');
        }
      });
    }
  },

  name: function() {
    return this.get('vis').get('name');
  },

  isWriteAccessTogglerAvailable: function() {
    return !this.get('vis').isVisualization();
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],55:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var BaseDialog = require('../../../views/base_dialog/view');
var randomQuote = require('../../../view_helpers/random_quote');
var ViewFactory = require('../../../view_factory');
var PagedSearchModel = require('../../../paged_search_model');
var PagedSearchView = require('../../../views/paged_search/paged_search_view');
var ShareModel = require('./share_model');
var GrantablesView = require('./grantables_view');

/**
 * Dialog to share item with other users in organization.
 */
module.exports = BaseDialog.extend({

  events: BaseDialog.extendEvents({
    'click .js-back': '_openChangePrivacy'
  }),

  initialize: function() {
    if (!this.options.ChangePrivacyView) throw new Error('ChangePrivacyView is required');
    this.user = this.options.user;
    this.organization = this.user.organization;
    this.model = new ShareModel({
      vis: this.options.vis,
      organization: this.organization
    });
    this.elder('initialize');
    this._initViews();
    this._initBinds();
  },

  render: function() {
    BaseDialog.prototype.render.apply(this, arguments);
    this.$('.content').addClass('Dialog-content--expanded');
    return this;
  },

  // @implements cdb.ui.common.Dialog.prototype.render_content
  render_content: function() {
    return [
      this._htmlNode(
        cdb.templates.getTemplate('common/dialogs/change_privacy/share/share_header')({
          name: this.options.vis.get('name')
        })
      ),
      this._grantablesView.render().el,
      this._htmlNode(cdb.templates.getTemplate('common/dialogs/change_privacy/share/share_footer')())
    ];
  },

  // @implements cdb.ui.common.Dialog.prototype.ok
  ok: function() {
    var loadingView = ViewFactory.createDialogByTemplate('common/templates/loading', {
      title: 'Sharing…',
      quote: randomQuote()
    });
    loadingView.appendToBody();

    var permission = this.options.vis.permission;
    permission.overwriteAcl(this.model.get('permission'));
    permission.save()
      .always(function() {
        loadingView.close();
      })
      .fail(function() {
        var failView = ViewFactory.createDialogByTemplate('common/templates/fail', {
          msg: ''
        });
        failView.appendToBody();
      })
      .done(this._openChangePrivacy.bind(this));
  },

  _initViews: function() {
    var model = this.model;
    var grantables = this.organization.grantables;
    var pagedSearchModel = new PagedSearchModel({
      per_page: 50,
      order: 'name',
    });
    this._grantablesView = new PagedSearchView({
      isUsedInDialog: true,
      pagedSearchModel: pagedSearchModel,
      collection: grantables,
      createListView: function() {
        return new GrantablesView({
          model: model,
          collection: grantables,
          pagedSearchModel: pagedSearchModel
        })
      }
    });
  },

  _initBinds: function() {
    this.model.on('all', this._grantablesView.render, this._grantablesView);
  },

  _htmlNode: function(htmlStr) {
    return $(htmlStr)[0];
  },

  _openChangePrivacy: function() {
    var view = new this.options.ChangePrivacyView({
      clean_on_hide: true,
      enter_to_confirm: true,
      vis: this.options.vis,
      user: this.user
    });
    view.appendToBody();
    this.close();
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../paged_search_model":206,"../../../view_factory":209,"../../../view_helpers/random_quote":212,"../../../views/base_dialog/view":213,"../../../views/paged_search/paged_search_view":217,"./grantables_view":50,"./share_model":54}],56:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View for the user details to show in the context of a permission item.
 */
module.exports = cdb.core.View.extend({

  initialize: function() {
    _.each(['permission', 'isUsingVis'], function(name) {
      if (_.isUndefined(this.options[name])) throw new Error(name + ' is required');
    }, this);
  },

  render: function() {
    this.$el.html(
      this.getTemplate('common/dialogs/change_privacy/share/details')({
        willRevokeAccess: this._willRevokeAccess(),
        avatarUrl: this.model.get('avatar_url'),
        title: this.model.get('username'),
        desc: this._desc(),
        roleLabel: this.model.get('viewer') ? 'Viewer' : 'Builder'
      })
    );
    return this;
  },

  _desc: function() {
    var email = this.model.get('email')

    if (this._willRevokeAccess()) {
      return email + ". User's maps will be affected";
    } else if (this.options.isUsingVis) {
      return email + ". User is using this dataset";
    } else {
      return email;
    }
  },

  _willRevokeAccess: function() {
    return this.options.isUsingVis && !this.options.permission.hasReadAccess(this.model);
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],57:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var pluralizeStr = require('../../view_helpers/pluralize_string');

var DISABLED_SAVE_CLASS_NAME = 'is-disabled';
var SHARED_ENTITIES_SAMPLE_SIZE = 5;

/**
 * View represent the start screen when opening the privacy dialog.
 * Display privacy options and possibly a upgrade or share banner depending on user privileges.
 */
module.exports = cdb.core.View.extend({

  events: {
    'click .js-option': '_onClickOption',
    'click .js-share': '_onClickShare',
    'keyup .js-password-input': '_onKeyUpPasswordInput'
  },

  initialize: function () {
    this.elder('initialize');
    if (!this.options.privacyOptions) throw new Error('privacyOptions is required');
    if (!this.options.user) throw new Error('user is required');
    if (!this.options.vis) throw new Error('vis is required');
    this.template = cdb.templates.getTemplate('common/dialogs/change_privacy/start');
    this._initBinds();
  },

  render: function () {
    // Password might not be available (i.e. for changing privacy of a dataset)
    var pwdOption = this.options.privacyOptions.passwordOption();
    var password = pwdOption ? pwdOption.get('password') : '';

    var selectedOption = this.options.privacyOptions.selectedOption();
    var upgradeUrl = cdb.config.get('upgrade_url');
    var sharedEntities = this.options.vis.permission.getUsersWithAnyPermission();

    this.$el.html(
      this.template({
        vis: this.options.vis,
        privacyOptions: this.options.privacyOptions,
        password: password,
        saveBtnClassNames: selectedOption.canSave() ? '' : DISABLED_SAVE_CLASS_NAME,
        showUpgradeBanner: upgradeUrl && this.options.privacyOptions.any(function (o) { return !!o.get('disabled'); }),
        upgradeUrl: upgradeUrl,
        showTrial: this.options.user.canStartTrial(),
        showShareBanner: this.options.user.organization,
        sharedEntitiesCount: sharedEntities.length,
        personOrPeopleStr: pluralizeStr('person', 'people', sharedEntities.length),
        sharedEntitiesSampleCount: SHARED_ENTITIES_SAMPLE_SIZE,
        sharedEntitiesSample: _.take(sharedEntities, SHARED_ENTITIES_SAMPLE_SIZE),
        sharedWithOrganization: this.options.vis.permission.isSharedWithOrganization()
      })
    );

    this.delegateEvents();

    return this;
  },

  _initBinds: function () {
    this.options.privacyOptions.bind('change:selected change:disabled', this.render, this);
    this.options.privacyOptions.bind('change:password', this._onChangePassword, this);
    this.add_related_model(this.options.privacyOptions);
  },

  _onClickOption: function (ev) {
    var i = $(ev.target).closest('.js-option').data('index');
    var option = this.options.privacyOptions.at(i);

    if (!option.get('disabled')) {
      option.set('selected', true);
    }

    var pwdOption = this.options.privacyOptions.passwordOption();

    if ((option === pwdOption) && (!option.get('disabled'))) {
      this.$('.js-password-input')
        .val('') // reset any existing input value
        .focus()
        .keyup(); // manually trigger a key up event to change password state
    } else if (pwdOption) { // Password might not be available (i.e. for changing privacy of a dataset)
      this.$('.js-password-input').val(pwdOption.get('password'));
    }
  },

  _onChangePassword: function () {
    this.$('.ok').toggleClass(DISABLED_SAVE_CLASS_NAME, !this.options.privacyOptions.selectedOption().canSave());
  },

  _onKeyUpPasswordInput: function (ev) {
    this.options.privacyOptions.passwordOption().set('password', ev.target.value);
  },

  _onClickShare: function (ev) {
    this.killEvent(ev);
    this.trigger('clickedShare');
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_helpers/pluralize_string":211}],58:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var DatasetsView = require('./listing/datasets_view');
var ImportsView = require('./listing/imports_view');

/**
 *  Create listing view
 *
 *  It will display all the possibilities to select
 *  any of your current datasets or connect a new dataset.
 *
 */
module.exports = cdb.core.View.extend({

  className: 'CreateDialog-listing CreateDialog-listing--noPaddingTop',

  initialize: function() {
    this.user = this.options.user;
    this.createModel = this.options.createModel;
    this.template = cdb.templates.getTemplate('common/views/create/create_listing');

    // Bug with binding... do not work with the usual one for some reason :(
    this.createModel.bind('change:listing', this._onChangeListing.bind(this));
    this.add_related_model(this.createModel);
    this._onChangeListing();
  },

  render: function() {
    this.clearSubViews();
    this.$el.html(this.template());
    this._initViews();
    return this;
  },

  _onChangeListing: function() {
    if (this.listingPane) {
      this.listingPane.active(this.createModel.get('listing'));
    }
  },

  _initViews: function() {
    // Listing content pane
    this.listingPane = new cdb.ui.common.TabPane({
      el: this.$(".ListingContent")
    });
    this.addView(this.listingPane);

    // Datasets view
    var datasetsView = new DatasetsView({
      defaultUrl: this.user.viewUrl().dashboard().datasets(),
      user: this.user,
      createModel: this.createModel,
      routerModel: this.createModel.visFetchModel,
      collection: this.createModel.collection
    });

    datasetsView.render();
    this._addListingPane('datasets', datasetsView);

    // Imports view
    if (this.user.canCreateDatasets()) {
      var importsView = new ImportsView({
        user: this.user,
        createModel: this.createModel
      });

      importsView.render();
      this._addListingPane('import', importsView);
    }
  },

  _addListingPane: function(name, view) {
    this.listingPane.addTab(name, view, {
      active: this.createModel.get('listing') === name
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./listing/datasets_view":66,"./listing/imports_view":91}],59:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * Manages if upcoming import should guess or not.
 * Expected to be rendered in the footer of a create dialog.
 */
module.exports = cdb.core.View.extend({

  events: {
    'click .js-toggle': '_toggle'
  },

  initialize: function() {
    this.elder('initialize');
    this.user = this.options.user;
    this.createModel = this.options.createModel;
    this.template = cdb.templates.getTemplate('common/dialogs/create/footer/guessing_toggler');
    this._initBinds();
  },

  render: function() {
    var htmlStr = '';
    if (this.createModel.showGuessingToggler()) {
      htmlStr = this.template({
        isGuessingEnabled: this.model.get('guessing'),
        importState: this.createModel.getImportState(),
        isUploadValid: this.createModel.upload.isValidToUpload(),
        customHosted: cdb.config.get('cartodb_com_hosted'),
        isTwitterDeprecatedForUser: !this.user.hasOwnTwitterCredentials()        
      });
    }
    this.$el.html(htmlStr);
    return this;
  },

  _initBinds: function() {
    this.createModel.bind('change', this.render, this);
    this.model.bind('change', this.render, this);
    this.add_related_model(this.createModel);
  },

  _toggle: function() {
    var value = !this.model.get('guessing');
    this.model.set('guessing', value);
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],60:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 *  Change the privacy of the new dataset.
 *  - If the user can't change the privacy, it will refer to the upgrade page
 *   unless app is the "open source" version
 *
 */

module.exports = cdb.core.View.extend({
  events: {
    'click': '_onClick'
  },

  initialize: function () {
    this.elder('initialize');
    this.user = this.options.user;
    this.createModel = this.options.createModel;
    this.template = cdb.templates.getTemplate('common/dialogs/create/footer/privacy_toggler_template');
    this._initBinds();
  },

  render: function () {
    this.clearSubViews();
    this.$el.empty();

    if (this.createModel.showPrivacyToggler()) {
      var canChangePrivacy = this.user.canCreatePrivateDatasets();
      var privacy = this.model.get('privacy');
      var nextPrivacy = privacy === 'PUBLIC' ? 'PRIVATE' : 'PUBLIC';
      var icon = privacy === 'PUBLIC' ? 'unlock' : 'lock';
      var upgradeUrl = cdb.config.get('upgrade_url') || window.upgrade_url;
      var canUpgrade = !cdb.config.get('cartodb_com_hosted') && !canChangePrivacy && upgradeUrl;
      var connectDataset;

      if (this.createModel) {
        var option = this.createModel.getOption && this.createModel.getOption();
        var listingState = this.createModel.get('listing');
        var importState = this.createModel.getImportState && this.createModel.getImportState();

        connectDataset = option && option !== 'loading' &&
          option === 'listing' &&
          listingState === 'import' &&
          typeof importState === 'string' && importState !== 'scratch';
      }

      this.$el.html(
        this.template({
          privacy: privacy,
          isDisabled: !canChangePrivacy,
          canUpgrade: canUpgrade,
          nextPrivacy: nextPrivacy,
          upgradeUrl: upgradeUrl,
          icon: icon,
          connectDataset: connectDataset
        })
      );

      this._initViews();
    }

    return this;
  },

  _initBinds: function () {
    this.model.bind('change:privacy', this.render, this);
  },

  _initViews: function () {
    // Tooltip
    this.addView(
      new cdb.common.TipsyTooltip({
        el: this.$('.js-toggler'),
        html: true,
        title: function () {
          return $(this).attr('data-title');
        }
      })
    );
  },

  _onClick: function () {
    if (this.user.canCreatePrivateDatasets()) {
      var privacy = this.model.get('privacy');
      this.model.set('privacy', privacy === 'PUBLIC' ? 'PRIVATE' : 'PUBLIC');
      return;
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],61:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var randomQuote = require('../../../../../common/view_helpers/random_quote');

/*
 *  Content result default view
 */

module.exports = cdb.core.View.extend({

  events: {
    'click .js-connect': '_onConnectClick'
  },

  initialize: function() {
    if (!this.options.defaultUrl) {
      throw new Error('defaultUrl is required')
    }
    this.user = this.options.user;
    this.routerModel = this.options.routerModel;
    this.template = cdb.templates.getTemplate(this.options.template);

    this._initBinds();
  },

  render: function() {
    var type = this.routerModel.get('content_type');

    this.$el.html(this.template({
      defaultUrl:     this.options.defaultUrl,
      page:           this.routerModel.get('page'),
      tag:            this.routerModel.get('tag'),
      q:              this.routerModel.get('q'),
      shared:         this.routerModel.get('shared'),
      locked:         this.routerModel.get('locked'),
      library:        this.routerModel.get('library'),
      quote:          randomQuote(),
      type:           type,
      totalItems:     this.collection.size(),
      totalEntries:   this.collection.total_entries
    }));

    return this;
  },

  _initBinds: function() {
    this.routerModel.bind('change', this.render, this);
    this.collection.bind('reset', this.render, this);
    this.add_related_model(this.routerModel);
    this.add_related_model(this.collection);
  },

  _onConnectClick: function() {
    this.trigger('connectDataset', this);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../../../common/view_helpers/random_quote":212}],62:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var pluralizeString = require('../../../../view_helpers/pluralize_string');

/**
 * View representing an item in the list under datasets route.
 */
module.exports = cdb.core.View.extend({

  tagName: 'li',
  className: 'DatasetsList-item DatasetsList-item--selectable',

  events: {
    'click .js-tag-link': '_onTagClick',
    'click': '_toggleSelected'
  },

  initialize: function() {
    this.user = this.options.user;
    this.routerModel = this.options.createModel.visFetchModel;
    this.template = cdb.templates.getTemplate('common/views/create/listing/dataset_item');
    this.table = new cdb.admin.CartoDBTableMetadata(this.model.get('table'));

    this.model.on('change', this.render, this);
  },

  render: function() {
    var vis = this.model;
    var table = this.table;
    var tags = vis.get('tags') || [];
    var description = vis.get('description') && Utils.stripHTML(markdown.toHTML(vis.get('description'))) || '';

    var d = {
      isRaster:                vis.get('kind') === 'raster',
      geometryType:            table.geomColumnTypes().length > 0 ? table.geomColumnTypes()[0] : '',
      title:                   vis.get('name'),
      isOwner:                 vis.permission.isOwner(this.user),
      owner:                   vis.permission.owner.renderData(this.user),
      showPermissionIndicator: !vis.permission.hasWriteAccess(this.user),
      description:             description,
      privacy:                 vis.get('privacy').toLowerCase(),
      timeDiff:                moment(vis.get('updated_at')).fromNow(),
      tags:                    tags,
      tagsCount:               tags.length,
      maxTagsToShow:           3,
      rowCount:                undefined,
      datasetSize:             undefined,
      syncStatus:              undefined,
      syncRanAt:               undefined
    };

    var rowCount = table.get('row_count');
    if (rowCount >= 0) {
      d.rowCount = ( rowCount < 10000 ? Utils.formatNumber(rowCount) : Utils.readizableNumber(rowCount) );
      d.pluralizedRows = pluralizeString('Row', rowCount);
    }

    var datasetSize = table.get('size');
    if (datasetSize >= 0) {
      d.datasetSize = Utils.readablizeBytes(datasetSize, true);
    }

    if (!_.isEmpty(vis.get("synchronization"))) {
      d.syncRanAt = moment(vis.get("synchronization").ran_at || new Date()).fromNow();
      d.syncStatus = vis.get("synchronization").state;
    }

    this.$el.html(this.template(d));

    this._renderTooltips();

    // Item selected?
    this.$el[ vis.get('selected') ? 'addClass' : 'removeClass' ]('is--selected');

    return this;
  },

  _renderTooltips: function() {
    if (!_.isEmpty(this.model.get("synchronization"))) {
      this.addView(
        new cdb.common.TipsyTooltip({
          el: this.$('.DatasetsList-itemStatus'),
          title: function(e) {
            return $(this).attr('data-title')
          }
        })
      )
    }
  },

  _onTagClick: function(ev) {
    var tag = $(ev.target).val();

    if (tag) {
      this.routerModel.set('tag', tag);
    }
  },

  _toggleSelected: function(ev) {
    // Let links use default behaviour
    if (ev.target.tagName !== 'A') {
      this.killEvent(ev);
      if (this.options.createModel.canSelect(this.model)) {
        this.model.set('selected', !this.model.get('selected'));
      }
    }
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../../view_helpers/pluralize_string":211}],63:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var PaginationModel = require('../../../../views/pagination/model');
var PaginationView = require('../../../../views/pagination/view');


/**
 * Responsible for the datasets paginator
 *  ___________________________________________________________________________
 * |                                                                           |
 * |                                             Page 2 of 42 [1] 2 [3][4][5]  |
 * |___________________________________________________________________________|
 *
 */

module.exports = cdb.core.View.extend({

  className: 'DatasetsPaginator',

  initialize: function() {
    this.routerModel = this.options.routerModel;
    this.collection = this.options.collection;
    this.model = new PaginationModel({
      current_page: this.routerModel.get('page')
    });

    this._initBinds();
    this._initViews();
  },

  render: function() {
    this.clearSubViews();
    this.$el.append(this.paginationView.render().el);
    return this;
  },

  _initBinds: function() {
    this.model.bind('change', this.render, this);
    this.model.bind('change:current_page', function() {
      this.routerModel.set('page', this.model.get('current_page'));
    }, this);
    this.collection.bind('reset', this._updatePaginationModelByCollection, this);
    this.routerModel.bind('change:page', this._updatePaginationModelByRouterModel, this);

    this.add_related_model(this.routerModel);
    this.add_related_model(this.collection);
    this.add_related_model(this.model);
  },

  _initViews: function() {
    this.paginationView = new PaginationView({
      model: this.model
    });
    this.addView(this.paginationView);
  },

  _updatePaginationModelByCollection: function() {
    this.model.set({
      per_page:    this.collection.options.get('per_page'),
      total_count: this.collection.total_entries
    });
  },

  _updatePaginationModelByRouterModel: function() {
    this.model.set('current_page', this.routerModel.get('page'));
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../../views/pagination/model":218,"../../../../views/pagination/view":219}],64:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var DatasetItem = require('./dataset_item_view');
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var UploadConfig = require('../../../../background_polling/models/upload_config');
var pluralizeString = require('../../../../view_helpers/pluralize_string');

/**
 *  Remote dataset item view
 *
 */

module.exports = DatasetItem.extend({

  tagName: 'li',
  className: 'DatasetsList-item',

  events: {
    'click .js-tag-link': '_onTagClick',
    'click': '_toggleSelected'
  },

  initialize: function() {
    this.elder('initialize');
    this.template = cdb.templates.getTemplate('common/views/create/listing/remote_dataset_item');
    this.table = new cdb.admin.CartoDBTableMetadata(this.model.get('external_source'));
  },

  render: function() {
    var vis = this.model;
    var table = this.table;
    var tags = vis.get('tags') || [];
    var description = vis.get('description') && Utils.stripHTML(markdown.toHTML(vis.get('description'))) || '';
    var source = vis.get('source') && markdown.toHTML(vis.get('source')) || '';

    var d = {
      isRaster:                vis.get('kind') === 'raster',
      geometryType:            table.geomColumnTypes().length > 0 ? table.geomColumnTypes()[0] : '',
      title:                   vis.get('display_name') || vis.get('name'),
      source:                  source,
      description:             description,
      timeDiff:                moment(vis.get('updated_at')).fromNow(),
      tags:                    tags,
      tagsCount:               tags.length,
      routerModel:             this.routerModel,
      maxTagsToShow:           3,
      canImportDataset:        this._canImportDataset(),
      rowCount:                undefined,
      datasetSize:             undefined
    };

    var rowCount = table.get('row_count');
    if (rowCount >= 0) {
      d.rowCount = ( rowCount < 10000 ? Utils.formatNumber(rowCount) : Utils.readizableNumber(rowCount) );
      d.pluralizedRows = pluralizeString('Row', rowCount);
    }

    var datasetSize = table.get('size');
    if (datasetSize >= 0) {
      d.datasetSize = Utils.readablizeBytes(
        datasetSize,
        datasetSize.toString().length > 9 ? false : true
      );
    }

    this.$el.html(this.template(d));
    this._setItemClasses();
    this._renderTooltips();

    return this;
  },

  _setItemClasses: function() {
    // Item selected?
    this.$el[ this.model.get('selected') ? 'addClass' : 'removeClass' ]('is--selected');
    // Check if it is selectable
    this.$el[ this._canImportDataset() ? 'addClass' : 'removeClass' ]('DatasetsList-item--selectable');
    // Check if it is importable
    this.$el[ this._canImportDataset() ? 'removeClass' : 'addClass' ]('DatasetsList-item--banned');
  },

  _renderTooltips: function() {
    this.addView(
      new cdb.common.TipsyTooltip({
        el: this.$('.DatasetsList-itemStatus'),
        title: function(e) {
          return $(this).attr('data-title')
        }
      })
    )
  },

  _onTagClick: function(ev) {
    if (ev) {
      this.killEvent(ev);
    }

    var tag = $(ev.target).val();

    if (tag) {
      this.routerModel.set({
        tag: tag,
        library: true
      });
    }
  },

  _canImportDataset: function() {
    var table_size = this.table.get('size') || 0;
    return (
        this.user.get('remaining_byte_quota') * UploadConfig.fileTimesBigger >= table_size &&
        this.user.get('limits')['import_file_size'] > table_size
      );
  },

  _toggleSelected: function(ev) {
    // Let links use default behaviour
    if (ev.target.tagName !== 'A') {
      this.killEvent(ev);
      if (this._canImportDataset() && this.options.createModel.canSelect(this.model)) {
        this.model.set('selected', !this.model.get('selected'));
      }
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../../background_polling/models/upload_config":14,"../../../../view_helpers/pluralize_string":211,"./dataset_item_view":62}],65:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var DatasetsItem = require('./datasets/dataset_item_view');
var RemoteDatasetsItem = require('./datasets/remote_dataset_item_view');

/**
 * View representing the list of items
 */
module.exports = cdb.core.View.extend({

  tagName: 'ul',

  className: 'DatasetsList',

  events: {},

  _ITEMS: {
    'remotes':  RemoteDatasetsItem,
    'datasets': DatasetsItem
  },

  initialize: function() {
    this.user = this.options.user;
    this.createModel = this.options.createModel;
    this.collection.bind('reset', this.render, this);
    this.add_related_model(this.collection);
  },

  render: function() {
    this.clearSubViews();
    this.collection.each(this._addItem, this);
    return this;
  },

  _addItem: function(m, i) {
    var type = m.get('type') === "remote" ? 'remotes' : 'datasets';

    var item = new this._ITEMS[type]({
      model:       m,
      createModel: this.createModel,
      user:        this.user
    });

    this.addView(item);
    this.$el.append(item.render().el);
  },

  show: function() {
    this.$el.removeClass('is-hidden');
  },

  hide: function() {
    this.$el.addClass('is-hidden');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./datasets/dataset_item_view":62,"./datasets/remote_dataset_item_view":64}],66:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var DatasetsList = require('./datasets_list_view');
var ContentResult = require('./datasets/content_result_view');
var DatasetsPaginator = require('./datasets/datasets_paginator_view');

/**
 *  Datasets list view
 *
 *  Show datasets view to select them for
 *  creating a map or importing a dataset
 *
 */

module.exports = cdb.core.View.extend({

  initialize: function () {
    this.user = this.options.user;
    this.createModel = this.options.createModel;
    this.routerModel = this.options.routerModel;

    this._initViews();
    this._initBindings();

    if (this.createModel.get('collectionFetched')) {
      this._onDataFetched();
    }
  },

  _initBindings: function () {
    this.routerModel.bind('change', this._onRouterChange, this);
    this.collection.bind('loading', this._onDataLoading, this);
    this.collection.bind('reset', this._onDataFetched, this);
    this.collection.bind('error', function (e) {
      // Old requests can be stopped, so aborted requests are not
      // considered as an error
      if (!e || (e && e.statusText !== 'abort')) {
        this._onDataError();
      }
    }, this);
    this.add_related_model(this.routerModel);
    this.add_related_model(this.createModel);
    this.add_related_model(this.collection);
  },

  _initViews: function () {
    this.controlledViews = {}; // All available views
    this.enabledViews = []; // Visible views

    var noDatasetsView = new ContentResult({
      className: 'ContentResult no-datasets',
      user: this.user,
      defaultUrl: this.options.defaultUrl,
      routerModel: this.routerModel,
      collection: this.collection,
      template: 'common/views/create/listing/content_no_datasets'
    });
    noDatasetsView.bind('connectDataset', function () {
      if (this.user.canCreateDatasets()) {
        this.createModel.set('listing', 'import');
      }
    }, this);
    noDatasetsView.render().hide();
    this.controlledViews.no_datasets = noDatasetsView;
    this.$el.append(noDatasetsView.el);
    this.addView(noDatasetsView);

    var listView = new DatasetsList({
      user: this.user,
      createModel: this.createModel,
      routerModel: this.routerModel,
      collection: this.collection
    });
    this.controlledViews.list = listView;
    this.$el.append(listView.render().el);
    this.addView(listView);

    var noResultsView = new ContentResult({
      defaultUrl: this.options.defaultUrl,
      routerModel: this.routerModel,
      collection: this.collection,
      template: 'common/views/create/listing/datasets_no_result'
    });
    noResultsView.render().hide();
    this.controlledViews.no_results = noResultsView;
    this.$el.append(noResultsView.el);
    this.addView(noResultsView);

    var errorView = new ContentResult({
      defaultUrl: this.options.defaultUrl,
      routerModel: this.routerModel,
      collection: this.collection,
      template: 'common/views/create/listing/datasets_error'
    });
    errorView.render().hide();
    this.controlledViews.error = errorView;
    this.$el.append(errorView.el);
    this.addView(errorView);

    var mainLoaderView = new ContentResult({
      defaultUrl: this.options.defaultUrl,
      routerModel: this.routerModel,
      collection: this.collection,
      template: 'common/views/create/listing/datasets_loader'
    });

    this.controlledViews.main_loader = mainLoaderView;
    this.$el.append(mainLoaderView.render().el);
    this.addView(mainLoaderView);

    var datasetsPaginator = new DatasetsPaginator({
      routerModel: this.routerModel,
      collection: this.collection
    });

    this.controlledViews.content_footer = datasetsPaginator;
    this.$el.append(datasetsPaginator.render().el);
    this.addView(datasetsPaginator);
  },

  _onRouterChange: function () {
    this._hideBlocks();
    this._showBlocks([ 'main_loader' ]);
  },

  /**
   * Arguments may vary, depending on if it's the collection or a model that triggers the event callback.
   * @private
   */
  _onDataFetched: function () {
    var activeViews = [ 'content_footer' ];
    var tag = this.routerModel.get('tag');
    var q = this.routerModel.get('q');
    var shared = this.routerModel.get('shared');
    var locked = this.routerModel.get('locked');
    var library = this.routerModel.get('library');
    var hasDataLibrary = cdb.config.get('data_library_enabled');

    if (library && this.collection.total_user_entries === 0) {
      activeViews.push('no_datasets');
    }

    if (this.collection.size() === 0) {
      if (!tag && !q && shared === 'no' && !locked) {
        if (!library && hasDataLibrary) {
          this.createModel.set('datasetsTabDisabled', true);
          this._goToLibrary();
          return;
        }

        if (!library && this.user.canCreateDatasets()) {
          this.createModel.set({
            datasetsTabDisabled: true,
            listing: 'import'
          });
          return;
        }

        activeViews.push('no_results');
      } else {
        activeViews.push('no_results');
      }
    } else {
      activeViews.push('list');
      this.routerModel.set('datasetsTabDisabled', false);
      this.createModel.set('datasetsTabDisabled', false);
    }

    this._hideBlocks();
    this._showBlocks(activeViews);
  },

  _onDataLoading: function () {
    this._hideBlocks();
    this._showBlocks([ 'main_loader' ]);
  },

  _onDataError: function (e) {
    this._hideBlocks();
    this._showBlocks([ 'error' ]);
  },

  _showBlocks: function (views) {
    var self = this;
    if (views) {
      _.each(views, function (v) {
        if (self.controlledViews[v]) {
          self.controlledViews[v].show();
          self.enabledViews.push(v);
        }
      });
    } else {
      self.enabledViews = [];
      _.each(this.controlledViews, function (v) {
        v.show();
        self.enabledViews.push(v);
      });
    }
  },

  _goToLibrary: function () {
    this.routerModel.set({
      shared: 'no',
      library: true,
      page: 1
    });
  },

  _hideBlocks: function (views) {
    var self = this;
    if (views) {
      _.each(views, function (v) {
        if (self.controlledViews[v]) {
          self.controlledViews[v].hide();
          self.enabledViews = _.without(self.enabledViews, v);
        }
      });
    } else {
      _.each(this.controlledViews, function (v) {
        v.hide();
      });
      self.enabledViews = [];
    }
  },

  _isBlockEnabled: function (name) {
    if (name) {
      return _.contains(this.enabledViews, name);
    }
    return false;
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./datasets/content_result_view":61,"./datasets/datasets_paginator_view":63,"./datasets_list_view":65}],67:[function(require,module,exports){
var ImportService = require('./imports/service_import/import_service_view');
var ImportTwitter = require('./imports/twitter_import/import_twitter_view');
var ImportDataView = require('./imports/import_data_view');
var ImportArcGISView = require('./imports/import_arcgis_view');

/**
 * Attributes:
 *
 *  ClassName: import pane class view
 *  enabled: function that takes cdb.config and returns whether the service is enabled
 *  fallbackClassName: ...
 *  name: local name
 *  title: text for tab link
 *  options:
 *    - service:
 *    - fileExtensions:
 *    - showAvailableFormats:
 *    - acceptSync:
 *    - fileAttrs:
 *
 */
module.exports = {
  File: {
    ClassName: ImportDataView,
    enabled: function (config, userData) { return true; },
    name: 'file',
    title: 'Data file',
    options: {
      type: 'url',
      fileEnabled: true,
      acceptSync: true
    }
  },
  GDrive: {
    ClassName: ImportService,
    enabled: function (config, userData) { return !!config.get('oauth_gdrive'); },
    name: 'gdrive',
    title: 'Google Drive',
    options: {
      service: 'gdrive',
      fileExtensions: ['Google SpreadSheet', 'CSV'],
      showAvailableFormats: false,
      acceptSync: true,
      fileAttrs: {
        ext: true,
        title: 'filename',
        description: {
          content: [{
            name: 'size',
            format: 'size',
            key: true
          }]
        }
      }
    }
  },
  Dropbox: {
    ClassName: ImportService,
    enabled: function (config, userData) { return !!config.get('oauth_dropbox'); },
    name: 'dropbox',
    title: 'Dropbox',
    options: {
      service: 'dropbox',
      fileExtensions: ['CSV', 'XLS'],
      showAvailableFormats: false,
      acceptSync: true,
      fileAttrs: {
        ext: true,
        title: 'filename',
        description: {
          content: [
            {
              name: 'id',
              format: ''
            },
            {
              name: 'size',
              format: 'size',
              key: true
            }
          ],
          separator: '-'
        }
      }
    }
  },
  Box: {
    ClassName: ImportService,
    enabled: function (config, userData) { return !!config.get('oauth_box'); },
    name: 'box',
    title: 'Box',
    fallback: 'common/views/create/listing/import_box_fallback',
    options: {
      service: 'box',
      fileExtensions: ['CSV', 'XLS'],
      showAvailableFormats: false,
      acceptSync: true,
      fileAttrs: {
        ext: true,
        title: 'filename',
        description: {
          content: [
            {
              name: 'size',
              format: 'size',
              key: true
            }
          ],
          separator: '-'
        }
      }
    }
  },
  Twitter: {
    ClassName: ImportTwitter,
    enabled: function (config, userData) {
      return userData.get('twitter').enabled && !!config.get('datasource_search_twitter');
    },
    fallback: 'common/views/create/listing/import_twitter_fallback',
    name: 'twitter',
    title: 'Twitter'
  },
  Mailchimp: {
    ClassName: ImportService,
    enabled: function (config, userData) {
      return userData.get('mailchimp').enabled && !!config.get('oauth_mailchimp');
    },
    fallback: 'common/views/create/listing/import_mailchimp_fallback',
    name: 'mailchimp',
    title: 'MailChimp',
    options: {
      service: 'mailchimp',
      fileExtensions: [],
      acceptSync: true,
      showAvailableFormats: false,
      headerTemplate: 'common/views/create/listing/import_types/data_header_mailchimp',
      fileAttrs: {
        ext: true,
        title: 'filename',
        description: {
          content: [{
            name: 'member_count',
            format: 'number',
            key: true
          }],
          itemName: 'member',
          separator: ''
        }
      }
    }
  },
  // Instagram: {
  //   ClassName: ImportService,
  //   fallback: 'common/views/create/listing/import_instagram_fallback',
  //   name: 'instagram',
  //   title: 'Instagram',
  //   options: {
  //     service: 'instagram',
  //     fileExtensions: [],
  //     acceptSync: false,
  //     showAvailableFormats: false,
  //     fileAttrs: {
  //       ext: false,
  //       title: 'title'
  //     }
  //   }
  // },
  Arcgis: {
    ClassName: ImportArcGISView,
    enabled: function (config, userData) { return config.get('arcgis_enabled'); },
    fallback: 'common/views/create/listing/import_arcgis_fallback',
    name: 'arcgis',
    title: 'ArcGIS Server&trade;'
  },
  Salesforce: {
    ClassName: ImportDataView,
    enabled: function (config, userData) { return config.get('salesforce_enabled'); },
    fallback: 'common/views/create/listing/import_salesforce_fallback',
    name: 'salesforce',
    title: 'Salesforce'
    // options: {
    //   type: 'service',
    //   service_name: 'salesforce',
    //   acceptSync: true,
    //   formTemplate: 'common/views/create/listing/import_types/data_form_salesforce',
    //   headerTemplate: 'common/views/create/listing/import_types/data_header_salesforce'
    // }
  }
};

},{"./imports/import_arcgis_view":71,"./imports/import_data_view":72,"./imports/service_import/import_service_view":76,"./imports/twitter_import/import_twitter_view":86}],68:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);

/**
 *  Form view for url import for example
 *
 *  - It accepts an url
 *  - It checks if it is valid
 *  - It could have a file option
 *
 */

module.exports = cdb.core.View.extend({

  options: {
    template: '',
    fileEnabled: false
  },

  events: {
    'keyup .js-textInput': '_onTextChanged',
    'submit .js-form': '_onSubmitForm'
  },

  initialize: function() {
    this.user = this.options.user;
    this.template = cdb.templates.getTemplate(this.options.template || 'common/views/create/listing/import_types/data_form');
    this._initBinds();
    this._checkVisibility();
  },

  render: function() {
    this.$el.html(
      this.template(this.options)
    )
    this._initViews();
    return this;
  },

  _initBinds: function() {
    this.model.bind('change:state', this._checkVisibility, this);
  },

  _initViews: function() {
    if (this.options.fileEnabled) {
      var self = this;
      this.$('.js-fileInput').bind('change', function(e) {
        if (this.files && this.files.length > 0) {
          self._onFileChanged(this.files);
        }
        this.value = "";
      });

      this._initDropzone();
    }
  },

  _initDropzone: function() {
    var el = $('html')[0]; // :(
    var self = this;

    this.dragster = new Dragster(el);

    $(el).bind("dragster:enter", function (e) {
      self._showDropzone();
    });

    $(el).bind("dragster:leave", function (e) {
      self._hideDropzone();
    });

    if (el.dropzone) { // avoid loading the dropzone twice
      return;
    }

    this.dropzone = new Dropzone(el, {
      url: ':)',
      autoProcessQueue: false,
      previewsContainer: false
    });

    this.dropzone.on('dragover', function() {
      self._showDropzone();
    });

    this.dropzone.on("drop", function (ev) {
      var files = ev.dataTransfer.files;
      self._onFileChanged(files);
      self._hideDropzone();
    });
  },

  _destroyDropzone: function() {
    var el = $('html')[0]; // :(

    if (this.dragster) {
      this.dragster.removeListeners();
      this.dragster.reset();
      $(el).unbind('dragster:enter dragster:leave');
    }

    if (this.dropzone) {
      this.dropzone.destroy();
    }
  },

  _setValidFileExtensions: function(list) {
    return RegExp("(\.|\/)(" + list.join('|') + ")$", "i");
  },

  _onTextChanged: function() {
    var value = this.$('.js-textInput').val();
    if (!value) {
      this._hideTextError();
    }
  },

  _onFileChanged: function(files) {
    this.trigger('fileSelected', this);

    if (files && files.length === 1) {
      files = files[0];
    }

    this.model.set({
      type: 'file',
      value: files
    });

    if (this.model.get('state') !== "error") {
      this._hideFileError();
      this.model.set('state', 'selected');
    } else {
      this._showFileError();
    }
  },

  _showTextError: function() {
    this.$('.Form-inputError').addClass('is-visible');
  },

  _hideTextError: function() {
    this.$('.Form-inputError').removeClass('is-visible');
  },

  _showDropzone: function() {
    this.$('.Form-upload').addClass('is-dropping');
    this._hideFileError();
  },

  _hideDropzone: function() {
    this.$('.Form-upload').removeClass('is-dropping');
  },

  _showFileError: function() {
    if (this.model.get('state') === "error") {
      this.$('.js-fileError')
        .text(this.model.get('get_error_text').what_about)
        .show();
      this.$('.js-fileLabel').hide();
      this.$('.js-fileButton').addClass('Button--negative');
    }
  },

  _hideFileError: function() {
    this.$('.js-fileError').hide();
    this.$('.js-fileLabel').show();
    this.$('.js-fileButton').removeClass('Button--negative');
  },

  _onSubmitForm: function(e) {
    if (e) this.killEvent(e);

    // URL submit
    var value = this.$('.js-textInput').val();

    if (!value) {
      this._hideTextError();
      return;
    }

    // Change file attributes :S
    this.trigger('urlSelected', this);

    // Change model
    var importType = this.model.get('service_name') ? 'service' : 'url';
    this.model.set({
      type: importType,
      value: value,
      service_item_id: value,
      state: 'idle'
    });

    if (this.model.get('state') !== "error") {
      // Remove errors
      this._hideFileError();
      this._hideTextError();
      this.model.set('state', 'selected');
    } else {
      this._showTextError();
    }
  },

  _checkVisibility: function() {
    var state = this.model.get('state');
    this[ state !== "selected" ? 'show' : 'hide' ]()
  },

  clean: function() {
    this._destroyDropzone();
    this.$('.js-fileInput').unbind('change');
    this.elder('clean');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],69:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 *  Data header view
 *
 *  - It will change when upload state changes
 *  - Possibility to change state with a header button
 *
 */

module.exports = cdb.core.View.extend({

  events: {
    'click .js-back': '_goToStart'
  },

  options: {
    fileEnabled: false,
    acceptSync: false
  },

  initialize: function() {
    this.user = this.options.user;
    this.template = cdb.templates.getTemplate(this.options.template || 'common/views/create/listing/import_types/data_header');
    this._initBinds();
    this._checkVisibility();
  },

  render: function() {
    var acceptSync = this.options.acceptSync && this.user.get('actions') && this.user.get('actions').sync_tables && this.model.get('type') !== "file"; 
    
    this.$el.html(
      this.template({
        type: this.model.get('type'),
        fileEnabled: this.options.fileEnabled,
        acceptSync: acceptSync,
        state: this.model.get('state')
      })
    );
    this._checkVisibility();
    return this;
  },

  _initBinds: function() {
    this.model.bind('change:state', this.render, this);
  },

  _checkVisibility: function() {
    this.show()
  },

  _goToStart: function() {
    this.model.set('state', 'idle');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],70:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var SelectedDataset = require('./import_selected_dataset_view');

/**
 *  Selected ArcGIS dataset
 *
 *  - Displays the result when an ArcGIS url/dataset is selected, no matter the type.
 *  - It will show available sync options if user can and the url is an ArcGIS layer.
 *  - Upgrade link for people who don't have sync permissions.
 *
 */

module.exports = SelectedDataset.extend({

  render: function() {
    var title = this.options.fileAttrs.title && this.model.get('value')[this.options.fileAttrs.title] || this.model.get('value');
    var description = this._genDescription();
    var ext = this.options.fileAttrs.ext ? Utils.getFileExtension(title) : '' ;

    if (this.options.fileAttrs.ext) {
      title = title && title.replace('.' + ext, '');
    }

    var upgradeUrl = window.upgrade_url;
    var userCanSync = this.user.get('actions') && this.user.get('actions').sync_tables;
    var customInstall = cdb.config.get('cartodb_com_hosted');

    this.$el.html(
      this.template({
        title: title,
        description: description,
        ext: ext,
        interval: this.model.get('interval'),
        importCanSync: this.options.acceptSync && this._isArcGISLayer(title),
        userCanSync: userCanSync,
        showTrial: this.user.canStartTrial(),
        showUpgrade: !userCanSync && !customInstall && upgradeUrl && !this.user.isInsideOrg(),
        upgradeUrl: upgradeUrl
      })
    );
    return this;
  },

  _isArcGISLayer: function(url) {
    return url.search(/([0-9]+\/|[0-9]+)/) !== -1
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./import_selected_dataset_view":75}],71:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var FormView = require('./data_import/data_form_view');
var HeaderView = require('./data_import/data_header_view');
var SelectedDataset = require('./import_arcgis_selected_dataset_view');
var ImportDataView = require('./import_data_view');

/**
 *  Import ArcGIS panel
 *
 *  - It only accepts an url, and it could be a map or a layer.
 *
 */

module.exports = ImportDataView.extend({

  options: {
    fileExtensions: [],
    type: 'service',
    service: 'arcgis',
    acceptSync: true,
    fileEnabled: false,
    fileAttrs: {
      ext: false,
      title: '',
      description: ''
    }
  },

  _initViews: function() {
    // Data header
    var headerView = new HeaderView({
      el: this.$('.ImportPanel-header'),
      model: this.model,
      user: this.user,
      collection: this.collection,
      fileEnabled: this.options.fileEnabled,
      acceptSync: this.options.acceptSync,
      template: 'common/views/create/listing/import_types/data_header_arcgis'
    });
    headerView.render();
    this.addView(headerView);

    // Dataset selected
    var selected = new SelectedDataset({
      el: this.$('.DatasetSelected'),
      user: this.user,
      model: this.model,
      acceptSync: this.options.acceptSync,
      fileAttrs: this.options.fileAttrs
    });
    selected.render();
    this.addView(selected);

    // Data Form
    var formView = new FormView({
      el: this.$('.ImportPanel-form'),
      user: this.user,
      model: this.model,
      template: 'common/views/create/listing/import_types/data_form_arcgis',
      fileEnabled: this.options.fileEnabled
    });

    formView.render();
    this.addView(formView);

  }

})

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./data_import/data_form_view":68,"./data_import/data_header_view":69,"./import_arcgis_selected_dataset_view":70,"./import_data_view":72}],72:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var ImportDefaultView = require('./import_default_view');
var UploadModel = require('../../../../background_polling/models/upload_model');
var FormView = require('./data_import/data_form_view');
var HeaderView = require('./data_import/data_header_view');
var SelectedDataset = require('./import_selected_dataset_view');

/**
 *  Import data panel
 *
 *  - It accepts an url
 *  - It checks if it is valid
 *
 */

module.exports = ImportDefaultView.extend({

  options: {
    fileExtensions: [],
    type: 'url',
    service: '',
    acceptSync: false,
    fileEnabled: false,
    formTemplate: '',
    headerTemplate: '',
    fileAttrs: {}
  },

  className: 'ImportPanel ImportDataPanel',

  initialize: function() {
    this.user = this.options.user;
    this.model = new UploadModel({
      type: this.options.type,
      service_name: this.options.service
    }, {
      user: this.user
    });

    this.template = cdb.templates.getTemplate('common/views/create/listing/import_types/import_data');

    this._initBinds();
  },

  render: function() {
    this.clearSubViews();
    this.$el.html(this.template());
    this._initViews();
    return this;
  },

  _initViews: function() {
    // Data header
    var headerView = new HeaderView({
      el: this.$('.ImportPanel-header'),
      model: this.model,
      user: this.user,
      fileEnabled: this.options.fileEnabled,
      acceptSync: this.options.acceptSync,
      template: this.options.headerTemplate
    });
    headerView.render();
    this.addView(headerView);

    // Dataset selected
    var selected = new SelectedDataset({
      el: this.$('.DatasetSelected'),
      user: this.user,
      model: this.model,
      acceptSync: this.options.acceptSync,
      fileAttrs: this.options.fileAttrs
    });
    selected.render();
    this.addView(selected);

    // Data Form
    var formView = new FormView({
      el: this.$('.ImportPanel-form'),
      user: this.user,
      model: this.model,
      template: this.options.formTemplate,
      fileEnabled: this.options.fileEnabled
    });

    formView.bind('fileSelected', function() {
      selected.setOptions({
        acceptSync: false,
        fileAttrs: {
          ext: true,
          title: 'name',
          description: {
            content: [{
              name: 'size',
              format: 'size'
            }]
          }
        }
      });
    });

    formView.bind('urlSelected', function() {
      selected.setOptions({
        acceptSync: true,
        fileAttrs: {
          ext: false,
          title: '',
          description: ''
        }
      });
    });
    formView.render();
    this.addView(formView);

  },

  _initBinds: function() {
    this.model.bind('change:state', this._checkState, this);
    this.model.bind('change', this._triggerChange, this);
  },

  _checkState: function() {
    if (this.model.previous('state') === "selected") {
      this.model.set({
        type: undefined,
        value: '',
        service_name: '',
        service_item_id: '',
        interval: 0
      });
    }
  }

})

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../../background_polling/models/upload_model":15,"./data_import/data_form_view":68,"./data_import/data_header_view":69,"./import_default_view":74,"./import_selected_dataset_view":75}],73:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 *  Import fallback default panel
 *
 */

module.exports = cdb.core.View.extend({

  className: 'ImportPanel',

  initialize: function() { 
    this.template = cdb.templates.getTemplate( this.options.template || 'common/views/create/listing/import_default_fallback' );
  },

  render: function() {
    this.$el.append(this.template());
  }

})
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],74:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var UploadModel = require('../../../../background_polling/models/upload_model');

/**
 *  Default view for an import item
 *
 *  - It is based in an upload model.
 *  - Will trigger a change when model changes.
 *  - It returns their data if it is requested with a method.
 */


module.exports = cdb.core.View.extend({

  initialize: function() {
    this.user = this.options.user;
    this.model = new UploadModel(null, { user: this.user });
    this._initBinds();
  },

  _initBinds: function() {
    this.model.bind('change', this._triggerChange, this);
  },

  _triggerChange: function() {
    this.trigger('change', this.model.toJSON(), this);
  },

  getModelData: function() {
    if (this.model) {
      return this.model.toJSON()
    }
    return {}
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../../background_polling/models/upload_model":15}],75:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var pluralizeString = require('../../../../view_helpers/pluralize_string');

/**
 *  Selected dataset
 *
 *  - Displays the result when a dataset is selected, no matter the type.
 *  - It will show available sync options if that import lets it.
 *  - Upgrade link for people who don't have sync permissions.
 *
 */

module.exports = cdb.core.View.extend({

  className: 'DatasetSelected',

  _FORMATTERS: {
    'size': Utils.readablizeBytes,
    'number': Utils.formatNumber
  },

  options: {
    acceptSync: false,
    fileAttrs: {
      ext: false,
      title: '',
      description: {
        content: [{
          name: 'id',
          format: ''
        }],
        itemName: '',
        separator: ''
      }
    }
  },

  events: {
    'click .js-interval-0': '_onIntervalZero',
    'click .js-interval-1': '_onIntervalHour',
    'click .js-interval-2': '_onIntervalDay',
    'click .js-interval-3': '_onIntervalWeek',
    'click .js-interval-4': '_onIntervalMonth'
  },

  initialize: function() {
    this.user = this.options.user;
    this.template = cdb.templates.getTemplate('common/views/create/listing/import_selected_dataset');
    this._initBinds();
    this._checkVisibility();
  },

  render: function() {
    var title = this.options.fileAttrs.title && this.model.get('value')[this.options.fileAttrs.title] || this.model.get('value');
    var description = this._genDescription();
    var ext = this.options.fileAttrs.ext ? Utils.getFileExtension(title) : '' ;

    if (this.options.fileAttrs.ext) {
      title = title && title.replace('.' + ext, '');
    }

    var upgradeUrl = window.upgrade_url;
    var userCanSync = this.user.get('actions') && this.user.get('actions').sync_tables;
    var customInstall = cdb.config.get('cartodb_com_hosted');

    this.$el.html(
      this.template({
        title: title,
        description: description,
        ext: ext,
        interval: this.model.get('interval'),
        importCanSync: this.options.acceptSync,
        userCanSync: userCanSync,
        showTrial: this.user.canStartTrial(),
        showUpgrade: !userCanSync && !customInstall && upgradeUrl && !this.user.isInsideOrg(),
        upgradeUrl: upgradeUrl
      })
    );
    return this;
  },

  _initBinds: function() {
    this.model.bind('change:value', this.render, this);
    this.model.bind('change:interval', this.render, this);
    this.model.bind('change:state', this._checkVisibility, this);
  },

  _genDescription: function() {
    if (this.options.fileAttrs && this.options.fileAttrs.description) {
      var descriptionOpts = this.options.fileAttrs.description;
      var descriptionKeyValue = '';
      var descriptionStr = '';
      var self = this;

      if (descriptionOpts.content && descriptionOpts.content.length > 0) {
        _.each(descriptionOpts.content, function(item, i) {

          if (i > 0 && descriptionOpts.separator) {
            descriptionStr += " " + descriptionOpts.separator + ' ';
          }

          var value = self.model.get('value')[item.name];
          var format = item.format && self._FORMATTERS[item.format];
          descriptionStr += format && format(value) || value;

          if (item.key) {
            descriptionKeyValue = item.name;
          }
        })
      }

      if (descriptionOpts.itemName && descriptionKeyValue) {
        descriptionStr += ' ' + (descriptionOpts.itemName && pluralizeString(descriptionOpts.itemName, descriptionKeyValue) || '');
      }

      return descriptionStr;
    }

    return '';
  },

  _onIntervalZero: function() {
    this.model.set('interval', 0);
  },

  _onIntervalHour: function() {
    if (this.options.acceptSync && this.user.get('actions').sync_tables) {
      this.model.set('interval', 3600);
    }
  },

  _onIntervalDay: function() {
    if (this.options.acceptSync && this.user.get('actions').sync_tables) {
      this.model.set('interval', 86400);
    }
  },

  _onIntervalWeek: function() {
    if (this.options.acceptSync && this.user.get('actions').sync_tables) {
      this.model.set('interval', 604800);
    }
  },

  _onIntervalMonth: function() {
    if (this.options.acceptSync && this.user.get('actions').sync_tables) {
      this.model.set('interval', 2592000);
    }
  },

  // Change options
  setOptions: function(d) {
    if (d && !_.isEmpty(d)) {
      _.extend(this.options, d);
    }
  },

  _checkVisibility: function() {
    var state = this.model.get('state');
    if (state === 'selected') {
      this.show();
    } else {
      this.hide();
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../../view_helpers/pluralize_string":211}],76:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var ImportDefaultView = require('../import_default_view');
var UploadModel = require('../../../../../background_polling/models/upload_model');
var ServiceHeader = require('./service_header_view');
var ServiceLoader = require('./service_loader_view');
var ServiceList = require('./service_list_view');
var ServiceSelectedFile = require('../import_selected_dataset_view');
var ServiceToken = require('../../../../../service_models/service_token_model');
var ServiceOauth = require('../../../../../service_models/service_oauth_model');
var ServiceCollection = require('./service_items_collection');

/**
 *  Import service view
 *
 *  - Use a service import panel
 *  - It will request login to the service
 *  - If it works, a list of available files will appear.
 *  - Once a file is selected, sync options will appear.
 *
 */

module.exports = ImportDefaultView.extend({

  _DATASOURCE_NAME: '',
  _WINDOW_INTERVAL: 1000, // miliseconds

  className: 'ImportPanel ImportPanelService',

  options: {
    service: '',                  // Name of the service
    showAvailableFormats: false,  // If all available format link should appear or not
    fileExtensions: [],           // File extensions
    acceptSync: false,            // Accept sync this service?
    fileAttrs: {                  // Attributes or changes for service list or selected file:
      ext: false,                 // If files should show extension
      title: 'filename',          // Title attribute
      description: '<%- size %>', // Description attribute
      formatDescription: 'size',  // If any format function should be applied over the description
      headerTemplate: ''          // Header template
    }
  },

  initialize: function() {
    if (!this.options.service) {
      cdb.log.info('Service provider not set for import panel!')
      return false;
    } else {
      this._DATASOURCE_NAME = this.options.service;
    }

    this.user = this.options.user;
    this.model = new UploadModel({
      type: 'service',
      service_name: this._DATASOURCE_NAME
    }, { user: this.user });

    this.template = cdb.templates.getTemplate('common/views/create/listing/import_types/import_service');

    this._initModels();
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();
    this.$el.html(this.template(this.options));
    this._initViews();
    return this;
  },

  _initModels: function() {
    // Token
    this.token = new ServiceToken(null, { datasource_name: this._DATASOURCE_NAME });
    // Service model
    this.service = new ServiceOauth(null, { datasource_name: this._DATASOURCE_NAME });
    // List collection
    this.collection = new ServiceCollection(null, { datasource_name: this._DATASOURCE_NAME });
  },

  _initBinds: function() {
    this.model.bind('change', this._triggerChange, this);
    this.model.bind('change:state', this._checkState, this);
    this.token.bind('change:oauth_valid', this._onOauthChange, this);
    this.service.bind('change:url', this._openWindow, this);
    this.add_related_model(this.service);
    this.add_related_model(this.token);
  },

  _initViews: function() {
    // Header
    var header = new ServiceHeader({
      el: this.$('.ImportPanel-header'),
      user: this.user,
      model: this.model,
      collection: this.collection,
      title: this.options.title,
      showAvailableFormats: this.options.showAvailableFormats,
      fileExtensions: this.options.fileExtensions,
      acceptSync: this.options.acceptSync,
      template: this.options.headerTemplate
    });
    header.render();
    this.addView(header);

    // Loader
    var loader = new ServiceLoader({
      el: this.$('.ServiceLoader'),
      model: this.model,
      token: this.token,
      service: this.service
    });
    loader.render();
    this.addView(loader);

    // List
    var list = new ServiceList({
      el: this.$('.ServiceList'),
      model: this.model,
      collection: this.collection,
      title: this.options.title,
      fileAttrs: this.options.fileAttrs
    });
    list.render();
    this.addView(list);

    // Selected file
    var selected = new ServiceSelectedFile({
      el: this.$('.ServiceSelected'),
      user: this.user,
      model: this.model,
      acceptSync: this.options.acceptSync,
      fileAttrs: this.options.fileAttrs
    });
    selected.render();
    this.addView(selected);
  },

  _onOauthChange: function() {
    if (this.token.get('oauth_valid')) {
      this._getFiles();
    }
  },

  _getFiles: function() {
    var self = this;

    this.model.set('state', 'retrieving');

    this.collection.fetch({
      // data: {
      //   filter: this.options.acceptFileTypes
      // },
      error: function() {
        self.model.set('state', 'error');
      },
      success:  function() {
        self.model.set('state', 'list');
      }
    });
  },

  _checkState: function() {
    if (this.model.get('state') === "list") {
      if (this.collection.size() === 1) {
        var item = this.collection.at(0);
        this.model.set({
          state: 'selected',
          value: item.toJSON(),
          service_item_id: item.get('id')
        });
      }
    }
    if (this.model.get('state') !== "selected") {
      this.model.set({
        value: '',
        service_item_id: '',
        interval: 0
      });
    }
  },

  _openWindow: function() {
    var url = this.service.get('url');
    var self = this;
    var i = window.open(url, null, "menubar=no,toolbar=no,width=600,height=495");
    var e = window.setInterval(function() {
      if (i && i.closed) {
        self._getFiles();
        clearInterval(e)
      } else if (!i) {
        self.model.set('state', 'error');
        clearInterval(e)
      }
    }, this._WINDOW_INTERVAL);
  }

})

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../../../background_polling/models/upload_model":15,"../../../../../service_models/service_oauth_model":207,"../../../../../service_models/service_token_model":208,"../import_default_view":74,"../import_selected_dataset_view":75,"./service_header_view":77,"./service_items_collection":80,"./service_list_view":82,"./service_loader_view":83}],77:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 *  Service header
 *
 *  - It will change when upload state changes
 *  - Possibility to change state with a header button
 *
 */

module.exports = cdb.core.View.extend({

  events: {
    'click .js-back': '_goToList'
  },

  options: {
    title: 'Service',
    showAvailableFormats: false,
    acceptSync: false,
    fileExtensions: [],
    template: ''
  },

  initialize: function() {
    this.user = this.options.user;
    this.template = cdb.templates.getTemplate( this.options.template || 'common/views/create/listing/import_types/service_header' );
    this._initBinds();
  },

  render: function() {
    this.$el.html(
      this.template({
        items: this.collection.size(),
        service_name: this.model.get("service_name"),
        showAvailableFormats: this.options.showAvailableFormats,
        fileExtensions: this.options.fileExtensions,
        acceptSync: this.options.acceptSync && this.user.get('actions').sync_tables,
        state: this.model.get('state'),
        title: this.options.title
      })
    );
    this._checkVisibility();
    return this;
  },

  _initBinds: function() {
    this.model.bind('change:state', this.render, this);
  },

  _checkVisibility: function() {
    var state = this.model.get('state');
    this[ state !== "list" ? 'show' : 'hide' ]()
  },

  _goToList: function() {
    this.model.set('state', 'list');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],78:[function(require,module,exports){
(function (global){
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);

/**
 *  Service list item format utils
 *
 *  - Create customized functions for service list items.
 *
 */

module.exports = {

  // Due to the fact that backend data source service
  // returns 0 size when it doesn't know it
  formatSize: function(s) {
    if (s && s > 0) {
      return Utils.readablizeBytes(s);
    } else {
      return 'Unknown'
    }
  }

}
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],79:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 *  Service item model
 *
 */

module.exports = cdb.core.Model.extend({
  
  defaults: {
    id: '',
    filename: '',
    checksum: '',
    service: '',
    size: '',
    title: ''
  }

});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],80:[function(require,module,exports){
(function (global){
var ServiceItem = require('./service_item_model.js');
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);

/**
 *  Service item model + Service items collection
 *
 *  - It needs a datasource name or it won't work.
 *
 */

module.exports = Backbone.Collection.extend({

  _DATASOURCE_NAME: 'dropbox',

  model: ServiceItem,

  initialize: function(coll, opts) {
    if (opts.datasource_name) {
      this._DATASOURCE_NAME = opts.datasource_name;
    }
  },

  fetch: function() {
    this.trigger("fetch", this);

    // Pass through to original fetch.
    return Backbone.Collection.prototype.fetch.apply(this, arguments);
  },

  parse: function(r) {
    return r.files;
  },

  url: function(method) {
    var version = cdb.config.urlVersion('imports_service', method);
    return '/api/' + version + '/imports/service/' + this._DATASOURCE_NAME + '/list_files'
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./service_item_model.js":79}],81:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var ServiceUtilsFormat = require('./service_item_description_format');
var pluralizeString = require('../../../../../view_helpers/pluralize_string');

/**
 *  Service list item view
 *
 *  - Displays the item info.
 *  - It lets user to select the item for a future import.
 *
 */

module.exports = cdb.core.View.extend({

  options: {
    title: '',
    fileAttrs: {
      ext: false,
      title: 'filename',
      description: 'size',
      itemName: 'file',
      formatDescription: ''
    }
  },

  _FORMATTERS: {
    'size': ServiceUtilsFormat.formatSize,
    'number': Utils.formatNumber
  },

  className: 'ServiceList-item',
  tagName: 'li',

  events: {
    'click .js-choose': '_onSelectItem'
  },

  initialize: function() {
    this.template = cdb.templates.getTemplate('common/views/create/listing/import_types/service_list_item');
  },

  render: function() {
    var title = this.model.get(this.options.fileAttrs.title);
    var description = this._genDescription();
    var ext = this.options.fileAttrs.ext ? Utils.getFileExtension(title) : '' ;

    if (this.options.fileAttrs.ext) {
      title = title && title.replace('.' + ext, '');
    }

    this.$el.html(
      this.template({
        name: this.options.title,
        ext: ext,
        title: title,
        description: description
      })
    );
    return this;
  },

  _genDescription: function() {
    if (this.options.fileAttrs && this.options.fileAttrs.description) {
      var descriptionOpts = this.options.fileAttrs.description;
      var descriptionKeyValue = '';
      var descriptionStr = '';
      var self = this;

      if (descriptionOpts.content && descriptionOpts.content.length > 0) {
        _.each(descriptionOpts.content, function(item, i) {

          if (i > 0 && descriptionOpts.separator) {
            descriptionStr += " " + descriptionOpts.separator + ' ';
          }

          var value = self.model.get(item.name);
          var format = item.format && self._FORMATTERS[item.format];
          descriptionStr += format && format(value) || value;

          if (item.key) {
            descriptionKeyValue = item.name;
          }
        })
      }

      if (descriptionOpts.itemName && descriptionKeyValue) {
        descriptionStr += ' ' + (descriptionOpts.itemName && pluralizeString(descriptionOpts.itemName, descriptionKeyValue) || '');
      }

      return descriptionStr;
    }

    return '';
  },

  _onSelectItem: function() {
    this.trigger('selected', this.model, this);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../../../view_helpers/pluralize_string":211,"./service_item_description_format":78}],82:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ServiceListItem = require('./service_list_item_view');
var pluralizeString = require('../../../../../view_helpers/pluralize_string');

/**
 *  Service list view
 *
 *  - It will display all the items available under
 *  the service and the possibility to chose one of
 *  them.
 *
 */

module.exports = cdb.core.View.extend({

  _TEXTS: {
    item: _t('item')
  },

  options: {
    title: 'service',
    fileAttrs: {}
  },

  initialize: function() {
    this.template = cdb.templates.getTemplate('common/views/create/listing/import_types/service_list');
    this._initBinds();
    this._checkVisibility();
  },

  render: function() {
    this.clearSubViews();
    var size = this.collection.size();
    this.$el.html(
      this.template({
        size: size,
        title: this.options.title,
        pluralize: pluralizeString(this._TEXTS.item, size)
      })
    );
    if (this.collection.size() > 0) {
      this.collection.each(this._addItem, this);
    }
    return this;
  },

  _initBinds: function() {
    this.collection.bind('reset', this.render, this);
    this.model.bind('change:state', this._checkVisibility, this);
    this.add_related_model(this.collection);
  },

  _addItem: function(m) {
    var item = new ServiceListItem({
      model: m,
      title: this.options.title,
      fileAttrs: this.options.fileAttrs
    });
    item.bind('selected', this._onSelectedItem, this);
    this.$('.ServiceList-items').append(item.render().el);
    this.addView(item);
  },

  _onSelectedItem: function(mdl) {
    this.model.set({
      state: 'selected',
      value: mdl.toJSON(),
      service_item_id: mdl.get('id')
    });
  },

  _checkVisibility: function() {
    var state = this.model.get('state');
    if (state === 'list') {
      this.show();
    } else {
      this.hide();
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../../../view_helpers/pluralize_string":211,"./service_list_item_view":81}],83:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 *  Service loader view
 *
 *  - It will be on charge to make token and oauth petitions
 *
 */

module.exports = cdb.core.View.extend({

  events: {
    'click .js-connect': '_checkToken'
  },

  initialize: function() {
    this.token = this.options.token;
    this.service = this.options.service;
    this.template = cdb.templates.getTemplate('common/views/create/listing/import_types/service_loader');
    this._initBinds();
    this._checkVisibility();
  },

  render: function() {
    this.$el.html(
      this.template({
        service_name: this.model.get('service_name'),
        state: this.model.get('state')
      })
    );
    return this;
  },

  _initBinds: function() {
    this.model.bind('change:state', this.render, this);
    this.model.bind('change:state', this._checkVisibility, this);
  },

  _checkToken: function() {
    var self = this;
    this.model.set('state', 'token');

    var self = this;
    this.token.fetch({
      success: function(r) {
        if (!r.get('oauth_valid')) {
          self._getOauthURL();
        }
      },
      error: function(e) {
        self._getOauthURL();
      }
    });
  },

  _checkVisibility: function() {
    var state = this.model.get('state');
    if (state !== 'list' && state !== 'selected') {
      this.show();
    } else {
      this.hide();
    }
  },

  _getOauthURL: function() {
    var self = this;
    this.model.set('state', 'oauth');
    this.service.set({ url: '' }, { silent: true });
    this.service.fetch({
      error: function() {
        self.model.set('state', 'error');
      }
    });
  }

})
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],84:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);

/**
 *  Credits info view
 *
 *  - Percentage of use
 *  - Possible money spent
 *
 */

module.exports = cdb.core.View.extend({

  initialize: function() {
    this.user = this.options.user;
    this._initBinds();
    this.template = cdb.templates.getTemplate('common/views/create/listing/import_types/credits_info');
  },

  render: function() {
    var twitterData = this.user.get('twitter');
    var remaining = twitterData.quota - twitterData.monthly_use;
    var per = Math.min(100,Math.ceil((this.model.get('value') * 100) / remaining));

    this.$el.html(
      this.template({
        value: this.model.get('value'),
        remaining: remaining,
        per: per,
        hardLimit: twitterData.hard_limit,
        remainingFormatted: Utils.formatNumber(remaining),
        quota: twitterData.quota,
        block_price: twitterData.block_price,
        block_size: Utils.readizableNumber(twitterData.block_size)
      })
    )
    return this;
  },

  _initBinds: function() {
    this.model.bind('change', this.render, this);
  }

});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],85:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var CreditsInfo = require('./credits_info_view');

/**
 *  Set max use of credits for Twitter
 *
 *  - Slider range = 1000 credits
 *  - Last step should be infinite if user doesn't
 *    have "soft_limit".
 *
 */

module.exports = cdb.core.View.extend({

  _DEFAULT_PER_VALUE: 80, // Default percentage value for slider
  _MIN_PER_VALUE: 1,      // Default min percentage value for slider

  initialize: function() {
    this._disabled = (this.options && this.options.disabled) ? this.options.disabled : false;    
    
    this.user = this.options.user;
    this.model = new cdb.core.Model();
    this._initBinds();
    this._setModel();
  },

  render: function() {
    this.clearSubViews();
    this.$(".js-slider").slider("destroy");
    this._initViews();
    return this;
  },

  _initBinds: function() {
    _.bindAll(this, '_onSlideChange');
    this.model.bind('change:value', this._onValueChange, this);
  },

  _setModel: function() {
    var twitterData = this.user.get('twitter');
    var max = twitterData.quota - twitterData.monthly_use;
    var min =  (this._MIN_PER_VALUE * max) / 100; // Just 1% of the quota
    var defaultValue = (max * this._DEFAULT_PER_VALUE) / 100;
    var value = max > 0 ? defaultValue : (max + 1);
    
    var self = this;    
    this.model.set({
      max: (twitterData.hard_limit ? max : max + 1 ),
      min: min,
      step: min,
      value: max > 0 ? value : twitterData.quota,
      disabled: self._disabled || max <= 0
    });
  },

  _initViews: function() {
    this._setModel();
    // Slider
    this.$(".js-slider").slider(
      _.extend({
          range: 'min',
          orientation: "horizontal",
          slide: this._onSlideChange,
          change: this._onSlideChange
        },
        this.model.attributes
      )
    );

    // Info
    var creditsInfo = new CreditsInfo({
      el: this.$('.js-info'),
      user: this.user,
      model: this.model
    });
    creditsInfo.render();
    this.addView(creditsInfo);
  },

  _onSlideChange: function(ev, ui) {
    this.model.set('value', ui.value);
  },

  _onValueChange: function() {
    this.trigger('maxCreditsChange', this.getMaxCredits(), this);
  },

  getMaxCredits: function() {
    var twitterData = this.user.get('twitter');
    var max = twitterData.quota - twitterData.monthly_use;
    var value = this.model.get('value');
    return value > max ? 0 : value
  }

});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./credits_info_view":84}],86:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var ImportDefaultView = require('../../../../../dialogs/create/listing/imports/import_default_view');
var UploadModel = require('../../../../../background_polling/models/upload_model');
var DatesRangePicker = require('../../../../../views/date_pickers/dates_range_picker');
var TwitterCategories = require('../../../../../dialogs/create/listing/imports/twitter_import/twitter_categories/twitter_categories_view');
var CreditsUsage = require('./credits_usage_view.js');

/**
 *  Import twitter panel
 *
 *  - It accepts up to 3 categories
 *  - Date range can't be longer than 30 days
 *
 */

module.exports = ImportDefaultView.extend({

  options: {
    acceptSync: false,
    type: 'service',
    service: 'twitter_search'
  },

  className: 'ImportPanel ImportTwitterPanel',

  initialize: function() {
    this.user = this.options.user;
    this.model = new UploadModel({
      type: this.options.type,
      service_name: this.options.service
    }, {
      user: this.user
    });

    this.template = cdb.templates.getTemplate('common/views/create/listing/import_types/import_twitter');

    this._initBinds();
  },

  _disabledDueLackOfCredentials: function () {
    return !this.user.hasOwnTwitterCredentials();
  },

  render: function() {
    this.clearSubViews();
    this.$el.html(this.template());
    this._initViews();
    return this;
  },

  _initViews: function() {
    // Categories
    var categories = this.categories = new TwitterCategories({
      disabled: this._disabledDueLackOfCredentials()
    });
    categories.bind('changeCategory', this._setModel, this);
    this.$('.ImportTwitterPanel-categories').append(categories.render().el);
    this.addView(categories);

    // Date picker
    var datepicker = this.datepicker = new DatesRangePicker({
      className: 'DatePicker DatePicker--withBorder',
      disabled: this._disabledDueLackOfCredentials()      
    });
    datepicker.bind('changeDate', this._setModel, this);
    this.$('.js-picker').append(datepicker.render().el);
    this.addView(datepicker);

    // Use slider
    var creditsUsage = this.creditsUsage = new CreditsUsage({
      el: this.$('.CreditsUsage'),
      user: this.user,
      disabled: this._disabledDueLackOfCredentials()      
    });
    creditsUsage.bind('maxCreditsChange', this._setModel, this);
    creditsUsage.render();
    this.addView(creditsUsage);

    this._setModel();
  },

  _initBinds: function() {
    this.model.bind('change', this._triggerChange, this);
  },

  _getCategories: function() {
    var categories = this.categories.getCategories();
    return _.filter(categories, function(c) {
      return c.category && c.terms.length > 0
    });
  },

  _getDates: function() {
    return this.datepicker.getDates();
  },

  _getMaxCredits: function() {
    return this.creditsUsage.getMaxCredits();
  },

  _setModel: function() {
    var categories = this._getCategories();
    var dates = this._getDates();
    var maxCredits = this._getMaxCredits();
    var d = {
      categories: categories,
      dates: dates
    };

    this.model.set({
      value: d,
      service_item_id: d,
      user_defined_limits: {
        twitter_credits_limit: maxCredits
      }
    });
  }

})

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../../../background_polling/models/upload_model":15,"../../../../../dialogs/create/listing/imports/import_default_view":74,"../../../../../dialogs/create/listing/imports/twitter_import/twitter_categories/twitter_categories_view":88,"../../../../../views/date_pickers/dates_range_picker":214,"./credits_usage_view.js":85}],87:[function(require,module,exports){
(function (global){
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var TwitterCategoryModel = require('./twitter_category_model');
  
// Twitter categories collection

module.exports = Backbone.Collection.extend({
  model: TwitterCategoryModel
});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./twitter_category_model":89}],88:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var TwitterCategoriesCollection = require('./twitter_categories_collection');
var TwitterCategoriesModel = require('./twitter_category_model');
var TwitterCategoryView = require('./twitter_category_view');

/**
 *  Twitter category list view
 *  - It will generate a collection to store all the 
 *    terms added.
 */

module.exports = cdb.core.View.extend({

  _MAX_CATEGORIES: 4,
  _MAX_TERMS: 29,

  initialize: function() {
    this._disabled = (this.options && this.options.disabled) ? this.options.disabled : false;
    
    // Add a first empty model
    var m = this._generateCategory();
    this.collection = new TwitterCategoriesCollection([ m ]);

    this._initBinds();
  },

  render: function() {
    this.clearSubViews();
    this.collection.each(this._addCategory, this);
    return this;
  },

  _initBinds: function() {
    this.collection.bind('change', this._manageCategories, this);
    this.collection.bind('change', this._onCategoryChange, this);
    this.add_related_model(this.collection);
  },

  _manageCategories: function() {
    var self = this;
    var collection_size = this.collection.size();

    // Check if already created models are completed
    var nonFilled = this.collection.filter(function(m) {
      return m.get('terms').length === 0
    });

    // if so, generate new one
    if (nonFilled.length === 0 && collection_size < this._MAX_CATEGORIES) {
      var m = this._generateCategory();
      this.collection.add(m);
      this._addCategory(m);
      return false;
    }

    // else, let's check
    if (nonFilled.length > 0) {
      var m = _.first(nonFilled);
      var v = _.find(this._subviews, function(view){ return m.cid === view.model.cid });
      var pos = v.$el.index();
      
      // Only one item in the collection, do nothing
      if (collection_size === 1) return false;

      // If it is the last item but there is no more items, do nothing
      if (pos === (collection_size - 1)) return false;

      // If it is not the last item and there is another non-filled element
      // let's remove that one.
      if (pos !== (collection_size - 1) && nonFilled.length > 1) {
        m = nonFilled[1];
        v = _.find(this._subviews, function(view){ return m.cid === view.model.cid });
        this._removeCategory(v);
      }

      // Reorder category indexes :(
      this._setCategoryIndex();
    }
  },

  // Set proper index after any category removed
  _setCategoryIndex: function() {
    var self = this;

    // Hack to set properly category numbers
    this.$('.twitter-category').each(function(i,el) {
      // Get category, removing Category word
      var category = $(el).find('.js-category').text().replace('Category ','');

      if (category !== (i+1) ) {
        // Find model
        var m = self.collection.find(function(m) { return m.get('category') === category });
        // Find view
        m.set('category', (i+1).toString() );  
      }
      
    })
  },

  _generateCategory: function() {
    return new TwitterCategoriesModel({
      disabled: this._disabled,
      terms: [],
      category: (this.collection ? ( this.collection.size() + 1 ) : 1 ).toString()
    });
  },

  _addCategory: function(m) {
    var category = new TwitterCategoryView({ model: m });
    
    category.bind('submit', this._onCategorySubmit, this);
    category.bind('limit', this._onCategoryLimit, this);
    category.bind('nolimit', this._onCategoryNoLimit, this);

    this.$el.append(category.render().el);
    
    this.addView(category);
    this.trigger("addCategory");
  },

  _removeCategory: function(v) {
    v.hide();
    v.clean();
    v.model.destroy();
    this.trigger("removeCategory");
  },

  _onCategorySubmit: function() {
    this.trigger('submitCategory', this.collection.toJSON(), this);
  },

  _onCategoryLimit: function() {
    this.trigger('limitCategory', this.collection.toJSON(), this);
  },

  _onCategoryNoLimit: function() {
    this.trigger('noLimitCategory', this.collection.toJSON(), this);
  },

  _onCategoryChange: function() {
    this.trigger('changeCategory', this.collection.toJSON(), this);
  },

  getCategories: function() {
    return this.collection.toJSON();
  }

});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./twitter_categories_collection":87,"./twitter_category_model":89,"./twitter_category_view":90}],89:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

// Twitter category model

module.exports = cdb.core.Model.extend({

  _MAX_COUNTER: 1014,

  _CHAR_MAP: {
    ' ': 2,
    '-': 2,
    '_': 2,
    '.': 2
  },
  
  defaults: {
    terms:    [],
    category: '',
    counter:  1014
  },

  initialize: function() {
    this._initBinds();
  },

  _initBinds: function() {
    this.bind('change:terms', this._setCounter, this);
  },

  _setCounter: function() {
    var count = this._MAX_COUNTER;
    var self = this;

    // Check terms number
    if (this.get('terms').length > 1) {
      count = count - ( ( this.get('terms').length - 1 ) * 4 )
    }

    // Check characters
    _.each(this.get('terms'), function(term) {
      _.each(term, function(c) {
        if (self._CHAR_MAP[c] !== undefined) {
          count = count - self._CHAR_MAP[c];
        } else {
          count--
        }
      });
    });

    // Count never should be fewer then 0 please!
    this.set('counter', Math.max(0,count));
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],90:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);


/**
 *  Twitter category item view
 *  - It just needs a twitter category model
 */

module.exports = cdb.core.View.extend({

  className: 'TwitterCategory',

  _MAX_CATEGORIES: 4,
  _MAX_TERMS: 29,

  events: {
    'keydown .js-terms':   '_onInputChange',
    'keypress .js-terms':  '_onInputChange',
    'keyup .js-terms':     '_onInputChange'
  },

  initialize: function() {
    this.template = cdb.templates.getTemplate('common/views/create/listing/import_types/twitter_category');
    this._initBinds();
  },

  render: function() {
    this.$el.append(
      this.template({
        disabled: this.model.get('disabled'),        
        terms: this.model.get('terms'),
        category: this.model.get('category'),
        counter: this.model.get('counter')
      })
    );

    // Show category
    this.show();

    return this;
  },

  _initBinds: function() {
    _.bindAll(this, '_onInputChange');
    this.model.bind('change:category', this._onCategoryChange, this);
  },

  _onCategoryChange: function() {
    this.$('.js-category').text('Category ' + this.model.get('category'));
  },

  _onInputChange: function(e) {
    var value = $(e.target).val();

    // It was a ENTER key event? Send signal!
    if (e.keyCode === 13) {
      e.preventDefault();
      this.trigger('submit', this.model, this);
      return false;
    }

    // Change icon class
    this.$('.CDB-IconFont-twitter')[value.length > 0 ? 'addClass' : 'removeClass']('is-highlighted');

    // Check if it is possible to add new characters
    // if not, stop the action, unless user is deleting
    // any previous character
    if (( this.model.get('counter') === 0 || this.model.get('terms').length > this._MAX_TERMS) &&
      e.keyCode !== 37 /* left */ && e.keyCode !== 39 /* right */ && e.keyCode !== 8 && value.length > 0) {
      this.killEvent(e);
      this.trigger('limit', this.model, this);
      return false;
    } else {
      this.trigger('nolimit', this.model, this);
    }

    var $input = $(e.target);
    var value = $input.val();
    var d = {};

    // Get valid terms array
    if (!value) {
      value = [];
    } else {
      value = value.split(',');
    }

    d['terms'] = value;

    this.model.set(d);
  },

  show: function() {
    this.$el.addClass('enabled');
  },

  hide: function() {
    this.$el.removeClass('enabled');
  }

});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],91:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var ImportOptions = require('./import_options');
var ImportFallback = require('./imports/import_default_fallback_view');
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 *  Imports view
 *
 *  Displays all the import options available
 *  through new create dialog.
 *
 *  IMPORTANT!!
 *
 *  If you need to add a new import pane:
 *
 *  - Create the proper class within imports folder and its tests.
 *  - Add necessary info in import_options file.
 *  - Create a check function here if needed, if not will appear
 *    always enabled (for everybody!).
 *
 */
module.exports = cdb.core.View.extend({
  className: 'ImportOptions',

  _TABS_PER_ROW: 5,
  _DEFAULT_IMPORT: 'file',
  _IMPORT_OPTIONS: ImportOptions,

  _TEXTS: {
    key: _t('<%- name %> key is not specified and panel can\'t be enabled'),
    account: _t('<%- name %> data source is not available in your plan. Please upgrade'),
    limits: _t('You\'ve reached the limits for your account. Please upgrade'),
    credits: _t('You\'ve reached the available <%- name %> credits for your account this month')
  },

  events: {
    'click .js-goNext': '_moveNextTabs',
    'click .js-goPrev': '_movePrevTabs'
  },

  initialize: function () {
    this.user = this.options.user;
    this.model = new cdb.core.Model({ page: 1, maxPages: 0 });
    this.createModel = this.options.createModel;
    this.template = cdb.templates.getTemplate('common/views/create/listing/import_view');
  },

  render: function () {
    this._destroyBinds();
    this.clearSubViews();
    this.$el.empty();

    // Append template content
    this.$el.append(this.template());
    // Generate tabs!
    this._genTabs();
    // Generate tabs navigation
    this._genTabsNavigation();
    // Generate panes!
    this._genPanes();
    // Set binds
    this._initBinds();
    // Set option
    this._setOption();

    return this;
  },

  /**
   *  TABS && PANES!
   */
  _genTabs: function () {
    var tabs = '';
    var tabTemplate = cdb.templates.getTemplate('common/views/create/listing/import_tab');

    _.each(this._IMPORT_OPTIONS, function (tab) {
      if (!_.isEmpty(tab) && tab.enabled(cdb.config, this.user)) {
        tabs += tabTemplate(tab);
      }
    }, this);

    this.$('.ImportOptions-tabsList').append(tabs);

    // Create tabs
    this.importTabs = new cdb.admin.Tabs({
      el: this.$('.ImportOptions-tabsList'),
      slash: true
    });
    this.addView(this.importTabs);
  },

  _genTabsNavigation: function () {
    var numTabs = this.$('.ImportOptions-tab').size();
    if (numTabs <= 1) {
      this.$('.ImportOptions-tabs').hide();
    }

    // Set max pages
    this.model.set('maxPages', Math.ceil(numTabs / this._TABS_PER_ROW));
    this._checkTabsNavigation();
    if (this.model.get('maxPages') <= 1) {
      this.$('.ImportOptions-navigation').hide();
    }
  },

  _moveNextTabs: function () {
    var page = this.model.get('page');
    var maxPages = this.model.get('maxPages');

    if (page < maxPages) {
      this.model.set('page', page + 1);
    }
  },

  _movePrevTabs: function () {
    var page = this.model.get('page');
    if (page > 1) {
      this.model.set('page', page - 1);
    }
  },

  _moveTabsNavigation: function () {
    var page = this.model.get('page');
    var rowWidth = 800;

    this.$('.ImportOptions-tabsList').css('margin-left', '-' + (rowWidth * (page - 1)) + 'px');
    this._checkTabsNavigation();
  },

  _checkTabsNavigation: function () {
    var page = this.model.get('page');
    var maxPages = this.model.get('maxPages');

    // Check prev button
    this.$('.js-goPrev')[ page > 1 ? 'removeClass' : 'addClass' ]('is-disabled');

    // Check next button
    this.$('.js-goNext')[ page < maxPages ? 'removeClass' : 'addClass' ]('is-disabled');
  },

  _genPanes: function () {
    var self = this;

    // Create TabPane
    this.importPanes = new cdb.ui.common.TabPane({
      el: this.$('.ImportOptions-panes')
    });
    this.addView(this.importPanes);

    // Link tabs with panes
    this.importTabs.linkToPanel(this.importPanes);

    // Render panes!
    _.each(this._IMPORT_OPTIONS, function (Imp, i) {
      var pane = '';

      // Check if import option function exists
      var fn = self['_check' + i + 'Import'];
      var isEnabled = (fn && fn(Imp, self));

      if ((isEnabled || isEnabled === undefined) && !_.isEmpty(Imp)) {
        pane = new Imp.ClassName(
          _.extend(
            (Imp.options || {}), {
              user: self.user,
              title: Imp.title
            }
          )
        );
      } else if (Imp.fallback) {
        pane = new ImportFallback({
          template: Imp.fallback
        });
      }

      if (pane) {
        pane.render();
        pane.bind('change', self._setUploadModel, self);
        self.importPanes.addTab(Imp.name, pane);
        self.addView(pane);
      }
    });
  },

  _checkGDriveImport: function (imp, v) {
    if (!cdb.config.get('oauth_gdrive')) {
      v._setFailedTab('gdrive', 'key');
      return false;
    }
    return true;
  },

  _checkDropboxImport: function (imp, v) {
    if (!cdb.config.get('oauth_dropbox')) {
      v._setFailedTab('dropbox', 'key');
      return false;
    }
    return true;
  },

  _checkBoxImport: function (imp, v) {
    if (!cdb.config.get('oauth_box')) {
      v._setFailedTab('box', 'key');
      return false;
    }
    return true;
  },

  _checkTwitterImport: function (imp, v) {
    // Check if user have twitter datasource enabled!
    if (!cdb.config.get('datasource_search_twitter')) {
      v._setFailedTab('twitter', 'key');
      return false;
    }

    // Check if user can create or import a new file or user has
    // enough rights to enable twitter!
    if (!v.user.get('twitter').enabled) {
      return false;
    }

    // Check if user can create or import a new file or user has
    // enough rights to enable twitter!
    if ((v.user.get('twitter').quota - v.user.get('twitter').monthly_use) <= 0 && v.user.get('twitter').hard_limit) {
      v._setFailedTab('twitter', 'credits');
      return false;
    }

    return true;
  },

  _checkInstagramImport: function (imp, v) {
    if (!v.user.featureEnabled('instagram_import')) {
      return false;
    }
    if (!cdb.config.get('oauth_instagram')) {
      v._setFailedTab('instagram', 'key');
      return false;
    }
    return true;
  },

  _checkSalesforceImport: function (imp, v) {
    // Connector is now disabled for everyone.
    // You can use the following check to determine if
    // user/org has this connector enabled:
    // v.user.get('salesforce').enabled
    return false;
  },

  _checkMailchimpImport: function (imp, v) {
    // Config available?
    if (!cdb.config.get('oauth_mailchimp')) {
      v._setFailedTab('mailchimp', 'key');
      return false;
    }
    // Feature enabled?
    if (!v.user.featureEnabled('mailchimp_import')) {
      return false;
    }
    return true;
  },

  _setFailedTab: function (tab, type) {
    var $tab = this.importTabs.getTab(tab);
    $tab.addClass('disabled');
    this._createTooltip(tab, type);
  },

  _createTooltip: function (tab, type) {
    var self = this;
    var $tab = this.importTabs.getTab(tab);

    // Tipsy?
    var tooltip = new cdb.common.TipsyTooltip({
      el: $tab,
      title: function () {
        return _.template(self._TEXTS[type])({ name: tab });
      }
    });

    this.addView(tooltip);
  },

  _setUploadModel: function (d) {
    this.createModel.upload.setFresh(d);
  },

  _initBinds: function () {
    this.model.bind('change:page', this._moveTabsNavigation, this);
    if (this.importPanes) {
      this.importPanes.bind('tabEnabled', this._onTabChange, this);
    }
  },

  _destroyBinds: function () {
    if (this.importPanes) {
      this.importPanes.unbind('tabEnabled', null, this);
    }
  },

  _setOption: function () {
    // First option > data file
    this.importPanes.active(this._DEFAULT_IMPORT);
    this._updateImportOption();
  },

  _updateImportOption: function () {
    this.createModel.setActiveImportPane(this.importPanes.activeTab);
  },

  /**
   *  EVENTS
   */
  _onTabChange: function (tabName) {
    var v = this.importPanes.getPane(tabName);
    // Set upload model from activated pane to create model
    var upload = v.getModelData && v.getModelData();
    if (upload) {
      this._setUploadModel(upload);
    } else {
      this._setUploadModel({});
    }
    this._updateImportOption();
  },

  clean: function () {
    this._destroyBinds();
    cdb.core.View.prototype.clean.call(this);
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./import_options":67,"./imports/import_default_fallback_view":73}],92:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var pluralizeString = require('../../../view_helpers/pluralize_string');

/**
 *  Listing datasets navigation.
 *
 *  - 'Filter by' datasets.
 *  - 'Search' any pattern within dataset collection.
 *
 */
module.exports = cdb.core.View.extend({

  events: {
    'submit .js-search-form':   '_submitSearch',
    'keydown .js-search-form':  '_onSearchKeyDown',
    'click .js-search-form':    'killEvent',
    'click .js-search-link':    '_onSearchClick',
    'click .js-clean-search':   '_onCleanSearchClick',
    'click .js-shared':         '_onSharedClick',
    'click .js-library':        '_onLibraryClick',
    'click .js-connect':        '_onConnectClick',
    'click .js-datasets':       '_onDatasetsClick',
    'click .js-create_empty':   '_onCreateEmptyClick'
  },

  _TEXTS: {
    createFromScratchLabel: {
      map: 'Create empty map',
      dataset: 'Create empty dataset',
      addLayer: 'Add an empty layer'
    }
  },

  initialize: function() {
    this.routerModel = this.options.routerModel;
    this.createModel = this.options.createModel;
    this.user = this.options.user;
    this.template = cdb.templates.getTemplate('common/views/create/listing/navigation');
    this.model = new cdb.core.Model();

    this._preRender();
    this._initBinds();
  },

  // It is necessary to add two static elements because
  // they can't be removed/replaced using render method
  // each time a change (in a model or a collection) happens.
  // This is due to the behaviour of the CSS animations.
  _preRender: function() {
    var $uInner = $('<div>').addClass('u-inner');
    var $filtersInner = $('<div>').addClass('Filters-inner');
    this.$el.append($uInner.append($filtersInner));
  },

  render: function(m, c) {
    if (this.tooltipView) {
      this.tooltipView.clean();
    }

    this.clearSubViews();

    var selectedItemsCount = this._selectedItems().length;
    // If a change is made from content type we have to know
    // preventing show wrong data about total items
    var changedContentType = c && c.changes && c.changes.content_type;
    var createModelType = this.createModel.get('type');

    this.$('.Filters-inner').html(
      this.template(
        _.extend({
            createModel:           this.createModel,
            canCreateDataset:      this.user.canCreateDatasets(),
            listing:               this.createModel.get('listing'),
            isInsideOrg:           this.user.isInsideOrg(),
            selectedItemsCount:    selectedItemsCount,
            maxLayersByMap:        this.user.getMaxLayers(),
            totalShared:           changedContentType ? 0 : this.collection.total_shared,
            pageItems:             this.collection.size(),
            routerModel:           this.routerModel,
            createFromScratchLabel: this._TEXTS.createFromScratchLabel[createModelType],
            datasetsTabDisabled: this._datasetsTabDisabled(),
            hasDataLibrary: cdb.config.get('data_library_enabled')
          },
          this.routerModel.attributes
        )
      )
    );

    if(this._datasetsTabDisabled()) {
      this.tooltipView = new cdb.common.TipsyTooltip({
        el: this.$('.js-datasets'),
        title: function () {
          return _t('There are no datasets connected to your account');
        }
      });
      this.addView(this.tooltipView);
    }

    this._animate();
    if (this.routerModel.isSearching()) {
      this._focusSearchInput();
    }

    return this;
  },

  _initBinds: function() {
    this.model.on('change:isSearchEnabled', this._onChangeIsSearchEnabled, this);
    this.createModel.bind('change:listing', this.render, this);
    this.routerModel.bind('change', this.render, this);
    this.collection.bind('reset', this.render, this);
    cdb.god.bind('closeDialogs', this._animate, this);
    this.add_related_model(cdb.god);
    this.add_related_model(this.createModel);
    this.add_related_model(this.collection);
    this.add_related_model(this.routerModel);
  },

  _onChangeIsSearchEnabled: function(model, isSearchEnabled) {
    this._enableSearchUI(isSearchEnabled);

    if (this.routerModel.isSearching()) {
      this._cleanSearch();
    } else if (isSearchEnabled) {
      this._$searchInput().val('');
      this._focusSearchInput();
    }
  },

  _$searchInput: function() {
    return this.$('.js-search-input')
  },

  _focusSearchInput: function() {
    this._$searchInput()
      .select()
      .focus();
  },

  _onSearchKeyDown: function(e) {
    // ESC
    if (e.keyCode === 27) {
      this.killEvent(e);
      this._cleanSearch();
    }
  },

  _selectedItems: function() {
    return this.collection.where({ selected: true });
  },

  _animate: function() {
    this._enableSearchUI(!!this.routerModel.isSearching());

    // Check if user doesn't have any table and it is in library section
    // to remove useless shadow
    var inLibrarySection = this.routerModel.get('library');
    var inDatasetsSection = this.createModel.get('listing') === "datasets";
    var hasDatasets = this.collection.total_user_entries > 0;
    this.$el.toggleClass('no-shadow', inLibrarySection && !hasDatasets && inDatasetsSection);
  },

  _enableSearchUI: function(enable) {
    this.$('.js-search-field').toggle(enable);
    this.$('.js-links-list').toggleClass('is-hidden', enable);
    this.$('.js-order-list').toggleClass('is-hidden', enable);
  },

  _onDatasetsClick: function() {
    if (this._datasetsTabDisabled()) return;

    this.routerModel.set({
      shared: 'no',
      library: false,
      page: 1
    });
    this.createModel.set('listing', 'datasets');
  },

  _onSharedClick: function() {
    this.routerModel.set({
      shared: 'only',
      library: false,
      page: 1
    });
    this.createModel.set('listing', 'datasets');
  },

  _onLibraryClick: function() {
    this.routerModel.set({
      shared: 'no',
      library: true,
      page: 1
    });
    this.createModel.set('listing', 'datasets');

    // Event tracking "Clicked Common data"
    cdb.god.trigger('metrics', 'common_data', {
      email: window.user_data.email
    });
  },

  _onConnectClick: function() {
    if (this.user.canCreateDatasets()) {
      this.createModel.set('listing', 'import');
    }
  },

  _onCreateEmptyClick: function() {
    if (this.user.canCreateDatasets()) {
      this.createModel.createFromScratch();
    }
  },

  _datasetsTabDisabled: function () {
    return this.createModel.get('datasetsTabDisabled');
  },

  // Selection actions

  _onSearchClick: function(e) {
    if (e) this.killEvent(e);
    this.model.set('isSearchEnabled', !this.model.get('isSearchEnabled'));
  },

  // Filter actions

  _onCleanSearchClick: function(e) {
    if (e) e.preventDefault();
    this._cleanSearch();
  },

  _cleanSearch: function() {
    this.routerModel.set({
      q: '',
      tag: '',
      shared: 'no',
      library: this.createModel.showLibrary()
    });
    this.model.set('isSearchEnabled', false);
  },

  _submitSearch: function(e) {
    if (e) this.killEvent(e);
    var val = Utils.stripHTML(this.$('.js-search-input').val().trim(),'');
    var tag = val.search(':') === 0 ? val.replace(':', '') : '';
    var q = val.search(':') !== 0 ? val : '';

    this.routerModel.set({
      page: 1,
      tag: tag,
      q: q,
      shared: 'yes'
    });

    this.createModel.set('listing', 'datasets');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../view_helpers/pluralize_string":211}],93:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var ViewFactory = require('../../view_factory');
var randomQuote = require('../../view_helpers/random_quote');

/**
 * Create a vis from a dataset, required for some contexts to have a vis before be able to carry out next task
 *  - duplicate vis
 *  - add layer
 */
module.exports = BaseDialog.extend({

  initialize: function() {
    this.elder('initialize');
    if (!this.model) throw new Error('model is required (cdb.admin.Visualization)');
    if (!this.options.title) throw new Error('title is required');
    if (!this.options.explanation) throw new Error('title is required');
    if (!this.options.router) throw new Error('router callback is required');
    this._initViews();
    this._initBinds();
  },

  render_content: function() {
    return this._panes.getActivePane().render().el;
  },

  _initViews: function() {
    this._panes = new cdb.ui.common.TabPane({
      el: this.el
    });
    this.addView(this._panes);
    this._panes.addTab('confirm',
      ViewFactory.createByTemplate('common/dialogs/create_vis_first/template', {
        title: this.options.title,
        explanation: this.options.explanation
      })
    );
    this._panes.addTab('loading',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Creating map…',
        quote: randomQuote()
      })
    );
    this._panes.addTab('fail',
      ViewFactory.createByTemplate('common/templates/fail', {
        msg: 'Could not create map for some reason'
      })
    );
    this._panes.active('confirm');
  },

  _initBinds: function() {
    this._panes.bind('tabEnabled', this.render, this);
  },

  ok: function() {
    this._panes.active('loading');
    var self = this;
    this.model.changeToVisualization({
      success: function(vis) {
        self.options.router.changeToVis(vis);
        if (self.options.success) {
          self.options.success(vis);
        }
        self.clean();
      },
      error: function() {
        self._panes.active('fail');
      }
    });
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213}],94:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var ViewFactory = require('../../view_factory');
var randomQuote = require('../../view_helpers/random_quote');

module.exports = BaseDialog.extend({

  initialize: function() {
    this.elder('initialize');

    if (!this.options.table) {
      throw new Error('table is required');
    }

    if (!this.options.column) {
      throw new Error('column is required');
    }
    this._initViews();
    this._initBinds();
  },

  render_content: function() {
    return this._panes.getActivePane().render().el;
  },

  _initViews: function() {

    this.table = this.options.table;
    this.column = this.options.column;

    this._panes = new cdb.ui.common.TabPane({
      el: this.el
    });
    this.addView(this._panes);
    this._panes.addTab('confirm',
      ViewFactory.createByTemplate('common/dialogs/delete_column/template', {
        column: this.column
      })
    );
    this._panes.addTab('loading',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Deleting column…',
        quote: randomQuote()
      })
    );
    this._panes.addTab('fail',
      ViewFactory.createByTemplate('common/templates/fail', {
        msg: 'Could not delete column for some reason'
      })
    );
    this._panes.active('confirm');
  },

  _initBinds: function() {
    this._panes.bind('tabEnabled', this.render, this);
  },

  ok: function() {
    this._panes.active('loading');
    this.table.deleteColumn(this.column);
    this.close();
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213}],95:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../views/base_dialog/view');
var pluralizeString = require('../view_helpers/pluralize_string');
var randomQuote = require('../view_helpers/random_quote');
var MapCardPreview = require('../views/mapcard_preview');
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);

var AFFECTED_ENTITIES_SAMPLE_COUNT = 3;
var AFFECTED_VIS_COUNT = 3;

/**
 * Delete items dialog
 */
module.exports = BaseDialog.extend({

  initialize: function() {
    this.elder('initialize');
    if (!this.options.viewModel) {
      throw new TypeError('viewModel is required');
    }
    if (!this.options.user) {
      throw new TypeError('user is required');
    }

    this._viewModel = this.options.viewModel;
    this._viewModel.loadPrerequisites();
    this._viewModel.bind('change', function() {
      if (this._viewModel.state() === 'DeleteItemsDone') {
        this.close();
      } else {
        this.render();
      }
    }, this);
    this.add_related_model(this._viewModel);
  },

  render: function() {
    BaseDialog.prototype.render.call(this);
    this._loadMapPreviews();
    return this;
  },

  /**
   * @implements cdb.ui.common.Dialog.prototype.render_content
   */
  render_content: function() {
    return this['_render' + this._viewModel.state()]();
  },

  _renderLoadingPrerequisites: function() {
    return cdb.templates.getTemplate('common/templates/loading')({
      title: 'Checking what consequences deleting the selected ' + this._pluralizedContentType() + ' would have...',
      quote: randomQuote()
    });
  },

  _renderLoadPrerequisitesFail: function() {
    return cdb.templates.getTemplate('common/templates/fail')({
      msg: 'Failed to check consequences of deleting the selected ' + this._pluralizedContentType()
    });
  },

  _renderConfirmDeletion: function() {
    // An entity can be an User or Organization
    var affectedEntities = this._viewModel.affectedEntities();
    var affectedVisData = this._viewModel.affectedVisData();

    return cdb.templates.getTemplate('common/dialogs/delete_items_view_template')({
      firstItemName: this._getFirstItemName(),
      selectedCount: this._viewModel.length,
      isDatasets: this._viewModel.isDeletingDatasets(),
      pluralizedContentType: this._pluralizedContentType(),
      affectedEntitiesCount: affectedEntities.length,
      affectedEntitiesSample: affectedEntities.slice(0, AFFECTED_ENTITIES_SAMPLE_COUNT),
      affectedEntitiesSampleCount: AFFECTED_ENTITIES_SAMPLE_COUNT,
      affectedVisCount: affectedVisData.length,
      pluralizedMaps: pluralizeString('map', affectedVisData.length),
      affectedVisVisibleCount: AFFECTED_VIS_COUNT,
      visibleAffectedVis: this._prepareVisibleAffectedVisForTemplate(affectedVisData.slice(0, AFFECTED_VIS_COUNT))
    });
  },

  _prepareVisibleAffectedVisForTemplate: function(visibleAffectedVisData) {
    return visibleAffectedVisData.map(function(visData) {
      var vis = new cdb.admin.Visualization(visData);
      var owner = vis.permission.owner;
      return {
        visId: vis.get('id'),
        name: vis.get('name'),
        url: vis.viewUrl(this.options.user).edit(),
        owner: owner,
        ownerName: owner.get('username'),
        isOwner: vis.permission.isOwner(this.options.user),
        showPermissionIndicator: !vis.permission.hasWriteAccess(this.options.user),
        timeDiff: moment(vis.get('updated_at')).fromNow(),
        authTokens: vis.get('auth_tokens').join(';')
      };
    }, this);
  },

  /**
   * @overrides BaseDialog.prototype.ok
   */
  ok: function() {
    this._viewModel.deleteItems();
    this.render();
  },

  _loadMapPreviews: function() {
    var self = this;

    this.$el.find('.MapCard').each(function() {
      var username = $(this).data('visOwnerName');
      var mapCardPreview = new MapCardPreview({
        el: $(this).find('.js-header'),
        width: 298,
        height: 130,
        mapsApiResource: cdb.config.getMapsResourceName(username),
        visId: $(this).data('visId'),
        username: username,
        authTokens: $(this).data('visAuthTokens').split(';')
      }).load();

      self.addView(mapCardPreview);
    });
  },

  _renderDeletingItems: function() {
    return cdb.templates.getTemplate('common/templates/loading')({
      title: 'Deleting the selected ' + this._pluralizedContentType() + '...',
      quote: randomQuote()
    });
  },

  _renderDeleteItemsFail: function() {
    var message = this._viewModel.errorMessage().replace(/\n/g, '<br>');
    if (message === 'something failed') {
      message = '';
    }
    return cdb.templates.getTemplate('common/templates/fail')({
      msg: 'Failed to delete the selected ' + this._pluralizedContentType() + '. ' + message
    });
  },

  _pluralizedContentType: function() {
    return pluralizeString(
      this._viewModel.isDeletingDatasets() ? 'dataset' : 'map',
      this._viewModel.length
    );
  },

  _getFirstItemName: function() {
    if (!this.options.viewModel) return;

    var firstItem = this.options.viewModel.at(0);

    if (firstItem) {
      return firstItem.get("name");
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../view_helpers/pluralize_string":211,"../view_helpers/random_quote":212,"../views/base_dialog/view":213,"../views/mapcard_preview":216}],96:[function(require,module,exports){
(function (global){
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var batchProcessItems = require('../../common/batch_process_items');

/**
 * View model for delete items view.
 * Manages the states changes for the delete items view.
 */
module.exports = Backbone.Collection.extend({

  initialize: function(models, opts) {
    if (!opts.contentType) {
      throw new TypeError('contentType is required')
    }

    this._contentType = opts.contentType;
  },

  state: function() {
    return this._state;
  },

  errorMessage: function() {
    return this._errorMessage;
  },

  setState: function(newState) {
    this._state = newState;
    this.trigger('change');
    this.trigger(newState);
  },

  isDeletingDatasets: function() {
    return this._contentType === 'datasets';
  },

  loadPrerequisites: function() {
    var setStateToConfirmDeletion = this.setState.bind(this, 'ConfirmDeletion');

    if (this.isDeletingDatasets()) {
      this.setState('LoadingPrerequisites');

      batchProcessItems({
        howManyInParallel: 5,
        items: this.toArray(),
        processItem: this._loadPrerequisitesForModel,
        done: setStateToConfirmDeletion,
        fail: this.setState.bind(this, 'LoadPrerequisitesFail')
      });
    } else {
      setStateToConfirmDeletion();
    }
  },

  affectedEntities: function() {
    return this.chain()
      .map(function(m) {
        return m.sharedWithEntities();
      })
      .flatten().compact().value();
  },

  affectedVisData: function() {
    var visData = this.chain()
      .map(function(m) {
          var metadata = m.tableMetadata();
          return []
            .concat(metadata.get('dependent_visualizations'))
            .concat(metadata.get('non_dependent_visualizations'));
        })
      .flatten().compact().value();

    return _.uniq(visData, function(metadata) {
      return metadata.id;
    });
  },

  deleteItems: function() {
    this.setState('DeletingItems');

    // INFO: Don't put more than 1 delete in parallel because this lead to a
    // race condicition in the derived map deletion (if any)
    batchProcessItems({
      howManyInParallel: 1,
      items: this.toArray(),
      processItem: this._deleteItem,
      done: this.setState.bind(this, 'DeleteItemsDone'),
      fail: this._deletionFailed.bind(this)
    });
  },

  _deletionFailed: function(error) {
    this._errorMessage = error;
    this.setState('DeleteItemsFail');
  },

  _loadPrerequisitesForModel: function(m, callback) {
    var metadata = m.tableMetadata();

    // TODO: extract to be included in fetch call instead? modifying global state is not very nice
    metadata.no_data_fetch = true;

    metadata.fetch({
      wait: true, // TODO: from old code (delete_dialog), why is it necessary?
      success: function() {
        callback();
      },
      error: function(model, jqXHR) {
        callback(jqXHR.responseText);
      }
    });
  },

  _deleteItem: function(item, callback) {
    item.destroy({ wait: true })
      .done(function() {
        callback();
      })
      .fail(function(response) {
        var errorMessage;

        try {
          errorMessage = JSON.parse(response.responseText).errors.join('; ');
        } catch (e) {
          errorMessage = 'something failed';
        }

        callback(errorMessage);
      });
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../common/batch_process_items":24}],97:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var ViewFactory = require('../../view_factory');
var randomQuote = require('../../view_helpers/random_quote');

/**
 * Create a vis from a dataset, required for some contexts to have a vis before be able to carry out next task
 *  - duplicate vis
 *  - add layer
 */
module.exports = BaseDialog.extend({

  initialize: function() {
    this.elder('initialize');

    // Clean on hide and enter to confirm
    // have to be mandatory
    _.extend(
      this.options,
      {
        clean_on_hide: true,
        enter_to_confirm: true
      }
    );

    if (!this.model) throw new Error('model is required (layer)');
    this._initViews();
    this._initBinds();
  },

  render_content: function() {
    return this._panes.getActivePane().render().el;
  },

  _initViews: function() {
    this._panes = new cdb.ui.common.TabPane({
      el: this.el
    });
    this.addView(this._panes);
    this._panes.addTab('confirm',
      ViewFactory.createByTemplate('common/dialogs/delete_layer/template', {
      })
    );
    this._panes.addTab('loading',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Deleting layer…',
        quote: randomQuote()
      })
    );
    this._panes.addTab('fail',
      ViewFactory.createByTemplate('common/templates/fail', {
        msg: 'Could not delete layer for some reason'
      })
    );
    this._panes.active('confirm');
  },

  _initBinds: function() {
    this._panes.bind('tabEnabled', this.render, this);
  },

  ok: function() {
    this._panes.active('loading');
    var self = this;
    this.model.destroy({
      wait: true,
      success: function() {
        self.close();
      },
      error: function() {
        self._panes.active('fail');
      }
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213}],98:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var ViewFactory = require('../../view_factory');
var randomQuote = require('../../view_helpers/random_quote');

/**
 * Modal to delete a row/feature (e.g. a point or polygon), on the table or map view .
 */
module.exports = BaseDialog.extend({

  initialize: function() {
    this.elder('initialize');

    if (!this.options.table) {
      throw new Error('table is required');
    }

    if (!this.options.row) {
      throw new Error('row is required');
    }

    this.options.name = this.options.name || 'row';

    this._initViews();
    this._initBinds();
  },

  render_content: function() {
    return this._panes.getActivePane().render().el;
  },

  _initViews: function() {
    this.table = this.options.table;
    this.row = this.options.row;

    this._panes = new cdb.ui.common.TabPane({
      el: this.el
    });
    this.addView(this._panes);
    this._panes.addTab('confirm',
      ViewFactory.createByTemplate('common/dialogs/delete_row/template', {
        name: this.options.name
      })
    );
    this._panes.addTab('loading',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Deleting ' + this.options.name + '…',
        quote: randomQuote()
      })
    );
    this._panes.addTab('fail',
      ViewFactory.createByTemplate('common/templates/fail', {
        msg: 'Could not delete ' + this.options.name + ' for some reason'
      })
    );
    this._panes.active('confirm');
  },

  _initBinds: function() {
    this._panes.bind('tabEnabled', this.render, this);
  },

  ok: function() {
    var self = this
    this._panes.active('loading');
    this.table.trigger('removing:row');
    this.row.destroy({
      success: function() {
        self.table.trigger('remove:row', self.row);
        self.close();
      },
      error: function() {
        self._panes.active('fail');
      }
    }, {
      wait: this.options.wait
    });
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213}],99:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var BaseDialog = require('../views/base_dialog/view');
var ViewFactory = require('../view_factory');
var randomQuote = require('../view_helpers/random_quote');
var ErrorDetailsView = require('../views/error_details_view');

/**
 * Dialog to manage duplication process of a cdb.admin.CartoDBTableMetadata object.
 */
module.exports = BaseDialog.extend({

  initialize: function() {
    this.elder('initialize');
    if (!this.model) throw new Error('model is required (cdb.admin.CartoDBTableMetadata)');
    if (!this.options.user) throw new Error('user is required');
    this.elder('initialize');
    this._initViews();
    this._initBinds();
    this._duplicateDataset();
  },

  render_content: function() {
    return this._panes.getActivePane().render().el;
  },

  _initViews: function() {
    this._panes = new cdb.ui.common.TabPane({
      el: this.el
    });
    this.addView(this._panes);
    this._panes.addTab('loading',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: this.model.isInSQLView() ? 'Creating dataset from your query' : 'Duplicating your dataset',
        quote: randomQuote()
      })
    );
    this._panes.active('loading');
  },

  _initBinds: function() {
    this._panes.bind('tabEnabled', this.render, this);
  },

  _duplicateDataset: function(newName) {
    var self = this;
    var newName = this.model.get('name') + '_copy';
    this.model.duplicate(newName, {
      success: function(newTable) {
        self._redirectTo(newTable.viewUrl());
      },
      error: self._showError.bind(self)
    });
  },

  _showError: function(model) {
    var view;
    try {
      var err = _.clone(model.attributes);
      view = new ErrorDetailsView({
        err: _.extend(err, model.attributes.get_error_text),
        user: this.options.user
      });
    } catch(err) {
      view = ViewFactory.createByTemplate('common/templates/fail', {
        msg: "Sorry, something went wrong, but we're not sure why."
      });
    }
    this._panes.addTab('fail', view.render());
    this._panes.active('fail');
  },

  _redirectTo: function(url) {
    window.location = url;
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../view_factory":209,"../view_helpers/random_quote":212,"../views/base_dialog/view":213,"../views/error_details_view":215}],100:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var BaseDialog = require('../views/base_dialog/view');
var ViewFactory = require('../view_factory');
var randomQuote = require('../view_helpers/random_quote');
var ErrorDetailsView = require('../views/error_details_view');

/**
 * Dialog to manage duplication process of a cdb.admin.Visualization object.
 */
module.exports = BaseDialog.extend({

  initialize: function() {
    this.elder('initialize');
    if (!this.model) throw new Error('model is required (cdb.admin.Visualization)');
    if (!this.options.user) throw new Error('user is required');
    this.elder('initialize');
    this._initViews();
    this._initBinds();
    this._duplicateMap();
  },

  render_content: function() {
    return this._panes.getActivePane().render().el;
  },

  _initViews: function() {
    this._panes = new cdb.ui.common.TabPane({
      el: this.el
    });
    this.addView(this._panes);
    this._panes.addTab('loading',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Duplicating your map',
        quote: randomQuote()
      })
    );
    this._panes.active('loading');
  },

  _initBinds: function() {
    this._panes.bind('tabEnabled', this.render, this);
  },

  _duplicateMap: function(newName) {
    var self = this;
    var newName = this.model.get('name') + ' copy';
    this.model.copy({
      name: newName
    }, {
      success: function(newVis) {
        self._redirectTo(newVis.viewUrl(self.options.user).edit().toString());
      },
      error: self._showError.bind(self)
    });
  },

  _showError: function(model) {
    var view;
    try {
      var err = _.clone(model.attributes);
      view = new ErrorDetailsView({
        err: _.extend(err, model.attributes.get_error_text),
        user: this.options.user
      });
    } catch(err) {
      view = ViewFactory.createByTemplate('common/templates/fail', {
        msg: "Sorry, something went wrong, but we're not sure why."
      });
    }
    this._panes.addTab('fail', view.render());
    this._panes.active('fail');
  },

  _redirectTo: function(url) {
    window.location = url;
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../view_factory":209,"../view_helpers/random_quote":212,"../views/base_dialog/view":213,"../views/error_details_view":215}],101:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);


/**
 *  Edit visualization (dataset or map) dialog
 *
 */
module.exports = cdb.core.View.extend({

  options: {
    maxLength: 200
  },

  events: {
    'keydown .js-name': '_onNameKeyDown',
    'click .js-privacy': '_showPrivacy',
    'submit': '_onSubmit'
  },

  initialize: function() {
    this.user = this.options.user;
    this.template = cdb.templates.getTemplate('common/dialogs/edit_vis_metadata/edit_vis_form');
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();
    this._destroyTags();
    this.$el.html(
      this.template({
        isDataset: this.model.isDataset(),
        isDataLibraryEnabled: this.user.featureEnabled('data_library'),
        visValue: this.model.get('name'),
        visDescription: this.model.get('description'),
        visPrivacy: this.model.get('privacy').toLowerCase(),
        visSource: this.model.get('source'),
        visAttributions: this.model.get('attributions'),
        visDisplayName: this.model.get('display_name'),
        isNameEditable: this.model.isNameEditable(),
        isMetadataEditable: this.model.isMetadataEditable(),
        maxLength: this.options.maxLength
      })
    );
    this._initViews();
    return this;
  },

  _initBinds: function() {
    this.model.bind('error', this._setFields, this);
    this.model.bind('valid', this._setFields, this);
  },

  _initViews: function() {
    var self = this;

    // Markdown tooltip
    this.addView(
      new cdb.common.TipsyTooltip({
        el: this.$('.js-markdown'),
        html: true,
        title: function() {
          return $(this).data('title');
        }
      })
    );

    // Name error tooltip
    this.addView(
      new cdb.common.TipsyTooltip({
        el: this.$('.js-name'),
        title: function() {
          return self.model.getError();
        }
      })
    );

    // Tags
    _.each(this.model.get('tags'), function(li) {
      this.$(".js-tagsList").append("<li>" + cdb.core.sanitize.html(li) + "</li>");
    }, this);

    var tagsPlaceholder = (!this.model.isMetadataEditable() && this.model.get('tags').length === 0) ? 'No tags' : 'Add tags';

    this.$(".js-tagsList").tagit({
      allowSpaces: true,
      placeholderText: tagsPlaceholder,
      readOnly: !this.model.isMetadataEditable(),
      onBlur: function() {
        if (self.model.isMetadataEditable()) {
          self.$('.js-tags').removeClass('is-focus')
        }
      },
      onFocus: function() {
        if (self.model.isMetadataEditable()) {
          self.$('.js-tags').addClass('is-focus')
        }
      },
      onSubmitTags: function(ev, tagList) {
        ev.preventDefault();
        self._onSubmit();
        return false;
      }
    });

    // Licenses dropdown
    if (this.model.isDataset()) {
      this._licenseDropdown = new cdb.forms.Combo({
        className: 'Select',
        width: '100%',
        property: 'license',
        model: this.model,
        disabled: !this.model.isMetadataEditable(),
        extra: this._getLicensesForFormsCombo()
      });
      this.addView(this._licenseDropdown);
      this.$('.js-license').append(this._licenseDropdown.render().el);
    }
  },

  _getLicensesForFormsCombo: function() {
    var items = cdb.config.get('licenses');
    var emptyOption = [{
      id: '',
      name: '-'
    }];
    return _.chain(emptyOption.concat(items))
      .compact()
      .map(function(d) {
        return [d.name, d.id];
      })
      .value();
  },

  _setFields: function() {
    // for the moment only name input is required
    this.$('.js-name').toggleClass('is-invalid', !!this.model.getError());
  },

  _showPrivacy: function(ev) {
    this.killEvent(ev);
    this.trigger('onPrivacy', this);
  },

  // Form events

  _onNameKeyDown: function(ev) {
    if (ev.keyCode === $.ui.keyCode.ENTER) {
      ev.preventDefault();
      this._onSubmit();
      return false;
    }
  },

  _onSubmit: function(ev) {
    if (ev) {
      this.killEvent(ev);
    }

    // values
    var attrs = {};
    if (this.model.isNameEditable()) {
      attrs['name'] = Utils.stripHTML(this.$('.js-name').val());
    }
    if (this.model.isMetadataEditable()) {
      attrs['description'] = Utils.removeHTMLEvents(this.$('.js-description').val());
      attrs['tags'] = this.$('.js-tagsList').tagit("assignedTags");

      if (this.model.isDataset()) {
        attrs.source = this.$('.js-source').val();
        attrs.attributions = this.$('.js-attributions').val();
        attrs.display_name = this.$('.js-displayName').val();
        // license is set through dropdown view, so no need to do an explicit set here
      }
    }

    this.model.set(attrs);

    if (this.model.isValid()) {
      this.trigger('onSubmit', this.model, this);
    }
  },

  // Clean functions

  _destroyTags: function() {
    this.$('.js-tagsList').tagit('destroy');
  },

  clean: function() {
    this._destroyTags();
    this.elder('clean');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],102:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 *  Edit vis metadata dialog model
 *  to control if name and metadata
 *  are editable or not.
 *
 */

module.exports = cdb.core.Model.extend({

  defaults: {
    name: '',
    description: '',
    tags: '',
    privacy: ''
  },

  initialize: function(attrs, opts) {
    if (!opts || !opts.vis || !opts.user || !opts.dataLayer) {
      throw new Error('Visualization, user and dataLayer models are required');
    }
    this.vis = opts.vis;
    this.user = opts.user;
    this.dataLayer = opts.dataLayer;

    var data = {
      name: this.vis.get('name'),
      description: this.vis.get('description'),
      tags: this.vis.get('tags'),
      privacy: this.vis.get('privacy')
    };
    if (!this.vis.isVisualization()) {
      // Additional fields, only for dataset, w/ fallbacks for defaults
      data.source = this.vis.get('source') || '';
      data.attributions = this.vis.get('attributions') || '';
      data.license = this.vis.get('license') || '';
      data.display_name = this.vis.get('display_name') || '';
    }
    this.set(data);

    // Validation control variable
    this.validationError = '';
    this._initBinds();
  },

  _initBinds: function() {
    this.bind('valid', function() {
      this.validationError = '';
    }, this);
    this.bind('error', function(m, error) {
      this.validationError = error;
    }, this);
  },

  // Validation
  _validate: function(attrs) {
    var valid = cdb.core.Model.prototype._validate.apply(this, arguments);
    if (valid) {
      this.trigger('valid')
      return true;
    } else {
      return false;
    }
  },

  validate: function(attrs) {
    if (!attrs) return;

    if (!attrs.name) {
      return "Name can't be blank"
    }
  },

  getError: function() {
    return this.validationError;
  },

  isValid: function() {
    if (!this.validate) {
      return true;
    }
    return !this.validate(this.attributes) && this.validationError === "";
  },

  // Helper functions
  isDataset: function() {
    return !this.vis.isVisualization();
  },

  isVisEditable: function() {
    return this.vis.permission.isOwner(this.user);
  },

  isAttributeEditable: function(type) {
    if (this.vis.isVisualization()) {
      return this.isVisEditable();
    } else {
      var isReadOnly = type === "name" ? this.dataLayer.isReadOnly() : false;
      if (!this.dataLayer) {
        return false;
      } else if (this.dataLayer && (isReadOnly || !this.dataLayer.permission.isOwner(this.user))) {
        return false;
      } else {
        return true;
      }
    }
  },

  isNameEditable: function() {
    return this.isAttributeEditable('name');
  },

  isMetadataEditable: function() {
    return this.isAttributeEditable('rest');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],103:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var ViewFactory = require('../../view_factory');
var FormView = require('./edit_vis_form_view');
var EditVisMetadataModel = require('./edit_vis_metadata_dialog_model');
var randomQuote = require('../../view_helpers/random_quote');
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);


/**
 *  Edit visualization (dataset or map) dialog
 *
 */
module.exports = BaseDialog.extend({

  events: BaseDialog.extendEvents({
    'click .js-back': '_showForm'
  }),

  className: 'Dialog is-opening EditVisMetadata',

  initialize: function() {
    this.elder('initialize');

    if (!this.options.vis) {
      throw new TypeError('vis model is required');
    }

    this.vis = this.options.vis;
    this.user = this.options.user;
    this.dataLayer = this.options.dataLayer;
    this.model = new EditVisMetadataModel({}, {
      vis: this.vis,
      dataLayer: this.dataLayer,
      user: this.user
    });
    this.template = cdb.templates.getTemplate('common/dialogs/edit_vis_metadata/edit_vis_metadata_dialog');
  },

  render: function() {
    this.clearSubViews();
    BaseDialog.prototype.render.call(this);
    this.$('.content').addClass('Dialog-content--expanded');
    this._initViews();
    return this;
  },

  render_content: function() {
    var visType = this.vis.isVisualization() ? 'map' : 'dataset';
    return this.template({
      visType: visType,
      visTypeCapitalized: visType.charAt(0).toUpperCase() + visType.slice(1),
      isNameEditable: this.model.isNameEditable(),
      isMetadataEditable: this.model.isMetadataEditable()
    });
  },

  _initViews: function() {
    // Panes
    this._panes = new cdb.ui.common.TabPane({
      el: this.$('.js-content')
    });

    // Create form
    var form = new FormView({
      el: this.$('.js-form'),
      model: this.model,
      user: this.user,
      maxLength: this.options.maxLength
    });

    form.bind('onPrivacy', this._showPrivacy, this);
    form.bind('onSubmit', this._saveAttributes, this);
    this._panes.addTab('form', form.render());

    // Create loading
    this._panes.addTab('loading',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Saving new data...',
        quote: randomQuote()
      }).render()
    );

    // Create error
    this._panes.addTab('error',
      ViewFactory.createByTemplate('common/templates/fail', {
        msg: 'Sorry, something went wrong but you can get <button class="Button--link js-back">back to the form</button>.'
      }).render()
    );

    this._panes.active('form');
  },

  _saveAttributes: function() {
    var self = this;
    var newAttrs = _.omit(this.model.toJSON(), 'privacy');
    var oldAttrs = {
      name: this.vis.get('name'),
      description: this.vis.get('description'),
      tags: this.vis.get('tags')
    };
    if (this.model.isDataset()) {
      oldAttrs.source = this.vis.get('source');
      oldAttrs.attributions = this.vis.get('attributions');
      oldAttrs.license = this.vis.get('license');
    }

    if (!_.isEmpty(this.vis.changedAttributes(newAttrs))) {
      this._panes.active('loading');
      this.vis.save(newAttrs,{
        success: function() {
          self.options.onDone && self.options.onDone(oldAttrs.name !== newAttrs.name);
          self.hide();
        },
        error: function() {
          self.vis.set(oldAttrs);
          self._panes.active('error');
        }
      })
    } else {
      this.hide();
    }
  },

  _showPrivacy: function() {
    this.options.onShowPrivacy && this.options.onShowPrivacy();
    this.hide();
  },

  _showForm: function() {
    this._panes.active('form');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213,"./edit_vis_form_view":101,"./edit_vis_metadata_dialog_model":102}],104:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');

/**
 * shows a dialog to get the table exported
 * new ExportDialog({
 *  table: table_model
 * })
 *
 * (Migrated almost-as-is from old editor to not break functionality)
 */
module.exports = BaseDialog.extend({

  _CSV_FILTER: 'SELECT * FROM (%%sql%%) as subq ',
  _MAX_SQL_GET_LENGTH: 1000,
  events: BaseDialog.extendEvents({
    'click .js-option:not(.is-disabled)': '_export'
  }),

  /**
   * Allowed formats on the exporter
   * @type {Array}
   */
  formats: [
    {format: 'csv', fetcher: 'fetchCSV', geomRequired: false, illustrationIconModifier: 'IllustrationIcon--neutral' },
    {format: 'shp', fetcher: 'fetch', geomRequired: true, illustrationIconModifier: 'IllustrationIcon--magenta' },
    {format: 'kml', fetcher: 'fetch', geomRequired: true, illustrationIconModifier: 'IllustrationIcon--sunrise' },
    {format: 'geojson', label: 'geo json', fetcher: 'fetch', geomRequired: true, illustrationIconModifier: 'IllustrationIcon--cyan' },
    {format: 'svg', fetcher: 'fetchSVG', geomRequired: true, illustrationIconModifier: 'IllustrationIcon--royalDark' }
  ],

  initialize: function () {
    _.extend(this.options, {
      clean_on_hide: true,
      table_id: this.model.id
    });
    this.elder('initialize');
    _.bindAll(this, '_export');
    this.baseUrl = cdb.config.getSqlApiUrl();
    this.model.bind('change:geometry_types', this.refresh, this);
  },

  /**
   * search a format based on its name in the format array
   * @param  {string} format Format name
   * @return {Object}
   */
  getFormat: function (format) {
    for (var n in this.formats) {
      if (this.formats[n].format === format) {
        return this.formats[n];
      }
    }
  },

  /**
   * Answer to button event and lauchn the export method associated to that format
   * @param  {Event} ev
   */
  _export: function (ev) {
    this.killEvent(ev);
    var $button = $(ev.currentTarget);
    var formatName = $button.data('format');
    var format = this.getFormat(formatName);
    this[format.fetcher](formatName);
  },

  /**
   * Create a dictionary with the options shared between all the methods
   * @return {Object}
   */
  getBaseOptions: function () {
    var options = {};
    options.filename = this.model.get('name');

    if (this.options.user_data) {
      options.api_key = this.options.user_data.api_key;
    }

    return options;
  },

  /**
   * Returns the base sql to retrieve the data
   * @return {string}
   */
  getPlainSql: function () {
    if (this.options.sql) {
      sql = this.options.sql;
    } else {
      if (this.model.sqlView) {
        sql = this.model.sqlView.getSQL();
      } else {
        sql = 'select * from ' + this.model.get('name');
      }
    }
    return sql;
  },

  /**
   * Returns a specific sql filtered by the_geom, used on CSV exports
   * @return {string}
   */
  getGeomFilteredSql: function () {
    var sql = this.getPlainSql();
    // if we have "the_geom" in our current schema, we apply a custom sql
    if (this.model.isGeoreferenced()) {
      return this._CSV_FILTER.replace(/%%sql%%/g, sql);
    }
    // Otherwise, we apply regular sql
    return sql;
  },

  /**
   * Populates the hidden form with the format related values and submits them to get the file
   * @param  {Object} options Base options
   * @param  {String} sql Sql of the document to be retrieved
   */
  _fetch: function (options, sql) {
    this._showElAndHideRest('.js-preparing-download');
    this.$('.format').val(options.format);
    this.$('.q').val(sql);
    this.$('.filename').val(options.filename);
    this.$('.api_key').val(options.api_key);

    if (options.format === 'csv') {
      this.$('.skipfields').val('the_geom_webmercator');
    } else {
      this.$('.skipfields').val('the_geom,the_geom_webmercator');
    }

    if (window.user_data && window.user_data.email) {
      // Event tracking "Exported table data"
      cdb.god.trigger('metrics', 'export_table', {
        email: window.user_data.email
      });
    }

    // check if the sql is big or not, and send the request as a verb or other. This is a HACK.
    if (sql.length < this._MAX_SQL_GET_LENGTH) {
      var location = this.$('form').attr('action') + '?' + this.$('form').serialize();
      this._fetchGET(location);
    } else {
      // I can't find a way of making the iframe trigger load event when its get a form posted,
      // so we need to leave like it was until
      this.submit();
    }

    this.$('.db').attr('disabled', 'disabled');
    this.$('.skipfields').attr('disabled', 'disabled');

    if (this.options.autoClose) {
      this.close();
      this.trigger('generating', this.$('.js-preparing-download').html());
    }
  },

  showError: function (error) {
    this.$('.js-error').html(
      this.getTemplate('common/templates/fail')({
        msg: error
      })
    );
    this._showElAndHideRest('.js-error');
  },

  _fetchGET: function (url) {
    function getError (content) {
      // sql api returns a json when it fails
      // but if the browser is running some plugin that
      // formats it, the window content is the html
      // so search for the word "error"
      var error = null;
      try {
        var json = JSON.parse(content);
        error = json.error[0];
      } catch (e) {
        if (content && content.indexOf('error') !== -1) {
          error = 'an error occurred';
        }
      }
      return error;
    }

    var self = this;
    var checkInterval;

    var w = window.open(url);
    w.onload = function () {
      clearInterval(checkInterval);
      var error = getError(w.document.body.textContent);
      if (error) {
        self.showError(error);
      } else {
        self.close();
      }
      w.close();
    };
    window.focus();
    checkInterval = setInterval(function check () {
      // safari needs to check the body because it never
      // calls onload
      if (w.closed || (w.document && w.document.body.textContent.length === 0)) {
        self.close();
        clearInterval(checkInterval);
      }
    }, 100);
  },

  /**
   * Submits the form. This method is separated to ease the testing
   */
  submit: function () {
    this.$('form').submit();
  },

  /**
   * Base fetch, for the formats that don't require special threatment
   * @param  {String} formatName
   */
  fetch: function (formatName) {
    var options = this.getBaseOptions();
    options.format = formatName;
    var sql = this.getPlainSql();
    this._fetch(options, sql);
  },

  /**
   * Gets the options needed for csv format and fetch the document
   * @param  {String} formatName
   */
  fetchCSV: function () {
    var options = this.getBaseOptions();
    options.format = 'csv';
    var sql = this.getGeomFilteredSql();
    this.$('.skipfields').removeAttr('disabled');
    this._fetch(options, sql);
  },
  /**
   * Gets the options needed for svg format and fetch the document
   * @param  {String} formatName
   */
  fetchSVG: function () {
    this.$('.db').removeAttr('disabled');
    this.fetch('svg');
  },
  /**
   * Returns the html populated with current data
   * @return {String}
   */
  render_content: function () {
    var isGeoreferenced = this.model.isGeoreferenced();

    if (_.isBoolean(isGeoreferenced)) {
      return this.getTemplate('common/dialogs/export/export_template')({
        preparingDownloadContent: this._renderLoadingContent('We are preparing your download. Depending on the size, it could take some time.'),
        formats: this.formats,
        url: this.baseUrl,
        isGeoreferenced: isGeoreferenced
      });
    } else {
      return this._renderLoadingContent('Checking georeferences…');
    }
  },

  refresh: function () {
    this.$('.content').html(this.render_content());
  },

  _renderLoadingContent: function (title) {
    return this.getTemplate('common/templates/loading')({
      title: title,
      quote: cdb.editor.randomQuote()
    });
  },

  _showElAndHideRest: function (classNameToShow) {
    [
      '.js-start',
      '.js-preparing-download',
      '.js-error'
    ].forEach(function (className) {
      this.$(className)[ className === classNameToShow ? 'show' : 'hide' ]();
    }, this);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../views/base_dialog/view":213}],105:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var randomQuote = require('../../view_helpers/random_quote');

/**
 * Lock/unlock datasets/maps dialog.
 */
module.exports = BaseDialog.extend({

  events: BaseDialog.extendEvents({
    'click .js-ok': '_confirm',
    'click .js-download': '_download',
    'click .js-cancel': '_abortExport'
  }),

  initialize: function (attrs) {
    this.elder('initialize');

    this._initBinds();
  },

  render_content: function () {
    var state = this.model.get('state');

    if (state === 'complete') {
      var w = window.open(this.model.get('url'));

      // If w is undefined, popup was blocked: we show a "click to download" modal. Else, download has started.
      if (w == null) return cdb.templates.getTemplate('common/dialogs/export_map/templates/download');

      w.focus();
      this.close();
    } else if (state === 'failure') {
      return cdb.templates.getTemplate('common/templates/fail')({
        msg: 'Export has failed'
      });
    } else if (state === 'pending' || state === 'exporting' || state === 'uploading') {
      var loadingTitle = state.charAt(0).toUpperCase() + state.slice(1) + ' ...';

      return this.getTemplate('common/templates/loading')({
        title: loadingTitle,
        quote: randomQuote()
      });
    } else {
      return cdb.templates.getTemplate('common/dialogs/export_map/templates/confirm');
    }
  },

  _confirm: function () {
    this.model.requestExport();
  },

  _download: function () {
    window.open(this.model.get('url'));
    window.focus();

    this.close();
  },

  _abortExport: function () {
    this.model.cancelExport();
    this.close();
  },

  _initBinds: function () {
    this.model.bind('change:state', function () { this.render(); }, this);
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213}],106:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 *  Add column view
 *
 */

module.exports = cdb.core.View.extend({

  className: 'AddColumn js-addField',

  events: {
    'click .js-addColumn': '_addColumn'  
  },

  initialize: function() {
    this.model = new cdb.core.Model({
      state: 'idle'
    });
    this.table = this.options.table;
    this.template = cdb.templates.getTemplate('common/dialogs/feature_data/add_column/add_column');
    this._initBinds();
  },

  render: function() {
    this.$el.html(
      this.template({
        state: this.model.get('state')
      })
    )
    return this;
  },

  _initBinds: function() {
    this.model.bind('change:state', this.render, this);
  },

  _addColumn: function() {
    var self = this;
    // Loading
    this.model.set('state', 'loading');

    this.table.addColumn('column_' + new Date().getTime(), 'string', {
      success: function(mdl, data) {
        self.trigger('newColumn', mdl, this);
        self.model.set('state', 'idle');
      },
      error: function() {
        self.model.set('state', 'error');
      }
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],107:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var FormView = require('./form_view');
var ViewFactory = require('../../view_factory');
var randomQuote = require('../../view_helpers/random_quote');
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);


/**
 *  Feature data edition dialog
 */
module.exports = BaseDialog.extend({

  events: BaseDialog.extendEvents({
    'click .js-back': '_showForm'
  }),

  className: 'Dialog is-opening FeatureData',

  initialize: function() {
    this.elder('initialize');

    if (!this.options.table) {
      throw new TypeError('table is required');
    }

    this.row = this.options.row;
    this.table = this.options.table;
    this.baseLayer = this.options.baseLayer;
    this.dataLayer = this.options.dataLayer;
    this.provider = this.options.provider;
    this.currentZoom = this.options.currentZoom;
    this.user = this.options.user;
    this._template = cdb.templates.getTemplate('common/dialogs/feature_data/feature_data_dialog');
  },

  render: function() {
    this.clearSubViews();
    BaseDialog.prototype.render.call(this);
    this.$('.content').addClass('Dialog-content--expanded');
    this._initViews();
    return this;
  },

  render_content: function() {
    return this._template({
      featureType: this.row.getFeatureType(),
      quote: randomQuote()
    });
  },

  _initViews: function() {
    var self = this;

    // Panes
    this._panes = new cdb.ui.common.TabPane({
      el: this.$('.js-content')
    });

    // Create map
    setTimeout(function() {
      self._createPreviewMap()
    }, 200);

    // Create form
    this.form = new FormView({
      el: this.$('.js-form'),
      table: this.table,
      row: this.row
    });

    this.form.bind('onSubmit', this._changeAttributes, this);
    this.form.bind('onError', this._scrollToError, this);
    this._panes.addTab('form', this.form.render());

    this.addView(this.form);

    // Create loading
    this._panes.addTab('loading',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Saving new data...',
        quote: randomQuote()
      }).render()
    );

    // Create error
    this._panes.addTab('error',
      ViewFactory.createByTemplate('common/templates/fail', {
        msg: 'Sorry, something went wrong but you can get <button class="Button--link js-back">back to the form</button>.'
      }).render()
    );

    this._panes.active('form');
  },

  _scrollToError: function(mdl) {
    this.$('.js-content').animate({
      scrollTop: ( this.$(".EditField-label[value='" + mdl.get('attribute') + "']").position().top - 20 )
    });
  },

  _changeAttributes: function(attrs) {
    var self = this;
    var newData = _.object(_.pluck(attrs, 'attribute'), _.pluck(attrs, 'value'));
    var oldData = {};

    // Change state
    this._panes.active('loading');

    // Unset columns already not present in the
    // new form data
    _.each(this.row.attributes, function(val, key) {
      if (newData[key] === undefined && !cdb.admin.Row.isReservedColumn(key) && key !== "id") {
        self.row.unset(key) 
      }
      oldData[key] = val;
    });

    if (!_.isEmpty(this.row.changedAttributes(newData))) {
      // Save new attributes
      this.row.save(newData, {
        success: function() {
          self._ok();
        },
        error: function() {
          self.row.set(oldData);
          self._panes.active('error');
        }
      });
    } else {
      self._cancel();
    }
  },

  _createPreviewMap: function() {
    var self = this;

    // Create map
    var div = this.$('.js-map');

    var mapViewClass = cdb.admin.LeafletMapView;
    if (this.provider === 'googlemaps') {
      var mapViewClass = cdb.admin.GoogleMapsMapView;
    }

    // New map
    this.map = new cdb.admin.Map();

    this.mapView = new mapViewClass({
      el: div,
      map: this.map,
      user: this.user
    });

    // Base layer
    this.baseLayer.set('attribution', '');
    this.map.addLayer(this.baseLayer);

    // Data layer
    this.dataLayer.set('query', 'SELECT * FROM ' + this.table.get('name') + ' WHERE cartodb_id=' + this.row.get('cartodb_id'));
    this.dataLayer.set('attribution', '');
    this.map.addLayer(this.dataLayer);

    // Set bounds
    var sql = new cdb.admin.SQL({
      user: this.user.get('username'),
      api_key: this.user.get('api_key')
    });
    sql.getBounds('SELECT * FROM ' + this.table.get('name') + ' WHERE cartodb_id=' + this.row.get('cartodb_id')).done(function(r) {
      if (r) {
        if (r[0][0] === r[1][0] && r[0][1] === r[1][1]) {
          // Point geometry
          self.map.setCenter(r[0]);
        } else {
          // Rest of geometries
          self.map.setBounds(r);
        }
        self.map.setZoom(self.currentZoom);
      }
    });
  },

  _showForm: function() {
    this._panes.active('form');
  },

  _ok: function() {
    this.options.onDone && this.options.onDone();
    this.elder('_ok');
  },

  _cancel: function() {
    this.elder('_cancel');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213,"./form_view":110}],108:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);

/**
 *  Collection with all fields model
 *  included.
 *
 */

module.exports = Backbone.Collection.extend({

  isValid: function() {
    return !this.getInvalid();
  },

  getInvalid: function() {
    return this.find(function(mdl) {
      return !mdl.isValid()
    });
  }

})
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],109:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var StringFieldView = require('../../../edit_fields/string_field/string_field_view');
var NumberFieldView = require('../../../edit_fields/number_field/number_field_view');
var BooleanFieldView = require('../../../edit_fields/boolean_field/boolean_field_view');
var DateFieldView = require('../../../edit_fields/date_field/date_field_view');

/**
 *  Form field view for edit feature metadata
 *
 */

module.exports = cdb.core.View.extend({

  events: {
    'keydown .js-columnName': '_onInputChange',
    'focusout .js-columnName': '_onColNameChange',
  },

  _FIELD_VIEW: {
    'string': StringFieldView,
    'number': NumberFieldView,
    'boolean': BooleanFieldView,
    'date': DateFieldView,
    'timestamp with time zone': DateFieldView,
    'timestamp without time zone': DateFieldView
  },

  initialize: function() {
    this.model = new cdb.core.Model({
      columnError: '',
      typeError: '',
      fieldError: ''
    });
    this.table = this.options.table;
    this.row = this.options.row;
    this.fieldModel = this.options.fieldModel;
    this.template = cdb.templates.getTemplate('common/dialogs/feature_data/form_field/form_field');
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();
    this.$el.html(
      this.template({
        type: this.fieldModel.get('type'),
        value: this.fieldModel.get('value'),
        attribute: this.fieldModel.get('attribute'),
        readOnly: this.fieldModel.get('readOnly'),
        typeError: this.model.get('typeError'),
        columnError: this.model.get('columnError')
      })
    );
    this._initViews();
    return this;
  },

  _initBinds: function() {
    this.fieldModel.bind('change:readOnly', this.render, this);
    this.fieldModel.bind('change:type', this._onTypeChanged, this);
    this.add_related_model(this.fieldModel);
  },

  _initViews: function() {
    var self = this;

    // Field view
    var editorField = this._FIELD_VIEW[this.fieldModel.get('type')] || this._FIELD_VIEW['string'];
    var v = new editorField({
      readOnly: this.fieldModel.get('readOnly'),
      model: this.fieldModel
    }).bind('onSubmit', function(e) {
      this.trigger('onSubmit');
    }, this);

    this.$('.js-editField').append(v.render().el);
    this.addView(v);

    // Field tooltip
    var fieldTooltip = new cdb.common.TipsyTooltip({
      el: this.$('.js-editField'),
      title: function() {
        return self.fieldModel.getError()
      }
    });
    this.addView(fieldTooltip);

    // Column type combo
    // Current value has to be available in the extra array,
    // if not select will place first item as value
    var types = [this.fieldModel.get('type')].concat(_.filter(['string', 'boolean', 'number', 'date'], function(type){
      return self.table.isTypeChangeAllowed(self.fieldModel.get('attribute'), type)
    }));
    var combo = new cdb.forms.Combo({
      el: this.$('.js-fieldType'),
      model: this.fieldModel,
      property: 'type',
      disabled: this.fieldModel.get('readOnly'),
      width: '85px',
      extra: types
    });

    this.$(".js-fieldType").append(combo.render());
    combo.bind('change', function(type) {
      this.fieldModel.set({
        value: null,
        type: type
      })
    }, this);
    this.addView(combo);

    // Column type tooltip
    var typeTooltip = new cdb.common.TipsyTooltip({
      el: this.$('.js-fieldType'),
      title: function() {
        return self.model.get('typeError')
      }
    });
    this.addView(typeTooltip);

    // Column name tooltip
    var typeTooltip = new cdb.common.TipsyTooltip({
      el: this.$('.js-columnName'),
      title: function() {
        return self.model.get('columnError');
      }
    });
    this.addView(typeTooltip);
  },

  _onTypeChanged: function() {
    var self = this;
    var previousType = this.fieldModel.previous('type');
    var previousValue = this.fieldModel.previous('value');

    this.model.set('typeError', '');

    // Readonly everything
    this.fieldModel.set('readOnly', true);

    this.table.changeColumnType(this.fieldModel.get('attribute'), this.fieldModel.get('type'), {
      success: function() {
        // refresh record data after change
        // readOnly to false
        self._refreshRecordData(function() {
          self.fieldModel.set('readOnly', false);
        })
      },
      error: function() {
        // Avoiding silent:true and the event trigger
        // when other attribute is changed
        self.fieldModel.attributes.readOnly = false;
        self.fieldModel.attributes.value = previousValue;
        self.fieldModel.attributes.type = previousType;

        try {
          var msg = JSON.parse(e.responseText).errors[0];
          self.model.set('typeError', msg);
        } catch (e) {}
        self.render();
      }
    });
  },

  _onInputChange: function(ev) {
    if (ev.keyCode === 13) {
      $(ev.target).blur();
      this.killEvent(ev);
    }
  },

  _onColNameChange: function(ev) {
    var self = this;
    var val = $(ev.target).val();
    var oldVal = this.fieldModel.get('attribute');
    
    if (oldVal !== val) {
      this.fieldModel.set({
        attribute: val,
        readOnly: true
      });

      this.table.renameColumn(oldVal, val, {
        success: function(mdl, data) {
          self.model.set('columnError', '');
          self.fieldModel.set({
            attribute: data.name,
            readOnly: false
          });
        },
        error: function(mdl, err) {
          try {
            var msg = JSON.parse(err.responseText).errors[0];
            self.model.set('columnError', msg);
          } catch (e) {}
          self.fieldModel.set({
            attribute: oldVal,
            readOnly: false
          });
        }
      });
    }
  },

  _refreshRecordData: function(onComplete) {
    var self = this;

    this.row.fetch({
      success: function(r) {
        var newValue = r && r.rows[0] && r.rows[0][self.fieldModel.get('attribute')];
        self.fieldModel.set('value', newValue);
        onComplete && onComplete();
      },
      error: function() {
        onComplete && onComplete();
      }
    })
  },
  
});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../edit_fields/boolean_field/boolean_field_view":194,"../../../edit_fields/date_field/date_field_view":195,"../../../edit_fields/number_field/number_field_view":201,"../../../edit_fields/string_field/string_field_view":202}],110:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var FormFieldView = require('./form_field/form_field_view');
var AddColumnView = require('./add_column/add_column_view');
var EditFieldModel = require('../../edit_fields/edit_field_model');
var FormCollection = require('./form_collection');
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 *  Form view for edit feature metadata
 *
 */

module.exports = cdb.core.View.extend({

  events: {
    'click .js-submit': '_onSubmit',
    'submit': '_onSubmit'
  },

  initialize: function() {
    this.model = new cdb.core.Model({ state: 'idle' });
    this.table = this.options.table;
    this.row = this.options.row;
    this.collection = new FormCollection();
    this._generateCollection();
  },

  render: function() {
    this.clearSubViews();
    this._newColumn();
    this.collection.each(this._renderField, this);
    return this;
  },

  _generateCollection: function() {
    var self = this;
    var tableSchema = this.table.get('schema');
    var hiddenColumns = this.table.hiddenColumns;

    _.each(tableSchema, function(pair) {
      if (!_.contains(hiddenColumns, pair[0])) {
        var mdl = self._generateModel(pair[0], pair[1], self.row.get(pair[0]));
        self.collection.add(mdl);
      }
    });
  },

  _generateModel: function(column, type, value) {
    return new EditFieldModel({
      attribute: column,
      value: value,
      type: type
    });
  },

  _renderField: function(mdl) {
    var v = new FormFieldView({
      fieldModel: mdl,
      table: this.table,
      row: this.row
    });
    this.$('.js-addField').before(v.render().el);
    v.bind('onSubmit', this._onSubmit, this);
    this.addView(v);
  },

  _newColumn: function() {
    var newColumn = new AddColumnView({ table: this.table });
    newColumn.bind('newColumn', function(d){
      // add it to the form
      var mdl = this._generateModel(d.get('_name'), d.get('type'), null);
      this.collection.add(mdl);
      this._renderField(mdl);
    }, this);
    this.addView(newColumn);
    this.$el.append(newColumn.render().el);
  },

  _onSubmit: function(ev) {
    this.killEvent(ev);
    
    // Check if all models are valid, if so
    // let's go my buddy!
    var invalid = this.collection.getInvalid();
    if (!invalid) {
      var attrs = this.collection.toJSON();
      this.trigger('onSubmit', attrs, this);
    } else {
      this.trigger('onError', invalid, this);
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../edit_fields/edit_field_model":199,"./add_column/add_column_view":106,"./form_collection":108,"./form_field/form_field_view":109}],111:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var StepsView = require('./steps_view');
var RowModel = require('./row_model');
var DefaultFooterView = require('./default_footer_view');
var ViewFactory = require('../../view_factory');

/**
 * Model for the administrative regions georeference option.
 */
module.exports = cdb.core.Model.extend({

  TAB_LABEL: 'Admin. Regions',
  KIND: 'admin1',

  defaults: {
    step: 0,
    columns: []
  },

  initialize: function(attrs) {
    if (!attrs.geocodeStuff) throw new Error('geocodeStuff is required');
    if (!attrs.columnsNames) throw new Error('columnsNames is required');
    if (!attrs.columns) throw new Error('columns is required');
  },

  createView: function() {
    this._initRows();
    this._setStateForFirstStep();

    return ViewFactory.createByList([
      new StepsView({
        title: 'Select the column that has Administrative Regions',
        desc: "Georeference your data by country, state, province or municipality",
        model: this
      }),
      new DefaultFooterView({
        model: this
      })
    ]);
  },

  assertIfCanContinue: function() {
    var value = this.get('step') === 0 ? this._columnNameValue() : this.get('geometryType');
    this.set('canContinue', !!value);
  },

  continue: function() {
    if (this.get('step') === 0) {
      this._setStateForSecondStep();
    } else {
      this._geocode();
    }
  },

  goBack: function() {
    this._setStateForFirstStep();
  },

  availableGeometriesFetchData: function() {
    return this.get('geocodeStuff').availableGeometriesFetchData(this.KIND, this._locationValue(), this._isLocationFreeText());
  },

  _setStateForFirstStep: function() {
    this.set({
      step: 0,
      canGoBack: false,
      canContinue: false,
      hideFooter: false
    });
    this.get('rows').invoke('unset', 'value');
  },

  _setStateForSecondStep: function() {
    this.set({
      step: 1,
      canGoBack: true,
      canContinue: false,
      hideFooter: true,
      geometryType: ''
    });
  },

  _initRows: function() {
    var rows = new Backbone.Collection([
      new RowModel({
        comboViewClass: 'Combo',
        label: 'Select Your Region Name',
        placeholder: 'Select column',
        data: this.get('columnsNames')
      }),
      new RowModel({
        label: "Select Your Country Data",
        data: this.get('columns')
      })
    ]);
    this.set('rows', rows);
  },

  _geocode: function() {
    var geocodeStuff = this.get('geocodeStuff');
    var locationValue = this._locationValue();
    var isLocationFreeText = this._isLocationFreeText();

    var d = geocodeStuff.geocodingChosenData({
      type: 'admin',
      kind: geocodeStuff.isLocationWorld(locationValue, isLocationFreeText, true) ? 'admin0' : this.KIND, // migrated from old code, unclear why this is needed
      location: locationValue,
      column_name: this._columnNameValue(),
      geometry_type: this.get('geometryType')
    }, isLocationFreeText, true);

    this.set('geocodeData', d);
  },

  _columnNameValue: function() {
    return this.get('rows').first().get('value');
  },

  _locationValue: function() {
    return this._location().get('value');
  },

  _isLocationFreeText: function() {
    return this._location().get('isFreeText');
  },

  _location: function() {
    return this.get('rows').last();
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"./default_footer_view":114,"./row_model":122,"./steps_view":125}],112:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var GeometryItemView = require('./geometry_item_view');
var ViewFactory = require('../../view_factory');
var randomQuote = require('../../view_helpers/random_quote');

/**
 * View to select which geometry type to use for georeference process.
 */
module.exports = cdb.core.View.extend({

  initialize: function() {
    this.availableGeometries = new cdb.admin.Geocodings.AvailableGeometries();

    this._initBinds();
    this._fetchAvailableGeometries();
  },

  render: function() {
    this.clearSubViews();
    this.$el.html(
      this.getTemplate('common/dialogs/georeference/choose_geometry')()
    );
    _.each(
      this.availableGeometries.get('available_geometries') ? this._createItemsViews() : [this._createLoadingView()],
      this._appendView, this
    );
    return this;
  },

  _appendView: function(view) {
    this.addView(view);
    this.$('.js-items').append(view.render().el);
  },

  _createItemsViews: function() {
    return [
      this._createItemView({
        type: 'point',
        titles: {
          available: 'Georeference your data with points',
          unavailable: 'No point data available for your selection'
        }
      }),
      this._createItemView({
        type: 'polygon',
        titles: {
          available: 'Georeference your data with administrative regions',
          unavailable: 'No polygon data available for your selection.',
          learnMore: "Sorry, we don't have polygons available for the datatype you are trying to geocode. " +
            'For example, if you are geocoding placenames we can only give you points for where those places exist.'
        }
      })
    ];
  },

  _createItemView: function(d) {
    return new GeometryItemView(_.extend({
      model: this.model,
      availableGeometries: this.availableGeometries
    }, d));
  },

  _createLoadingView: function() {
    return ViewFactory.createByTemplate('common/templates/loading', {
      title: 'Checking for available geometries…',
      quote: randomQuote()
    });
  },

  _initBinds: function() {
    this.availableGeometries.bind('change:available_geometries', this.render, this);
    this.add_related_model(this.availableGeometries);
  },

  _fetchAvailableGeometries: function() {
    this.availableGeometries.fetch({
      data: this.model.availableGeometriesFetchData()
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"./geometry_item_view":116}],113:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var StepsView = require('./steps_view');
var RowModel = require('./row_model');
var DefaultFooterView = require('./default_footer_view');
var ViewFactory = require('../../view_factory');

/**
 * Model for the city names georeference option.
 */
module.exports = cdb.core.Model.extend({

  TAB_LABEL: 'City Names',
  KIND: 'namedplace',

  defaults: {
    step: 0,
    columns: []
  },

  initialize: function(attrs) {
    if (!attrs.geocodeStuff) throw new Error('geocodeStuff is required');
    if (!attrs.columnsNames) throw new Error('columnsNames is required');
    if (!attrs.columns) throw new Error('columns is required');
  },

  createView: function() {
    this._initRows();
    this._setStateForFirstStep();

    return ViewFactory.createByList([
      new StepsView({
        title: "Select the column that contains the City's Name",
        desc: 'No matter the type of the columns you select, we will transform them to number for georeferencing.',
        model: this
      }),
      new DefaultFooterView({
        model: this
      })
    ]);
  },

  assertIfCanContinue: function() {
    var value = this.get('step') === 0 ? this._columnNameValue() : this.get('geometryType');
    this.set('canContinue', !!value);
  },

  continue: function() {
    if (this.get('step') === 0) {
      this._setStateForSecondStep();
    } else {
      this._geocode();
    }
  },

  goBack: function() {
    this._setStateForFirstStep();
  },

  availableGeometriesFetchData: function() {
    return this.get('geocodeStuff').availableGeometriesFetchData(this.KIND, this._locationValue(), this._isLocationFreeText());
  },

  _setStateForFirstStep: function() {
    this.set({
      step: 0,
      canGoBack: false,
      canContinue: false,
      hideFooter: false
    });
  },

  _setStateForSecondStep: function() {
    this.set({
      step: 1,
      canGoBack: true,
      canContinue: false,
      hideFooter: true,
      geometryType: ''
    });
  },

  _geocode: function() {
    var d = this.get('geocodeStuff').geocodingChosenData({
      type: 'city',
      kind: this.KIND,
      location: this._locationValue(),
      column_name: this._columnNameValue(),
      geometry_type: this.get('geometryType')
    }, this._isLocationFreeText(), true);

    var region = this._regionValue();
    if (!_.isEmpty(region)) {
      d.region = region;
      d.region_text = this._isRegionFreeText();
    }

    this.set('geocodeData', d);
  },

  _initRows: function() {
    var rows = new Backbone.Collection([
      new RowModel({
        comboViewClass: 'Combo',
        label: 'In which column are your city names stored?',
        placeholder: 'Select column',
        data: this.get('columnsNames')
      }),
      new RowModel({
        label: "Admin. Region where city's located, if known",
        data: this.get('columns')
      }),
      new RowModel({
        label: "Country where city's located, if known",
        data: this.get('columns')
      })
    ]);
    this.set('rows', rows);
  },

  _columnNameValue: function() {
    return this.get('rows').first().get('value');
  },

  _regionValue: function() {
    return this._region().get('value');
  },

  _isRegionFreeText: function() {
    return this._region().get('isFreeText');
  },

  _region: function() {
    return this.get('rows').at(1); // 2nd row
  },

  _locationValue: function() {
    return this._location().get('value');
  },

  _isLocationFreeText: function() {
    return this._location().get('isFreeText');
  },

  _location: function() {
    return this.get('rows').last();
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"./default_footer_view":114,"./row_model":122,"./steps_view":125}],114:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View for the default footer
 */
module.exports = cdb.core.View.extend({

  events: {
    'click .js-force-all-rows': '_onClickForceAllRows'
  },

  initialize: function() {
    this._initBinds();
  },

  render: function() {
    this.$el.html(
      this.getTemplate('common/dialogs/georeference/default_footer')()
    );
    return this;
  },

  _initBinds: function() {
    this.model.bind('change:canContinue', this._onChangeCanContinue, this);
    this.model.bind('change:hideFooter', this._onChangeHideFooter, this);

    var geocodeStuff = this._geocodeStuff();
    geocodeStuff.bind('change:forceAllRows', this._onChangeForceAllRows, this);
    this.add_related_model(geocodeStuff);
  },

  _onChangeCanContinue: function(m, canContinue) {
    this.$('.ok').toggleClass('is-disabled', !canContinue);
  },

  _onChangeHideFooter: function(m, hideFooter) {
    this.$el.toggle(!hideFooter);
  },

  _onChangeForceAllRows: function(m, hasForceAllRows) {
    this.$('.js-force-all-rows button').toggleClass('is-checked', !!hasForceAllRows);
  },

  _onClickForceAllRows: function(ev) {
    this.killEvent(ev);
    var m = this._geocodeStuff();
    m.set('forceAllRows', !m.get('forceAllRows'));
  },

  _geocodeStuff: function() {
    return this.model.get('geocodeStuff');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],115:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * Simple object for common logic in the georeference modal, e.g. for available geometries, and
 * creating chosen geocoding data, etc.
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    tableName: undefined,
    forceAllRows: false
  },

  initialie: function(attrs) {
    if (!attrs.tableName) throw new Error('tableName is required');
  },

  /**
   * @param {String} kind
   * @param {String} location
   * @param {Boolean} isLocationFreeText
   * @return {Object} hash
   */
  availableGeometriesFetchData: function(kind, location, isLocationFreeText) {
    if (!kind) throw new Error('kind is required');

    var d = {
      kind: kind
    };

    if (_.isEmpty(location)) {
      d.free_text = 'World';
    } else {
      if (isLocationFreeText) {
        d.free_text = location;
      } else {
        d.column_name = location;
        d.table_name = this.get('tableName');
      }
    }

    return d;
  },

  // @return {Boolean} true if location is considered a "world" geocoding search value.
  isLocationWorld: function(location, isFreeText, useFallbackIfLocationIsMissing) {
    var isLocationMissingAndShouldFallback = (location === undefined && useFallbackIfLocationIsMissing);
    var isWorld = location === '' || isLocationMissingAndShouldFallback;
    return isWorld || (!!isFreeText && location.search('world') !== -1);
  },

  /**
   * Creates the expected data for the 'geocodingChosen' event on the cdb.god model.
   * Adheres to the existing workflow and was extracted from old views.
   * @param {Object} d
   * @param {Boolean} isLocationFreeText true if location prop was created through a free-text input field, and
   *  false if matches a column name on the table
   * @param {Boolean} useFallbackIfLocationIsMissing true if should use fallback value for a missing location value.
   * @return {Object}
   */
  geocodingChosenData: function(d, isLocationFreeText, useFallbackIfLocationIsMissing) {
    d.table_name = this.get('tableName');

    if (this.isLocationWorld(d.location, isLocationFreeText, useFallbackIfLocationIsMissing)) {
      d.location = 'world';
      d.text = true; // Set free text
    } else if (_.isBoolean(isLocationFreeText) && isLocationFreeText) {
      d.text = true;
    }

    if (this.get('forceAllRows')) {
      d.force_all_rows = true;
    }

    return d;
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],116:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View for an individual geometry type
 */
module.exports = cdb.core.View.extend({

  className: 'OptionCard OptionCard--blocky',

  events: {
    'click': '_onClick'
  },

  initialize: function() {
    if (!this.options.type) cdb.log.error('type is required');
    if (!this.options.titles) cdb.log.error('titles is required');
    if (!this.options.titles.available) cdb.log.error('titles.available is required');
    if (!this.options.titles.unavailable) cdb.log.error('titles.unavailable is required');
    this.availableGeometries = this.options.availableGeometries;
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();

    this.$el.html(
      this.getTemplate('common/dialogs/georeference/geometry_item_' + this.options.type)({
      })
    );

    this._onChangeAvailableGeometries();

    return this;
  },

  _initBinds: function() {
    this.availableGeometries.bind('change:available_geometries', this._onChangeAvailableGeometries, this);
    this.add_related_model(this.availableGeometries);

    this.model.bind('change:geometryType', this._onChangeGeometryType, this);
  },

  _onChangeGeometryType: function(m, type) {
    this.$el.toggleClass('is-selected', type === this.options.type);
  },

  _onChangeAvailableGeometries: function() {
    var isAvailable = this._isAvailable();

    this.$el.toggleClass('OptionCard--static', !isAvailable);
    this.$('.js-icon').toggleClass('u-disabled', !isAvailable);
    this.$('.js-warning').toggle(!isAvailable);
    this.$('.js-title')
      .toggleClass('u-disabled', !isAvailable)
      .text(this.options.titles[isAvailable ? 'available' : 'unavailable']);
  },

  _onClick: function(ev) {
    this.killEvent(ev);
    if (this._isAvailable()) {
      this.model.set('geometryType', this.options.type);
      this.model.continue();
    }
  },

  _isAvailable: function() {
    return _.contains(this.availableGeometries.get('available_geometries'), this.options.type);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],117:[function(require,module,exports){
(function (global){
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var LonLatColumnsModel = require('./lon_lat_columns_model');
var CityNamesModel = require('./city_names_model');
var AdminRegionsModel = require('./admin_regions_model');
var PostalCodesModel = require('./postal_codes_model');
var IpAddressesModel = require('./ip_addresses_model');
var StreetAddressesModel = require('./street_addresses/street_addresses_model');
var GeocodeStuffModel = require('./geocode_stuff_model');
var UserGeocodingModel = require('./user_geocoding_model');

/**
 * View model for merge datasets view.
 */
module.exports = cdb.core.Model.extend({

  _EXCLUDED_COLUMN_NAMES: ['cartodb_id', 'the_geom', 'updated_at', 'created_at', 'cartodb_georef_status'],
  _ALLOWED_COLUMN_TYPES: ['string', 'number', 'boolean', 'date'],

  defaults: {
    options: undefined // Collection, created with model
  },

  initialize: function(attrs) {
    if (!attrs.table) throw new Error('table is required');
    if (!attrs.user) throw new Error('user is required');
    this._initGeocodeStuff();
    this._initOptions();
  },

  changedSelectedTab: function(newTab) {
    this.get('options').chain()
      .without(newTab).each(this._deselect);
  },

  createView: function() {
    return this._selectedTabModel().createView();
  },

  canContinue: function() {
    return this._selectedTabModel().get('canContinue');
  },

  continue: function() {
    if (this.canContinue()) {
      this._selectedTabModel().continue();
    }
  },

  canGoBack: function() {
    return this._selectedTabModel().get('canGoBack');
  },

  goBack: function() {
    if (this.canGoBack()) {
      this._selectedTabModel().goBack();
    }
  },

  _selectedTabModel: function() {
    return this.get('options').find(this._isSelected);
  },

  _columnsNames: function() {
    // Maintained old logic, so for some reason the column types filter is not applied for the places where the column names are usd
    return _.chain(this.get('table').get('schema'))
      .filter(this._isAllowedColumnName, this)
      .map(this._columnName)
      .value();
  },

  _filteredColumns: function() {
    var table = this.get('table');
    // original_schema may be set if not in SQL view (see where attr is set in the table model)
    // maintained from code to not break behavior when implementing this new modal
    return _.chain(table.get('original_schema') || table.get('schema'))
      .filter(this._isAllowedColumnName, this)
      .filter(this._isAllowedColumnType, this)
      .map(this._inverColumnRawValues)
      .value();
  },

  _inverColumnRawValues: function(rawColumn) {
    // The cdb.forms.CustomTextCombo expects the data to be in order of [type, name], so need to translate the raw schema
    var type = rawColumn[1];
    var name = rawColumn[0];
    return [type, name];
  },

  _isAllowedColumnName: function(rawColumn) {
    return !_.contains(this._EXCLUDED_COLUMN_NAMES, this._columnName(rawColumn));
  },

  _isAllowedColumnType: function(rawColumn) {
    return _.contains(this._ALLOWED_COLUMN_TYPES, this._columnType(rawColumn));
  },

  _columnName: function(rawColumn) {
    return rawColumn[0];
  },

  _columnType: function(rawColumn) {
    return rawColumn[1];
  },

  _isSelected: function(m) {
    return m.get('selected');
  },

  _deselect: function(m) {
    m.set('selected', false);
  },

  _initGeocodeStuff: function() {
    var m = new GeocodeStuffModel({
      tableName: this.get('table').get('id')
    });
    this.set('geocodeStuff', m);
  },

  _initOptions: function() {
    var geocodeStuff = this.get('geocodeStuff');
    var columnsNames = this._columnsNames();
    var columns = this._filteredColumns();

    this.set('options',
      new Backbone.Collection([
        new LonLatColumnsModel({
          geocodeStuff: geocodeStuff,
          columnsNames: columnsNames,
          selected: true
        }),
        new CityNamesModel({
          geocodeStuff: geocodeStuff,
          columnsNames: columnsNames,
          columns: columns
        }),
        new AdminRegionsModel({
          geocodeStuff: geocodeStuff,
          columnsNames: columnsNames,
          columns: columns
        }),
        new PostalCodesModel({
          geocodeStuff: geocodeStuff,
          columnsNames: columnsNames,
          columns: columns
        }),
        new IpAddressesModel({
          geocodeStuff: geocodeStuff,
          columnsNames: columnsNames,
          columns: columns
        }),
        new StreetAddressesModel({
          geocodeStuff: geocodeStuff,
          columns: columns,
          isGoogleMapsUser: this._isGmeGeocoderEnabled(),
          userGeocoding: this._userGeocoding(),
          lastBillingDate: this.get('user').get('billing_period'),
          estimation: new cdb.admin.Geocodings.Estimation({
            id: this.get('table').getUnquotedName()
          })
        })
      ])
    );

    if (this.get('user').featureEnabled('georef_disabled')) {
      this._disableGeorefTabs();
    } else {
      this._maybeDisabledStreetAddresses();
    }
  },

  _disableGeorefTabs: function() {
    _.each(this._georefTabs(), this._disableTab.bind(this, "You don't have this option available in this version"));
  },

  _georefTabs: function() {
     // exclude 1st tab (LonLat), since it should not be affected by this feature flag
    return this.get('options').rest();
  },

  _maybeDisabledStreetAddresses: function() {
    var isGmeGeocoderEnabled = this._isGmeGeocoderEnabled();
    if (this._isGoogleMapsEnabled()) {
      if (!isGmeGeocoderEnabled) {
        this._disableTab('Google Maps geocoder is not configured. Please contact us at sales@carto.com', this._streetAddrTabModel());
      }
    } else {
      if (isGmeGeocoderEnabled) {
        this._disableTab('Geocoder is not configured properly. Please contact us at sales@carto.com', this._streetAddrTabModel());
      } else if (!this._userGeocoding().hasQuota()) {
        // Credits are only used for users that use non-GME geocoder
        this._disableTab('Your geocoding quota is not defined. Please contact us at sales@carto.com', this._streetAddrTabModel());
      }
    }
  },

  _userGeocoding: function() {
    return new UserGeocodingModel(this.get('user').get('geocoding'));
  },

  _isGoogleMapsEnabled: function() {
    return this._hasUserActionEnabled('google_maps_enabled');
  },

  _isGmeGeocoderEnabled: function() {
    return this._hasUserActionEnabled('google_maps_geocoder_enabled');
  },

  _hasUserActionEnabled: function(actionName) {
    return !!this.get('user').get('actions')[actionName];
  },

  _streetAddrTabModel: function() {
    return this.get('options').find(function(m) {
      return m instanceof StreetAddressesModel;
    });
  },

  _disableTab: function(msg, tabModel) {
    tabModel.set('disabled', msg);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./admin_regions_model":111,"./city_names_model":113,"./geocode_stuff_model":115,"./ip_addresses_model":119,"./lon_lat_columns_model":120,"./postal_codes_model":121,"./street_addresses/street_addresses_model":128,"./user_geocoding_model":133}],118:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view.js');
var GeoreferenceModel = require('./georeference_model');
var TabItemView = require('./tab_item_view');

/**
 * Dialog to georeference a table.
 * This view only acts as a high-level view, that managed the general view logic for the modal.
 * What is supposed to happen is delegated to the model and in turn the selected georeference option.
 */
module.exports = BaseDialog.extend({

  events: BaseDialog.extendEvents({
    'click .js-back:not(.is-disabled)': '_onGoBack'
  }),

  initialize: function() {
    if (!this.options.user) throw new Error('user is required');
    this.options.clean_on_hide = true;
    this.options.enter_to_confirm = true;
    this.elder('initialize');

    this.model = new GeoreferenceModel({
      table: this.options.table,
      user: this.options.user
    });
    this._initViews();
    this._initBinds();
  },

  /**
   * @override BaseDialog.prototype.render
   */
  render: function() {
    BaseDialog.prototype.render.apply(this, arguments);
    this.$('.content').addClass('Dialog-contentWrapper');
    return this;
  },

  render_content: function() {
    var table = this.model.get('table');
    var $el = $(
      this.getTemplate('common/dialogs/georeference/georeference')({
        hasNoGeoferencedData: !table.isGeoreferenced() && table.data().length > 0
      })
    );
    this._renderTabs($el.find('.js-tabs'));
    this._renderTabContent($el);

    return $el;
  },

  ok: function() {
    this.model.continue();
  },

  _initViews: function() {
    this._tabViews = this.model.get('options').map(this._createDefaultTabView, this);
  },

  _createDefaultTabView: function(model) {
    var view = new TabItemView({
      model: model
    });
    this.addView(view);
    return view;
  },

  _renderTabs: function($target) {
    $target.append.apply($target, _.map(this._tabViews, this._getRenderedElement));
  },

  _getRenderedElement: function(view) {
    return view.render().el;
  },

  _renderTabContent: function($target) {
    if (this._tabContentView) {
      this._tabContentView.clean();
    }
    this._tabContentView = this.model.createView();
    this.addView(this._tabContentView);
    $target.find('.js-tab-content').html(this._tabContentView.render().el);
  },

  _initBinds: function() {
    var options = this.model.get('options');
    options.bind('change:selected', this._onChangeSelectedTab, this);
    options.bind('change:canGoBack', this._onChangeCanGoBack, this);
    options.bind('change:geocodeData', this._onChangeGeocodeData, this);
    this.add_related_model(options);
  },

  _onChangeSelectedTab: function(tabModel, isSelected) {
    if (isSelected) {
      this.model.changedSelectedTab(tabModel);
      this._renderTabContent(this.$el);
    }
  },

  _onChangeCanGoBack: function(tabModel, canGoBack) {
    this.$('.js-back').toggle(!!canGoBack);
  },

  _onGoBack: function() {
    this.model.goBack();
  },

  _onChangeGeocodeData: function(tabModel, data) {
    cdb.god.trigger('geocodingChosen', data);
    this.close();
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../views/base_dialog/view.js":213,"./georeference_model":117,"./tab_item_view":132}],119:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var RowModel = require('./row_model');
var RowsView = require('./rows_view');
var DefaultFooterView = require('./default_footer_view');
var ViewFactory = require('../../view_factory');

/**
 * Model for the IP addresses georeference option.
 */
module.exports = cdb.core.Model.extend({

  TAB_LABEL: 'IP Addresses',

  initialize: function(attrs) {
    if (!attrs.geocodeStuff) throw new Error('geocodeStuff is required');
    if (!attrs.columnsNames) throw new Error('columnsNames is required');
  },

  createView: function() {
    this._initRows();
    this.set({
      canContinue: false,
      hideFooter: false
    });

    return ViewFactory.createByList([
      ViewFactory.createByTemplate('common/dialogs/georeference/default_content_header', {
        title: "Select the column that that contains the IP's name",
        desc: 'Convert IP address into geographical locations.'
      }),
      new RowsView({
        model: this
      }),
      new DefaultFooterView({
        model: this
      })
    ]);
  },

  assertIfCanContinue: function() {
    this.set('canContinue', !!this._columnNameValue());
  },

  continue: function() {
    var d = this.get('geocodeStuff').geocodingChosenData({
      type: 'ip',
      kind: 'ipaddress',
      column_name: this._columnNameValue(),
      geometry_type: 'point'
    });

    this.set('geocodeData', d);
  },

  _initRows: function() {
    var rows = new Backbone.Collection([
      new RowModel({
        comboViewClass: 'Combo',
        label: 'In which column are your IP addresses stored?',
        placeholder: 'Select column',
        data: this.get('columnsNames')
      })
    ]);
    this.set('rows', rows);
  },

  _columnNameValue: function() {
    return this.get('rows').first().get('value');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"./default_footer_view":114,"./row_model":122,"./rows_view":124}],120:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var RowModel = require('./row_model');
var RowsView = require('./rows_view');
var DefaultFooterView = require('./default_footer_view');
var ViewFactory = require('../../view_factory');

/**
 * Model for the Lon/Lat georeference option.
 */
module.exports = cdb.core.Model.extend({

  TAB_LABEL: 'Lon/Lat Columns',

  defaults: {
    columnsNames: []
  },

  initialize: function(attrs) {
    if (!attrs.geocodeStuff) throw new Error('geocodeStuff is required');
    if (!attrs.columnsNames) throw new Error('columnsNames is required');
  },

  createView: function() {
    this.set({
      canContinue: false,
      hideFooter: false
    });
    this._initRows();

    return ViewFactory.createByList([
      ViewFactory.createByTemplate('common/dialogs/georeference/default_content_header', {
        title: 'Select the columns containing your Lon/Lat columns',
        desc: 'The selected columns are transformed into georeference coordinates.'
      }),
      new RowsView({
        model: this
      }),
      new DefaultFooterView({
        model: this
      })
    ]);
  },

  assertIfCanContinue: function() {
    var canContinue = this.get('rows').all(function(m) {
      return !!m.get('value');
    });
    this.set('canContinue', canContinue);
  },

  continue: function() {
    var d = this.get('geocodeStuff').geocodingChosenData({
      type: 'lonlat',
      longitude: this.get('rows').first().get('value'),
      latitude: this.get('rows').last().get('value')
    });

    this.set('geocodeData', d);
  },

  _initRows: function() {
    var rows = new Backbone.Collection([
      new RowModel({
        comboViewClass: 'Combo',
        label: 'Select your Longitude',
        placeholder: 'Select column',
        property: 'longitude',
        data: this.get('columnsNames')
      }),
      new RowModel({
        comboViewClass: 'Combo',
        label: 'Select your Latitude',
        placeholder: 'Select column',
        property: 'latitude',
        data: this.get('columnsNames')
      })
    ]);
    this.set('rows', rows);
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"./default_footer_view":114,"./row_model":122,"./rows_view":124}],121:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var RowModel = require('./row_model');
var StepsView = require('./steps_view');
var DefaultFooterView = require('./default_footer_view');
var ViewFactory = require('../../view_factory');

/**
 * Model for the postal codes georeference option.
 */
module.exports = cdb.core.Model.extend({

  TAB_LABEL: 'Postal Codes',
  KIND: 'postalcode',

  defaults: {
    step: 0,
    columns: []
  },

  initialize: function(attrs) {
    if (!attrs.geocodeStuff) throw new Error('geocodeStuff is required');
    if (!attrs.columnsNames) throw new Error('columnsNames is required');
    if (!attrs.columns) throw new Error('columns is required');
  },

  createView: function() {
    this._initRows();
    this._setStateForFirstStep();

    return ViewFactory.createByList([
      new StepsView({
        title: 'Select the column that has the Postal Codes',
        desc: 'Georeference your data by postal codes.',
        model: this
      }),
      new DefaultFooterView({
        model: this
      })
    ]);
  },

  assertIfCanContinue: function() {
    var value = this.get('step') === 0 ? this._columnNameValue() : this.get('geometryType');
    this.set('canContinue', !!value);
  },

  continue: function() {
    if (this.get('step') === 0) {
      this._setStateForSecondStep();
    } else {
      this._geocode();
    }
  },

  goBack: function() {
    this._setStateForFirstStep();
  },

  availableGeometriesFetchData: function() {
    return this.get('geocodeStuff').availableGeometriesFetchData(this.KIND, this._locationValue(), this._isLocationFreeText());
  },

  _setStateForFirstStep: function() {
    this.set({
      step: 0,
      canGoBack: false,
      canContinue: false,
      hideFooter: false
    });
  },

  _setStateForSecondStep: function() {
    this.set({
      step: 1,
      canGoBack: true,
      canContinue: false,
      hideFooter: true,
      geometryType: ''
    });
  },

  _geocode: function() {
    var d = this.get('geocodeStuff').geocodingChosenData({
      type: 'postal',
      kind: this.KIND,
      location: this._locationValue(),
      column_name: this._columnNameValue(),
      geometry_type: this.get('geometryType')
    }, this._isLocationFreeText(), true);

    this.set('geocodeData', d);
  },

  _initRows: function() {
    var rows = new Backbone.Collection([
      new RowModel({
        comboViewClass: 'Combo',
        label: 'In which column are your postal codes stored?',
        placeholder: 'Select column',
        data: this.get('columnsNames')
      }),
      new RowModel({
        label: 'Country where postal codes are located, if known',
        data: this.get('columns')
      })
    ]);
    this.set('rows', rows);
  },

  _columnNameValue: function() {
    return this.get('rows').first().get('value');
  },

  _locationValue: function() {
    return this._location().get('value');
  },

  _isLocationFreeText: function() {
    return this._location().get('isFreeText');
  },

  _location: function() {
    return this.get('rows').last();
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"./default_footer_view":114,"./row_model":122,"./steps_view":125}],122:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var RowView = require('./row_view');

/**
 * Model for an individual row
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    comboViewClass: 'CustomTextCombo',
    label: '',
    placeholder: 'Select column or type it',
    isFreeText: false,
    data: []
  },

  createView: function() {
    return new RowView({
      model: this
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./row_view":123}],123:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View for the street addresses georeference option.
 */
module.exports = cdb.core.View.extend({

  className: 'Form-row Form-row--step',

  initialize: function() {
    this._initViews();
    this._initBinds();
  },

  render: function() {
    this.$el.html(
      this.getTemplate('common/dialogs/georeference/row')({
        label: this.model.get('label')
      })
    );
    this.$('.js-select').append(this._selectView.render().el);
    return this;
  },

  _initBinds: function() {
    this.model.bind('change:value', this._onChangeValue, this);
  },

  _initViews: function() {
    this._selectView = new cdb.forms[this.model.get('comboViewClass')]({
      model: this.model,
      placeholder: this.model.get('placeholder'),
      disabled: this.model.get('disabled'),
      extra: this.model.get('data'),
      className: 'Select',
      width: '100%',
      property: 'value',

      // This is only needed for a ComboFreeText view, but doesn't hurt for the normal Combo so let's leave it
      text: 'isFreeText'
    });
    this.addView(this._selectView);

    // Simulate a initial selection to update model to be in sync with the view
    this._selectView.render()._changeSelection();
  },

  _onChangeValue: function(m, val) {
    this.$el.toggleClass('is-done', !!val);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],124:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View to render a set of rows.
 */
module.exports = cdb.core.View.extend({

  initialize: function() {
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();
    this._renderRows();
    return this;
  },

  _initBinds: function() {
    var rows = this.model.get('rows');
    rows.bind('change', this.model.assertIfCanContinue, this.model);
    this.add_related_model(rows);
  },

  _renderRows: function() {
    this.model.get('rows').chain()
      .map(this._createRowView, this)
      .map(this._appendRowToDOM, this);
  },

  _createRowView: function(m) {
    var view = m.createView();
    this.addView(view);
    return view;
  },

  _appendRowToDOM: function(view) {
    this.$el.append(view.render().el);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],125:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var RowsView = require('./rows_view');
var ChooseGeometryView = require('./choose_geometry_view');
var ViewFactory = require('../../view_factory');

/**
 * View for the georeference types that requires the two-steps flow.
 * First select columns values, and then the geometry type to use.
 */
module.exports = cdb.core.View.extend({

  initialize: function() {
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();

    if (this.model.get('step') === 1) {
      this._renderChooseGeometry();
    } else {
      this._renderHeader();
      this._renderRows();
    }

    return this;
  },

  _renderHeader: function() {
    this._appendView(
      ViewFactory.createByTemplate('common/dialogs/georeference/default_content_header', {
        title: this.options.title,
        desc: this.options.desc
      })
    );
  },

  _renderRows: function() {
    this._appendView(
      new RowsView({
        model: this.model
      })
    );
  },

  _renderChooseGeometry: function() {
    this._appendView(
      new ChooseGeometryView({
        model: this.model
      })
    );
  },

  _appendView: function(view) {
    this.addView(view);
    this.$el.append(view.render().$el);
  },

  _initBinds: function() {
    this.model.bind('change:step', this.render, this);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"./choose_geometry_view":112,"./rows_view":124}],126:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

module.exports = cdb.core.View.extend({

  className: 'Georeference-estimation',

  initialize: function() {
    if (!_.isBoolean(this.options.hasHardLimit)) throw new Error('hasHardLimit is required');
    if (!this.options.userGeocoding) throw new Error('userGeocoding is required');
    this._initBinds();
  },

  render: function() {
    var estimation = this.model.get('estimation');
    var rows = this.model.get('rows');

    this.$el.html(
      this.getTemplate('common/dialogs/georeference/street_addresses/estimation')({
        hasEstimation: estimation !== undefined && rows !== undefined,
        hasHardLimit: this.options.hasHardLimit,
        costInCredits: this.model.costInCredits(),
        costInDollars: this.model.costInDollars(),
        blockPriceInDollars: this.options.userGeocoding.blockPriceInDollars(),
        hasRows: rows !== 0
      })
    );
    return this;
  },

  _initBinds: function() {
    this.model.bind('change error', this.render, this);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],127:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

module.exports = cdb.core.View.extend({

  className: 'Georeference-quota',

  render: function() {
    this.$el.html(
      this.getTemplate('common/dialogs/georeference/street_addresses/quota')({
        quotaLeft: this.model.quotaLeftThisMonth(),
        quotaUsedInPct: this.model.quotaUsedThisMonthInPct()
      })
    );
    return this;
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],128:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var StreetAddressesView = require('./street_addresses_view');
var RowModel = require('../row_model');
var StreetRowModel = require('./street_row_model');

/**
 * Model for the street addresses georeference option.
 */
module.exports = cdb.core.Model.extend({

  TAB_LABEL: 'Street Addresses',
  MAX_STREET_ROWS: 3,

  defaults: {
    columnsNames: [],
    columns: [],
    estimation: undefined
  },

  initialize: function(attrs) {
    if (!attrs.geocodeStuff) throw new Error('geocodeStuff is required');
    if (!_.isBoolean(attrs.isGoogleMapsUser)) throw new Error('isGoogleMapsUser is required');
    if (!attrs.userGeocoding) throw new Error('userGeocoding is required');
    if (!attrs.columns) throw new Error('columns is required');
    if (!attrs.estimation) throw new Error('estimation is required'); // cdb.admin.Geocodings.Estimations
  },

  createView: function() {
    this.set({
      canContinue: false,
      hideFooter: false,
      mustAgreeToTOS: false,
      confirmTOS: false,
      hasAgreedToTOS: false
    });
    this._initRows();

    return new StreetAddressesView({
      model: this
    });
  },

  isDisabled: function() {
    return !this.get('isGoogleMapsUser') && this.get('userGeocoding').hasReachedMonthlyQuota();
  },

  showCostsInfo: function() {
    return !this.get('isGoogleMapsUser');
  },

  getFormatterItemByRow: function(m) {
    var val = m.get('value');
    if (val) {
      return m.get('isFreeText') ? val.trim() : '{' + val + '}';
    }
  },

  assertIfCanAddMoreRows: function() {
    // If can add more rows, enable the add button only on the last street row
    var streetRows = this.get('rows').filter(this._isStreetRow);
    _.invoke(streetRows, 'set', 'canAddRow', false);
    _.last(streetRows).set('canAddRow', streetRows.length < this.MAX_STREET_ROWS);
  },

  daysLeftToNextBilling: function() {
    var today = moment().startOf('day');
    return moment(this.get('lastBillingDate')).add(30, 'days').diff(today, 'days')
  },

  continue: function() {
    var mustAgreeToTOS = this.get('mustAgreeToTOS');

    if (this._hasAgreedToTOS() || !mustAgreeToTOS) {
      var d = this.get('geocodeStuff').geocodingChosenData({
        type: 'address',
        kind: 'high-resolution',
        formatter: this.get('formatter')
      });
      this.set('geocodeData', d);
    } else if (mustAgreeToTOS) {
      this.set('confirmTOS', true);
    }
  },

  hasHardLimit: function() {
    return !!this.get('userGeocoding').get('hard_limit');
  },

  _hasAgreedToTOS: function() {
    return this.get('mustAgreeToTOS') && this.get('hasAgreedToTOS');
  },

  _isStreetRow: function(row) {
    return row instanceof StreetRowModel;
  },

  _initRows: function() {
    var columns = this.get('columns');
    var isDisabled = this.isDisabled();
    var rows = new Backbone.Collection([
      new StreetRowModel({
        label: 'Which column are your street addresses stored in?',
        data: columns,
        canAddRow: true,
        disabled: isDisabled
      }),
      new RowModel({
        label: 'State/province where address is located, if known',
        data: columns,
        disabled: isDisabled
      }),
      new RowModel({
        label: 'Country where street address is located, if known',
        data: columns,
        disabled: isDisabled
      })
    ]);
    this.set('rows', rows);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../row_model":122,"./street_addresses_view":129,"./street_row_model":130}],129:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var ViewFactory = require('../../../view_factory');
var EstimationView = require('./estimation_view');
var QuotaView = require('./quota_view');
var DefaultFooterView = require('../default_footer_view');
var pluralizeString = require('../../../view_helpers/pluralize_string');

/**
 * View to select long/lat couple to do the georeference.
 */
module.exports = cdb.core.View.extend({

  initialize: function() {
    this._initBinds();
    this._fetchEstimation();
  },

  render: function() {
    this.clearSubViews();
    this.$el.html(
      this.getTemplate('common/dialogs/georeference/street_addresses/street_addresses')({
      })
    );
    this._renderHeader();
    this._renderRows();

    var showCostsInfo = this.model.showCostsInfo();
    if (showCostsInfo) {
      this._renderEstimation();
      this._renderQuota();
    }
    this.$('.js-costs-info').toggle(!!showCostsInfo);

    this._renderFooter();
    return this;
  },

  _renderHeader: function() {
    var view = ViewFactory.createByTemplate('common/dialogs/georeference/default_content_header', {
      title: 'Select the column(s) that has your street address',
      desc: 'Use this option if you need high resolution geocoding of your street adresses data.'
    });
    this.addView(view);
    this.$el.prepend(view.render().$el);
  },

  _renderRows: function() {
    this._$rows().toggleClass('u-disabled', !!this.model.isDisabled());
    this.model.get('rows').chain()
      .map(this._createRowView, this)
      .map(this._appendRowToDOM, this);
  },

  _renderEstimation: function() {
    var view = new EstimationView({
      model: this.model.get('estimation'),
      userGeocoding: this.model.get('userGeocoding'),
      hasHardLimit: this.model.hasHardLimit()
    });
    this.addView(view);
    this.$('.js-estimation').append(view.render().el);
  },

  _renderQuota: function() {
    var view = new QuotaView({
      model: this.model.get('userGeocoding')
    });
    this.addView(view);
    this.$('.js-quota').append(view.render().el);
  },

  _renderFooter: function() {
    var content;

    if (this.model.isDisabled()) {
      content = this.getTemplate('common/dialogs/georeference/street_addresses/upgrade_footer')({
        cartodb_com_hosted: cdb.config.get('cartodb_com_hosted'),
        upgradeURL: cdb.config.get('upgrade_url'),
        pluralizeString: pluralizeString,
        daysLeftToNextBilling: this.model.daysLeftToNextBilling()
      });
    } else {
      var view = new DefaultFooterView({
        model: this.model
      });
      this.addView(view);
      content = view.render().$el;
    }

    this.$el.append(content);
  },

  _createRowView: function(m) {
    var view = m.createView();
    this.addView(view);
    return view;
  },

  _appendRowToDOM: function(view) {
    this._$rows().append(view.render().el);
  },

  _$rows: function() {
    return this.$('.js-rows');
  },

  _initBinds: function() {
    var rows = this.model.get('rows');
    rows.bind('change', this._onChangeRows, this);
    rows.bind('add', this._onAddRow, this);
    this.add_related_model(rows);

    var estimation = this.model.get('estimation');
    estimation.bind('change', this._onChangeEstimation, this);
    estimation.bind('error', this._onEstimationError, this);
    this.add_related_model(estimation);

    var geocodeStuff = this.model.get('geocodeStuff');
    geocodeStuff.bind('change:forceAllRows', this._onChangeForceAllRows, this);
    this.add_related_model(geocodeStuff);

    this.model.bind('change:confirmTOS', this._onChangeConfirmTOS, this);
    this.model.bind('change:isGoogleMapsUser', this.render, this);
  },

  _onChangeForceAllRows: function() {
    this.model.get('estimation').reset();
    this._fetchEstimation();
  },

  _fetchEstimation: function() {
    if (this.model.showCostsInfo()) {
      this.model.get('estimation').fetch({
        data: {
          force_all_rows: this.model.get('geocodeStuff').get('forceAllRows')
        }
      });
    }
  },

  _onChangeRows: function() {
    var formatter = this.model.get('rows').chain()
      .map(this.model.getFormatterItemByRow)
      .compact() // there might be rows that have no value, if so skip them
      .value().join(', ');

    this.model.set({
      formatter: formatter,
      canContinue: !_.isEmpty(formatter)
    });
  },

  _onAddRow: function(newRow, rows, opts) {
    var rowView = this._createRowView(newRow);
    this.$('.js-rows').children().eq(opts.index).before(rowView.render().el);
    this.model.assertIfCanAddMoreRows();
  },

  _onChangeEstimation: function() {
    var mustAgreeToTOS = this.model.get('estimation').mayHaveCost() && !this.model.hasHardLimit();
    this.model.set('mustAgreeToTOS', mustAgreeToTOS);
  },

  _onEstimationError: function() {
    // Force re-render, handled in subview
    this.model.get('estimation').set({
      estimation: -1,
      rows: -1
    });
  },

  _onChangeConfirmTOS: function(m, confirmTOS) {
    if (confirmTOS) {
      this.model.set('confirmTOS', false, { silent: true }); // to re-renable if cancelled
      var view = ViewFactory.createDialogByTemplate('common/dialogs/georeference/street_addresses/confirm_tos', {
        // template data
        costInDollars: this.model.get('estimation').costInDollars()
      }, {
        // dialog options
        triggerDialogEvents: false, // to avoid closing this modal
        enter_to_confirm: true,
        clean_on_hide: false
      });
      view.ok = this._onAgreeToTOS.bind(this);
      this.addView(view);
      view.appendToBody();
    }
  },

  _onAgreeToTOS: function() {
    this.model.set('hasAgreedToTOS', true);
    this.model.continue();
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../../view_factory":209,"../../../view_helpers/pluralize_string":211,"../default_footer_view":114,"./estimation_view":126,"./quota_view":127}],130:[function(require,module,exports){
var RowModel = require('../row_model');
var StreetRowView = require('./street_row_view');

/**
 * Specialization for the street row, to add an additonal row
 */
module.exports = RowModel.extend({

  createView: function() {
    return new StreetRowView({
      model: this
    });
  },

  addRow: function() {
    var newRowModel = new this.constructor({
      label: 'Additional information to complete street address',
      data: this.get('data')
    });
    this.collection.add(newRowModel, { at: this._indexAfterThisModel() });
  },

  _indexAfterThisModel: function() {
    return this.collection.indexOf(this) + 1;
  }

});

},{"../row_model":122,"./street_row_view":131}],131:[function(require,module,exports){
var RowView = require('../row_view');

/**
 * Special view for the street addresses georeference option
 * This allows to potentially add more
 */
module.exports = RowView.extend({

  events: RowView.extendEvents({
    'click .js-add-row': '_onClickAddRow'
  }),

  initialize: function() {
    RowView.prototype.initialize.apply(this, arguments);
    this._initStreetRowBinds();
  },

  render: function() {
    RowView.prototype.render.call(this);
    if (!this.model.get('disabled')) {
      this.$el.append(
        this.getTemplate('common/dialogs/georeference/street_addresses/row_add_row')()
      );
    }
    return this;
  },

  _initStreetRowBinds: function() {
    this.model.bind('change:canAddRow', this._onChangeCanAddRow, this);
  },

  _onClickAddRow: function(ev) {
    this.killEvent(ev);
    this.model.addRow();
  },

  _onChangeCanAddRow: function(m, canAddRow) {
    this.$('.js-add-row').toggle(!!canAddRow);
  }

});

},{"../row_view":123}],132:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View for an indvidual tab item
 */
module.exports = cdb.core.View.extend({

  tagName: 'li',
  className: 'Filters-typeItem Filters-typeItem--moreMargins',

  events: {
    'click .js-btn': '_onClick'
  },

  initialize: function() {
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();

    this.$el.html(
      this.getTemplate('common/dialogs/georeference/tab_item')({
        label: this.model.TAB_LABEL,
        isDisabled: this.model.get('disabled')
      })
    );
    this._onChangeSelected(this.model, this.model.get('selected'));
    this._onChangeDisabled(this.model, this.model.get('disabled'));
    this._createDisabledTooltip();

    return this;
  },

  _initBinds: function() {
    this.model.bind('change:selected', this._onChangeSelected, this);
    this.model.bind('change:disabled', this._onChangeDisabled, this);
  },

  _onChangeSelected: function(m, isSelected) {
    this.$('button').toggleClass('is-selected', !!isSelected);
  },

  _onChangeDisabled: function(m, isDisabled) {
    isDisabled ? this.undelegateEvents() : this.delegateEvents();
  },

  _createDisabledTooltip: function() {
    var msg = this.model.get('disabled');
    if (!_.isEmpty(msg)) {
      this.addView(
        new cdb.common.TipsyTooltip({
          el: this.$('.js-btn'),
          fallback: msg,
          gravity: 's',
          offset: -30
        })
      );
    }
  },

  _onClick: function(ev) {
    this.killEvent(ev);
    this.model.set('selected', true);
  }
});


}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],133:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * A value object to encapsulate logic related to user view model.
 *
 * Expected to be create with geocoding value from an user, e.g.:
 *   new UserGeocoding(user.get('geocoding'));
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    quota: null, // is based on monthly usage
    block_price: null, // cost (in cents) per each 1000 credits extra
    monthly_use: 0,
    hard_limit: false
  },

  hasQuota: function() {
    var quota = this.get('quota');
    return quota !== null && quota !== undefined && quota !== '';
  },

  hasReachedMonthlyQuota: function() {
    return this.get('hard_limit') && this._maybe(function(quota, monthlyUse) {
      return (monthlyUse >= quota);
    }, false);
  },

  /**
   * Returns the quota left.
   * @return {Number} a non-negative number (.e.g in the case of monthly usage exceeds the quota, returns 0)
   */
  quotaLeftThisMonth: function() {
    return this._maybe(function(quota, monthlyUse) {
      return Math.max(quota - monthlyUse, 0);
    }, 0);
  },

  quotaUsedThisMonthInPct: function() {
    return this._maybe(function(quota, monthlyUse) {
      return (monthlyUse * 100) / quota;
    }, 0);
  },

  blockPriceInDollars: function() {
    return Math.ceil(this.get('block_price') / 100);
  },

  // Make sure monthly_use and quota are set
  _maybe: function(fn, fallbackVal) {
    var monthlyUse = this.get('monthly_use');
    var quota = this.get('quota');

    if (monthlyUse >= 0 && quota >= 0) {
      return fn(quota, monthlyUse);
    } else {
      return fallbackVal;
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],134:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null)

/**
 *  Limits reach content
 *
 */

module.exports = cdb.core.View.extend({

  events: {
    'click .js-toggler': '_onLumpSumClick'
  },

  initialize: function() {
    this.user = this.options.user;
    this.model = new cdb.core.Model({
      lumpSum: false
    });
    this.template = cdb.templates.getTemplate('common/dialogs/limits_reach/limits_reached_content');
    this._initBinds();
  },

  render: function() {
    var canUpgrade = cdb.config.get('upgrade_url') && !cdb.config.get('cartodb_com_hosted') && !this.user.isInsideOrg();
    var currentPlan = this.user.get("account_type");

    var availablePlans = _.compact(this.collection.map(function(plan, index) {
      var price = plan.get('price');
      var planName = plan.get('title');

      return {
        name: planName.toLowerCase(),
        price: Utils.formatNumber(price),
        isUserPlan: planName.search(currentPlan) !== -1,
        lumpSumPrice: price == "0" ? "0" : Utils.formatNumber(plan.get('lump_sum').price),
        quota: Utils.readablizeBytes(plan.get('bytes_quota')).replace(/\.00/g,'').replace(" ", ""),
        layers: plan.get('max_layers'),
        privateMaps: plan.get('private_tables'),
        removableBrand: plan.get('removable_brand')
      }
    }));

    this.$el.html(
      this.template({
        lumpSum: this.model.get('lumpSum'),
        itemHighlighted: this._getHighlighted(availablePlans, this.user.get("account_type")),
        canUpgrade: canUpgrade,
        availablePlans: availablePlans,
        organizationAdmin: this.user.isOrgOwner(),
        organizationUser: (this.user.isInsideOrg() && !this.user.isOrgOwner()),
        customHosted: cdb.config.get('cartodb_com_hosted'),
        upgradeURL: cdb.config.get('upgrade_url'),
        canStartTrial: this.user.canStartTrial()
      })
    );

    return this;
  },

  _initBinds: function() {
    this.model.bind('change', this.render, this);
    this.collection.bind('reset', this.render, this);
    this.add_related_model(this.collection);
  },

  _getHighlighted: function(plans, currentPlan) {
    var item = 0;
    for (var i = 0, l = plans.length; i < l; i++) {
      if (plans[i].name.search(currentPlan) !== -1) {
        item = i;
      }
    }
    return item < 2 ? 2 : 3;
  },

  _onLumpSumClick: function() {
    this.model.set('lumpSum', !this.model.get('lumpSum'));
  }

})

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],135:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var UserPlansCollection = require('./user_plans_collection');
var LimitsReachedContentView = require('./limits_reached_content_view');
var BaseDialog = require('../../views/base_dialog/view');
var randomQuote = require('../../view_helpers/random_quote');
var ViewFactory = require('../../view_factory');

/**
 *  Show upgrade possibilities per user type
 *
 */

module.exports = BaseDialog.extend({

  initialize: function() {
    this.user = this.options.user;
    this.userPlans = new UserPlansCollection(null, { user: this.user });
    this.elder('initialize');
    this._initBinds();
  },

  render_content: function() {
    var canUpgrade = cdb.config.get('upgrade_url') && !cdb.config.get('cartodb_com_hosted') && !this.user.isInsideOrg();
    var organizationAdminEmail = this.user.isInsideOrg() && this.user.organization.get('owner').email || '';
    var $el = $(cdb.templates.getTemplate('common/dialogs/limits_reach/limits_reached')({
      canUpgrade: canUpgrade,
      organizationAdminEmail: organizationAdminEmail,
      organizationAdmin: this.user.isOrgOwner(),
      organizationUser: (this.user.isInsideOrg() && !this.user.isOrgOwner()),
      layersCount: this.user.getMaxLayers(),
      customHosted: cdb.config.get('cartodb_com_hosted')
    }));
    this._initViews($el);
    return $el;
  },

  _initBinds: function() {
    this.userPlans.bind('error', function() {
      this._panes.active('error');
    }, this);
    this.userPlans.bind('reset', function() {
      this._panes.active('content');
    }, this);
    this.add_related_model(this.userPlans);
  },

  _initViews: function($el) {
    this._panes = new cdb.ui.common.TabPane({
      el: $el.find('.js-content')
    });
    this.addView(this._panes);

    this._panes.addTab('loading',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Getting plans info…',
        quote: randomQuote()
      }).render()
    );

    this._panes.addTab('error',
      ViewFactory.createByTemplate('common/templates/fail', {
        msg: 'Sorry, something went wrong trying to get your available plans.'
      }).render()
    );

    this._panes.addTab('content',
      new LimitsReachedContentView({
        user: this.user,
        collection: this.userPlans
      }).render()
    );

    var canUpgrade = cdb.config.get('upgrade_url') && !cdb.config.get('cartodb_com_hosted') && !this.user.isInsideOrg();

    this._panes.active(canUpgrade ? 'loading' : 'content');

    if (canUpgrade) {
      this.userPlans.fetch({
        error: function() {
          this.trigger('error');
        }
      });
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213,"./limits_reached_content_view":134,"./user_plans_collection":137}],136:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);

/**
 *  User plans model
 *
 */

module.exports = cdb.core.Model.extend({

  defaults: {
    title: '',
    desc: '',
    price: 0,
    tables_quota: '',
    bytes_quota: 0,
    support: '',
    private_tables: false,
    removable_brand: false,
    max_layers: 4
  }

})
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],137:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var UserPlanModel = require('./user_plan_model');

/**
 *  User plans collection
 *
 *  - It will get the available plans per user
 */


module.exports = Backbone.Collection.extend({

  model: UserPlanModel,

  url: function() {
    return '//' + cdb.config.get('account_host') + '/account/' + this.user.get('username') + '.json'
  },

  initialize: function(models, opts) {
    if (!opts.user) {
      throw new Error('user model is needed')
    }
    this.user = opts.user;
  },

  sync: function(method, model, options) {
    var self = this;
    var params = _.extend({
      type: 'GET',
      dataType: 'jsonp',
      url: self.url(),
      processData: false
    }, options);

    return $.ajax(params);
  },

  parse: function(r) {
    return r.available_plans
  }

})
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./user_plan_model":136}],138:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var GuessingTogglerView = require('../../create/footer/guessing_toggler_view');
var PrivacyTogglerView = require('../../create/footer/privacy_toggler_view');

/**
 * Footer view for the add layer modal.
 */
module.exports = cdb.core.View.extend({

  events: {
    'click .js-ok': '_finish'
  },

  initialize: function() {
    this.elder('initialize');
    this.user = this.options.user;
    this.guessingModel = new cdb.core.Model({ guessing: true });
    this.privacyModel = new cdb.core.Model({
      privacy: this.user.canCreatePrivateDatasets() ? 'PRIVATE' : 'PUBLIC'
    });
    this._template = cdb.templates.getTemplate('common/dialogs/map/add_layer/footer');
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();

    var $el = $(
      this._template({
        canFinish: this.model.canFinish(),
        listing: this.model.get('listing')
      })
    );
    this.$el.html($el);

    this._initViews();

    return this;
  },

  _initViews: function() {
    var guessingTogglerView = new GuessingTogglerView({
      model: this.guessingModel,
      user: this.user,
      createModel: this.model
    });
    this.$('.js-footer-info').append(guessingTogglerView.render().el);
    this.addView(guessingTogglerView);

    this.privacyTogglerView = new PrivacyTogglerView({
      model: this.privacyModel,
      user: this.user,
      createModel: this.model
    });
    this.$('.js-footerActions').prepend(this.privacyTogglerView.render().el);
    this.addView(this.privacyTogglerView);
  },

  _initBinds: function() {
    this.model.upload.bind('change', this.render, this);
    this.model.selectedDatasets.bind('all', this._update, this);
    this.model.bind('change', this._update, this);
    this.add_related_model(this.model.upload);
    this.add_related_model(this.model.selectedDatasets);
  },

  _update: function() {
    var contentPane = this.model.get('contentPane');
    var listing = this.model.get('listing');
    if (contentPane === 'listing' && listing !== 'scratch') {
      this.render().show();
    } else {
      this.hide();
    }
  },

  _finish: function(e) {
    this.killEvent(e);
    if (this.model.canFinish()) {
      // Set proper guessing values before starting the upload
      // if dialog is in import section
      if (this.model.get('listing') === 'import') {
        this.model.upload.set('privacy', this.privacyModel.get('privacy'));
        this.model.upload.setGuessing(this.guessingModel.get('guessing'));
      }
      this.model.finish();
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../create/footer/guessing_toggler_view":59,"../../create/footer/privacy_toggler_view":60}],139:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var UploadModel = require('../../background_polling/models/upload_model');
var VisFetchModel = require('../../visualizations_fetch_model');

var IMPORT = 'import';
var DATASETS = 'datasets';
var SCRATCH = 'scratch';

var IMPORT_FILE = 'file';
var IMPORT_TWITTER = 'twitter';

/**
 * Add layer model
 *
 * "Implements" the CreateListingModel.
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    type: 'addLayer',
    contentPane: 'listing', // [listing, loading]
    listing: DATASETS, // [IMPORT, DATASETS, SCRATCH]
    collectionFetched: false,
    activeImportPane: IMPORT_FILE
  },

  initialize: function(attrs, opts) {
    this.user = opts.user;
    this.vis = opts.vis;
    this.map = opts.map;

    this.upload = new UploadModel({
      create_vis: false
    }, {
      user: this.user
    });

    this.selectedDatasets = new Backbone.Collection();
    this.collection = new cdb.admin.Visualizations();
    this.visFetchModel = new VisFetchModel({
      content_type: DATASETS,
      library: this.showLibrary()
    });
    this._initBinds();
    this._maybePrefetchDatasets();
  },

  // For create-listing view
  canSelect: function(dataset) {
    return dataset.get('selected') || this.selectedDatasets.length < 1; // for now only allow 1 item
  },

  // For create-listing view
  showLibrary: function() {
    return false;
  },

  // For create-listing view
  showDatasets: function() {
    return true;
  },

  // For create-listing-import view
  setActiveImportPane: function(name) {
    this.set('activeImportPane', name);
  },

  // For footer
  canFinish: function() {
    if (this._atImportPane()) {
      return this.upload.isValidToUpload();
    } else if (this._atDatasetsPane()) {
      return this.selectedDatasets.length > 0;
    }
  },

  finish: function() {
    if (this._atImportPane()) {
      cdb.god.trigger('importByUploadData', this.upload.toJSON(), this);
    } else if (this._atDatasetsPane()) {
      var mdl = this.selectedDatasets.at(0);
      if (mdl.get('type') === 'remote') {
        var d = {
          create_vis: false,
          type: 'remote',
          value: mdl.get('name'),
          remote_visualization_id: mdl.get('id'),
          size: mdl.get('external_source') ? mdl.get('external_source').size : undefined
        };
        // See BackgroundImporter where the same event is bound to be handled..
        cdb.god.trigger('importByUploadData', d, this);
      } else {
        this._addNewLayer(mdl.tableMetadata().get('name'));
      }
    }
  },

  // For footer (type guessing)
  getImportState: function() {
    return this.get('activeImportPane');
  },

  // For footer (type guessing)
  showGuessingToggler: function() {
    return this._atImportPane();
  },

  // For create-footer view
  showPrivacyToggler: function() {
    var hiddenDueToDeprecation = this._atTwitterImportPane() && !this.user.hasOwnTwitterCredentials();
    var hasToBeShowed = this._atImportPane() && !hiddenDueToDeprecation;
    return hasToBeShowed;
  },

  _atImportPane: function () {
    return this.get('listing') === IMPORT;
  },

  _atDatasetsPane: function () {
    return this.get('listing') === DATASETS;
  },

  _atScratchPane: function () {
    return this.get('listing') === SCRATCH;
  },

  _atTwitterImportPane: function () {
    return this.get('activeImportPane') === IMPORT_TWITTER;
  },

  // For create-from-scratch view
  createFromScratch: function() {
    this.set('contentPane', 'creatingFromScratch');
    var self = this;
    var table = new cdb.admin.CartoDBTableMetadata();
    table.save({}, {
      success: function() {
        self._addNewLayer(table.get('name'));
      },
      error: function(req, resp) {
        if (resp.responseText.indexOf('You have reached your table quota') !== -1) {
          this.set('contentPane', 'datasetQuotaExceeded');
        } else {
          this.set('contentPane', 'addLayerFailed');
        }
      }
    });
  },

  _initBinds: function() {
    this.upload.bind('change', function() {
      this.trigger('change:upload', this);
    }, this);
    this.visFetchModel.bind('change', this._fetchCollection, this);
    this.bind('change:listing', this._maybePrefetchDatasets);

    this.collection.bind('change:selected', function(changedModel, wasSelected) {
      this.selectedDatasets[ wasSelected ? 'add' : 'remove' ](changedModel);
    }, this);
    this.collection.bind('reset', function() {
      this.selectedDatasets.each(function(model) {
        var sameModel = this.collection.get(model.id);
        if (sameModel) {
          sameModel.set('selected', true);
        }
      }, this);
    }, this);
  },

  _maybePrefetchDatasets: function() {
    if (this._atDatasetsPane() && !this.get('collectionFetched') && !this.visFetchModel.isSearching()) {
      this.set('collectionFetched', true);
      this._fetchCollection();
    }
  },

  _fetchCollection: function() {
    var params = this.visFetchModel.attributes;
    var types;

    if (this.visFetchModel.isSearching()) {
      // Supporting search in data library and user datasets at the same time
      types = 'table,remote';
    } else {
      types = params.library ? 'remote' : 'table';
    }

    this.collection.options.set({
      locked: '',
      q: params.q,
      page: params.page || 1,
      tags: params.tag,
      per_page: this.collection['_TABLES_PER_PAGE'],
      shared: params.shared,
      order: 'updated_at',
      type: '',
      types: types,
      exclude_raster: true
    });

    this.collection.fetch();
  },

  _onCollectionChange: function() {
    this.selectedDatasets.reset(this.collection.where({ selected: true }));
  },

  _addNewLayer: function(tableName) {
    this.set('contentPane', 'addingNewLayer');

    var self = this;
    this.map.addCartodbLayerFromTable(tableName, this.user.get('username'), {
      vis: this.vis,
      success: function() {
        // layers need to be saved because the order may changed
        self.map.layers.saveLayers();
        self.trigger('addLayerDone');
      },
      error: function(req, resp) {
        if (resp.responseText.indexOf('You have reached your table quota') !== -1) {
          self.set('contentPane', 'datasetQuotaExceeded');
        } else {
          self.set('contentPane', 'addLayerFailed');
        }
      }
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../background_polling/models/upload_model":15,"../../visualizations_fetch_model":221}],140:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var CreateListing = require('../create/create_listing');
var FooterView = require('./add_layer/footer_view');
var ViewFactory = require('../../view_factory');
var randomQuote = require('../../view_helpers/random_quote');
var NavigationView = require('../create/listing/navigation_view');

/**
 * Add layer dialog, typically used from editor
 */
module.exports = BaseDialog.extend({

  initialize: function () {
    this.elder('initialize');
    if (!this.model) {
      throw new TypeError('model is required');
    }
    if (!this.options.user) {
      throw new TypeError('user is required');
    }

    this._template = cdb.templates.getTemplate('common/dialogs/map/add_layer_template');
    this._initBinds();
  },

  // implements cdb.ui.common.Dialog.prototype.render
  render: function () {
    this.clearSubViews();
    BaseDialog.prototype.render.call(this);
    this.$('.content').addClass('Dialog-content--expanded');
    this._initViews();
    this.$('.js-footer').append(this._footerView.render().el);
    return this;
  },

  // implements cdb.ui.common.Dialog.prototype.render
  render_content: function () {
    return this._template({
    });
  },

  _initBinds: function () {
    this.model.bind('addLayerDone', this.close, this);
    this.model.bind('change:contentPane', this._onChangeContentView, this);
    cdb.god.bind('importByUploadData', this.close, this);
    this.add_related_model(cdb.god);
  },

  _initViews: function () {
    this._contentPane = new cdb.ui.common.TabPane({
      el: this.$('.js-content-container')
    });
    this.addView(this._contentPane);

    this._navigationView = new NavigationView({
      el: this.$('.js-navigation'),
      user: this.options.user,
      routerModel: this.model.visFetchModel,
      createModel: this.model,
      collection: this.model.collection
    });
    this._navigationView.render();
    this.addView(this._navigationView);

    this._addTab('listing',
      new CreateListing({
        createModel: this.model,
        user: this.options.user
      })
    );
    this._addTab('creatingFromScratch',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Creating empty dataset…',
        quote: randomQuote()
      })
    );
    this._addTab('addingNewLayer',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Adding new layer…',
        quote: randomQuote()
      })
    );
    this._addTab('addLayerFailed',
      ViewFactory.createByTemplate('common/templates/fail', {
        msg: 'Could not add layer'
      })
    );
    this._contentPane.active(this.model.get('contentPane'));

    this._footerView = new FooterView({
      model: this.model,
      user: this.options.user
    });
    this.addView(this._footerView);
  },

  _addTab: function (name, view) {
    this._contentPane.addTab(name, view.render());
    this.addView(view);
  },

  _onChangeContentView: function () {
    var pane = this.model.get('contentPane');
    this._contentPane.active(pane);
    if (pane === 'loading') {
      this._footerView.hide();
    }
    if (pane !== 'listing') {
      this._navigationView.hide();
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213,"../create/create_listing":58,"../create/listing/navigation_view":92,"./add_layer/footer_view":138}],141:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 *  Asset item previewing image
 *
 *  - It needs a model with asset url and state (is-idle, is-selected, is-destroying).
 *
 *  new AssetsItemView({
 *    model: asset_model
 *  })
 */
module.exports = cdb.core.View.extend({

  _SIZE: 60, // Thumbnail size (same cm for width and height)
  _MIN_SIZE: 32, // Minimal thumbnail size (same cm for width and height)

  tagName: 'li',

  options: {
    template: 'common/dialogs/map/image_picker/assets_item'
  },

  events: {
    'click a.delete': '_openDropdown',
    'click':          '_onClick'
  },

  initialize: function() {
    this.template = cdb.templates.getTemplate(this.options.template);
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();
    this.$el.append(this.template(this.model.toJSON()));

    this._calcBkgImg(this.model.get("public_url"));

    return this;
  },

  _initBinds: function() {
    _.bindAll(this, '_onClick', '_openDropdown');

    this.model.bind('change:state', this._changeState, this);
    this.model.bind('destroy', this.remove, this);
  },

  _calcBkgImg: function(src) {
    var img = new Image();
    var self = this;

    img.onload = function() {
      var w = this.width;
      var h = this.height;

      var $thumbnail = self.$("a.image");

      self.$el.css("background","none");

      if(self.model.get("kind") === 'marker') {
        if(h > self._SIZE) {
          $thumbnail.css({
            "background-size":  "cover",
            "background-origin": "content-box"
          });
        } else if ((w || h) < self._MIN_SIZE) {
          // Scale up images smaller than considered min size (e.g. maki icons).
          $thumbnail.css({
            "background-size": self._MIN_SIZE + "px"
          });
        }
      } else {
        if ((w || h) > self._SIZE) {
          $thumbnail.css({
            "background-size":  "cover",
            "background-origin": "content-box"
          });
        } else {
          $thumbnail.css({
            "background-position": "0 0",
            "background-repeat": "repeat"
          });
        }
      }
    }

    img.onerror = function(e){ cdb.log.info(e) };
    img.src = src;
  },

  _onClick: function(e) {
    this.killEvent(e);

    if (this.model.get('state') !== 'selected' && this.model.get('state') != 'destroying') {
      this.trigger('selected', this.model);
      this.model.set('state', 'selected');
    }
  },

  _changeState: function() {
    this.$el
      .removeClass('is-idle is-selected is-destroying')
      .addClass("is-" + this.model.get('state'));
  },

  _openDropdown: function(e) {
    var self = this;

    this.killEvent(e);
    e.stopImmediatePropagation();

    this.dropdown = new cdb.admin.DropdownMenu({
      className: 'dropdown border tiny',
      target: $(e.target),
      width: 196,
      speedIn: 150,
      speedOut: 300,
      template_base: 'common/dialogs/map/image_picker/remove_asset',
      vertical_position: "down",
      horizontal_position: "left",
      horizontal_offset: 3,
      tick: "left"
    });

    this.dropdown.bind("optionClicked", function(ev) {
      ev.preventDefault();
      self._deleteAsset();
    });

    $('body').append(this.dropdown.render().el);
    this.dropdown.open(e);
    cdb.god.bind("closeDialogs", this.dropdown.hide, this.dropdown);
  },

  _deleteAsset: function() {
    var self = this;
    this.model.set('state', 'destroying');

    this.model.destroy({
      success: function() {},
      error: function() {
        self.model.set('state', 'idle');
      }
    })
  }
});


}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],142:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var StaticAssetItemView = require('./static_assets_item_view');

module.exports = cdb.core.View.extend({

  className: 'AssetPane',

  initialize: function() {
    this.model = this.options.model;
    this.template = cdb.templates.getTemplate('common/dialogs/map/image_picker/assets_template');
    this._setupAssets();
  },

  render: function() {
    this.clearSubViews();
    this.$el.html(this.template());
    this._renderAssets();
    return this;
  },

  _setupAssets: function() {
    var opts = {};

    if (this.options.folder !== undefined)  opts.folder = this.options.folder;
    if (this.options.size   !== undefined)  opts.size   = this.options.size;
    if (this.options.host   !== undefined)  opts.host   = this.options.host;
    if (this.options.ext    !== undefined)  opts.ext    = this.options.ext;

    if (!_.isEmpty(opts)) {
      this.options.icons = _.map(this.options.icons, function(a) {
        return _.extend(a, opts);
      });
    }

    this.collection = new cdb.admin.StaticAssets(this.options.icons);
  },

  _renderAssets: function() {
    var self = this;
    var items = this.collection.where({ kind: this.options.kind });

    _(items).each(function(mdl) {
      var item = new StaticAssetItemView({
        className: 'AssetItem ' + (self.options.folder || ''),
        template: 'common/dialogs/map/image_picker/static_assets_item',
        model: mdl
      });
      item.bind('selected', self._selectItem, self);

      self.$('ul').append(item.render().el);
      self.addView(item);
    });
  },

  _selectItem: function(m) {
    this.model.set('value', m.get('public_url'));
    this.trigger('fileChosen', this);
    this._unselectItems(m);
  },

  // Unselect all images expect the selected one
  _unselectItems: function(m) {
    this.collection.each(function(mdl) {
      if (mdl !== m && mdl.get('state') === 'selected') {
        mdl.set('state', 'idle');
      }
    });
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./static_assets_item_view":152}],143:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var UploadModel = require('./upload_model');

module.exports = cdb.core.View.extend({

  className: 'AssetPane',

  events: {
    'click .js-fileButton': '_onBoxClick'
  },

  _UPLOADER: {
    url:              '/api/v1/users/<%- id %>/assets',
    uploads:          1, // Max uploads at the same time
    maxFileSize:      1048576, // 1MB
    acceptFileTypes:  ['png','svg','jpeg','jpg'],
    acceptSync:       undefined,
    resolution:       "1024x1024"
  },

  initialize: function() {
    _.bindAll(this, '_onDbxChooserSuccess');

    this.kind = this.options.kind;
    this.user = this.options.user;
    this._setupModel();
    this.collection = this.options.collection;
  },

  render: function() {
    this.clearSubViews();

    this.template = cdb.templates.getTemplate('common/dialogs/map/image_picker/box_template');

    this.$el.html(this.template());

    return this;
  },

  _setupModel: function() {
    this.model = new UploadModel({
      type: this.options.type,
      kind: this.options.kind
    }, {
      userId: this.user.get("id")
    });
    this._initBinds();
  },

  _initBinds: function() {
    this.model.bind('change:state', this._onChangeState, this);
  },

  _onStateUploaded: function() {
    this.collection.fetch();
    this.model.setFresh({ kind: this.kind });
  },

  _onStateError: function() {
    this._showFileError();
    this.trigger("hide_loader", this);
    this.$(".js-import-panel").show();
    this.model.setFresh({ kind: this.kind });
  },

  _showFileError: function() {
    if (this.model.get('state') === "error") {
      this.$('.js-fileError')
        .text(this.model.get('get_error_text').what_about)
        .show();
      this.$('.js-fileButton').addClass('Button--negative');
    }
  },

  _hideFileError: function() {
    this.$('.js-fileError').hide();
    this.$('.js-fileLabel').show();
    this.$('.js-fileButton').removeClass('Button--negative');
  },

  _onChangeState: function() {
    var state = this.model.get('state');

    if (state === 'uploaded') {
      this._onStateUploaded();
    } else {
      if (state == "error") {
        this._onStateError();
      } else if (state === 'idle' || state === "uploading") {
        this.$(".js-import-panel").hide();
        this.trigger("show_loader", this);
      } else {
        this.$(".js-import-panel").show();
        this.trigger("hide_loader", this);
      }
    }
  },


  _onBoxClick: function(e) {
    this.killEvent(e);

    Box.choose({
      success:      this._onDbxChooserSuccess,
      multiselect:  false,
      linkType:     "direct",
      extensions:   _.map(this._UPLOADER.acceptFileTypes, function(ext) { return '.' + ext })
    });
  },

  _onDbxChooserSuccess: function(files) {
    if (files && files[0]) {
      this.model.set({
        type: 'url',
        value: files[0].link,
        state: 'uploading'
      });

      this.model.upload();

      if (this.model.get('state') !== "error") {
        // Remove errors
        this._hideFileError();
      } else {
        this._showFileError();
      }
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./upload_model":153}],144:[function(require,module,exports){
// Maki icons from https://github.com/mapbox/maki
// and https://github.com/mapbox/maki/blob/mb-pages/_includes/maki.json
module.exports = {
  disclaimer: '<a href="https://github.com/mapbox/maki" target="_blank">Maki Icons</a>, an open source project by <a href="http://mapbox.com" target="_blank">Mapbox</a>',
  icons: [
    {
        "name": "Circle stroked",
        "icon": "circle-stroked"
    },
    {
        "name": "Circle solid",
        "icon": "circle"
    },
    {
        "name": "Square stroked",
        "icon": "square-stroked"
    },
    {
        "name": "Square solid",
        "icon": "square"
    },
    {
        "name": "Triangle stroked",
        "icon": "triangle-stroked"
    },
    {
        "name": "Triangle solid",
        "icon": "triangle"
    },
    {
        "name": "Star stroked",
        "icon": "star-stroked"
    },
    {
        "name": "Star solid",
        "icon": "star"
    },
    {
        "name": "Cross",
        "icon": "cross"
    },
    {
        "name": "Marker Stroke",
        "icon": "marker-stroked"
    },
    {
        "name": "Marker Solid",
        "icon": "marker"
    },
    {
        "name": "Religious Jewish",
        "icon": "religious-jewish"
    },
    {
        "name": "Religious Christian",
        "icon": "religious-christian"
    },
    {
        "name": "Religious Muslim",
        "icon": "religious-muslim"
    },
    {
        "name": "Cemetery",
        "icon": "cemetery"
    },
    {
        "name": "Rocket",
        "icon": "rocket"
    },
    {
        "name": "Airport",
        "icon": "airport"
    },
    {
        "name": "Heliport",
        "icon": "heliport"
    },
    {
        "name": "Rail",
        "icon": "rail"
    },
    {
        "name": "Rail Metro",
        "icon": "rail-metro"
    },
    {
        "name": "Rail Light",
        "icon": "rail-light"
    },
    {
        "name": "Bus",
        "icon": "bus"
    },
    {
        "name": "Fuel",
        "icon": "fuel"
    },
    {
        "name": "Parking",
        "tags": [
            "parking",
            "transportation"
        ],
        "icon": "parking"
    },
    {
        "name": "Parking Garage",
        "tags": [
            "parking",
            "transportation",
            "garage"
        ],
        "icon": "parking-garage"
    },
    {
        "name": "Airfield",
        "tags": [
            "airfield",
            "airport",
            "plane",
            "landing strip"
        ],
        "icon": "airfield"
    },
    {
        "name": "Roadblock",
        "tags": [
            "roadblock",
            "stop",
            "warning",
            "dead end"
        ],
        "icon": "roadblock"
    },
    {
        "name": "Ferry",
        "tags": [
            "ship",
            "boat",
            "water",
            "ferry",
            "transportation"
        ],
        "icon": "ferry"
    },
    {
        "name": "Harbor",
        "tags": [
            "marine",
            "dock",
            "water",
            "wharf"
        ],
        "icon": "harbor"
    },
    {
        "name": "Bicycle",
        "tags": [
            "cycling",
            "cycle",
            "transportation"
        ],
        "icon": "bicycle"
    },
    {
        "name": "Park",
        "tags": [
            "recreation",
            "park",
            "forest",
            "tree",
            "green",
            "woods",
            "nature"
        ],
        "icon": "park"
    },
    {
        "name": "Park 2",
        "tags": [
            "recreation",
            "park",
            "forest",
            "tree",
            "green",
            "woods",
            "nature"
        ],
        "icon": "park2"
    },
    {
        "name": "Museum",
        "tags": [
            "recreation",
            "museum",
            "tourism"
        ],
        "icon": "museum"
    },
    {
        "name": "Lodging",
        "tags": [
            "lodging",
            "hotel",
            "recreation",
            "motel",
            "tourism"
        ],
        "icon": "lodging"
    },
    {
        "name": "Monument",
        "tags": [
            "recreation",
            "statue",
            "monument",
            "tourism"
        ],
        "icon": "monument"
    },
    {
        "name": "Zoo",
        "tags": [
            "recreation",
            "zoo",
            "animal",
            "giraffe"
        ],
        "icon": "zoo"
    },
    {
        "name": "Garden",
        "tags": [
            "recreation",
            "garden",
            "park",
            "flower",
            "nature"
        ],
        "icon": "garden"
    },
    {
        "name": "Campsite",
        "tags": [
            "recreation",
            "campsite",
            "camp",
            "camping",
            "tent",
            "nature"
        ],
        "icon": "campsite"
    },
    {
        "name": "Theatre",
        "tags": [
            "recreation",
            "theatre",
            "theater",
            "entertainment",
            "play",
            "performance"
        ],
        "icon": "theatre"
    },
    {
        "name": "Art gallery",
        "tags": [
            "art",
            "center",
            "museum",
            "gallery",
            "creative",
            "recreation",
            "entertainment",
            "studio"
        ],
        "icon": "art-gallery"
    },
    {
        "name": "Pitch",
        "tags": [
            "pitch",
            "track",
            "athletic",
            "sports",
            "field"
        ],
        "icon": "pitch"
    },
    {
        "name": "Soccer",
        "tags": [
            "soccer",
            "sports"
        ],
        "icon": "soccer"
    },
    {
        "name": "American Football",
        "tags": [
            "football",
            "sports"
        ],
        "icon": "america-football"
    },
    {
        "name": "Tennis",
        "tags": [
            "tennis",
            "court",
            "ball",
            "sports"
        ],
        "icon": "tennis"
    },
    {
        "name": "Basketball",
        "tags": [
            "basketball",
            "ball",
            "sports"
        ],
        "icon": "basketball"
    },
    {
        "name": "Baseball",
        "tags": [
            "baseball",
            "softball",
            "ball",
            "sports"
        ],
        "icon": "baseball"
    },
    {
        "name": "Golf",
        "tags": [
            "golf",
            "sports",
            "course"
        ],
        "icon": "golf"
    },
    {
        "name": "Swimming",
        "tags": [
            "swimming",
            "water",
            "swim",
            "sports"
        ],
        "icon": "swimming"
    },
    {
        "name": "Cricket",
        "tags": [
            "cricket",
            "sports"
        ],
        "icon": "cricket"
    },
    {
        "name": "Skiing",
        "tags": [
            "winter",
            "skiing",
            "ski",
            "sports"
        ],
        "icon": "skiing"
    },
    {
        "name": "School",
        "tags": [
            "school",
            "highschool",
            "elementary",
            "children",
            "amenity",
            "middle"
        ],
        "icon": "school"
    },
    {
        "name": "College",
        "tags": [
            "college",
            "school",
            "amenity",
            "university"
        ],
        "icon": "college"
    },
    {
        "name": "Library",
        "tags": [
            "library",
            "books",
            "amenity"
        ],
        "icon": "library"
    },
    {
        "name": "Post",
        "tags": [
            "post",
            "office",
            "amenity",
            "mail",
            "letter"
        ],
        "icon": "post"
    },
    {
        "name": "Fire station",
        "tags": [
            "fire",
            "station",
            "amenity"
        ],
        "icon": "fire-station"
    },
    {
        "name": "Town hall",
        "tags": [
            "townhall",
            "mayor",
            "building",
            "amenity",
            "government"
        ],
        "icon": "town-hall"
    },
    {
        "name": "Police",
        "tags": [
            "police",
            "jail",
            "arrest",
            "amenity",
            "station"
        ],
        "icon": "police"
    },
    {
        "name": "Prison",
        "tags": [
            "prison",
            "jail",
            "amenity"
        ],
        "icon": "prison"
    },
    {
        "name": "Embassy",
        "tags": [
            "embassy",
            "diplomacy",
            "consulate",
            "amenity",
            "flag"
        ],
        "icon": "embassy"
    },
    {
        "name": "Beer",
        "tags": [
            "bar",
            "beer",
            "drink",
            "commercial",
            "biergarten",
            "pub"
        ],
        "icon": "beer"
    },
    {
        "name": "Restaurant",
        "tags": [
            "restaurant",
            "commercial"
        ],
        "icon": "restaurant"
    },
    {
        "name": "Cafe",
        "tags": [
            "cafe",
            "coffee",
            "commercial",
            "tea"
        ],
        "icon": "cafe"
    },
    {
        "name": "Shop",
        "tags": [
            "shop",
            "mall",
            "commercial",
            "store"
        ],
        "icon": "shop"
    },
    {
        "name": "Fast Food",
        "tags": [
            "food",
            "fast",
            "commercial",
            "burger",
            "drive-through"
        ],
        "icon": "fast-food"
    },
    {
        "name": "Bar",
        "tags": [
            "bar",
            "drink",
            "commercial",
            "club",
            "martini",
            "lounge"
        ],
        "icon": "bar"
    },
    {
        "name": "Bank",
        "tags": [
            "bank",
            "atm",
            "commercial",
            "money"
        ],
        "icon": "bank"
    },
    {
        "name": "Grocery",
        "tags": [
            "food",
            "grocery",
            "commercial",
            "store",
            "market"
        ],
        "icon": "grocery"
    },
    {
        "name": "Cinema",
        "tags": [
            "cinema",
            "theatre",
            "film",
            "movie",
            "commercial",
            "theater",
            "entertainment"
        ],
        "icon": "cinema"
    },
    {
        "name": "Pharmacy",
        "tags": [
            "pharmacy",
            "drugs",
            "medication",
            "social",
            "medicine",
            "prescription"
        ],
        "icon": "pharmacy"
    },
    {
        "name": "Hospital",
        "tags": [
            "hospital",
            "health",
            "medication",
            "social",
            "medicine",
            "medical",
            "clinic"
        ],
        "icon": "hospital"
    },
    {
        "name": "Danger",
        "tags": [
            "minefield",
            "landmine",
            "disaster",
            "dangerous",
            "hazard"
        ],
        "icon": "danger"
    },
    {
        "name": "Industrial",
        "tags": [
            "industrial",
            "factory",
            "property",
            "building"
        ],
        "icon": "industrial"
    },
    {
        "name": "Warehouse",
        "tags": [
            "warehouse",
            "property",
            "storage",
            "building"
        ],
        "icon": "warehouse"
    },
    {
        "name": "Commercial",
        "tags": [
            "commercial",
            "property",
            "business",
            "building"
        ],
        "icon": "commercial"
    },
    {
        "name": "Building",
        "tags": [
            "building",
            "property",
            "structure",
            "business",
            "building"
        ],
        "icon": "building"
    },
    {
        "name": "Place of worship",
        "tags": [
            "religion",
            "ceremony",
            "religious",
            "nondenominational",
            "church",
            "temple"
        ],
        "icon": "place-of-worship"
    },
    {
        "name": "Alcohol shop",
        "tags": [
            "alcohol",
            "liquor",
            "store",
            "shop",
            "beer",
            "wine",
            "vodka"
        ],
        "icon": "alcohol-shop"
    },
    {
        "name": "Logging",
        "tags": [
            "logger",
            "chainsaw",
            "woods",
            "industry"
        ],
        "icon": "logging"
    },
    {
        "name": "Oil well",
        "tags": [
            "oil",
            "natural",
            "environment",
            "industry",
            "resources"
        ],
        "icon": "oil-well"
    },
    {
        "name": "Slaughterhouse",
        "tags": [
            "cows",
            "cattle",
            "food",
            "meat",
            "industry",
            "resources"
        ],
        "icon": "slaughterhouse"
    },
    {
        "name": "Dam",
        "tags": [
            "water",
            "natural",
            "hydro",
            "hydroelectric",
            "energy",
            "environment",
            "industry",
            "resources"
        ],
        "icon": "dam"
    },
    {
    "name": "Water",
    "tags": [
        "water",
        "natural",
        "hydro",
        "lake",
        "river",
        "ocean",
        "resources"
    ],
    "icon": "water"
    },
    {
    "name": "Wetland",
    "tags": [
        "water",
        "swamp",
        "natural"
    ],
    "icon": "wetland"
    },
    {
    "name": "Disability",
    "tags": [
        "handicap",
        "wheelchair",
        "access"
    ],
    "icon": "disability"
    },
    {
    "name": "Telephone",
    "tags": [
        "payphone",
        "call"
    ],
    "icon": "telephone"
    },
    {
    "name": "Emergency Telephone",
    "tags": [
        "payphone",
        "danger",
        "safety",
        "call"
    ],
    "icon": "emergency-telephone"
    },
    {
    "name": "Toilets",
    "tags": [
        "bathroom",
        "men",
        "women",
        "sink",
        "washroom",
        "lavatory"
    ],
    "icon": "toilets"
    },
    {
    "name": "Waste Basket",
    "tags": [
        "trash",
        "rubbish",
        "bin",
        "garbage"
    ],
    "icon": "waste-basket"
    },
    {
    "name": "Music",
    "tags": [
        "stage",
        "performance",
        "band",
        "concert",
        "venue"
    ],
    "icon": "music"
    },
    {
    "name": "Land Use",
    "tags": [
        "zoning",
        "usage",
        "area"
    ],
    "icon": "land-use"
    },
    {
    "name": "City",
    "tags": [
        "area",
        "point",
        "place",
        "urban"
    ],
    "icon": "city"
    },
    {
    "name": "Town",
    "tags": [
        "area",
        "point",
        "place",
        "small"
    ],
    "icon": "town"
    },
    {
    "name": "Village",
    "tags": [
        "area",
        "point",
        "place",
        "small",
        "rural"
    ],
    "icon": "village"
    },
    {
    "name": "Farm",
    "tags": [
        "building",
        "farming",
        "crops",
        "plants",
        "agriculture",
        "rural"
    ],
    "icon": "farm"
    },
    {
    "name": "Bakery",
    "tags": [
        "bakery",
        "pastry",
        "croissant",
        "food",
        "shop",
        "bread"
    ],
    "icon": "bakery"
    },
  {
    "name": "Dog Park",
    "tags": [
        "dog",
        "pet"
    ],
    "icon": "dog-park"
    },
   {
    "name": "Lighthouse",
    "tags": [
        "building",
        "navigation",
        "nautical",
        "ocean",
        "logistics"
    ],
    "icon": "lighthouse"
    },
    {
    "name": "Clothing Store",
    "tags": [
        "clothing",
        "store",
        "shop"
    ],
    "icon": "clothing-store"
    },
    {
    "name": "Polling Place",
    "icon": "polling-place"
    },
    {
    "name": "Playground",
    "icon": "playground"
    },
    {
    "name": "Entrance",
    "icon": "entrance"
    },
    {
    "name": "Heart",
    "icon": "heart"
    },
    {
    "name": "London Underground",
    "icon": "london-underground"
    },
    {
    "name": "Minefield",
    "icon": "minefield"
    },
    {
    "name": "Rail Underground",
    "icon": "rail-underground"
    },
    {
    "name": "Rail Above",
    "icon": "rail-above"
    },
    {
     "name": "Camera",
     "icon": "camera"
    },
    {
    "name": "Laundry",
    "icon": "laundry"
    },
    {
        "name": "Car",
        "icon": "car"
    },
    {
    "name": "Suitcase",
    "icon": "suitcase"
    },
    {
    "name": "Hairdresser",
    "icon": "hairdresser"
    },
    {
    "name": "Chemist",
    "icon": "chemist"
    },
    {
    "name": "Mobile phone",
    "icon": "mobilephone"
    },
    {
    "name": "Scooter",
    "icon": "scooter"
    }
  ]
};

},{}],145:[function(require,module,exports){
module.exports = {
  icons: [
    { kind: "pattern", ext: "png", name: 'diagonal_1px_fast', icon: 'diagonal_1px_fast'},
    { kind: "pattern", ext: "png", name: 'diagonal_1px_med', icon: 'diagonal_1px_med', },
    { kind: "pattern", ext: "png", name: 'diagonal_1px_slow', icon: 'diagonal_1px_slow'},
    { kind: "pattern", ext: "png", name: 'diagonal_2px_fast', icon: 'diagonal_2px_fast', },
    { kind: "pattern", ext: "png", name: 'diagonal_2px_med', icon: 'diagonal_2px_med', },
    { kind: "pattern", ext: "png", name: 'diagonal_2px_slow', icon: 'diagonal_2px_slow'},
    { kind: "pattern", ext: "png", name: 'donuts_4px_med', icon: 'donuts_4px_med', },
    { kind: "pattern", ext: "png", name: 'donuts_6px_med', icon: 'donuts_6px_med', },
    { kind: "pattern", ext: "png", name: 'dots_2px_fast', icon: 'dots_2px_fast', },
    { kind: "pattern", ext: "png", name: 'dots_2px_med', icon: 'dots_2px_med', },
    { kind: "pattern", ext: "png", name: 'dots_2px_slow', icon: 'dots_2px_slow'},
    { kind: "pattern", ext: "png", name: 'dots_4px_fast', icon: 'dots_4px_fast'},
    { kind: "pattern", ext: "png", name: 'dots_4px_med', icon: 'dots_4px_med', },
    { kind: "pattern", ext: "png", name: 'dots_6px_fast', icon: 'dots_6px_fast' },
    { kind: "pattern", ext: "png", name: 'dots_6px_med',  icon: 'dots_6px_med' }
  ]
};

},{}],146:[function(require,module,exports){
// Pin maps from http://www.flaticon.com/packs/pins-of-maps/
module.exports = {
  disclaimer: '<a href="http://www.flaticon.com/packs/pins-of-maps/" target="_blank">Pin Maps</a>, icons by <a href="http://freepik.com" target="_blank">freepik.com</a>',
  icons: [
    { name: 'air', icon: 'air' },
    { name: 'air2', icon: 'air2' },
    { name: 'anchor2', icon: 'anchor2' },
    { name: 'anchor3', icon: 'anchor3' },
    { name: 'bag1', icon: 'bag1' },
    { name: 'bag2', icon: 'bag2' },
    { name: 'balloon', icon: 'balloon' },
    { name: 'black41', icon: 'black41' },
    { name: 'boat1', icon: 'boat1' },
    { name: 'book16', icon: 'book16' },
    { name: 'building', icon: 'building' },
    { name: 'burger', icon: 'burger' },
    { name: 'bus6', icon: 'bus6' },
    { name: 'caravan2', icon: 'caravan2' },
    { name: 'church1', icon: 'church1' },
    { name: 'church3', icon: 'church3' },
    { name: 'club', icon: 'club' },
    { name: 'cocktail3', icon: 'cocktail3' },
    { name: 'coffee2', icon: 'coffee2' },
    { name: 'dark11', icon: 'dark11' },
    { name: 'disabled', icon: 'disabled' },
    { name: 'dog2', icon: 'dog2' },
    { name: 'favourite1', icon: 'favourite1' },
    { name: 'flag5', icon: 'flag5' },
    { name: 'flat', icon: 'flat' },
    { name: 'hotel', icon: 'hotel' },
    { name: 'information3', icon: 'information3' },
    { name: 'location10', icon: 'location10' },
    { name: 'location11', icon: 'location11' },
    { name: 'location5', icon: 'location5' },
    { name: 'location6', icon: 'location6' },
    { name: 'location7', icon: 'location7' },
    { name: 'location8', icon: 'location8' },
    { name: 'location9', icon: 'location9' },
    { name: 'marker2', icon: 'marker2' },
    { name: 'marker3', icon: 'marker3' },
    { name: 'marker4', icon: 'marker4' },
    { name: 'marker5', icon: 'marker5' },
    { name: 'marker6', icon: 'marker6' },
    { name: 'marker7', icon: 'marker7' },
    { name: 'monument2', icon: 'monument2' },
    { name: 'mountains', icon: 'mountains' },
    { name: 'p', icon: 'p' },
    { name: 'petrol', icon: 'petrol' },
    { name: 'petrol2', icon: 'petrol2' },
    { name: 'pharmacy', icon: 'pharmacy' },
    { name: 'phone13', icon: 'phone13' },
    { name: 'pin10', icon: 'pin10' },
    { name: 'pins', icon: 'pins' },
    { name: 'pins1', icon: 'pins1' },
    { name: 'pins10', icon: 'pins10' },
    { name: 'pins11', icon: 'pins11' },
    { name: 'pins12', icon: 'pins12' },
    { name: 'pins13', icon: 'pins13' },
    { name: 'pins14', icon: 'pins14' },
    { name: 'pins15', icon: 'pins15' },
    { name: 'pins16', icon: 'pins16' },
    { name: 'pins17', icon: 'pins17' },
    { name: 'pins18', icon: 'pins18' },
    { name: 'pins19', icon: 'pins19' },
    { name: 'pins2', icon: 'pins2' },
    { name: 'pins20', icon: 'pins20' },
    { name: 'pins21', icon: 'pins21' },
    { name: 'pins22', icon: 'pins22' },
    { name: 'pins23', icon: 'pins23' },
    { name: 'pins24', icon: 'pins24' },
    { name: 'pins25', icon: 'pins25' },
    { name: 'pins26', icon: 'pins26' },
    { name: 'pins27', icon: 'pins27' },
    { name: 'pins28', icon: 'pins28' },
    { name: 'pins29', icon: 'pins29' },
    { name: 'pins3', icon: 'pins3' },
    { name: 'pins30', icon: 'pins30' },
    { name: 'pins31', icon: 'pins31' },
    { name: 'pins32', icon: 'pins32' },
    { name: 'pins33', icon: 'pins33' },
    { name: 'pins34', icon: 'pins34' },
    { name: 'pins35', icon: 'pins35' },
    { name: 'pins36', icon: 'pins36' },
    { name: 'pins37', icon: 'pins37' },
    { name: 'pins38', icon: 'pins38' },
    { name: 'pins39', icon: 'pins39' },
    { name: 'pins4', icon: 'pins4' },
    { name: 'pins40', icon: 'pins40' },
    { name: 'pins41', icon: 'pins41' },
    { name: 'pins42', icon: 'pins42' },
    { name: 'pins43', icon: 'pins43' },
    { name: 'pins44', icon: 'pins44' },
    { name: 'pins45', icon: 'pins45' },
    { name: 'pins46', icon: 'pins46' },
    { name: 'pins47', icon: 'pins47' },
    { name: 'pins48', icon: 'pins48' },
    { name: 'pins49', icon: 'pins49' },
    { name: 'pins5', icon: 'pins5' },
    { name: 'pins50', icon: 'pins50' },
    { name: 'pins51', icon: 'pins51' },
    { name: 'pins52', icon: 'pins52' },
    { name: 'pins53', icon: 'pins53' },
    { name: 'pins54', icon: 'pins54' },
    { name: 'pins55', icon: 'pins55' },
    { name: 'pins56', icon: 'pins56' },
    { name: 'pins57', icon: 'pins57' },
    { name: 'pins58', icon: 'pins58' },
    { name: 'pins59', icon: 'pins59' },
    { name: 'pins6', icon: 'pins6' },
    { name: 'pins60', icon: 'pins60' },
    { name: 'pins61', icon: 'pins61' },
    { name: 'pins62', icon: 'pins62' },
    { name: 'pins63', icon: 'pins63' },
    { name: 'pins64', icon: 'pins64' },
    { name: 'pins65', icon: 'pins65' },
    { name: 'pins66', icon: 'pins66' },
    { name: 'pins67', icon: 'pins67' },
    { name: 'pins68', icon: 'pins68' },
    { name: 'pins69', icon: 'pins69' },
    { name: 'pins7', icon: 'pins7' },
    { name: 'pins70', icon: 'pins70' },
    { name: 'pins71', icon: 'pins71' },
    { name: 'pins72', icon: 'pins72' },
    { name: 'pins73', icon: 'pins73' },
    { name: 'pins74', icon: 'pins74' },
    { name: 'pins75', icon: 'pins75' },
    { name: 'pins76', icon: 'pins76' },
    { name: 'pins77', icon: 'pins77' },
    { name: 'pins78', icon: 'pins78' },
    { name: 'pins79', icon: 'pins79' },
    { name: 'pins8', icon: 'pins8' },
    { name: 'pins80', icon: 'pins80' },
    { name: 'pins81', icon: 'pins81' },
    { name: 'pins82', icon: 'pins82' },
    { name: 'pins83', icon: 'pins83' },
    { name: 'pins84', icon: 'pins84' },
    { name: 'pins85', icon: 'pins85' },
    { name: 'pins86', icon: 'pins86' },
    { name: 'pins87', icon: 'pins87' },
    { name: 'pins88', icon: 'pins88' },
    { name: 'pins89', icon: 'pins89' },
    { name: 'pins9', icon: 'pins9' },
    { name: 'pins90', icon: 'pins90' },
    { name: 'pins91', icon: 'pins91' },
    { name: 'position', icon: 'position' },
    { name: 'restaurant2', icon: 'restaurant2' },
    { name: 'right14', icon: 'right14' },
    { name: 'road3', icon: 'road3' },
    { name: 'shop2', icon: 'shop2' },
    { name: 'shopping8', icon: 'shopping8' },
    { name: 'sit', icon: 'sit' },
    { name: 'ski1', icon: 'ski1' },
    { name: 'soccer1', icon: 'soccer1' },
    { name: 'suitcase1', icon: 'suitcase1' },
    { name: 'suitcase2', icon: 'suitcase2' },
    { name: 'telephone3', icon: 'telephone3' },
    { name: 'tent', icon: 'tent' },
    { name: 'tent1', icon: 'tent1' },
    { name: 'train3', icon: 'train3' },
    { name: 'train4', icon: 'train4' },
    { name: 'turn7', icon: 'turn7' },
    { name: 'walk', icon: 'walk' },
    { name: 'wifi11', icon: 'wifi11' }
  ]
};

},{}],147:[function(require,module,exports){
// Simple icons from http://www.flaticon.com/packs/simpleicon-places/
module.exports = {
  disclaimer: '<a href="http://www.flaticon.com/packs/simpleicon-places/" target="_blank">SimpleIcons Places</a>, icons by <a href="http://www.simpleicon.com" target="_blank">simpleicon.com</a>',
  icons: [
    { name: 'beach3', icon: 'beach3' },
    { name: 'beach4', icon: 'beach4' },
    { name: 'boat12', icon: 'boat12' },
    { name: 'building21', icon: 'building21' },
    { name: 'building22', icon: 'building22' },
    { name: 'building23', icon: 'building23' },
    { name: 'building24', icon: 'building24' },
    { name: 'buildings5', icon: 'buildings5' },
    { name: 'castle7', icon: 'castle7' },
    { name: 'church7', icon: 'church7' },
    { name: 'coconut5', icon: 'coconut5' },
    { name: 'compass44', icon: 'compass44' },
    { name: 'compass45', icon: 'compass45' },
    { name: 'compass46', icon: 'compass46' },
    { name: 'compass47', icon: 'compass47' },
    { name: 'compass49', icon: 'compass49' },
    { name: 'compass50', icon: 'compass50' },
    { name: 'factory7', icon: 'factory7' },
    { name: 'factory8', icon: 'factory8' },
    { name: 'flag31', icon: 'flag31' },
    { name: 'flag32', icon: 'flag32' },
    { name: 'heart206', icon: 'heart206' },
    { name: 'home84', icon: 'home84' },
    { name: 'home85', icon: 'home85' },
    { name: 'home86', icon: 'home86' },
    { name: 'home87', icon: 'home87' },
    { name: 'home88', icon: 'home88' },
    { name: 'home89', icon: 'home89' },
    { name: 'home90', icon: 'home90' },
    { name: 'map35', icon: 'map35' },
    { name: 'map36', icon: 'map36' },
    { name: 'map37', icon: 'map37' },
    { name: 'map38', icon: 'map38' },
    { name: 'map39', icon: 'map39' },
    { name: 'map40', icon: 'map40' },
    { name: 'map41', icon: 'map41' },
    { name: 'map42', icon: 'map42' },
    { name: 'map43', icon: 'map43' },
    { name: 'map44', icon: 'map44' },
    { name: 'map45', icon: 'map45' },
    { name: 'map46', icon: 'map46' },
    { name: 'map47', icon: 'map47' },
    { name: 'map48', icon: 'map48' },
    { name: 'map49', icon: 'map49' },
    { name: 'map50', icon: 'map50' },
    { name: 'map51', icon: 'map51' },
    { name: 'map52', icon: 'map52' },
    { name: 'map53', icon: 'map53' },
    { name: 'map54', icon: 'map54' },
    { name: 'map55', icon: 'map55' },
    { name: 'map56', icon: 'map56' },
    { name: 'map57', icon: 'map57' },
    { name: 'map58', icon: 'map58' },
    { name: 'map59', icon: 'map59' },
    { name: 'map60', icon: 'map60' },
    { name: 'palm9', icon: 'palm9' },
    { name: 'placeholder4', icon: 'placeholder4' },
    { name: 'sailboat5', icon: 'sailboat5' },
    { name: 'sunbathing', icon: 'sunbathing' },
    { name: 'sunbathing1', icon: 'sunbathing1' },
    { name: 'tower15', icon: 'tower15' },
    { name: 'town', icon: 'town' }
  ]
};

},{}],148:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var UploadModel = require('./upload_model');

module.exports = cdb.core.View.extend({

  className: 'AssetPane',

  events: {
    'click .js-fileButton': '_onDropboxClick'
  },

  _UPLOADER: {
    url:              '/api/v1/users/<%- id %>/assets',
    uploads:          1, // Max uploads at the same time
    maxFileSize:      1048576, // 1MB
    acceptFileTypes:  ['png','svg','jpeg','jpg'],
    acceptSync:       undefined,
    resolution:       "1024x1024"
  },

  initialize: function() {
    _.bindAll(this, '_onDbxChooserSuccess');

    this.kind = this.options.kind;
    this.user = this.options.user;
    this._setupModel();
    this.collection = this.options.collection;
  },

  render: function() {
    this.clearSubViews();

    this.template = cdb.templates.getTemplate('common/dialogs/map/image_picker/dropbox_template');

    this.$el.html(this.template());

    return this;
  },

  _setupModel: function() {
    this.model = new UploadModel({
      type: this.options.type,
      kind: this.options.kind
    }, {
      userId: this.user.get("id")
    });
    this._initBinds();
  },

  _initBinds: function() {
    this.model.bind('change:state', this._onChangeState, this);
  },

  _onStateUploaded: function() {
    this.collection.fetch();
    this.model.setFresh({ kind: this.kind });
  },

  _onStateError: function() {
    this._showFileError();
    this.trigger("hide_loader", this);
    this.$(".js-import-panel").show();
    this.model.setFresh({ kind: this.kind });
  },

  _showFileError: function() {
    if (this.model.get('state') === "error") {
      this.$('.js-fileError')
        .text(this.model.get('get_error_text').what_about)
        .show();
      this.$('.js-fileButton').addClass('Button--negative');
    }
  },

  _hideFileError: function() {
    this.$('.js-fileError').hide();
    this.$('.js-fileLabel').show();
    this.$('.js-fileButton').removeClass('Button--negative');
  },

  _onChangeState: function() {
    var state = this.model.get('state');

    if (state === 'uploaded') {
      this._onStateUploaded();
    } else {
      if (state == "error") {
        this._onStateError();
      } else if (state === 'idle' || state === "uploading") {
        this.$(".js-import-panel").hide();
        this.trigger("show_loader", this);
      } else {
        this.$(".js-import-panel").show();
        this.trigger("hide_loader", this);
      }
    }
  },


  _onDropboxClick: function(e) {
    this.killEvent(e);

    Dropbox.choose({
      success:      this._onDbxChooserSuccess,
      multiselect:  false,
      linkType:     "direct",
      extensions:   _.map(this._UPLOADER.acceptFileTypes, function(ext) { return '.' + ext })
    });
  },

  _onDbxChooserSuccess: function(files) {
    if (files && files[0]) {
      this.model.set({
        type: 'url',
        value: files[0].link,
        state: 'uploading'
      });

      this.model.upload();

      if (this.model.get('state') !== "error") {
        // Remove errors
        this._hideFileError();
      } else {
        this._showFileError();
      }
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./upload_model":153}],149:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var UploadModel = require('./upload_model');

module.exports = cdb.core.View.extend({

  className: 'AssetPane',

  options: {
    type: 'url',
    acceptSync: false,
    fileEnabled: true,
    formTemplate: '',
    headerTemplate: '',
    fileAttrs: {}
  },

  events: {
    'keyup .js-textInput': '_onTextChanged',
    'submit .js-form': '_onSubmitForm'
  },

  initialize: function() {

    this.user = this.options.user;
    this.kind = this.options.kind;

    this.collection = this.options.collection;

    this._setupModel();

    this.template = cdb.templates.getTemplate('common/dialogs/map/image_picker/file_upload_template');

  },

  render: function() {
    this.$el.html(
      this.template(_.extend(this.options, this.model.attributes))
    );

    this._initViews();
    return this;
  },

  _setupModel: function() {
    this.model = new UploadModel({
      type: this.options.type,
      kind: this.options.kind
    }, {
      userId: this.user.get("id")
    });
    this._initBinds();
  },

  _initBinds: function() {
    this.model.bind('change:state', this._onChangeState, this);
  },

  _initViews: function() {
    if (this.options.fileEnabled) {
      var self = this;
      this.$('.js-fileInput').bind('change', function(e) {
        if (this.files && this.files.length > 0) {
          self._onFileChanged(this.files);
        }
      });

      this._initDropzone();
    }
  },

  _onTextChanged: function() {
    var value = this.$('.js-textInput').val();
    if (!value) {
      this._hideTextError();
    }
  },

  _onSubmitForm: function(e) {
    if (e) this.killEvent(e);

    // URL submit
    var value = this.$('.js-textInput').val();

    if (!value) {
      this._hideTextError();
      return;
    }

    // Change file attributes :S
    this.trigger('urlSelected', this);

    // Change model
    this.model.set({
      type: 'url',
      value: value,
      state: 'idle'
    });

    this.model.upload();

    if (this.model.get('state') !== "error") {
      // Remove errors
      this._hideFileError();
      this._hideTextError();
    } else {
      this._showTextError();
    }
  },


  _initDropzone: function() {
    var el = $('html')[0]; // :(
    var self = this;

    this.dragster = new Dragster(el);

    $(el).bind("dragster:enter", function (e) {
      self._showDropzone();
    });

    $(el).bind("dragster:leave", function (e) {
      self._hideDropzone();
    });

    if (el.dropzone) { // avoid loading the dropzone twice
      return;
    }

    this.dropzone = new Dropzone(el, {
      url: ':)',
      autoProcessQueue: false,
      previewsContainer: false
    });

    this.dropzone.on('dragover', function() {
      self._showDropzone();
    });

    this.dropzone.on("drop", function (ev) {
      var files = ev.dataTransfer.files;
      self._onFileChanged(files);
      self._hideDropzone();
    });
  },

  _destroyDropzone: function() {
    var el = $('html')[0]; // :(

    if (this.dragster) {
      this.dragster.removeListeners();
      this.dragster.reset();
      $(el).unbind('dragster:enter dragster:leave');
    }

    if (this.dropzone) {
      this.dropzone.destroy();
    }
  },

  _setValidFileExtensions: function(list) {
    return RegExp("(\.|\/)(" + list.join('|') + ")$", "i");
  },

  _onFileChanged: function(files) {

    if (files && files.length === 1) {
      files = files[0];
    }

    this.model.set({
      type: 'file',
      value: files
    });

    if (this.model.get('state') !== "error") {
      this._hideFileError();
      this.model.set('state', 'selected');
      this.model.upload();
    } else {
      this._showFileError();
    }
  },

  _showTextError: function() {
    this.$('.Form-inputError').addClass('is-visible');
  },

  _hideTextError: function() {
    this.$('.Form-inputError').removeClass('is-visible');
  },

  _showDropzone: function() {
    this.$('.Form-upload').addClass('is-dropping');
    this._hideFileError();
  },

  _hideDropzone: function() {
    this.$('.Form-upload').removeClass('is-dropping');
  },

  _showFileError: function() {
    if (this.model.get('state') === "error") {
      this.$('.js-fileError')
        .text(this.model.get('get_error_text').what_about)
        .show();
      this.$('.js-fileLabel').hide();
      this.$('.js-fileButton').addClass('Button--negative');
    }
  },

  _hideFileError: function() {
    this.$('.js-fileError').hide();
    this.$('.js-fileLabel').show();
    this.$('.js-fileButton').removeClass('Button--negative');
  },

  _onStateUploaded: function() {
    this.collection.fetch();
    this.model.setFresh({ kind: this.kind });
    this.$(".js-textInput").val("");
  },

  _onStateError: function() {
    this._showFileError();
    this.$(".js-form").show();
    this.trigger("hide_loader", this);
    this.model.setFresh({ kind: this.kind });
  },

  _onChangeState: function() {
    var state = this.model.get('state');

    if (state === 'uploaded') {
      this._onStateUploaded();
    } else {
      if (state === "error") {
        this._onStateError();
      } else if (state === 'idle' || state === "uploading" || state === "selected") {
        this.$(".js-form").hide();
        this.trigger("show_loader", this);
      } else {
        this.$(".js-form").show();
        this.trigger("hide_loader", this);
      }
    }
  },

  clean: function() {
    this._destroyDropzone();
    this.$('.js-fileInput').unbind('change');
    this.elder('clean');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./upload_model":153}],150:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

module.exports = cdb.core.View.extend({

  _TEXTS: {
    ok:           {
      simple_icons: _t('Set image'),
      pin_icons:    _t('Set image'),
      maki_icons:   _t('Set image'),
      your_icons:   _t('Set image'),
      upload_file:  _t('Upload image'),
      dropbox:      _t('Upload image'),
      box:      _t('Upload image')
    }
  },

  events: {
    'click .js-ok': '_finish'
  },

  initialize: function() {
    this.elder('initialize');
    this._template = cdb.templates.getTemplate('common/dialogs/map/image_picker/footer_template');
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();

    var action = this._TEXTS.ok[this.model.get('pane')] || "Set image";
    var options = _.extend(this.model.attributes, { action:  action });
    var $el = $(this._template(options));

    this.$el.html($el);

    return this;
  },

  _initBinds: function() {
    this.model.bind('change', this.render, this);
    this.model.bind('change:disclaimer', this._updateFooterInfo, this);
  },

  _updateFooterInfo: function() {
    this.$el.find(".js-footer-info").html(this.model.get("disclaimer"));
  },

  _finish: function(e) {
    this.killEvent(e);

    if (this.model.get("submit_enabled")) {
      this.trigger("finish", this);
    }
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],151:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

module.exports = cdb.core.View.extend({

  events: {
    'click .js-item':       '_onItemClick',
    'click .js-your-icons': '_onYourIconsClick'
  },

  initialize: function() {
    this.model = this.options.model;
    this.kind  = this.options.kind;
    this.collection = this.options.collection;
    this.template = cdb.templates.getTemplate('common/dialogs/map/image_picker/navigation_template');

    this._preRender();
    this._initBinds();
  },

  // It is necessary to add two static elements because
  // they can't be removed/replaced using render method
  // each time a change (in a model or a collection) happens.
  // This is due to the behaviour of the CSS animations.
  _preRender: function() {
    var $uInner = $('<div>').addClass('u-inner');
    var $filtersInner = $('<div>').addClass('Filters-inner');
    this.$el.append($uInner.append($filtersInner));
  },

  render: function(m, c) {
    this.clearSubViews();

    this.$('.Filters-inner').html(
      this.template({
      dropbox_enabled: this.model.get("dropbox_enabled"),
      box_enabled: this.model.get("box_enabled"),
      pane: this.model.get('pane'),
      kind: this.kind
    }));

    if (this.collection.where({ kind: this.kind }).length > 0) {
      var type = "your_icons";
      this.$el.find('[data-type="' + type + '"]').removeClass("is-disabled");
    }

    return this;
  },

  _initBinds: function() {
    this.model.bind('change:pane', this.render, this);
    this.model.bind('change:pane', this._enableFilter, this);
    this.add_related_model(this.model);
  },

  _onYourIconsClick: function(e) {
    if (this.collection.where({ kind: this.kind }).length > 0) {
      var type = $(e.target).data("type")
      this.model.set('pane', type);
    }
  },

  _onItemClick: function(e) {
    var type = $(e.target).data("type")
    this.model.set('pane', type);
  },

  _enableFilter: function(e) {
    var type = this.model.get('pane');
    var $el = this.$el.find('[data-type="' + type + '"]');
    $el.removeClass("is-disabled");
  }
});




}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],152:[function(require,module,exports){
var AssetsItemView = require('./assets_item_view');

module.exports = AssetsItemView.extend({

  events: {
    'click': '_onClick'
  },

  _deleteAsset: function() {},
  _openDropdown: function() {}

});

},{"./assets_item_view":141}],153:[function(require,module,exports){
(function (global){
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 * Model that let user upload files to our endpoints.
 *
 * NOTE: this model extends Backbone.Model instead of cdb.core.Model, because it's required for the
 * vendor/backbone-model-file-upload.
 */
module.exports = Backbone.Model.extend({

  url: function(method) {
    var version = cdb.config.urlVersion('asset', method);
    return '/api/' + version + '/users/' + this.userId + '/assets'
  },

  fileAttribute: 'filename',

  defaults: {
    type: '',
    value: '',
    interval: 0,
    progress: 0,
    state: 'idle',
    option: ''
  },

  initialize: function(val, opts) {
    this.user = opts && opts.user;

    if (!opts.userId) {
      throw new Error('userId is required');
    }

    this.userId = opts.userId;

    this._initBinds();
    this._validate(this.attributes, { validate: true });
  },

  isValidToUpload: function() {
    return this.get('value') && this.get('state') !== 'error';
  },

  setFresh: function(attributes) {
    this.clear();
    this.set(attributes);
  },

  _initBinds: function() {
    this.bind('progress', function(progress) {
      this.set({
        progress: progress*100,
        state: 'uploading'
      });
    }, this);

    this.bind('change:value', function() {
      if (this.get('state') === "error") {
        this.set({ state: 'idle' })
        this.unset('get_error_text', { silent: true });
      }
    }, this);

    this.bind('error invalid', function(m, d) {
      this.set({
        state: 'error',
        error_code: (d && d.error_code) || '',
        get_error_text: {
          title: 'Invalid import',
          what_about: (d && d.msg) || ''
        }
      }, { silent: true });
      // We need this, if not validate will run again and again and again... :(
      this.trigger('change');
    }, this);
  },

  validate: function(attrs) {
    if (!attrs) return;

    if (attrs.type === "file") {
      // Number of files
      if (attrs.value && attrs.value.length) {
        return {
          msg: "Unfortunately only one file is allowed per upload"
        }
      }
      // File extension
      var name = attrs.value.name;
      var ext = name.substr(name.lastIndexOf('.') + 1);
      if (ext) {
        ext = ext.toLowerCase();
      }
      if (!_.contains(["jpg", "png", "gif", "svg"], ext)) {
        return {
          msg: "Unfortunately this file extension is not allowed"
        }
      }
    }

    if (attrs.type === "url") {
      // Valid URL?
      if (!Utils.isURL(attrs.value)) {
        return {
          msg: "Unfortunately the URL provided is not valid"
        }
      }
    }

  },

  isValid: function() {
    return this.get('value') && this.get('state') !== "error"
  },

  upload: function() {
    var self = this;

    var options = {
      kind: this.get('kind')
    };

    if (this.get('type') === "file") {
      options.filename = this.get('value');
    } else if (this.get('type') === "url") {
      options.url = this.get('value');
    }

    this.xhr = this.save(options, {
      success: function(m) {
        m.set('state', 'uploaded');
      },
      error: function(m, msg) {

        var message = 'Unfortunately there was a connection error';

        if (msg && msg.status === 429) {
          var response = JSON.parse(msg.responseText);
          message = response.error;
        } else if (msg && msg.status === 400) {
          var response = JSON.parse(msg.responseText);
          message = response.error;
        }

        self.set({
          state: 'error',
          get_error_text: { title: 'There was an error', what_about: message }
        });

      },
      complete: function() {
        delete self.xhr;
      }
    });
  },

  stopUpload: function() {
    if (this.xhr) this.xhr.abort();
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],154:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var AssetsView = require('./assets_view');
var AssetsItemView = require('./assets_item_view');

module.exports = AssetsView.extend({

  className: 'AssetPane AssetPane-userIcons',

  initialize: function() {
    this.model = this.options.model;
    this.template = cdb.templates.getTemplate('common/dialogs/map/image_picker/assets_template');

    this.collection.bind('add remove reset', this.render, this);
  },

  _renderAssets: function() {

    var self = this;
    var items = this.collection.where({ kind: this.options.kind });

    _(items).each(function(mdl) {
      var item = new AssetsItemView({
        className: 'AssetItem AssetItem-User',
        model: mdl
      });
      item.bind('selected', self._selectItem, self);

      self.$('ul').append(item.render().el);
      self.addView(item);
    });
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./assets_item_view":141,"./assets_view":142}],155:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var ImagePickerNavigationView = require('./image_picker/navigation_view');
var FooterView = require('./image_picker/footer_view');
var AssetsView = require('./image_picker/assets_view');
var UserIconsView = require('./image_picker/user_icons_view');
var UploadView = require('./image_picker/file_upload_view');
var DropboxView = require('./image_picker/dropbox_view');
var BoxView = require('./image_picker/box_view');
var makiIcons = require('./image_picker/data/maki_icons');
var patterns = require('./image_picker/data/patterns');
var pinMaps = require('./image_picker/data/pin_maps');
var simpleicon = require('./image_picker/data/simpleicon');
var ViewFactory = require('../../view_factory');
var randomQuote = require('../../view_helpers/random_quote');

module.exports = BaseDialog.extend({

  className: 'Dialog ImagePicker',

  initialize: function () {
    this.elder('initialize');

    this._validate();

    this.kind = this.options.kind;
    this.model = new cdb.core.Model({
      disclaimer: '',
      dropbox_enabled: !!cdb.config.get('dropbox_api_key'),
      box_enabled: !!cdb.config.get('box_api_key'),
      submit_enabled: false
    });

    this.collection = new cdb.admin.Assets([], {
      user: this.options.user
    });

    this._template = cdb.templates.getTemplate('common/dialogs/map/image_picker_template');
    this._initBinds();
    this._onChangePane();
  },

  render: function () {
    this.clearSubViews();
    BaseDialog.prototype.render.call(this);
    this.$('.content').addClass('Dialog-content--expanded');
    this._initViews();
    this._initAssets();
    return this;
  },

  _initAssets: function () {
    this.collection.bind('add remove reset', this._onAssetsFetched, this);
    this.collection.fetch();
  },

  _showLoader: function () {
    var loader = this._contentPane.getPane('loader');
    if (loader) {
      loader.show();
    }
  },

  _hideLoader: function () {
    var loader = this._contentPane.getPane('loader');
    if (loader) {
      loader.hide();
    }
  },

  _showUploadLoader: function () {
    var loader = this._contentPane.getPane('upload_loader');

    if (loader) {
      loader.show();
    }
  },

  _hideUploadLoader: function () {
    var loader = this._contentPane.getPane('upload_loader');
    if (loader) {
      loader.hide();
    }
  },

  _onAssetsFetched: function () {
    this._hideLoader();

    var items = this.collection.where({ kind: this.kind });

    if (items.length === 0) {
      if (this.kind === 'marker') {
        this.model.set('pane', 'simple_icons');
      } else {
        this.model.set('pane', 'patterns');
      }
    } else {
      this.model.set('pane', 'your_icons');
    }
  },

  // implements cdb.ui.common.Dialog.prototype.render
  render_content: function () {
    return this._template({ kind: this.kind });
  },

  _initViews: function () {
    this._renderContentPane();
    this._renderNavigation();
    this._renderTabPane();

    this._renderLoader();
    this._renderUploadLoader();

    if (this.kind === 'marker') {
      this._renderSimpleiconPane();
      this._renderPinIconsPane();
      this._renderMakisPane();
    } else if (this.kind === 'pattern') {
      this._renderPatternPane();
    }

    this._renderUserIconsPane();
    this._renderFilePane();
    this._renderDropboxPane();
    this._renderBoxPane();

    this._renderFooter();
    this._contentPane.active('loader');
  },

  _renderFooter: function () {
    this._footerView = new FooterView({
      model: this.model
    });

    this._footerView.bind('finish', this._ok, this);
    this.$('.js-footer').append(this._footerView.render().el);

    this.addView(this._footerView);
  },

  _renderTabPane: function () {
    this.tabPane = new cdb.ui.common.TabPane({
      el: this.$('.AssetsContent')
    });

    this.addView(this.tabPane);
  },

  _renderContentPane: function () {
    this._contentPane = new cdb.ui.common.TabPane({
      el: this.$('.js-content-container')
    });

    this.addView(this._contentPane);
    this._contentPane.active(this.model.get('contentPane'));
  },

  _renderNavigation: function () {
    var navigationView = new ImagePickerNavigationView({
      el: this.$('.js-navigation'),
      kind: this.kind,
      collection: this.collection,
      user: this.options.user,
      model: this.model
    });

    navigationView.render();

    this.addView(navigationView);
  },

  _renderPane: function (name, pane) {
    pane.bind('fileChosen', this._onFileChosen, this);
    pane.render();
    this._addPane(name, pane);
  },

  _renderUploadLoader: function () {
    this._addTab('upload_loader',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Uploading asset…',
        quote: randomQuote()
      })
    );
  },

  _renderLoader: function () {
    this._addTab('loader',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Loading assets…',
        quote: randomQuote()
      })
    );
  },

  _renderPatternPane: function () {
    var pane = new AssetsView({
      model: this.model,
      collection: this.collection,
      kind: this.kind,
      icons: patterns.icons,
      folder: 'patterns',
      size: ''
    });

    this._renderPane('patterns', pane);
  },

  _renderSimpleiconPane: function () {
    var pane = new AssetsView({
      model: this.model,
      collection: this.collection,
      kind: this.kind,
      icons: simpleicon.icons,
      disclaimer: simpleicon.disclaimer,
      folder: 'simpleicon',
      size: ''
    });
    this._renderPane('simple_icons', pane);
  },

  _renderMakisPane: function () {
    var pane = new AssetsView({
      model: this.model,
      collection: this.collection,
      kind: this.kind,
      icons: makiIcons.icons,
      disclaimer: makiIcons.disclaimer,
      folder: 'maki-icons',
      size: '18'
    });

    this._renderPane('maki_icons', pane);
  },

  _renderUserIconsPane: function () {
    var pane = new UserIconsView({
      model: this.model,
      collection: this.collection,
      kind: this.kind,
      folder: 'your-icons'
    });

    this._renderPane('your_icons', pane);
  },

  _renderPinIconsPane: function () {
    var pane = new AssetsView({
      model: this.model,
      collection: this.collection,
      kind: this.kind,
      icons: pinMaps.icons,
      disclaimer: pinMaps.disclaimer,
      folder: 'pin-maps',
      size: ''
    });

    this._renderPane('pin_icons', pane);
  },

  _renderFilePane: function () {
    var pane = new UploadView({
      collection: this.collection,
      kind: this.kind,
      user: this.options.user
    });

    pane.bind('valueChange', this._onFileChosen, this);
    pane.bind('show_loader', this._showUploadLoader, this);
    pane.bind('hide_loader', this._hideUploadLoader, this);
    this._renderPane('upload_file', pane);
  },

  _renderDropboxPane: function () {
    if (this.model.get('dropbox_enabled')) {
      var pane = new DropboxView({
        model: this.model,
        collection: this.collection,
        kind: this.kind,
        user: this.options.user
      });

      pane.bind('valueChange', this._onFileChosen, this);
      pane.bind('show_loader', this._showUploadLoader, this);
      pane.bind('hide_loader', this._hideUploadLoader, this);
      this._renderPane('dropbox', pane);
    }
  },

  _renderBoxPane: function () {
    if (this.model.get('box_enabled')) {
      var pane = new BoxView({
        model: this.model,
        collection: this.collection,
        kind: this.kind,
        user: this.options.user
      });

      pane.bind('valueChange', this._onFileChosen, this);
      pane.bind('show_loader', this._showUploadLoader, this);
      pane.bind('hide_loader', this._hideUploadLoader, this);
      this._renderPane('box', pane);
    }
  },

  _addPane: function (name, view) {
    this.tabPane.addTab(name, view, {
      active: this.model.get('pane') === name
    });
  },

  _addTab: function (name, view) {
    this._contentPane.addTab(name, view.render());
    this.addView(view);
  },

  _validate: function () {
    if (!this.options.user) {
      throw new TypeError('user is required');
    }

    if (!this.options.kind) {
      throw new Error('kind should be passed');
    }
  },

  _initBinds: function () {
    // Bug with binding... do not work with the usual one for some reason :(
    this.model.bind('change:pane', this._onChangePane.bind(this));
  },

  _onChangePane: function () {
    if (this.tabPane) {
      this.tabPane.active(this.model.get('pane'));

      this.model.set('submit_enabled', false);
      var activePane = this.tabPane.getActivePane();

      if (activePane) {
        this.model.set('disclaimer', activePane.options.disclaimer);
      }
    }
  },

  _ok: function () {
    this.trigger('fileChosen', this.model.get('value'));
    this.close();
  },

  _onFileChosen: function () {
    this.model.set('submit_enabled', true);
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213,"./image_picker/assets_view":142,"./image_picker/box_view":143,"./image_picker/data/maki_icons":144,"./image_picker/data/patterns":145,"./image_picker/data/pin_maps":146,"./image_picker/data/simpleicon":147,"./image_picker/dropbox_view":148,"./image_picker/file_upload_view":149,"./image_picker/footer_view":150,"./image_picker/navigation_view":151,"./image_picker/user_icons_view":154}],156:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');

/**
 * Scratch modal
 */
module.exports = BaseDialog.extend({

  events: cdb.core.View.extendEvents({
    "click .js-option" : "_onOptionClick",
    "click .js-skip"   : "_onSkipClick"
  }),

  options: {
    skipDisabled: false
  },

  initialize: function() {
    this.elder('initialize');

    if (!this.options.table) {
      throw new TypeError('table is required');
    }

    this.table = this.options.table;
    this._template = cdb.templates.getTemplate('common/dialogs/map/scratch_view_template');

  },

  // implements cdb.ui.common.Dialog.prototype.render
  render: function() {
    this.clearSubViews();
    BaseDialog.prototype.render.call(this);
    return this;
  },

  // implements cdb.ui.common.Dialog.prototype.render
  render_content: function() {
    return this._template({
      name: this.table.get("name"),
      skipDisabled: this.options.skipDisabled 
    });
  },

  _onSkipClick: function(e) {
    this.killEvent(e);
    this.close();
    this.trigger("skip", this);
  },

  _onOptionClick: function(e) {
    this.killEvent(e);
    this.close();
    this.trigger("newGeometry", $(e.target).closest('.js-option').data("type"));
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../views/base_dialog/view":213}],157:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ChooseKeyColumnsView = require('./choose_key_columns_view');
var SelectColumns = require('./select_columns_model');

module.exports = cdb.core.Model.extend({

  INSTRUCTIONS_SAFE_HTML: 'Select the dataset on the right that you want to merge the left with. ' +
    'You can only merge datasets by joining by columns of the same type (e.g. number to a number).',

  defaults: {
    user: undefined,
    isReadyForNextStep: false,
    excludeColumns: [],
    leftTable: undefined,
    leftColumns: undefined,
    rightTableData: undefined,
    rightColumns: undefined
  },

  initialize: function() {
    this._initColumns();
  },

  createView: function() {
    // Reset state
    this.set('gotoNextStep', false);
    var leftColumns = this.get('leftColumns');
    leftColumns.each(function(m) {
      m.unset('selected');
    });
    this.get('rightColumns').reset(); // columns are fetched by view
    this._resetSorting(leftColumns);
    this._resetSorting(this.get('rightColumns'));

    return new ChooseKeyColumnsView({
      model: this
    });
  },

  changeRightTable: function(tableData) {
    this.get('rightColumns').reset();
    this.set('rightTableData', tableData);

    // TODO: extracted from old code, cdb.admin.TableColumnSelector._getColumns,
    //   isnt there some better way to get the schema/columns?
    $.ajax({
      url: cdb.config.prefixUrl() + '/api/v1/tables/' + tableData.id,
      dataType: 'jsonp',
      success: this._onFetchedColumns.bind(this)
    });
  },

  _onFetchedColumns: function(results) {
    var filteredColumns = this._filterColumns(results.schema);
    this.get('rightColumns').reset(filteredColumns);
    var selectedLeftColumn = this.selectedItemFor('leftColumns');
    if (selectedLeftColumn) {
      this.disableRightColumnsNotMatchingType(selectedLeftColumn.get('type'));
    }
  },

  disableRightColumnsNotMatchingType: function(leftKeyColumnType) {
    this.get('rightColumns').each(function(column) {
      var shouldDisable = column.get('type') !== leftKeyColumnType;
      if (shouldDisable && column.get('selected')) {
        // Don't leave the column selected if should be disabled
        column.set('selected', false);
      }
      column.set('disabled', shouldDisable);
    });
  },

  assertIfReadyForNextStep: function() {
    var isReady = !!(this.selectedItemFor('leftColumns') &&
                  this.selectedItemFor('rightColumns') &&
                  this.get('rightTableData'));
    this.set('isReadyForNextStep', isReady);
  },

  nextStep: function() {
    return new this.constructor.nextStep({
      user: this.get('user'),
      leftTable: this.get('leftTable'),
      leftColumns: this.get('leftColumns'),
      leftKeyColumn: this.selectedItemFor('leftColumns').clone(),
      rightKeyColumn: this.selectedItemFor('rightColumns').clone(),
      rightColumns: this.get('rightColumns'),
      rightTableData: this.get('rightTableData')
    });
  },

  selectedItemFor: function(collectionName) {
    return this.get(collectionName).find(function(column) {
      return column.get('selected');
    });
  },

  _initColumns: function() {
    var filteredLeftColumns = this._filterColumns(this.get('leftTable').get('schema'));
    this.set('leftColumns', new Backbone.Collection(filteredLeftColumns));
    this.set('rightColumns', new Backbone.Collection([]));
  },

  _filterColumns: function(tableSchema) {
    var excludeColumns = this.get('excludeColumns');

    return _.chain(tableSchema)
      .map(function(columnData) {
        return {
          // TODO: why don't we use a proper model for schema, to provide convenient method to get columns as a collection already?
          name: columnData[0],
          type: columnData[1]
        };
      })
      .reject(function(column) {
        return _.contains(excludeColumns, column.name);
      })
      .value();
  },

  _resetSorting: function(columns) {
    // May been set on next step, so reset sorters if going back:
    columns.comparator = function(column) {
      return column.get('name');
    };
    columns.sort();
  }

}, {
  header: {
    icon: 'CDB-IconFont-play',
    title: 'Choose merge column'
  },
  nextStep: SelectColumns
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./choose_key_columns_view":158,"./select_columns_model":162}],158:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ColumnsSelectorView = require('../columns_selector_view');
var TablesSelectorView = require('../tables_selector_view');
var FooterView = require('../footer_view');
var FooterInfoView = require('./footer_info_view');

/**
 * View to choose the key columns (and implicitly the right table).
 */
module.exports = cdb.core.View.extend({

  initialize: function() {
    this._initViews();
    this._initBinds();
  },

  render: function() {
    var $el = $(
      this.getTemplate('common/dialogs/merge_datasets/column_merge/choose_key_columns')({
        leftTableName: this.model.get('leftTable').get('name')
      })
    );
    $el.find('.js-left-table').append(this._leftTableComboView.render().$el);
    $el.find('.js-left-columns').append(this._leftColumnsView.render().$el);
    $el.find('.js-right-tables').append(this._rightTableSelectorView.render().$el);
    $el.find('.js-right-columns').append(this._rightColumnsView.render().$el);
    $el.append(this._footerView.render().$el);
    this.$el.html($el);

    return this;
  },

  _initViews: function() {
    var leftTableName = this.model.get('leftTable').get('name');

    this._leftTableComboView = new cdb.forms.Combo({
      className: 'Select',
      width: '100%',
      disabled: true,
      extra: [leftTableName]
    });
    this.addView(this._leftTableComboView);

    this._leftColumnsView = new ColumnsSelectorView({
      collection: this.model.get('leftColumns'),
      excludeFilter: this._columnsExcludeFilter,
      selectorType: 'radio'
    });
    this.addView(this._leftColumnsView);

    this._rightTableSelectorView = new TablesSelectorView({
      excludeFilter: function(vis) {
        return vis.get('name') === leftTableName;
      }
    });
    this.addView(this._rightTableSelectorView);

    this._rightColumnsView = new ColumnsSelectorView({
      collection: this.model.get('rightColumns'),
      excludeFilter: this._columnsExcludeFilter,
      selectorType: 'radio',
      loading: 'datasets'
    });
    this.addView(this._rightColumnsView);

    this._footerView = new FooterView({
      model: this.model,
      infoView: new FooterInfoView({
        model: this.model
      })
    });
    this.addView(this._footerView);
  },

  _columnsExcludeFilter: function(column) {
    return column.get('name') === 'the_geom';
  },

  _initBinds: function() {
    var leftColumns = this.model.get('leftColumns');
    leftColumns.bind('change:selected', this._onChangeSelectedLeftColumn, this);
    this.add_related_model(leftColumns);

    var rightColumns = this.model.get('rightColumns');
    rightColumns.bind('change:selected', this._onChangeSelectedRightColumn, this);
    rightColumns.bind('reset', this._assertIfReadyForNextStep, this);
    this.add_related_model(rightColumns);

    var rightTablesModel = this._rightTableSelectorView.model;
    rightTablesModel.bind('change:tableData', this._onChangeRightTableData, this);
    this.add_related_model(rightTablesModel);
  },

  _onChangeSelectedLeftColumn: function(m, isSelected) {
    if (isSelected) {
      this.model.disableRightColumnsNotMatchingType(m.get('type'));
    }
    this._assertIfReadyForNextStep();
  },

  _onChangeSelectedRightColumn: function() {
    this._assertIfReadyForNextStep();
  },

  _assertIfReadyForNextStep: function() {
    this.model.assertIfReadyForNextStep();
  },

  _onChangeRightTableData: function(model, tableData) {
    this._rightColumnsView.model.set('loading', 'columns');
    this.model.changeRightTable(tableData);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../columns_selector_view":165,"../footer_view":166,"../tables_selector_view":183,"./footer_info_view":160}],159:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ChooseKeyColumnsModel = require('./choose_key_columns_model');

/**
 * Entry point model that represents the merge flavor of doing a column merge.
 */
module.exports = cdb.core.Model.extend({

  ILLUSTRATION_ICON_TYPE: 'IllustrationIcon--alert',
  ICON: 'CDB-IconFont-mergeColumns',
  TITLE: 'Column join',
  DESC: 'Merge two datasets based on a shared value (ex. ISO codes in both datasets)',

  defaults: {
    user: undefined,
    table: undefined,
    excludeColumns: []
  },

  initialize: function(attrs) {
    if (!attrs.table) throw new Error('table is required');
    if (!attrs.excludeColumns || _.isEmpty(attrs.excludeColumns)) cdb.log.error('excludeColumns was empty');
  },

  isAvailable: function() {
    // Need at least one more column than the_geom to do a column merge
    return _.chain(this.get('table').get('schema'))
      .map(this._columnDataName)
      .difference(this.get('excludeColumns'))
      .any(this._isntTheGeomName)
      .value();
  },

  _columnDataName: function(columnData) {
    return columnData[0]; //name
  },

  _isntTheGeomName: function(columnName) {
    return columnName !== 'the_geom';
  },

  firstStep: function() {
    return new ChooseKeyColumnsModel({
      user: this.get('user'),
      leftTable: this.get('table'),
      excludeColumns: this.get('excludeColumns')
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./choose_key_columns_model":157}],160:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View to indicate the selected key columns relationship.
 * Shared for both step 1 and 2
 */
module.exports = cdb.core.View.extend({

  initialize: function() {
    this._initBinds();
  },

  render: function() {
    var leftKeyColumn = this.model.get('leftKeyColumn');
    var rightKeyColumn = this.model.get('rightKeyColumn');
    this.$el.html(
      this.getTemplate('common/dialogs/merge_datasets/column_merge/footer_info')({
        leftKeyColumnName: leftKeyColumn ? leftKeyColumn.get('name') : '',
        rightKeyColumnName: rightKeyColumn ? rightKeyColumn.get('name') : ''
      })
    );
    return this;
  },

  _initBinds: function() {
    if (this.model.selectedItemFor) {
      var leftColumns = this.model.get('leftColumns');
      leftColumns.bind('change:selected', this._onChangeLeftColumn, this);
      this.add_related_model(leftColumns);

      var rightColumns = this.model.get('rightColumns');
      rightColumns.bind('change:selected', this._onChangeRightColumn, this);
      this.add_related_model(rightColumns);
    }
  },

  _onChangeLeftColumn: function() {
    var m = this.model.selectedItemFor('leftColumns');
    this.$('.js-left-key-column').text(m ? m.get('name') : '');
  },

  _onChangeRightColumn: function() {
    var m = this.model.selectedItemFor('rightColumns');
    this.$('.js-right-key-column')
      .text(m ? m.get('name') : '')
      .toggleClass('is-placeholder', !m);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],161:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

// Used for both left and right table
var selectColumn = function(tableName, otherTableName, columnName) {
  if (columnName === 'the_geom') {
    return [
      'CASE WHEN ' + tableName + '.' + columnName + ' IS NULL THEN',
      otherTableName + '.' + columnName,
      'ELSE',
      tableName + '.' + columnName,
      'END AS',
        columnName
    ];
  } else {
    return [ tableName + '.' + columnName ];
  }
};

// SQL query as taken from old code, cdb.admin.MergeTablesDialog
// Cleaned up to remove noise and avoid string concatenation to be more legible.
module.exports = function(d) {
  var leftTableName = d.leftTableName;
  var leftColumnsNames = d.leftColumnsNames;
  var leftKeyColumnName = d.leftKeyColumnName;
  var leftKeyColumnType = d.leftKeyColumnType;

  var rightTableName = d.rightTableName;
  var rightColumnsNames = d.rightColumnsNames;
  var rightKeyColumnName = d.rightKeyColumnName;
  var rightKeyColumnType = d.rightKeyColumnType;

  // Add left table columns
  var sql = ['SELECT'];
  var selects = _.map(leftColumnsNames, function(columnName) {
    return selectColumn(leftTableName, rightTableName, columnName).join(' ');
  });

  // Add right table columns
  selects.push.apply(selects,
    _.map(rightColumnsNames, function(columnName) {
      var colSQL = selectColumn(rightTableName, leftTableName, columnName);

      var isColumnPresentInLeftTable = _.any(leftColumnsNames, function(leftColumnName) {
        return columnName === leftColumnName;
      });
      if (isColumnPresentInLeftTable) {
        colSQL = colSQL.concat('AS ' + rightTableName + '_' + columnName);
      }

      return colSQL.join(' ');
    })
  );

  // Make sure all select fields are comma separated
  sql.push(_.flatten(selects).join(', '));

  // LEFT JOIN
  sql.push('FROM ' + leftTableName + ' FULL OUTER JOIN ' + rightTableName + ' ON');

  // JOIN FIELD
  if (leftKeyColumnType === 'string' && rightKeyColumnType === 'string') {
    sql.push(
      'LOWER(TRIM(' + leftTableName + '.' + leftKeyColumnName + '))',
      '=',
      'LOWER(TRIM(' + rightTableName + '.' + rightKeyColumnName + '))'
    );
  } else {
    sql.push(
      leftTableName + '.' + leftKeyColumnName,
      '=',
      rightTableName + '.' + rightKeyColumnName
    );
  }

  return sql.join(' ');
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],162:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var SelectColumnsView = require('./select_columns_view');
var generateColumnMergeSQL = require('./generate_column_merge_sql');
var MergeModel = require('../merge_step_model');

/**
 * View for 2nd step of a column merge, where the user should select the column fields to merge
 */
module.exports = cdb.core.Model.extend({

  INSTRUCTIONS_SAFE_HTML: 'Choose other columns you want in your dataset.',

  defaults: {
    user: undefined,
    isReadyForNextStep: true,
    leftTable: undefined,
    leftKeyColumn: undefined,
    leftColumns: undefined,
    rightTableData: undefined,
    rightColumns: undefined,
    rightKeyColumn: undefined
  },

  createView: function() {
    // Reset state
    this.set('gotoNextStep', false);
    this._resetColumns(this.get('leftColumns'), function(column) {
      column.set('selected', true);
    });
    this._resetColumns(this.get('rightColumns'), function(column) {
      if (column.get('name') !== 'the_geom') {
        column.set('selected', true);
      }
      column.set('disabled', false);
    });

    return new SelectColumnsView({
      model: this
    });
  },

  onlyAllowOneSelectedTheGeomColumn: function(column, isSelected) {
    if (column.get('name') !== 'the_geom') return;

    var leftColumn = this._theGeomColumnFor('leftColumns');
    var rightColumn = this._theGeomColumnFor('rightColumns');

    if (column === leftColumn) {
      leftColumn.set('selected', isSelected);
      rightColumn.set('selected', !isSelected);
    } else if (column === rightColumn) {
      leftColumn.set('selected', !isSelected);
      rightColumn.set('selected', isSelected);
    }
  },

  nextStep: function() {
    var leftKeyColumn = this.get('leftKeyColumn');
    var rightKeyColumn = this.get('rightKeyColumn');

    var sql = generateColumnMergeSQL({
      leftTableName: this.get('leftTable').get('name'),
      leftKeyColumnName: leftKeyColumn.get('name'),
      leftKeyColumnType: leftKeyColumn.get('type'),
      leftColumnsNames: this._selectedColumnsNamesFor('leftColumns'),
      rightTableName: this.get('rightTableData').name,
      rightKeyColumnName: rightKeyColumn.get('name'),
      rightKeyColumnType: rightKeyColumn.get('type'),
      rightColumnsNames: this._selectedColumnsNamesFor('rightColumns')
    });

    return new this.constructor.nextStep({
      user: this.get('user'),
      tableName: this.get('leftTable').get('name'),
      sql: sql
    });
  },

  _selectedColumnsNamesFor: function(collectionName) {
    return this.get(collectionName)
      .chain()
      .filter(function(column) {
        return column.get('selected');
      }).
      map(function(column) {
        return column.get('name');
      })
      .value();
  },

  _theGeomColumnFor: function(which) {
    return this.get(which).find(function(column) {
      return column.get('name') === 'the_geom';
    });
  },

  _resetColumns: function(columns, eachReset) {
    columns.comparator = function(column) {
      var columnName = column.get('name');
      return columnName === 'the_geom' ? '00000' : columnName;
    };
    columns.each(eachReset, this);
    columns.sort();
  }

}, {
  header: {
    icon: 'CDB-IconFont-wizard',
    title: 'Choose the rest to add'
  },
  nextStep: MergeModel
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../merge_step_model":170,"./generate_column_merge_sql":161,"./select_columns_view":163}],163:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ColumnsSelectorView = require('../columns_selector_view');
var StickyHeaderView = require('../sticky_header_view');
var FooterView = require('../footer_view');
var FooterInfoView = require('./footer_info_view');

/**
 * View to select the columns to merge.
 */
module.exports = cdb.core.View.extend({

  initialize: function() {
    this._initViews();
    this._initBinds();
  },

  render: function() {
    var $el = $(
      this.getTemplate('common/dialogs/merge_datasets/column_merge/select_columns')({
        leftKeyColumn: this.model.get('leftKeyColumn'),
        rightKeyColumn: this.model.get('rightKeyColumn')
      })
    );
    $el.find('.js-sticky-header').append(this._stickyHeaderView.render().$el);
    $el.find('.js-left-table').append(this._leftTableComboView.render().$el);
    $el.find('.js-left-columns').append(this._leftColumnsView.render().$el);
    $el.find('.js-right-table').append(this._rightTableComboView.render().$el);
    $el.find('.js-right-columns').append(this._rightColumnsView.render().$el);
    $el.append(this._footerView.render().$el);
    this.$el.html($el);

    return this;
  },

  onChangeKeyColumnsVisiblity: function() {
    this._stickyHeaderView.$el.slideToggle(200);
  },

  _initViews: function() {
    this._stickyHeaderView = new StickyHeaderView({
      leftKeyColumn: this.model.get('leftKeyColumn'),
      rightKeyColumn: this.model.get('rightKeyColumn')
    });
    this.addView(this._stickyHeaderView);

    this._leftTableComboView = new cdb.forms.Combo({
      className: 'Select',
      width: '100%',
      disabled: true,
      extra: [this.model.get('leftTable').get('name')]
    });
    this.addView(this._leftTableComboView);

    this._leftColumnsView = new ColumnsSelectorView({
      collection: this.model.get('leftColumns'),
      selectorType: 'switch'
    });
    this.addView(this._leftColumnsView);

    this._rightTableComboView = new cdb.forms.Combo({
      className: 'Select',
      width: '100%',
      disabled: true,
      extra: [this.model.get('rightTableData').name]
    });
    this.addView(this._rightTableComboView);

    this._rightColumnsView = new ColumnsSelectorView({
      collection: this.model.get('rightColumns'),
      selectorType: 'switch'
    });
    this.addView(this._rightColumnsView);

    this._footerView = new FooterView({
      model: this.model,
      nextLabel: 'Merge datasets',
      infoView: new FooterInfoView({
        model: this.model
      })
    });
    this.addView(this._footerView);
  },

  _initBinds: function() {
    this.model.get('leftColumns').bind('change:selected', this._onChangeSelectedColumn, this);
    this.add_related_model(this.model.get('leftColumns'));

    this.model.get('rightColumns').bind('change:selected', this._onChangeSelectedColumn, this);
    this.add_related_model(this.model.get('rightColumns'));
  },

  _onChangeSelectedColumn: function(column, isSelected) {
    this.model.onlyAllowOneSelectedTheGeomColumn(column, isSelected);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../columns_selector_view":165,"../footer_view":166,"../sticky_header_view":182,"./footer_info_view":160}],164:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View to select one or multiple columns.
 *  - For only allowing selecting one set selectorType to 'radio'
 *  - For allowing multiple selections set selectorType to 'switch'
 */
module.exports = cdb.core.View.extend({

  className: 'List-row',

  events: {
    'click': '_onClick',
    'mouseenter': '_onMouseEnter',
    'mouseleave': '_onMouseLeave'
  },

  initialize: function() {
    if (!this.options.selectorType) throw new Error('selectorType is required');

    this.model = new cdb.core.Model({
      type: this.options.selectorType
    });

    this.column = this.options.column;

    this._initBinds();
  },

  render: function() {
    this.$el.html(
      this.getTemplate('common/dialogs/merge_datasets/column_selector')({
        selectorType: this.model.get('type'),
        columnName: this.column.get('name'),
        columnType: this.column.get('type')
      })
    );

    if (!this._tooltip) {
      this._tooltip = new cdb.common.TipsyTooltip({
        el: this.el,
        offset: -20,
        trigger: 'manual',
        fallback: 'Your column type is not compatible with the column you have selected in the left column'
      });
      this.addView(this._tooltip);
    }

    this._onChangeSelected(this.column, this.column.get('selected'));
    this._onChangeDisabled(this.column, this.column.get('disabled'));

    return this;
  },

  _initBinds: function() {
    this.column.bind('change:selected', this._onChangeSelected, this);
    this.column.bind('change:disabled', this._onChangeDisabled, this);
    this.add_related_model(this.column);
  },

  _onChangeSelected: function(column, isSelected) {
    if (this.model.get('type') === 'radio') {
      this.$el.toggleClass('is-selected', !!isSelected);
    }
    this.$('.js-radio').toggleClass('is-checked', !!isSelected);
    this.$('.js-switch').prop('checked', !!isSelected);
  },

  _onChangeDisabled: function(column, isDisabled) {
    isDisabled = !!isDisabled;
    this.$el.toggleClass('is-disabled', isDisabled);
  },

  _onClick: function(ev) {
    this.killEvent(ev);
    if (!this._isDisabled()) {
      var inverseSelectedVal = !this.column.get('selected');

      // radio buttons can only be selected, unselection of other items should be handled by collection/parent
      if (inverseSelectedVal || this.model.get('type') !== 'radio') {
        this.column.set('selected', inverseSelectedVal);
      }
    }
  },

  _onMouseEnter: function() {
    if (this._isDisabled()) {
      this._tooltip.showTipsy();
    }
  },

  _onMouseLeave: function() {
    this._tooltip.hideTipsy();
  },

  _isDisabled: function() {
    return this.column.get('disabled');
  }

});


}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],165:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ColumnSelectorView = require('./column_selector_view');
var randomQuote = require('../../view_helpers/random_quote');

/**
 * View to select an individual column.
 * The selector type is passed to the child view of class ColumnSelectorView.
 */
module.exports = cdb.core.View.extend({

  className: 'List',

  events: {
    'click .js-select-all': '_onClickSelectAll',
    'click': 'killEvent'
  },

  initialize: function() {
    this.model = new cdb.core.Model({
      showSelectAllToggle: this.options.selectorType === 'switch' || false,
      enforceSingleSelected: this.options.selectorType === 'radio' || false,
      loading: this.options.loading
    });
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();
    this.$el.html('');

    if (this.collection.length > 0) {
      var chain = this.collection.chain();
      if (this.options.excludeFilter) {
        chain = chain.reject(this.options.excludeFilter);
      }
      chain.each(this._addColumnSelectorView, this);

      this._renderSelectAllToggle();
    } else if (this.model.get('loading')) {
      this._renderLoading();
    }

    return this;
  },

  _renderLoading: function() {
    this.$el.html(
      this.getTemplate('common/templates/loading')({
        title: 'Fetching ' + this.model.get('loading'),
        quote: randomQuote()
      })
    );
  },

  _addColumnSelectorView: function(model) {
    var view = new ColumnSelectorView(
      _.chain({
        column: model
      })
      .extend(this.options)
      .omit(['el', 'collection'])
      .value()
    );
    this.addView(view);
    this.$el.append(view.render().$el);
  },

  _renderSelectAllToggle: function() {
    if (this.model.get('showSelectAllToggle')) {
      this.$el.append(
        this.getTemplate('common/dialogs/merge_datasets/columns_selector_toggle_all')({
          areAllSelected: this._areAllSelected()
        })
      );
    }
  },

  _initBinds: function() {
    this.collection.bind('reset', this.render, this);
    this.collection.bind('change:selected', this._onChangeSelected, this);
    this.add_related_model(this.collection);

    this.model.bind('change:loading', this.render, this);
  },

  _onChangeSelected: function(model, isSelected) {
    if (isSelected && this.model.get('enforceSingleSelected')) {
      this._unselectAllExcept(model);
      this.collection.sort();
      this.render(); // to re-render with new sort order
    }
    this.$('.js-select-all input').prop('checked', this._areAllSelected());
  },

  _unselectAllExcept: function(exceptionModel) {
    this.collection.each(function(m) {
      if (m !== exceptionModel) {
        m.set('selected', false);
      }
    });
  },

  _onClickSelectAll: function() {
    var invertedAllSelected = !this._areAllSelected();
    this.collection.chain()
    .reject(function(m) {
      return m.get('disabled');
    })
    .each(function(m) {
      m.set('selected', invertedAllSelected);
    });
  },

  _areAllSelected: function() {
    return this.collection.all(function(m) {
      return m.get('selected');
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_helpers/random_quote":212,"./column_selector_view":164}],166:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View that represents the footer.
 * May contain an additional info view with more state details depending on context.
 */
module.exports = cdb.core.View.extend({

  events: {
    'click .js-next': '_onClickNext'
  },

  initialize: function() {
    if (this.options.infoView) {
      this.addView(this.options.infoView);
    }
    this._initBinds();
  },

  render: function() {
    this.$el.html(
      this.getTemplate('common/dialogs/merge_datasets/footer')({
        nextLabel: this.options.nextLabel || 'next step'
      })
    );
    this._onChangeIsReadyForNextStep(this.model, this.model.get('isReadyForNextStep'));
    this._maybeRenderInfoView();
    return this;
  },

  _maybeRenderInfoView: function() {
    if (this.options.infoView) {
      this.$('.js-info').append(this.options.infoView.render().$el);
    }
  },

  _initBinds: function() {
    this.model.bind('change:isReadyForNextStep', this._onChangeIsReadyForNextStep, this);
  },

  _onChangeIsReadyForNextStep: function(model, isReady) {
    this.$('.js-next').toggleClass('is-disabled', !isReady);
  },

  _onClickNext: function() {
    if (this.model.get('isReadyForNextStep')) {
      this.model.set('gotoNextStep', true);
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],167:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ColumnMergeModel = require('./column_merge/column_merge_model');
var SpatialMergeModel = require('./spatial_merge/spatial_merge_model');

/**
 * View model for merge datasets view.
 */
module.exports = cdb.core.Model.extend({

  excludeColumns: [
    'cartodb_id',
    'created_at',
    'updated_at',
    'the_geom_webmercator',
    'cartodb_georef_status'
  ],

  defaults: {
    mergeFlavors: undefined, // Collection, created with model
    prevSteps: [],
    currentStep: undefined,
    table: undefined,
    user: undefined
  },

  initialize: function(attrs) {
    if (!attrs.table) throw new Error('table is required');
    if (!attrs.user) throw new Error('user is required');

    var data = {
      user: this.get('user'),
      table: this.get('table'),
      excludeColumns: this.excludeColumns
    };
    this.set('mergeFlavors', new Backbone.Collection([
      new ColumnMergeModel(data),
      new SpatialMergeModel(data)
    ]));
  },

  headerSteps: function() {
    var steps = [];

    var currentStep = this.get('currentStep');
    var firstStep = this.get('prevSteps')[0] || currentStep;
    var isFinished = true;
    if (firstStep) {
      var Model = firstStep.constructor;
      while (Model) {
        if (Model.header) {
          var isCurrent = Model === currentStep.constructor;
          if (isCurrent) {
            isFinished = false;
          }
          steps.push(
            _.extend({
              isFinished: isFinished,
              isCurrent: isCurrent
            }, Model.header)
          );
        }

        Model = Model === Model.nextStep ? undefined : Model.nextStep;
      }
    }

    return steps;
  },

  gotoNextStep: function() {
    var currentStep = this.get('currentStep');
    var nextStep = currentStep.nextStep();
    this.set({
      prevSteps: this.get('prevSteps').concat(currentStep),
      currentStep: nextStep
    });
  },

  gotoPrevStep: function() {
    this.set('currentStep', this.get('prevSteps').pop());
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./column_merge/column_merge_model":159,"./spatial_merge/spatial_merge_model":180}],168:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var BaseDialog = require('../../views/base_dialog/view.js');
var MergeDatasetsModel = require('./merge_datasets_model.js');
var MergeFlavorView = require('./merge_flavor_view');

/**
* Shows a dialog to start merging two tables
*  new MergeDatasetsDialog({
*    model: table
*  })
* Migrated from old code.
*/
module.exports = BaseDialog.extend({

  events: BaseDialog.extendEvents({
    'click .js-back': '_onBackClick'
  }),

  initialize: function() {
    this.options.clean_on_hide = true;
    this.options.enter_to_confirm = false;
    this.elder('initialize');

    this.model = new MergeDatasetsModel({
      table: this.options.table,
      user: this.options.user
    });

    this._initBinds();
  },

  /**
   * @override BaseDialog.prototype.render
   */
  render: function() {
    BaseDialog.prototype.render.apply(this, arguments);
    this.$('.content').addClass('Dialog-contentWrapper');

    // Let the current step view know when the scroll has crossed the expected threshold for the key columns to be visible
    this.$('.js-scroll').off('scroll');
    if (this._stepView && this._stepView.onChangeKeyColumnsVisiblity) {
      this._areKeyColumnsVisible = true;
      var self = this;
      this.$('.js-scroll').on('scroll', function(ev) {
        var areKeyColumnsVisible = ev.target.scrollTop <= 175;
        if (areKeyColumnsVisible !== self._areKeyColumnsVisible) {
          self._areKeyColumnsVisible = areKeyColumnsVisible;
          self._stepView.onChangeKeyColumnsVisiblity(areKeyColumnsVisible);
        }
      });
    }

    return this;
  },

  render_content: function() {
    this.clearSubViews();
    var $el;
    var defaultTemplate = this.getTemplate('common/dialogs/merge_datasets/merge_datasets_content');

    var currentStep = this.model.get('currentStep');
    if (currentStep) {
      var $step = this._$renderedStep(currentStep);
      if (currentStep.get('skipDefaultTemplate')) {
        // Render the view as content w/o wrapping it in the default template
        return $step;
      }

      $el = $(defaultTemplate({
        currentStep: currentStep,
        headerSteps: this.model.headerSteps()
      }));
      $el.find('.js-details').append($step);
    } else {
      $el = $(defaultTemplate({
        currentStep: undefined
      }));
      var $mergeFlavorsList = $el.find('.js-flavors');
      $mergeFlavorsList.append.apply($mergeFlavorsList, this._$renderedMergeFlavors());
    }

    return $el;
  },

  _$renderedMergeFlavors: function() {
    return this.model.get('mergeFlavors')
      .map(function(model) {
        var view = new MergeFlavorView({
          model: model
        });
        this.addView(view);
        return view.render().$el;
      }, this);
  },

  _onChangeSelectedMergeFlavor: function(model, wasSelected) {
    // Only change to next step if there's one selected
    if (wasSelected) {
      // reset selected state, so if/when user goes back to start view can select again
      model.unset('selected');

      // Set new current step
      var firstStep = model.firstStep();
      this.model.set('currentStep', firstStep);

      // Event tracking "Use visual merge"
      cdb.god.trigger('metrics', 'visual_merge', {
        email: window.user_data.email
      });
    }
  },

  _initBinds: function() {
    var mergeFlavors = this.model.get('mergeFlavors');
    mergeFlavors.bind('change:selected', this._onChangeSelectedMergeFlavor, this);
    this.add_related_model(mergeFlavors);

    this.model.bind('change:currentStep', this.render, this);
  },

  _onChangeGotoNextStep: function(model, isTrue) {
    if (isTrue) {
      this.model.gotoNextStep();
    }
  },

  _$renderedStep: function(step) {
    // Clean up prev step, if there is any
    if (this._stepView) {
      this._stepView.clean();
      this.removeView(this._stepView);

      this._stepModel.unbind('change:gotoNextStep');
      this._models = _.without(this._models, this._stepModel); // TODO: why no this.remove_related_model?
    }

    this._stepModel = step;
    this._stepModel.bind('change:gotoNextStep', this._onChangeGotoNextStep, this);
    this.add_related_model(this._stepModel);

    this._stepView = step.createView();
    this._stepView.bind('clickedNext', this._onClickNext, this);
    this.addView(this._stepView);
    return this._stepView.render().$el;
  },

  _onClickNext: function(e) {
    this.killEvent(e);
    this.model.gotoNextStep();
  },

  _onBackClick: function(e) {
    this.killEvent(e);
    this.model.gotoPrevStep();
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../views/base_dialog/view.js":213,"./merge_datasets_model.js":167,"./merge_flavor_view":169}],169:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

module.exports = cdb.core.View.extend({

  className: 'OptionCard OptionCard--blocky',

  events: {
    'click': '_onClick'
  },

  render: function() {
    this.$el.html(
      this.getTemplate('common/dialogs/merge_datasets/merge_flavor')({
        illustrationIconType: this.model.ILLUSTRATION_ICON_TYPE,
        icon: this.model.ICON,
        title: this.model.TITLE,
        desc: this.model.DESC
      })
    );

    if (!this.model.isAvailable()) {
      this.$el.addClass('is-disabled');
    }

    return this;
  },

  _onClick: function(ev) {
    this.killEvent(ev);
    if (this.model.isAvailable()) {
      this.model.set('selected', true);
    }
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],170:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var MergeStepView = require('./merge_step_view');

/**
 * Last step in the merge flows, managed the actual merge flow
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    skipDefaultTemplate: true,
    user: undefined,
    tableName: '',
    sql: undefined
  },

  createView: function() {
    return new MergeStepView({
      model: this
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./merge_step_view":171}],171:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var randomQuote = require('../../view_helpers/random_quote.js');
var ErrorDetailsView = require('../../views/error_details_view');

/**
 * View for the last step of all merge kinds, creates the actual merged table.
 * TODO: taken from old code, cdb.admin.MergeTableDialog.merge, could this be done in a better way?
 */
module.exports = cdb.core.View.extend({

  initialize: function() {
    _.bindAll(this, '_onMergeSuccess', '_onMergeError');
    this._startMerge();
  },

  render: function() {
    this.$el.html(
      this.getTemplate('common/templates/loading')({
        title: 'Merging datasets and generating the new one…',
        quote: randomQuote()
      })
    );
    return this;
  },

  _startMerge: function() {
    // TODO: taken from old code, cdb.admin.MergeTableDialog.merge
    //   could this be done in a better way?
    $.ajax({
      type: 'POST',
      url: cdb.config.prefixUrl() + '/api/v1/imports',
      data: {
        table_name: this.model.get('tableName') + '_merge',
        sql: this.model.get('sql')
      },
      success: this._onMergeSuccess,
      error: this._onMergeError
    });
  },

  _onMergeSuccess: function(r) {
    var imp = this.importation = new cdb.admin.Import({
      item_queue_id: r.item_queue_id
    });
    this.add_related_model(imp);

    // Bind complete event
    imp.bind('importComplete', function() {
      imp.unbind();
      window.location.href = cdb.config.prefixUrl() + "/tables/" + (imp.get("table_name") || imp.get("table_id")) + "/";
    }, this);

    var self = this;
    imp.bind('importError', function(e) {
      self._showError(
        e.attributes.error_code,
        e.attributes.get_error_text.title,
        e.attributes.get_error_text.what_about,
        e.attributes.item_queue_id
      );
    }, this);
    imp.pollCheck();
  },

  _onMergeError: function(e) {
    try {
      this._showError(
        e.attributes.error_code,
        e.attributes.get_error_text.title,
        e.attributes.get_error_text.what_about,
        e.attributes.item_queue_id
      );
    } catch(err) {
      this._showError('99999', 'Unknown', '');
    }
  },

  //Show the error when duplication fails
  _showError: function(number, title, what_about, item_queue_id) {
    var view = new ErrorDetailsView({
      err: {
        error_code: number,
        title: title,
        what_about: what_about,
        item_queue_id: item_queue_id
      },
      user: this.model.get('user')
    });
    this.addView(view);
    this.$el.html(view.render().el);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_helpers/random_quote.js":212,"../../views/error_details_view":215}],172:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var SpatialMergeView = require('./spatial_merge_view');
var MergeModel = require('../merge_step_model');
var generateSpatialMergeSQL = require('./generate_spatial_merge_sql');

/**
 * Step 2 for a spatial merge, select merge method and right column.
 */
module.exports = cdb.core.Model.extend({

  INSTRUCTIONS_SAFE_HTML: 'Calculate the intersecting geospatial records between two datasets (ex. points in polygons).<br/>' +
    "You'll need to decide the operation to perform here.",

  defaults: {
    isReadyForNextStep: false,
    user: undefined,
    mergeMethods: undefined,
    leftTable: undefined,
    leftKeyColumn: undefined,
    leftColumns: undefined,
    rightTableData: undefined,
    rightKeyColumn: undefined,
    rightColumns: undefined
  },

  createView: function() {
    // Reset state
    this.set('gotoNextStep', false);
    this.get('mergeMethods').each(function(m) {
      m.set('disabled', !this.isCountMergeMethod(m));
    }, this);
    this.get('rightColumns').comparator = function(column) {
      return column.get('name'); // sort alphabetically
    };

    return new SpatialMergeView({
      model: this
    });
  },

  selectedMergeMethod: function() {
    return this.get('mergeMethods').find(this._isSelectedColumn);
  },

  selectedRightMergeColumn: function() {
    return this.get('rightColumns').find(this._isSelectedColumn);
  },

  changedRightMergeColumn: function(newColumn) {
    this._updateMergeMethods(newColumn);
    this._assertIfReadyForNextStep();
  },

  changedSelectedMergeMethod: function(newMergeMethod) {
    var c = this.get('mergeMethods').chain().without(newMergeMethod);
    c.each(this._deselect); //all but the new selected merge method

    if (this.isCountMergeMethod(newMergeMethod)) {
      c.each(this._enable); //enable all, so the user can "go back" to see available columns for AVG/SUM merge methods
      this.get('rightColumns').each(this._deselect); // reset prev selection if any
    } else {
      // If not a count mege method update state based on current selection of merge column.
      this._updateMergeMethods(this.selectedRightMergeColumn());
    }

    this._assertIfReadyForNextStep();
  },

  _updateMergeMethods: function(newColumn) {
    // Each merge method should know how it should render based on selected merge column
    this.get('mergeMethods').each(function(m) {
      m.changedMergeColumn(newColumn);
    });
  },

  isCountMergeMethod: function(m) {
    return m && m.NAME === 'count';
  },

  nextStep: function() {
    return new this.constructor.nextStep({
      user: this.get('user'),
      tableName: this.get('leftTable').get('name'),
      sql: this._sqlForMergeMethod()
    });
  },

  _deselect: function(m) {
    m.set('selected', false);
  },

  _disable: function(m) {
    m.set('disabled', true);
  },

  _enable: function(m) {
    m.set('disabled', false);
  },

  _assertIfReadyForNextStep: function() {
    var mergeMethod = this.selectedMergeMethod();
    var isReady = mergeMethod && (
        this.isCountMergeMethod(mergeMethod) ||
        (!mergeMethod.get('disabled') && this.selectedRightMergeColumn())
      );
    this.set('isReadyForNextStep', isReady);
  },

  _sqlForMergeMethod: function() {
    var rightTableName = this.get('rightTableData').name;
    var mergeMethod = this.selectedMergeMethod();
    var selectedMergeColumn = this.selectedRightMergeColumn();
    var selectClause = mergeMethod.sqlSelectClause(rightTableName, selectedMergeColumn ? selectedMergeColumn.get('name') : '');

    return generateSpatialMergeSQL({
      leftTableName: this.get('leftTable').get('name'),
      leftColumnsNames: this._selectedLeftColumnsNames(),
      rightTableName: rightTableName,
      selectClause: selectClause,
      intersectType: mergeMethod.NAME
    });
  },

  _selectedLeftColumnsNames: function() {
    return this.get('leftColumns')
    .filter(this._isSelectedColumn)
    .map(function(m) {
      return m.get('name');
    });
  },

  _isSelectedColumn: function(m) {
    return m.get('selected');
  }

}, {
  header: {
    icon: 'CDB-IconFont-wizard',
    title: 'Choose merge columns'
  },
  nextStep: MergeModel
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../merge_step_model":170,"./generate_spatial_merge_sql":175,"./spatial_merge_view":181}],173:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var SumMergeMethod = require('./merge_methods/sum_merge_method');
var AVGMergeMethod = require('./merge_methods/avg_merge_method');
var CountMergeMethod = require('./merge_methods/count_merge_method');
var SpatialMergeView = require('./spatial_merge_view');
var ChooseMergeMethod = require('./choose_merge_method_model');

/**
 * First step for a spatial merge - select a dataset table.
 */
module.exports = cdb.core.Model.extend({

  INSTRUCTIONS_SAFE_HTML: 'Calculate the intersecting geospatial records between two datasets (ex. points in polygons).<br/>' +
    "You'll need to decide the operation to perform here.",

  defaults: {
    user: undefined,
    leftTable: undefined,
    excludeColumns: undefined,
    leftKeyColumn: undefined,
    leftColumns: undefined,
    mergeMethods: undefined,

    rightTableData: undefined,
    rightColumns: undefined
  },

  initialize: function(attrs) {
    if (!attrs.leftTable) throw new Error('leftTable is required');
    if (!attrs.excludeColumns || _.isEmpty(attrs.excludeColumns)) cdb.log.error('excludeColumns was empty');
    this._initColumns();
    this._initLeftKeyColumn();
    this._initMergeMethods();
  },

  createView: function() {
    // Reset state
    this.set({
      gotoNextStep: false,
      rightTableData: undefined
    });
    this.get('mergeMethods').each(function(m) {
      m.set({
        selected: false,
        disabled: true
      });
    });
    this.get('rightColumns').reset();

    return new SpatialMergeView({
      model: this
    });
  },

  assertIfReadyForNextStep: function() {
    // Always return false, goes to next step implicitly on selecting table
    return false;
  },

  fetchRightColumns: function(tableData) {
    this.set('rightTableData', tableData);
    // TODO: extracted from old code, cdb.admin.TableColumnSelector._getColumns,
    //   isnt there some better way to get the schema/columns?
    $.ajax({
      url: cdb.config.prefixUrl() + '/api/v1/tables/' + tableData.id,
      dataType: 'jsonp',
      success: this._onFetchedRightColumns.bind(this)
    });
  },

  nextStep: function() {
    return new this.constructor.nextStep({
      user: this.get('user'),
      mergeMethods: this.get('mergeMethods'),
      leftTable: this.get('leftTable'),
      leftKeyColumn: this.get('leftKeyColumn'),
      leftColumns: this.get('leftColumns'),
      rightTableData: this.get('rightTableData'),
      rightKeyColumn: this._rightKeyColumn(),
      rightColumns: this.get('rightColumns')
    });
  },

  _initColumns: function() {
    var filteredLeftColumns = this._filterColumns(this.get('leftTable').get('schema'));
    this.set('leftColumns', new Backbone.Collection(filteredLeftColumns));
    this.set('rightColumns', new Backbone.Collection());
  },

  _initMergeMethods: function() {
    var mergeMethods = new Backbone.Collection([
      new SumMergeMethod(),
      new CountMergeMethod(),
      new AVGMergeMethod()
    ]);
    this.set('mergeMethods', mergeMethods);
  },

  _filterColumns: function(tableSchema) {
    var excludeColumns = this.get('excludeColumns');

    return _.chain(tableSchema)
      .map(this._columnDataToColumn)
      .reject(function(column) {
        return _.contains(excludeColumns, column.name);
      })
      .value();
  },

  _columnDataToColumn: function(columnData) {
    return {
      // TODO: why don't we use a proper model for schema, to provide convenient method to get columns as a collection already?
      name: columnData[0],
      type: columnData[1]
    };
  },

  _initLeftKeyColumn: function() {
    var theGeomColumn = this.get('leftColumns').find(this._isColumnTheGeom);
    this.set('leftKeyColumn', theGeomColumn.clone());
  },

  _onFetchedRightColumns: function(results) {
    var filteredColumns = this._filterColumns(results.schema);
    this.get('rightColumns').reset(filteredColumns, { silent: true }); // handled in next step
    this.set('gotoNextStep', true);
  },

  _rightKeyColumn: function() {
    return this.get('rightColumns')
      .find(this._isColumnTheGeom)
      .clone();
  },

  _isColumnTheGeom: function(column) {
    return column.get('name') === 'the_geom';
  }

}, {
  header: {
    icon: 'CDB-IconFont-play',
    title: 'Choose dataset to merge'
  },
  nextStep: ChooseMergeMethod
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./choose_merge_method_model":172,"./merge_methods/avg_merge_method":177,"./merge_methods/count_merge_method":178,"./merge_methods/sum_merge_method":179,"./spatial_merge_view":181}],174:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View to indicate the selected key columns relationship and merge method relationship.
 */
module.exports = cdb.core.View.extend({

  initialize: function() {
    this._initBinds();
  },

  render: function() {
    var rightColumns = this.model.get('rightColumns');
    this.$el.html(
      this.getTemplate('common/dialogs/merge_datasets/spatial_merge/footer_info')({
        leftTableName: this.model.get('leftTable').get('name'),
        rightColumnName: rightColumns ? rightColumns.get('name') : ''
      })
    );
    return this;
  },

  _initBinds: function() {
    var rightColumns = this.model.get('rightColumns');
    rightColumns.bind('change:selected', this._updatePieces, this);
    this.add_related_model(rightColumns);

    var mergeMethods = this.model.get('mergeMethods');
    mergeMethods.bind('change:selected', this._updatePieces, this);
    this.add_related_model(mergeMethods);
  },

  _updatePieces: function() {
    var selectedMergMethod = this.model.selectedMergeMethod();
    this.$('.js-merge-method-name').text(selectedMergMethod ? selectedMergMethod.NAME : '');

    if (this.model.isCountMergeMethod(selectedMergMethod)) {
      this._changeRightPiece(this.model.get('rightTableData').name);
    } else {
      var m = this.model.selectedRightMergeColumn();
      this._changeRightPiece(m ? m.get('name') : '');
    }
  },

  _changeRightPiece: function(text) {
    this.$('.js-right')
      .text(text || '')
      .toggleClass('is-placeholder', !text);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],175:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

// SQL query as taken from old code, cdb.admin.MergeTablesDialog
// Cleaned up to remove noise and avoid string concatenation to be more legible.
module.exports = function(d) {
  var leftTableName = d.leftTableName;
  var leftColumnsNames = d.leftColumnsNames;
  var rightTableName = d.rightTableName;
  var selectClause = d.selectClause;
  var intersectType = d.intersectType;

  var sql = ['SELECT',
    leftTableName + '.cartodb_id,',
    leftTableName + '.the_geom_webmercator,',
    leftTableName + '.the_geom,'
  ];

  _.each(leftColumnsNames, function(columnName) {
    if (columnName !== 'the_geom') {
      sql.push(leftTableName + '.' + columnName + ',');
    }
  });

  sql.push(
    '(SELECT ' + selectClause + ' FROM ' + rightTableName,
      'WHERE ST_Intersects(' + leftTableName + '.the_geom, ' + rightTableName + '.the_geom)',
    ') AS intersect_' + intersectType,
    'FROM ' + leftTableName
  );

  return sql.join(' ');
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],176:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View to render a individual merge method.
 */
module.exports = cdb.core.View.extend({

  className: 'TabLink TabLink--positive TabLink--textCenterUpcase',

  events: {
    'hover': '_onHover',
    'mouseout': '_onMouseOut',
    'click': '_onClick'
  },

  initialize: function() {
    this._initBinds();
  },

  render: function() {
    var isDisabled = this.model.get('disabled');

    this.$el
      .text(this.model.NAME)
      .toggleClass('disabled', isDisabled)
      .toggleClass('selected', this.model.get('selected') && !isDisabled);

    if (isDisabled) {
      this._tooltipView().show();
    }

    return this;
  },

  _tooltipView: function() {
    if (!this._tooltip) {
      this._tooltip = new cdb.common.TipsyTooltip({
        el: this.$el,
        trigger: 'manual',
        title: function() {
          // For now there's only one reason why a merge method would be disabled, so inline it here.
          // If there are more methods set the reason as an attr on the model instead, and update that attr based on state
          return 'Select a column of type number to use this merge method';
        }
      });
      this.addView(this._tooltip);
    }
    return this._tooltip;
  },

  _initBinds: function() {
    this.model.bind('change:selected', this.render, this);
    this.model.bind('change:disabled', this.render, this);
  },

  _onHover: function(ev) {
    this.killEvent(ev);
    if (this.model.get('disabled')) {
      this._tooltip.showTipsy();
    }
  },

  _onMouseOut: function(ev) {
    this.killEvent(ev);
    if (this._tooltip) {
      this._tooltip.hideTipsy();
    }
  },

  _onClick: function(ev) {
    this.killEvent(ev);
    if (!this.model.get('disabled')) {
      this.model.set('selected', true);
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],177:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * Merge method to create SQL query for doing a spatial AVG.
 */
module.exports = cdb.core.Model.extend({

  NAME: 'avg',

  defaults: {
    disabled: false,
    selected: false
  },

  changedMergeColumn: function(newMergeColumn) {
    var shouldDisable = !newMergeColumn || newMergeColumn.get('type') !== 'number';
    this.set({
      disabled: shouldDisable,
      selected: this.get('selected') && !shouldDisable
    });
  },

  sqlSelectClause: function(tableName, columnName) {
    return 'AVG(' + tableName + '.' + columnName + ')';
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],178:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * Merge method to create SQL query for doing a spatial count.
 */
module.exports = cdb.core.Model.extend({

  NAME: 'count',

  defaults: {
    disabled: false,
    selected: false
  },

  changedMergeColumn: function(newMergeColumn) {
  },

  sqlSelectClause: function() {
    return 'COUNT(*)';
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],179:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * Merge method to create SQL query for doing a spatial sum.
 */
module.exports = cdb.core.Model.extend({

  NAME: 'sum',

  defaults: {
    disabled: false,
    selected: false
  },

  changedMergeColumn: function(newMergeColumn) {
    var shouldDisable = !newMergeColumn || newMergeColumn.get('type') !== 'number';
    this.set({
      disabled: shouldDisable,
      selected: this.get('selected') && !shouldDisable
    });
  },

  sqlSelectClause: function(tableName, columnName) {
    return 'SUM(' + tableName + '.' + columnName + ')';
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],180:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var ChooseRightDatasetModel = require('./choose_right_dataset_model');

/**
 * Entry point model that represents the merge flavor of doing a spatial merge.
 */
module.exports = cdb.core.Model.extend({

  ILLUSTRATION_ICON_TYPE: 'IllustrationIcon--royal',
  ICON: 'CDB-IconFont-mergeSpatial',
  TITLE: 'Spatial join',
  DESC: 'Measure the number of intesecting records between two datasets (ex. count point inside polygons)',

  defaults: {
    user: undefined,
    table: undefined,
    excludeColumns: []
  },

  initialize: function(attrs) {
    if (!attrs.user) throw new Error('user is required');
    if (!attrs.table) throw new Error('table is required');
    if (!attrs.excludeColumns || _.isEmpty(attrs.excludeColumns)) cdb.log.error('excludeColumns was empty');
  },

  isAvailable: function() {
    return true;
  },

  firstStep: function() {
    return new ChooseRightDatasetModel({
      user: this.get('user'),
      leftTable: this.get('table'),
      excludeColumns: this.get('excludeColumns')
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./choose_right_dataset_model":173}],181:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ColumnsSelectorView = require('../columns_selector_view');
var TablesSelectorView = require('../tables_selector_view');
var MergeMethodView = require('./merge_method_view');
var StickyHeaderView = require('../sticky_header_view');
var FooterView = require('../footer_view');
var FooterInfoView = require('./footer_info_view');

/**
 * Shared view for both steps of doing a spatial merge, since they are essentially the same
 */
module.exports = cdb.core.View.extend({

  initialize: function() {
    this._initViews();
    this._initBinds();
  },

  render: function() {
    var hasSelectedRightTable = this._hasSelectedRightTable();

    var $el = $(
      this.getTemplate('common/dialogs/merge_datasets/spatial_merge/spatial_merge')({
        leftKeyColumn: this.model.get('leftKeyColumn'),
        hasSelectedRightTable: hasSelectedRightTable,
        rightKeyColumn: this.model.get('rightKeyColumn'),
        rightColumns: this.model.get('rightColumns')
      })
    );

    $el.find('.js-left-table').append(this._leftTableComboView.render().$el);
    $el.find('.js-left-columns').append(this._leftColumnsView.render().$el);
    $el.find('.js-right-columns').append(this._rightColumnsView.render().$el);
    $el.append(this._footerView.render().$el);

    if (hasSelectedRightTable) {
      $el.find('.js-sticky-header').append(this._stickyHeaderView.render().$el);
      $el.find('.js-right-table').append(this._rightTableComboView.render().$el);
      this._renderMergeMethods($el.find('.js-merge-methods'));
    } else {
      $el.find('.js-right-tables').append(this._rightTablesSelectorView.render().$el);
    }

    this.$el.html($el);

    return this;
  },

  onChangeKeyColumnsVisiblity: function() {
    if (this._hasSelectedRightTable()) {
      this._stickyHeaderView.$el.slideToggle(200);
    }
  },

  _hasSelectedRightTable: function() {
    return _.isObject(this.model.get('rightTableData'));
  },

  _initViews: function() {
    this._leftTableComboView = new cdb.forms.Combo({
      className: 'Select',
      width: '100%',
      disabled: true,
      extra: [this.model.get('leftTable').get('name')]
    });
    this.addView(this._leftTableComboView);

    this._leftColumnsView = new ColumnsSelectorView({
      collection: this.model.get('leftColumns'),
      excludeFilter: this._columnsExcludeFilter,
      selectorType: 'switch'
    });
    this.addView(this._leftColumnsView);

    var footerInfoView; // only set for 2nd step
    var rightTableData = this.model.get('rightTableData');
    if (rightTableData) {
      this._stickyHeaderView = new StickyHeaderView({
        leftKeyColumn: this.model.get('leftKeyColumn'),
        rightKeyColumn: this.model.get('rightKeyColumn'),
        addRadioPlaceholder: true
      });
      this.addView(this._stickyHeaderView);

      this._rightTableComboView = new cdb.forms.Combo({
        className: 'Select',
        width: '100%',
        disabled: true,
        extra: [this.model.get('rightTableData').name]
      });
      this.addView(this._rightTableComboView);
      footerInfoView = new FooterInfoView({
        model: this.model
      })
    } else {
      this._rightTablesSelectorView = new TablesSelectorView({
        excludeFilter: this._rightTablesExcludeFilter.bind(this),
        initialOption: {
          label: rightTableData ? rightTableData.name : 'Select dataset'
        }
      });
      this.addView(this._rightTablesSelectorView);
    }

    this._rightColumnsView = new ColumnsSelectorView({
      collection: this.model.get('rightColumns'),
      excludeFilter: this._columnsExcludeFilter,
      selectorType: 'radio'
    });
    this.addView(this._rightColumnsView);

    this._mergeMethodViews = this.model.get('mergeMethods').map(this._createMergeMethodView, this);

    this._footerView = new FooterView({
      model: this.model,
      nextLabel: rightTableData ? 'Merge datasets' : undefined,
      infoView: footerInfoView
    });
    this.addView(this._footerView);
  },

  _createMergeMethodView: function(m) {
    var view = new MergeMethodView({ model: m });
    this.addView(view);
    return view;
  },

  _initBinds: function() {
    var rightColumns = this.model.get('rightColumns');
    rightColumns.bind('change:selected', this._onChangeSelectedRightColumn, this);
    this.add_related_model(rightColumns);

    var mergeMethods = this.model.get('mergeMethods');
    if (mergeMethods) {
      mergeMethods.bind('change:selected', this._onChangeSelectedMergeMethod, this);
      this.add_related_model(mergeMethods);
    }

    if (this._rightTablesSelectorView) {
      this._rightTablesSelectorView.model.bind('change:tableData', this._onChangeRightTableData, this);
      this.add_related_model(this._rightTablesSelectorView.model);
    }
  },

  _onChangeRightTableData: function(m, tableData) {
    this._rightColumnsView.model.set('loading', 'columns');
    this.model.fetchRightColumns(tableData);
  },

  _onChangeSelectedRightColumn: function(m, isSelected) {
    if (isSelected) {
      this.model.changedRightMergeColumn(m);
    }
  },

  _onChangeSelectedMergeMethod: function(m, isSelected) {
    if (!isSelected) return;

    this.model.changedSelectedMergeMethod(m);

    var isCountMergeMethod = this.model.isCountMergeMethod(m);
    this.$('.js-count-merge-method-info').toggle(isCountMergeMethod);
    this.$('.js-right-columns').toggle(!isCountMergeMethod);
  },

  _renderMergeMethods: function($target) {
    $target.append.apply($target, this._$renderedMergeMethodViews());
  },

  _$renderedMergeMethodViews: function() {
    return _.map(this._mergeMethodViews, function(view) {
      return view.render().$el;
    });
  },

  _columnsExcludeFilter: function(column) {
    return column.get('name') === 'the_geom';
  },

  _rightTablesExcludeFilter: function(vis) {
    return vis.get('name') === this.model.get('leftTable').get('name');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../columns_selector_view":165,"../footer_view":166,"../sticky_header_view":182,"../tables_selector_view":183,"./footer_info_view":174,"./merge_method_view":176}],182:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * Sticky header, should be displayed when the key columns goes out of view
 */
module.exports = cdb.core.View.extend({

  className: 'MergeDatasets-stickyHeader',
  attributes: {
    style: 'display: none'
  },

  render: function() {
    var leftKeyColumn = this.options.leftKeyColumn;
    var rightKeyColumn = this.options.rightKeyColumn;

    this.$el.html(
      this.getTemplate('common/dialogs/merge_datasets/sticky_header')({
        leftColumnName: leftKeyColumn.get('name'),
        leftColumnType: leftKeyColumn.get('type'),
        rightColumnName: rightKeyColumn.get('name'),
        rightColumnType: rightKeyColumn.get('type'),
        addRadioPlaceholder: this.options.addRadioPlaceholder
      })
    );
    return this;
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],183:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View to select a table. extends the cdb.admin.Combo to handle the tables fetch and similar.
 */
module.exports = cdb.forms.Combo.extend({

  className: 'Select',

  initialize: function() {
    this.options.width = '100%';
    this.options.disabled = true;
    this.options.extra = [this._initialOptionDataItem() || 'Loading tables…'];
    this.options.excludeFilter = this.options.excludeFilter || function() {};

    this.elder('initialize');
    this.model = this.model || new cdb.core.Model();

    this._initVisualizations();
    this._initBinds();
    this._fetchTables();
  },

  _formatResult: function(state) {
    return JSON.stringify(state);
  },

  _initVisualizations: function() {
    // Taken from old code, cdb.admin.TableColumnSelector._getTables
    var visualizations = new cdb.admin.Visualizations();
    visualizations.options.set({
      type: 'table',
      per_page: 100000,
      table_data: false
    });
    this.model.set('visualizations', visualizations);
  },

  _initBinds: function() {
    this.bind('change', this._onChangeOption, this);

    var visualizations = this.model.get('visualizations');
    visualizations.bind('reset', this._onResetTables, this);
    this.add_related_model(visualizations);
  },

  _fetchTables: function() {
    // Taken from old code, cdb.admin.TableColumnSelector._getTables
    this.model.get('visualizations').fetch({
      data: {
        o: {
          updated_at: 'desc'
        },
        exclude_raster: true
      }
    });
  },

  _onResetTables: function() {
    this.options.disabled = false;

    var filteredVisualizations = this.model.get('visualizations').reject(this.options.excludeFilter);
    var newData = _.map(filteredVisualizations, this._visToComboDataItem, this);

    // Prepend initial item to new data, if there's one
    var initialItem = this._initialOptionDataItem();
    if (initialItem) {
      newData.unshift(initialItem);
    }
    this.updateData(newData);

    // pre-select 1st item, unless there's an initialOption
    var firstFilteredVis = filteredVisualizations[0];
    if (!initialItem && firstFilteredVis) {
      this._onChangeOption(firstFilteredVis.id);
    }
  },

  _visToComboDataItem: function(vis) {
    // required data format for an option for the cdb.admin.combo…
    return this._comboDataItem(vis.get('name'), vis.id);
  },

  _initialOptionDataItem: function() {
    if (_.isObject(this.options.initialOption)) {
      var obj = this.options.initialOption;
      // required data format for an option for the cdb.admin.combo…
      return this._comboDataItem(obj.label, obj.value);
    }
  },

  _comboDataItem: function(label, value) {
    return [label, value];
  },

  _onChangeOption: function(visId) {
    var vis = this.model.get('visualizations').get(visId);
    this.model.set('tableData', vis ? vis.get('table') : undefined);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],184:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var Pecan = require('cartodb-pecan');

module.exports = cdb.core.View.extend({

  _CARD_WIDTH: 288,
  _CARD_HEIGHT: 170,
  _TABS_PER_ROW: 3,
  _GET_BBOX_FROM_THE_GEOM: true,

  tagName: "li",
  className: "GalleryList-item MapsList-item js-card",

  events: {
    "click ": "_onClick"
  },

  initialize: function() {
    this.template = cdb.templates.getTemplate('common/dialogs/pecan/card');
  },

  render: function() {
    var src = this.options.url + "?api_key=" + this.options.api_key;

    var wizardName = this.model.get("visualizationType").charAt(0).toUpperCase() + this.model.get("visualizationType").slice(1);

    var null_count = +(this.model.get("null_ratio") * this.model.get("count")).toFixed(2);
    var prettyNullCount = Utils.formatNumber(null_count);

    this.$el.html(
      this.template({
      column: this.model.get("column"),
      wizard: wizardName,
      metadata: this.model.get("metadata"),
      null_count: prettyNullCount,
      weight: this.model.get("weight")
    }));

    if (this.model.get("visualizationType") === "choropleth") {
      this._addHistogram();
    }

    var self = this;
    var img = new Image();
    img.onerror = function() {
      cdb.log.info("error loading the image for " + self.model.get("column"));
    };
    img.onload = function() {
      self.$(".js-loader").hide();
      self.$(".js-header").append('<img class="MapCard-preview" src="' + src + '" />');
      self.$("img").show();
    };

    img.src = src;

    return this;
  },

  _onClick: function(e) {
    this.killEvent(e);
    this.trigger("click", this.model, this);
  },

  _addHistogram: function() {
    var data = this.model.get("cat_hist").slice(0, 7);
    data = _.sortBy(data, function(d){ return d[0]; });
    var rampName = Pecan.getMethodProperties(this.model.attributes).name;

    var width = 37;
    var height = 11;
    var minHeight = 2;

    var x = d3.scale.ordinal()
        .rangeRoundBands([0, width], .1);

    var y = d3.scale.linear()
        .range([height, 0]);

    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");

    var svg = d3.select(this.$(".js-graph")[0]).append("svg")
        .attr("width", width)
        .attr("height", height)
      .append("g");

    x.domain(data.map(function(d) { return d[0]; }));
    y.domain([0, d3.max(data, function(d) { return d[1]; })]);

    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

    svg.selectAll(".bar")
        .data(data)
      .enter().append("rect")
        .attr("fill", function(d, i) {
          return cdb.admin.color_ramps[rampName][7][i];
        })
        .attr("class", "HistogramGraph-bar")
        .attr('data-title', function(d) {
          return Utils.formatNumber(d[1])
        })
        .attr("x", function(d) { return x(d[0]); })
        .attr("width", 4)
        .attr("y", function(d) {
          var value = height - y(d[1]);
          var yPos = y(d[1]);
          return value < minHeight ? (height - minHeight) : yPos;
        })
        .attr("height", function(d) {
          var value = height - y(d[1]);
          return value < minHeight ? minHeight : value;
        })

    return this;
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"cartodb-pecan":233}],185:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var Pecan = require('cartodb-pecan');
var BaseDialog = require('../../views/base_dialog/view');
var ViewFactory = require('../../view_factory');
var randomQuote = require('../../view_helpers/random_quote');
var PecanCard = require('./pecan_card');

module.exports = BaseDialog.extend({

  _CARD_MARGIN: 20,
  _CARD_WIDTH: 288,
  _CARD_HEIGHT: 170,
  _STROKE_PX_LIMIT: 0.04,
  _TABS_PER_ROW: 3,
  _GET_BBOX_FROM_THE_GEOM: true,
  _DEFAULT_BASEMAP_TEMPLATE: "http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",
  _SUPPORTED_BASEMAPS: ["light_all", "dark_all", "light_nolabels", "dark_nolabels", "base-antique", "base-flatblue", "toner", "watercolor"],

  events: BaseDialog.extendEvents({
    "click .js-goPrev": "_prevPage",
    "click .js-goNext": "_nextPage",
    "click .js-skip"  : "cancel"
  }),

  initialize: function() {
    this.elder('initialize');

    if (!this.options.vis) {
      throw new Error('vis is required');
    }

    if (!this.options.user) {
      throw new Error('user is required');
    }

    this.columns = this.options.collection;
    this.add_related_model(this.collection);

    this._initModels();
    this._initViews();
    this._initBinds();
  },

  render_content: function() {
    return this._panes.getActivePane().render().el;
  },

  render: function() {
    BaseDialog.prototype.render.apply(this, arguments);
    return this;
  },

  _initModels: function() {
    this.model = new cdb.core.Model({ page: 1, maxPages: 0 });
  },

  _initViews: function() {

    _.bindAll(this, "_addCard", "_generateThumbnail", "_refreshMapList", "_setWizardProperties");

    this.vis   = this.options.vis;
    this.map   = this.vis.map;
    this.user  = this.options.user;

    this._panes = new cdb.ui.common.TabPane({
      el: this.el
    });

    this.addView(this._panes);

    this._panes.addTab('vis',
      ViewFactory.createByTemplate('common/dialogs/pecan/template', {
      })
    );

    this._panes.addTab('applying',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Applying style…',
        quote: randomQuote()
      })
    );

    this._panes.addTab('loading',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Loading previews…',
        quote: randomQuote()
      })
    );

    this._getBBox();
    this._sendOpenStats();
    this._loadCards();

  },

  _initBinds: function() {
    this.model.bind('change:page', this._moveTabsNavigation, this);
    this._panes.bind('tabEnabled', this.render, this);
  },

  _getBBox: function() {
    this.columns.each(function(column) {
      if (column.get("column") === "the_geom") {
        this.bbox = column.get("bbox");
      }
    }, this);
  },

  _loadCards: function() {
    this.columns.each(this._loadCard, this);
  },

  _loadCard: function(column) {
    var self = this;

    if (column.get("success")) {
      this._generateThumbnail(column, function(error, url) {
        if (!error) {
          self._addCard(url, column);
        } else {
          cdb.log.error(error);
        }
      });
    }
  },

  _sendAppliedStats: function() {
    cdb.god.trigger('metrics', 'applied_pecan', {
      email: window.user_data.email
    });
  },

  _sendOpenStats: function() {
    cdb.god.trigger('metrics', 'open_pecan_list', {
      email: window.user_data.email
    });
  },

  _skip: function() {
    var layerID = this.vis.get("active_layer_id");
    var name;
    var activeLayer  = this.vis.map.layers.where({ id: layerID });

    if (activeLayer) {
      name = activeLayer[0].table.get("name");
    }

    var skipPencanDialog = 'pecan_' + this.options.user.get("username") + "_" + name;
    localStorage[skipPencanDialog] = true;
  },

  _nextPage: function() {
    var page = this.model.get('page');
    var maxPages = this.model.get('maxPages');

    if (page < maxPages) {
      this.model.set('page', page + 1);
    }
  },

  _prevPage: function() {
    var page = this.model.get('page');
    if (page > 1) {
      this.model.set('page', page - 1);
    }
  },

  _moveTabsNavigation: function() {
    var page = this.model.get('page');
    var rowWidth = 960;

    var p = rowWidth * (page - 1);
    this.$('.js-map-list').css('margin-left', '-' + p + 'px');
    this._refreshNavigation();
  },

  _refreshNavigation: function() {
    var page = this.model.get('page');
    var maxPages = this.model.get('maxPages');

    this.$('.js-goPrev')[ page > 1 ? 'removeClass' : 'addClass' ]('is-disabled');
    this.$('.js-goNext')[ page < maxPages ? 'removeClass' : 'addClass' ]('is-disabled');
  },

  _hideNavigation: function() {
    this.$('.js-navigation').addClass("is-hidden");
  },

  _setupCSS: function(css, geometryType) {
    var row_count = this.options.vis.tableMetadata().get("row_count");
    var removeStrokeIndex = row_count / (this._CARD_WIDTH * this._CARD_HEIGHT);
    var removeStroke = (removeStrokeIndex > this._STROKE_PX_LIMIT);

    if (geometryType !== "line" && removeStroke) {
      css = css.replace("marker-line-width: 1;", "marker-line-width: 0.7;");
      css = css.replace("marker-width: 10;", "marker-width: 7;");
    }

    return css;
  },

  _setupTemplate: function() {
    var template = this.map.getLayerAt(0).get("urlTemplate");

    if (template) {
      var supportedBasemap = _.find(this._SUPPORTED_BASEMAPS, function(basemap) {
        return template.indexOf(basemap) !== -1
      });
    }

    if (!template || !supportedBasemap) {
      template = this._DEFAULT_BASEMAP_TEMPLATE;
    }

    return template;
  },

  _generateLayerDefinition: function(column) {

    var type = column.get("visualizationType");
    var sql = column.get("sql");
    var css = this._setupCSS(column.get("css"), column.get("geometryType"));

    var api_key  = this.user.get("api_key");
    var maps_api_template = cdb.config.get('maps_api_template');

    var template = this._setupTemplate();

    var layerDefinition = {
      user_name: user_data.username,
      maps_api_template: maps_api_template,
      api_key: api_key,
      layers: [{
        type: "http",
        options: {
          urlTemplate: template,
          subdomains: [ "a", "b", "c" ]
        }
      }, {
        type: "cartodb",
        options: {
          sql: sql,
          cartocss: css,
          cartocss_version: "2.1.1"
        }
      }]
    };

    if (type === "torque" || type === "heatmap"){
      layerDefinition.layers[1] = {
        type: "torque",
        options: {
          sql: sql,
          cartocss: css,
          cartocss_version: "2.1.1"
        }
      }
    }

    return layerDefinition;
  },

  _generateThumbnail: function(column, callback) {

    var layerDefinition = this._generateLayerDefinition(column);

    var onImageReady = function(error, url) {
      callback && callback(error, url);
    };

    var the_geom = this.columns.find(function(column) {
      return column.get("column") === 'the_geom'
    });

    if (this.bbox && this._GET_BBOX_FROM_THE_GEOM) {
      cdb.Image(layerDefinition).size(this._CARD_WIDTH, this._CARD_HEIGHT).bbox(this.bbox).getUrl(onImageReady);
    } else {
      cdb.Image(layerDefinition).size(this._CARD_WIDTH, this._CARD_HEIGHT).zoom(this.map.get("zoom")).center(this.map.get("center")).getUrl(onImageReady);
    }

  },

  _addCard: function(url, column) {

    var card = new PecanCard({
      url: url,
      urlTemplate: this.map.getLayerAt(0).get("urlTemplate"),
      api_key: this.user.get("api_key"),
      model: column
    });

    card.bind("click", this._onCardClick, this);
    card.render();

    this._panes.active('vis');

    if (this._getSuccessColumns().length < 3) {
      this.$(".js-map-list").addClass("is--centered");
    }

    if (column.get("visualizationType") === 'heatmap' || column.get("visualizationType") === 'torque') {
      this.$(".js-map-list").prepend(card.$el);
    } else {
      this.$(".js-map-list").append(card.$el);
    }

    this._refreshMapList(card.$el);
    this._refreshNavigation();
  },

  _refreshMapList: function($el) {
    var w = $el.width();
    var l = this.$(".js-card").length;
    this.$(".js-map-list").width(w * l + (l - 1) * this._CARD_MARGIN);
    this.model.set('maxPages', Math.ceil(this.$('.js-card').size() / this._TABS_PER_ROW));
  },

  _getSuccessColumns: function() {
    return this.columns.filter(function(c) { return c.get("success")});
  },

  _bindDataLayer: function() {
    this.layer.wizard_properties.unbind("load", this._setWizardProperties, this);
    this.layer.wizard_properties.bind("load", this._setWizardProperties, this);
  },

  _getProperties: function(column) {

    var property = column.get("column");
    var wizard = this._getWizardName(column.get("visualizationType"));

    var properties = { property: property };

    if (wizard === "category") {
      return this._getCategoriesProperties(properties);
    } else if (wizard === 'choropleth') {
      return this._getChoroplethProperties(properties);
    } else if(wizard === "heatmap") {
      return this._getHeatmapProperties(properties);
    }

  },

  _onCardClick: function(column) {
    this._panes.active('applying');
    this.model.set("column", column);

    this._skip();

    this.layer = this._getDataLayer();

    this._sendAppliedStats();

    var wizard = this._getWizardName(column.get("visualizationType"));
    var properties = this._getProperties(column);

    this._bindDataLayer();
    this.layer.wizard_properties.active(wizard, properties);
  },

  _getWizardName: function(name){
    var mappings = {"heatmap": "torque_heat"};
    return mappings[name] || name;
  },

  _getDataLayer: function() {
    return this.map.layers.getDataLayers()[0];
  },

  _setWizardProperties: function() { // TODO: hack, we should find a way to remove this
    var properties = this._getProperties(this.model.get("column"));
    this.layer.wizard_properties.unbind("load", this._setWizardProperties, this);
    if (properties) {
      this.layer.wizard_properties.set(properties);
    }
    this.close();
  },

  _getChoroplethProperties: function(properties) {
    var column = this.model.get("column");

    var property = column.get("column");
    var type     = column.get("type");
    var dist     = column.get("dist_type");
    var stats    = column.get("stats");

    properties.qfunction  = this._getQFunction(dist);
    properties.color_ramp = Pecan.getMethodProperties(stats).name;

    return properties;
  },

  _getCategoriesProperties: function(properties) {
    var column = this.model.get("column");
    properties.metadata   = column.get("metadata");
    properties.categories = column.get("metadata");
    return properties;
  },

  _getHeatmapProperties: function(properties){
    properties.property = "cartodb_id";
    properties["torque-resolution"] = 2;
    return properties;
  },

  _getQFunction: function(dist) {
    var qfunction = "Jenks";

    if (dist === 'L' || dist == 'J') {
      qfunction = "Heads/Tails";
    } else if (dist === 'A' || dist == 'U') {
      qfunction = "Jenks";
    } else if (dist === 'F') {
      qfunction = "Quantile"; // we could use 'Equal Interval' too
    }
    return qfunction;
  },

  _keydown: function(e) {
    if (e.keyCode === $.ui.keyCode.LEFT) {
      this._prevPage();
    } else if (e.keyCode === $.ui.keyCode.RIGHT) {
      this._nextPage();
    }
    BaseDialog.prototype._keydown.call(this, e);
  },

  clean: function() {
    if (this.layer) {
      this.layer.wizard_properties.unbind("load", this._setWizardProperties, this);
    }

    BaseDialog.prototype.clean.call(this);
  },

  cancel: function(e) {
    this.killEvent(e);
    this.model.set('disabled', true);
    this._skip();
    this.elder('cancel');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213,"./pecan_card":184,"cartodb-pecan":233}],186:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var ViewFactory = require('../../view_factory');
var randomQuote = require('../../view_helpers/random_quote');

module.exports = cdb.core.View.extend({

  _MAX_ROWS: 100000,
  _MAX_COLS: 60,
  _EXCLUDED_COLUMNS: [
    'cartodb_id', 'lat', 'lon', 'lng', 'long', 'latitude', 'longitude', 'longitudenumber','latitudenumber', 
    'minlat', 'maxlat', 'minlon', 'maxlon', 'minlng', 'maxlng', 'center_lat', 'centerlat', 'center_lon', 'centerlon',
    'latdd', 'longdd', 'shape_length', 'shape_area', 'objectid', 'id', 'created_at', 'updated_at',
    'iso2', 'iso3', 'x', 'y', 'x_coord', 'y_coord', 'xcoord', 'ycoord', 'coord_x', 'coord_y', 'coordx', 'coordy', 
    'cartodb_georef_status','scalerank', 'strokweig', 'country', 'state', 'area_sqkm', 'region', 'subregion', 'funcstat',
    'classfp', 'county_fip', 'county', 'aland10'
  ],

  initialize: function() {
    this.elder('initialize');

    if (!this.options.table) {
      throw new Error('table is required');
    }

    this._initModels();
    this._initViews();
  },

  _check: function() {

    var isGeoreferenced = this.options.table.isGeoreferenced();

    var tableData     = this.options.table.data();
    var geometryTypes = tableData.table && tableData.table.get("geometry_types");
    var hasGeometries = geometryTypes && geometryTypes.length > 0 ? true : false;

    var row_count     = tableData.table.get("rows_counted");
    var hasRows       = row_count > 0 && row_count < this._MAX_ROWS;

    var col_count = _(this.query_schema).size();
    var hasColumns = col_count > 0 && col_count < this._MAX_COLS;

    return isGeoreferenced && hasGeometries && hasRows && hasColumns;
  },

  _initModels: function() {
    this.columns = new Backbone.Collection();
    this.model = new cdb.core.Model({ page: 1, maxPages: 0 });
  },

  _initViews: function() {

    this.table = this.options.table;
    this.query_schema = this.table.data().query_schema;
    this.backgroundPollingModel = this.options.backgroundPollingModel;

    if (this._check() && this.backgroundPollingModel.canAddAnalysis()) {
      this._setupColumns();
      this._start();
    }
  },

  _getSimplifiedGeometryType: function(g) {
    return {
      st_multipolygon: 'polygon',
      st_polygon: 'polygon',
      st_multilinestring: 'line',
      st_linestring: 'line',
      st_multipoint: 'point',
      st_point: 'point'
    }[g.toLowerCase()];
  },

  _getGeometryType: function() {
    var geometryTypes = this.table.data().table.get("geometry_types");
    return this._getSimplifiedGeometryType(geometryTypes[0]);
  },

  _start: function() {
    var columns = this.columns.map(function(column) {
      return { table_id: this.table.id, column: column.get("name"), geometry_type: column.get("geometry_type") };
    }, this);

    this.backgroundPollingModel.addAnalysis(columns);
  },

  _setupColumns: function() {
    _(this.query_schema).each(function(type, name) {
      if (!_.include(this._EXCLUDED_COLUMNS, name)) {
        this.columns.add({ name: name.concat(""), geometry_type: this._getGeometryType() });
      }
    }, this);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213}],187:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View model for an option that may be disabled due to Vis' privacy being set to private.
 */
module.exports = cdb.core.Model.extend({

  isDisabled: function() {
    return this.get('isPrivacyPrivate');
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],188:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * View to handle the visual representation of a publish option.
 */
module.exports = cdb.core.View.extend({

  className: 'OptionCard OptionCard--static',

  events: {
    'click input': '_onClickInput'
  },

  initialize: function() {
    this.elder('initialize');
    this._template = cdb.templates.getTemplate(this.model.get('template'));
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();

    this.$el.html(
      this._template({
        model: this.model
      })
    );
    this.$el.toggleClass('is-disabled', !!this.model.isDisabled());

    return this;
  },

  _initBinds: function() {
    this.model.bind('change', this.render, this);
  },

  _onClickInput: function(ev) {
    this.killEvent(ev);
    this.$('input').select();
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],189:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var OptionView = require('./publish_option_view');
var ViewModel = require('./options/view_model');

/**
 * Delete items dialog
 */
module.exports = BaseDialog.extend({

  events: function() {
    return _.extend({}, BaseDialog.prototype.events, {
      'click .js-change-privacy': '_openPrivacyDialog'
    });
  },

  initialize: function() {
    this.elder('initialize');
    if (!this.model) throw new Error('model (vis) is required');
    if (!this.options.user) throw new Error('user is required');
    this._initOptions();
    this._initBinds();
  },

  /**
   * @implements cdb.ui.common.Dialog.prototype.render_content
   */
  render_content: function() {
    this.clearSubViews();

    var $el = $(
      cdb.templates.getTemplate('common/dialogs/publish/publish')({
      })
    );

    this._options.each(function(model) {
      var view = new OptionView({
        model: model
      });
      this.addView(view);
      $el.find('.js-publish-options').append(view.render().el);
    }, this);

    // Event tracking "Published visualization"
    cdb.god.trigger('metrics', 'published_visualization', {
      email: window.user_data.email
    });

    return $el;
  },

  _initOptions: function() {
    // Public URL option
    this._options = new Backbone.Collection();
    this._publicUrlOption = new ViewModel({
      template: 'common/dialogs/publish/options/public_url'
    });
    this._options.add(this._publicUrlOption);

    // Embed option
    this._embedOption = new ViewModel({
      template: 'common/dialogs/publish/options/embed',
      embedURL: this.model.embedURL()
    });
    this._options.add(this._embedOption);

    // CartoDB.js option
    this._options.add(
      new ViewModel({
        template: 'common/dialogs/publish/options/cdb',
        vizjsonURL: this.model.vizjsonURL()
      })
    );

    this._updateOptionsWithNewPrivacy();
  },

  _updateOptionsWithNewPrivacy: function() {
    var isPrivate = this.model.get('privacy') === 'PRIVATE';

    this._publicUrlOption.set('isPrivacyPrivate', isPrivate);
    this._embedOption.set('isPrivacyPrivate', isPrivate);

    if (!isPrivate) {
      var publicURL = this.model.publicURL();
      this._publicUrlOption.set({
        url: publicURL
      });
    }
  },

  _initBinds: function() {
    this.model.bind('change:privacy', this._updateOptionsWithNewPrivacy, this);
  },

  _openPrivacyDialog: function(e) {
    this.killEvent(e);

    var privacyModal = new cdb.editor.ChangePrivacyView({
      vis: this.model, //vis
      user: this.options.user,
      clean_on_hide: true,
      enter_to_confirm: true
    });

    // Do not remove this dialog but keep it until returning
    var originalCleanOnHideValue = this.options.clean_on_hide;
    this.options.clean_on_hide = false;
    this.close();
    privacyModal.appendToBody();

    // Return to this view when done
    var self = this;
    var onClose = function() {
      privacyModal.unbind('hide', onClose);
      self.options.clean_on_hide = originalCleanOnHideValue;
      self.show();
      privacyModal.close();
    };
    privacyModal.bind('hide', onClose);
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../views/base_dialog/view":213,"./options/view_model":187,"./publish_option_view":188}],190:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var ViewFactory = require('../../view_factory');
var randomQuote = require('../../view_helpers/random_quote');
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);

module.exports = BaseDialog.extend({

  _FORMAT: 'png',

  events: BaseDialog.extendEvents({
    'click .js-format': '_onClickFormat',
    'keyup .js-textInput': '_onKeyUp',
    'focus .js-textInput': '_onFocus',
    'blur .js-textInput': '_onBlur'
  }),

  initialize: function() {
    this.elder('initialize');

    this.options = _.defaults(this.options, { format: this._FORMAT });
    this.model = new cdb.core.Model(this.options);
    this.mapView = this.options.mapView;
    this._initBinds();
  },

  render_content: function() {
    return this.getTemplate('common/dialogs/static_image/advanced_export_view')(this.model.attributes);
  },

  _initBinds: function() {
    this.model.on('change:format', this._onChangeFormat, this);
  },

  _onKeyUp: function(e) {
    var value = +$(e.target).val();
    $(e.target).parent().toggleClass('has-error', !(_.isNumber(value) && value > 10));
  },

  _onFocus: function(e) {
    $(e.target).parent().addClass('is-focused');
  },

  _onBlur: function(e) {
    $(e.target).parent().removeClass('is-focused');
  },

  _onChangeFormat: function() {
    this.$('.js-radioButton').removeClass('is-checked');
    this.$('.js-' + this.model.get('format')).addClass('is-checked');
  },

  _onClickFormat: function(e) {
    this.killEvent(e);
    var $el = $(e.target).closest('.js-format');
    this.model.set('format', $el.data('format'));
  },

  _getBounds: function() {
    var nw = this.mapView.pixelToLatLon([this.options.x + this.options.width, this.options.y]);
    var sw = this.mapView.pixelToLatLon([this.options.x, this.options.y + this.options.height]);
    return [[sw.lat, sw.lng], [nw.lat, nw.lng]];
  },

  _ok: function() {
    var width = +this.$('.js-width').val();
    var height = +this.$('.js-height').val();
    var format = this.model.get('format');
    var bounds = this._getBounds();

    this.trigger('generate_image', { width: width, height: height, bounds: bounds, format: format });
    this.close();
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213}],191:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var ViewFactory = require('../../view_factory');
var randomQuote = require('../../view_helpers/random_quote');
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);

module.exports = BaseDialog.extend({

  events: BaseDialog.extendEvents({
    'click .js-input': '_onInputClick',
    'click .js-open-image': 'close'
  }),

  initialize: function() {
    this.elder('initialize');
    this._initViews();
    this._initBinds();
  },

  render_content: function() {
    return this._panes.getActivePane().render().el;
  },

  _initViews: function() {
    this.vis = this.options.vis;
    this.user = this.options.user;
    this.column = this.options.column;

    this._panes = new cdb.ui.common.TabPane({
      el: this.el
    });

    this.addView(this._panes);

    this._panes.addTab('loading',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Generating image',
        quote: randomQuote()
      })
    );
    this._panes.addTab('fail',
      ViewFactory.createByTemplate('common/templates/fail', {
        msg: 'Could not generate image'
      })
    );

    this._panes.active('loading');
  },

  loadURL: function(url) {
    this._showResult({ displayedLink: url, filename: url, content: url, type: 'url' });
  },

  _generateImageFilename: function() {
    var filename = (this.vis.get('name') + ' by ' + this.user.nameOrUsername() + ' ' + moment(new Date()).format('MM DD YYYY hh mm ss'));
    return filename.replace(/ /g, '_').toLowerCase();
  },

  generateImage: function(url) {
    var callback = function(url) {
      var filename = this._generateImageFilename();
      this._showResult({
        content: url,
        type: 'url',
        displayedLink: filename + '.' + this.options.format,
        filename: filename
      });
    };

    if (cdb.config.get('static_image_upload_endpoint')) {
      callback = this._exportImage;
    }

    this._loadMapImage(url, callback.bind(this));
  },

  _showResult: function(options) {
    this._panes.addTab('result',
      ViewFactory.createByTemplate('common/dialogs/static_image/export_image_result_view', {
        column: this.column,
        response: options
      })
    );
    this._panes.active('result');
    this.trigger('finish', this);
  },

  _initBinds: function() {
    this._panes.bind('tabEnabled', this.render, this);
  },

  /* Load first the map image and then merge with the overlays rendered frontend side */
  _loadMapImage: function(url, callback) {
    var self = this;
    var mapImage = new Image();
    mapImage.crossOrigin = 'Anonymous';
    mapImage.onload = function() {
      self._mergeAnnotations(mapImage, callback);
    };
    mapImage.src = url;
  },

  _exportImage: function(base64Image) {
    var self = this;
    var vis = this.options.vis;
    // in case a image uploading endpoint is set post the image url there
    // and show the html payload to the user
    $.ajax({
      type: 'POST',
      url: cdb.config.get('static_image_upload_endpoint'),
      data: {
        base64image: base64Image,
        name: vis.get('name'),
        visualization_uuid: vis.get('id'),
        description: vis.get('description')
      },
      success: function(content) {
        self._showResult({ content: content, type: 'html' });
      },
      error: function(error) {
        cdb.editor.ViewFactory.createDialogByTemplate('common/templates/fail', { msg: error.errors })
        .render().appendToBody();
      }
    });
  },

  _mergeAnnotations: function(mapImage, callback) {
    var x = this.options.x;
    var y = this.options.y;
    var width = this.options.width;
    var height = this.options.height;
    var format = this.options.format;

    if (format === 'jpg') {
      format = 'jpeg';
    }

    var imageProxyURL = cdb.config.get('url_prefix') + '/api/v1/image_proxy';

    html2canvas($('.cartodb-map')[0], {
      allowTaint: false, // don't allow non cors images taint the canvas
      taintTest: true,
      // useCORS: true,
      proxy: {
        url: imageProxyURL,
        api_key: this.options.user.get('api_key')
      },
      background: undefined, // for transparent
      // this function is called from html2canvas before the screenshot is taken
      // first parameter is a clone of the current DOM
      onclone: function(clonedDom) {
        var doc = $(clonedDom);
        // remove all the elements but annontations, text and image
        // if other elements are present it's likely you get a tainted canvas because
        // images not loaded with cors enabled
        doc.find('.cartodb-map > div:not(.annotation, .text, .image, .ExportImageView)').remove();
        doc.find('.ExportImageView').addClass('is-exportable');
        // default background color for leaflet is gray, set to transparent so the image
        // can be rendered on top of map image
        doc.find('.cartodb-map').css('background-color', 'transparent');
        return true;
      },
      onrendered: function(overlaysCanvas) {
        var finalCanvas = document.createElement('canvas');
        finalCanvas.width = width;
        finalCanvas.height = height;
        var ctx = finalCanvas.getContext('2d');
        // map image alread has the final image size so render from the top,left
        ctx.drawImage(mapImage, 0, 0);
        // overlay canvas renders the full map size so crop it
        ctx.drawImage(overlaysCanvas, x, y, width, height, 0, 0, width, height);
        callback(finalCanvas.toDataURL('image/' + format));
      }
    });
  },

  ok: function() {
    this.close();
  },

  _onInputClick: function(e) {
    $(e.target).focus().select();
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213}],192:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * Sync interval
 */
module.exports = cdb.core.View.extend({

  tagName: "li",

  className: "Modal-listFormItem",

  events: {
    "click": "_onClick"
  },

  initialize: function() {
    this._setupModel();
    this._template = cdb.templates.getTemplate('common/dialogs/sync_dataset/interval_template');
    this._initBinds();
  },

  render: function() {
    this.clearSubViews();
    this.$el.html(this._template(this.model.attributes));
    return this;
  },

  _initBinds: function() {
    this.model.bind('change:checked', this._onToggleChecked, this);
  },

  _setupModel: function() {
    this.model = this.options.model;
    this.model.set('id', this.cid);
  },

  _onClick: function(e) {
    this.killEvent(e);

    if (!this.model.get("disabled")) {
      this.model.set("checked", true);
      this.trigger("checked", this.model, this);
    }
  },

  _onToggleChecked: function() {
    this.render();
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],193:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var Backbone = (typeof window !== "undefined" ? window['Backbone'] : typeof global !== "undefined" ? global['Backbone'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('../../views/base_dialog/view');
var IntervalView = require('./interval_view');
var randomQuote = require('../../view_helpers/random_quote');

/**
 * Sync modal
 */
module.exports = BaseDialog.extend({

  _INTERVALS: [
    { name: 'Every hour', time: 60 * 60, type: 'hourly', if_external_source: false },
    { name: 'Every day', time: 60 * 60 * 24, type: 'daily', if_external_source: false },
    { name: 'Every week', time: 60 * 60 * 24 * 7, type: 'weekly', if_external_source: false },
    { name: 'Every month', time: 60 * 60 * 24 * 30, type: 'monthly', if_external_source: true },
    { name: 'Never', time: 0, type: 'never', if_external_source: true }
  ],

  events: {
    'click .js-cancel': '_cancel',
    'click .js-confirm': '_ok'
  },

  initialize: function() {
    if (!this.options.table) {
      throw new TypeError('table is required');
    }
    this.elder('initialize');

    this.model = new cdb.core.Model({
      option: 'interval',
      state: 'prefetching',
      wait: true // await ack before changing model
    });
    this.table = this.options.table;

    this._initBinds();

    // Prefetch
    this.table.fetch({
      success: this._onFetchedTable.bind(this),
      error: this._setterForDefaultErrorState()
    });
  },

  _initBinds: function() {
    this.model.bind('change:state', this.render, this);
  },

  // implements cdb.ui.common.Dialog.prototype.render
  render: function() {
    this.clearSubViews();
    BaseDialog.prototype.render.call(this);
    this._initIntervals();
    return this;
  },

  // implements cdb.ui.common.Dialog.prototype.render
  render_content: function() {
    switch (this.model.get('state')) {
      case 'prefetching':
        return this._renderLoading('Checking synchronization');
      case 'error':
        return this.getTemplate('common/templates/fail')({ msg: '' });
      case 'saving':
        return this._renderLoading('Saving…');
      default:
        return this.getTemplate('common/dialogs/sync_dataset/sync_dataset')({
          service: this._serviceName(),
          url: this._serviceURL()
        });
    }
  },

  _onFetchedTable: function() {
    this.model.set({
      state: 'idle',
      interval: this.table.synchronization.get('interval')
    });
  },

  _renderLoading: function(title) {
    return this.getTemplate('common/templates/loading')({
      title: title,
      quote: randomQuote()
    });
  },

  _serviceURL: function() {
    // Does it come from a datasource service (Dropbox, GDrive, ...)?
    if (this.table.synchronization.get('service_name') || this.table.synchronization.get('service_item_id')) {
      return this.table.synchronization.get('service_item_id');
    }
    return this.table.synchronization.get('url');
  },

  _serviceName: function() {
    var name = this.table.synchronization.get('service_name');
    if (name && _.isString(name)) {
      return cdb.Utils.capitalize(name);
    }
  },

  _initIntervals: function() {
    this._intervals = new Backbone.Collection();

    var fromExternalSource = this.table.synchronization.from_external_source;

    _.each(this._INTERVALS, function(interval) {
      var disabled = fromExternalSource && !interval.if_external_source;

      this._intervals.add({
        name: interval.name,
        interval: interval.time,
        checked: this.table.synchronization.get("interval") === interval.time,
        disabled: disabled
      });
    }, this);

    this._intervals.each(function(interval) {
      var view = new IntervalView({ model: interval });
      view.bind("checked", this._onIntervalChecked, this);
      this.$(".js-intervals").append(view.render().$el);
      this.addView(view);
    }, this);
  },

  _onIntervalChecked: function(interval) {
    this._intervals.each(function(i) {
      if (interval.get("interval") !== i.get("interval")) {
        i.set("checked", false);
      }
    }, this);
  },

  _getSelectedInterval: function() {
    return this._intervals.find(function(interval) {
      return interval.get("checked")
    });
  },

  _addTab: function(name, view) {
    this._contentPane.addTab(name, view.render());
    this.addView(view);
  },

  ok: function() {
    var selectedInterval = this._getSelectedInterval();

    if (selectedInterval) {
      this.model.set('state', 'saving');
      var callbacks = {
        success: this.close.bind(this),
        error: this._setterForDefaultErrorState()
      };

      var interval = selectedInterval.get('interval');
      if (interval) {
        this.table.synchronization.save({
          interval: interval
        }, callbacks);
      } else {
        this.table.synchronization.destroy(callbacks);
      }
    } else {
      this.close();
    }
  },

  _setterForDefaultErrorState: function() {
    return this.model.set.bind(this.model, 'state', 'error');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_helpers/random_quote":212,"../../views/base_dialog/view":213,"./interval_view":192}],194:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var EditFieldView = require('../edit_field_view');
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 *  Boolean field
 *  
 *  Choosing between true, false or null
 *
 *  new BooleanFieldView({
 *    model: new EditFieldModel({ attribute: 'column', value: 'paco' }),
 *    option: false
 *  })
 */

module.exports = EditFieldView.extend({

  options: {
    template: 'common/edit_fields/boolean_field/boolean_field'
  },

  events: {
    'click .js-true': '_onTrueClick',
    'click .js-false': '_onFalseClick',
    'click .js-null': '_onNullClick'
  },

  _initBinds: function() {
    this.model.bind('change', this.render, this);
  },

  _onTrueClick: function() {
    this.model.set('value', true);
  },

  _onFalseClick: function() {
    this.model.set('value', false);
  },

  _onNullClick: function() {
    this.model.set('value', null);
  }

})

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../edit_field_view":200}],195:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var EditFieldView = require('../edit_field_view');
var DatePickerView = require('./date_picker/date_picker_view');
var TimeInputView = require('./time_input/time_input_view');
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 *  Date field
 *  
 *  Place to change a date value
 *
 *  new DateFieldView({
 *    model: new EditFieldModel({ type: 'date', attribute: 'column', value: 'paco' }),
 *    option: false
 *  })
 */

module.exports = EditFieldView.extend({

  className: 'EditField EditField--withBorder EditField--withSeparator',

  options: {
    showTime: true,
    showGMT: false,
    timezone: 'Z' // In PostgreSQL 'Z' is the same as +00:00
  },

  render: function() {
    this.clearSubViews();
    this._initViews();
    return this;
  },

  _initViews: function() {
    // Date picker
    this.datePicker = new DatePickerView({
      model: this.model
    });

    this.datePicker.bind('onDateChange', this._setDate, this);
    this.$el.append(this.datePicker.render().el);
    this.addView(this.datePicker);
     
    // Time input
    if (this.options.showTime) {
      this.timeInput = new TimeInputView({
        model: this.model
      });

      this.$el.append(this.timeInput.render().el);
      this.timeInput.bind('onTimeChange', this._setTime, this);
      this.timeInput.bind('onSubmit', function() {
        this.trigger('onSubmit', this.model, this);
      }, this);
      this.addView(this.timeInput);
    }
  },

  _setTime: function(time) {
    var oldDate = moment(this.model.get('value'));
    var newDate = moment(new Date());
    var date;

    if (oldDate.isValid()) {
      oldDate
        .hour(newDate.hour())
        .minutes(newDate.minutes())
        .seconds(newDate.seconds());
      date = oldDate.format('YYYY-MM-DDT');
    } else {
      date = newDate.format('YYYY-MM-DDT');
    }

    this.model.set('value', date + time + this.options.timezone);
  },

  _setDate: function(date) {
    var oldDate = moment(this.model.get('value'));
    var newDate = moment(date);
    var dateStr;

    if (oldDate.isValid()) {
      oldDate
        .month(newDate.month())
        .date(newDate.date())
        .year(newDate.year());
      dateStr = oldDate.format('YYYY-MM-DDTHH:mm:ss');
    } else {
      dateStr = newDate.format('YYYY-MM-DDTHH:mm:ss');
    }

    this.model.set('value', dateStr + this.options.timezone);
  }

})

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../edit_field_view":200,"./date_picker/date_picker_view":197,"./time_input/time_input_view":198}],196:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);

/**
 * Dropdown for a calendar selector.
 * Uses the DatePicker plugin internally to render the calendar and view behaviour.
 */

module.exports = cdb.admin.DropdownMenu.extend({

  className: 'Dropdown',

  // defaults, used for
  options: {
    flat: true,
    date: '2008-07-01',
    current: '2008-07-31',
    calendars: 1,
    starts: 1
  },

  initialize: function() {
    if (!this.model) throw new Error('model is required');
    this.elder('initialize');
    this.template = cdb.templates.getTemplate('common/edit_fields/date_field/date_picker/calendar_dropdown');
    this._initDefaults();
  },

  render: function() {
    this.$el.html(
      this.template({
        initialDateStr: moment(this.model.get('value')).format('YYYY-MM-DD')
      })
    );

    cdb.god.bind('closeDialogs', this.hide, this);
    $('body').append(this.el);
    this._initCalendar(); // must be called after element is added to body!

    return this;
  },

  clean: function() {
    this._$calendar().DatePickerHide();
    cdb.admin.DropdownMenu.prototype.clean.call(this);
  },

  _initDefaults: function() {
    var utc = new Date().getTimezoneOffset();
    var today = moment(new Date()).utcOffset(utc).format('YYYY-MM-DD');
    this.options.date = this.model.get('value') && moment(this.model.get('value')).format('YYYY-MM-DD') || today;
    this.options.current = this.options.date;
  },

  // should not be called until element is located in document
  _initCalendar: function() {
    var self = this;
    this._$calendar().DatePicker(
      _.extend(this.options, this.model.attributes, {
        onChange: function(formatted, date) {
          self.trigger('onDateSelected', date, this);
          self.hide();
        }
      })
    );
  },

  _$calendar: function() {
    return this.$('.js-calendar');
  }

});


}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],197:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);
var CalendarDropdown = require('./calendar_dropdown_view.js');

/**
 * Date picker for a single date.
 */
module.exports = cdb.admin.DropdownMenu.extend({

  className: 'DatePicker',

  events: {
    'click .js-date-picker': '_onClickDateBtn'
  },

  options: {
    vertical_position: 'down',
    tick: 'center',
    dateFormat: 'YYYY-MM-DD'
  },

  initialize: function() {
    this.elder('initialize');
    this._initBinds();
  },

  render: function() {
    var date = this.model.get('value') || new Date();

    this.$el.html(
      cdb.templates.getTemplate('common/edit_fields/date_field/date_picker/date_picker')({
        readOnly: this.model.get('readOnly'),
        date: moment(date).format(this.options.dateFormat)
      })
    );

    if (this.model.get('readOnly')) {
      this.undelegateEvents();
    }

    return this;
  },

  _initBinds: function() {
    this.model.bind('change', this.render, this);
  },

  _onClickDateBtn: function(ev) {
    this.killEvent(ev);

    // Behave like a toggle
    if (this._calendar) {
      this._destroyCalendarDropdown();
    } else {
      this._calendar = new CalendarDropdown(
        _.extend(this.options, {
          target: $(ev.target).closest('button'),
          model: this.model
        })
      );
      this.addView(this._calendar);
      this._calendar.render();
      this._calendar.on('onDropdownHidden', this._destroyCalendarDropdown, this);
      this._calendar.on('onDateSelected', function(date) {
        this.trigger('onDateChange', date, this);
      }, this);
      this._calendar.open();
    }
  },

  _destroyCalendarDropdown: function() {
    this._calendar.options.target.unbind('click', this._calendar._handleClick);
    this._calendar.clean();
    this._calendar = null;
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./calendar_dropdown_view.js":196}],198:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);


/**
 *  Time input for date field
 *  
 *  Place to change hours, minutes and seconds
 *  for the date field.
 *
 */

module.exports = cdb.core.View.extend({

  className: 'TimeInput',

  events: {
    'keydown .js-input': '_onKeyDown',
    'keyup .js-input': '_onKeyUp'
  },

  initialize: function() {
    this.template = cdb.templates.getTemplate('common/edit_fields/date_field/time_input/time_input');
  },

  render: function() {
    var date = this.model.get('value') || new Date();
    this.$el.html(
      this.template({
        readOnly: this.model.get('readOnly'),
        time: moment(date).format('HH:mm:ss')
      })
    )

    if (this.model.get('readOnly')) {
      this.undelegateEvents();
    }

    return this;
  },

  _onKeyDown: function(ev) {
    if (ev.keyCode === 13) {
      ev.preventDefault();
      this.trigger('onSubmit', this);
      return false;
    }
  },

  _onKeyUp: function(ev) {
    var value = $(ev.target).val();
    this.trigger('onTimeChange', value, this);
  }

})

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],199:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);

/**
 *  Default model for each field model
 *
 */

module.exports = cdb.core.Model.extend({

  defaults: {
    attribute: '',
    value: '',
    type: 'string',
    readOnly: false
  },

  initialize: function() {
    // Validation control variable
    this.validationError = '';
    this.bind('valid', function() {
      this.validationError = '';
    }, this);
    this.bind('error', function(m, error) {
      this.validationError = error;
    });
  },

  _validate: function(attrs, options) {
    var valid = cdb.core.Model.prototype._validate.apply(this, arguments);
    if (valid) {
      this.trigger('valid')
      return true;
    } else {
      return false;
    }
  },

  validate: function(attrs) {
    if (!attrs) return;

    var val = attrs.value;
    var type = attrs.type;

    if (attrs.type === "number") {
      var pattern = /^(\+|-)?(?:[0-9]+|[0-9]*\.[0-9]+)$/;
      if (val && !pattern.test(val)) {
        return "Invalid number"
      }  
    }

    if (type === "boolean") {
      if (val !== null && val !== true && val !== false) {
        return "Invalid boolean"
      }
    }

    if (type === "date") {
      if (val && !moment(val).isValid()) {
        return "Invalid date"
      }
    }
  },

  getError: function() {
    return this.validationError;
  },

  isValid: function() {
    if (!this.validate) {
      return true;
    }
    return !this.validate(this.attributes) && this.validationError === "";
  }

})

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],200:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 *  Common edit field view
 *  
 */


module.exports = cdb.core.View.extend({

  className: 'EditField',

  options: {
    template: 'common/edit_fields/edit_field',
  },

  initialize: function() {
    if (!this.model) {
      this.model = new cdb.core.Model({ value: '' });
    }
    if (this.options.template) {
      this.template = cdb.templates.getTemplate(this.options.template);  
    }
    this._initBinds();
  },

  render: function() {
    this.$el.html(
      this.template(
        _.extend(
          this.options,
          {
            type: this.model.get('type'),
            value: this.model.get('value'),
            attribute: this.model.get('attribute'),
            readOnly: this.model.get('readOnly')    
          }
        )
      )
    );

    if (this.model.get('readOnly')) {
      this.undelegateEvents();
    }

    return this;
  },

  _initBinds: function() {
    this.model.bind('error valid', this._setFieldStyle, this);
    this.model.bind('change:readOnly', this.render, this);
  },

  _setFieldStyle: function() {
    this.$el[ this.model.getError() ? 'addClass' : 'removeClass']('is-invalid');
  },

  _hasSubmit: function(ev) {
    if (!ev) {
      throw new Error('event needed to check if user has submitted from the input');
    }

    var ua = navigator.userAgent.toLowerCase();
    var isMac = /mac os/.test(ua);

    return ( (isMac && ev.metaKey) || (!isMac && ev.ctrlKey) ) && ev.keyCode === 13;
  },

  isValid: function() {
    return this.model.isValid();
  }

});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],201:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var EditFieldView = require('../edit_field_view');
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 *  Number field
 *  
 *  Place to add/edit number editions
 *  - It accepts a number model with {attribute: 'colum', value: 'hello'}.
 *
 *  new NumberFieldView({
 *    model: new NumberFieldModel({ attribute: 'column', value: 'paco' }),
 *    option: false
 *  })
 */

module.exports = EditFieldView.extend({

  options: {
    template: 'common/edit_fields/number_field/number_field'
  },

  events: {
    'keydown .js-input': '_onKeyDown',
    'keyup .js-input': '_onKeyUp'
  },

  _hasSubmit: function(ev) {
    if (!ev) {
      throw new Error('event needed to check if user has submitted from the input');
    }
    return ev.keyCode === 13
  },

  _onKeyDown: function(ev) {
    if (this._hasSubmit(ev) && this.model.isValid()) {
      ev.preventDefault();
      this.trigger('onSubmit', this.model, this);
      return false;
    }
  },

  _onKeyUp: function(ev) {
    if (this._hasSubmit(ev) && this.model.isValid()) {
      ev.preventDefault();
      return false;
    }

    var value = $(ev.target).val();
    // Null values are valid for number type
    if (value === "") {
      value = null;
    }
    this.model.set('value', value);
  }

})

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../edit_field_view":200}],202:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var EditFieldView = require('../edit_field_view');
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 *  String field
 *  
 *  Place to edit and capture string editions
 *  - It accepts a default model with {attribute: 'colum', value: 'hello'}.
 *
 *  new StringFieldView({
 *    model: new EditFieldModel({ attribute: 'column', value: 'paco' }),
 *    option: false
 *  })
 */

module.exports = EditFieldView.extend({

  options: {
    template: 'common/edit_fields/string_field/string_field',
    autoResize: true
  },

  events: {
    'keydown .js-textarea': '_onKeyDown',
    'keyup .js-textarea':  '_onKeyUp'
  },

  render: function() {
    this.elder('render');

    // Hack to resize correctly the textarea
    if (this.options.autoResize) {
      this._resize();
    }

    return this;
  },

  _onKeyDown: function(ev) {
    if (this._hasSubmit(ev)) {
      ev.preventDefault();
      this.trigger('onSubmit', this.model, this);
      return false;
    }
  },

  _onKeyUp: function(ev) {
    ev.preventDefault();
    var value = $(ev.target).val();
    this.model.set('value', value);

    if (this.options.autoResize) {
      this._resize();
    }
  },

  // Hack function to resize automatially textarea
  _resize: function() {
    var $textarea = this.$(".js-textarea");

    // Hello hacky boy
    if ($textarea) {
      setTimeout(function() {
        $textarea.height(20);
        $textarea.height($textarea[0].scrollHeight - 22);
      });
    }
  }

})

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../edit_field_view":200}],203:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/** 
 *  Old form spinner
 *
 */

module.exports = cdb.core.View.extend({
  className: 'form-view form_spinner',

  defaults: {
    max: 999999999999,
    min: -999999999999,
    inc: 1,
    width: 25,
    pattern: /^-?[0-9]+\.?[0-9]*$/,
    debounce_time: 200
  },

  events: {
    'click .plus': '_plus',
    'click .minus': '_minus',
    'keypress input.value': '_checkInputPress',
    'keydown input.value': '_checkInputPress',
    'keyup input.value': '_checkInputUp',
    'change .value': '_checkValueChange'
  },

  initialize: function() {
    _.bindAll(this, '_fireChange', '_checkNumber');
    this.property = this.options.property;
    this.model.bind('change', this.render, this);

    // Check pattern, if it is empty or not valid,
    // delete the option before extending defaults
    if (!this.options.pattern ||
        typeof this.options.pattern !== "object" ||
        (typeof this.options.pattern === "object" && !this.options.pattern.test)
      )
    {
      delete this.options.pattern;
    }

    _.defaults(this.options, this.defaults);

    if(this.options.debounce_time > 0) {
      this._fireChange = _.debounce(this._fireChange, this.options.debounce_time);
    }
  },

  render: function(prop) {
    var value = this.options.initValue || this.model.get(this.property);

    if (prop && _.isNumber(prop)) {
      value = prop;
    }

    this.$el.html('<input class="value" ' + (this.options.disabled ? 'readonly' : '') + ' value="" style="width:' + (this.options.width) + 'px!important"/><a href="#" class="plus">+</a><a href="#" class="minus">-</a>');
    this.$('.value').val(value);

    if (this.options.disabled) {
      this.undelegateEvents();
      this.$el
      .addClass('disabled')
      .find('a').bind('click', this.killEvent);
    }

    return this;
  },

  _fireChange: function() {
    this.model.change();
  },

  _changeValue: function(a) {
    this.model.set(a, { silent: true });
    this._fireChange();
  },

  inc: function(c) {
    var a = {};
    var v = a[this.property] = this.model.get(this.property) + c;
    v = a[this.property] = Math.min(this.options.max, v.toFixed? v.toFixed(1): 1*v);
    a[this.property] = Math.max(this.options.min, v);
    this._changeValue(a);
    // don't wait to be notified by model, render as fast as the user changes the value
    this.render(a[this.property]);
  },

  _plus: function(e) {
    e && e.preventDefault();
    this.inc(this.options.inc);
    return false;
  },

  _minus: function(e) {
    e && e.preventDefault();
    this.inc(-this.options.inc);
    return false;
  },

  _checkNumber: function(number) {
    return this.options.pattern.test(number);
  },

  _checkInputPress: function(ev) {
    var newChar = String.fromCharCode(ev.charCode);

    if(newChar == '-' || newChar == '.' || 1*newChar !== NaN) {
      return true;
    } else {
      ev.preventDefault();
      ev.stopPropagation();
      return false;
    }
  },

  _checkInputUp: function(ev) {
    this.value? null : this.value = this.model.get(this.property);
    var number = $(ev.target).val();

    // If it is an ENTER -> saves!
    if (ev.keyCode === 13) {
      this._saveValue(ev);
      return false;
    }

    // If not, check the key
    if (!this._checkNumber(number) && number != '-' && number != '') {
      this.$el.find("input.value").val(this.value);
      // ev.stopPropagation();
      // ev.preventDefault();
    } else {
      if(number != '-' && number != '') {
        this.value = $(ev.target).val();
      }
    }
    return true;
  },

  _checkValueChange: function(ev) {
    var number = $(ev.target).val();
    number = (number == '' || number == '-')? 0 : 1*number
    if (!this._checkNumber(number)) {
      this.$el.find("input.value").val(this.value);
    } else {
      this._saveValue(ev);
      this.value = $(ev.target).val();
    }
    return true;
  },

  _saveValue: function(ev) {
    var a = {};
    var val = this.$el.find("input.value").val()
    var baseNumber = (this.options.min < 0 && this.options.max > 0)?
      0:
      this.options.min;

    var number = (val == '' || val == '-') ? baseNumber : 1*val;

    this.$el.find("input.value").val(number);

    a[this.property] = number;
    this.model.set(a);

    cdb.god.trigger("closeDialogs");
  }

});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],204:[function(require,module,exports){
var BaseDialog = require('../views/base_dialog/view');

/**
 *  Dialog for drop actions using mamufas
 *
 */


module.exports = BaseDialog.extend({

  className: 'Dialog is-opening MamufasDialog',

  overrideDefaults: {
    template_name: 'common/views/base_dialog/template',
    triggerDialogEvents: false
  },

  initialize: function() {
    BaseDialog.prototype.initialize.apply(this, arguments);
    this.template = cdb.templates.getTemplate('common/mamufas_import/mamufas_import_dialog');
  },

  render_content: function() {
    return this.template();
  },

  render: function() {
    this.elder('render');
    this.$('.Dialog-content').addClass('Dialog-content--expanded');
    return this;
  },

  hide: function() {
    BaseDialog.prototype.hide.apply(this, arguments);
    this.trigger('hide');
    this._setBodyForDialogMode('remove')
  }

});

},{"../views/base_dialog/view":213}],205:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var MamufasDialog = require('./mamufas_import_dialog_view');

/**
 *  Big mamufas to import files
 *  using drag and drop
 *
 */

module.exports = cdb.core.View.extend({

  initialize: function() {
    this.user = this.options.user;
    this.model = new cdb.core.Model({ visible: false });
  },

  render: function() {
    return this;
  },

  _createDragster: function() {
    if (this.dragster) {
      this._destroyDragster();
    }
    this.dragster = new Dragster(this.$el[0]);
  },

  _createDropzone: function() {
    if (this.dropzone) {
      this._destroyDropzone();
    }
    this.dropzone = new Dropzone(this.$el[0], {
      url: ':)',
      autoProcessQueue: false,
      previewsContainer: false
    });
  },

  _destroyDragster: function() {
    if (this.dragster) {
      this.dragster.removeListeners();
      this.dragster.reset();
      delete this.dragster;
    }
  },

  _destroyDropzone: function() {
    if (this.dropzone) {
      this.dropzone.destroy();
      delete this.dropzone;
    }
  },

  _initBinds: function() {
    var self = this;
    var mamufas = new MamufasDialog({ clean_on_hide: true });

    this.$el.on( "dragster:enter", function (e) {
      mamufas.appendToBody();
    });

    this.$el.on( "dragster:leave", function (e) {
      mamufas.hide();
    });

    this.dropzone.on("drop", function (ev) {
      self.dragster.dragleave(ev);
      mamufas.hide();
      self.dropzone.removeFile(ev);

      var files = ev.dataTransfer.files;
      if (files && files.length > 0) {
        if (files.length === 1) { files = files[0] }
        cdb.god.trigger('fileDropped', files, this);
      }
    });
  },

  _removeBinds: function() {
    this.$el.off("dragster:enter");
    this.$el.off("dragster:leave");
  },

  enable: function() {
    if (!this.model.get('visible')) {
      this._createDragster();
      this._createDropzone();
      this._initBinds();
      this.model.set('visible', true);
    }
  },

  disable: function() {
    if (this.model.get('visible')) {
      this._removeBinds();
      this._destroyDragster();
      this._destroyDropzone();
      this.model.set('visible', false);
    }
  },

  clean: function() {
    this._removeBinds();
    this.elder('clean');
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./mamufas_import_dialog_view":204}],206:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * Model representing the query string params for a "paged search" of a collection (matching the server-side APIs).
 *
 * @example usage
 *   var PagedSearch = require('common/paged_search_model');
 *   pagedSearch = new PagedSearch({ … })
 *   pagedSearch.fetch(collection) // => jqXHR, GET /collection/123?page=1&per_page20
 *   pagedSearch.set({ page: 2, per_page: 10, q: 'test' });
 *   pagedSearch.fetch(collection) // => GET /collection/123?page=2&per_page10&q=test
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    per_page: 20,
    page: 1
    // order: 'name'
    // q: '',
  },

  fetch: function(collection) {
    collection.trigger('fetching');
    return collection.fetch({
      data: this.attributes
    });
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],207:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 *  Get oauth url from the service requested
 *
 *  - It needs a datasource name or it won't work.
 *
 *  new cdb.admin.Service({ datasource_name: 'dropbox' })
 */

module.exports = cdb.core.Model.extend({

  _DATASOURCE_NAME: 'dropbox',

  initialize: function(attrs, opts) {
    if (opts.datasource_name) {
      this._DATASOURCE_NAME = opts.datasource_name;
    }
  },

  url: function(method) {
    var version = cdb.config.urlVersion('imports_service', method);
    return '/api/' + version + '/imports/service/' + this._DATASOURCE_NAME + '/auth_url'
  },

  parse: function(r) {
    return r
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],208:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 *  Model to check if oAuth token is valid or not
 *
 *  - It needs a datasource name or it won't work.
 *
 *  new ServiceToken({ datasource_name: 'dropbox' })
 */

module.exports = cdb.core.Model.extend({

  _DATASOURCE_NAME: 'dropbox',

  initialize: function(attrs, opts) {
    if (opts.datasource_name) {
      this._DATASOURCE_NAME = opts.datasource_name;
    }
  },

  url: function(method) {
    var version = cdb.config.urlVersion('imports_service', method);
    return '/api/' + version + '/imports/service/' + this._DATASOURCE_NAME + '/token_valid'
  },

  parse: function(r) {
    return r
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],209:[function(require,module,exports){
(function (global){
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var BaseDialog = require('./views/base_dialog/view');

/**
 * Convenient factory to create views without having to create new files.
 */
module.exports = {

  createDialogByTemplate: function(templateOrStr, templateData, dialogOptions) {
    return this.createDialogByView(this.createByTemplate(templateOrStr, templateData), dialogOptions);
  },

  /**
   * @return {Object} instance of cdb.core.View, which takes two params of template and templateData
   */
  createByTemplate: function(templateOrStr, templateData, viewOpts) {
    var template = _.isString(templateOrStr) ? cdb.templates.getTemplate(templateOrStr) : templateOrStr;

    var view = new cdb.core.View(viewOpts);
    view.render = function() {
      this.$el.html(
        template(templateData)
      );
      return this;
    };

    return view;
  },

  /**
   * Creates a view that holds a list of views to be rendered.
   * @param {Array} list of View object, i.e. have a render method, $el, and clean method.
   * @param {Object,undefined} viewOpts view options, .e.g {className: 'Whatever'}
   * @return {Object} A view
   */
  createByList: function(views, viewOpts) {
    var listView = new cdb.core.View(viewOpts);
    listView.render = function() {
      this.clearSubViews();
      _.each(views, function(view) {
        this.addView(view);
        this.$el.append(view.render().$el);
      }, this);
      return this;
    };
    return listView;
  },

  createDialogByView: function(contentView, dialogOptions) {

    var options = _.extend({ clean_on_hide: true, enter_to_confirm: true }, dialogOptions);

    return new (BaseDialog.extend({
      initialize: function() {
        this.elder('initialize');
        this.addView(contentView);
      },

      render_content: function() {
        return contentView.render().el;
      }
    }))(options);
  }
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./views/base_dialog/view":213}],210:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 * Check if Linux user used right/middle click at the time of the event
 *
 * @param ev {Event}
 * @returns {boolean}
 */
function isLinuxMiddleOrRightClick(ev) {
  return ev.which === 2 || ev.which === 3;
}

/**
 * Check if Mac user used CMD key at the time of the event Mac user used CMD key at the time of the event.
 *
 * @param ev {Event}
 * @returns {boolean}
 */
function isMacCmdKeyPressed(ev) {
  return ev.metaKey;
}

function isCtrlKeyPressed(ev) {
  return ev.ctrlKey;
}

/**
 * Click handler for a cartodb.js view, to navigate event target's href URL through the view's router.navigate method.
 *
 * The default behavior is:
 * Unless cmd/ctrl keys are pressed it will cancel the default link behavior and instead navigate to the URL set in the
 * target's href attribute.
 *
 * Prerequisities:
 *  - view has a this.router instance.
 *
 * Example of how to use:
 *   - In a template:
 *     <a href="/some/uri" id="#my-link" ...
 *     <a href="/special/uri" id="#my-special-link" ...
 *
 *   - In the view file:
 *     var navigateThroughRouter = require('../../common/view_helpers/navigateThroughRouter');
 *     module.exports = new cdb.core.View.extend({
 *       events: {
 *         'click a#my-link': navigateThroughRouter
 *         'click a#my-special-link': this._myCustomRoute
 *       }
 *
 *       _myCustomRoute: function(ev) {
 *         // Here you can do you custom logic before/after the routing, e.g.:
 *         console.log('before changing route');
 *         navigateThroughRouter.apply(this, arguments);
 *         console.log('after changing route');
 *       }
 *
 * @param ev {Event}
 */
module.exports = function(ev) {
  // We always kill the default behaviour of the event, since container around view might have other click behavior.
  // In case of a cmd/ctrl click by an user.
  this.killEvent(ev);
  var url = $(ev.target).closest('a').attr('href');

  if (!url) {
    return false;
  }

  if (!isLinuxMiddleOrRightClick(ev) && !isMacCmdKeyPressed(ev)) {
    (this.router || this.options.router).navigate(url, { trigger: true });
  } else if (isCtrlKeyPressed(ev) || isMacCmdKeyPressed(ev)) {
    window.open(url, '_blank');
  }
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],211:[function(require,module,exports){
var pluralizeStr = function(singular, plural, count) {
  if (arguments.length === 2) {
    // Backward compability with prev usages, retrofit to the new params signature
    // pluralizeStr('foobar' , 3) // => foobars
    return pluralizeStr.call(this, arguments[0], arguments[0] + 's', arguments[1]);
  }

  return count === 1 ? singular : plural;
};

pluralizeStr.prefixWithCount = function(singular, plural, count) {
  return pluralizeStr(
    '1 ' + singular, // e.g. 1 item
    count + ' ' + plural, // e.g. 123 items
    count
  );
}

module.exports = pluralizeStr;

},{}],212:[function(require,module,exports){
/**
 * Random quote
 */
module.exports = function() {

  var template  = _.template('<p class="CDB-Text CDB-Size-medium u-altTextColor">"<%= quote %>"</p><% if (author) { %><p class="CDB-Text CDB-Size-medium u-altTextColor u-tSpace"><em>– <%- author %></em></p><% } %>');

  var quotes = [
    { quote: "Geographers never get lost. They just do accidental field work.", author: "Nicholas Chrisman" },
    { quote: "Geography is just physics slowed down, with a couple of trees stuck in it.", author: "Terry Pratchett" },
    { quote: "Not all those who wander are lost.", author: "J. R. R. Tolkien" },
    { quote: "In that Empire, the Art of Cartography attained such Perfection that the map of a single Province occupied the entirety of a City.", author: "Jorge Luis Borges" },
    { quote: "X marks the spot", author: "Indiana Jones" },
    { quote: "It's turtles all the way down.", author: null },
    { quote: "Remember: no matter where you go, there you are.", author: null },
    { quote: "Without geography, you're nowhere!", author: "Jimmy Buffett" },
    { quote: "our earth is a globe / whose surface we probe /<br />no map can replace her / but just try to trace her", author: "Steve Waterman" },
    { quote: "Everything happens somewhere.", author: "Doctor Who" },
    { quote: "A map is the greatest of all epic poems. Its lines and colors show the realization of great dreams.", author: "Gilbert H. Grosvenor" },
    { quote: "Everything is related to everything else,<br />but near things are more related than distant things.", author: "Tobler's first law of geography" },
    { quote: "Hic Sunt Dracones", author: null },
    { quote: "Here be dragons", author: null },
    { quote: "Stand in the place where you live / Now face North /<br/>Think about direction / Wonder why you haven't before", author: "R.E.M" },
    { quote: "The virtue of maps, they show what can be done with limited space, they foresee that everything can happen therein.", author: "José Saramago" }
  ];

  var r = Math.round(Math.random() * (quotes.length - 1));

  return template(quotes[r]);
};

},{}],213:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var BaseDialog = cdb.ui.common.Dialog;

/**
 * Abstract view for a dialog, a kind of view that takes up the full screen overlaying any previous content.
 *
 * To be extended for a specific use-case.
 * It inherits from CartoDB.js' Dialog view so has some particular behavior/convention of how to be used, see example
 *
 * Example of how to use:
 *   // Extend this view
 *   var MyDialog = BaseDialog.extend({
 *     render_content: function() {
 *       return 'Hello world!';
 *     }
 *   });
 *
 *   // Create instance object.
 *   var dialog = new MyDialog();
 *
 *   // To render & show initially (only to be called once):
 *   dialog.appendToBody();
 */
module.exports = BaseDialog.extend({

  className: 'Dialog is-opening',

  overrideDefaults: {
    template_name: 'common/views/base_dialog/template',
    triggerDialogEvents: true
  },

  initialize: function() {
    // Override defaults of parent
    _.defaults(this.options, this.overrideDefaults);
    this.elder('initialize');
    this.bind('show', this._setBodyForDialogMode.bind(this, 'add'));
    this.bind('hide', this._setBodyForDialogMode.bind(this, 'remove'));
  },

  show: function() {
    BaseDialog.prototype.show.apply(this, arguments);
    this.trigger('show');
    if (this.options.triggerDialogEvents) {
      cdb.god.trigger('dialogOpened');
    }
    this.$el.removeClass('is-closing');

    // Blur current element (e.g. a <a> tag that was clicked to open this window)
    if (document.activeElement) {
      document.activeElement.blur();
    }
  },

  render: function() {
    BaseDialog.prototype.render.apply(this, arguments);
    this.$('.content').addClass('is-newContent');

    if (this._isSticky()) {
      this.$el.addClass('is-sticky');
    }

    this.show();
    return this;
  },

  _isSticky: function() {
    return this.options && this.options.sticky;
  },

  close: function() {
    this._cancel(undefined, true);
  },

  /**
   * @override cdb.ui.common.Dialog.prototype.open for animated opening
   */
  open: function() {
    BaseDialog.prototype.open.apply(this, arguments);
    this.show();
  },

  /**
   * @override cdb.ui.common.Dialog.prototype.hide to implement animation
   */
  hide: function() {
    BaseDialog.prototype.hide.apply(this, arguments);
    this.trigger('hide');
  },

  /**
   * @override cdb.ui.common.Dialog.prototype._cancel to implement animation upon closing the dialog and to handle hide event.
   */
  _cancel: function(ev, skipCancelCallback) {
    if (ev) this.killEvent(ev);

    if (this._isSticky()) {
      return;
    }

    this.$el.removeClass('is-opening').addClass('is-closing');

    // Use timeout instead of event listener on animation since the event triggered differs depending on browser
    // Timing won't perhaps be 100% accurate but it's good enough
    // The timeout should match the .Dialog.is-closing animation duration.
    var self = this;
    setTimeout(function() {
      // from original _cancel
      if (self.cancel && !skipCancelCallback) {
        self.cancel();
      }
      BaseDialog.prototype.hide.call(self);
    }, 80); //ms

    // Trigger events immediately, don't wait for the timeout above
    this.trigger('hide');
    if (this.options.triggerDialogEvents) {
      cdb.god.trigger('dialogClosed');
    }
  },

  /**
   * @override cdb.ui.common.Dialog.prototype._ok to not hide dialog by default if there's an ok method defined.
   */
  _ok: function(ev) {
    this.killEvent(ev);
    if (this.ok) {
      this.ok();
    } else {
      this.close();
    }
  },

  _setBodyForDialogMode: function(action) {
    $('body')[action + 'Class']('is-inDialog');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],214:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
cdb.admin = (typeof window !== "undefined" ? window['cdb']['admin'] : typeof global !== "undefined" ? global['cdb']['admin'] : null);
var moment = (typeof window !== "undefined" ? window['moment'] : typeof global !== "undefined" ? global['moment'] : null);
var Spinner = require('../../forms/spinner');


/**
 * Custom picer for a dates range.
 */
module.exports = cdb.core.View.extend({

  _MAX_RANGE: 30,
  _FOUR_HOURS: { amount: 4, unit: 'hours' },
  _ONE_DAY: { amount: 1, unit: 'day' },
  _ONE_WEEK: { amount: 1, unit: 'week' },

  className: 'DatePicker',

  options: {
    flat: true,
    date: ['2008-07-31', '2008-07-31'],
    current: '2008-07-31',
    calendars: 2,
    mode: 'range',
    starts: 1
  },

  events: {
    'click .js-dates': '_toggleCalendar',
    'click .js-fourHours': function () { this._setPreviousTime(this._FOUR_HOURS); },
    'click .js-oneDay': function () { this._setPreviousTime(this._ONE_DAY); },
    'click .js-oneWeek': function () { this._setPreviousTime(this._ONE_WEEK); }
  },

  initialize: function() {
    var isDisabled = (this.options && this.options.disabled) ? this.options.disabled : false;

    // Generate model
    this.model = new cdb.core.Model({
      fromDate: '',
      fromHour: 0,
      fromMin:  0,
      toDate: '',
      toHour: 23,
      toMin:  59,
      user_timezone: 0, // Explained as GMT+0
      disabled: isDisabled
    });

    this.template = this.options.template || cdb.templates.getTemplate('common/views/date_pickers/dates_range');

    this._initBinds();
    this._setToday();
  },

  render: function() {
    var self = this;

    this.clearSubViews();
    this.$el.empty();    

    this.$el.append(
      this.template(
        _.extend(
          this.model.attributes,
          { max_days: this._MAX_RANGE }
        )
      )
    );

    setTimeout(function() {
      self._initCalendar();
      self._hideCalendar();
      self._initTimers();
    }, 100);

    return this;
  },

  _initBinds: function() {
    _.bindAll(this, '_onDatesChange', '_onDocumentClick');

    this.model.bind('change', this._setValues, this);
    this.model.bind('change', this._onValuesChange, this);

    // Outside click
    $(document).bind('click', this._onDocumentClick);
  },

  _destroyBinds: function() {
    $(document).unbind('click', this._onDocumentClick);
  },

  _formattedDate: function (which) {
    return which + ' ' +
      '<strong>' +
        this.model.get(which + 'Date') + ' ' +
        (cdb.Utils.pad(this.model.get(which + 'Hour'), 2) + ':' + cdb.Utils.pad(this.model.get(which + 'Min'), 2)) +
      '</strong>';
  },

  _setValues: function() {
    var text = 'Choose your dates';
    var data = this.model.attributes;

    if (data.fromDate && data.toDate) {
      var calendarIcon = '<i class="CDB-IconFont CDB-IconFont-calendar DatePicker-datesIcon"></i>';
      text = this._formattedDate('from') + ' ' + this._formattedDate('to') + calendarIcon;
    }

    this.$('.DatePicker-dates').html(text);
  },

  _setToday: function() {
    var datesUTC = this.model.get('user_timezone');
    var today = moment().utc(datesUTC);
    var previous = moment().utc(datesUTC).subtract((this._MAX_RANGE - 1), 'days');
    this.options.date = [previous.format("YYYY-MM-DD"), today.format("YYYY-MM-DD")];
    this.options.current = today.format("YYYY-MM-DD");
    this._setModelFromPrevious(previous);
  },

  _initCalendar: function() {
    var selector = '.DatePicker-calendar';

    // Can't initialize calendar if not already present in document... avoid errors being thrown
    if (!document.body.contains(this.$(selector)[0])) return;

    this.calendar = this.$(selector).DatePicker(
      _.extend(this.options, {
        onChange: this._onDatesChange,
        onRender: function(d) { // Disable future dates and dates < 30 days ago

          var date = d.valueOf();
          var now = new Date();

          var thirtyDaysAgo = new Date();
          thirtyDaysAgo.setDate(now.getDate() - 30);

          return (date < thirtyDaysAgo) || (date > now) ? { disabled: true } : ''

        }
      })
    );
  },

  _onDatesChange: function(formatted, dates) {

    // Check if selected dates have more than 30 days
    var start = moment(formatted[0]);
    var end = moment(formatted[1]);

    if (Math.abs(start.diff(end, 'days')) > this._MAX_RANGE) {
      formatted[1] = moment(formatted[0]).add('days', this._MAX_RANGE).format("YYYY-MM-DD");
      this.$('.DatePicker-calendar').DatePickerSetDate([formatted[0], formatted[1]]);
    }

    this.model.set({
      fromDate: formatted[0],
      toDate:   formatted[1]
    })
  },

  _hideCalendar: function(e) {
    if (e) this.killEvent(e);
    this.$('.DatePicker-dropdown').hide();
  },

  _toggleCalendar: function(ev) {
    if (ev) this.killEvent(ev);
    this.$('.DatePicker-dropdown').toggle();
  },

  _setPreviousTime: function (timeSpan) {
    var previous = moment().utc(0).subtract(timeSpan.amount, timeSpan.unit);
    this._setModelFromPrevious(previous);
    this._setDatepickerFromPrevious(previous);
    this.closeCalendar();
  },

  _setModelFromPrevious: function(previous) {
    var today = moment().utc(0);

    this.model.set({
      fromDate: previous.format('YYYY-MM-DD'),
      fromHour: parseInt(previous.format('H')),
      fromMin:  parseInt(previous.format('m')),
      toDate: today.format('YYYY-MM-DD'),
      toHour: parseInt(today.format('H')),
      toMin:  parseInt(today.format('m'))
    });
  },

  _setDatepickerFromPrevious: function(previous) {
    var today = moment().utc(0);    
    this.$('.DatePicker-calendar').DatePickerSetDate([ previous.format('YYYY-MM-DD') , today.format('YYYY-MM-DD') ]);
  },

  _initTimers: function() {
    // 'From' div
    var $from = this.$('.DatePicker-timersFrom');

    // From hour
    var fromHour = new Spinner({
      model:    this.model,
      property: 'fromHour',
      min:      0,
      max:      23,
      inc:      1,
      width:    15,
      pattern:  /^([12]?\d{0,1}|3[01]{0,2})$/,
      debounce_time: 0
    });

    $from.find('.DatePicker-timersHour').append(fromHour.render().el);
    this.addView(fromHour);

    // From min
    var fromMin = new Spinner({
      model:    this.model,
      property: 'fromMin',
      min:      0,
      max:      59,
      inc:      1,
      width:    15,
      pattern:  /^([12345]?\d{0,1})$/,
      debounce_time: 0
    });

    $from.find('.DatePicker-timersMin').append(fromMin.render().el);
    this.addView(fromMin);


    // 'To' div
    var $to = this.$('.DatePicker-timersTo');

    // To hour
    var toHour = new Spinner({
      model:    this.model,
      property: 'toHour',
      min:      0,
      max:      23,
      inc:      1,
      width:    15,
      pattern:  /^([12]?\d{0,1}|3[01]{0,2})$/,
      debounce_time: 0
    });

    $to.find('.DatePicker-timersHour').append(toHour.render().el);
    this.addView(toHour);

    // To min
    var toMin = new Spinner({
      model:    this.model,
      property: 'toMin',
      min:      0,
      max:      59,
      inc:      1,
      width:    15,
      pattern:  /^([12345]?\d{0,1})$/,
      debounce_time: 0
    });

    $to.find('.DatePicker-timersMin').append(toMin.render().el);
    this.addView(toMin);
  },

  _onValuesChange: function() {
    this.trigger('changeDate', this.model.toJSON(), this);
  },

  getDates: function() {
    return this.model.toJSON();
  },

  closeCalendar: function() {
    this.$('.DatePicker-dropdown').hide();
  },

  _onDocumentClick: function(e) {
    var $el = $(e.target);

    if ($el.closest('.DatePicker').length === 0) {
      this.closeCalendar();
    }
  },

  clean: function() {
    this._destroyBinds();
    this.closeCalendar();
    this.$('.DatePicker-calendar').DatePickerHide();
    cdb.core.View.prototype.clean.call(this);
  }

})

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../forms/spinner":203}],215:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * Error details view, to be used together with an error object from an import model.
 *
 */

module.exports = cdb.core.View.extend({

  _TEMPLATES: {
    8001: 'common/views/size_error_details_upgrade_template',
    8005: 'common/views/layers_error_details_upgrade_template',
    default: 'common/views/error_details'
  },

  initialize: function() {
    this.user = this.options.user;
    this.err = this.options.err;
  },

  render: function() {
    // Preventing problems checking if the error_code is a number or a string
    // we make the comparision with only double =.
    var errorCode = this.err.error_code && parseInt(this.err.error_code);
    var upgradeUrl = cdb.config.get('upgrade_url');
    var userCanUpgrade = upgradeUrl && !cdb.config.get('cartodb_com_hosted') && (!this.user.isInsideOrg() || this.user.isOrgOwner());
    var templatePath = this._TEMPLATES['default'];
    var originalUrl = this.err.original_url;
    var httpResponseCode = this.err.http_response_code;
    var httpResponseCodeMessage = this.err.http_response_code_message;

    if (userCanUpgrade && this._TEMPLATES[errorCode]) {
      templatePath = this._TEMPLATES[errorCode];
    }

    var template = cdb.templates.getTemplate(templatePath);

    this.$el.html(
      template({
        errorCode: errorCode,
        title: this.err.title,
        text: this.err.what_about,
        itemQueueId: this.err.item_queue_id,
        originalUrl: originalUrl,
        httpResponseCode: httpResponseCode,
        httpResponseCodeMessage: httpResponseCodeMessage,
        userCanUpgrade: userCanUpgrade,
        showTrial: this.user.canStartTrial(),
        upgradeUrl: upgradeUrl
      })
    );

    return this;
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],216:[function(require,module,exports){
(function (global){
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 *  MapCard previews
 *
 */

module.exports = cdb.core.View.extend({

  options: {
    width: 300,
    height: 170,
    privacy: 'PUBLIC',
    username: '',
    visId: '',
    mapsApiResource: '',
    className: '',
    authTokens: []
  },

  _TEMPLATES: {
    // Using <%= %> instead of <%- %> because if not / characters (for example) will be escaped
    regular: '<%- protocol %>://<%= mapsApiResource %>/api/v1/map/static/named/<%- tpl %>/<%- width %>/<%- height %>.png<%= authTokens %>',
    cdn: '<%- protocol %>://<%- cdn %>/<%- username %>/api/v1/map/static/named/<%- tpl %>/<%- width %>/<%- height %>.png<%= authTokens %>'
  },

  initialize: function() {
    _.each(['visId', 'mapsApiResource', 'username'], function(name) {
      if (!this.options[name]) {
        console.log(name + ' is required for Static Map instantiation');
      }
    }, this);
  },

  load: function() {
    this._startLoader();
    this._loadFromVisId();

    return this;
  },

  _generateImageTemplate: function() {
    return 'tpl_' + this.options.visId.replace(/-/g, '_');
  },

  _loadFromVisId: function() {
    var protocol = this._isHTTPS() ? 'https': 'http';
    var cdnConfig = cdb.config.get('cdn_url');
    var template = _.template(cdnConfig ? this._TEMPLATES['cdn'] : this._TEMPLATES['regular']);

    var options = {
      protocol: protocol,
      username: this.options.username,
      mapsApiResource: this.options.mapsApiResource,
      tpl: this._generateImageTemplate(),
      width: this.options.width,
      height: this.options.height,
      authTokens: this._generateAuthTokensParams()
    };

    if (cdnConfig) {
      options = _.extend(options, { cdn: cdnConfig[protocol] });
    }

    var url = template(options);

    this._loadImage({}, url);
  },

  _generateAuthTokensParams: function () {
    var authTokens = this.options.authTokens;
    if (authTokens && authTokens.length > 0) {
      return '?' + _.map(authTokens, function (t) { return 'auth_token=' + t; }).join('&');
    } else {
      return '';
    }
  },

  _isHTTPS: function() {
    return location.protocol.indexOf("https") === 0;
  },

  loadURL: function(url) {
    var $img = $('<img class="MapCard-preview" src="' + url + '" />');
    this.$el.append($img);

    if (this.options.className) {
      $img.addClass(this.options.className);
    }

    $img.fadeIn(250);
  },

  showError: function() {
    this._onError();
  },

  _startLoader: function() {
    this.$el.addClass("is-loading");
  },

  _stopLoader: function() {
    this.$el.removeClass("is-loading");
  },

  _onSuccess: function(url) {
    this._stopLoader();
    this.loadURL(url);
    this.trigger("loaded", url);
  },

  _onError: function(error) {
    this._stopLoader();
    this.$el.addClass("has-error");
    var $error = $('<div class="MapCard-error" />');
    this.$el.append($error);
    $error.fadeIn(250);
    this.trigger("error");
  },

  _loadImage: function(error, url) {
    var self = this;
    var img  = new Image();

    img.onerror = function() {
      self._onError(error);
    };

    img.onload = function() {
      self._onSuccess(url);
    };

    try {
      img.src = url;
    } catch(err) {
      this._onError(err);
    }
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],217:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Utils = (typeof window !== "undefined" ? window['cdb']['Utils'] : typeof global !== "undefined" ? global['cdb']['Utils'] : null);
var PaginationModel = require('../pagination/model');
var randomQuote = require('../../view_helpers/random_quote');
var ViewFactory = require('../../view_factory');
var PaginationView = require('../pagination/view');

/**
 * View to render a searchable/pageable collection.
 * Also allows to filter/search list.
 * Set {isUsedInDialog: true} in view opts if intended to be used in a dialog, to have proper classes to position views
 * properly.
 *
 * - collection is a collection which has a PagedSearchModel.
 */
module.exports = cdb.core.View.extend({

  events: {
    'click .js-search-link': '_onSearchClick',
    'click .js-clean-search': '_onCleanSearchClick',
    'keydown .js-search-input': '_onKeyDown',
    'submit .js-search-form': 'killEvent'
  },

  initialize: function() {
    _.each(['collection', 'pagedSearchModel', 'createListView'], function(name) {
      if (!this.options[name]) throw new Error(name + ' is required');
    }, this);
    this.collection = this.options.collection;
    this.options.noResults = this.options.noResults || {}

    var params = this.options.pagedSearchModel;
    this.paginationModel = new PaginationModel({
      current_page: params.get('page'),
      total_count: this.collection.totalCount() || 0,
      per_page: params.get('per_page')
    });

    this.elder('initialize');
    this._initBinds();
    this.options.pagedSearchModel.fetch(this.collection);
  },

  render: function() {
    this.clearSubViews();

    this._renderContent(
      this.getTemplate('common/views/paged_search/paged_search')({
        thinFilters: this.options.thinFilters,
        q: this.options.pagedSearchModel.get('q')
      })
    );

    this._initViews();
    this._$cleanSearchBtn().hide();
    this._renderExtraFilters();

    return this;
  },

  _renderExtraFilters: function() {
    if (this.options.filtersExtrasView && this.options.filtersExtrasView) {
      this.$('.js-filters').append(this.options.filtersExtrasView.render().el);
    }
  },

  _renderContent: function(html) {
    if (this.options.isUsedInDialog) {
      html = this.getTemplate('common/views/paged_search/paged_search_dialog_wrapper')({
        htmlToWrap: html
      })
    }
    this.$el.html(html);

    // Needs to be called after $el html changed:
    if (this.options.isUsedInDialog) {
      this.$el.addClass('Dialog-expandedSubContent');
      this._$tabPane().addClass('Dialog-bodyInnerExpandedWithSubFooter');
    }
  },

  _initBinds: function() {
    this.collection.bind('fetching', function() {
      this._toggleCleanSearchBtn();
      this._activatePane('loading');
    }, this);

    this.collection.bind('error', function(e) {
      // Old requests can be stopped, so aborted requests are not
      // considered as an error
      if (!e || (e && e.statusText !== "abort")) {
        this._activatePane('error');
      }
      this._toggleCleanSearchBtn();
    }, this);

    this.collection.bind('reset', function(collection) {
      this.paginationModel.set({
        total_count: this.collection.totalCount(),
        current_page: this.options.pagedSearchModel.get('page')
      });
      this._activatePane(this.collection.totalCount() > 0 ? 'list' : 'no_results');
      this._toggleCleanSearchBtn();
    }, this);

    this.paginationModel.bind('change:current_page', function(mdl, newPage) {
      this.options.pagedSearchModel.set('page', newPage);
      this.options.pagedSearchModel.fetch(this.collection);
    }, this);

    this.add_related_model(this.options.pagedSearchModel);
    this.add_related_model(this.collection);
    this.add_related_model(this.paginationModel);
  },

  _toggleCleanSearchBtn: function() {
    this._$cleanSearchBtn().toggle(!!this.options.pagedSearchModel.get('q'))
  },

  _initViews: function() {
    this._panes = new cdb.ui.common.TabPane({
      el: this._$tabPane()
    });
    this.addView(this._panes);

    this._panes.addTab('list',
      ViewFactory.createByList([
        this._createListView(),
        new PaginationView({
          className: 'CDB-Text CDB-Size-medium Pagination Pagination--shareList',
          model: this.paginationModel
        })
      ])
    );

    this._panes.addTab('error',
      ViewFactory.createByTemplate('common/templates/fail', {
        msg: ''
      })
    );

    this._panes.addTab('no_results',
      ViewFactory.createByTemplate('common/templates/no_results', {
        icon: this.options.noResults.icon || 'CDB-IconFont-defaultUser',
        title: this.options.noResults.title || 'Oh! No results',
        msg: this.options.noResults.msg || 'Unfortunately we could not find anything with these parameters'
      })
    );

    this._panes.addTab('loading',
      ViewFactory.createByTemplate('common/templates/loading', {
        title: 'Searching',
        quote: randomQuote()
      })
    );

    if (this.options.pagedSearchModel.get('q')) {
      this._focusSearchInput();
    }

    this._activatePane(this._chooseActivePaneName(this.collection.totalCount()));
  },

  _createListView: function() {
    var view = this.options.createListView();
    if (view instanceof cdb.core.View) {
      return view;
    } else {
      cdb.log.error('createListView function must return a view');
      // fallback for view to not fail miserably
      return new cdb.core.View();
    }
  },

  _activatePane: function(name) {
    // Only change active pane if the panes is actually initialized
    if (this._panes && this._panes.size() > 0) {
      // explicit render required, since tabpane doesn't do it
      this._panes.active(name).render();
    }
  },

  _chooseActivePaneName: function(totalCount) {
    if (totalCount === 0) {
      return 'no_results';
    } else if (totalCount > 0) {
      return 'list';
    } else {
      return 'loading';
    }
  },

  _focusSearchInput: function() {
    // also selects the current search str on the focus
    this._$searchInput().focus().val(this._$searchInput().val());
  },

  _onSearchClick: function(ev) {
    this.killEvent(ev);
    this._$searchInput().focus();
  },

  _onCleanSearchClick: function(ev) {
    this.killEvent(ev);
    this._cleanSearch();
  },

  _onKeyDown: function(ev) {
    var enterPressed = (ev.keyCode == $.ui.keyCode.ENTER);
    var escapePressed = (ev.keyCode == $.ui.keyCode.ESCAPE);
    if (enterPressed) {
      this.killEvent(ev);
      this._submitSearch();
    } else if (escapePressed) {
      this.killEvent(ev);
      if (this.options.pagedSearchModel.get('q')) {
        this._cleanSearch();
      }
    }
  },

  _submitSearch: function(e) {
    this._makeNewSearch(Utils.stripHTML(this._$searchInput().val().trim()));
  },

  _cleanSearch: function() {
    this._$searchInput().val('');
    this._makeNewSearch();
  },

  _makeNewSearch: function(query) {
    this.options.pagedSearchModel.set({
      q: query,
      page: 1
    });
    this.options.pagedSearchModel.fetch(this.collection);
  },

  _$searchInput: function() {
    return this.$('.js-search-input');
  },

  _$cleanSearchBtn: function() {
    return this.$('.js-clean-search');
  },

  _$tabPane: function() {
    return this.$('.js-tab-pane');
  }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_factory":209,"../../view_helpers/random_quote":212,"../pagination/model":218,"../pagination/view":219}],218:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var _ = (typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null);

/**
 * View model intended to be responsible for pagination logic, and to be used in conjunction with a Pagination view.
 */
module.exports = cdb.core.Model.extend({
  defaults: {
    total_count:          0,
    per_page:             10,
    current_page:         1,
    display_count:        5,
    extras_display_count: 1,
    url_to:               undefined
  },

  pagesCount: function() {
    return Math.max(
        Math.ceil(
          this.get('total_count') / this.get('per_page')
        ), 1);
  },

  isCurrentPage: function(page) {
    return this.get('current_page') === page;
  },

  shouldBeVisible: function() {
    var pagesCount = this.pagesCount();
    return this.get('total_count') > 0 && pagesCount > 1 && this.get('current_page') <= pagesCount;
  },

  urlTo: function(page) {
    if (this.hasUrl()) {
      return this.get('url_to')(page);
    }
  },

  hasUrl: function() {
    return typeof this.get('url_to') === 'function';
  },

  /**
   * Get the pages that are expected to be displayed.
   * The current page will be in the middle of the returned sequence.
   *
   * @returns {number[]} a sequence of Numbers
   */
  pagesToDisplay: function() {
    var rangeStart;

    if (this._inLowRange()) {
      rangeStart = 1;
    } else if (this._inHighRange()) {
      rangeStart = this.get('current_page') - this._startOffset();
    } else {
      // Somewhere between the low and high boundary
      rangeStart = this.pagesCount() - this.get('display_count') + 1;
    }
    rangeStart = Math.max(rangeStart, 1);

    return this._withExtraPages(
      _.range(rangeStart, this._rangeEnd(rangeStart))
    );
  },

  _withExtraPages: function(pagesRelativeToCurrentPage) {
    var lastPage = this.pagesCount();
    var extraCount = this.get('extras_display_count');
    var extraStartPages = _.range(1, extraCount + 1);
    var extraEndPages = _.range(lastPage - extraCount + 1, lastPage + 1);

    var startPagesDiff = pagesRelativeToCurrentPage[0] - extraStartPages.slice(-1)[0];
    if (startPagesDiff === 2) {
      // There is only one missing page in the gap, so add it
      extraStartPages.push(pagesRelativeToCurrentPage[0] - 1);
    } else if (startPagesDiff > 2) {
      // There are more hidden pages at low range, add padding at end
      extraStartPages.push(-1);
    }

    var endPagesDiff = extraEndPages[0] - pagesRelativeToCurrentPage.slice(-1);
    if (endPagesDiff === 2) {
      // There is only one missing page in the gap, so add it
      extraEndPages.unshift(extraEndPages[0] - 1);
    } if (endPagesDiff > 2) {
      // There are more hidden pages at high range, add padding at beginning
      extraEndPages.unshift(-2);
    }

    return _.union(extraStartPages, pagesRelativeToCurrentPage, extraEndPages);
  },

  _inLowRange: function() {
    return this.get('current_page') < this._startOffset();
  },

  _inHighRange: function() {
    return this.get('current_page') < this._highBoundary();
  },

  _highBoundary: function() {
    return this.pagesCount() - this._startOffset();
  },

  _startOffset: function() {
    return Math.floor(this.get('display_count') / 2);
  },

  _rangeEnd: function(rangeStart) {
    // If we are too close to the range end then cap to the pages count.
    return Math.min(rangeStart + this.get('display_count'), this.pagesCount() + 1);
  }
});


}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],219:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var navigateThroughRouter = require('../../view_helpers/navigate_through_router');

/**
 * Responsible for pagination.
 *
 * Expected to be created with a pagination model, see the model for available params, here we create w/ the minimum:
 *   new PaginationView({
 *     model: new PaginationModel({
 *       // Compulsory:
 *       urlTo:  function(page) { return '/?page='+ page },

         // Optional, to router clicks on <a> tags through router.navigate by default
 *       router: new Router(...)
 *     })
 *   });
 */
module.exports = cdb.core.View.extend({

  className: 'Pagination CDB-Text CDB-Size-medium',

  events: {
    'click a': '_paginate'
  },

  initialize: function() {
    this.template = cdb.templates.getTemplate('common/views/pagination/template');
    this.router = this.options.router;

    if (this.router && !this.model.hasUrl()) {
      throw new Error('since router is set the model must have a url method set too');
    }

    this.model.bind('change', this.render, this);
  },

  render: function() {
    if (this.model.shouldBeVisible()) {
      this.$el.html(
        this.template({
          m: this.model,
          pagesCount: this.model.pagesCount(),
          currentPage: this.model.get('current_page')
        })
      );
      this.$el.addClass(this.className);
      this.delegateEvents();
    } else {
      this.$el.html('');
    }

    return this;
  },

  _paginate: function(ev) {
    if (this.router) {
      navigateThroughRouter.apply(this, arguments);
    } else if (!this.model.hasUrl()) {
      this.killEvent(ev);
    }

    var page = $(ev.target).data('page');
    this.model.set('current_page', page);
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../../view_helpers/navigate_through_router":210}],220:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * Error details view, to be used together with an error object from an import model.
 *
 */

module.exports = cdb.core.View.extend({
  _TEMPLATES: {
    'partial_import': 'common/views/partial_import_details',
    'too_many_files': 'common/views/too_many_files_details',
    'too_many_rows_connection': 'common/views/too_many_rows_connection_details'
  },

  initialize: function() {
    this.warnings = this.options.warnings;
  },

  render: function() {
    var warnings = this.warnings;

    var template_file_key = this._getTemplateKey(warnings);
    var template = cdb.templates.getTemplate(this._TEMPLATES[template_file_key]);

    this.$el.html(
      template({
        warnings: warnings
      })
    );

    return this;
  },

  _getTemplateKey: function(warnings) {
    // We have warnings precedence between max layers an max tables per import.
    // For example, one import could reach the limit of layers an tables at the
    // same time.
    if (warnings.user_max_layers && warnings.max_tables_per_import) {
      return (warnings.user_max_layers < warnings.max_tables_per_import) ? 'partial_import' : 'too_many_files'
    } else if (warnings.user_max_layers) {
      return 'partial_import';
    } else if (warnings.max_tables_per_import) {
      return 'too_many_files';
    } else if (warnings.max_rows_per_connection) {
      return 'too_many_rows_connection';
    }
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],221:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);

/**
 * Model that encapsulates params for fetching data in a cdb.admin.Visualizations collection.
 */
module.exports = cdb.core.Model.extend({

  defaults: {
    content_type:   '',
    page:           1,
    q:              '',
    tag:            '',
    category:       '',
    shared:         'no',
    locked:         false,
    library:        false,
    order:          'updated_at',
    deepInsights:   false
  },

  isSearching: function() {
    return this.get('q') || this.get('tag');
  },

  isDatasets: function() {
    return this.get('content_type') === 'datasets';
  },

  isMaps: function() {
    return this.get('content_type') === 'maps';
  },

  isDeepInsights: function() {
    return this.isMaps() && this.get('deepInsights');
  }
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],222:[function(require,module,exports){
(function (global){
// Not a unique entry file, but dependencies required for old table.js bundle, to retrofit newer browserify files to be
// usable in a non-browserified bundle
//
// Expected to be loaded after cdb.js but before table.js
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
cdb.editor = {
  CreateVisFirstView: require('./common/dialogs/create_vis_first/create_vis_first_view'),
  ImportsCollection: require('./common/background_polling/models/imports_collection'),
  GeocodingModel: require('./common/background_polling/models/geocoding_model'),
  LonLatGeocodingModel: require('./common/background_polling/models/lon_lat_geocoding_model'),
  BackgroundPollingModel: require('./editor/background_polling_model'),
  ImagePickerView: require('./common/dialogs/map/image_picker_view'),
  BackgroundPollingView: require('./common/background_polling/background_polling_view'),
  AddLayerView: require('./common/dialogs/map/add_layer_view'),
  SyncView: require('./common/dialogs/sync_dataset/sync_dataset_view'),
  ScratchView: require('./common/dialogs/map/scratch_view'),
  AddLayerModel: require('./common/dialogs/map/add_layer_model'),
  FeatureDataView: require('./common/dialogs/feature_data/feature_data_dialog_view'),

  ChangePrivacyView: require('./common/dialogs/change_privacy/change_privacy_view'),
  EditVisMetadataView: require('./common/dialogs/edit_vis_metadata/edit_vis_metadata_dialog_view'),

  DeleteItemsView: require('./common/dialogs/delete_items_view'),
  DeleteItemsViewModel: require('./common/dialogs/delete_items_view_model'),
  DeleteLayerView: require('./common/dialogs/delete_layer/delete_layer_view'),
  DeleteColumnView: require('./common/dialogs/delete_column/delete_column_view'),
  DeleteRowView: require('./common/dialogs/delete_row/delete_row_view'),

  ExportImageResultView: require('./common/dialogs/static_image/export_image_result_view'),

  AdvancedExportView: require('./common/dialogs/static_image/advanced_export_view'),

  PublishView: require('./common/dialogs/publish/publish_view'),

  ChangeLockViewModel: require('./common/dialogs/change_lock/change_lock_view_model'),
  ChangeLockView: require('./common/dialogs/change_lock/change_lock_view'),

  BuilderFeaturesWarningDialog: require('./common/dialogs/builder_features_warning/builder_features_warning_view'),

  PecanView: require('./common/dialogs/pecan/pecan_view'),

  DuplicateVisView: require('./common/dialogs/duplicate_vis_view'),
  DuplicateDatasetView: require('./common/dialogs/duplicate_dataset_view'),

  ExportView: require('./common/dialogs/export/export_view'),

  MergeDatasetsView: require('./common/dialogs/merge_datasets/merge_datasets_view'),
  GeoreferenceView: require('./common/dialogs/georeference/georeference_view'),

  LimitsReachView: require('./common/dialogs/limits_reach/limits_reached_view'),

  MamufasImportView: require('./common/mamufas_import/mamufas_import_view'),

  AddCustomBasemapView: require('./common/dialogs/add_custom_basemap/add_custom_basemap_view'),
  ViewFactory: require('./common/view_factory'),
  randomQuote: require('./common/view_helpers/random_quote.js'),

  ExportMapView: require('./common/dialogs/export_map/export_map_view')
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./common/background_polling/background_polling_view":2,"./common/background_polling/models/geocoding_model":4,"./common/background_polling/models/imports_collection":9,"./common/background_polling/models/lon_lat_geocoding_model":11,"./common/dialogs/add_custom_basemap/add_custom_basemap_view":26,"./common/dialogs/builder_features_warning/builder_features_warning_view":43,"./common/dialogs/change_lock/change_lock_view":44,"./common/dialogs/change_lock/change_lock_view_model":45,"./common/dialogs/change_privacy/change_privacy_view":46,"./common/dialogs/create_vis_first/create_vis_first_view":93,"./common/dialogs/delete_column/delete_column_view":94,"./common/dialogs/delete_items_view":95,"./common/dialogs/delete_items_view_model":96,"./common/dialogs/delete_layer/delete_layer_view":97,"./common/dialogs/delete_row/delete_row_view":98,"./common/dialogs/duplicate_dataset_view":99,"./common/dialogs/duplicate_vis_view":100,"./common/dialogs/edit_vis_metadata/edit_vis_metadata_dialog_view":103,"./common/dialogs/export/export_view":104,"./common/dialogs/export_map/export_map_view":105,"./common/dialogs/feature_data/feature_data_dialog_view":107,"./common/dialogs/georeference/georeference_view":118,"./common/dialogs/limits_reach/limits_reached_view":135,"./common/dialogs/map/add_layer_model":139,"./common/dialogs/map/add_layer_view":140,"./common/dialogs/map/image_picker_view":155,"./common/dialogs/map/scratch_view":156,"./common/dialogs/merge_datasets/merge_datasets_view":168,"./common/dialogs/pecan/pecan_view":186,"./common/dialogs/publish/publish_view":189,"./common/dialogs/static_image/advanced_export_view":190,"./common/dialogs/static_image/export_image_result_view":191,"./common/dialogs/sync_dataset/sync_dataset_view":193,"./common/mamufas_import/mamufas_import_view":205,"./common/view_factory":209,"./common/view_helpers/random_quote.js":212,"./editor/background_polling_model":223}],223:[function(require,module,exports){
(function (global){
var cdb = (typeof window !== "undefined" ? window['cdb'] : typeof global !== "undefined" ? global['cdb'] : null);
var ImportsCollection = require('../common/background_polling/models/imports_collection');
var GeocodingsCollection = require('../common/background_polling/models/geocodings_collection');
var BackgroundPollingModel = require('../common/background_polling/background_polling_model');


/**
 *  Background importer model for the editor context.
 *
 */

module.exports = BackgroundPollingModel.extend({

  addImportItem: function(mdl) {
    if (!mdl) {
      return false;
    }

    if (!this.user.canAddLayerTo(this.vis.map)) {
      mdl.setError({
        error_code: 8005,
        get_error_text: {
          title: "Max layers per map reached",
          what_about: "You can't add more layers to your map. Please upgrade your account."
        }
      });
    }

    this.importsCollection.add(mdl);
  },

  _onImportsStateChange: function(importsModel) {
    if (importsModel.hasCompleted()) {
      this.trigger('importCompleted', importsModel, this);
      var self = this;
      this.vis.map.addCartodbLayerFromTable(importsModel.imp.get('table_name'), this.user.get('username'), {
        vis: this.vis,
        success: function() {
          // layers need to be saved because the order may changed
          self.vis.map.layers.saveLayers();
          // Don't remove import item if it is Twitter type
          var serviceName = importsModel.get('upload').service_name;
          var twitterImport = serviceName && serviceName === "twitter_search";
          if (!twitterImport) {
            self.importsCollection.remove(importsModel);
          }
        },
        error: function() {
          self.trigger('importLayerFail', 'Failed to add the connected dataset as a layer to this map');
          self.importsCollection.remove(importsModel);
        }
      });
    }
  },

  _onGeocodingsStateChange: function(geocodingModel) {
    if (geocodingModel.hasCompleted()) {
      this.trigger('geocodingCompleted', geocodingModel, this);
    }
    if (geocodingModel.hasFailed()) {
      this.trigger('geocodingFailed', geocodingModel, this);
    }
  },

  _onAnalysisStateChange: function(mdl, collection) {}

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../common/background_polling/background_polling_model":1,"../common/background_polling/models/geocodings_collection":6,"../common/background_polling/models/imports_collection":9}],224:[function(require,module,exports){
var geoAttr = require('./cartocss/get-geo-attr');
var getDefaultCSSForGeometryType = require('./cartocss/get-default-css-for-geometry-type');
var ramps = require('./cartocss/color-ramps');

module.exports = {
  choropleth: function(quartiles, tableName, prop, geometryType, ramp) {
    var attr = geoAttr(geometryType);
    var tableID = '#' + tableName;

    var defaultCSS = getDefaultCSSForGeometryType(geometryType);
    var css = "/** choropleth visualization */\n\n" + tableID + " {\n  " + attr + ": " + ramp[0] + ";\n" + defaultCSS.join("\n") + "\n}\n";

    for (var i = quartiles.length - 1; i >= 0; --i) {
      if (quartiles[i] !== undefined && quartiles[i] != null) {
        css += "\n" + tableID + "[" + prop + " <= " + quartiles[i] + "] {\n";
        css += '  ' + attr  + ':' + ramp[i] + ";\n}"
      }
    }
    return css;
  },

  categoryMetadata: function(cats, options) {
    var metadata = [];

    var ramp = (options && options.ramp) ? options.ramp : ramps.category;
    var type = options && options.type ? options.type : 'string';

    for (var i = 0; i < cats.length; i++) {
      var cat = cats[i];
      if (i < 10 && cat !== undefined && ((type === 'string' && cat != null) || (type !== 'string'))) {
        metadata.push({
          title: cat,
          title_type: type,
          value_type: 'color',
          color: ramp[i]
        });
      }
    }

    if (cats.length > 10) {
      metadata.push({
        title: 'Others',
        value_type: 'color',
        default: true,
        color: ramp[ramp.length - 1]
      });
    }

    return metadata;
  },

  category: function(cats, tableName, prop, geometryType, options) {
    var attr = geoAttr(geometryType);
    var tableID = '#' + tableName;
    var ramp = ramps.category;
    var name, value;

    var type = options && options.type ? options.type : 'string';
    var ramp = (options && options.ramp) ? options.ramp : ramps.category;

    var defaultCSS = getDefaultCSSForGeometryType(geometryType);

    var css = "/** category visualization */\n\n" + tableID + " {\n  " + attr + ": " + ramp[0] + ";\n" + defaultCSS.join("\n") + "\n}\n";

    for (var i = 0; i < cats.length; i++) {

      var cat = cats[i];

      if (type === 'string') {
        name = cat.replace(/\n/g,'\\n').replace(/\"/g, "\\\"");
        value = "\"" + name + "\"";
      } else {
        value = cat;
      }

      if (i < 10 && cat !== undefined && ((type === 'string' && cat != null) || (type !== 'string'))) {
        css += "\n" + tableID + '[' + prop + '=' + value + "] {\n";
        css += '  ' + attr  + ':' + ramp[i] + ";\n}"
      }
    }

    if (cats.length > 10) {
      css += "\n" + tableID + "{\n";
      css += '  ' + attr  + ': ' + ramp[ramp.length - 1]+ ";\n}"
    }

    return css;
  },

  torque: function(stats, tableName, options){
    var tableID = '#' + tableName;
    var aggFunction = 'count(cartodb_id)';
    var css = [
        '/** torque visualization */',
        'Map {',
        '  -torque-time-attribute: ' + stats.column + ';',
        '  -torque-aggregation-function: "count(cartodb_id)";',
        '  -torque-frame-count: ' + stats.steps + ';',
        '  -torque-animation-duration: 10;',
        '  -torque-resolution: 2;',
        '}',
        tableID + ' {',
        '  marker-width: 3;',
        '  marker-fill-opacity: 0.8;',
        '  marker-fill: #0F3B82; ',
        '  comp-op: "lighten"; ',
        '  [frame-offset = 1] { marker-width: 10; marker-fill-opacity: 0.05;}',
        '  [frame-offset = 2] { marker-width: 15; marker-fill-opacity: 0.02;}',
        '}'
    ];
    css = css.join("\n");

    return css;

  },

  bubble: function(quartiles, tableName, prop) {
    var tableID = '#' + tableName;
    var css = "/** bubble visualization */\n\n" + tableID + " {\n";
    css += getDefaultCSSForGeometryType('point').join("\n");
    css += "\nmarker-fill: #FF5C00;";
    css += "\n}\n\n";

    var min = 10;
    var max = 30;

    var values = [];

    var NPOINS = 10;
    for(var i = 0; i < NPOINS; ++i) {
      var t = i/(NPOINS-1);
      values.push(min + t*(max - min));
    }

    // generate carto
    for(var i = NPOINS - 1; i >= 0; --i) {
      if(quartiles[i] !== undefined && quartiles[i] != null) {
        css += "\n#" + tableName + ' [ ' + prop + ' <= ' + quartiles[i] + "] {\n"
        css += '   marker-width: ' + values[i].toFixed(1) + ";\n}"
      }
    }
    return css;
  },

  heatmap: function(stats, tableName, options){
    var tableID = '#' + tableName;
    var css = [
        '/** heatmap visualization */',
        'Map {',
        '  -torque-time-attribute: "cartodb_id";',
        '  -torque-aggregation-function: "count(cartodb_id)";',
        '  -torque-frame-count: 1;',
        '  -torque-animation-duration: 10;',
        '  -torque-resolution: 2;',
        '}',
        tableID + ' {',
        '  marker-width: 10;',
        '  marker-fill-opacity: 0.4;',
        '  marker-fill: #0F3B82; ',
        '  comp-op: "lighten"; ',
        '  image-filters: colorize-alpha(blue, cyan, lightgreen, yellow , orange, red);',
        '  marker-file: url(http://s3.amazonaws.com/com.cartodb.assets.static/alphamarker.png);',
        '}'
    ];
    css = css.join("\n");
    return css;
  }
};

},{"./cartocss/color-ramps":225,"./cartocss/get-default-css-for-geometry-type":226,"./cartocss/get-geo-attr":227}],225:[function(require,module,exports){
module.exports = {
  bool: ['#229A00', '#F84F40', '#DDDDDD'],
  green:  ['#EDF8FB', '#D7FAF4', '#CCECE6', '#66C2A4', '#41AE76', '#238B45', '#005824'],
  blue:  ['#FFFFCC', '#C7E9B4', '#7FCDBB', '#41B6C4', '#1D91C0', '#225EA8', '#0C2C84'],
  pink: ['#F1EEF6', '#D4B9DA', '#C994C7', '#DF65B0', '#E7298A', '#CE1256', '#91003F'],
  black:  ['#F7F7F7', '#D9D9D9', '#BDBDBD', '#969696', '#737373', '#525252', '#252525'],
  red:  ['#FFFFB2', '#FED976', '#FEB24C', '#FD8D3C', '#FC4E2A', '#E31A1C', '#B10026'],
  category: ['#A6CEE3', '#1F78B4', '#B2DF8A', '#33A02C', '#FB9A99', '#E31A1C', '#FDBF6F', '#FF7F00', '#CAB2D6', '#6A3D9A', '#DDDDDD'],
  divergent: ['#0080FF', '#40A0FF', '#7FBFFF', '#FFF2CC', '#FFA6A6', '#FF7A7A', '#FF4D4D']
};

},{}],226:[function(require,module,exports){
module.exports = function(geometryType) {
  if (geometryType === 'polygon') {
    return [
      'polygon-opacity: 0.7;',
      'line-color: #FFF;',
      'line-width: 0.5;',
      'line-opacity: 1;'
    ];
  } else if (geometryType === 'line') {
    return [
      'line-width: 2;',
      'line-opacity: 0.7;'
    ];
  } else {
    return [
      'marker-fill-opacity: 0.9;',
      'marker-line-color: #FFF;',
      'marker-line-width: 1;',
      'marker-line-opacity: 1;',
      'marker-placement: point;',
      'marker-type: ellipse;',
      'marker-width: 10;',
      'marker-allow-overlap: true;'
    ];
  }
};

},{}],227:[function(require,module,exports){
module.exports = function(geometryType) {
  return {
    "line": 'line-color',
    'polygon': "polygon-fill",
    'point': "marker-fill"
  }[geometryType];
};

},{}],228:[function(require,module,exports){

/**
 * Like _.defaults, but also applies to deep object structure.
 *
 * @param {Object} customs
 * @param {Object} defaults
 * @return {Object}
 */
var deepDefaults = function(customs, defaults) {
  var memo = {};

  for (var key in defaults) {
    if (defaults.hasOwnProperty(key)) {
      var defaultsItem = defaults[key];
      var customsItem;

      if (typeof customs === 'object') {
        customsItem = customs[key];
      }

      if (typeof defaultsItem === 'object' && typeof customsItem === 'object') {
        // both defaultsItem and customsItem are objecs, go down one level, set returned result as value for key
        memo[key] = deepDefaults(customsItem, defaultsItem);
      } else if (typeof defaultsItem !== 'object' && customsItem !== undefined) {
        memo[key] = customsItem;
      } else {
        memo[key] = defaultsItem;
      }
    }
  }

  return memo || {};
};

module.exports = deepDefaults;

},{}],229:[function(require,module,exports){
var ramps = require('./cartocss/color-ramps.js');

// TODO: only require the necessary params
module.exports = function(stats) {
  var method;
  var ramp = ramps.blue;
  var name = 'blue';

  if (['A','U'].indexOf(stats.dist_type) != -1) { // apply divergent scheme
    method = stats.jenks;

    if (stats.min < 0 && stats.max > 0){
      ramp = ramps.divergent;
      name = 'spectrum2';
    }
  } else if (stats.dist_type === 'F') {
    method = stats.equalint;
    ramp = ramps.red;
    name = 'red';
  } else if (stats.dist_type === 'J') {
    method = stats.headtails;
    ramp = ramps.blue;
    name = 'blue';
  } else {
    method = stats.headtails;
    ramp = ramps.red;
    name = 'red';
  }

  return {
    name: name,
    ramp: ramp,
    method: method
  };
};

},{"./cartocss/color-ramps.js":225}],230:[function(require,module,exports){
module.exports = function(distType) {
  return {
    U: 0.9,
    A: 0.9,
    L: 0.7,
    J: 0.7,
    S: 0.5,
    F: 0.3
  }[distType];
};

},{}],231:[function(require,module,exports){
var ramps = require('./cartocss/color-ramps');
var getWeightFromShape = require('./get-weight-from-shape');
var getMethodProperties = require('./get-method-properties');
var deepDefaults = require('./deep-defaults');
var CSS = require('./cartocss');

/**
 * Get metadata to render a CartoDB map (visualization) from a set of given table and column data, see params.
 *
 * @param {Object} opts hash with following keys:
 *   - tableName: {String}
 *   - column: {Object} hash with following keys:
 *     - stats: {Object} stats as given from a describe call on a SQL API.
 *     - geometryType: {String} e.g. 'points', 'polygon' or similar.
 *     - bbox: {Array[Array]} e.g. [[0.0, 0.1], [1.0, 1.1]]
 *   - dependencies: {Object} hash with following keys:
 *     - underscore: {Object} only used for some column types though, e.g. number, string
 *   - thresholds: {Object} See list in code
 * @return {Object}
 */
module.exports = function(opts) {
  var _ = opts.dependencies.underscore;
  var tableName = opts.tableName;

  var thresholds = deepDefaults(opts.thresholds, {
    number: {
      forBubbleMap: {
        minCalcWeight: 0.5,
        maxStatsCount: 200
      },
      forCategoryOrBubbleMap: {
        minStatsWeight: 0.5,
        distinctPercentage: 25,
        forCategory: {
          maxDistinctPercentage: 1
        },
        forBubble: {
          minDistinctPercentage: 1
        }
      }
    }
  });

  var column = opts.column;
  var geometryType = column.geometryType;
  var stats = column.stats;
  var columnName = stats.column;

  var visualizationType = 'choropleth';
  var css = null;
  var type = stats.type;
  var metadata = [];
  var distinctPercentage = (stats.distinct / stats.count) * 100;

  if (type === 'number') {
    var calcWeight = (stats.weight + getWeightFromShape(stats.dist_type)) / 2;

    if (calcWeight >= thresholds.number.forBubbleMap.minCalcWeight) {
      var visFunction = CSS.choropleth;
      var properties = getMethodProperties(stats);

      if (stats.count < thresholds.number.forBubbleMap.maxStatsCount && geometryType === 'point'){
        visualizationType = 'bubble';
        visFunction = CSS.bubble;
      }

      css = visFunction(properties.method, tableName, columnName, geometryType, properties.ramp);

    } else if (stats.weight > thresholds.number.forCategoryOrBubbleMap.minStatsWeight || distinctPercentage < thresholds.number.forCategoryOrBubbleMap.maxDistinctPercentage) {
      if (distinctPercentage < thresholds.number.forCategoryOrBubbleMap.forCategory.maxDistinctPercentage) {
        visualizationType = 'category';

        var cats = stats.cat_hist;
        cats = _.sortBy(cats, function(cat) { return cat[1]; }).reverse().slice(0, ramps.category.length);
        cats = _.sortBy(cats, function(cat) { return cat[0]; });
        cats = cats.map(function(r) { return r[0]; });

        css = CSS.category(cats, tableName, columnName, geometryType, { type: type });
        metadata = CSS.categoryMetadata(cats, { type: type });

      } else if (distinctPercentage >= thresholds.number.forCategoryOrBubbleMap.forBubble.minDistinctPercentage) {

        var visFunction = CSS.choropleth;

        if (geometryType === 'point'){
          visualizationType = 'bubble';
          visFunction = CSS.bubble;
        }

        var properties = getMethodProperties(stats);
        css = visFunction(properties.method, tableName, columnName, geometryType, properties.ramp);
      }
    }

  } else if (type === 'string') {
    visualizationType = 'category';

    var cats = stats.hist;
    cats = _.sortBy(cats, function(cat) { return cat[1]; }).reverse().slice(0, ramps.category.length);
    cats = _.sortBy(cats, function(cat) { return cat[0]; });
    cats = cats.map(function(r) { return r[0]; });

    css = CSS.category(cats, tableName, columnName, geometryType);
    metadata = CSS.categoryMetadata(cats);

  } else if (type === 'date') {
    visualizationType = 'torque';
    css = CSS.torque(stats, tableName);

  } else if (type === 'boolean') {
    visualizationType = 'category';
    var ramp = ramps.bool;
    var cats = ['true', 'false', null];
    var options = { type: type, ramp: ramp };
    css = CSS.category(cats, tableName, columnName, geometryType, options);
    metadata = CSS.categoryMetadata(cats, options);

  } else if (stats.type === 'geom') {
    visualizationType = 'heatmap';
    css = CSS.heatmap(stats, tableName, options);
  }

  var properties = {
    geometryType: geometryType,
    column: columnName,
    bbox: column.bbox,
    type: type,
    visualizationType: visualizationType
  };

  if (css) {
    properties.css = css;
  } else {
    properties.css = null;
    properties.weight = -100;
  }

  if (stats) {
    properties.stats = stats;
  }

  if (metadata) {
    properties.metadata = metadata;
  }

  return properties;
};

},{"./cartocss":224,"./cartocss/color-ramps":225,"./deep-defaults":228,"./get-method-properties":229,"./get-weight-from-shape":230}],232:[function(require,module,exports){
var getWeightFromShape = require('./get-weight-from-shape');
var deepDefaults = require('./deep-defaults');

var analyzeMethods = {
  geom: function(data) {
    var stats = data.stats;
    return data.isPointGeometryType && stats.cluster_rate * stats.density >= data.thresholds.geom.minStatsDensity;
  },

  string: function(data) {
    return data.stats.weight >= data.thresholds.string.minWeight;
  },

  number: function(data) {
    var stats = data.stats;
    var distinctPercentage = (stats.distinct / stats.count) * 100;
    var calcWeight = (stats.weight + getWeightFromShape(stats.dist_type)) / 2;
    return stats.weight >= data.thresholds.number.minWeight &&
      (
        calcWeight >= data.thresholds.number.minCalcWeight ||
        stats.weight > data.thresholds.number.minWeightIfNoOtherApplies ||
        distinctPercentage < data.thresholds.number.maxDistinctPercentage
      );
  },

  boolean: function(data) {
    return data.stats.null_ratio <= data.thresholds.boolean.maxNullRatio;
  },

  date: function(data) {
    return data.isPointGeometryType && data.stats.null_ratio <= data.thresholds.date.maxNullRatio;
  }
};

/**
 * Check wether the given stats is enough to make guesses for pecan maps.
 * @param {Object} stats Results from a describe call on a table column.
 *   A stats object that lacks any relevant statistics will most likely yield a false.
 * @return {Boolean} true if good enough
 */
module.exports = function(data) {
  var isGoodEnough = false;
  var data = data || {};

  data.thresholds = deepDefaults(data.thresholds, {
    geom: {
      minStatsDensity: 0.1
    },
    string: {
      minWeight: 0.8
    },
    number: {
      minWeight: 0.1,
      minCalcWeight: 0.5,
      maxDistinctPercentage: 25,
      minWeightIfNoOtherApplies: 0.5
    },
    boolean: {
      maxNullRatio: 0.75
    },
    date: {
      maxNullRatio: 0.75
    }
  });

  if (data && data.stats) {
    var method = analyzeMethods[data.stats.type];
    if (typeof method === 'function') {
      isGoodEnough = method.call(this, data);
    }
  }

  return isGoodEnough;
};

},{"./deep-defaults":228,"./get-weight-from-shape":230}],233:[function(require,module,exports){
module.exports = {
  hasEnoughToGuess: require('./has-enough-to-guess'),
  guessMap: require('./guess-map'),
  getWeightFromShape: require('./get-weight-from-shape'),
  getMethodProperties: require('./get-method-properties')
};

},{"./get-method-properties":229,"./get-weight-from-shape":230,"./guess-map":231,"./has-enough-to-guess":232}],234:[function(require,module,exports){
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define('queue', factory) :
  (global.queue = factory());
}(this, function () { 'use strict';

  var slice = [].slice;

  function noop() {}

  var noabort = {};
  var success = [null];
  function newQueue(concurrency) {
    if (!(concurrency >= 1)) throw new Error;

    var q,
        tasks = [],
        results = [],
        waiting = 0,
        active = 0,
        ended = 0,
        starting, // inside a synchronous task callback?
        error,
        callback = noop,
        callbackAll = true;

    function start() {
      if (starting) return; // let the current task complete
      while (starting = waiting && active < concurrency) {
        var i = ended + active,
            t = tasks[i],
            j = t.length - 1,
            c = t[j];
        t[j] = end(i);
        --waiting, ++active, tasks[i] = c.apply(null, t) || noabort;
      }
    }

    function end(i) {
      return function(e, r) {
        if (!tasks[i]) throw new Error; // detect multiple callbacks
        --active, ++ended, tasks[i] = null;
        if (error != null) return; // only report the first error
        if (e != null) {
          abort(e);
        } else {
          results[i] = r;
          if (waiting) start();
          else if (!active) notify();
        }
      };
    }

    function abort(e) {
      error = e; // ignore new tasks and squelch active callbacks
      waiting = NaN; // stop queued tasks from starting
      notify();
    }

    function notify() {
      if (error != null) callback(error);
      else if (callbackAll) callback(null, results);
      else callback.apply(null, success.concat(results));
    }

    return q = {
      defer: function(f) {
        if (callback !== noop) throw new Error;
        var t = slice.call(arguments, 1);
        t.push(f);
        ++waiting, tasks.push(t);
        start();
        return q;
      },
      abort: function() {
        if (error == null) {
          var i = ended + active, t;
          while (--i >= 0) (t = tasks[i]) && t.abort && t.abort();
          abort(new Error("abort"));
        }
        return q;
      },
      await: function(f) {
        if (callback !== noop) throw new Error;
        callback = f, callbackAll = false;
        if (!waiting && !active) notify();
        return q;
      },
      awaitAll: function(f) {
        if (callback !== noop) throw new Error;
        callback = f, callbackAll = true;
        if (!waiting && !active) notify();
        return q;
      }
    };
  }

  function queue(concurrency) {
    return newQueue(arguments.length ? +concurrency : Infinity);
  }

  queue.version = "1.2.1";

  return queue;

}));
},{}]},{},[222])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy9iYWNrZ3JvdW5kX3BvbGxpbmdfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy9iYWNrZ3JvdW5kX3BvbGxpbmdfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL21vZGVscy9hbmFseXNpc19jb2xsZWN0aW9uLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9iYWNrZ3JvdW5kX3BvbGxpbmcvbW9kZWxzL2dlb2NvZGluZ19tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL21vZGVscy9nZW9jb2RpbmdfbW9kZWxfcG9sbGVyLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9iYWNrZ3JvdW5kX3BvbGxpbmcvbW9kZWxzL2dlb2NvZGluZ3NfY29sbGVjdGlvbi5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL21vZGVscy9pbXBvcnRfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy9tb2RlbHMvaW1wb3J0X21vZGVsX3BvbGxlci5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL21vZGVscy9pbXBvcnRzX2NvbGxlY3Rpb24uanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy9tb2RlbHMvaW1wb3J0c19tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL21vZGVscy9sb25fbGF0X2dlb2NvZGluZ19tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL21vZGVscy9wZWNhbl9tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL21vZGVscy9wb2xsZXIuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy9tb2RlbHMvdXBsb2FkX2NvbmZpZy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL21vZGVscy91cGxvYWRfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy92aWV3cy9hbmFseXNpcy9iYWNrZ3JvdW5kX2FuYWx5c2lzX2l0ZW1fdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL3ZpZXdzL2JhY2tncm91bmRfcG9sbGluZ19oZWFkZXJfdGl0bGVfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL3ZpZXdzL2JhY2tncm91bmRfcG9sbGluZ19oZWFkZXJfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL3ZpZXdzL2dlb2NvZGluZ3MvYmFja2dyb3VuZF9nZW9jb2RpbmdfaXRlbV92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9iYWNrZ3JvdW5kX3BvbGxpbmcvdmlld3MvZ2VvY29kaW5ncy9nZW9jb2RpbmdfcmVzdWx0X2RldGFpbHNfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL3ZpZXdzL2ltcG9ydHMvYmFja2dyb3VuZF9pbXBvcnRfaXRlbV92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9iYWNrZ3JvdW5kX3BvbGxpbmcvdmlld3MvaW1wb3J0cy9iYWNrZ3JvdW5kX2ltcG9ydF9saW1pdF92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9iYWNrZ3JvdW5kX3BvbGxpbmcvdmlld3MvaW1wb3J0cy90d2l0dGVyX2ltcG9ydF9kZXRhaWxzX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2JhdGNoX3Byb2Nlc3NfaXRlbXMuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvYWRkX2N1c3RvbV9iYXNlbWFwL2FkZF9jdXN0b21fYmFzZW1hcF9tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9hZGRfY3VzdG9tX2Jhc2VtYXAvYWRkX2N1c3RvbV9iYXNlbWFwX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvYWRkX2N1c3RvbV9iYXNlbWFwL21hcGJveC9tYXBib3hfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvYWRkX2N1c3RvbV9iYXNlbWFwL21hcGJveC9tYXBib3hfdG9fdGlsZV9sYXllcl9mYWN0b3J5LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2FkZF9jdXN0b21fYmFzZW1hcC9tYXBib3gvbWFwYm94X3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvYWRkX2N1c3RvbV9iYXNlbWFwL25hc2EvbGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2FkZF9jdXN0b21fYmFzZW1hcC9uYXNhL2lucHV0LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2FkZF9jdXN0b21fYmFzZW1hcC9uYXNhL25hc2Ffdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9hZGRfY3VzdG9tX2Jhc2VtYXAvdGFic192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2FkZF9jdXN0b21fYmFzZW1hcC90aWxlX2pzb24vdGlsZV9qc29uX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvYWRkX2N1c3RvbV9iYXNlbWFwL3RpbGVfanNvbi90aWxlX2pzb25fdmlld19tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9hZGRfY3VzdG9tX2Jhc2VtYXAvd21zL2xheWVyX21vZGVsLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2FkZF9jdXN0b21fYmFzZW1hcC93bXMvbGF5ZXJfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9hZGRfY3VzdG9tX2Jhc2VtYXAvd21zL2xheWVyc19jb2xsZWN0aW9uLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2FkZF9jdXN0b21fYmFzZW1hcC93bXMvc2VsZWN0X2xheWVyX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvYWRkX2N1c3RvbV9iYXNlbWFwL3dtcy93bXNfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvYWRkX2N1c3RvbV9iYXNlbWFwL3dtcy93bXNfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9hZGRfY3VzdG9tX2Jhc2VtYXAveHl6L3h5el9tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9hZGRfY3VzdG9tX2Jhc2VtYXAveHl6L3h5el92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2J1aWxkZXJfZmVhdHVyZXNfd2FybmluZy9idWlsZGVyX2ZlYXR1cmVzX3dhcm5pbmdfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jaGFuZ2VfbG9jay9jaGFuZ2VfbG9ja192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NoYW5nZV9sb2NrL2NoYW5nZV9sb2NrX3ZpZXdfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY2hhbmdlX3ByaXZhY3kvY2hhbmdlX3ByaXZhY3lfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jaGFuZ2VfcHJpdmFjeS9vcHRpb25fbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY2hhbmdlX3ByaXZhY3kvb3B0aW9uc19jb2xsZWN0aW9uLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NoYW5nZV9wcml2YWN5L3Bhc3N3b3JkX29wdGlvbl9tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jaGFuZ2VfcHJpdmFjeS9zaGFyZS9ncmFudGFibGVzX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY2hhbmdlX3ByaXZhY3kvc2hhcmUvZ3JvdXBfZGV0YWlsc192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NoYW5nZV9wcml2YWN5L3NoYXJlL3Blcm1pc3Npb25fdG9nZ2xlcl92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NoYW5nZV9wcml2YWN5L3NoYXJlL3Blcm1pc3Npb25fdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jaGFuZ2VfcHJpdmFjeS9zaGFyZS9zaGFyZV9tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jaGFuZ2VfcHJpdmFjeS9zaGFyZS9zaGFyZV92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NoYW5nZV9wcml2YWN5L3NoYXJlL3VzZXJfZGV0YWlsc192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NoYW5nZV9wcml2YWN5L3N0YXJ0X3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2NyZWF0ZV9saXN0aW5nLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NyZWF0ZS9mb290ZXIvZ3Vlc3NpbmdfdG9nZ2xlcl92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NyZWF0ZS9mb290ZXIvcHJpdmFjeV90b2dnbGVyX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvZGF0YXNldHMvY29udGVudF9yZXN1bHRfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jcmVhdGUvbGlzdGluZy9kYXRhc2V0cy9kYXRhc2V0X2l0ZW1fdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jcmVhdGUvbGlzdGluZy9kYXRhc2V0cy9kYXRhc2V0c19wYWdpbmF0b3Jfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jcmVhdGUvbGlzdGluZy9kYXRhc2V0cy9yZW1vdGVfZGF0YXNldF9pdGVtX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvZGF0YXNldHNfbGlzdF92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NyZWF0ZS9saXN0aW5nL2RhdGFzZXRzX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0X29wdGlvbnMuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0cy9kYXRhX2ltcG9ydC9kYXRhX2Zvcm1fdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jcmVhdGUvbGlzdGluZy9pbXBvcnRzL2RhdGFfaW1wb3J0L2RhdGFfaGVhZGVyX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0cy9pbXBvcnRfYXJjZ2lzX3NlbGVjdGVkX2RhdGFzZXRfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jcmVhdGUvbGlzdGluZy9pbXBvcnRzL2ltcG9ydF9hcmNnaXNfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jcmVhdGUvbGlzdGluZy9pbXBvcnRzL2ltcG9ydF9kYXRhX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0cy9pbXBvcnRfZGVmYXVsdF9mYWxsYmFja192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydHMvaW1wb3J0X2RlZmF1bHRfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jcmVhdGUvbGlzdGluZy9pbXBvcnRzL2ltcG9ydF9zZWxlY3RlZF9kYXRhc2V0X3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0cy9zZXJ2aWNlX2ltcG9ydC9pbXBvcnRfc2VydmljZV92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydHMvc2VydmljZV9pbXBvcnQvc2VydmljZV9oZWFkZXJfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jcmVhdGUvbGlzdGluZy9pbXBvcnRzL3NlcnZpY2VfaW1wb3J0L3NlcnZpY2VfaXRlbV9kZXNjcmlwdGlvbl9mb3JtYXQuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0cy9zZXJ2aWNlX2ltcG9ydC9zZXJ2aWNlX2l0ZW1fbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0cy9zZXJ2aWNlX2ltcG9ydC9zZXJ2aWNlX2l0ZW1zX2NvbGxlY3Rpb24uanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0cy9zZXJ2aWNlX2ltcG9ydC9zZXJ2aWNlX2xpc3RfaXRlbV92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydHMvc2VydmljZV9pbXBvcnQvc2VydmljZV9saXN0X3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0cy9zZXJ2aWNlX2ltcG9ydC9zZXJ2aWNlX2xvYWRlcl92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydHMvdHdpdHRlcl9pbXBvcnQvY3JlZGl0c19pbmZvX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0cy90d2l0dGVyX2ltcG9ydC9jcmVkaXRzX3VzYWdlX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0cy90d2l0dGVyX2ltcG9ydC9pbXBvcnRfdHdpdHRlcl92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydHMvdHdpdHRlcl9pbXBvcnQvdHdpdHRlcl9jYXRlZ29yaWVzL3R3aXR0ZXJfY2F0ZWdvcmllc19jb2xsZWN0aW9uLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydHMvdHdpdHRlcl9pbXBvcnQvdHdpdHRlcl9jYXRlZ29yaWVzL3R3aXR0ZXJfY2F0ZWdvcmllc192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydHMvdHdpdHRlcl9pbXBvcnQvdHdpdHRlcl9jYXRlZ29yaWVzL3R3aXR0ZXJfY2F0ZWdvcnlfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0cy90d2l0dGVyX2ltcG9ydC90d2l0dGVyX2NhdGVnb3JpZXMvdHdpdHRlcl9jYXRlZ29yeV92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydHNfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9jcmVhdGUvbGlzdGluZy9uYXZpZ2F0aW9uX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvY3JlYXRlX3Zpc19maXJzdC9jcmVhdGVfdmlzX2ZpcnN0X3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZGVsZXRlX2NvbHVtbi9kZWxldGVfY29sdW1uX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZGVsZXRlX2l0ZW1zX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZGVsZXRlX2l0ZW1zX3ZpZXdfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZGVsZXRlX2xheWVyL2RlbGV0ZV9sYXllcl92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2RlbGV0ZV9yb3cvZGVsZXRlX3Jvd192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2R1cGxpY2F0ZV9kYXRhc2V0X3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZHVwbGljYXRlX3Zpc192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2VkaXRfdmlzX21ldGFkYXRhL2VkaXRfdmlzX2Zvcm1fdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9lZGl0X3Zpc19tZXRhZGF0YS9lZGl0X3Zpc19tZXRhZGF0YV9kaWFsb2dfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZWRpdF92aXNfbWV0YWRhdGEvZWRpdF92aXNfbWV0YWRhdGFfZGlhbG9nX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZXhwb3J0L2V4cG9ydF92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2V4cG9ydF9tYXAvZXhwb3J0X21hcF92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2ZlYXR1cmVfZGF0YS9hZGRfY29sdW1uL2FkZF9jb2x1bW5fdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9mZWF0dXJlX2RhdGEvZmVhdHVyZV9kYXRhX2RpYWxvZ192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2ZlYXR1cmVfZGF0YS9mb3JtX2NvbGxlY3Rpb24uanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZmVhdHVyZV9kYXRhL2Zvcm1fZmllbGQvZm9ybV9maWVsZF92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2ZlYXR1cmVfZGF0YS9mb3JtX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL2FkbWluX3JlZ2lvbnNfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL2Nob29zZV9nZW9tZXRyeV92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2dlb3JlZmVyZW5jZS9jaXR5X25hbWVzX21vZGVsLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2dlb3JlZmVyZW5jZS9kZWZhdWx0X2Zvb3Rlcl92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2dlb3JlZmVyZW5jZS9nZW9jb2RlX3N0dWZmX21vZGVsLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2dlb3JlZmVyZW5jZS9nZW9tZXRyeV9pdGVtX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL2dlb3JlZmVyZW5jZV9tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2UvZ2VvcmVmZXJlbmNlX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL2lwX2FkZHJlc3Nlc19tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2UvbG9uX2xhdF9jb2x1bW5zX21vZGVsLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2dlb3JlZmVyZW5jZS9wb3N0YWxfY29kZXNfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL3Jvd19tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2Uvcm93X3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL3Jvd3Nfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2Uvc3RlcHNfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2Uvc3RyZWV0X2FkZHJlc3Nlcy9lc3RpbWF0aW9uX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL3N0cmVldF9hZGRyZXNzZXMvcXVvdGFfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2Uvc3RyZWV0X2FkZHJlc3Nlcy9zdHJlZXRfYWRkcmVzc2VzX21vZGVsLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2dlb3JlZmVyZW5jZS9zdHJlZXRfYWRkcmVzc2VzL3N0cmVldF9hZGRyZXNzZXNfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2Uvc3RyZWV0X2FkZHJlc3Nlcy9zdHJlZXRfcm93X21vZGVsLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2dlb3JlZmVyZW5jZS9zdHJlZXRfYWRkcmVzc2VzL3N0cmVldF9yb3dfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2UvbGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2dlb3JlZmVyZW5jZS9pbnB1dC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2UvdXNlcl9nZW9jb2RpbmdfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbGltaXRzX3JlYWNoL2xpbWl0c19yZWFjaGVkX2NvbnRlbnRfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9saW1pdHNfcmVhY2gvbGltaXRzX3JlYWNoZWRfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9saW1pdHNfcmVhY2gvdXNlcl9wbGFuX21vZGVsLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL2xpbWl0c19yZWFjaC91c2VyX3BsYW5zX2NvbGxlY3Rpb24uanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWFwL2FkZF9sYXllci9mb290ZXJfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tYXAvYWRkX2xheWVyX21vZGVsLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21hcC9hZGRfbGF5ZXJfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tYXAvaW1hZ2VfcGlja2VyL2xpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tYXAvaW1hZ2VfcGlja2VyL2lucHV0LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21hcC9pbWFnZV9waWNrZXIvYXNzZXRzX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWFwL2ltYWdlX3BpY2tlci9ib3hfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tYXAvaW1hZ2VfcGlja2VyL2RhdGEvbWFraV9pY29ucy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tYXAvaW1hZ2VfcGlja2VyL2RhdGEvcGF0dGVybnMuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWFwL2ltYWdlX3BpY2tlci9kYXRhL3Bpbl9tYXBzLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21hcC9pbWFnZV9waWNrZXIvZGF0YS9zaW1wbGVpY29uLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21hcC9pbWFnZV9waWNrZXIvZHJvcGJveF92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21hcC9pbWFnZV9waWNrZXIvZmlsZV91cGxvYWRfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tYXAvaW1hZ2VfcGlja2VyL2Zvb3Rlcl92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21hcC9pbWFnZV9waWNrZXIvbmF2aWdhdGlvbl92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21hcC9pbWFnZV9waWNrZXIvc3RhdGljX2Fzc2V0c19pdGVtX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWFwL2ltYWdlX3BpY2tlci91cGxvYWRfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWFwL2ltYWdlX3BpY2tlci91c2VyX2ljb25zX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWFwL2ltYWdlX3BpY2tlcl92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21hcC9zY3JhdGNoX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvY29sdW1uX21lcmdlL2Nob29zZV9rZXlfY29sdW1uc19tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9jb2x1bW5fbWVyZ2UvY2hvb3NlX2tleV9jb2x1bW5zX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvY29sdW1uX21lcmdlL2NvbHVtbl9tZXJnZV9tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9jb2x1bW5fbWVyZ2UvZm9vdGVyX2luZm9fdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9jb2x1bW5fbWVyZ2UvZ2VuZXJhdGVfY29sdW1uX21lcmdlX3NxbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9jb2x1bW5fbWVyZ2Uvc2VsZWN0X2NvbHVtbnNfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvY29sdW1uX21lcmdlL3NlbGVjdF9jb2x1bW5zX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvbGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21lcmdlX2RhdGFzZXRzL2lucHV0LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21lcmdlX2RhdGFzZXRzL2NvbHVtbnNfc2VsZWN0b3Jfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9mb290ZXJfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9tZXJnZV9kYXRhc2V0c19tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9tZXJnZV9kYXRhc2V0c192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21lcmdlX2RhdGFzZXRzL21lcmdlX2ZsYXZvcl92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21lcmdlX2RhdGFzZXRzL21lcmdlX3N0ZXBfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvbWVyZ2Vfc3RlcF92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21lcmdlX2RhdGFzZXRzL3NwYXRpYWxfbWVyZ2UvY2hvb3NlX21lcmdlX21ldGhvZF9tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9zcGF0aWFsX21lcmdlL2Nob29zZV9yaWdodF9kYXRhc2V0X21vZGVsLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21lcmdlX2RhdGFzZXRzL3NwYXRpYWxfbWVyZ2UvZm9vdGVyX2luZm9fdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9zcGF0aWFsX21lcmdlL2dlbmVyYXRlX3NwYXRpYWxfbWVyZ2Vfc3FsLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21lcmdlX2RhdGFzZXRzL3NwYXRpYWxfbWVyZ2UvbWVyZ2VfbWV0aG9kX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvc3BhdGlhbF9tZXJnZS9tZXJnZV9tZXRob2RzL2F2Z19tZXJnZV9tZXRob2QuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvc3BhdGlhbF9tZXJnZS9tZXJnZV9tZXRob2RzL2NvdW50X21lcmdlX21ldGhvZC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9zcGF0aWFsX21lcmdlL21lcmdlX21ldGhvZHMvc3VtX21lcmdlX21ldGhvZC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9zcGF0aWFsX21lcmdlL3NwYXRpYWxfbWVyZ2VfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvc3BhdGlhbF9tZXJnZS9zcGF0aWFsX21lcmdlX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvc3RpY2t5X2hlYWRlcl92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL21lcmdlX2RhdGFzZXRzL3RhYmxlc19zZWxlY3Rvcl92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL3BlY2FuL3BlY2FuX2NhcmQuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvcGVjYW4vcGVjYW5fZGlhbG9nX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvcGVjYW4vcGVjYW5fdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9wdWJsaXNoL29wdGlvbnMvdmlld19tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZGlhbG9ncy9wdWJsaXNoL3B1Ymxpc2hfb3B0aW9uX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3MvcHVibGlzaC9wdWJsaXNoX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3Mvc3RhdGljX2ltYWdlL2FkdmFuY2VkX2V4cG9ydF92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9kaWFsb2dzL3N0YXRpY19pbWFnZS9leHBvcnRfaW1hZ2VfcmVzdWx0X3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3Mvc3luY19kYXRhc2V0L2ludGVydmFsX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2RpYWxvZ3Mvc3luY19kYXRhc2V0L3N5bmNfZGF0YXNldF92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9lZGl0X2ZpZWxkcy9ib29sZWFuX2ZpZWxkL2Jvb2xlYW5fZmllbGRfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZWRpdF9maWVsZHMvZGF0ZV9maWVsZC9kYXRlX2ZpZWxkX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2VkaXRfZmllbGRzL2RhdGVfZmllbGQvZGF0ZV9waWNrZXIvbGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9lZGl0X2ZpZWxkcy9kYXRlX2ZpZWxkL2RhdGVfcGlja2VyL2lucHV0LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9lZGl0X2ZpZWxkcy9kYXRlX2ZpZWxkL2RhdGVfcGlja2VyL2RhdGVfcGlja2VyX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2VkaXRfZmllbGRzL2RhdGVfZmllbGQvdGltZV9pbnB1dC90aW1lX2lucHV0X3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2VkaXRfZmllbGRzL2VkaXRfZmllbGRfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2VkaXRfZmllbGRzL2VkaXRfZmllbGRfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vZWRpdF9maWVsZHMvbnVtYmVyX2ZpZWxkL251bWJlcl9maWVsZF92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9lZGl0X2ZpZWxkcy9zdHJpbmdfZmllbGQvc3RyaW5nX2ZpZWxkX3ZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL2Zvcm1zL3NwaW5uZXIuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL21hbXVmYXNfaW1wb3J0L21hbXVmYXNfaW1wb3J0X2RpYWxvZ192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9tYW11ZmFzX2ltcG9ydC9tYW11ZmFzX2ltcG9ydF92aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi9wYWdlZF9zZWFyY2hfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL3NlcnZpY2VfbW9kZWxzL3NlcnZpY2Vfb2F1dGhfbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL3NlcnZpY2VfbW9kZWxzL3NlcnZpY2VfdG9rZW5fbW9kZWwuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL3ZpZXdfZmFjdG9yeS5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vdmlld19oZWxwZXJzL25hdmlnYXRlX3Rocm91Z2hfcm91dGVyLmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi92aWV3X2hlbHBlcnMvcGx1cmFsaXplX3N0cmluZy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZS5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vdmlld3MvYmFzZV9kaWFsb2cvdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vdmlld3MvZGF0ZV9waWNrZXJzL2RhdGVzX3JhbmdlX3BpY2tlci5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vdmlld3MvZXJyb3JfZGV0YWlsc192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi92aWV3cy9tYXBjYXJkX3ByZXZpZXcuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL3ZpZXdzL3BhZ2VkX3NlYXJjaC9wYWdlZF9zZWFyY2hfdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vdmlld3MvcGFnaW5hdGlvbi9saWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL3ZpZXdzL3BhZ2luYXRpb24vaW5wdXQuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvY29tbW9uL3ZpZXdzL3BhZ2luYXRpb24vdmlldy5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9jb21tb24vdmlld3Mvd2FybmluZ3NfZGV0YWlsc192aWV3LmpzIiwibGliL2Fzc2V0cy9qYXZhc2NyaXB0cy9jYXJ0b2RiL2NvbW1vbi92aXN1YWxpemF0aW9uc19mZXRjaF9tb2RlbC5qcyIsImxpYi9hc3NldHMvamF2YXNjcmlwdHMvY2FydG9kYi9lZGl0b3IuanMiLCJsaWIvYXNzZXRzL2phdmFzY3JpcHRzL2NhcnRvZGIvZWRpdG9yL2JhY2tncm91bmRfcG9sbGluZ19tb2RlbC5qcyIsIm5vZGVfbW9kdWxlcy9jYXJ0b2RiLXBlY2FuL3NyYy9jYXJ0b2Nzcy5qcyIsIm5vZGVfbW9kdWxlcy9jYXJ0b2RiLXBlY2FuL3NyYy9jYXJ0b2Nzcy9jb2xvci1yYW1wcy5qcyIsIm5vZGVfbW9kdWxlcy9jYXJ0b2RiLXBlY2FuL3NyYy9jYXJ0b2Nzcy9nZXQtZGVmYXVsdC1jc3MtZm9yLWdlb21ldHJ5LXR5cGUuanMiLCJub2RlX21vZHVsZXMvY2FydG9kYi1wZWNhbi9zcmMvY2FydG9jc3MvZ2V0LWdlby1hdHRyLmpzIiwibm9kZV9tb2R1bGVzL2NhcnRvZGItcGVjYW4vc3JjL2RlZXAtZGVmYXVsdHMuanMiLCJub2RlX21vZHVsZXMvY2FydG9kYi1wZWNhbi9zcmMvZ2V0LW1ldGhvZC1wcm9wZXJ0aWVzLmpzIiwibm9kZV9tb2R1bGVzL2NhcnRvZGItcGVjYW4vc3JjL2dldC13ZWlnaHQtZnJvbS1zaGFwZS5qcyIsIm5vZGVfbW9kdWxlcy9jYXJ0b2RiLXBlY2FuL3NyYy9ndWVzcy1tYXAuanMiLCJub2RlX21vZHVsZXMvY2FydG9kYi1wZWNhbi9zcmMvaGFzLWVub3VnaC10by1ndWVzcy5qcyIsIm5vZGVfbW9kdWxlcy9jYXJ0b2RiLXBlY2FuL3NyYy9wZWNhbi5qcyIsIm5vZGVfbW9kdWxlcy9xdWV1ZS1hc3luYy9idWlsZC9xdWV1ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2xMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDaElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUM3R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzVHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDektBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzFQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDN0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNsRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDclBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDeEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUMvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzVJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDMUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM1RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDMUxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDbEZBLElBQUksR0FBRyxJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsT0FBTyxNQUFNLEtBQUssV0FBVyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztBQUNqSCxJQUFJLENBQUMsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLE9BQU8sTUFBTSxLQUFLLFdBQVcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFDM0csSUFBSSxRQUFRLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ3RDLElBQUksTUFBTSxJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsT0FBTyxNQUFNLEtBQUssV0FBVyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQzs7QUFFMUgsSUFBSSxLQUFLLEdBQUc7RUFDVixHQUFHLEVBQUU7SUFDSCxHQUFHLFdBQVcsNkpBQTZKO0lBQzNLLEtBQUssU0FBUyxZQUFZO0lBQzFCLE9BQU8sT0FBTyxZQUFZO0lBQzFCLFdBQVcsR0FBRywrRUFBK0U7SUFDN0YsSUFBSSxVQUFVLFlBQVk7SUFDMUIsT0FBTyxPQUFPLENBQUM7SUFDZixPQUFPLE9BQU8sQ0FBQztHQUNoQjs7RUFFRCxLQUFLLEVBQUU7SUFDTCxHQUFHLFdBQVcsd0lBQXdJO0lBQ3RKLEtBQUssU0FBUyxZQUFZO0lBQzFCLE9BQU8sT0FBTyxZQUFZO0lBQzFCLFdBQVcsR0FBRywrRUFBK0U7SUFDN0YsSUFBSSxVQUFVLHFCQUFxQjtJQUNuQyxPQUFPLE9BQU8sQ0FBQztJQUNmLE9BQU8sT0FBTyxDQUFDO0dBQ2hCO0NBQ0YsQ0FBQzs7Ozs7QUFLRixNQUFNLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQzs7RUFFckMsUUFBUSxFQUFFO0lBQ1IsSUFBSSxFQUFFLE1BQU07SUFDWixLQUFLLEVBQUUsTUFBTTtJQUNiLEtBQUssRUFBRSxTQUFTO0lBQ2hCLFNBQVMsRUFBRSxLQUFLOzs7SUFHaEIsSUFBSSxFQUFFLFNBQVM7SUFDZixPQUFPLEVBQUUsU0FBUztJQUNsQixNQUFNLEVBQUUsT0FBTztHQUNoQjs7RUFFRCxVQUFVLEVBQUUsV0FBVztJQUNyQixJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ3pCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztHQUNuQjs7RUFFRCxVQUFVLEVBQUUsV0FBVztJQUNyQixJQUFJLEdBQUcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUM7SUFDekMsSUFBSSxLQUFLLEdBQUcsTUFBTSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ25FLElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzNGLElBQUksQ0FBQyxHQUFHLENBQUM7TUFDUCxPQUFPLEVBQUUsS0FBSztNQUNkLElBQUksRUFBRSxTQUFTO0tBQ2hCLENBQUMsQ0FBQzs7SUFFSCxPQUFPLElBQUksUUFBUSxDQUFDO01BQ2xCLEtBQUssRUFBRSxJQUFJO0tBQ1osQ0FBQyxDQUFDO0dBQ0o7O0VBRUQsb0JBQW9CLEVBQUUsU0FBUyxVQUFVLEVBQUU7SUFDekMsSUFBSSxXQUFXLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDdkQsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsRUFBRSxTQUFTLFdBQVcsRUFBRTtNQUN0RCxPQUFPLFdBQVcsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLEtBQUssV0FBVyxDQUFDO0tBQ3ZELENBQUMsQ0FBQztHQUNKOztFQUVELFVBQVUsRUFBRSxXQUFXO0lBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsOEJBQThCLEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztHQUNqRTs7RUFFRCxTQUFTLEVBQUUsV0FBVztJQUNwQixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQy9CLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDdEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQztNQUN4QyxXQUFXLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDNUMsSUFBSSxFQUFFLE9BQU87T0FDZCxDQUFDO01BQ0YsV0FBVyxFQUFFLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXO01BQ3pDLE9BQU8sRUFBRSxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTztNQUNqQyxPQUFPLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU87TUFDakMsSUFBSSxFQUFFLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLEdBQUcsR0FBRyxHQUFHLE9BQU87S0FDNUMsQ0FBQyxDQUFDLENBQUM7R0FDTDtDQUNGLENBQUMsQ0FBQzs7Ozs7OztBQ3ZGSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUMxRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNwREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2xHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2pHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN0R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN4SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNwSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNuRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzVGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDN0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDOUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDbEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNyR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDcEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDcEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUMzRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDekRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDN0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDbkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzlIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3ZEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUN6T0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzdMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDdk5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN4REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2xEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3RJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDeEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNyTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDNURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNyR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDakZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUMvRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN6SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3BKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN0REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNwR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzVVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNyUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDeEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ25LQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2xJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQy9FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM5RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3JNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3RIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDdElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDalNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNwRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDcE1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDMU5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzdGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNwSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ25GQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN0SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDL0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDak9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNwSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDeEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2pGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQy9IQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDcERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDeENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM1SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ3BNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN6Q0EsSUFBSSxDQUFDLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxPQUFPLE1BQU0sS0FBSyxXQUFXLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO0FBQzNHLElBQUksR0FBRyxJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsT0FBTyxNQUFNLEtBQUssV0FBVyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQzs7Ozs7QUFLakgsTUFBTSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7O0VBRXBDLE9BQU8sRUFBRSxJQUFJO0VBQ2IsU0FBUyxFQUFFLGdEQUFnRDs7RUFFM0QsTUFBTSxFQUFFO0lBQ04sZUFBZSxFQUFFLFVBQVU7R0FDNUI7O0VBRUQsVUFBVSxFQUFFLFdBQVc7SUFDckIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0dBQ25COztFQUVELE1BQU0sRUFBRSxXQUFXO0lBQ2pCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQzs7SUFFckIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJO01BQ1gsSUFBSSxDQUFDLFdBQVcsQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO1FBQ3ZELEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVM7UUFDM0IsVUFBVSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQztPQUN2QyxDQUFDO0tBQ0gsQ0FBQztJQUNGLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7SUFDL0QsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztJQUMvRCxJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQzs7SUFFOUIsT0FBTyxJQUFJLENBQUM7R0FDYjs7RUFFRCxVQUFVLEVBQUUsV0FBVztJQUNyQixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDakUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxDQUFDO0dBQ2xFOztFQUVELGlCQUFpQixFQUFFLFNBQVMsQ0FBQyxFQUFFLFVBQVUsRUFBRTtJQUN6QyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0dBQzNEOztFQUVELGlCQUFpQixFQUFFLFNBQVMsQ0FBQyxFQUFFLFVBQVUsRUFBRTtJQUN6QyxVQUFVLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0dBQzlEOztFQUVELHNCQUFzQixFQUFFLFdBQVc7SUFDakMsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDckMsSUFBSSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7TUFDbkIsSUFBSSxDQUFDLE9BQU87UUFDVixJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDO1VBQzFCLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztVQUNyQixRQUFRLEVBQUUsR0FBRztVQUNiLE9BQU8sRUFBRSxHQUFHO1VBQ1osTUFBTSxFQUFFLENBQUMsRUFBRTtTQUNaLENBQUM7T0FDSCxDQUFDO0tBQ0g7R0FDRjs7RUFFRCxRQUFRLEVBQUUsU0FBUyxFQUFFLEVBQUU7SUFDckIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNuQixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7R0FDbEM7Q0FDRixDQUFDLENBQUM7Ozs7Ozs7QUNsRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDakZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN0RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDM0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN0T0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDbEhBLElBQUksR0FBRyxJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsT0FBTyxNQUFNLEtBQUssV0FBVyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztBQUNqSCxJQUFJLENBQUMsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLE9BQU8sTUFBTSxLQUFLLFdBQVcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7Ozs7Ozs7Ozs7O0FBVzNHLE1BQU0sQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDOztFQUVwQyxLQUFLLEVBQUUsRUFBRTtFQUNULFNBQVMsRUFBRSxFQUFFOztFQUViLE9BQU8sRUFBRSxJQUFJOztFQUViLE9BQU8sRUFBRTtJQUNQLFFBQVEsRUFBRSw2Q0FBNkM7R0FDeEQ7O0VBRUQsTUFBTSxFQUFFO0lBQ04sZ0JBQWdCLEVBQUUsZUFBZTtJQUNqQyxPQUFPLFdBQVcsVUFBVTtHQUM3Qjs7RUFFRCxVQUFVLEVBQUUsV0FBVztJQUNyQixJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDakUsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0dBQ25COztFQUVELE1BQU0sRUFBRSxXQUFXO0lBQ2pCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUNyQixJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDOztJQUVwRCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7O0lBRS9DLE9BQU8sSUFBSSxDQUFDO0dBQ2I7O0VBRUQsVUFBVSxFQUFFLFdBQVc7SUFDckIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLGVBQWUsQ0FBQyxDQUFDOztJQUU3QyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN6RCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztHQUMvQzs7RUFFRCxXQUFXLEVBQUUsU0FBUyxHQUFHLEVBQUU7SUFDekIsSUFBSSxHQUFHLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztJQUN0QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7O0lBRWhCLEdBQUcsQ0FBQyxNQUFNLEdBQUcsV0FBVztNQUN0QixJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO01BQ25CLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7O01BRXBCLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUM7O01BRW5DLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQzs7TUFFbEMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxRQUFRLEVBQUU7UUFDdEMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRTtVQUNqQixVQUFVLENBQUMsR0FBRyxDQUFDO1lBQ2IsaUJBQWlCLEdBQUcsT0FBTztZQUMzQixtQkFBbUIsRUFBRSxhQUFhO1dBQ25DLENBQUMsQ0FBQztTQUNKLE1BQU0sSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTs7VUFFcEMsVUFBVSxDQUFDLEdBQUcsQ0FBQztZQUNiLGlCQUFpQixFQUFFLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSTtXQUN6QyxDQUFDLENBQUM7U0FDSjtPQUNGLE1BQU07UUFDTCxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO1VBQ3pCLFVBQVUsQ0FBQyxHQUFHLENBQUM7WUFDYixpQkFBaUIsR0FBRyxPQUFPO1lBQzNCLG1CQUFtQixFQUFFLGFBQWE7V0FDbkMsQ0FBQyxDQUFDO1NBQ0osTUFBTTtVQUNMLFVBQVUsQ0FBQyxHQUFHLENBQUM7WUFDYixxQkFBcUIsRUFBRSxLQUFLO1lBQzVCLG1CQUFtQixFQUFFLFFBQVE7V0FDOUIsQ0FBQyxDQUFDO1NBQ0o7T0FDRjtLQUNGOztJQUVELEdBQUcsQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQzdDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO0dBQ2Y7O0VBRUQsUUFBUSxFQUFFLFNBQVMsQ0FBQyxFQUFFO0lBQ3BCLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7O0lBRWxCLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssVUFBVSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLFlBQVksRUFBRTtNQUNyRixJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7TUFDckMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0tBQ3JDO0dBQ0Y7O0VBRUQsWUFBWSxFQUFFLFdBQVc7SUFDdkIsSUFBSSxDQUFDLEdBQUc7T0FDTCxXQUFXLENBQUMsbUNBQW1DLENBQUM7T0FDaEQsUUFBUSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0dBQzlDOztFQUVELGFBQWEsRUFBRSxTQUFTLENBQUMsRUFBRTtJQUN6QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7O0lBRWhCLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEIsQ0FBQyxDQUFDLHdCQUF3QixFQUFFLENBQUM7O0lBRTdCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQztNQUN6QyxTQUFTLEVBQUUsc0JBQXNCO01BQ2pDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztNQUNuQixLQUFLLEVBQUUsR0FBRztNQUNWLE9BQU8sRUFBRSxHQUFHO01BQ1osUUFBUSxFQUFFLEdBQUc7TUFDYixhQUFhLEVBQUUsOENBQThDO01BQzdELGlCQUFpQixFQUFFLE1BQU07TUFDekIsbUJBQW1CLEVBQUUsTUFBTTtNQUMzQixpQkFBaUIsRUFBRSxDQUFDO01BQ3BCLElBQUksRUFBRSxNQUFNO0tBQ2IsQ0FBQyxDQUFDOztJQUVILElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxTQUFTLEVBQUUsRUFBRTtNQUMvQyxFQUFFLENBQUMsY0FBYyxFQUFFLENBQUM7TUFDcEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0tBQ3JCLENBQUMsQ0FBQzs7SUFFSCxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDNUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdEIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztHQUNqRTs7RUFFRCxZQUFZLEVBQUUsV0FBVztJQUN2QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7SUFDaEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLFlBQVksQ0FBQyxDQUFDOztJQUV0QyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQztNQUNqQixPQUFPLEVBQUUsV0FBVyxFQUFFO01BQ3RCLEtBQUssRUFBRSxXQUFXO1FBQ2hCLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztPQUNqQztLQUNGLENBQUM7R0FDSDtDQUNGLENBQUMsQ0FBQzs7Ozs7OztBQ25KSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3RFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNuSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdjdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNwRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ25JQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUMvUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDNUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ25LQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ25XQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDMUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDbkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2pHQSxJQUFJLEdBQUcsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLE9BQU8sTUFBTSxLQUFLLFdBQVcsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7Ozs7Ozs7QUFPakgsTUFBTSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7O0VBRXBDLFNBQVMsRUFBRSxVQUFVOztFQUVyQixNQUFNLEVBQUU7SUFDTixPQUFPLEVBQUUsVUFBVTtJQUNuQixZQUFZLEVBQUUsZUFBZTtJQUM3QixZQUFZLEVBQUUsZUFBZTtHQUM5Qjs7RUFFRCxVQUFVLEVBQUUsV0FBVztJQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxDQUFDOztJQUU1RSxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7TUFDOUIsSUFBSSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWTtLQUNoQyxDQUFDLENBQUM7O0lBRUgsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQzs7SUFFbEMsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0dBQ25COztFQUVELE1BQU0sRUFBRSxXQUFXO0lBQ2pCLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSTtNQUNYLElBQUksQ0FBQyxXQUFXLENBQUMsK0NBQStDLENBQUMsQ0FBQztRQUNoRSxZQUFZLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO1FBQ3BDLFVBQVUsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7UUFDbkMsVUFBVSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQztPQUNwQyxDQUFDO0tBQ0gsQ0FBQzs7SUFFRixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtNQUNsQixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUM7UUFDMUMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFO1FBQ1gsTUFBTSxFQUFFLENBQUMsRUFBRTtRQUNYLE9BQU8sRUFBRSxRQUFRO1FBQ2pCLFFBQVEsRUFBRSx5RkFBeUY7T0FDcEcsQ0FBQyxDQUFDO01BQ0gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7S0FDN0I7O0lBRUQsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztJQUNqRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDOztJQUVqRSxPQUFPLElBQUksQ0FBQztHQUNiOztFQUVELFVBQVUsRUFBRSxXQUFXO0lBQ3JCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNsRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDbEUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztHQUNyQzs7RUFFRCxpQkFBaUIsRUFBRSxTQUFTLE1BQU0sRUFBRSxVQUFVLEVBQUU7SUFDOUMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxPQUFPLEVBQUU7TUFDdEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsYUFBYSxFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQztLQUNuRDtJQUNELElBQUksQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsV0FBVyxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDNUQsSUFBSSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQztHQUNwRDs7RUFFRCxpQkFBaUIsRUFBRSxTQUFTLE1BQU0sRUFBRSxVQUFVLEVBQUU7SUFDOUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxVQUFVLENBQUM7SUFDMUIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsYUFBYSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0dBQ2pEOztFQUVELFFBQVEsRUFBRSxTQUFTLEVBQUUsRUFBRTtJQUNyQixJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEVBQUU7TUFDdkIsSUFBSSxrQkFBa0IsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDOzs7TUFHdEQsSUFBSSxrQkFBa0IsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxPQUFPLEVBQUU7UUFDNUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLGtCQUFrQixDQUFDLENBQUM7T0FDakQ7S0FDRjtHQUNGOztFQUVELGFBQWEsRUFBRSxXQUFXO0lBQ3hCLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFFO01BQ3RCLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUM7S0FDM0I7R0FDRjs7RUFFRCxhQUFhLEVBQUUsV0FBVztJQUN4QixJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxDQUFDO0dBQzNCOztFQUVELFdBQVcsRUFBRSxXQUFXO0lBQ3RCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7R0FDcEM7O0NBRUYsQ0FBQyxDQUFDOzs7Ozs7O0FDbkdIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDekhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3JGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzdKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDL0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDOUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDcEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDMUxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDNUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3RHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUMzSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDNWJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDakdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDOUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUMxRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN4TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2hMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDaEdBLElBQUksR0FBRyxJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsT0FBTyxNQUFNLEtBQUssV0FBVyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztBQUNqSCxJQUFJLENBQUMsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLE9BQU8sTUFBTSxLQUFLLFdBQVcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFDM0csSUFBSSxDQUFDLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxPQUFPLE1BQU0sS0FBSyxXQUFXLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO0FBQzNHLElBQUksTUFBTSxJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsT0FBTyxNQUFNLEtBQUssV0FBVyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQzs7Ozs7OztBQU8xSCxNQUFNLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQzs7RUFFN0MsU0FBUyxFQUFFLFVBQVU7OztFQUdyQixPQUFPLEVBQUU7SUFDUCxJQUFJLEVBQUUsSUFBSTtJQUNWLElBQUksRUFBRSxZQUFZO0lBQ2xCLE9BQU8sRUFBRSxZQUFZO0lBQ3JCLFNBQVMsRUFBRSxDQUFDO0lBQ1osTUFBTSxFQUFFLENBQUM7R0FDVjs7RUFFRCxVQUFVLEVBQUUsV0FBVztJQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLG1CQUFtQixDQUFDLENBQUM7SUFDdEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUN6QixJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLDZEQUE2RCxDQUFDLENBQUM7SUFDekcsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0dBQ3RCOztFQUVELE1BQU0sRUFBRSxXQUFXO0lBQ2pCLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSTtNQUNYLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDWixjQUFjLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQztPQUNyRSxDQUFDO0tBQ0gsQ0FBQzs7SUFFRixHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM5QyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUMxQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7O0lBRXJCLE9BQU8sSUFBSSxDQUFDO0dBQ2I7O0VBRUQsS0FBSyxFQUFFLFdBQVc7SUFDaEIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ25DLEdBQUcsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0dBQ25EOztFQUVELGFBQWEsRUFBRSxXQUFXO0lBQ3hCLElBQUksR0FBRyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUN6QyxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDbkUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLEtBQUssQ0FBQztJQUM3RyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztHQUMxQzs7O0VBR0QsYUFBYSxFQUFFLFdBQVc7SUFDeEIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ2hCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxVQUFVO01BQzFCLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRTtRQUM1QyxRQUFRLEVBQUUsU0FBUyxTQUFTLEVBQUUsSUFBSSxFQUFFO1VBQ2xDLElBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1VBQzNDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztTQUNiO09BQ0YsQ0FBQztLQUNILENBQUM7R0FDSDs7RUFFRCxVQUFVLEVBQUUsV0FBVztJQUNyQixPQUFPLElBQUksQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUM7R0FDL0I7O0NBRUYsQ0FBQyxDQUFDOzs7Ozs7O0FDekVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDL0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN4RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUMxREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDeEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUM1S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUMxRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM3SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3hTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDOUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDN1BBLElBQUksR0FBRyxJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsT0FBTyxNQUFNLEtBQUssV0FBVyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztBQUNqSCxJQUFJLENBQUMsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLE9BQU8sTUFBTSxLQUFLLFdBQVcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7Ozs7O0FBSzNHLE1BQU0sQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO0VBQ3JDLFFBQVEsRUFBRTtJQUNSLFdBQVcsV0FBVyxDQUFDO0lBQ3ZCLFFBQVEsY0FBYyxFQUFFO0lBQ3hCLFlBQVksVUFBVSxDQUFDO0lBQ3ZCLGFBQWEsU0FBUyxDQUFDO0lBQ3ZCLG9CQUFvQixFQUFFLENBQUM7SUFDdkIsTUFBTSxnQkFBZ0IsU0FBUztHQUNoQzs7RUFFRCxVQUFVLEVBQUUsV0FBVztJQUNyQixPQUFPLElBQUksQ0FBQyxHQUFHO1FBQ1gsSUFBSSxDQUFDLElBQUk7VUFDUCxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDO1NBQy9DLEVBQUUsQ0FBQyxDQUFDLENBQUM7R0FDWDs7RUFFRCxhQUFhLEVBQUUsU0FBUyxJQUFJLEVBQUU7SUFDNUIsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxLQUFLLElBQUksQ0FBQztHQUMxQzs7RUFFRCxlQUFlLEVBQUUsV0FBVztJQUMxQixJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDbkMsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsSUFBSSxVQUFVLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLElBQUksVUFBVSxDQUFDO0dBQ2hHOztFQUVELEtBQUssRUFBRSxTQUFTLElBQUksRUFBRTtJQUNwQixJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRTtNQUNqQixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDakM7R0FDRjs7RUFFRCxNQUFNLEVBQUUsV0FBVztJQUNqQixPQUFPLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxVQUFVLENBQUM7R0FDakQ7Ozs7Ozs7O0VBUUQsY0FBYyxFQUFFLFdBQVc7SUFDekIsSUFBSSxVQUFVLENBQUM7O0lBRWYsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLEVBQUU7TUFDdEIsVUFBVSxHQUFHLENBQUMsQ0FBQztLQUNoQixNQUFNLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRSxFQUFFO01BQzlCLFVBQVUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztLQUM3RCxNQUFNOztNQUVMLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUM7S0FDaEU7SUFDRCxVQUFVLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUM7O0lBRXJDLE9BQU8sSUFBSSxDQUFDLGVBQWU7TUFDekIsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQztLQUNoRCxDQUFDO0dBQ0g7O0VBRUQsZUFBZSxFQUFFLFNBQVMsMEJBQTBCLEVBQUU7SUFDcEQsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ2pDLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQztJQUNsRCxJQUFJLGVBQWUsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDakQsSUFBSSxhQUFhLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsVUFBVSxHQUFHLENBQUMsRUFBRSxRQUFRLEdBQUcsQ0FBQyxDQUFDLENBQUM7O0lBRXJFLElBQUksY0FBYyxHQUFHLDBCQUEwQixDQUFDLENBQUMsQ0FBQyxHQUFHLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsRixJQUFJLGNBQWMsS0FBSyxDQUFDLEVBQUU7O01BRXhCLGVBQWUsQ0FBQyxJQUFJLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7S0FDekQsTUFBTSxJQUFJLGNBQWMsR0FBRyxDQUFDLEVBQUU7O01BRTdCLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUMxQjs7SUFFRCxJQUFJLFlBQVksR0FBRyxhQUFhLENBQUMsQ0FBQyxDQUFDLEdBQUcsMEJBQTBCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDM0UsSUFBSSxZQUFZLEtBQUssQ0FBQyxFQUFFOztNQUV0QixhQUFhLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztLQUM3QyxDQUFDLElBQUksWUFBWSxHQUFHLENBQUMsRUFBRTs7TUFFdEIsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQzNCOztJQUVELE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUUsMEJBQTBCLEVBQUUsYUFBYSxDQUFDLENBQUM7R0FDNUU7O0VBRUQsV0FBVyxFQUFFLFdBQVc7SUFDdEIsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztHQUN2RDs7RUFFRCxZQUFZLEVBQUUsV0FBVztJQUN2QixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0dBQ3hEOztFQUVELGFBQWEsRUFBRSxXQUFXO0lBQ3hCLE9BQU8sSUFBSSxDQUFDLFVBQVUsRUFBRSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztHQUNoRDs7RUFFRCxZQUFZLEVBQUUsV0FBVztJQUN2QixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztHQUNsRDs7RUFFRCxTQUFTLEVBQUUsU0FBUyxVQUFVLEVBQUU7O0lBRTlCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7R0FDaEY7Q0FDRixDQUFDLENBQUM7Ozs7Ozs7QUNqSEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDbEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDbkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIEltcG9ydHNDb2xsZWN0aW9uID0gcmVxdWlyZSgnLi9tb2RlbHMvaW1wb3J0c19jb2xsZWN0aW9uJyk7XG52YXIgR2VvY29kaW5nc0NvbGxlY3Rpb24gPSByZXF1aXJlKCcuL21vZGVscy9nZW9jb2RpbmdzX2NvbGxlY3Rpb24nKTtcbnZhciBBbmFseXNpc0NvbGxlY3Rpb24gPSByZXF1aXJlKCcuL21vZGVscy9hbmFseXNpc19jb2xsZWN0aW9uJyk7XG52YXIgcG9sbGluZ3NUaW1lciA9IDMwMDA7XG5cbi8qKlxuICogIEJhY2tncm91bmQgcG9sbGluZyBkZWZhdWx0IG1vZGVsXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBkZWZhdWx0czoge1xuICAgIHNob3dHZW9jb2RpbmdEYXRhc2V0VVJMQnV0dG9uOiBmYWxzZSxcbiAgICBzaG93U3VjY2Vzc0RldGFpbHNCdXR0b246IHRydWUsXG4gICAgZ2VvY29kaW5nc1BvbGxpbmc6IGZhbHNlLCAvLyBlbmFibGUgZ2VvY29kaW5ncyBwb2xsaW5nXG4gICAgaW1wb3J0c1BvbGxpbmc6IGZhbHNlIC8vIGVuYWJsZSBpbXBvcnRzIHBvbGxpbmdcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbihhdHRycywgb3B0cykge1xuICAgIHRoaXMudXNlciA9IG9wdHMudXNlcjtcbiAgICB0aGlzLnZpcyA9IG9wdHMudmlzO1xuICAgIHRoaXMuaW1wb3J0c0NvbGxlY3Rpb24gPSBvcHRzLmltcG9ydHNDb2xsZWN0aW9uIHx8IG5ldyBJbXBvcnRzQ29sbGVjdGlvbihudWxsLCB7IHVzZXI6IHRoaXMudXNlciB9KTtcbiAgICB0aGlzLmdlb2NvZGluZ3NDb2xsZWN0aW9uID0gb3B0cy5nZW9jb2RpbmdzQ29sbGVjdGlvbiB8fCBuZXcgR2VvY29kaW5nc0NvbGxlY3Rpb24obnVsbCwgeyB1c2VyOiB0aGlzLnVzZXIsIHZpczogdGhpcy52aXMgfSk7XG4gICAgdGhpcy5hbmFseXNpc0NvbGxlY3Rpb24gPSBvcHRzLmFuYXlseXNpc0NvbGxlY3Rpb24gfHwgbmV3IEFuYWx5c2lzQ29sbGVjdGlvbihudWxsLCB7IHVzZXI6IHRoaXMudXNlciB9KTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICB0aGlzLnN0YXJ0UG9sbGluZ3MoKTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmltcG9ydHNDb2xsZWN0aW9uLmJpbmQoJ2NoYW5nZTpzdGF0ZScsIGZ1bmN0aW9uKG1kbCkge1xuICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2UnLCBtZGwsIHRoaXMpO1xuICAgICAgdGhpcy5fb25JbXBvcnRzU3RhdGVDaGFuZ2UobWRsKVxuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMuaW1wb3J0c0NvbGxlY3Rpb24uYmluZCgncmVtb3ZlJywgZnVuY3Rpb24obWRsKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2ltcG9ydFJlbW92ZWQnLCBtZGwsIHRoaXMpO1xuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMuaW1wb3J0c0NvbGxlY3Rpb24uYmluZCgnYWRkJywgZnVuY3Rpb24obWRsKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2ltcG9ydEFkZGVkJywgbWRsLCB0aGlzKTtcbiAgICB9LCB0aGlzKTtcblxuICAgIHRoaXMuZ2VvY29kaW5nc0NvbGxlY3Rpb24uYmluZCgnY2hhbmdlOnN0YXRlJywgZnVuY3Rpb24obWRsKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZScsIG1kbCwgdGhpcyk7XG4gICAgICB0aGlzLl9vbkdlb2NvZGluZ3NTdGF0ZUNoYW5nZShtZGwpO1xuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMuZ2VvY29kaW5nc0NvbGxlY3Rpb24uYmluZCgncmVtb3ZlJywgZnVuY3Rpb24obWRsKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2dlb2NvZGluZ1JlbW92ZWQnLCBtZGwsIHRoaXMpO1xuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMuZ2VvY29kaW5nc0NvbGxlY3Rpb24uYmluZCgnYWRkJywgZnVuY3Rpb24obWRsKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2dlb2NvZGluZ0FkZGVkJywgbWRsLCB0aGlzKTtcbiAgICB9LCB0aGlzKTtcblxuICAgIHRoaXMuYW5hbHlzaXNDb2xsZWN0aW9uLmJpbmQoJ3Jlc2V0JywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5hbmFseXNpc0NvbGxlY3Rpb24uc2l6ZSgpID4gMCkge1xuICAgICAgICB0aGlzLnRyaWdnZXIoJ2FuYWx5c2lzQWRkZWQnLCB0aGlzLmFuYWx5c2lzQ29sbGVjdGlvbiwgdGhpcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnRyaWdnZXIoJ2FuYWx5c2lzUmVtb3ZlZCcsIHRoaXMuYW5hbHlzaXNDb2xsZWN0aW9uLCB0aGlzKTsgIFxuICAgICAgfVxuICAgIH0sIHRoaXMpOyBcblxuICAgIHRoaXMuYW5hbHlzaXNDb2xsZWN0aW9uLmJpbmQoJ2NoYW5nZTpzdGF0ZScsIGZ1bmN0aW9uKG1kbCkge1xuICAgICAgdGhpcy5fb25BbmFseXNpc1N0YXRlQ2hhbmdlKG1kbCwgdGhpcy5hbmFseXNpc0NvbGxlY3Rpb24pO1xuICAgIH0sIHRoaXMpO1xuICB9LFxuXG4gIC8vIEhlbHBlciBmdW5jdGlvbnNcblxuICBnZXRUb3RhbEZhaWxlZEl0ZW1zOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5pbXBvcnRzQ29sbGVjdGlvbi5mYWlsZWRJdGVtcygpLmxlbmd0aCArIHRoaXMuZ2VvY29kaW5nc0NvbGxlY3Rpb24uZmFpbGVkSXRlbXMoKS5sZW5ndGg7XG4gIH0sXG5cbiAgcmVtb3ZlSW1wb3J0SXRlbTogZnVuY3Rpb24obWRsKSB7XG4gICAgaWYgKCFtZGwpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5pbXBvcnRzQ29sbGVjdGlvbi5yZW1vdmUobWRsKTtcbiAgfSxcblxuICBhZGRJbXBvcnRJdGVtOiBmdW5jdGlvbihtZGwpIHtcbiAgICBpZiAoIW1kbCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLmltcG9ydHNDb2xsZWN0aW9uLmFkZChtZGwpO1xuICB9LFxuXG4gIHJlbW92ZUdlb2NvZGluZ0l0ZW06IGZ1bmN0aW9uKG1kbCkge1xuICAgIGlmICghbWRsIHx8ICF0aGlzLmNhbkFkZEltcG9ydCgpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHRoaXMuZ2VvY29kaW5nc0NvbGxlY3Rpb24ucmVtb3ZlKG1kbCk7XG4gIH0sXG5cbiAgYWRkR2VvY29kaW5nSXRlbTogZnVuY3Rpb24obWRsKSB7XG4gICAgaWYgKCFtZGwgfHwgIXRoaXMuY2FuQWRkR2VvY29kaW5nKCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5nZW9jb2RpbmdzQ29sbGVjdGlvbi5hZGQobWRsKTtcbiAgfSxcblxuICByZW1vdmVBbmFseXNpczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5hbmFseXNpc0NvbGxlY3Rpb24uZGVzdHJveUNoZWNrKCk7XG4gICAgdGhpcy5hbmFseXNpc0NvbGxlY3Rpb24ucmVzZXQoKTtcbiAgfSxcblxuICBhZGRBbmFseXNpczogZnVuY3Rpb24oYXJyYXkpIHtcbiAgICBpZiAoIWFycmF5IHx8ICF0aGlzLmNhbkFkZEFuYWx5c2lzKCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5hbmFseXNpc0NvbGxlY3Rpb24ucmVzZXQoYXJyYXkpO1xuICB9LFxuXG4gIGNhbkFkZEltcG9ydDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuaW1wb3J0c0NvbGxlY3Rpb24uY2FuSW1wb3J0KCk7XG4gIH0sXG5cbiAgY2FuQWRkR2VvY29kaW5nOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZW9jb2RpbmdzQ29sbGVjdGlvbi5jYW5HZW9jb2RlKCk7XG4gIH0sXG5cbiAgY2FuQWRkQW5hbHlzaXM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmFuYWx5c2lzQ29sbGVjdGlvbi5jYW5TdGFydFBlY2FuKCk7XG4gIH0sXG5cbiAgZ2V0VG90YWxJbXBvcnRzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5pbXBvcnRzQ29sbGVjdGlvbi5zaXplKCk7XG4gIH0sXG5cbiAgZ2V0VG90YWxHZW9jb2RpbmdzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZW9jb2RpbmdzQ29sbGVjdGlvbi5zaXplKCk7XG4gIH0sXG5cbiAgZ2V0VG90YWxBbmFseXNpczogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuYW5hbHlzaXNDb2xsZWN0aW9uLnNpemUoKSA+IDAgPyAxIDogMDtcbiAgfSxcblxuICBnZXRUb3RhbFBvbGxpbmdzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5pbXBvcnRzQ29sbGVjdGlvbi5zaXplKCkgKyB0aGlzLmdlb2NvZGluZ3NDb2xsZWN0aW9uLnNpemUoKSArICggdGhpcy5hbmFseXNpc0NvbGxlY3Rpb24uaXNBbmFseXppbmcoKSA/IDEgOiAwICk7XG4gIH0sXG5cbiAgc3RvcFBvbGxpbmdzOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5nZXQoJ2dlb2NvZGluZ3NQb2xsaW5nJykpIHtcbiAgICAgIHRoaXMuZ2VvY29kaW5nc0NvbGxlY3Rpb24uZGVzdHJveUNoZWNrKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmdldCgnaW1wb3J0c1BvbGxpbmcnKSkge1xuICAgICAgdGhpcy5pbXBvcnRzQ29sbGVjdGlvbi5kZXN0cm95Q2hlY2soKTtcbiAgICB9XG4gIH0sXG5cbiAgc3RhcnRQb2xsaW5nczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIC8vIERvbid0IHN0YXJ0IHBvbGxpbmdzIGlubWVkaWF0ZWx5LCBcbiAgICAvLyB3YWl0IHNvbWUgc2Vjb25kc1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoc2VsZi5nZXQoJ2dlb2NvZGluZ3NQb2xsaW5nJykpIHtcbiAgICAgICAgc2VsZi5nZW9jb2RpbmdzQ29sbGVjdGlvbi5wb2xsQ2hlY2soKTtcbiAgICAgIH1cbiAgICAgIGlmIChzZWxmLmdldCgnaW1wb3J0c1BvbGxpbmcnKSkge1xuICAgICAgICBzZWxmLmltcG9ydHNDb2xsZWN0aW9uLnBvbGxDaGVjaygpO1xuICAgICAgfSAgXG4gICAgfSwgcG9sbGluZ3NUaW1lcik7XG4gIH0sXG5cbiAgLy8gb25DaGFuZ2UgZnVuY3Rpb25zXG4gIF9vbkltcG9ydHNTdGF0ZUNoYW5nZTogZnVuY3Rpb24oKSB7fSxcblxuICBfb25HZW9jb2RpbmdzU3RhdGVDaGFuZ2U6IGZ1bmN0aW9uKCkge30sXG5cbiAgX29uQW5hbHlzaXNTdGF0ZUNoYW5nZTogZnVuY3Rpb24oKSB7fSxcblxuICBjbGVhbjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5pbXBvcnRzQ29sbGVjdGlvbi51bmJpbmQobnVsbCwgbnVsbCwgdGhpcyk7XG4gICAgdGhpcy5nZW9jb2RpbmdzQ29sbGVjdGlvbi51bmJpbmQobnVsbCwgbnVsbCwgdGhpcyk7XG4gICAgdGhpcy5hbmFseXNpc0NvbGxlY3Rpb24udW5iaW5kKG51bGwsIG51bGwsIHRoaXMpO1xuICAgIHRoaXMuZWxkZXIoJ2NsZWFuJyk7XG4gIH1cblxufSk7XG4iLCJ2YXIgJCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WyckJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyckJ10gOiBudWxsKTtcbnZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIEltcG9ydEl0ZW1WaWV3ID0gcmVxdWlyZSgnLi92aWV3cy9pbXBvcnRzL2JhY2tncm91bmRfaW1wb3J0X2l0ZW1fdmlldycpO1xudmFyIEFuYWx5c2lzSXRlbVZpZXcgPSByZXF1aXJlKCcuL3ZpZXdzL2FuYWx5c2lzL2JhY2tncm91bmRfYW5hbHlzaXNfaXRlbV92aWV3Jyk7XG52YXIgR2VvY29kaW5nSXRlbVZpZXcgPSByZXF1aXJlKCcuL3ZpZXdzL2dlb2NvZGluZ3MvYmFja2dyb3VuZF9nZW9jb2RpbmdfaXRlbV92aWV3Jyk7XG52YXIgSW1wb3J0TGltaXRJdGVtVmlldyA9IHJlcXVpcmUoJy4vdmlld3MvaW1wb3J0cy9iYWNrZ3JvdW5kX2ltcG9ydF9saW1pdF92aWV3Jyk7XG52YXIgSW1wb3J0c01vZGVsID0gcmVxdWlyZSgnLi9tb2RlbHMvaW1wb3J0c19tb2RlbCcpO1xudmFyIEdlb2NvZGluZ01vZGVsID0gcmVxdWlyZSgnLi9tb2RlbHMvZ2VvY29kaW5nX21vZGVsJyk7XG52YXIgQmFja2dyb3VuZFBvbGxpbmdNb2RlbCA9IHJlcXVpcmUoJy4vYmFja2dyb3VuZF9wb2xsaW5nX21vZGVsJyk7XG52YXIgQmFja2dyb3VuZFBvbGxpbmdIZWFkZXJWaWV3ID0gcmVxdWlyZSgnLi92aWV3cy9iYWNrZ3JvdW5kX3BvbGxpbmdfaGVhZGVyX3ZpZXcnKTtcblxuLyoqXG4gKiAgQmFja2dyb3VuZCBwb2xsaW5nIHZpZXdcbiAqXG4gKiAgSXQgd2lsbCBwb29sIGFsbCBwb2xsaW5nIG9wZXJhdGlvbnMgdGhhdCBoYXBwZW5zXG4gKiAgaW4gQ2FydG9kYiwgYXMgaW4gaW1wb3J0cyBhbmQgZ2VvY29kaW5nc1xuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdCYWNrZ3JvdW5kUG9sbGluZycsXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5vcHRpb25zLnVzZXI7XG4gICAgdGhpcy5jcmVhdGVWaXMgPSB0aGlzLm9wdGlvbnMuY3JlYXRlVmlzO1xuICAgIHRoaXMudmlzID0gdGhpcy5vcHRpb25zLnZpcztcbiAgICBpZiAoIXRoaXMubW9kZWwpIHtcbiAgICAgIHRoaXMubW9kZWwgPSBuZXcgQmFja2dyb3VuZFBvbGxpbmdNb2RlbCh7fSwge1xuICAgICAgICB1c2VyOiB0aGlzLnVzZXJcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy9iYWNrZ3JvdW5kX3BvbGxpbmcnKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSgpKTtcbiAgICB0aGlzLl9pbml0Vmlld3MoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2ltcG9ydEFkZGVkJywgdGhpcy5fYWRkSW1wb3J0LCB0aGlzKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2dlb2NvZGluZ0FkZGVkJywgdGhpcy5fYWRkR2VvY29kaW5nLCB0aGlzKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2FuYWx5c2lzQWRkZWQnLCB0aGlzLl9hZGRBbmFseXNpcywgdGhpcyk7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdhbmFseXNpc0FkZGVkIGFuYWx5c2lzUmVtb3ZlZCBpbXBvcnRBZGRlZCBpbXBvcnRSZW1vdmVkIGdlb2NvZGluZ0FkZGVkIGdlb2NvZGluZ1JlbW92ZWQnLCB0aGlzLl9jaGVja1BvbGxpbmdzU2l6ZSwgdGhpcyk7XG4gICAgY2RiLmdvZC5iaW5kKCdpbXBvcnRCeVVwbG9hZERhdGEnLCB0aGlzLl9hZGREYXRhc2V0LCB0aGlzKTtcbiAgICBjZGIuZ29kLmJpbmQoJ2ZpbGVEcm9wcGVkJywgdGhpcy5fb25Ecm9wcGVkRmlsZSwgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbChjZGIuZ29kKTtcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgYmFja2dyb3VuZFBvbGxpbmdIZWFkZXJWaWV3ID0gbmV3IEJhY2tncm91bmRQb2xsaW5nSGVhZGVyVmlldyh7XG4gICAgICBtb2RlbDogdGhpcy5tb2RlbFxuICAgIH0pO1xuXG4gICAgdGhpcy4kZWwucHJlcGVuZChiYWNrZ3JvdW5kUG9sbGluZ0hlYWRlclZpZXcucmVuZGVyKCkuZWwpO1xuICAgIHRoaXMuYWRkVmlldyhiYWNrZ3JvdW5kUG9sbGluZ0hlYWRlclZpZXcpO1xuICB9LFxuXG4gIF9jaGVja1BvbGxpbmdzU2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0VG90YWxQb2xsaW5ncygpID4gMCkge1xuICAgICAgdGhpcy5zaG93KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaGlkZSgpO1xuICAgIH1cbiAgfSxcblxuICBfYWRkQW5hbHlzaXM6IGZ1bmN0aW9uKGNvbGxlY3Rpb24pIHtcblxuICAgIGlmICh0aGlzLl9hbmFseXNpc0l0ZW0pIHtcbiAgICAgIHRoaXMuX2FuYWx5c2lzSXRlbS5jbGVhbigpO1xuICAgIH1cblxuICAgIHRoaXMuX2FuYWx5c2lzSXRlbSA9IG5ldyBBbmFseXNpc0l0ZW1WaWV3KHtcbiAgICAgIGNvbGxlY3Rpb246IGNvbGxlY3Rpb24sXG4gICAgICB2aXM6IHRoaXMudmlzLFxuICAgICAgdXNlcjogdGhpcy51c2VyXG4gICAgfSk7XG5cbiAgICB0aGlzLl9hbmFseXNpc0l0ZW0uYmluZCgncmVtb3ZlJywgZnVuY3Rpb24obWRsKSB7XG4gICAgICB0aGlzLm1vZGVsLnJlbW92ZUFuYWx5c2lzKCk7XG4gICAgfSwgdGhpcyk7XG5cbiAgICB0aGlzLiQoJy5qcy1saXN0JykucHJlcGVuZCh0aGlzLl9hbmFseXNpc0l0ZW0ucmVuZGVyKCkuZWwpO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLl9hbmFseXNpc0l0ZW0pO1xuICB9LFxuXG4gIF9hZGRHZW9jb2Rpbmc6IGZ1bmN0aW9uKG1kbCkge1xuICAgIHZhciBnZW9jb2RpbmdJdGVtID0gbmV3IEdlb2NvZGluZ0l0ZW1WaWV3KHtcbiAgICAgIHNob3dHZW9jb2RpbmdEYXRhc2V0VVJMQnV0dG9uOiB0aGlzLm1vZGVsLmdldCgnc2hvd0dlb2NvZGluZ0RhdGFzZXRVUkxCdXR0b24nKSxcbiAgICAgIG1vZGVsOiBtZGwsXG4gICAgICB1c2VyOiB0aGlzLnVzZXJcbiAgICB9KTtcblxuICAgIGdlb2NvZGluZ0l0ZW0uYmluZCgncmVtb3ZlJywgZnVuY3Rpb24obWRsKSB7XG4gICAgICB0aGlzLm1vZGVsLnJlbW92ZUdlb2NvZGluZ0l0ZW0obWRsKTtcbiAgICB9LCB0aGlzKTtcblxuICAgIHRoaXMuJCgnLmpzLWxpc3QnKS5wcmVwZW5kKGdlb2NvZGluZ0l0ZW0ucmVuZGVyKCkuZWwpO1xuICAgIHRoaXMuYWRkVmlldyhnZW9jb2RpbmdJdGVtKTtcblxuICAgIC8vIEVuYWJsZSBwb2xsaW5ncyBhZ2FpblxuICAgIHRoaXMuZW5hYmxlKCk7XG4gIH0sXG5cbiAgX2FkZEltcG9ydDogZnVuY3Rpb24obSkge1xuICAgIHZhciBpbXBvcnRJdGVtID0gbmV3IEltcG9ydEl0ZW1WaWV3KHtcbiAgICAgIHNob3dTdWNjZXNzRGV0YWlsc0J1dHRvbjogdGhpcy5tb2RlbC5nZXQoJ3Nob3dTdWNjZXNzRGV0YWlsc0J1dHRvbicpLFxuICAgICAgbW9kZWw6IG0sXG4gICAgICB1c2VyOiB0aGlzLnVzZXJcbiAgICB9KTtcblxuICAgIGltcG9ydEl0ZW0uYmluZCgncmVtb3ZlJywgZnVuY3Rpb24obWRsKSB7XG4gICAgICB0aGlzLm1vZGVsLnJlbW92ZUltcG9ydEl0ZW0obWRsKTtcbiAgICB9LCB0aGlzKTtcblxuICAgIHRoaXMuJCgnLmpzLWxpc3QnKS5wcmVwZW5kKGltcG9ydEl0ZW0ucmVuZGVyKCkuZWwpO1xuICAgIHRoaXMuYWRkVmlldyhpbXBvcnRJdGVtKTtcblxuICAgIHRoaXMuZW5hYmxlKCk7XG4gIH0sXG5cbiAgX2FkZERhdGFzZXQ6IGZ1bmN0aW9uKGQpIHtcbiAgICBpZiAoZCkge1xuICAgICAgdGhpcy5fYWRkSW1wb3J0c0l0ZW0oZCk7XG4gICAgfVxuICB9LFxuXG4gIF9vbkRyb3BwZWRGaWxlOiBmdW5jdGlvbihmaWxlcykge1xuICAgIGlmIChmaWxlcykge1xuICAgICAgdGhpcy5fYWRkSW1wb3J0c0l0ZW0oe1xuICAgICAgICB0eXBlOiAnZmlsZScsXG4gICAgICAgIHZhbHVlOiBmaWxlcyxcbiAgICAgICAgY3JlYXRlX3ZpczogdGhpcy5jcmVhdGVWaXNcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBfYWRkSW1wb3J0c0l0ZW06IGZ1bmN0aW9uKHVwbG9hZERhdGEpIHtcbiAgICBpZiAodGhpcy5tb2RlbC5jYW5BZGRJbXBvcnQoKSkge1xuICAgICAgdGhpcy5fcmVtb3ZlTGltaXRJdGVtKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2FkZExpbWl0SXRlbSgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHZhciBpbXAgPSBuZXcgSW1wb3J0c01vZGVsKHt9LCB7XG4gICAgICB1cGxvYWQ6IHVwbG9hZERhdGEsXG4gICAgICB1c2VyOiB0aGlzLnVzZXJcbiAgICB9KTtcbiAgICB0aGlzLm1vZGVsLmFkZEltcG9ydEl0ZW0oaW1wKTtcbiAgfSxcblxuICAvLyBMaW1pdHMgdmlld1xuXG4gIF9hZGRMaW1pdEl0ZW06IGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy5faW1wb3J0TGltaXQpIHtcbiAgICAgIHZhciB2ID0gbmV3IEltcG9ydExpbWl0SXRlbVZpZXcoe1xuICAgICAgICB1c2VyOiB0aGlzLnVzZXJcbiAgICAgIH0pO1xuICAgICAgdGhpcy4kKCcuanMtbGlzdCcpLnByZXBlbmQodi5yZW5kZXIoKS5lbCk7XG4gICAgICB0aGlzLmFkZFZpZXcodik7XG4gICAgICB0aGlzLl9pbXBvcnRMaW1pdCA9IHY7XG4gICAgfVxuICB9LFxuXG4gIF9yZW1vdmVMaW1pdEl0ZW06IGZ1bmN0aW9uKCkge1xuICAgIHZhciB2ID0gdGhpcy5faW1wb3J0TGltaXQ7XG4gICAgaWYgKHYpIHtcbiAgICAgIHYuY2xlYW4oKTtcbiAgICAgIHRoaXMucmVtb3ZlVmlldyh2KTtcbiAgICAgIGRlbGV0ZSB0aGlzLl9pbXBvcnRMaW1pdDtcbiAgICB9XG4gIH0sXG5cbiAgLy8gRW5hYmxlIGJhY2tncm91bmQgcG9sbGluZyBjaGVja2luZ1xuICAvLyBvbmdvaW5nIGltcG9ydHNcbiAgZW5hYmxlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLnN0YXJ0UG9sbGluZ3MoKTtcbiAgfSxcblxuICAvLyBEaXNhYmxlL3N0b3AgYmFja2dyb3VuZCBwb2xsaW5nc1xuICBkaXNhYmxlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLnN0b3BQb2xsaW5ncygpO1xuICB9LFxuXG4gIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmFkZENsYXNzKCdpcy12aXNpYmxlJyk7XG4gIH0sXG5cbiAgaGlkZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwucmVtb3ZlQ2xhc3MoJ2lzLXZpc2libGUnKTtcbiAgfSxcblxuICBjbGVhbjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5kaXNhYmxlKCk7XG4gICAgdGhpcy5lbGRlcignY2xlYW4nKTtcbiAgfVxuXG59KTtcbiIsInZhciBCYWNrYm9uZSA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydCYWNrYm9uZSddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnQmFja2JvbmUnXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgUGVjYW4gPSByZXF1aXJlKCdjYXJ0b2RiLXBlY2FuJyk7XG52YXIgUGVjYW5Nb2RlbCA9IHJlcXVpcmUoJy4vcGVjYW5fbW9kZWwnKTtcbnZhciBiYXRjaEFuYWx5c2lzQ291bnQgPSA1O1xuXG4vKipcbiAqICBBbmFseXNpcyBjb2xsZWN0aW9uXG4gKlxuICogIC0gR2V0IHRoZSBzdGF0cyBvZiB0aGUgY3VycmVudCBsYXllclxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHtcblxuICBtb2RlbDogUGVjYW5Nb2RlbCxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbihtZGxzLCBvcHRzKSB7XG4gICAgdGhpcy51c2VyID0gb3B0cy51c2VyO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuYmluZCgncmVzZXQnLCB0aGlzLnBvbGxDaGVjaywgdGhpcyk7XG4gIH0sXG5cbiAgLy8gUHVibGljIG1ldGhvZHNcblxuICBjYW5TdGFydFBlY2FuOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRUb3RhbEFuYWx5c2lzKCkgPT09IHRoaXMuZ2V0Q29tcGxldGVkQW5hbHlzaXMoKVxuICB9LFxuXG4gIHBvbGxDaGVjazogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX25leHRBbmFseXNpc0l0ZW1zKSB7XG4gICAgICBfLmVhY2godGhpcy5fbmV4dEFuYWx5c2lzSXRlbXMsIGZ1bmN0aW9uKG1kbCkge1xuICAgICAgICBtZGwudW5iaW5kKG51bGwsIG51bGwsIHRoaXMpO1xuICAgICAgfSwgdGhpcyk7XG4gICAgfVxuXG4gICAgdmFyIGlkbGVJdGVtcyA9IF8uZmlyc3QodGhpcy53aGVyZSh7IHN0YXRlOiAnaWRsZScgfSksYmF0Y2hBbmFseXNpc0NvdW50KTtcblxuICAgIGlmIChpZGxlSXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5fbmV4dEFuYWx5c2lzSXRlbXMgPSBpZGxlSXRlbXM7XG5cbiAgICAgIF8uZWFjaCh0aGlzLl9uZXh0QW5hbHlzaXNJdGVtcywgZnVuY3Rpb24obWRsKSB7XG4gICAgICAgIGlmICh0aGlzLnVzZXIuZmVhdHVyZUVuYWJsZWQoJ3BlY2FuX2RlYnVnZ2luZycpKSB7XG4gICAgICAgICAgbWRsLmJpbmQoJ3ByaW50X3N0YXRzJywgZnVuY3Rpb24oc3RhdHMpIHtcbiAgICAgICAgICAgIHRoaXMuX3ByaW50U3RhdHMoc3RhdHMpO1xuICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIG1kbC5iaW5kKCdjaGFuZ2U6c3RhdGUnLCBmdW5jdGlvbihtZGwsIHN0YXRlKSB7XG4gICAgICAgICAgaWYgKG1kbC5pc0FuYWx5emVkKCkpIHtcbiAgICAgICAgICAgIHZhciBhcmVQZW5kaW5nQW5hbHlzaXMgPSBfLmZpbmQodGhpcy5fbmV4dEFuYWx5c2lzSXRlbXMsIGZ1bmN0aW9uKGFuYWx5c2lzKSB7XG4gICAgICAgICAgICAgIHJldHVybiAhYW5hbHlzaXMuaXNBbmFseXplZCgpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICghYXJlUGVuZGluZ0FuYWx5c2lzKSB7XG4gICAgICAgICAgICAgIHRoaXMucG9sbENoZWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgbWRsLmdldERhdGEoKTtcbiAgICAgIH0sIHRoaXMpO1xuICAgIH1cbiAgfSxcblxuICBfcHJpbnRTdGF0czogZnVuY3Rpb24oc3RhdHMpIHtcbiAgICB2YXIgbmFtZSAgICAgICAgPSBzdGF0cy5jb2x1bW47XG4gICAgdmFyIHR5cGUgICAgICAgID0gc3RhdHMudHlwZTtcbiAgICB2YXIgd2VpZ2h0ICAgICAgPSBzdGF0cy53ZWlnaHQ7XG4gICAgdmFyIHNrZXcgICAgICAgID0gc3RhdHMuc2tldztcbiAgICB2YXIgZGlzdGluY3QgICAgPSBzdGF0cy5kaXN0aW5jdDtcbiAgICB2YXIgY291bnQgICAgICAgPSBzdGF0cy5jb3VudDtcbiAgICB2YXIgbnVsbF9yYXRpbyAgPSBzdGF0cy5udWxsX3JhdGlvO1xuICAgIHZhciBkaXN0X3R5cGUgICA9IHN0YXRzLmRpc3RfdHlwZTtcbiAgICB2YXIgY2FsY193ZWlnaHQgPSAod2VpZ2h0ICsgUGVjYW4uZ2V0V2VpZ2h0RnJvbVNoYXBlKGRpc3RfdHlwZSkpIC8gMjtcblxuICAgIHZhciBkaXN0aW5jdFBlcmNlbnRhZ2UgPSAoZGlzdGluY3QgLyBjb3VudCkgKiAxMDA7XG5cbiAgICBjZGIubG9nLmluZm8oXCIlY0FuYWx5emluZyAlY1wiICsgbmFtZSwgXCJ0ZXh0LWRlY29yYXRpb246dW5kZXJsaW5lOyBmb250LXdlaWdodDpib2xkXCIsIFwidGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZTsgZm9udC13ZWlnaHQ6bm9ybWFsXCIpO1xuXG4gICAgY2RiLmxvZy5pbmZvKCclYyDCtyAlY3R5cGUlYyA9ICcgKyB0eXBlLCAnY29sb3I6IzY2NjsnLCAnY29sb3I6ICM2NjY7IGZvbnQtd2VpZ2h0OmJvbGQ7JywgXCJjb2xvcjogIzY2NjsgZm9udC13ZWlnaHQ6bm9ybWFsXCIpO1xuICAgIGNkYi5sb2cuaW5mbygnJWMgwrcgJWNkaXN0aW5jdFBlcmNlbnRhZ2UlYyA9ICcgKyBkaXN0aW5jdFBlcmNlbnRhZ2UsICdjb2xvcjojNjY2OycsICdjb2xvcjogIzY2NjsgZm9udC13ZWlnaHQ6Ym9sZDsnLCBcImNvbG9yOiAjNjY2OyBmb250LXdlaWdodDpub3JtYWxcIik7XG4gICAgY2RiLmxvZy5pbmZvKCclYyDCtyAlY2NvdW50JWMgPSAnICsgY291bnQsICdjb2xvcjojNjY2OycsICdjb2xvcjogIzY2NjsgZm9udC13ZWlnaHQ6Ym9sZDsnLCAnY29sb3I6ICM2NjY7IGZvbnQtd2VpZ2h0Om5vcm1hbDsnKTtcbiAgICBjZGIubG9nLmluZm8oJyVjIMK3ICVjbnVsbCByYXRpbyVjID0gJyArIG51bGxfcmF0aW8sICdjb2xvcjojNjY2OycsICdjb2xvcjogIzY2NjsgZm9udC13ZWlnaHQ6Ym9sZDsnLCAnY29sb3I6ICM2NjY7IGZvbnQtd2VpZ2h0Om5vcm1hbDsnKTtcblxuICAgIGlmIChkaXN0X3R5cGUpIHtcbiAgICAgIGNkYi5sb2cuaW5mbygnJWMgwrcgJWNkaXN0X3R5cGUlYyA9ICcgKyBkaXN0X3R5cGUsICdjb2xvcjojNjY2OycsICdjb2xvcjogIzY2NjsgZm9udC13ZWlnaHQ6Ym9sZDsnLCAnY29sb3I6ICM2NjY7IGZvbnQtd2VpZ2h0Om5vcm1hbDsnKTtcbiAgICAgIGNkYi5sb2cuaW5mbygnJWMgwrcgJWNjYWxjX3dlaWdodCVjID0gJyArIGNhbGNfd2VpZ2h0LCAnY29sb3I6IzY2NjsnLCAnY29sb3I6ICM2NjY7IGZvbnQtd2VpZ2h0OmJvbGQ7JywgJ2NvbG9yOiAjNjY2OyBmb250LXdlaWdodDpub3JtYWw7Jyk7XG4gICAgfVxuXG4gICAgaWYgKHNrZXcpIHtcbiAgICAgIGNkYi5sb2cuaW5mbyhcIiVjIMK3ICVjc2tldyVjOiBcIiArIHNrZXcudG9GaXhlZCgyKSwgXCJjb2xvcjojNjY2O1wiLCAnY29sb3I6ICM2NjY7IGZvbnQtd2VpZ2h0OmJvbGQ7JywgJ2NvbG9yOiAjNjY2OyBmb250LXdlaWdodDpub3JtYWw7Jyk7XG4gICAgfVxuXG4gICAgaWYgKHdlaWdodCkge1xuICAgICAgY2RiLmxvZy5pbmZvKFwiJWMgwrcgJWN3ZWlnaHQlYzogXCIgKyB3ZWlnaHQudG9GaXhlZCgyKSwgXCJjb2xvcjogIzY2NjtcIiwgXCJjb2xvcjojNjY2OyBmb250LXdlaWdodDpib2xkO1wiLCBcImNvbG9yOiM2NjY7Zm9udC13ZWlnaHQ6bm9ybWFsXCIpO1xuICAgIH1cblxuICAgIGlmIChzdGF0cy5kZW5zaXR5KSB7XG4gICAgICBjZGIubG9nLmluZm8oXCIlYyDCtyAlY2RlbnNpdHklYzogXCIgKyBzdGF0cy5kZW5zaXR5LCBcImNvbG9yOiM2NjY7XCIsICdjb2xvcjogIzY2NjsgZm9udC13ZWlnaHQ6Ym9sZDsnLCAnY29sb3I6ICM2NjY7IGZvbnQtd2VpZ2h0Om5vcm1hbDsnKTtcbiAgICB9XG5cbiAgfSxcblxuICBkZXN0cm95Q2hlY2s6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBpdGVtcyA9IHRoaXMud2hlcmUoeyBzdGF0ZTogJ2lkbGUnIH0pO1xuICAgIHRoaXMucmVtb3ZlKGl0ZW1zKTtcbiAgfSxcblxuICBmYWlsZWRJdGVtczogZnVuY3Rpb24oKSB7fSxcblxuICBnZXRUb3RhbEFuYWx5c2lzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5zaXplKCk7XG4gIH0sXG5cbiAgZ2V0U3VjY2Vzc2Z1bGx5QW5hbHlzZWRDb2x1bW5zOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy53aGVyZSh7IHN1Y2Nlc3M6IHRydWUgfSkubGVuZ3RoO1xuICB9LFxuXG4gIGdldENvbXBsZXRlZEFuYWx5c2lzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy53aGVyZSh7IHN0YXRlOiAnYW5hbHl6ZWQnIH0pLmxlbmd0aDtcbiAgfSxcblxuICBpc0FuYWx5emluZzogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Q29tcGxldGVkQW5hbHlzaXMoKSAhPT0gdGhpcy5nZXRUb3RhbEFuYWx5c2lzKCk7XG4gIH1cblxufSk7XG4iLCJ2YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIEdlb2NvZGluZ01vZGVsUG9sbGVyID0gcmVxdWlyZSgnLi9nZW9jb2RpbmdfbW9kZWxfcG9sbGVyJyk7XG5cbi8qKlxuICogIEdlb2NvZGluZyBtb2RlbFxuICpcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIG9wdGlvbnM6IHtcbiAgICBzdGFydFBvbGxpbmdBdXRvbWF0aWNhbGx5OiB0cnVlXG4gIH0sXG5cbiAgZGVmYXVsdHM6IHtcbiAgICBraW5kOiAnJyxcbiAgICBmb3JtYXR0ZXI6ICcnLFxuICAgIHRhYmxlX25hbWU6ICcnLFxuICAgIHN0YXRlOiAnJ1xuICB9LFxuXG4gIHVybDogZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgdmFyIHZlcnNpb24gPSBjZGIuY29uZmlnLnVybFZlcnNpb24oJ2dlb2NvZGluZycsIG1ldGhvZCk7XG5cbiAgICB2YXIgYmFzZSA9ICcvYXBpLycgKyB2ZXJzaW9uICsgJy9nZW9jb2RpbmdzLyc7XG4gICAgaWYgKHRoaXMuaXNOZXcoKSkge1xuICAgICAgcmV0dXJuIGJhc2U7XG4gICAgfVxuICAgIHJldHVybiBiYXNlICsgdGhpcy5pZDtcbiAgfSxcblxuICBzZXRVcmxSb290OiBmdW5jdGlvbih1cmxSb290KSB7XG4gICAgdGhpcy51cmxSb290ID0gdXJsUm9vdDtcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRzKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICAgIF8uZXh0ZW5kKHRoaXMub3B0aW9ucywgb3B0cyk7XG4gICAgdGhpcy5wb2xsZXIgPSBuZXcgR2VvY29kaW5nTW9kZWxQb2xsZXIodGhpcyk7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5zdGFydFBvbGxpbmdBdXRvbWF0aWNhbGx5KSB7XG4gICAgICB0aGlzLl9jaGVja01vZGVsKCk7XG4gICAgfTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmJpbmQoJ2NoYW5nZTppZCcsIHRoaXMuX2NoZWNrTW9kZWwsIHRoaXMpO1xuICB9LFxuXG4gIF9jaGVja01vZGVsOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICBpZiAodGhpcy5nZXQoJ2lkJykpIHtcbiAgICAgIHRoaXMucG9sbENoZWNrKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3NhdmVNb2RlbCgpO1xuICAgIH1cbiAgfSxcblxuICBfc2F2ZU1vZGVsOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgaWYgKHRoaXMuaXNOZXcoKSkge1xuICAgICAgdGhpcy5zYXZlKHt9LCB7XG4gICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBzZWxmLnNldCh7XG4gICAgICAgICAgICBzdGF0ZTogJ2ZhaWxlZCcsXG4gICAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgICB0aXRsZTogJ09vcHMsIHRoZXJlIHdhcyBhIHByb2JsZW0nLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1VuZm9ydHVuYXRlbHkgdGhlcmUgd2FzIGFuIGVycm9yIHN0YXJ0aW5nIHRoZSBnZW9jb2RlcidcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIHBvbGxDaGVjazogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wb2xsZXIuc3RhcnQoKTtcbiAgfSxcblxuICBkZXN0cm95Q2hlY2s6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucG9sbGVyLnN0b3AoKTtcbiAgfSxcblxuICBnZXRFcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdlcnJvcicpO1xuICB9LFxuXG4gIGhhc0ZhaWxlZDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHN0YXRlID0gdGhpcy5nZXQoJ3N0YXRlJyk7XG4gICAgcmV0dXJuIHN0YXRlID09PSBcImZhaWxlZFwiIHx8IHN0YXRlID09PSBcInJlc2V0XCIgfHwgc3RhdGUgPT09IFwiY2FuY2VsbGVkXCJcbiAgfSxcblxuICBoYXNDb21wbGV0ZWQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnc3RhdGUnKSA9PT0gXCJmaW5pc2hlZFwiXG4gIH0sXG5cbiAgaXNPbmdvaW5nOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gIXRoaXMuaGFzQ29tcGxldGVkKCkgJiYgIXRoaXMuaGFzRmFpbGVkKClcbiAgfSxcblxuICBjYW5jZWxHZW9jb2Rpbmc6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2F2ZSh7IHN0YXRlOiAnY2FuY2VsbGVkJyB9LCB7IHdhaXQ6dHJ1ZSB9KTtcbiAgfSxcblxuICByZXNldEdlb2NvZGluZzogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXQoJ3N0YXRlJywgJ3Jlc2V0Jyk7XG4gIH1cbn0pO1xuIiwidmFyIFBvbGxlciA9IHJlcXVpcmUoJy4vcG9sbGVyJyk7XG5cbnZhciBHZW9jb2RpbmdNb2RlbFBvbGxlciA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cbiAgdmFyIFBPTExJTkdfSU5URVJWQUwgPSAyMDAwO1xuXG4gIHZhciBvcHRpb25zID0ge1xuICAgIGludGVydmFsOiBQT0xMSU5HX0lOVEVSVkFMLFxuICAgIHN0b3BXaGVuOiBmdW5jdGlvbihtb2RlbCkge1xuICAgICAgcmV0dXJuIG1vZGVsLmhhc0ZhaWxlZCgpIHx8IG1vZGVsLmhhc0NvbXBsZXRlZCgpO1xuICAgIH0sXG4gICAgZXJyb3I6IGZ1bmN0aW9uKG1vZGVsKSB7XG4gICAgICBtb2RlbC50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgIH1cbiAgfTtcblxuICBQb2xsZXIuY2FsbCh0aGlzLCBtb2RlbCwgb3B0aW9ucyk7XG59O1xuXG5HZW9jb2RpbmdNb2RlbFBvbGxlci5wcm90b3R5cGUgPSBfLmV4dGVuZCh7fSwgUG9sbGVyLnByb3RvdHlwZSk7XG5cbm1vZHVsZS5leHBvcnRzID0gR2VvY29kaW5nTW9kZWxQb2xsZXI7XG4iLCJ2YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIHBvbGxUaW1lciA9IDYwMDAwO1xudmFyIEdlb2NvZGluZ01vZGVsID0gcmVxdWlyZSgnLi9nZW9jb2RpbmdfbW9kZWwnKTtcblxuLyoqXG4gKiAgR2VvY29kaW5ncyBjb2xsZWN0aW9uXG4gKlxuICogIC0gQ2hlY2sgb25nb2luZyBnZW9jb2RpbmdzIGluIG9yZGVyIHRvIGFkZCB0aGVtXG4gKiAgdG8gdGhlIGNvbGxlY3Rpb24uXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoe1xuXG4gIG1vZGVsOiBHZW9jb2RpbmdNb2RlbCxcblxuICB1cmw6IGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgIHZhciB2ZXJzaW9uID0gY2RiLmNvbmZpZy51cmxWZXJzaW9uKCdnZW9jb2RpbmcnLCBtZXRob2QpO1xuICAgIHJldHVybiAnL2FwaS8nICsgdmVyc2lvbiArICcvZ2VvY29kaW5ncyc7XG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24obWRscywgb3B0cykge1xuICAgIHRoaXMudXNlciA9IG9wdHMudXNlcjsgXG4gICAgdGhpcy52aXMgPSBvcHRzLnZpcztcbiAgfSxcblxuICBwYXJzZTogZnVuY3Rpb24ocikge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIF8uZWFjaChyLmdlb2NvZGluZ3MsIGZ1bmN0aW9uKGRhdGEpIHtcblxuICAgICAgLy8gQ2hlY2sgaWYgdGhhdCBnZW9jb2RpbmcgZXhpc3RzLi4uXG4gICAgICB2YXIgZ2VvY29kaW5ncyA9IHNlbGYuZmlsdGVyKFxuICAgICAgICBmdW5jdGlvbihtZGwpIHtcbiAgICAgICAgICByZXR1cm4gbWRsLmdldCgnaWQnKSA9PT0gZGF0YS5pZFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBpZiAoZ2VvY29kaW5ncy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgc2VsZi5fY2hlY2tPbmdvaW5nR2VvY29kaW5nKFxuICAgICAgICAgIG5ldyBHZW9jb2RpbmdNb2RlbChkYXRhLCB7IHN0YXJ0UG9sbGluZ0F1dG9tYXRpY2FsbHk6IGZhbHNlIH0pXG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLm1vZGVsc1xuICB9LFxuXG4gIF9jaGVja09uZ29pbmdHZW9jb2Rpbmc6IGZ1bmN0aW9uKG1kbCkge1xuICAgIGlmICghdGhpcy52aXMpIHtcbiAgICAgIC8vIElmIHRoZXJlIGlzIE5PVCBhIHZpcywgbGV0J3Mgc3RhcnQgcG9sbGluZ1xuICAgICAgLy8gdGhpcyBnZW9jb2RpbmcgbW9kZWxcbiAgICAgIHRoaXMuYWRkKG1kbCk7XG4gICAgICBtZGwucG9sbENoZWNrKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIC8vIElmIHRoZXJlIGlzIGEgdmlzLCBsZXQncyBjaGVjayBpZiB0aGF0XG4gICAgICAvLyBnZW9jb2RpbmcgYmVsb25ncyB0byB0aGUgdmlzdWFsaXphdGlvblxuICAgICAgdGhpcy52aXMubWFwLmxheWVycy5lYWNoKGZ1bmN0aW9uKGx5cikge1xuICAgICAgICBpZiAobHlyLnRhYmxlICYmIGx5ci50YWJsZS5pZCA9PT0gbWRsLmdldCgndGFibGVfbmFtZScpKSB7XG4gICAgICAgICAgc2VsZi5hZGQobWRsKTtcbiAgICAgICAgICBtZGwucG9sbENoZWNrKCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG4gIC8vIFB1YmxpYyBtZXRob2RzXG5cbiAgY2FuR2VvY29kZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICF0aGlzLmFueShmdW5jdGlvbihtKSB7XG4gICAgICByZXR1cm4gbS5pc09uZ29pbmcoKTtcbiAgICB9KTtcbiAgfSxcblxuICBmZXRjaEdlb2NvZGluZ3M6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLmZldGNoKHtcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIHNlbGYuZGVzdHJveUNoZWNrKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgcG9sbENoZWNrOiBmdW5jdGlvbihpKSB7XG4gICAgaWYgKHRoaXMucG9sbFRpbWVyKSByZXR1cm47XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5wb2xsVGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgIHNlbGYuZmV0Y2hHZW9jb2RpbmdzKCk7XG4gICAgfSwgcG9sbFRpbWVyKTtcblxuICAgIHRoaXMuZmV0Y2hHZW9jb2RpbmdzKCk7XG4gIH0sXG5cbiAgZGVzdHJveUNoZWNrOiBmdW5jdGlvbigpIHtcbiAgICBjbGVhckludGVydmFsKHRoaXMucG9sbFRpbWVyKTtcbiAgICBkZWxldGUgdGhpcy5wb2xsVGltZXI7XG4gIH0sXG5cbiAgZmFpbGVkSXRlbXM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICByZXR1cm4gaXRlbS5oYXNGYWlsZWQoKTtcbiAgICB9KTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIGNkYkFkbWluID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydhZG1pbiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ2FkbWluJ10gOiBudWxsKTtcbnZhciBJbXBvcnRNb2RlbFBvbGxlciA9IHJlcXVpcmUoJy4vaW1wb3J0X21vZGVsX3BvbGxlcicpO1xuXG4vKipcbiAqICBOZXcgaW1wb3J0IG1vZGVsIHRoYXQgY29udHJvbHNcbiAqICB0aGUgc3RhdGUgb2YgYW4gaW1wb3J0XG4gKlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgdXJsOiBmdW5jdGlvbihtZXRob2QpIHtcbiAgICB2YXIgdmVyc2lvbiA9IGNkYi5jb25maWcudXJsVmVyc2lvbignaW1wb3J0JywgbWV0aG9kKTtcbiAgICB2YXIgYmFzZSA9ICcvYXBpLycgKyB2ZXJzaW9uICsgJy9pbXBvcnRzJztcblxuICAgIGlmICh0aGlzLmlzTmV3KCkpIHtcbiAgICAgIHJldHVybiBiYXNlO1xuICAgIH1cbiAgICByZXR1cm4gYmFzZSArICcvJyArIHRoaXMuaWQ7XG4gIH0sXG5cbiAgaWRBdHRyaWJ1dGU6ICdpdGVtX3F1ZXVlX2lkJyxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICB0aGlzLnBvbGxlciA9IG5ldyBJbXBvcnRNb2RlbFBvbGxlcih0aGlzKTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmJpbmQoJ2NoYW5nZTppdGVtX3F1ZXVlX2lkJywgdGhpcy5fY2hlY2tRdWV1ZUlkLCB0aGlzKTtcbiAgfSxcblxuICBjcmVhdGVJbXBvcnQ6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICB2YXIgZCA9IHRoaXMuX3ByZXBhcmVEYXRhKGRhdGEpO1xuICAgIHRoaXNbZC5pbnRlcnZhbCA9PT0gMCA/ICdfY3JlYXRlUmVndWxhckltcG9ydCcgOiAnX2NyZWF0ZVN5bmNJbXBvcnQnXShkKTtcbiAgfSxcblxuICBfY2hlY2tRdWV1ZUlkOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5nZXQoJ2l0ZW1fcXVldWVfaWQnKSkge1xuICAgICAgdGhpcy5wb2xsQ2hlY2soKTtcbiAgICB9XG4gIH0sXG5cbiAgX3ByZXBhcmVEYXRhOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgdmFyIGQgPSB7XG4gICAgICBjcmVhdGVfdmlzOiBkYXRhLmNyZWF0ZV92aXMsXG4gICAgICBwcml2YWN5OiBkYXRhLnByaXZhY3lcbiAgICB9O1xuXG4gICAgdmFyIHR5cGUgPSBkYXRhLnR5cGU7XG5cbiAgICBpZiAodHlwZSAhPT0gJ3JlbW90ZScpIHtcbiAgICAgIF8uZXh0ZW5kKGQsIHtcbiAgICAgICAgdHlwZV9ndWVzc2luZzogZGF0YS50eXBlX2d1ZXNzaW5nLFxuICAgICAgICBjb250ZW50X2d1ZXNzaW5nOiBkYXRhLmNvbnRlbnRfZ3Vlc3NpbmcsXG4gICAgICAgIGludGVydmFsOiBkYXRhLmludGVydmFsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB2YXIgc2VydmljZSA9IGRhdGEuc2VydmljZV9uYW1lO1xuXG4gICAgLy8gVXJsP1xuICAgIGlmICh0eXBlID09PSBcInVybFwiKSB7XG4gICAgICBfLmV4dGVuZChkLCB7XG4gICAgICAgIHVybDogZGF0YS52YWx1ZVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gUmVtb3RlP1xuICAgIGlmICh0eXBlID09PSBcInJlbW90ZVwiKSB7XG4gICAgICBfLmV4dGVuZChkLCB7XG4gICAgICAgIHR5cGU6IFwicmVtb3RlXCIsXG4gICAgICAgIGludGVydmFsOiBudWxsLFxuICAgICAgICByZW1vdGVfdmlzdWFsaXphdGlvbl9pZDogZGF0YS5yZW1vdGVfdmlzdWFsaXphdGlvbl9pZCxcbiAgICAgICAgY3JlYXRlX3ZpczogZmFsc2UsXG4gICAgICAgIHZhbHVlOiBkYXRhLnZhbHVlXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBTUUw/XG4gICAgaWYgKHR5cGUgPT09IFwic3FsXCIpIHtcbiAgICAgIF8uZXh0ZW5kKGQsIHtcbiAgICAgICAgdGFibGVfbmFtZTogZGF0YS50YWJsZV9uYW1lLFxuICAgICAgICBzcWw6IGRhdGEudmFsdWVcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIER1cGxpY2F0ZT9cbiAgICBpZiAodHlwZSA9PT0gXCJkdXBsaWNhdGlvblwiKSB7XG4gICAgICBfLmV4dGVuZChkLCB7XG4gICAgICAgIHRhYmxlX25hbWU6IGRhdGEudGFibGVfbmFtZSxcbiAgICAgICAgdGFibGVfY29weTogZGF0YS52YWx1ZVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gU2VydmljZT9cbiAgICBpZiAodHlwZSA9PT0gXCJzZXJ2aWNlXCIpIHtcbiAgICAgIC8vIElmIHNlcnZpY2UgaXMgVHdpdHRlciwgc2VydmljZV9pdGVtX2lkIHNob3VsZCBiZVxuICAgICAgLy8gc2VudCBzdHJpbmdpZmllZFxuICAgICAgdmFyIHNlcnZpY2VfaXRlbV9pZCA9IChzZXJ2aWNlID09PSBcInR3aXR0ZXJfc2VhcmNoXCIpXG4gICAgICAgICAgPyBKU09OLnN0cmluZ2lmeShkYXRhLnNlcnZpY2VfaXRlbV9pZClcbiAgICAgICAgICA6IGRhdGEuc2VydmljZV9pdGVtX2lkO1xuXG4gICAgICAvLyBVc2VyIGRlZmluZWQgbGltaXRzP1xuICAgICAgaWYgKGRhdGEudXNlcl9kZWZpbmVkX2xpbWl0cykge1xuICAgICAgICBkLnVzZXJfZGVmaW5lZF9saW1pdHMgPSBkYXRhLnVzZXJfZGVmaW5lZF9saW1pdHM7XG4gICAgICB9XG5cbiAgICAgIF8uZXh0ZW5kKGQsIHtcbiAgICAgICAgdmFsdWU6ICAgICAgICAgICAgZGF0YS52YWx1ZSxcbiAgICAgICAgc2VydmljZV9uYW1lOiAgICAgZGF0YS5zZXJ2aWNlX25hbWUsXG4gICAgICAgIHNlcnZpY2VfaXRlbV9pZDogIHNlcnZpY2VfaXRlbV9pZFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGQ7XG4gIH0sXG5cbiAgX2NyZWF0ZVN5bmNJbXBvcnQ6IGZ1bmN0aW9uKGQpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgLy8gQ3JlYXRlIHN5bmNocm9uaXphdGlvbiBtb2RlbFxuICAgIHZhciBzeW5jID0gbmV3IGNkYkFkbWluLlRhYmxlU3luY2hyb25pemF0aW9uKGQpO1xuXG4gICAgc3luYy5zYXZlKG51bGwsIHtcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKG0pIHtcbiAgICAgICAgc2VsZi5zZXQoJ2l0ZW1fcXVldWVfaWQnLCBtLmdldCgnZGF0YV9pbXBvcnQnKS5pdGVtX3F1ZXVlX2lkKTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24obWRsLCByLCBvcHRzKSB7XG4gICAgICAgIHNlbGYuX3NldEVycm9yU3RhdGUocik7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgX2NyZWF0ZVJlZ3VsYXJJbXBvcnQ6IGZ1bmN0aW9uKGQpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB0aGlzLnNhdmUoZCwge1xuICAgICAgZXJyb3I6IGZ1bmN0aW9uKG1kbCwgciwgb3B0cykge1xuICAgICAgICBzZWxmLl9zZXRFcnJvclN0YXRlKHIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIF9zZXRFcnJvclN0YXRlOiBmdW5jdGlvbihyKSB7XG4gICAgdmFyIG1zZztcbiAgICB0cnkge1xuICAgICAgbXNnID0gciAmJiBKU09OLnBhcnNlKHIucmVzcG9uc2VUZXh0KS5lcnJvcnMuaW1wb3J0cztcbiAgICB9IGNhdGNoKGVycikge1xuICAgICAgLy8gZS5nLiBpZiByZXNwb25zZVRleHQgaXMgZW1wdHkgKHNlZW1zIHRvIGhhcHBlbiB3aGVuIHNlcnZlciBpcyBkb3duL29mZmxpbmUpXG4gICAgICBtc2cgPSAnVW5mb3J0dW5hdGVseSB0aGVyZSB3YXMgYW4gZXJyb3Igc3RhcnRpbmcgdGhlIGltcG9ydCc7XG4gICAgfVxuICAgIHRoaXMuc2V0KHtcbiAgICAgIHN0YXRlOiAnZmFpbHVyZScsXG4gICAgICBnZXRfZXJyb3JfdGV4dDoge1xuICAgICAgICB0aXRsZTogJ1RoZXJlIHdhcyBhbiBlcnJvcicsXG4gICAgICAgIHdoYXRfYWJvdXQ6IG1zZ1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIHBvbGxDaGVjazogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wb2xsZXIuc3RhcnQoKTtcbiAgfSxcblxuICBkZXN0cm95Q2hlY2s6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucG9sbGVyLnN0b3AoKTtcbiAgfVxuXG59KTtcbiIsInZhciBQb2xsZXIgPSByZXF1aXJlKCcuL3BvbGxlcicpO1xuXG52YXIgSW1wb3J0TW9kZWxQb2xsZXIgPSBmdW5jdGlvbihtb2RlbCkge1xuXG4gIHZhciBQT0xMSU5HX0lOVEVSVkFMID0gMjAwMDsgLy8gSW50ZXJ2YWwgdGltZSBiZXR3ZWVuIHBvbGwgY2hlY2tpbmdzXG4gIHZhciBQT0xMSU5HX0lOVEVSVkFMX01VTFRJUExJRVIgPSAyLjU7ICAvLyBNdWx0aXBseSBpbnRlcnZhbCBieSB0aGlzIG51bWJlclxuICB2YXIgUE9MTElOR19SRVFVRVNUU19CRUZPUkVfSU5URVJWQUxfQ0hBTkdFID0gMzA7IC8vIE1heCB0cmllcyB1bnRpbCBpbnRlcnZhbCBjaGFuZ2VcblxuICB2YXIgb3B0aW9ucyA9IHtcbiAgICBpbnRlcnZhbDogZnVuY3Rpb24obnVtYmVyT2ZSZXF1ZXN0cykge1xuICAgICAgaWYgKG51bWJlck9mUmVxdWVzdHMgPj0gUE9MTElOR19SRVFVRVNUU19CRUZPUkVfSU5URVJWQUxfQ0hBTkdFKSB7XG4gICAgICAgIHJldHVybiBQT0xMSU5HX0lOVEVSVkFMICogUE9MTElOR19JTlRFUlZBTF9NVUxUSVBMSUVSO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFBPTExJTkdfSU5URVJWQUw7XG4gICAgfSxcbiAgICBzdG9wV2hlbjogZnVuY3Rpb24obW9kZWwpIHtcbiAgICAgIHZhciBzdGF0ZSA9IG1vZGVsLmdldCgnc3RhdGUnKTtcbiAgICAgIHJldHVybiAoc3RhdGUgPT09IFwiY29tcGxldGVcIiB8fCBzdGF0ZSA9PT0gXCJmYWlsdXJlXCIpO1xuICAgIH1cbiAgfTtcblxuICBQb2xsZXIuY2FsbCh0aGlzLCBtb2RlbCwgb3B0aW9ucyk7XG59O1xuXG5JbXBvcnRNb2RlbFBvbGxlci5wcm90b3R5cGUgPSBfLmV4dGVuZCh7fSwgUG9sbGVyLnByb3RvdHlwZSk7XG5cbm1vZHVsZS5leHBvcnRzID0gSW1wb3J0TW9kZWxQb2xsZXI7XG4iLCIvKiBnbG9iYWwgY2RiICovXG52YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIHBvbGxUaW1lciA9IDMwMDAwO1xudmFyIEltcG9ydHNNb2RlbCA9IHJlcXVpcmUoJy4vaW1wb3J0c19tb2RlbCcpO1xuXG4vKipcbiAqICBJbXBvcnRzIGNvbGxlY3Rpb25cbiAqXG4gKiAgSWYgaXQgaXMgZmV0Y2hlZCwgaXQgd2lsbCBhZGQgdGhlIGltcG9ydFxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHtcblxuICBtb2RlbDogSW1wb3J0c01vZGVsLFxuXG4gIHVybDogZnVuY3Rpb24gKG1ldGhvZCkge1xuICAgIHZhciB2ZXJzaW9uID0gY2RiLmNvbmZpZy51cmxWZXJzaW9uKCdpbXBvcnQnLCBtZXRob2QpO1xuICAgIHJldHVybiAnL2FwaS8nICsgdmVyc2lvbiArICcvaW1wb3J0cyc7XG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG1kbHMsIG9wdHMpIHtcbiAgICB0aGlzLnVzZXIgPSBvcHRzLnVzZXI7XG4gIH0sXG5cbiAgcGFyc2U6IGZ1bmN0aW9uIChyKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgaWYgKHIuaW1wb3J0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMuZGVzdHJveUNoZWNrKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIF8uZWFjaChyLmltcG9ydHMsIGZ1bmN0aW9uIChpZCkge1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRoYXQgaW1wb3J0IGV4aXN0cy4uLlxuICAgICAgICB2YXIgaW1wb3J0cyA9IHNlbGYuZmlsdGVyKGZ1bmN0aW9uIChtZGwpeyByZXR1cm4gbWRsLmltcC5nZXQoJ2l0ZW1fcXVldWVfaWQnKSA9PT0gaWQgfSk7XG5cbiAgICAgICAgaWYgKGltcG9ydHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgc2VsZi5hZGQobmV3IEltcG9ydHNNb2RlbCh7IGlkOiBpZCB9LCB7IHVzZXI6IHNlbGYudXNlciB9ICkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5tb2RlbHNcbiAgfSxcblxuICBjYW5JbXBvcnQ6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaW1wb3J0UXVvdGEgPSB0aGlzLnVzZXIuZ2V0TWF4Q29uY3VycmVudEltcG9ydHMoKTtcbiAgICB2YXIgdG90YWwgPSB0aGlzLnNpemUoKTtcbiAgICB2YXIgZmluaXNoZWQgPSAwO1xuXG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uIChtKSB7XG4gICAgICBpZiAobS5oYXNGYWlsZWQoKSB8fCBtLmhhc0NvbXBsZXRlZCgpKSB7XG4gICAgICAgICsrZmluaXNoZWQ7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gKHRvdGFsIC0gZmluaXNoZWQpIDwgaW1wb3J0UXVvdGE7XG4gIH0sXG5cbiAgcG9sbENoZWNrOiBmdW5jdGlvbiAoaSkge1xuICAgIGlmICh0aGlzLnBvbGxUaW1lcikgcmV0dXJuO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMucG9sbFRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgc2VsZi5mZXRjaCgpO1xuICAgIH0sIHBvbGxUaW1lciB8fCAyMDAwKTtcblxuICAgIC8vIFN0YXJ0IGRvaW5nIGEgZmV0Y2hcbiAgICB0aGlzLmZldGNoKCk7XG4gIH0sXG5cbiAgZGVzdHJveUNoZWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnBvbGxUaW1lcik7XG4gICAgZGVsZXRlIHRoaXMucG9sbFRpbWVyO1xuICB9LFxuXG4gIGNvbXBsZXRlZEl0ZW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICByZXR1cm4gaXRlbS5oYXNDb21wbGV0ZWQoKTtcbiAgICB9KTtcbiAgfSxcblxuICBnZXRDb21wbGV0ZWRJdGVtc0NvdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29tcGxldGVkSXRlbXMoKS5sZW5ndGg7XG4gIH0sXG5cbiAgZmFpbGVkSXRlbXM6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIHJldHVybiBpdGVtLmhhc0ZhaWxlZCgpO1xuICAgIH0pO1xuICB9LFxuXG4gIGdldEZhaWxlZEl0ZW1zQ291bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5mYWlsZWRJdGVtcygpLmxlbmd0aDtcbiAgfSxcblxuICBhbGxJbXBvcnRzQ29tcGxldGVkT3JGYWlsZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5hbGwoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIHJldHVybiBpdGVtLmhhc0NvbXBsZXRlZCgpIHx8XG4gICAgICAgIGl0ZW0uaGFzRmFpbGVkKCk7XG4gICAgfSk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBJbXBvcnRNb2RlbCA9IHJlcXVpcmUoJy4vaW1wb3J0X21vZGVsJyk7XG52YXIgVXBsb2FkTW9kZWwgPSByZXF1aXJlKCcuL3VwbG9hZF9tb2RlbCcpO1xuXG4vKipcbiAqICBVcGxvYWQvaW1wb3J0IG1vZGVsXG4gKlxuICogIEl0IHRha2VzIHRoZSBjb250cm9sIG9mIHRoZSB1cGxvYWQgYW5kIGltcG9ydCxcbiAqICBsaXN0ZW5pbmcgdGhlIGNoYW5nZSBvZiBhbnkgb2YgdGhlc2Ugc3RlcHMuXG4gKlxuICogIFN0ZXBzOlxuICogIC0gdXBsb2FkXG4gKiAgLSBpbXBvcnRcbiAqXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBkZWZhdWx0czoge1xuICAgIHN0ZXA6ICd1cGxvYWQnLFxuICAgIHN0YXRlOiAnJ1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChhdHRycywgb3B0cykge1xuICAgIGlmIChfLmlzRW1wdHkob3B0cykpIG9wdHMgPSB7fTtcbiAgICB0aGlzLnVzZXIgPSBvcHRzICYmIG9wdHMudXNlcjtcbiAgICB0aGlzLnVwbCA9IG5ldyBVcGxvYWRNb2RlbChvcHRzLnVwbG9hZCwgeyB1c2VyOiB0aGlzLnVzZXIgfSk7XG4gICAgdGhpcy5pbXAgPSBuZXcgSW1wb3J0TW9kZWwob3B0cy5pbXBvcnQpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICAgIHRoaXMuX2NoZWNrU3RhdHVzKCk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuYmluZCgnY2hhbmdlOmltcG9ydCcsICB0aGlzLl9vbkltcG9ydENoYW5nZSwgdGhpcyk7XG4gICAgdGhpcy5iaW5kKCdjaGFuZ2U6dXBsb2FkJywgIHRoaXMuX29uVXBsb2FkQ2hhbmdlLCB0aGlzKTtcbiAgICB0aGlzLmJpbmQoJ2NoYW5nZTppZCcsICAgICAgdGhpcy5fb25JZENoYW5nZSwgdGhpcyk7XG5cbiAgICB0aGlzLmltcC5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZTppbXBvcnQnKTtcbiAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy51cGwuYmluZCgnY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2U6dXBsb2FkJyk7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgIH0sIHRoaXMpO1xuICB9LFxuXG4gIF9kZXN0cm95QmluZHM6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnVwbC51bmJpbmQobnVsbCwgbnVsbCwgdGhpcyk7XG4gICAgdGhpcy5pbXAudW5iaW5kKG51bGwsIG51bGwsIHRoaXMpO1xuICB9LFxuXG4gIF9vbklkQ2hhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGl0ZW1fcXVldWVfaWQgPSB0aGlzLmdldCgnaWQnKTtcbiAgICBpZiAoaXRlbV9xdWV1ZV9pZCkgdGhpcy5pbXAuc2V0KCdpdGVtX3F1ZXVlX2lkJywgaXRlbV9xdWV1ZV9pZCk7XG4gICAgdGhpcy5zZXQoJ3N0ZXAnLCAnaW1wb3J0Jyk7XG4gIH0sXG5cbiAgX29uVXBsb2FkQ2hhbmdlOiBmdW5jdGlvbiAobSwgaSkge1xuICAgIGlmICh0aGlzLmdldCgnc3RlcCcpID09PSBcInVwbG9hZFwiKSB7XG4gICAgICB2YXIgaXRlbV9xdWV1ZV9pZCA9IHRoaXMudXBsLmdldCgnaXRlbV9xdWV1ZV9pZCcpO1xuICAgICAgdmFyIHN0YXRlID0gdGhpcy51cGwuZ2V0KCdzdGF0ZScpO1xuXG4gICAgICBpZiAoaXRlbV9xdWV1ZV9pZCkgdGhpcy5zZXQoJ2lkJywgaXRlbV9xdWV1ZV9pZCk7XG4gICAgICBpZiAoc3RhdGUpIHRoaXMuc2V0KCdzdGF0ZScsIHN0YXRlKTtcbiAgICB9XG4gIH0sXG5cbiAgX29uSW1wb3J0Q2hhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMuZ2V0KCdzdGVwJykgPT09IFwiaW1wb3J0XCIpIHtcbiAgICAgIHZhciBzdGF0ZSA9IHRoaXMuaW1wLmdldCgnc3RhdGUnKTtcbiAgICAgIGlmIChzdGF0ZSkgdGhpcy5zZXQoJ3N0YXRlJywgc3RhdGUpO1xuICAgIH1cbiAgfSxcblxuICBfY2hlY2tTdGF0dXM6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIXRoaXMuZ2V0KCdpZCcpICYmICF0aGlzLnVwbC5pc1ZhbGlkKCkpIHtcbiAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlOnVwbG9hZCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnVwbC5nZXQoJ3R5cGUnKSA9PT0gJ2ZpbGUnKSB7XG4gICAgICB0aGlzLnVwbC51cGxvYWQoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuZ2V0KCdpZCcpKSB7XG4gICAgICB0aGlzLnNldCgnc3RlcCcsICdpbXBvcnQnKTtcbiAgICAgIHRoaXMuaW1wLnNldCgnaXRlbV9xdWV1ZV9pZCcsIHRoaXMuZ2V0KCdpZCcpKTtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLmltcC5nZXQoJ2l0ZW1fcXVldWVfaWQnKSAmJiB0aGlzLnVwbC5nZXQoJ3R5cGUnKSAhPT0gXCJcIikge1xuICAgICAgdGhpcy5zZXQoJ3N0ZXAnLCAnaW1wb3J0Jyk7XG4gICAgICB0aGlzLmltcC5jcmVhdGVJbXBvcnQodGhpcy51cGwudG9KU09OKCkpO1xuICAgIH1cbiAgfSxcblxuICBwYXVzZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc3RvcFVwbG9hZCgpO1xuICAgIHRoaXMuc3RvcEltcG9ydCgpO1xuICB9LFxuXG4gIGhhc0ZhaWxlZDogZnVuY3Rpb24gKCkge1xuICAgIHZhciBzdGF0ZSA9IHRoaXMuZ2V0KCdzdGF0ZScpO1xuICAgIHZhciBzdGVwID0gdGhpcy5nZXQoJ3N0ZXAnKTtcblxuICAgIHJldHVybiAoc3RlcCA9PT0gJ2ltcG9ydCcgJiYgc3RhdGUgPT09ICdmYWlsdXJlJykgfHxcbiAgICAgIChzdGVwID09PSAndXBsb2FkJyAmJiBzdGF0ZSA9PT0gJ2Vycm9yJyk7XG4gIH0sXG5cbiAgaGFzQ29tcGxldGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHN0YXRlID0gdGhpcy5nZXQoJ3N0YXRlJykgfHwgKHRoaXMuaW1wICYmIHRoaXMuaW1wLmdldCgnc3RhdGUnKSk7XG4gICAgdmFyIHN0ZXAgPSB0aGlzLmdldCgnc3RlcCcpO1xuXG4gICAgcmV0dXJuIHN0ZXAgPT09ICdpbXBvcnQnICYmIHN0YXRlID09PSAnY29tcGxldGUnO1xuICB9LFxuXG4gIGdldFdhcm5pbmdzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHN0ZXAgPSB0aGlzLmdldCgnc3RlcCcpO1xuXG4gICAgcmV0dXJuIHN0ZXAgPT09ICdpbXBvcnQnID8gdGhpcy5pbXAuZ2V0KCd3YXJuaW5ncycpIDogJyc7XG4gIH0sXG5cbiAgZ2V0RXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5oYXNGYWlsZWQoKSkge1xuICAgICAgdmFyIHN0ZXAgPSB0aGlzLmdldCgnc3RlcCcpO1xuICAgICAgcmV0dXJuIF8uZXh0ZW5kKFxuICAgICAgICB7XG4gICAgICAgICAgZXJyb3JfY29kZTogdGhpc1tzdGVwID09PSBcInVwbG9hZFwiID8gJ3VwbCcgOiAnaW1wJ10uZ2V0KCdlcnJvcl9jb2RlJyksXG4gICAgICAgICAgaXRlbV9xdWV1ZV9pZDogc3RlcCA9PT0gXCJpbXBvcnRcIiA/IHRoaXMuaW1wLmdldCgnaWQnKSA6ICcnLFxuICAgICAgICAgIG9yaWdpbmFsX3VybDogc3RlcCA9PT0gXCJpbXBvcnRcIiA/IHRoaXMuaW1wLmdldCgnb3JpZ2luYWxfdXJsJykgOiAnJyxcbiAgICAgICAgICBkYXRhX3R5cGU6IHN0ZXAgPT09IFwiaW1wb3J0XCIgPyB0aGlzLmltcC5nZXQoJ2RhdGFfdHlwZScpIDogJycsXG4gICAgICAgICAgaHR0cF9yZXNwb25zZV9jb2RlOiBzdGVwID09PSBcImltcG9ydFwiID8gdGhpcy5pbXAuZ2V0KCdodHRwX3Jlc3BvbnNlX2NvZGUnKSA6ICcnLFxuICAgICAgICAgIGh0dHBfcmVzcG9uc2VfY29kZV9tZXNzYWdlOiBzdGVwID09PSBcImltcG9ydFwiID8gdGhpcy5pbXAuZ2V0KCdodHRwX3Jlc3BvbnNlX2NvZGVfbWVzc2FnZScpIDogJydcbiAgICAgICAgfVxuICAgICAgICAsXG4gICAgICAgIHRoaXNbc3RlcCA9PT0gXCJ1cGxvYWRcIiA/ICd1cGwnIDogJ2ltcCddLmdldCgnZ2V0X2Vycm9yX3RleHQnKVxuICAgICAgKVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB0aXRsZTogJycsXG4gICAgICB3aGF0X2Fib3V0OiAnJyxcbiAgICAgIGVycm9yX2NvZGU6ICcnXG4gICAgfTtcbiAgfSxcblxuICBnZXROdW1iZXJPZlRhYmxlc0NyZWF0ZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5pbXAuZ2V0KCd0YWJsZXNfY3JlYXRlZF9jb3VudCcpO1xuICB9LFxuXG4gIF9nZXRTZXJ2aWNlTmFtZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmltcC5nZXQoJ3NlcnZpY2VfbmFtZScpO1xuICB9LFxuXG4gIGlzVHdpdHRlckltcG9ydDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLl9nZXRTZXJ2aWNlTmFtZSgpID09PSAndHdpdHRlcl9zZWFyY2gnO1xuICB9LFxuXG4gIGlzQ2FydG9JbXBvcnQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5fZ2V0RGlzcGxheU5hbWUoKSAmJiB0aGlzLl9nZXREaXNwbGF5TmFtZSgpLm1hdGNoKC9cXC5jYXJ0byQvaSk7XG4gIH0sXG5cbiAgX2dldERpc3BsYXlOYW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuaW1wLmdldCgnZGlzcGxheV9uYW1lJyk7XG4gIH0sXG5cbiAgaW1wb3J0ZWRWaXM6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5nZXQoJ2ltcG9ydCcpLmRlcml2ZWRfdmlzdWFsaXphdGlvbl9pZCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2dldE1hcFZpcygpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5fZ2V0RGF0YXNldFZpcygpO1xuICAgIH1cbiAgfSxcblxuICBfZ2V0TWFwVmlzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGRlcml2ZWRWaXNJZCA9IHRoaXMuaW1wLmdldCgnZGVyaXZlZF92aXN1YWxpemF0aW9uX2lkJyk7XG5cbiAgICBpZiAoIWRlcml2ZWRWaXNJZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9jcmVhdGVWaXMoe1xuICAgICAgdHlwZTogJ2Rlcml2ZWQnLFxuICAgICAgaWQ6IGRlcml2ZWRWaXNJZFxuICAgIH0pO1xuICB9LFxuXG4gIF9nZXREYXRhc2V0VmlzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRhYmxlTmFtZSA9IHRoaXMuaW1wLmdldCgndGFibGVfbmFtZScpO1xuXG4gICAgaWYgKCF0YWJsZU5hbWUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fY3JlYXRlVmlzKHtcbiAgICAgIHR5cGU6ICd0YWJsZScsXG4gICAgICB0YWJsZToge1xuICAgICAgICBuYW1lOiB0YWJsZU5hbWVcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBfY3JlYXRlVmlzOiBmdW5jdGlvbiAoYXR0cnMpIHtcbiAgICB2YXIgdmlzID0gbmV3IGNkYi5hZG1pbi5WaXN1YWxpemF0aW9uKGF0dHJzKTtcbiAgICB2aXMucGVybWlzc2lvbi5vd25lciA9IHRoaXMudXNlcjtcbiAgICByZXR1cm4gdmlzO1xuICB9LFxuXG4gIHNldEVycm9yOiBmdW5jdGlvbiAob3B0cykge1xuICAgIHZhciBzdGVwID0gdGhpcy5nZXQoJ3N0ZXAnKTtcbiAgICB2YXIgc3RlcE1vZGVsID0gdGhpc1sgc3RlcCA9PT0gXCJ1cGxvYWRcIiA/ICd1cGwnIDogJ2ltcCcgXTtcblxuICAgIHRoaXMuc3RvcFVwbG9hZCgpO1xuICAgIHRoaXMuc3RvcEltcG9ydCgpO1xuXG4gICAgc3RlcE1vZGVsLnNldChvcHRzKTtcblxuICAgIHRoaXMuc2V0KCdzdGF0ZScsICdlcnJvcicpO1xuICB9LFxuXG4gIHN0b3BVcGxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnVwbC5zdG9wVXBsb2FkKCk7XG4gIH0sXG5cbiAgc3RvcEltcG9ydDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaW1wLmRlc3Ryb3lDaGVjaygpO1xuICB9LFxuXG4gIGdldDogZnVuY3Rpb24gKGF0dHIpIHtcbiAgICBpZiAoYXR0ciA9PT0gXCJ1cGxvYWRcIikgcmV0dXJuIHRoaXMudXBsLnRvSlNPTigpO1xuICAgIGlmIChhdHRyID09PSBcImltcG9ydFwiKSByZXR1cm4gdGhpcy5pbXAudG9KU09OKCk7XG5cbiAgICByZXR1cm4gY2RiLmNvcmUuTW9kZWwucHJvdG90eXBlLmdldC5jYWxsKHRoaXMsIGF0dHIpO1xuICB9LFxuXG4gIC8vIFJldHVybnMgYSBVUkwgd2hlcmUgdGhlIGdpdmVuIHVzZXIgY2FuIGJlIHJlZGlyZWN0ZWRcbiAgLy8gYWZ0ZXIgdGhlIGltcG9ydCBoYXMgY29tcGxldGVkXG4gIGdldFJlZGlyZWN0VXJsOiBmdW5jdGlvbiAodXNlcikge1xuICAgIHZhciB2aXMgPSB0aGlzLmltcG9ydGVkVmlzKCk7XG4gICAgaWYgKHZpcykge1xuICAgICAgcmV0dXJuIGVuY29kZVVSSSh2aXMudmlld1VybCh1c2VyKS5lZGl0KCkpO1xuICAgIH1cbiAgfSxcblxuICB0b0pTT046IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3RlcDogdGhpcy5nZXQoJ3N0ZXAnKSxcbiAgICAgIGlkOiB0aGlzLmdldCgnaWQnKSxcbiAgICAgIHN0YXRlOiB0aGlzLmdldCgnc3RhdGUnKSxcbiAgICAgIHVwbG9hZDogdGhpcy51cGwudG9KU09OKCksXG4gICAgICBpbXBvcnQ6IHRoaXMuaW1wLnRvSlNPTigpXG4gICAgfTtcbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xuXG4vKipcbiAqIEEgc3BlY2lhbCBjYXNlIG9mIGEgZ2VvY29kaW5nIG1vZGVsLCBzaW5jZSBsb24vbGF0IGdlb2NvZGluZyBpcyBub3QgYWN0dWFsbHkgZ29pbmcgdGhyb3VnaCB0aGUgY29tbW9uIGFzeW5jIHByb2Nlc3NpbmdcbiAqIGFzIHRoZSByZXN0LlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oYXR0cnMpIHtcbiAgICBpZiAoIWF0dHJzLnRhYmxlKSB0aHJvdyBuZXcgRXJyb3IoJ3RhYmxlIGlzIHJlcXVpcmVkJyk7XG4gICAgaWYgKCFhdHRycy5sb25naXR1ZGVfY29sdW1uKSB0aHJvdyBuZXcgRXJyb3IoJ2xvbmdpdHVkZV9jb2x1bW4gaXMgcmVxdWlyZWQnKTtcbiAgICBpZiAoIWF0dHJzLmxhdGl0dWRlX2NvbHVtbikgdGhyb3cgbmV3IEVycm9yKCdsYXRpdHVkZV9jb2x1bW4gaXMgcmVxdWlyZWQnKTtcbiAgICBpZiAoIV8uaXNCb29sZWFuKGF0dHJzLmZvcmNlX2FsbF9yb3dzKSkgdGhyb3cgbmV3IEVycm9yKCdmb3JjZV9hbGxfcm93cyBpcyByZXF1aXJlZCcpO1xuXG4gICAgdGhpcy5zZXQoJ3RhYmxlX25hbWUnLCBhdHRycy50YWJsZS5nZXQoJ25hbWUnKSk7XG5cbiAgICB0aGlzLl9zdGFydEdlb2NvZGluZygpO1xuICB9LFxuXG4gIF9zdGFydEdlb2NvZGluZzogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fY2hhbmdlU3RhdGUoJ2lzT25nb2luZycpO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciB0YWJsZSA9IHRoaXMuZ2V0KCd0YWJsZScpO1xuICAgIHRhYmxlLnNhdmUoe1xuICAgICAgbG9uZ2l0dWRlX2NvbHVtbjogdGhpcy5nZXQoJ2xvbmdpdHVkZV9jb2x1bW4nKSxcbiAgICAgIGxhdGl0dWRlX2NvbHVtbjogdGhpcy5nZXQoJ2xhdGl0dWRlX2NvbHVtbicpLFxuICAgICAgZm9yY2VfYWxsX3Jvd3M6IHRoaXMuZ2V0KCdmb3JjZV9hbGxfcm93cycpXG4gICAgfSwge1xuICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIHdoZW4gZmluaXNoIGZldGNoIHRoZSBkYXRhIGFnYWluIGFuZCB0aHJvdyBhIHNpZ25hbCB0byBub3RpZnkgdGhlIGNoYW5nZXNcbiAgICAgICAgLy8gVE9ETzogdGhpcyBzaG91bGQgbm90IGV4aXN0LCBnZW9tZXRyeV90eXBlcyBjaGFuZ2Ugc2hvdWxkIGJlIG1vbml0b3JlZFxuICAgICAgICB0YWJsZS50cmlnZ2VyKCdnZW9sb2NhdGVkJyk7XG4gICAgICAgIHRhYmxlLmRhdGEoKS5mZXRjaCgpO1xuICAgICAgICBzZWxmLl9jaGFuZ2VTdGF0ZSgnaGFzQ29tcGxldGVkJyk7XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKG1zZywgcmVzcCkge1xuICAgICAgICB2YXIgZXJyb3I7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZXJyb3IgPSByZXNwICYmIEpTT04ucGFyc2UocmVzcC5yZXNwb25zZVRleHQpLmVycm9yc1swXTtcbiAgICAgICAgfSBjYXRjaChlcnIpIHtcbiAgICAgICAgICAvLyBlLmcuIGlmIHJlc3BvbnNlVGV4dCBpcyBlbXB0eSAoc2VlbXMgdG8gaGFwcGVuIHdoZW4gc2VydmVyIGlzIGRvd24vb2ZmbGluZSlcbiAgICAgICAgICBlcnJvciA9ICdVbmtub3duIGVycm9yJztcbiAgICAgICAgfVxuICAgICAgICBzZWxmLnNldCgnZXJyb3InLCBlcnJvcik7XG4gICAgICAgIHNlbGYuX2NoYW5nZVN0YXRlKCdoYXNGYWlsZWQnKTtcbiAgICAgIH0sXG4gICAgICB3YWl0OiB0cnVlIC8vIGRvbid0IHVwZGF0ZSBhdHRycyB1bnRpbCBzdWNjZXNzIGlzIHRyaWdnZXJlZFxuICAgIH0pO1xuICB9LFxuXG4gIGlzT25nb2luZzogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdpc09uZ29pbmcnKTtcbiAgfSxcblxuICBoYXNDb21wbGV0ZWQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnaGFzQ29tcGxldGVkJyk7XG4gIH0sXG5cbiAgaGFzRmFpbGVkOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2hhc0ZhaWxlZCcpO1xuICB9LFxuXG4gIGdldEVycm9yOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2Vycm9yJyk7XG4gIH0sXG5cbiAgX2NoYW5nZVN0YXRlOiBmdW5jdGlvbihuZXdTdGF0ZSkge1xuICAgIHZhciBjaGFuZ2VkU3RhdGVzID0gXy5yZWR1Y2UoWydpc09uZ29pbmcnLCAnaGFzQ29tcGxldGVkJywgJ2hhc0ZhaWxlZCddLCBmdW5jdGlvbihtZW1vLCBzdGF0ZSkge1xuICAgICAgbWVtb1tzdGF0ZV0gPSBzdGF0ZSA9PT0gbmV3U3RhdGU7XG4gICAgICByZXR1cm4gbWVtbztcbiAgICB9LCB7fSk7XG4gICAgdGhpcy5zZXQoY2hhbmdlZFN0YXRlcyk7XG4gIH1cblxufSk7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIFBlY2FuID0gcmVxdWlyZSgnY2FydG9kYi1wZWNhbicpO1xuXG4vKipcbiAqICBQZWNhbiBtb2RlbFxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgX1BSSU5UX1NUQVRTOiB0cnVlLFxuXG4gIGRlZmF1bHRzOiB7XG4gICAgdGFibGVfaWQ6ICcnLFxuICAgIGNvbHVtbjogJycsXG4gICAgc3RhdGU6ICdpZGxlJ1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIF8uYmluZEFsbCh0aGlzLCBcIl9vbkRlc2NyaWJlXCIpO1xuICAgIHRoaXMuc3FsID0gY2RiLmFkbWluLlNRTCgpO1xuICAgIHRoaXMucXVlcnkgPSAnU0VMRUNUICogRlJPTSAnICsgdGhpcy5nZXQoXCJ0YWJsZV9pZFwiKTtcbiAgfSxcblxuICBnZXREYXRhOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNxbC5kZXNjcmliZSh0aGlzLnF1ZXJ5LCB0aGlzLmdldChcImNvbHVtblwiKSwge30sIHRoaXMuX29uRGVzY3JpYmUpO1xuICB9LFxuXG4gIF9vbkRlc2NyaWJlOiBmdW5jdGlvbihzdGF0cykge1xuICAgIHZhciBwcm9wZXJ0aWVzID0ge1xuICAgICAgc3RhdGU6IFwiYW5hbHl6ZWRcIixcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlXG4gICAgfTtcblxuICAgIGlmICh0aGlzLl9QUklOVF9TVEFUUykge1xuICAgICAgdGhpcy50cmlnZ2VyKCdwcmludF9zdGF0cycsIHN0YXRzLCB0aGlzKTtcbiAgICB9XG5cbiAgICB2YXIgaGFzRW5vdWdoVG9HdWVzcyA9IFBlY2FuLmhhc0Vub3VnaFRvR3Vlc3Moe1xuICAgICAgc3RhdHM6IHN0YXRzLFxuICAgICAgaXNQb2ludEdlb21ldHJ5VHlwZTogdGhpcy5nZXQoJ2dlb21ldHJ5X3R5cGUnKSA9PT0gJ3BvaW50J1xuICAgIH0pO1xuXG4gICAgaWYgKGhhc0Vub3VnaFRvR3Vlc3MpIHtcbiAgICAgIHZhciByZXNwb25zZSA9IFBlY2FuLmd1ZXNzTWFwKHtcbiAgICAgICAgdGFibGVOYW1lOiB0aGlzLmdldCgndGFibGVfaWQnKSxcbiAgICAgICAgY29sdW1uOiB7XG4gICAgICAgICAgc3RhdHM6IHN0YXRzLFxuICAgICAgICAgIGdlb21ldHJ5VHlwZTogdGhpcy5nZXQoJ2dlb21ldHJ5X3R5cGUnKSxcbiAgICAgICAgICBiYm94OiB0aGlzLmdldCgnYmJveCcpXG4gICAgICAgIH0sXG4gICAgICAgIGRlcGVuZGVuY2llczoge1xuICAgICAgICAgIHVuZGVyc2NvcmU6IF9cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChyZXNwb25zZSkge1xuICAgICAgICB2YXIgb3ZlcnJpZGVzID0ge1xuICAgICAgICAgIHNxbDogdGhpcy5xdWVyeSxcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIHByb3BlcnRpZXMgPSBfLmV4dGVuZChwcm9wZXJ0aWVzLCBvdmVycmlkZXMsIHN0YXRzLCByZXNwb25zZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHN0YXRzLnR5cGUgPT09ICdnZW9tJyAmJiBzdGF0cy5iYm94KSB7XG4gICAgICBwcm9wZXJ0aWVzLmJib3ggPSBzdGF0cy5iYm94O1xuICAgIH1cblxuICAgIHRoaXMuc2V0KHByb3BlcnRpZXMpO1xuICB9LFxuXG4gIGlzQW5hbHl6ZWQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnc3RhdGUnKSA9PT0gJ2FuYWx5emVkJztcbiAgfSxcblxuICBoYXNGYWlsZWQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnc3RhdGUnKSA9PT0gJ2ZhaWxlZCc7XG4gIH1cblxufSk7XG4iLCIvKlxuICogUGVyaW9kaWNhbGx5IGZldGNoZXMgYSBtb2RlbC9jb2xsZWN0aW9uLiBJdCB3YWl0cyBmb3Igb25nb2luZyBcbiAqIGZldGNoIHJlcXVlc3RzIGJlZm9yZSB0cnlpbmcgdG8gZmV0Y2ggYWdhaW4uIEEgc3RvcCBjb25kaXRpb25cbiAqIGNhbiBiZSBzcGVjaWZpZWQuXG4gKlxuICogVXNhZ2UgZXhhbXBsZTpcbiAqIFxuICogdmFyIHBvbGxlciA9IG5ldyBQb2xsZXIobW9kZWwsIHtcbiAqICAgaW50ZXJ2YWw6IDEwMDAsXG4gKiAgIHN0b3BXaGVuOiBmdW5jdGlvbihtb2RlbCkge1xuICogICAgIHJldHVybiBtb2RlbC5nZXQoJ3N0YXRlJykgPT09ICdjb21wbGV0ZWQnO1xuICogICB9XG4gKiB9KTtcbiAqIFxuICogcG9sbGVyLnN0YXJ0KCk7XG4gKlxuICogLy8gLi4uXG4gKlxuICogcG9sbGVyLnN0b3AoKTtcbiAqIFxuICovXG52YXIgUG9sbGVyID0gZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHtcbiAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICB0aGlzLm51bWJlck9mUmVxdWVzdHMgPSAwO1xuICB0aGlzLnBvbGxpbmcgPSBmYWxzZTtcbiAgdGhpcy5pbnRlcnZhbCA9IG9wdGlvbnNbJ2ludGVydmFsJ107XG4gIGlmICh0eXBlb2YgdGhpcy5pbnRlcnZhbCAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgdGhpcy5pbnRlcnZhbCA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gb3B0aW9uc1snaW50ZXJ2YWwnXTsgfTtcbiAgfVxuICB0aGlzLnN0b3BXaGVuID0gb3B0aW9uc1snc3RvcFdoZW4nXTtcbiAgdGhpcy5lcnJvciA9IG9wdGlvbnNbJ2Vycm9yJ107XG4gIHRoaXMuYXV0b1N0YXJ0ID0gb3B0aW9uc1snYXV0b1N0YXJ0J107XG5cbiAgaWYgKHRoaXMuYXV0b1N0YXJ0KSB7XG4gICAgdGhpcy5zdGFydCgpO1xuICB9XG59XG5cblBvbGxlci5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMudGltZW91dCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMuX3NjaGVkdWxlRmV0Y2goKTtcbn1cblxuUG9sbGVyLnByb3RvdHlwZS5fc2NoZWR1bGVGZXRjaCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnRpbWVvdXQgPSBzZXRUaW1lb3V0KHRoaXMuX2ZldGNoLmJpbmQodGhpcyksIHRoaXMuaW50ZXJ2YWwodGhpcy5udW1iZXJPZlJlcXVlc3RzKSk7XG59XG5cblBvbGxlci5wcm90b3R5cGUuX2ZldGNoID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgaWYgKCFzZWxmLnBvbGxpbmcpIHtcbiAgICBzZWxmLnBvbGxpbmcgPSB0cnVlO1xuICAgIHNlbGYubW9kZWwuZmV0Y2goe1xuICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgIHNlbGYucG9sbGluZyA9IGZhbHNlO1xuICAgICAgICBzZWxmLm51bWJlck9mUmVxdWVzdHMrKztcbiAgICAgICAgaWYgKHNlbGYuX2NvbnRpbnVlUG9sbGluZygpKSB7XG4gICAgICAgICAgc2VsZi5fc2NoZWR1bGVGZXRjaCgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgXy5pc0Z1bmN0aW9uKHNlbGYuZXJyb3IpICYmIHNlbGYuZXJyb3Ioc2VsZi5tb2RlbCk7XG4gICAgICB9XG4gICAgfSlcbiAgfVxufVxuXG5Qb2xsZXIucHJvdG90eXBlLl9jb250aW51ZVBvbGxpbmcgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuICF0aGlzLnN0b3BXaGVuIHx8XG4gICAgKF8uaXNGdW5jdGlvbih0aGlzLnN0b3BXaGVuKSAmJiAhdGhpcy5zdG9wV2hlbih0aGlzLm1vZGVsKSk7XG59XG5cblBvbGxlci5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnBvbGxpbmcgPSBmYWxzZTtcbiAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7XG4gIGRlbGV0ZSh0aGlzLnRpbWVvdXQpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFBvbGxlcjtcbiIsIlxuLyoqXG4gKiAgRGVmYXVsdCB1cGxvYWQgY29uZmlnXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICB1cGxvYWRTdGF0ZXM6IFtcbiAgICAnZW5xdWV1ZWQnLFxuICAgICdwZW5kaW5nJyxcbiAgICAnaW1wb3J0aW5nJyxcbiAgICAndXBsb2FkaW5nJyxcbiAgICAnZ3Vlc3NpbmcnLFxuICAgICd1bnBhY2tpbmcnLFxuICAgICdnZXR0aW5nJyxcbiAgICAnY3JlYXRpbmcnLFxuICAgICdjb21wbGV0ZSdcbiAgXSxcbiAgZmlsZUV4dGVuc2lvbnM6IFtcbiAgICAnY3N2JyxcbiAgICAneGxzJyxcbiAgICAneGxzeCcsXG4gICAgJ3ppcCcsXG4gICAgJ2ttbCcsXG4gICAgJ2dlb2pzb24nLFxuICAgICdqc29uJyxcbiAgICAnb2RzJyxcbiAgICAna216JyxcbiAgICAndHN2JyxcbiAgICAnZ3B4JyxcbiAgICAndGFyJyxcbiAgICAnZ3onLFxuICAgICd0Z3onLFxuICAgICdvc20nLFxuICAgICdiejInLFxuICAgICd0aWYnLFxuICAgICd0aWZmJyxcbiAgICAndHh0JyxcbiAgICAnc3FsJyxcbiAgICAncmFyJyxcbiAgICAnY2FydG8nLFxuICAgICdncGtnJ1xuICBdLFxuICAvLyBIb3cgYmlnIHNob3VsZCBmaWxlIGJlP1xuICBmaWxlVGltZXNCaWdnZXI6IDNcbn1cbiIsInZhciBCYWNrYm9uZSA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydCYWNrYm9uZSddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnQmFja2JvbmUnXSA6IG51bGwpO1xudmFyIFVwbG9hZENvbmZpZyA9IHJlcXVpcmUoJy4vdXBsb2FkX2NvbmZpZycpO1xudmFyIFV0aWxzID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydVdGlscyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ1V0aWxzJ10gOiBudWxsKTtcbnZhciBtb21lbnQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snbW9tZW50J10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydtb21lbnQnXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG5cbi8qKlxuICogTW9kZWwgdGhhdCBsZXQgdXNlciB1cGxvYWQgZmlsZXMgdG8gb3VyIGVuZHBvaW50cy5cbiAqXG4gKiBOT1RFOiB0aGlzIG1vZGVsIGV4dGVuZHMgQmFja2JvbmUuTW9kZWwgaW5zdGVhZCBvZiBjZGIuY29yZS5Nb2RlbCwgYmVjYXVzZSBpdCdzIHJlcXVpcmVkIGZvciB0aGVcbiAqIHZlbmRvci9iYWNrYm9uZS1tb2RlbC1maWxlLXVwbG9hZC5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuXG4gIHVybDogJy9hcGkvdjEvaW1wb3J0cycsXG5cbiAgZmlsZUF0dHJpYnV0ZTogJ2ZpbGVuYW1lJyxcblxuICBkZWZhdWx0czoge1xuICAgIHR5cGU6ICcnLFxuICAgIHZhbHVlOiAnJyxcbiAgICBpbnRlcnZhbDogMCxcbiAgICBwcml2YWN5OiAnJyxcbiAgICBwcm9ncmVzczogMCxcbiAgICBzdGF0ZTogJ2lkbGUnLFxuICAgIHNlcnZpY2VfaXRlbV9pZDogJycsXG4gICAgc2VydmljZV9uYW1lOiAnJyxcbiAgICBvcHRpb246ICcnLFxuICAgIGNvbnRlbnRfZ3Vlc3Npbmc6IHRydWUsXG4gICAgdHlwZV9ndWVzc2luZzogdHJ1ZSxcbiAgICBjcmVhdGVfdmlzOiB0cnVlXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24odmFsLCBvcHRzKSB7XG4gICAgdGhpcy51c2VyID0gb3B0cyAmJiBvcHRzLnVzZXI7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gICAgLy8gV2UgbmVlZCB0byB2YWxpZGF0ZSBlbnRyeSBhdHRyaWJ1dGVzXG4gICAgdGhpcy5fdmFsaWRhdGUodGhpcy5hdHRyaWJ1dGVzLCB7IHZhbGlkYXRlOiB0cnVlfSk7XG4gIH0sXG5cbiAgaXNWYWxpZFRvVXBsb2FkOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3ZhbHVlJykgJiYgdGhpcy5nZXQoJ3N0YXRlJykgIT09ICdlcnJvcic7XG4gIH0sXG5cbiAgc2V0RnJlc2g6IGZ1bmN0aW9uKGQpIHtcbiAgICBpZiAoZCAmJiAhXy5pc0VtcHR5KGQpKSB7XG4gICAgICAvLyBTZXQgdXBsb2FkIHByb3BlcnRpZXMgZXhjZXB0IGNyZWF0ZV92aXMgKGRlZmluZWQgd2hlbiBjcmVhdGVkKVxuICAgICAgdGhpcy5zZXQoXy5vbWl0KGQsICdjcmVhdGVfdmlzJykpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNsZWFyKCk7XG4gICAgfVxuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuYmluZCgncHJvZ3Jlc3MnLCBmdW5jdGlvbihwcm9ncmVzcykge1xuICAgICAgdGhpcy5zZXQoe1xuICAgICAgICBwcm9ncmVzczogcHJvZ3Jlc3MqMTAwLFxuICAgICAgICBzdGF0ZTogJ3VwbG9hZGluZydcbiAgICAgIH0pO1xuICAgIH0sIHRoaXMpO1xuXG4gICAgdGhpcy5iaW5kKCdjaGFuZ2U6dmFsdWUnLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLmdldCgnc3RhdGUnKSA9PT0gXCJlcnJvclwiKSB7XG4gICAgICAgIHRoaXMuc2V0KHsgc3RhdGU6ICdpZGxlJyB9KVxuICAgICAgICB0aGlzLnVuc2V0KCdnZXRfZXJyb3JfdGV4dCcsIHsgc2lsZW50OiB0cnVlIH0pO1xuICAgICAgfVxuICAgIH0sIHRoaXMpO1xuXG4gICAgdGhpcy5iaW5kKCdlcnJvciBpbnZhbGlkJywgZnVuY3Rpb24obSwgZCkge1xuICAgICAgdGhpcy5zZXQoe1xuICAgICAgICBzdGF0ZTogJ2Vycm9yJyxcbiAgICAgICAgZXJyb3JfY29kZTogKGQgJiYgZC5lcnJvcl9jb2RlKSB8fCAnJyxcbiAgICAgICAgZ2V0X2Vycm9yX3RleHQ6IHtcbiAgICAgICAgICB0aXRsZTogJ0ludmFsaWQgaW1wb3J0JyxcbiAgICAgICAgICB3aGF0X2Fib3V0OiAoZCAmJiBkLm1zZykgfHwgJydcbiAgICAgICAgfVxuICAgICAgfSwgeyBzaWxlbnQ6IHRydWUgfSk7XG4gICAgICAvLyBXZSBuZWVkIHRoaXMsIGlmIG5vdCB2YWxpZGF0ZSB3aWxsIHJ1biBhZ2FpbiBhbmQgYWdhaW4gYW5kIGFnYWluLi4uIDooXG4gICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgIH0sIHRoaXMpO1xuICB9LFxuXG4gIHZhbGlkYXRlOiBmdW5jdGlvbihhdHRycykge1xuICAgIGlmICghYXR0cnMpIHJldHVybjtcblxuICAgIGlmIChhdHRycy50eXBlID09PSBcImZpbGVcIikge1xuICAgICAgLy8gTnVtYmVyIG9mIGZpbGVzXG4gICAgICBpZiAoYXR0cnMudmFsdWUgJiYgYXR0cnMudmFsdWUubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbXNnOiBcIlVuZm9ydHVuYXRlbHkgb25seSBvbmUgZmlsZSBpcyBhbGxvd2VkIHBlciB1cGxvYWRcIlxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEZpbGUgbmFtZVxuICAgICAgdmFyIG5hbWUgPSBhdHRycy52YWx1ZS5uYW1lO1xuICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbXNnOiBcIkZpbGUgbmFtZSBzaG91bGQgYmUgZGVmaW5lZFwiXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gRmlsZSBleHRlbnNpb25cbiAgICAgIHZhciBleHQgPSBuYW1lLnN1YnN0cihuYW1lLmxhc3RJbmRleE9mKCcuJykgKyAxKTtcbiAgICAgIGlmIChleHQpIHtcbiAgICAgICAgZXh0ID0gZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgICB9XG4gICAgICBpZiAoIV8uY29udGFpbnMoVXBsb2FkQ29uZmlnLmZpbGVFeHRlbnNpb25zLCBleHQpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbXNnOiBcIlVuZm9ydHVuYXRlbHkgdGhpcyBmaWxlIGV4dGVuc2lvbiBpcyBub3QgYWxsb3dlZFwiXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIEZpbGUgc2l6ZVxuICAgICAgaWYgKHRoaXMudXNlciAmJiAoKHRoaXMudXNlci5nZXQoJ3JlbWFpbmluZ19ieXRlX3F1b3RhJykgKiBVcGxvYWRDb25maWcuZmlsZVRpbWVzQmlnZ2VyKSA8IGF0dHJzLnZhbHVlLnNpemUpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbXNnOiBcIlVuZm9ydHVuYXRlbHkgdGhlIHNpemUgb2YgdGhlIGZpbGUgaXMgYmlnZ2VyIHRoYW4geW91ciByZW1haW5pbmcgcXVvdGFcIixcbiAgICAgICAgICBlcnJvcl9jb2RlOiA4MDAxXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoYXR0cnMudHlwZSA9PT0gXCJyZW1vdGVcIikge1xuICAgICAgLy8gVmFsaWQgcmVtb3RlIHZpc3VhbGl6YXRpb24gaWQ/XG4gICAgICBpZiAoIWF0dHJzLnJlbW90ZV92aXN1YWxpemF0aW9uX2lkKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbXNnOiBcIlRoZSByZW1vdGUgdmlzdWFsaXphdGlvbiBpZCB3YXMgbm90IHNwZWNpZmllZFwiXG4gICAgICAgIH1cblxuICAgICAgfVxuICAgICAgLy8gUmVtb3RlIHNpemU/XG4gICAgICBpZiAodGhpcy51c2VyICYmIGF0dHJzLnNpemUgJiYgKCh0aGlzLnVzZXIuZ2V0KCdyZW1haW5pbmdfYnl0ZV9xdW90YScpICogVXBsb2FkQ29uZmlnLmZpbGVUaW1lc0JpZ2dlcikgPCBhdHRycy5zaXplKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1zZzogXCJVbmZvcnR1bmF0ZWx5IHRoZSBzaXplIG9mIHRoZSByZW1vdGUgZGF0YXNldCBpcyBiaWdnZXIgdGhhbiB5b3VyIHJlbWFpbmluZyBxdW90YVwiLFxuICAgICAgICAgIGVycm9yX2NvZGU6IDgwMDFcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChhdHRycy50eXBlID09PSBcInVybFwiKSB7XG4gICAgICAvLyBWYWxpZCBVUkw/XG4gICAgICBpZiAoIVV0aWxzLmlzVVJMKGF0dHJzLnZhbHVlKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1zZzogXCJVbmZvcnR1bmF0ZWx5IHRoZSBVUkwgcHJvdmlkZWQgaXMgbm90IHZhbGlkXCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChhdHRycy50eXBlID09PSBcInNxbFwiKSB7XG4gICAgICBpZiAoIWF0dHJzLnZhbHVlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbXNnOiBcIlF1ZXJ5IGlzIG5vdCBwcm92aWRlZFwiXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoYXR0cnMudHlwZSA9PT0gXCJkdXBsaWNhdGlvblwiKSB7XG4gICAgICBpZiAoIWF0dHJzLnZhbHVlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbXNnOiBcIkRhdGFzZXQgY29weSBpcyBub3QgZGVmaW5lZFwiXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoYXR0cnMudHlwZSA9PT0gXCJzZXJ2aWNlXCIgJiYgYXR0cnMuc2VydmljZV9uYW1lID09PSBcInR3aXR0ZXJfc2VhcmNoXCIpIHtcbiAgICAgIHZhciBzZXJ2aWNlX2l0ZW1faWQgPSBhdHRycy5zZXJ2aWNlX2l0ZW1faWQ7XG5cbiAgICAgIC8vIEVtcHR5P1xuICAgICAgaWYgKCFzZXJ2aWNlX2l0ZW1faWQgfHwgXy5pc0VtcHR5KHNlcnZpY2VfaXRlbV9pZCkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtc2c6IFwiVHdpdHRlciBkYXRhIGlzIGVtcHR5XCJcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDYXRlZ29yaWVzP1xuICAgICAgaWYgKF8uaXNFbXB0eShzZXJ2aWNlX2l0ZW1faWQuY2F0ZWdvcmllcykpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtc2c6IFwiVHdpdHRlciBjYXRlZ29yaWVzIGFyZSBub3QgdmFsaWRcIlxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIERhdGVzP1xuICAgICAgdmFyIGRhdGVzID0gc2VydmljZV9pdGVtX2lkLmRhdGVzO1xuICAgICAgaWYgKCFkYXRlcyB8fCBfLmlzRW1wdHkoZGF0ZXMpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbXNnOiBcIlR3aXR0ZXIgZGF0ZXMgYXJlIGVtcHR5XCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdmFyIGlzVG9EYXRlVmFsaWQgPSBtb21lbnQoZGF0ZXMuZnJvbURhdGUpIDw9IG1vbWVudChuZXcgRGF0ZSgpKTtcbiAgICAgIGlmICghZGF0ZXMuZnJvbURhdGUgfHwgIWRhdGVzLnRvRGF0ZSB8fCAhaXNUb0RhdGVWYWxpZCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1zZzogXCJUd2l0dGVyIGRhdGVzIGFyZSBub3QgdmFsaWRcIlxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIGlzVmFsaWQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgndmFsdWUnKSAmJiB0aGlzLmdldCgnc3RhdGUnKSAhPT0gXCJlcnJvclwiXG4gIH0sXG5cbiAgdXBsb2FkOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5nZXQoJ3R5cGUnKSA9PT0gXCJmaWxlXCIpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHRoaXMueGhyID0gdGhpcy5zYXZlKFxuICAgICAgICB7XG4gICAgICAgICAgZmlsZW5hbWU6IHRoaXMuZ2V0KCd2YWx1ZScpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihtKSB7XG4gICAgICAgICAgICBtLnNldCgnc3RhdGUnLCAndXBsb2FkZWQnKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihtLCBtc2cpIHtcblxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAnVW5mb3J0dW5hdGVseSB0aGVyZSB3YXMgYSBjb25uZWN0aW9uIGVycm9yJztcblxuICAgICAgICAgICAgaWYgKG1zZyAmJiBtc2cuc3RhdHVzID09PSA0MjkpIHtcbiAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gSlNPTi5wYXJzZShtc2cucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgbWVzc2FnZSA9IHJlc3BvbnNlLmVycm9ycy5pbXBvcnRzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZWxmLnNldCh7XG4gICAgICAgICAgICAgIHN0YXRlOiAnZXJyb3InLFxuICAgICAgICAgICAgICBnZXRfZXJyb3JfdGV4dDogeyB0aXRsZTogJ1RoZXJlIHdhcyBhbiBlcnJvcicsIHdoYXRfYWJvdXQ6IG1lc3NhZ2UgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBzZWxmLnhocjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuICB9LFxuXG4gIHN0b3BVcGxvYWQ6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLnhocikgdGhpcy54aHIuYWJvcnQoKTtcbiAgfSxcblxuICBzZXRHdWVzc2luZzogZnVuY3Rpb24odmFsKSB7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgdHlwZV9ndWVzc2luZzogdmFsLFxuICAgICAgY29udGVudF9ndWVzc2luZzogdmFsXG4gICAgfSk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uLy4uL3ZpZXdfZmFjdG9yeScpO1xudmFyIFBlY2FuRGlhbG9nID0gcmVxdWlyZSgnLi4vLi4vLi4vZGlhbG9ncy9wZWNhbi9wZWNhbl9kaWFsb2dfdmlldycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdJbXBvcnRJdGVtJyxcbiAgdGFnTmFtZTogJ2xpJyxcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2sgLmpzLWFib3J0JzogICAgICAgJ19yZW1vdmVJdGVtJyxcbiAgICAnY2xpY2sgLmpzLXNob3dfZGlhbG9nJzogJ19zaG93RGlhbG9nJyxcbiAgICAnY2xpY2sgLmpzLWNsb3NlJzogICAgICAgJ19yZW1vdmVJdGVtJ1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMudmlzID0gdGhpcy5vcHRpb25zLnZpcztcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy92aWV3cy9hbmFseXNpcy9iYWNrZ3JvdW5kX2FuYWx5c2lzX2l0ZW0nKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB0b3RhbEl0ZW1zICAgID0gdGhpcy5jb2xsZWN0aW9uLmdldFRvdGFsQW5hbHlzaXMoKTtcbiAgICB2YXIgdG90YWxBbmFseXplZCA9IHRoaXMuY29sbGVjdGlvbi5nZXRDb21wbGV0ZWRBbmFseXNpcygpO1xuICAgIHZhciB0b3RhbFN1Y2Nlc3MgID0gdGhpcy5jb2xsZWN0aW9uLmdldFN1Y2Nlc3NmdWxseUFuYWx5c2VkQ29sdW1ucygpO1xuXG4gICAgdmFyIGQgPSB7XG4gICAgICB0b3RhbFN1Y2Nlc3M6IHRvdGFsU3VjY2VzcyxcbiAgICAgIHRvdGFsSXRlbXM6IHRvdGFsSXRlbXMsXG4gICAgICB0b3RhbEFuYWx5emVkOiB0b3RhbEFuYWx5emVkLFxuICAgICAgcHJvZ3Jlc3M6ICh0b3RhbEFuYWx5emVkIC8gdG90YWxJdGVtcykgKiAxMDBcbiAgICB9O1xuXG4gICAgdGhpcy4kZWwuaHRtbCh0aGlzLnRlbXBsYXRlKGQpKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY29sbGVjdGlvbi5iaW5kKCdjaGFuZ2U6c3RhdGUnLCB0aGlzLl9vbkNoYW5nZVN0YXRlLCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMuY29sbGVjdGlvbik7XG4gIH0sXG5cbiAgX29uQ2hhbmdlU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB0b3RhbEl0ZW1zICAgID0gdGhpcy5jb2xsZWN0aW9uLmdldFRvdGFsQW5hbHlzaXMoKTtcbiAgICB2YXIgdG90YWxBbmFseXplZCA9IHRoaXMuY29sbGVjdGlvbi5nZXRDb21wbGV0ZWRBbmFseXNpcygpO1xuICAgIHZhciB0b3RhbFN1Y2Nlc3MgID0gdGhpcy5jb2xsZWN0aW9uLmdldFN1Y2Nlc3NmdWxseUFuYWx5c2VkQ29sdW1ucygpO1xuXG4gICAgdGhpcy5yZW5kZXIoKTtcblxuICAgIGlmICh0b3RhbEFuYWx5emVkID09PSB0b3RhbEl0ZW1zICYmIHRvdGFsU3VjY2VzcyA9PT0gMCkge1xuICAgICAgdGhpcy5fcmVtb3ZlSXRlbSgpO1xuICAgIH1cbiAgfSxcblxuICBfc2hvd0RpYWxvZzogZnVuY3Rpb24oKSB7XG5cbiAgICB2YXIgcGVjYW5EaWFsb2cgPSBuZXcgUGVjYW5EaWFsb2coe1xuICAgICAgY2xlYW5fb25faGlkZTogdHJ1ZSxcbiAgICAgIHZpczogdGhpcy52aXMsXG4gICAgICBjb2xsZWN0aW9uOnRoaXMuY29sbGVjdGlvbixcbiAgICAgIHVzZXI6IHRoaXMudXNlclxuICAgIH0pO1xuXG4gICAgcGVjYW5EaWFsb2cuYXBwZW5kVG9Cb2R5KCk7XG4gIH0sXG5cbiAgX3NraXA6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBsYXllcklEID0gdGhpcy52aXMuZ2V0KFwiYWN0aXZlX2xheWVyX2lkXCIpO1xuICAgIHZhciBuYW1lO1xuICAgIHZhciBhY3RpdmVMYXllciAgPSB0aGlzLnZpcy5tYXAubGF5ZXJzLndoZXJlKHsgaWQ6IGxheWVySUQgfSk7XG5cbiAgICBpZiAoYWN0aXZlTGF5ZXIpIHtcbiAgICAgIG5hbWUgPSBhY3RpdmVMYXllclswXS50YWJsZS5nZXQoXCJuYW1lXCIpO1xuICAgIH1cblxuICAgIHZhciBza2lwUGVuY2FuRGlhbG9nID0gJ3BlY2FuXycgKyB0aGlzLnVzZXIuZ2V0KFwidXNlcm5hbWVcIikgKyBcIl9cIiArIG5hbWU7XG4gICAgbG9jYWxTdG9yYWdlW3NraXBQZW5jYW5EaWFsb2ddID0gdHJ1ZTtcbiAgfSxcblxuICBfcmVtb3ZlSXRlbTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50cmlnZ2VyKCdyZW1vdmUnLCB0aGlzLmNvbGxlY3Rpb24sIHRoaXMpO1xuICAgIHRoaXMuX3NraXAoKTtcbiAgICB0aGlzLmNsZWFuKCk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcblxuLyoqXG4gKiAgQmFja2dyb3VuZCBwb2xsaW5nIGhlYWRlciB0aXRsZSB2aWV3XG4gKlxuICogIEl0IHdpbGwgY29udGFpbiBvbmx5IHRoZSB0aXRsZVxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICB0YWdOYW1lOiAnaDMnLFxuICBjbGFzc05hbWU6ICdDREItVGV4dCBDREItU2l6ZS1sYXJnZSB1LWxTcGFjZS0teGwnLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL3ZpZXdzL2JhY2tncm91bmRfcG9sbGluZ19oZWFkZXJfdGl0bGUnKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLnRlbXBsYXRlKHtcbiAgICAgICAgaW1wb3J0czogdGhpcy5tb2RlbC5nZXRUb3RhbEltcG9ydHMoKSxcbiAgICAgICAgZ2VvY29kaW5nczogdGhpcy5tb2RlbC5nZXRUb3RhbEdlb2NvZGluZ3MoKSxcbiAgICAgICAgYW5hbHlzaXM6IHRoaXMubW9kZWwuZ2V0VG90YWxBbmFseXNpcygpLFxuICAgICAgICB0b3RhbFBvbGxpbmdzOiB0aGlzLm1vZGVsLmdldFRvdGFsUG9sbGluZ3MoKVxuICAgICAgfSlcbiAgICApO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2UgYW5hbHlzaXNBZGRlZCBhbmFseXNpc1JlbW92ZWQgaW1wb3J0QWRkZWQgaW1wb3J0UmVtb3ZlZCBnZW9jb2RpbmdBZGRlZCBnZW9jb2RpbmdSZW1vdmVkJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICB9XG5cbn0pOyIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIEJhY2tncm91bmRQb2xsaW5nSGVhZGVyVGl0bGVWaWV3ID0gcmVxdWlyZSgnLi9iYWNrZ3JvdW5kX3BvbGxpbmdfaGVhZGVyX3RpdGxlX3ZpZXcnKTtcblxuLyoqXG4gKiAgQmFja2dyb3VuZCBwb2xsaW5nIGhlYWRlciB2aWV3XG4gKlxuICogIEl0IHdpbGwgY29udGFpbjpcbiAqICAtIEJhZGdlXG4gKiAgLSBUaXRsZVxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6IFwiQmFja2dyb3VuZFBvbGxpbmctaGVhZGVyXCIsXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9iYWNrZ3JvdW5kX3BvbGxpbmcvdmlld3MvYmFja2dyb3VuZF9wb2xsaW5nX2hlYWRlcicpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuaHRtbCh0aGlzLnRlbXBsYXRlKCkpO1xuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHRoaXMuX3VwZGF0ZUJhZGdlcygpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlIGltcG9ydEFkZGVkIGltcG9ydFJlbW92ZWQgZ2VvY29kaW5nQWRkZWQgZ2VvY29kaW5nUmVtb3ZlZCcsIHRoaXMuX3VwZGF0ZUJhZGdlcywgdGhpcyk7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGhlYWRlclRpdGxlID0gbmV3IEJhY2tncm91bmRQb2xsaW5nSGVhZGVyVGl0bGVWaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsXG4gICAgfSk7XG4gICAgdGhpcy4kZWwuYXBwZW5kKGhlYWRlclRpdGxlLnJlbmRlcigpLmVsKTtcbiAgICB0aGlzLmFkZFZpZXcoaGVhZGVyVGl0bGUpO1xuICB9LFxuXG4gIF91cGRhdGVCYWRnZXM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBmYWlsZWQgPSB0aGlzLm1vZGVsLmdldFRvdGFsRmFpbGVkSXRlbXMoKTtcblxuICAgIGlmICh0aGlzLiQoJy5CYWNrZ3JvdW5kUG9sbGluZy1oZWFkZXJCYWRnZUNvdW50JykubGVuZ3RoID09PSAwICYmIGZhaWxlZCA+IDApIHtcbiAgICAgIHZhciAkc3BhbiA9ICQoJzxzcGFuPicpLmFkZENsYXNzKFwiQmFja2dyb3VuZFBvbGxpbmctaGVhZGVyQmFkZ2VDb3VudCBCYWRnZSBCYWRnZS0tbmVnYXRpdmUgQ0RCLVRleHQgQ0RCLVNpemUtc21hbGxcIikudGV4dChmYWlsZWQpO1xuICAgICAgdGhpcy4kKCcuQmFja2dyb3VuZFBvbGxpbmctaGVhZGVyQmFkZ2UnKVxuICAgICAgICAuYXBwZW5kKCRzcGFuKVxuICAgICAgICAuYWRkQ2xhc3MoJ2hhcy1mYWlsdXJlcycpO1xuICAgIH0gZWxzZSBpZiAodGhpcy4kKCcuQmFja2dyb3VuZFBvbGxpbmctaGVhZGVyQmFkZ2VDb3VudCcpLmxlbmd0aCA+IDAgJiYgZmFpbGVkID4gMCkge1xuICAgICAgdGhpcy4kKCcuQmFja2dyb3VuZFBvbGxpbmctaGVhZGVyQmFkZ2VDb3VudCcpLnRleHQoZmFpbGVkKTtcbiAgICB9IGVsc2UgaWYgKGZhaWxlZCA9PT0gMCkge1xuICAgICAgdGhpcy4kKCcuQmFja2dyb3VuZFBvbGxpbmctaGVhZGVyQmFkZ2VDb3VudCcpLnJlbW92ZSgpO1xuICAgICAgdGhpcy4kKCcuQmFja2dyb3VuZFBvbGxpbmctaGVhZGVyQmFkZ2UnKS5yZW1vdmVDbGFzcygnaGFzLWZhaWx1cmVzJyk7XG4gICAgfVxuXG4gICAgLy8gU2hvdyBnZW9jb2RpbmcgaWNvbiBpZiBvbmx5IGdlb2NvZGluZ1xuICAgIHZhciBnZW9jb2RpbmdzQ291bnQgPSB0aGlzLm1vZGVsLmdldFRvdGFsR2VvY29kaW5ncygpO1xuICAgIHZhciBpc0dlb2NvZGluZyA9IGdlb2NvZGluZ3NDb3VudCA+IDAgJiYgZ2VvY29kaW5nc0NvdW50ID09PSB0aGlzLm1vZGVsLmdldFRvdGFsUG9sbGluZ3MoKTtcbiAgICB0aGlzLiQoJy5qcy1pY29uJykudG9nZ2xlQ2xhc3MoJ0NEQi1JY29uRm9udC1tYXJrZXInLCBpc0dlb2NvZGluZyk7XG4gICAgdGhpcy4kKCcuanMtaWNvbicpLnRvZ2dsZUNsYXNzKCdDREItSWNvbkZvbnQtY2xvdWQnLCAhaXNHZW9jb2RpbmcpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBVdGlscyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXVsnVXRpbHMnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddWydVdGlscyddIDogbnVsbCk7XG52YXIgcGx1cmFsaXplU3RyaW5nID0gcmVxdWlyZSgnLi4vLi4vLi4vdmlld19oZWxwZXJzL3BsdXJhbGl6ZV9zdHJpbmcnKTtcbnZhciBHZW9jb2RpbmdSZXN1bHREZXRhaWxzVmlldyA9IHJlcXVpcmUoJy4vZ2VvY29kaW5nX3Jlc3VsdF9kZXRhaWxzX3ZpZXcnKTtcblxuLyoqXG4gKiAgR2VvY29kaW5nIGl0ZW0gd2l0aGluIGJhY2tncm91bmQgcG9sbGluZ1xuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdJbXBvcnRJdGVtJyxcbiAgdGFnTmFtZTogJ2xpJyxcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2sgLmpzLWFib3J0JzogJ19jYW5jZWxHZW9jb2RpbmcnLFxuICAgICdjbGljayAuanMtaW5mbyc6ICdfc2hvd0RldGFpbHMnLFxuICAgICdjbGljayAuanMtY2xvc2UnOiAnX3JlbW92ZUdlb2NvZGluZydcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy92aWV3cy9nZW9jb2RpbmdzL2JhY2tncm91bmRfZ2VvY29kaW5nX2l0ZW0nKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwcm9jZXNzZWRSb3dzID0gdGhpcy5tb2RlbC5nZXQoJ3Byb2Nlc3NlZF9yb3dzJykgfHwgMDtcbiAgICB2YXIgcHJvY2Vzc2FibGVSb3dzID0gdGhpcy5tb2RlbC5nZXQoJ3Byb2Nlc3NhYmxlX3Jvd3MnKSB8fCAwO1xuICAgIHZhciByZWFsUm93cyA9IHRoaXMubW9kZWwuZ2V0KCdyZWFsX3Jvd3MnKSB8fCAwO1xuICAgIHZhciBpc0xhdExuZ1R5cGUgPSB0aGlzLm1vZGVsLmdldCgnbGF0aXR1ZGVfY29sdW1uJykgJiYgdGhpcy5tb2RlbC5nZXQoJ2xvbmdpdHVkZV9jb2x1bW4nKTtcblxuICAgIHZhciBkID0ge1xuICAgICAgcmVhbFJvd3M6IHJlYWxSb3dzLFxuICAgICAgdGFibGVOYW1lOiB0aGlzLm1vZGVsLmdldCgndGFibGVfbmFtZScpLFxuICAgICAgY2FuQ2FuY2VsOiBfLmlzRnVuY3Rpb24odGhpcy5tb2RlbC5jYW5jZWxHZW9jb2RpbmcpLFxuICAgICAgaGFzRmFpbGVkOiB0aGlzLm1vZGVsLmhhc0ZhaWxlZCgpLFxuICAgICAgaGFzQ29tcGxldGVkOiB0aGlzLm1vZGVsLmhhc0NvbXBsZXRlZCgpLFxuICAgICAgcHJvY2Vzc2VkUm93czogcHJvY2Vzc2VkUm93cyxcbiAgICAgIHByb2Nlc3NhYmxlUm93czogcHJvY2Vzc2FibGVSb3dzLFxuICAgICAgcHJvY2Vzc2FibGVSb3dzRm9ybWF0dGVkOiBVdGlscy5mb3JtYXROdW1iZXIocHJvY2Vzc2FibGVSb3dzKSxcbiAgICAgIHJlYWxSb3dzUGx1cmFsaXplOiBwbHVyYWxpemVTdHJpbmcoJ3JvdycsICdyb3dzJywgdGhpcy5tb2RlbC5nZXQoJ3JlYWxfcm93cycpKSxcbiAgICAgIHJlYWxSb3dzRm9ybWF0dGVkOiBVdGlscy5mb3JtYXROdW1iZXIocmVhbFJvd3MpLFxuICAgICAgcHJvY2Vzc2FibGVSb3dzUGx1cmFsaXplOiBwbHVyYWxpemVTdHJpbmcoJ3JvdycsICdyb3dzJywgcHJvY2Vzc2FibGVSb3dzKSxcbiAgICAgIHdpZHRoOiByZWFsUm93cyA+IDAgPyAocHJvY2Vzc2FibGVSb3dzL3JlYWxSb3dzKSA6IDEwMCxcbiAgICAgIGlzTGF0TG5nVHlwZTogaXNMYXRMbmdUeXBlXG4gICAgfVxuICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZShkKSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ3JlbW92ZScsIHRoaXMuY2xlYW4sIHRoaXMpO1xuICB9LFxuXG4gIF9jYW5jZWxHZW9jb2Rpbmc6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuY2FuY2VsR2VvY29kaW5nKCk7XG4gIH0sXG5cbiAgX3JlbW92ZUdlb2NvZGluZzogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50cmlnZ2VyKCdyZW1vdmUnLCB0aGlzLm1vZGVsLCB0aGlzKTtcbiAgICB0aGlzLmNsZWFuKCk7XG4gIH0sXG5cbiAgX3Nob3dEZXRhaWxzOiBmdW5jdGlvbigpIHtcbiAgICBuZXcgR2VvY29kaW5nUmVzdWx0RGV0YWlsc1ZpZXcoe1xuICAgICAgY2xlYW5fb25faGlkZTogdHJ1ZSxcbiAgICAgIHVzZXI6IHRoaXMudXNlcixcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLFxuICAgICAgc2hvd0dlb2NvZGluZ0RhdGFzZXRVUkxCdXR0b246IHRoaXMub3B0aW9ucy5zaG93R2VvY29kaW5nRGF0YXNldFVSTEJ1dHRvblxuICAgIH0pLmFwcGVuZFRvQm9keSgpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uLy4uLy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcbnZhciBwbHVyYWxpemVTdHJpbmcgPSByZXF1aXJlKCcuLi8uLi8uLi92aWV3X2hlbHBlcnMvcGx1cmFsaXplX3N0cmluZycpO1xudmFyIFV0aWxzID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydVdGlscyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ1V0aWxzJ10gOiBudWxsKTtcblxuLyoqXG4gKiAgV2hlbiBhIGdlb2NvZGluZyBwcm9jY2VzcyBmaW5pc2hlcywgdGhpcyBkaWFsb2cgZGlzcGxheXNcbiAqICBhbGwgdGhlIGluZm8gYWJvdXQgdGhlIHRhc2sgKHByaWNlLCByb3dzLCBlcnJvcnMsIGV0YykuXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ0RpYWxvZyBCYWNrZ3JvdW5kUG9sbGluZ0RldGFpbHMgaXMtb3BlbmluZycsXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICB9LFxuXG4gIHJlbmRlcl9jb250ZW50OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZXJyb3IgPSB0aGlzLm1vZGVsLmdldCgnZXJyb3InKSB8fCB7fTtcblxuICAgIHZhciBwcm9jZXNzZWRSb3dzID0gdGhpcy5tb2RlbC5nZXQoJ3Byb2Nlc3NlZF9yb3dzJykgfHwgMDtcbiAgICB2YXIgcHJvY2Vzc2FibGVSb3dzID0gdGhpcy5tb2RlbC5nZXQoJ3Byb2Nlc3NhYmxlX3Jvd3MnKSB8fCAwO1xuICAgIHZhciByZWFsUm93cyA9IHRoaXMubW9kZWwuZ2V0KCdyZWFsX3Jvd3MnKSB8fCAwO1xuICAgIHZhciBnZW9tZXRyeVR5cGUgPSB0aGlzLm1vZGVsLmdldCgnZ2VvbWV0cnlfdHlwZScpIHx8ICdwb2ludCc7XG5cbiAgICAvLyBSZWxhdGVkIHRvIHByaWNlIGFuZCBjcmVkaXRzXG4gICAgdmFyIHByaWNlID0gdGhpcy5tb2RlbC5nZXQoJ3ByaWNlJyk7XG4gICAgdmFyIGhhc1ByaWNlID0gcHJpY2UgIT09IHVuZGVmaW5lZCAmJiBwcmljZSAhPT0gbnVsbDtcbiAgICB2YXIgZ29vZ2xlVXNlciA9IHRoaXMudXNlci5mZWF0dXJlRW5hYmxlZCgnZ29vZ2xlX21hcHMnKTtcblxuICAgIHZhciBkYXRhc2V0VVJMO1xuICAgIGlmICh0aGlzLnVzZXIgJiYgdGhpcy5tb2RlbC5nZXQoJ3RhYmxlX25hbWUnKSkge1xuICAgICAgdmFyIHZpcyA9IG5ldyBjZGIuYWRtaW4uVmlzdWFsaXphdGlvbih7XG4gICAgICAgIHR5cGU6ICd0YWJsZScsXG4gICAgICAgIHRhYmxlOiB7XG4gICAgICAgICAgbmFtZTogdGhpcy5tb2RlbC5nZXQoJ3RhYmxlX25hbWUnKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZpcy5wZXJtaXNzaW9uLm93bmVyID0gdGhpcy51c2VyO1xuICAgICAgZGF0YXNldFVSTCA9IGVuY29kZVVSSSh2aXMudmlld1VybCh0aGlzLnVzZXIpLmVkaXQoKSk7XG4gICAgfVxuXG4gICAgLy8gU2VsZWN0IHRlbXBsYXRlXG4gICAgdmFyIHRlbXBsYXRlID0gJ2NvbW1vbi9iYWNrZ3JvdW5kX3BvbGxpbmcvdmlld3MvZ2VvY29kaW5ncy8nO1xuICAgIGlmICh0aGlzLm1vZGVsLmhhc0NvbXBsZXRlZCgpKSB7XG4gICAgICB0ZW1wbGF0ZSArPSByZWFsUm93cyA9PT0gMCA/ICdnZW9jb2Rpbmdfbm9fcmVzdWx0X2RldGFpbHMnIDogJ2dlb2NvZGluZ19zdWNjZXNzX2RldGFpbHMnO1xuICAgIH0gZWxzZSB7XG4gICAgICB0ZW1wbGF0ZSArPSAnZ2VvY29kaW5nX2Vycm9yX2RldGFpbHMnO1xuICAgIH1cblxuICAgIHJldHVybiBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKHRlbXBsYXRlKSh7XG4gICAgICBpZDogdGhpcy5tb2RlbC5nZXQoJ2lkJyksXG4gICAgICBnZW9tZXRyeVR5cGVQbHVyYWxpemU6IHBsdXJhbGl6ZVN0cmluZyhnZW9tZXRyeVR5cGUsIGdlb21ldHJ5VHlwZSArICdzJywgcHJvY2Vzc2FibGVSb3dzKSxcbiAgICAgIGdlb21ldHJ5VHlwZTogZ2VvbWV0cnlUeXBlLFxuICAgICAgcmVtYWluaW5nUXVvdGFGb3JtYXR0ZWQ6IFV0aWxzLmZvcm1hdE51bWJlcih0aGlzLm1vZGVsLmdldCgncmVtYWluaW5nX3F1b3RhJykpLFxuICAgICAgZ29vZ2xlVXNlcjogZ29vZ2xlVXNlcixcbiAgICAgIHRhYmxlTmFtZTogdGhpcy5tb2RlbC5nZXQoJ3RhYmxlX25hbWUnKSxcbiAgICAgIHN0YXRlOiB0aGlzLm1vZGVsLmdldCgnc3RhdGUnKSB8fCAnJyxcbiAgICAgIGJsb2NrUHJpY2U6IHRoaXMudXNlci5nZXQoJ2dlb2NvZGluZycpLmJsb2NrX3ByaWNlLFxuICAgICAgcmVhbFJvd3M6IHJlYWxSb3dzLFxuICAgICAgcmVhbFJvd3NGb3JtYXR0ZWQ6IFV0aWxzLmZvcm1hdE51bWJlcihyZWFsUm93cyksXG4gICAgICBwcm9jZXNzZWRSb3dzOiBwcm9jZXNzZWRSb3dzLFxuICAgICAgcHJvY2Vzc2FibGVSb3dzOiBwcm9jZXNzYWJsZVJvd3MsXG4gICAgICBwcm9jZXNzYWJsZVJvd3NGb3JtYXR0ZWQ6IFV0aWxzLmZvcm1hdE51bWJlcihwcm9jZXNzYWJsZVJvd3MpLFxuICAgICAgaGFzUHJpY2U6IGhhc1ByaWNlLFxuICAgICAgcHJpY2U6IHByaWNlLFxuICAgICAgY3VzdG9tSG9zdGVkOiBjZGIuY29uZmlnLmdldCgnY2FydG9kYl9jb21faG9zdGVkJyksXG4gICAgICBlcnJvckRlc2NyaXB0aW9uOiBlcnJvci5kZXNjcmlwdGlvbixcbiAgICAgIHNob3dHZW9jb2RpbmdEYXRhc2V0VVJMQnV0dG9uOiB0aGlzLm9wdGlvbnMuc2hvd0dlb2NvZGluZ0RhdGFzZXRVUkxCdXR0b24gJiYgZGF0YXNldFVSTCxcbiAgICAgIGRhdGFzZXRVUkw6IGRhdGFzZXRVUkxcbiAgICB9KTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIFVwbG9hZENvbmZpZyA9IHJlcXVpcmUoJy4uLy4uL21vZGVscy91cGxvYWRfY29uZmlnJyk7XG52YXIgRXJyb3JEZXRhaWxzVmlldyA9IHJlcXVpcmUoJy4uLy4uLy4uL3ZpZXdzL2Vycm9yX2RldGFpbHNfdmlldycpO1xudmFyIFdhcm5pbmdzRGV0YWlsc1ZpZXcgPSByZXF1aXJlKCcuLi8uLi8uLi92aWV3cy93YXJuaW5nc19kZXRhaWxzX3ZpZXcnKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uLy4uL3ZpZXdfZmFjdG9yeScpO1xudmFyIFR3aXR0ZXJJbXBvcnREZXRhaWxzRGlhbG9nID0gcmVxdWlyZSgnLi90d2l0dGVyX2ltcG9ydF9kZXRhaWxzX3ZpZXcnKTtcblxuLyoqXG4gKiAgSW1wb3J0IGl0ZW0gd2l0aGluIGJhY2tncm91bmQgaW1wb3J0ZXJcbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgY2xhc3NOYW1lOiAnSW1wb3J0SXRlbScsXG4gIHRhZ05hbWU6ICdsaScsXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy1hYm9ydCc6ICAgICAgJ19yZW1vdmVJdGVtJyxcbiAgICAnY2xpY2sgLmpzLXNob3dfZXJyb3InOiAnX3Nob3dJbXBvcnRFcnJvcicsXG4gICAgJ2NsaWNrIC5qcy1zaG93X3dhcm5pbmdzJzogJ19zaG93SW1wb3J0V2FybmluZ3MnLFxuICAgICdjbGljayAuanMtc2hvd19zdGF0cyc6ICdfc2hvd0ltcG9ydFN0YXRzJyxcbiAgICAnY2xpY2sgLmpzLWNsb3NlJzogICAgICAnX3JlbW92ZUl0ZW0nXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5vcHRpb25zLnVzZXI7XG4gICAgdGhpcy5fc2hvd1N1Y2Nlc3NEZXRhaWxzQnV0dG9uID0gdGhpcy5vcHRpb25zLnNob3dTdWNjZXNzRGV0YWlsc0J1dHRvbjtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy92aWV3cy9pbXBvcnRzL2JhY2tncm91bmRfaW1wb3J0X2l0ZW0nKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB1cGxvYWQgPSB0aGlzLm1vZGVsLmdldCgndXBsb2FkJyk7XG4gICAgdmFyIGltcCA9IHRoaXMubW9kZWwuZ2V0KCdpbXBvcnQnKTtcblxuICAgIHZhciBkID0ge1xuICAgICAgbmFtZTogJycsXG4gICAgICBzdGF0ZTogdGhpcy5tb2RlbC5nZXQoJ3N0YXRlJyksXG4gICAgICBwcm9ncmVzczogJycsXG4gICAgICBzZXJ2aWNlOiAnJyxcbiAgICAgIHN0ZXA6IHRoaXMubW9kZWwuZ2V0KCdzdGVwJyksXG4gICAgICB1cmw6ICcnLFxuICAgICAgZmFpbGVkOiB0aGlzLm1vZGVsLmhhc0ZhaWxlZCgpLFxuICAgICAgY29tcGxldGVkOiB0aGlzLm1vZGVsLmhhc0NvbXBsZXRlZCgpLFxuICAgICAgd2FybmluZ3M6IHRoaXMubW9kZWwuZ2V0V2FybmluZ3MoKSxcbiAgICAgIHNob3dTdWNjZXNzRGV0YWlsc0J1dHRvbjogdGhpcy5fc2hvd1N1Y2Nlc3NEZXRhaWxzQnV0dG9uLFxuICAgICAgdGFibGVzX2NyZWF0ZWRfY291bnQ6IGltcC50YWJsZXNfY3JlYXRlZF9jb3VudFxuICAgIH07XG5cbiAgICAvLyBVUkxcbiAgICBpZiAoZC5zdGF0ZSA9PT0gXCJjb21wbGV0ZVwiKSB7XG4gICAgICB2YXIgdmlzID0gdGhpcy5tb2RlbC5pbXBvcnRlZFZpcygpO1xuICAgICAgaWYgKHZpcykge1xuICAgICAgICBkLnVybCA9IGVuY29kZVVSSSh2aXMudmlld1VybCh0aGlzLnVzZXIpLmVkaXQoKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gTmFtZVxuICAgIGlmICh1cGxvYWQudHlwZSkge1xuICAgICAgaWYgKHVwbG9hZC50eXBlID09PSBcImZpbGVcIikge1xuICAgICAgICBpZiAodXBsb2FkLnZhbHVlLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBkLm5hbWUgPSB1cGxvYWQudmFsdWUubGVuZ3RoICsgJyBmaWxlcyc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZC5uYW1lID0gdXBsb2FkLnZhbHVlLm5hbWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh1cGxvYWQudHlwZSA9PT0gXCJ1cmxcIiB8fCB1cGxvYWQudHlwZSA9PT0gXCJyZW1vdGVcIikge1xuICAgICAgICBkLm5hbWUgPSB1cGxvYWQudmFsdWU7XG4gICAgICB9XG4gICAgICBpZiAodXBsb2FkLnR5cGUgPT09IFwic2VydmljZVwiKSB7XG4gICAgICAgIGQubmFtZSA9IHVwbG9hZC52YWx1ZSAmJiB1cGxvYWQudmFsdWUuZmlsZW5hbWUgfHwgJyc7XG4gICAgICB9XG4gICAgICBpZiAodXBsb2FkLnNlcnZpY2VfbmFtZSA9PT0gXCJ0d2l0dGVyX3NlYXJjaFwiKSB7XG4gICAgICAgIGQubmFtZSA9ICdUd2l0dGVyIGltcG9ydCc7XG4gICAgICB9XG4gICAgICBpZiAodXBsb2FkLnR5cGUgPT09IFwic3FsXCIpIHtcbiAgICAgICAgZC5uYW1lID0gJ1NRTCc7XG4gICAgICB9XG4gICAgICBpZiAodXBsb2FkLnR5cGUgPT09IFwiZHVwbGljYXRpb25cIikge1xuICAgICAgICBkLm5hbWUgPSB1cGxvYWQudGFibGVfbmFtZSB8fCB1cGxvYWQudmFsdWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGQubmFtZSA9IGltcC5kaXNwbGF5X25hbWUgfHwgaW1wLml0ZW1fcXVldWVfaWQgfHwgJ2ltcG9ydCc7XG4gICAgfVxuXG4gICAgLy8gU2VydmljZVxuICAgIGQuc2VydmljZSA9IHVwbG9hZC5zZXJ2aWNlX25hbWU7XG5cbiAgICAvLyBQcm9ncmVzc1xuICAgIGlmICh0aGlzLm1vZGVsLmdldCgnc3RlcCcpID09PSAndXBsb2FkJykge1xuICAgICAgZC5wcm9ncmVzcyA9IHRoaXMubW9kZWwuZ2V0KCd1cGxvYWQnKS5wcm9ncmVzcztcbiAgICB9IGVsc2Uge1xuICAgICAgZC5wcm9ncmVzcyA9IChVcGxvYWRDb25maWcudXBsb2FkU3RhdGVzLmluZGV4T2YoZC5zdGF0ZSkvVXBsb2FkQ29uZmlnLnVwbG9hZFN0YXRlcy5sZW5ndGgpICogMTAwO1xuICAgIH1cblxuICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZShkKSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ3JlbW92ZScsIHRoaXMuY2xlYW4sIHRoaXMpO1xuICB9LFxuXG4gIF9yZW1vdmVJdGVtOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnRyaWdnZXIoJ3JlbW92ZScsIHRoaXMubW9kZWwsIHRoaXMpO1xuICAgIHRoaXMubW9kZWwucGF1c2UoKTtcbiAgICB0aGlzLmNsZWFuKCk7XG4gIH0sXG5cbiAgX3Nob3dJbXBvcnRTdGF0czogZnVuY3Rpb24oKSB7XG4gICAgKG5ldyBUd2l0dGVySW1wb3J0RGV0YWlsc0RpYWxvZyh7XG4gICAgICBjbGVhbl9vbl9oaWRlOiB0cnVlLFxuICAgICAgdXNlcjogdGhpcy51c2VyLFxuICAgICAgbW9kZWw6IHRoaXMubW9kZWxcbiAgICB9KSkuYXBwZW5kVG9Cb2R5KCk7XG4gIH0sXG5cbiAgX3Nob3dJbXBvcnRFcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGRpYWxvZyA9IFZpZXdGYWN0b3J5LmNyZWF0ZURpYWxvZ0J5VmlldyhcbiAgICAgIG5ldyBFcnJvckRldGFpbHNWaWV3KHtcbiAgICAgICAgZXJyOiB0aGlzLm1vZGVsLmdldEVycm9yKCksXG4gICAgICAgIHVzZXI6IHRoaXMudXNlclxuICAgICAgfSlcbiAgICApO1xuICAgIGRpYWxvZy5hcHBlbmRUb0JvZHkoKTtcbiAgfSxcblxuICBfc2hvd0ltcG9ydFdhcm5pbmdzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZGlhbG9nID0gVmlld0ZhY3RvcnkuY3JlYXRlRGlhbG9nQnlWaWV3KFxuICAgICAgbmV3IFdhcm5pbmdzRGV0YWlsc1ZpZXcoe1xuICAgICAgICB3YXJuaW5nczogdGhpcy5tb2RlbC5nZXRXYXJuaW5ncygpLFxuICAgICAgICB1c2VyOiB0aGlzLnVzZXJcbiAgICAgIH0pXG4gICAgKTtcbiAgICBkaWFsb2cuYXBwZW5kVG9Cb2R5KCk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogIEltcG9ydCBsaW1pdCBtZXNzYWdlIHdpdGhpbiBiYWNrZ3JvdW5kIGltcG9ydGVyXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ0ltcG9ydEl0ZW0gSW1wb3J0SXRlbS0tc3RpY2t5JyxcbiAgdGFnTmFtZTogJ2xpJyxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy92aWV3cy9pbXBvcnRzL2JhY2tncm91bmRfaW1wb3J0X2xpbWl0Jyk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgaW1wb3J0UXVvdGEgPSB0aGlzLnVzZXIuZ2V0TWF4Q29uY3VycmVudEltcG9ydHMoKTtcbiAgICB2YXIgaXNVcGdyYWRlYWJsZSA9ICFjZGIuY29uZmlnLmdldCgnY2FydG9kYl9jb21faG9zdGVkJykgJiYgaW1wb3J0UXVvdGEgPT09IDE7XG5cbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGhpcy50ZW1wbGF0ZSh7XG4gICAgICAgIHVwZ3JhZGVVcmw6IHdpbmRvdy51cGdyYWRlX3VybCxcbiAgICAgICAgaXNVcGdyYWRlYWJsZTogaXNVcGdyYWRlYWJsZSxcbiAgICAgICAgaW1wb3J0UXVvdGE6IGltcG9ydFF1b3RhXG4gICAgICB9KVxuICAgICk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIEJhc2VEaWFsb2cgPSByZXF1aXJlKCcuLi8uLi8uLi92aWV3cy9iYXNlX2RpYWxvZy92aWV3Jyk7XG52YXIgVXRpbHMgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ11bJ1V0aWxzJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXVsnVXRpbHMnXSA6IG51bGwpO1xuXG4vKipcbiAqICBXaGVuIGEgVHdpdHRlciBpbXBvcnQgZmluaXNoZXMsIHRoaXMgZGlhbG9nIGRpc3BsYXlzXG4gKiAgYWxsIHRoZSBpbmZvIGFib3V0IHRoZSBwcmljZS9jb3N0IGV0Yy5cbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBCYXNlRGlhbG9nLmV4dGVuZCh7XG5cbiAgY2xhc3NOYW1lOiAnRGlhbG9nIFR3aXR0ZXJJbXBvcnREZXRhaWxzIGlzLW9wZW5pbmcnLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy92aWV3cy9pbXBvcnRzL3R3aXR0ZXJfaW1wb3J0X2RldGFpbHMnKTtcbiAgfSxcblxuICByZW5kZXJfY29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGltcCA9IHRoaXMubW9kZWwuZ2V0KCdpbXBvcnQnKTtcbiAgICB2YXIgdXNlclR3aXR0ZXJWYWx1ZXMgPSB0aGlzLnVzZXIuZ2V0KCd0d2l0dGVyJyk7XG4gICAgdmFyIGF2YWlsYWJsZVR3ZWV0cyA9IHVzZXJUd2l0dGVyVmFsdWVzLnF1b3RhIC0gdXNlclR3aXR0ZXJWYWx1ZXMubW9udGhseV91c2U7XG4gICAgdmFyIHZpcyA9IHRoaXMubW9kZWwuaW1wb3J0ZWRWaXMoKTtcbiAgICB2YXIgdXJsID0gdmlzICYmIGVuY29kZVVSSSh2aXMudmlld1VybCh0aGlzLnVzZXIpLmVkaXQoKSkgfHwgJyc7XG4gICAgdmFyIGQgPSB7XG4gICAgICB0eXBlOiB2aXMgJiYgdmlzLmdldCgndHlwZScpID09PSBcInRhYmxlXCIgPyBcImRhdGFzZXRcIiA6IFwibWFwXCIsXG4gICAgICBtYXBVUkw6IHVybCxcbiAgICAgIGRhdGFzZXRUb3RhbFJvd3M6IGltcC50d2VldHNfZ2VvcmVmZXJlbmNlZCxcbiAgICAgIGRhdGFzZXRUb3RhbFJvd3NGb3JtYXR0ZWQ6IFV0aWxzLmZvcm1hdE51bWJlcihpbXAudHdlZXRzX2dlb3JlZmVyZW5jZWQpLFxuICAgICAgdHdlZXRzQ29zdDogaW1wLnR3ZWV0c19jb3N0LFxuICAgICAgdHdlZXRzQ29zdEZvcm1hdHRlZDogVXRpbHMuZm9ybWF0TnVtYmVyKGltcC50d2VldHNfY29zdCksXG4gICAgICBhdmFpbGFibGVUd2VldHM6IGF2YWlsYWJsZVR3ZWV0cyxcbiAgICAgIGF2YWlsYWJsZVR3ZWV0c0Zvcm1hdHRlZDogVXRpbHMuZm9ybWF0TnVtYmVyKGF2YWlsYWJsZVR3ZWV0cyksXG4gICAgICB0d2VldHNPdmVycXVvdGE6IGltcC50d2VldHNfb3ZlcnF1b3RhLFxuICAgICAgdHdlZXRzT3ZlcnF1b3RhRm9ybWF0dGVkOiBVdGlscy5mb3JtYXROdW1iZXIoaW1wLnR3ZWV0c19vdmVycXVvdGEpLFxuICAgICAgYmxvY2tTaXplRm9ybWF0dGVkOiBVdGlscy5mb3JtYXROdW1iZXIodXNlclR3aXR0ZXJWYWx1ZXMuYmxvY2tfc2l6ZSksXG4gICAgICBibG9ja1ByaWNlRm9ybWF0dGVkOiBVdGlscy5mb3JtYXROdW1iZXIodXNlclR3aXR0ZXJWYWx1ZXMuYmxvY2tfcHJpY2UpXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy50ZW1wbGF0ZShkKTtcbiAgfVxuXG59KTtcbiIsInZhciBxdWV1ZSA9IHJlcXVpcmUoJ3F1ZXVlLWFzeW5jJyk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcblxuLyoqXG4gKiBDb252ZW5pZW50IG9iamVjdCB0byBkbyBhc3luYyBiYXRjaCBwcm9jZXNzaW5nLCBhbmQgZG9uJ3QgY29udGludWUgdW50aWwgYWxsIGl0ZW1zIGhhdmUgc3VjY2Vzc2Z1bGx5IGZpbmlzaGVkLlxuICogSW4gY2FzZSBvZiBlcnJvciBpdCB3aWxsIGZhaWwgaW1tZWRpYXRlbHkuXG4gKlxuICogRXhhbXBsZSB1c2FnZTpcbiAqICAgdmFyIGJhdGNoUHJvY2VzcyA9IHJlcXVpcmUoJy4uL2NvbW1vbi9iYXRjaF9wcm9jZXNzX2l0ZW1zJyk7XG4gKiAgIGJhdGNoUHJvY2Vzcyh7XG4gKiAgICAgaXRlbXM6IFsgLi4uIF0sXG4gKiAgICAgZG9uZTogZnVuY3Rpb24oKSB7XG4gKiAgICAgICB0aGlzLmNsb3NlKCk7XG4gKiAgICAgfSxcbiAqICAgICBmYWlsOiBmdW5jdGlvbihqcVhIUiwgZXJyb3JUeXBlLCBlKSB7XG4gKiAgICAgICB0aGlzLl9lcnJvck1zZyA9ICdTZXJ2ZXIgcmVzcG9uc2U6ICcrIGpxWEhSLnJlc3BvbnNlVGV4dDtcbiAqICAgICAgIHRoaXMucmVuZGVyKCk7XG4gKiAgICAgfVxuICogICB9KTtcbiAqXG4gKiBAcGFyYW0gb3B0cyB7T2JqZWN0fVxuICogICBob3dNYW55SW5QYXJhbGxlbDoge051bWJlcn1cbiAqICAgaXRlbXM6IHtBcnJheX0gZWFjaCBpdGVtIHdpbGwgYmUgcGFzc2VkIHRvIHByb2Nlc3NJdGVtKGl0ZW0sIC4uLlxuICogICBwcm9jZXNzSXRlbToge0Z1bmN0aW9ufSBnaXZlbiBhbiBpdGVtIGFuZCBhIGNhbGxiYWNrLCBzaG91bGQgY2FsbCBjYWxsYmFjaygpIGZvciBzdWNjZXNzIGNhc2UsIG9yIGNhbGxiYWNrKGVycm9yKSBpZiBzb21ldGhpbmcgZmFpbGVkLlxuICogICBmYWlsOiB7RnVuY3Rpb259XG4gKiAgIGRvbmU6IHtGdW5jdGlvbn0gY2FsbGVkIGlmIGFsbCBpdGVtc1xuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG9wdHMpIHtcbiAgdmFyIHEgPSBxdWV1ZShvcHRzLmhvd01hbnlJblBhcmFsbGVsKTtcbiAgXy5lYWNoKG9wdHMuaXRlbXMsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBxLmRlZmVyKGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICBvcHRzLnByb2Nlc3NJdGVtKGl0ZW0sIGNhbGxiYWNrKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgcS5hd2FpdEFsbChmdW5jdGlvbihlcnJvci8qLCByZXN1bHQxLCAuLi4sIHJlc3VsdE4gKi8pIHtcbiAgICAvLyBlcnJvciBhbmQgcmVzdWx0cyBjb250YWlucyBvdXRjb21lIG9mIHRoZSBqcVhIUiByZXF1ZXN0cyBhYm92ZSwgc2VlIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9qUXVlcnkuYWpheC8janFYSFJcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIG9wdHMuZmFpbChlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9wdHMuZG9uZSgpO1xuICAgIH1cbiAgfSk7XG59O1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBYWVpNb2RlbCA9IHJlcXVpcmUoJy4veHl6L3h5el9tb2RlbC5qcycpO1xudmFyIFdNU01vZGVsID0gcmVxdWlyZSgnLi93bXMvd21zX21vZGVsLmpzJyk7XG52YXIgTkFTQU1vZGVsID0gcmVxdWlyZSgnLi9uYXNhL25hc2FfbW9kZWwuanMnKTtcbnZhciBNYXBib3hNb2RlbCA9IHJlcXVpcmUoJy4vbWFwYm94L21hcGJveF9tb2RlbC5qcycpO1xudmFyIFRpbGVKU09OTW9kZWwgPSByZXF1aXJlKCcuL3RpbGVfanNvbi90aWxlX2pzb25fdmlld19tb2RlbC5qcycpO1xuXG4vKipcbiAqIFZpZXcgbW9kZWwgZm9yIHRoZSBhZGQtY3VzdG9tLWJhc2VtYXAgdmlld1xuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgZGVmYXVsdHM6IHtcbiAgICBtYXA6IHVuZGVmaW5lZCxcbiAgICBiYXNlTGF5ZXJzOiB1bmRlZmluZWQsXG4gICAgdGFiczogdW5kZWZpbmVkLFxuICAgIGN1cnJlbnRWaWV3OiAndGFicycsXG4gICAgY3VycmVudFRhYjogJ3h5eidcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbihhdHRycykge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcbiAgICBpZiAoIWF0dHJzLm1hcCkgdGhyb3cgbmV3IEVycm9yKCdtYXAgaXMgcmVxdWlyZWQnKTtcbiAgICBpZiAoIWF0dHJzLmJhc2VMYXllcnMpIHRocm93IG5ldyBFcnJvcignYmFzZUxheWVycyBpcyByZXF1aXJlZCcpO1xuICAgIHRoaXMuX2luaXRUYWJzKCk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgYWN0aXZlVGFiTW9kZWw6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgndGFicycpLndoZXJlKHsgbmFtZTogdGhpcy5nZXQoJ2N1cnJlbnRUYWInKSB9KVswXTtcbiAgfSxcblxuICBjYW5TYXZlQmFzZW1hcDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdjdXJyZW50VmlldycpID09PSAndGFicycgJiYgdGhpcy5fbGF5ZXJUb1NhdmUoKTtcbiAgfSxcblxuICBzYXZlQmFzZW1hcDogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLmNhblNhdmVCYXNlbWFwKCkpIHJldHVybjtcbiAgICB0aGlzLnNldCgnY3VycmVudFZpZXcnLCAnc2F2aW5nJyk7XG5cbiAgICB2YXIgbGF5ZXIgPSB0aGlzLl9sYXllclRvU2F2ZSgpO1xuICAgIGlmICh0aGlzLmFjdGl2ZVRhYk1vZGVsKCkuaGFzQWxyZWFkeUFkZGVkTGF5ZXIodGhpcy5nZXQoJ2Jhc2VMYXllcnMnKSkpIHtcbiAgICAgIHRoaXMuX29uTGF5ZXJTYXZlZChsYXllcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEFkZCB0byBiYXNlTGF5ZXJzIGNvbGxlY3Rpb24gYmVmb3JlIHNhdmluZywgc28gc2F2ZSBVUkwgcmVzb2x2ZXMgdG8gdGhlIGV4cGVjdGVkIGVuZHBvaW50LlxuICAgICAgdGhpcy5nZXQoJ2Jhc2VMYXllcnMnKS5hZGQobGF5ZXIpO1xuXG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICBsYXllci5zYXZlKClcbiAgICAgIC5kb25lKGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLl9vbkxheWVyU2F2ZWQobGF5ZXIpO1xuICAgICAgfSlcbiAgICAgIC5mYWlsKGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBDbGVhbnVwLCByZW1vdmUgbGF5ZXIgaXQgY291bGQgbm90IGJlIHNhdmVkIVxuICAgICAgICBzZWxmLmdldCgnYmFzZUxheWVycycpLnJlbW92ZShsYXllcik7XG4gICAgICAgIHNlbGYuc2V0KCdjdXJyZW50VmlldycsICdzYXZlRmFpbCcpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIF9vbkxheWVyU2F2ZWQ6IGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgdmFyIG1hcCA9IHRoaXMuZ2V0KCdtYXAnKTtcblxuICAgIHZhciBjbG9uZWRMYXllciA9IGxheWVyLmNsb25lKCk7XG4gICAgY2xvbmVkTGF5ZXIudW5zZXQoJ2lkJyk7XG4gICAgbWFwLmNoYW5nZVByb3ZpZGVyKCdsZWFmbGV0JywgY2xvbmVkTGF5ZXIpO1xuXG4gICAgdmFyIGJib3ggPSBsYXllci5nZXQoJ2JvdW5kaW5nX2JveGVzJyk7XG4gICAgaWYgKGJib3ggJiYgYmJveC5sZW5ndGggPT09IDQpIHtcbiAgICAgIG1hcC5zZXRCb3VuZHMoW1xuICAgICAgICBbYmJveFsxXSwgYmJveFswXV0sXG4gICAgICAgIFtiYm94WzNdLCBiYm94WzJdXVxuICAgICAgXSk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXQoJ2N1cnJlbnRWaWV3JywgJ3NhdmVEb25lJyk7XG4gIH0sXG5cbiAgX2luaXRUYWJzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgdGFicyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKFtcbiAgICAgIG5ldyBYWVpNb2RlbCgpLFxuICAgICAgbmV3IFdNU01vZGVsKHtcbiAgICAgICAgYmFzZUxheWVyczogdGhpcy5nZXQoJ2Jhc2VMYXllcnMnKVxuICAgICAgfSksXG4gICAgICBuZXcgTkFTQU1vZGVsKCksXG4gICAgICBuZXcgTWFwYm94TW9kZWwoKSxcbiAgICAgIG5ldyBUaWxlSlNPTk1vZGVsKClcbiAgICBdKTtcbiAgICB0aGlzLnNldCh7XG4gICAgICB0YWJzOiB0YWJzLFxuICAgICAgY3VycmVudFRhYjogdGFicy5maXJzdCgpLmdldCgnbmFtZScpXG4gICAgfSk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5nZXQoJ3RhYnMnKS5lYWNoKGZ1bmN0aW9uKHRhYk1vZGVsKSB7XG4gICAgICB0YWJNb2RlbC5iaW5kKCdzYXZlQmFzZW1hcCcsIHRoaXMuc2F2ZUJhc2VtYXAsIHRoaXMpO1xuICAgIH0sIHRoaXMpO1xuICB9LFxuXG4gIF9sYXllclRvU2F2ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuYWN0aXZlVGFiTW9kZWwoKS5nZXQoJ2xheWVyJyk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcuanMnKTtcbnZhciByYW5kb21RdW90ZSA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfaGVscGVycy9yYW5kb21fcXVvdGUuanMnKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfZmFjdG9yeS5qcycpO1xudmFyIFZpZXdNb2RlbCA9IHJlcXVpcmUoJy4vYWRkX2N1c3RvbV9iYXNlbWFwX21vZGVsLmpzJyk7XG52YXIgVGFic1ZpZXcgPSByZXF1aXJlKCcuL3RhYnNfdmlldy5qcycpO1xuXG4vKipcbiAqIERpYWxvZyB0byBhZGQgwq9jdXN0b20gYmFzZW1hcCB0byBjdXJyZW50IG1hcC5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBCYXNlRGlhbG9nLmV4dGVuZCh7XG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgIHRoaXMubW9kZWwgPSBuZXcgVmlld01vZGVsKHtcbiAgICAgIG1hcDogdGhpcy5vcHRpb25zLm1hcCxcbiAgICAgIGJhc2VMYXllcnM6IHRoaXMub3B0aW9ucy5iYXNlTGF5ZXJzXG4gICAgfSk7XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEBvdmVycmlkZSBjZGIudWkuY29tbW9uLkRpYWxvZy5wcm90b3R5cGUucmVuZGVyXG4gICAqL1xuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VEaWFsb2cucHJvdG90eXBlLnJlbmRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIHRoaXMuJCgnLmNvbnRlbnQnKS5hZGRDbGFzcygnRGlhbG9nLWNvbnRlbnRXcmFwcGVyJyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEBpbXBsZW1lbnRzIGNkYi51aS5jb21tb24uRGlhbG9nLnByb3RvdHlwZS5yZW5kZXJfY29udGVudFxuICAgKi9cbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjb250ZW50VmlldyA9IHRoaXMuX3BhbmVzLmFjdGl2ZSh0aGlzLm1vZGVsLmdldCgnY3VycmVudFZpZXcnKSkucmVuZGVyKCk7XG4gICAgY29udGVudFZpZXcuJGVsLmFkZENsYXNzKCdEaWFsb2ctYm9keSBEaWFsb2ctYm9keS0tZXhwYW5kZWQgRGlhbG9nLWJvZHktLWNyZWF0ZScpO1xuICAgIGNvbnRlbnRWaWV3LmRlbGVnYXRlRXZlbnRzKCk7IC8vIGVuYWJsZSBldmVudHMgYWZ0ZXIgYmVpbmcgYWRkZWQgdG8gJGVsXG4gICAgdmFyICRlbCA9ICQoXG4gICAgICBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9hZGRfY3VzdG9tX2Jhc2VtYXAvYWRkX2N1c3RvbV9iYXNlbWFwJykoe1xuICAgICAgICBtb2RlbDogdGhpcy5tb2RlbFxuICAgICAgfSlcbiAgICApO1xuICAgICRlbC5hcHBlbmQoY29udGVudFZpZXcuZWwpO1xuICAgIHJldHVybiAkZWw7XG4gIH0sXG5cbiAgb2s6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm1vZGVsLmNhblNhdmVCYXNlbWFwKCkpIHtcbiAgICAgIHRoaXMubW9kZWwuc2F2ZUJhc2VtYXAoKTtcbiAgICB9XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fcGFuZXMgPSBuZXcgY2RiLnVpLmNvbW1vbi5UYWJQYW5lKHtcbiAgICAgIGVsOiB0aGlzLmVsXG4gICAgfSk7XG4gICAgdGhpcy5hZGRWaWV3KHRoaXMuX3BhbmVzKTtcbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ3RhYnMnLFxuICAgICAgbmV3IFRhYnNWaWV3KHtcbiAgICAgICAgbW9kZWw6IHRoaXMubW9kZWxcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ3NhdmluZycsXG4gICAgICBWaWV3RmFjdG9yeS5jcmVhdGVCeVRlbXBsYXRlKCdjb21tb24vdGVtcGxhdGVzL2xvYWRpbmcnLCB7XG4gICAgICAgIHRpdGxlOiAnU2V0dGluZyBiYXNlbWFw4oCmJyxcbiAgICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICAgIH0pLnJlbmRlcigpXG4gICAgKTtcbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ3NhdmVGYWlsJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvZmFpbCcsIHtcbiAgICAgICAgbXNnOiAnJ1xuICAgICAgfSkucmVuZGVyKClcbiAgICApO1xuICAgIHRoaXMuX3BhbmVzLmFjdGl2ZSh0aGlzLm1vZGVsLmdldCgnY3VycmVudFZpZXcnKSk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6Y3VycmVudFZpZXcnLCB0aGlzLl9vbkN1cnJlbnRWaWV3Q2hhbmdlLCB0aGlzKTtcbiAgfSxcblxuICBfb25DdXJyZW50Vmlld0NoYW5nZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdjdXJyZW50VmlldycpID09PSAnc2F2ZURvbmUnKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgfVxuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBNYXBib3hWaWV3ID0gcmVxdWlyZSgnLi9tYXBib3hfdmlldycpO1xudmFyIE1hcGJveFRvVGlsZUxheWVyRmFjdG9yeSA9IHJlcXVpcmUoJy4vbWFwYm94X3RvX3RpbGVfbGF5ZXJfZmFjdG9yeScpO1xuXG4vKipcbiAqIFZpZXcgbW9kZWwgZm9yIFhZWiB0YWIgY29udGVudC5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIGRlZmF1bHRzOiB7XG4gICAgbmFtZTogJ21hcGJveCcsXG4gICAgbGFiZWw6ICdNYXBib3gnLFxuICAgIGN1cnJlbnRWaWV3OiAnZW50ZXJVUkwnLCAvLywgdmFsaWRhdGluZ0lucHV0cywgdmFsaWRcbiAgICBsYXN0RXJyb3JNc2c6ICcnLCAvL3NldCBpZiBmYWlscyB0byBzYXZlXG4gICAgbGF5ZXI6IHVuZGVmaW5lZCAvLyB3aWxsIGJlIHNldCB3aGVuIHZhbGlkXG4gIH0sXG5cbiAgY3JlYXRlVmlldzogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgY3VycmVudFZpZXc6ICdlbnRlclVSTCcsXG4gICAgICBsYXllcjogdW5kZWZpbmVkXG4gICAgfSk7XG4gICAgcmV0dXJuIG5ldyBNYXBib3hWaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzXG4gICAgfSk7XG4gIH0sXG5cbiAgaGFzQWxyZWFkeUFkZGVkTGF5ZXI6IGZ1bmN0aW9uKGJhc2VMYXllcnMpIHtcbiAgICB2YXIgdXJsVGVtcGxhdGUgPSB0aGlzLmdldCgnbGF5ZXInKS5nZXQoJ3VybFRlbXBsYXRlJyk7XG4gICAgcmV0dXJuIF8uYW55KGJhc2VMYXllcnMuY3VzdG9tKCksIGZ1bmN0aW9uKGN1c3RvbUxheWVyKSB7XG4gICAgICByZXR1cm4gY3VzdG9tTGF5ZXIuZ2V0KCd1cmxUZW1wbGF0ZScpID09PSB1cmxUZW1wbGF0ZTtcbiAgICB9KTtcbiAgfSxcblxuICBzYXZlOiBmdW5jdGlvbih1cmwsIGFjY2Vzc1Rva2VuKSB7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgY3VycmVudFZpZXc6ICd2YWxpZGF0aW5nSW5wdXRzJyxcbiAgICAgIHVybDogdXJsLFxuICAgICAgYWNjZXNzVG9rZW46IGFjY2Vzc1Rva2VuXG4gICAgfSk7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIG1mID0gbmV3IE1hcGJveFRvVGlsZUxheWVyRmFjdG9yeSh7XG4gICAgICB1cmw6IHVybCxcbiAgICAgIGFjY2Vzc1Rva2VuOiBhY2Nlc3NUb2tlblxuICAgIH0pO1xuICAgIG1mLmNyZWF0ZVRpbGVMYXllcih7XG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbih0aWxlTGF5ZXIpIHtcbiAgICAgICAgc2VsZi5zZXQoJ2xheWVyJywgdGlsZUxheWVyKTtcbiAgICAgICAgc2VsZi50cmlnZ2VyKCdzYXZlQmFzZW1hcCcpO1xuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnJvck1zZykge1xuICAgICAgICBzZWxmLnNldCh7XG4gICAgICAgICAgY3VycmVudFZpZXc6ICdlbnRlclVSTCcsXG4gICAgICAgICAgbGFzdEVycm9yTXNnOiBlcnJvck1zZ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSk7XG4iLCJ2YXIgJCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WyckJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyckJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogRmFjdG9yeSB0byBjcmVhdGUgYSBjZGIuYWRtaW4uVGlsZUxheWVyIGZyb20gYSBnaXZlbiBVUkwgYW5kIGFjY2VzcyB0b2tlbiB0dXBsZSBmb3IgTWFwYm94LlxuICogRXh0cmFjdGVkIGZyb20gbWFwYm94X2Jhc2VtYXBfcGFuZSB0byBtYWludGFpbiBjdXJyZW50IGxvZ2ljLCBzaW5jZSBpdCdzIHJhdGhlciBjb21wbGV44oCmXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBkZWZhdWx0czoge1xuICAgIHVybDogJycsXG4gICAgYWNjZXNzVG9rZW46ICcnXG4gIH0sXG5cbiAgX01BUEJPWDoge1xuICAgIHZlcnNpb246IDQsXG4gICAgaHR0cHM6ICdodHRwczovL2RudjlteTJlc2VvYmQuY2xvdWRmcm9udC5uZXQnLFxuICAgIGJhc2U6ICdodHRwczovL2EudGlsZXMubWFwYm94LmNvbS8nXG4gIH0sXG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjYWxsYmFja3NcbiAgICogICBzdWNjZXNzIHtGdW5jdGlvbn0gZ2l2ZW4gYSBuZXcgVGlsZUxheWVyIG9iamVjdFxuICAgKiAgIGVycm9yIHtGdW5jdGlvbn0gZ2l2ZW4gYW4gZXJyb3IgZXhwbGFuYXRpb25cbiAgICovXG4gIGNyZWF0ZVRpbGVMYXllcjogZnVuY3Rpb24oY2FsbGJhY2tzKSB7XG4gICAgdmFyIHZhbCA9IHRoaXMuZ2V0KCd1cmwnKTtcbiAgICB2YXIgdXJsID0gdGhpcy5fbG93ZXJYWVoodmFsKTtcbiAgICB2YXIgYWNjZXNzX3Rva2VuID0gdGhpcy5nZXQoJ2FjY2Vzc1Rva2VuJyk7XG4gICAgdmFyIHR5cGUgPSAnanNvbic7XG4gICAgdmFyIHN1YmRvbWFpbnMgPSBbJ2EnLCAnYicsICdjJ107XG4gICAgdmFyIG1hcGJveF9pZDtcblxuICAgIC8vIERldGVjdHMgdGhlIFVSTCdzIHR5cGVcbiAgICBpZiAodXJsLmluZGV4T2YoJ3t4fScpIDwgMCAmJiB1cmwuaW5kZXhPZigndGlsZXMubWFwYm94LmNvbScpICE9PSAtMSkge1xuICAgICAgbWFwYm94X2lkID0gdGhpcy5fZ2V0TWFwQm94TWFwSUQodXJsKTtcbiAgICAgIGlmIChtYXBib3hfaWQpIHtcbiAgICAgICAgdHlwZSA9ICdtYXBib3hfaWQnO1xuICAgICAgICB1cmwgPSBtYXBib3hfaWQ7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh1cmwuaW5kZXhPZigne3h9JykgIT09IC0xKSB7XG4gICAgICB0eXBlID0gJ3h5eic7XG4gICAgICB1cmwgPSB1cmwucmVwbGFjZSgvXFx7c1xcfS9nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gc3ViZG9tYWluc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzKV07XG4gICAgICAgIH0pXG4gICAgICAgIC5yZXBsYWNlKC9cXHt4XFx9L2csICcwJylcbiAgICAgICAgLnJlcGxhY2UoL1xce3lcXH0vZywgJzAnKVxuICAgICAgICAucmVwbGFjZSgvXFx7elxcfS9nLCAnMCcpO1xuICAgIH0gZWxzZSBpZiAodXJsICYmIHVybC5pbmRleE9mKCdodHRwJykgPCAwICYmIHVybC5tYXRjaCgvKC4qPylcXC4oLiopLykgIT0gbnVsbCAmJiB1cmwubWF0Y2goLyguKj8pXFwuKC4qKS8pLmxlbmd0aCA9PT0gMykge1xuICAgICAgdHlwZSA9ICdtYXBib3hfaWQnO1xuICAgICAgbWFwYm94X2lkID0gdmFsO1xuICAgIH0gZWxzZSB7IC8vIElmIG5vdCwgY2hlY2sgaHR0cHNcbiAgICAgIHVybCA9IHRoaXMuX2ZpeEhUVFBTKHVybCk7XG4gICAgfVxuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBpbWFnZTtcbiAgICBpZiAodHlwZSA9PT0gJ21hcGJveCcpIHtcbiAgICAgIGNhbGxiYWNrcy5zdWNjZXNzKHRoaXMuX25ld1RpbGVMYXllcih7IHRpbGVzOiBbdXJsXSB9KSk7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSAneHl6Jykge1xuICAgICAgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICAgIGltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBjYWxsYmFja3Muc3VjY2VzcyhzZWxmLl9uZXdUaWxlTGF5ZXIoe1xuICAgICAgICAgIHRpbGVzOiBbc2VsZi5fbG93ZXJYWVoodmFsKV1cbiAgICAgICAgfSkpO1xuICAgICAgfTtcbiAgICAgIGltYWdlLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgY2FsbGJhY2tzLmVycm9yKHNlbGYuX2Vycm9yVG9Nc2coKSk7XG4gICAgICB9O1xuICAgICAgaW1hZ2Uuc3JjID0gdXJsO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ21hcGJveF9pZCcpIHtcbiAgICAgIHZhciBwYXJhbXMgPSAnP2FjY2Vzc190b2tlbj0nICsgYWNjZXNzX3Rva2VuO1xuICAgICAgdmFyIGJhc2VfdXJsID0gdGhpcy5fTUFQQk9YLmJhc2UgKyAndicgKyB0aGlzLl9NQVBCT1gudmVyc2lvbiArICcvJyArIG1hcGJveF9pZDtcbiAgICAgIHZhciB0aWxlX3VybCA9IGJhc2VfdXJsICsgJy97en0ve3h9L3t5fS5wbmcnICsgcGFyYW1zO1xuICAgICAgdmFyIGpzb25fdXJsID0gYmFzZV91cmwgKyAnLmpzb24nICsgcGFyYW1zO1xuXG4gICAgICAvLyBKUXVlcnkgaGFzIGEgZmF1bHR5IGltcGxlbWVudGF0aW9uIG9mIHRoZSBnZXRKU09OIG1ldGhvZCBhbmQgZG9lc24ndCByZXR1cm5cbiAgICAgIC8vIGEgNDA0LCBzbyB3ZSB1c2UgYSB0aW1lb3V0LiBUT0RPOiByZXBsYWNlIHdpdGggQ09SU1xuICAgICAgdmFyIGVycm9yVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgIGNhbGxiYWNrcy5lcnJvcihzZWxmLl9lcnJvclRvTXNnKCkpO1xuICAgICAgfSwgNTAwMCk7XG5cbiAgICAgICQuYWpheCh7XG4gICAgICAgIHVybDoganNvbl91cmwsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQoZXJyb3JUaW1lb3V0KTtcbiAgICAgICAgICBjYWxsYmFja3Muc3VjY2VzcyhzZWxmLl9uZXdUaWxlTGF5ZXIoe1xuICAgICAgICAgICAgdGlsZXM6IFt0aWxlX3VybF0sXG4gICAgICAgICAgICBhdHRyaWJ1dGlvbjogZGF0YS5hdHRyaWJ1dGlvbixcbiAgICAgICAgICAgIG1pbnpvb206IGRhdGEubWluem9vbSxcbiAgICAgICAgICAgIG1heHpvb206IGRhdGEubWF4em9vbSxcbiAgICAgICAgICAgIG5hbWU6IGRhdGEubmFtZVxuICAgICAgICAgIH0pKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQoZXJyb3JUaW1lb3V0KTtcbiAgICAgICAgICBjYWxsYmFja3MuZXJyb3Ioc2VsZi5fZXJyb3JUb01zZyhlKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYWxsYmFja3MuZXJyb3IodGhpcy5fZXJyb3JUb01zZygpKTtcbiAgICB9XG4gIH0sXG5cbiAgX25ld1RpbGVMYXllcjogZnVuY3Rpb24oZGF0YSkge1xuICAgIC8vIENoZWNrIGlmIHRoZSByZXNwb25kIGlzIGFuIGFycmF5XG4gICAgLy8gSW4gdGhhdCBjYXNlLCBnZXQgb25seSB0aGUgZmlyc3RcbiAgICBpZiAoXy5pc0FycmF5KGRhdGEpICYmIF8uc2l6ZShkYXRhKSA+IDApIHtcbiAgICAgIGRhdGEgPSBfLmZpcnN0KGRhdGEpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgY2RiLmFkbWluLlRpbGVMYXllcih7XG4gICAgICB1cmxUZW1wbGF0ZTogZGF0YS50aWxlc1swXSxcbiAgICAgIGF0dHJpYnV0aW9uOiBkYXRhLmF0dHJpYnV0aW9uIHx8IG51bGwsXG4gICAgICBtYXhab29tOiBkYXRhLm1heHpvb20gfHwgMjEsXG4gICAgICBtaW5ab29tOiBkYXRhLm1pbnpvb20gfHwgMCxcbiAgICAgIG5hbWU6IGRhdGEubmFtZSB8fCAnJ1xuICAgIH0pO1xuICB9LFxuXG4gIF9lcnJvclRvTXNnOiBmdW5jdGlvbihlcnJvcikge1xuICAgIGlmICh0eXBlb2YgZXJyb3IgPT09ICdvYmplY3QnIHx8ICFlcnJvcikge1xuICAgICAgaWYgKGVycm9yICYmIGVycm9yLnN0YXR1cyAmJiBlcnJvci5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICByZXR1cm4gJ0Vycm9yIHJldHJpZXZpbmcgeW91ciBiYXNlbWFwLiBQbGVhc2UsIGNoZWNrIHlvdXIgYWNjZXNzIHRva2VuLic7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJ1RoaXMgdmFsdWUgaXMgbm90IHZhbGlkLic7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVycm9yO1xuICB9LFxuXG4gIF9sb3dlclhZWjogZnVuY3Rpb24odXJsKSB7XG4gICAgcmV0dXJuIHVybC5yZXBsYWNlKC9cXHtTXFx9L2csIFwie3N9XCIpXG4gICAgICAucmVwbGFjZSgvXFx7WFxcfS9nLCBcInt4fVwiKVxuICAgICAgLnJlcGxhY2UoL1xce1lcXH0vZywgXCJ7eX1cIilcbiAgICAgIC5yZXBsYWNlKC9cXHtaXFx9L2csIFwie3p9XCIpO1xuICB9LFxuXG4gIC8vIEV4dHJhY3RzIHRoZSBNYXBib3ggTWFwSWQgZnJvbSBhIE1hcGJveCBVUkxcbiAgX2dldE1hcEJveE1hcElEOiBmdW5jdGlvbih1cmwpIHtcbiAgICAvLyBodHRwOi8vZC50aWxlcy5tYXBib3guY29tL3YzL3t1c2VyfS57bWFwfS8zLzQvMy5wbmdcbiAgICAvLyBodHRwOi8vYS50aWxlcy5tYXBib3guY29tL3YzL3t1c2VyfS57bWFwfS9wYWdlLmh0bWxcbiAgICAvLyBodHRwOi8vYS50aWxlcy5tYXBib3guY29tL3Y0L3t1c2VyfS57bWFwfS4qXG4gICAgdmFyIHJlZzEgPSAvaHR0cHM/OlxcL1xcL1thLXpdP1xcLj90aWxlc1xcLm1hcGJveC5jb21cXC92KFxcZClcXC8oW15cXC8uXSopXFwuKFteXFwvLl0qKS87XG5cbiAgICAvLyBodHRwczovL3RpbGVzLm1hcGJveC5jb20ve3VzZXJ9L2VkaXQve21hcH0/bmV3bWFwJnByZXNldD1TdHJlZXRzIzMvMC4wMC8tMC4wOVxuICAgIHZhciByZWcyID0gL2h0dHBzPzpcXC9cXC90aWxlc1xcLm1hcGJveFxcLmNvbVxcLyguKj8pXFwvZWRpdFxcLyguKj8pKFxcP3wjKS87XG5cbiAgICB2YXIgbWF0Y2ggPSAnJztcblxuICAgIC8vIENoZWNrIGZpcnN0IGV4cHJlc2lvblxuICAgIG1hdGNoID0gdXJsLm1hdGNoKHJlZzEpO1xuXG4gICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdICYmIG1hdGNoWzJdKSB7XG4gICAgICByZXR1cm4gbWF0Y2hbMl0gKyBcIi5cIiArIG1hdGNoWzNdO1xuICAgIH1cblxuICAgIC8vIENoZWNrIHNlY29uZCBleHByZXNpb25cbiAgICBtYXRjaCA9IHVybC5tYXRjaChyZWcyKTtcblxuICAgIGlmIChtYXRjaCAmJiBtYXRjaFsxXSAmJiBtYXRjaFsyXSkge1xuICAgICAgcmV0dXJuIG1hdGNoWzFdICsgXCIuXCIgKyBtYXRjaFsyXTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIHJldHVybiBhIGh0dHBzIHVybCBpZiB0aGUgY3VycmVudCBhcHBsaWNhdGlvbiBpcyBsb2FkZWQgZnJvbSBodHRwc1xuICAgKi9cbiAgX2ZpeEhUVFBTOiBmdW5jdGlvbih1cmwsIGxvYykge1xuICAgIGxvYyA9IGxvYyB8fCBsb2NhdGlvbjtcblxuICAgIC8vIGZpeCB0aGUgdXJsIHRvIGh0dHBzIG9yIGh0dHBcbiAgICBpZiAodXJsLmluZGV4T2YoJ2h0dHBzJykgIT09IDAgJiYgbG9jLnByb3RvY29sID09PSAnaHR0cHM6Jykge1xuICAgICAgLy8gc2VhcmNoIGZvciBtYXBwaW5nXG4gICAgICB2YXIgaSA9IHVybC5pbmRleE9mKCdtYXBib3guY29tJyk7XG4gICAgICBpZiAoaSAhPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX01BUEJPWC5odHRwcyArIHVybC5zdWJzdHIoaSArICdtYXBib3guY29tJy5sZW5ndGgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVybC5yZXBsYWNlKC9odHRwLywgJ2h0dHBzJyk7XG4gICAgfVxuICAgIHJldHVybiB1cmw7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uLy4uL3ZpZXdfZmFjdG9yeS5qcycpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vLi4vLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZS5qcycpO1xuXG5cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgTWFwYm94IHRhYiBjb250ZW50LlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2sgLmpzLW9rJzogJ19vbkNsaWNrT0snLFxuICAgICdrZXlkb3duJzogJ19vbktleURvd24nLFxuICAgICdrZXl1cCc6ICdfb25LZXlVcCdcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcblxuICAgIHZhciB2aWV3O1xuICAgIHN3aXRjaCAodGhpcy5tb2RlbC5nZXQoJ2N1cnJlbnRWaWV3JykpIHtcbiAgICAgIGNhc2UgJ3ZhbGlkYXRpbmdJbnB1dHMnOlxuICAgICAgICB2aWV3ID0gVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9sb2FkaW5nJywge1xuICAgICAgICAgIHRpdGxlOiAnVmFsaWRhdGluZ+KApicsXG4gICAgICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZW50ZXJVUkwnOlxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdmlldyA9IFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2FkZF9jdXN0b21fYmFzZW1hcC9tYXBib3gvZW50ZXJfdXJsJywge1xuICAgICAgICAgIHVybDogdGhpcy5tb2RlbC5nZXQoJ3VybCcpLFxuICAgICAgICAgIGFjY2Vzc1Rva2VuOiB0aGlzLm1vZGVsLmdldCgnYWNjZXNzVG9rZW4nKSxcbiAgICAgICAgICBsYXN0RXJyb3JNc2c6IHRoaXMubW9kZWwuZ2V0KCdsYXN0RXJyb3JNc2cnKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy5hZGRWaWV3KHZpZXcpO1xuICAgIHRoaXMuJGVsLmFwcGVuZCh2aWV3LnJlbmRlcigpLmVsKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICB9LFxuXG4gIF9oYXNWYWx1ZXM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl91cmxWYWwoKSAmJiB0aGlzLl9hY2Nlc3NUb2tlbigpO1xuICB9LFxuXG4gIF91cmxWYWw6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLiQoJy5qcy11cmwnKS52YWwoKTtcbiAgfSxcblxuICBfYWNjZXNzVG9rZW46IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLiQoJy5qcy1hY2Nlc3MtdG9rZW4nKS52YWwoKTtcbiAgfSxcblxuICBfb25DbGlja09LOiBmdW5jdGlvbihldikge1xuICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICBpZiAodGhpcy5faGFzVmFsdWVzKCkpIHtcbiAgICAgIHZhciB1cmwgPSB0aGlzLl91cmxWYWwoKTtcbiAgICAgIHZhciBhY2Nlc3NUb2tlbiA9IHRoaXMuX2FjY2Vzc1Rva2VuKCk7XG4gICAgICB0aGlzLm1vZGVsLnNhdmUodXJsLCBhY2Nlc3NUb2tlbik7XG4gICAgfVxuICB9LFxuXG4gIF9vbktleURvd246IGZ1bmN0aW9uKGV2KSB7XG4gICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy4kKCcuanMtZXJyb3InKS5yZW1vdmVDbGFzcygnaXMtdmlzaWJsZScpO1xuICB9LFxuXG4gIF9vbktleVVwOiBmdW5jdGlvbihldikge1xuICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIHRoaXMuJCgnLmpzLW9rJykudG9nZ2xlQ2xhc3MoJ2lzLWRpc2FibGVkJywgIXRoaXMuX2hhc1ZhbHVlcygpKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgTkFTQVZpZXcgPSByZXF1aXJlKCcuL25hc2FfdmlldycpO1xudmFyIG1vbWVudCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydtb21lbnQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ21vbWVudCddIDogbnVsbCk7XG5cbnZhciBUWVBFUyA9IHtcbiAgZGF5OiB7XG4gICAgdXJsOiAgICAgICAgICAnaHR0cDovL21hcDEudmlzLmVhcnRoZGF0YS5uYXNhLmdvdi93bXRzLXdlYm1lcmMvTU9ESVNfVGVycmFfQ29ycmVjdGVkUmVmbGVjdGFuY2VfVHJ1ZUNvbG9yL2RlZmF1bHQvPCUtIGRhdGUgJT4vR29vZ2xlTWFwc0NvbXBhdGlibGVfTGV2ZWw5L3t6fS97eX0ve3h9LmpwZWcnLFxuICAgIGxpbWl0OiAgICAgICAgJzIwMTItMDUtMDEnLFxuICAgIGRlZmF1bHQ6ICAgICAgJzIwMTItMDUtMDEnLFxuICAgIGF0dHJpYnV0aW9uOiAgJzxhIGhyZWY9XCJodHRwOi8vZWFydGhkYXRhLm5hc2EuZ292L2dpYnNcIiB0YXJnZXQ9XCJfYmxhbmtcIj5OQVNBIEVPU0RJUyBHSUJTPC9hPicsXG4gICAgbmFtZTogICAgICAgICAnTkFTQSBUZXJyYScsXG4gICAgbWF4Wm9vbTogICAgICA5LFxuICAgIG1pblpvb206ICAgICAgMVxuICB9LFxuXG4gIG5pZ2h0OiB7XG4gICAgdXJsOiAgICAgICAgICAnaHR0cDovL21hcDEudmlzLmVhcnRoZGF0YS5uYXNhLmdvdi93bXRzLXdlYm1lcmMvVklJUlNfQ2l0eUxpZ2h0c18yMDEyL2RlZmF1bHQvPCUtIGRhdGUgJT4vR29vZ2xlTWFwc0NvbXBhdGlibGVfTGV2ZWw4L3t6fS97eX0ve3h9LmpwZWcnLFxuICAgIGxpbWl0OiAgICAgICAgJzIwMTItMDUtMDEnLFxuICAgIGRlZmF1bHQ6ICAgICAgJzIwMTItMDUtMDInLFxuICAgIGF0dHJpYnV0aW9uOiAgJzxhIGhyZWY9XCJodHRwOi8vZWFydGhkYXRhLm5hc2EuZ292L2dpYnNcIiB0YXJnZXQ9XCJfYmxhbmtcIj5OQVNBIEVPU0RJUyBHSUJTPC9hPicsXG4gICAgbmFtZTogICAgICAgICAnTkFTQSBFYXJ0aCBhdCBuaWdodCcsXG4gICAgbWF4Wm9vbTogICAgICA4LFxuICAgIG1pblpvb206ICAgICAgMVxuICB9XG59O1xuXG4vKipcbiAqIFZpZXcgbW9kZWwgZm9yIFhZWiB0YWIgY29udGVudC5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIGRlZmF1bHRzOiB7XG4gICAgbmFtZTogJ25hc2EnLFxuICAgIGxhYmVsOiAnTkFTQScsXG4gICAgbGF5ZXI6IHVuZGVmaW5lZCwgLy9nZXRzIHNldCBvbiBkYXlPck5pZ2h0L2RhdGUgY2hhbmdlc1xuICAgIGxheWVyVHlwZTogJ2RheScsXG5cbiAgICAvLyBmb3IgZGF0ZSBwaWNrZXJcbiAgICBkYXRlOiB1bmRlZmluZWQsXG4gICAgY3VycmVudDogdW5kZWZpbmVkLFxuICAgIGZvcm1hdDogJ1ktbS1kJyAvLyBZWVlZLU1NLUREXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIGNyZWF0ZVZpZXc6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB1dGMgPSBuZXcgRGF0ZSgpLmdldFRpbWV6b25lT2Zmc2V0KCk7XG4gICAgdmFyIHRvZGF5ID0gbW9tZW50KG5ldyBEYXRlKCkpLnV0Y09mZnNldCh1dGMpLmZvcm1hdCgnWVlZWS1NTS1ERCcpO1xuICAgIHZhciB5ZXN0ZXJkYXkgPSBtb21lbnQobmV3IERhdGUoKSkudXRjT2Zmc2V0KHV0Yykuc3VidHJhY3QoMSwgJ2RheXMnKS5mb3JtYXQoJ1lZWVktTU0tREQnKTtcbiAgICB0aGlzLnNldCh7XG4gICAgICBjdXJyZW50OiB0b2RheSxcbiAgICAgIGRhdGU6IHllc3RlcmRheVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5ldyBOQVNBVmlldyh7XG4gICAgICBtb2RlbDogdGhpc1xuICAgIH0pO1xuICB9LFxuXG4gIGhhc0FscmVhZHlBZGRlZExheWVyOiBmdW5jdGlvbihiYXNlTGF5ZXJzKSB7XG4gICAgdmFyIHVybFRlbXBsYXRlID0gdGhpcy5nZXQoJ2xheWVyJykuZ2V0KCd1cmxUZW1wbGF0ZScpO1xuICAgIHJldHVybiBfLmFueShiYXNlTGF5ZXJzLmN1c3RvbSgpLCBmdW5jdGlvbihjdXN0b21MYXllcikge1xuICAgICAgcmV0dXJuIGN1c3RvbUxheWVyLmdldCgndXJsVGVtcGxhdGUnKSA9PT0gdXJsVGVtcGxhdGU7XG4gICAgfSk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5iaW5kKCdjaGFuZ2U6ZGF0ZSBjaGFuZ2U6bGF5ZXJUeXBlJywgdGhpcy5fb25DaGFuZ2UsIHRoaXMpO1xuICB9LFxuXG4gIF9vbkNoYW5nZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGRhdGVTdHIgPSB0aGlzLmdldCgnZGF0ZScpO1xuICAgIHZhciBsYXllclR5cGUgPSB0aGlzLmdldCgnbGF5ZXJUeXBlJyk7XG4gICAgdGhpcy5zZXQoJ2xheWVyJywgbmV3IGNkYi5hZG1pbi5UaWxlTGF5ZXIoe1xuICAgICAgdXJsVGVtcGxhdGU6IF8udGVtcGxhdGUoVFlQRVNbbGF5ZXJUeXBlXS51cmwpKHtcbiAgICAgICAgZGF0ZTogZGF0ZVN0clxuICAgICAgfSksXG4gICAgICBhdHRyaWJ1dGlvbjogVFlQRVNbbGF5ZXJUeXBlXS5hdHRyaWJ1dGlvbixcbiAgICAgIG1heFpvb206IFRZUEVTW2xheWVyVHlwZV0ubWF4Wm9vbSxcbiAgICAgIG1pblpvb206IFRZUEVTW2xheWVyVHlwZV0ubWluWm9vbSxcbiAgICAgIG5hbWU6IFRZUEVTW2xheWVyVHlwZV0ubmFtZSArICcgJyArIGRhdGVTdHJcbiAgICB9KSk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgbW9tZW50ID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ21vbWVudCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnbW9tZW50J10gOiBudWxsKTtcbnZhciBEYXRlRmllbGRWaWV3ID0gcmVxdWlyZSgnLi4vLi4vLi4vZWRpdF9maWVsZHMvZGF0ZV9maWVsZC9kYXRlX2ZpZWxkX3ZpZXcnKTtcbnZhciBFZGl0RmllbGRNb2RlbCA9IHJlcXVpcmUoJy4uLy4uLy4uL2VkaXRfZmllbGRzL2VkaXRfZmllbGRfbW9kZWwnKTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBYWVogdGFiIGNvbnRlbnQuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIG9wdGlvbnM6IHtcbiAgICBkYXRlRm9ybWF0OiAnWVlZWS1NTS1ERCdcbiAgfSxcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2sgLmpzLWRheSc6ICdfb25DaGFuZ2VUb0RheScsXG4gICAgJ2NsaWNrIC5qcy1uaWdodCc6ICdfb25DaGFuZ2VUb05pZ2h0J1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcbiAgICB0aGlzLmRhdGVNb2RlbCA9IG5ldyBFZGl0RmllbGRNb2RlbCh7XG4gICAgICB2YWx1ZTogdGhpcy5tb2RlbC5nZXQoJ2RhdGUnKSxcbiAgICAgIHR5cGU6ICdkYXRlJ1xuICAgIH0pO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG5cbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvYWRkX2N1c3RvbV9iYXNlbWFwL25hc2EvbmFzYScpKHtcbiAgICAgICAgbGF5ZXJUeXBlOiB0aGlzLm1vZGVsLmdldCgnbGF5ZXJUeXBlJyksXG4gICAgICAgIGluaXRpYWxEYXRlU3RyOiBtb21lbnQodGhpcy5kYXRlTW9kZWwuZ2V0KCd2YWx1ZScpKS5mb3JtYXQodGhpcy5vcHRpb25zLmRhdGVGb3JtYXQpXG4gICAgICB9KVxuICAgICk7XG5cbiAgICB0aGlzLl9yZW5kZXJEYXRlUGlja2VyKCk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpsYXllclR5cGUnLCBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuZGF0ZU1vZGVsLnNldCgncmVhZE9ubHknLCB0aGlzLm1vZGVsLmdldCgnbGF5ZXJUeXBlJykgPT09IFwibmlnaHRcIik7XG4gICAgICB0aGlzLnJlbmRlcigpXG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy5kYXRlTW9kZWwuYmluZCgnY2hhbmdlOnZhbHVlJywgZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZGF0ZSA9IG1vbWVudCh0aGlzLmRhdGVNb2RlbC5nZXQoJ3ZhbHVlJykpLmZvcm1hdCh0aGlzLm9wdGlvbnMuZGF0ZUZvcm1hdCk7XG4gICAgICB0aGlzLm1vZGVsLnNldCgnZGF0ZScsIGRhdGUpO1xuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5kYXRlTW9kZWwpO1xuICB9LFxuXG4gIF9yZW5kZXJEYXRlUGlja2VyOiBmdW5jdGlvbigpIHtcbiAgICAvLyBEYXRlIGZpZWxkIFxuICAgIHZhciBkYXRlRmllbGQgPSBuZXcgRGF0ZUZpZWxkVmlldyh7XG4gICAgICBtb2RlbDogdGhpcy5kYXRlTW9kZWwsXG4gICAgICBzaG93VGltZTogZmFsc2UsXG4gICAgICBzaG93R01UOiBmYWxzZVxuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyhkYXRlRmllbGQpO1xuICAgIHRoaXMuXyRkYXRlUGlja2VyKCkuYXBwZW5kKGRhdGVGaWVsZC5yZW5kZXIoKS5lbCk7XG5cbiAgICAvLyBEaXNhYmxlZCB0b29sdGlwXG4gICAgaWYgKHRoaXMuZGF0ZU1vZGVsLmdldCgncmVhZE9ubHknKSkge1xuICAgICAgdGhpcy5hZGRWaWV3KFxuICAgICAgICBuZXcgY2RiLmNvbW1vbi5UaXBzeVRvb2x0aXAoe1xuICAgICAgICAgIGVsOiB0aGlzLl8kZGF0ZVBpY2tlcigpLFxuICAgICAgICAgIHRpdGxlOiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKS5hdHRyKCdkYXRhLXRpdGxlJylcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgfVxuICB9LFxuXG4gIF9vbkNoYW5nZVRvTmlnaHQ6IGZ1bmN0aW9uKGV2KSB7XG4gICAgdGhpcy5tb2RlbC5zZXQoJ2xheWVyVHlwZScsICduaWdodCcpO1xuICB9LFxuXG4gIF9vbkNoYW5nZVRvRGF5OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLnNldCgnbGF5ZXJUeXBlJywgJ2RheScpO1xuICB9LFxuXG4gIF8kZGF0ZVBpY2tlcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuJCgnLmpzLWRhdGVQaWNrZXInKTtcbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xuXG4vKipcbiAqIFZpZXcgcmVwcmVzZW50aW5nIHRoZSB0YWJzIGNvbnRlbnQgb2YgdGhlIGRpYWxvZy5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy10YWJzIGJ1dHRvbic6ICdfb25DbGlja1RhYidcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgJGVsID0gJChcbiAgICAgIGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2FkZF9jdXN0b21fYmFzZW1hcC90YWJzJykoe1xuICAgICAgICBtb2RlbDogdGhpcy5tb2RlbFxuICAgICAgfSlcbiAgICApO1xuICAgICRlbC5maW5kKCcuanMtdGFiLWNvbnRlbnQnKS5hcHBlbmQodGhpcy5fY3JlYXRlVGFiQ29udGVudFZpZXcoKS5lbCk7XG4gICAgdGhpcy4kZWwuaHRtbCgkZWwpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOmN1cnJlbnRUYWInLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gIH0sXG5cbiAgX2NyZWF0ZVRhYkNvbnRlbnRWaWV3OiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5fY3VycmVudFRhYlZpZXcpIHtcbiAgICAgIHRoaXMuX2N1cnJlbnRUYWJWaWV3LmNsZWFuKCk7XG4gICAgfVxuICAgIHRoaXMuX2N1cnJlbnRUYWJWaWV3ID0gdGhpcy5tb2RlbC5hY3RpdmVUYWJNb2RlbCgpLmNyZWF0ZVZpZXcoKTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fY3VycmVudFRhYlZpZXcpO1xuICAgIHJldHVybiB0aGlzLl9jdXJyZW50VGFiVmlldy5yZW5kZXIoKTtcbiAgfSxcblxuICBfb25DbGlja1RhYjogZnVuY3Rpb24oZXYpIHtcbiAgICB0aGlzLmtpbGxFdmVudChldik7XG4gICAgdmFyIG5hbWUgPSAkKGV2LnRhcmdldCkuY2xvc2VzdCgnYnV0dG9uJykuZGF0YSgnbmFtZScpO1xuICAgIGlmIChuYW1lKSB7XG4gICAgICB0aGlzLm1vZGVsLnNldCgnY3VycmVudFRhYicsIG5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjZGIubG9nLmVycm9yKCd0YWIgbmFtZSB3YXMgZXhwZWN0ZWQgYnV0IHdhcyBlbXB0eScpO1xuICAgIH1cbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG5cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgVGlsZUpTT04gdGFiIGNvbnRlbnQuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGV2ZW50czoge1xuICAgICdrZXlkb3duIC5qcy11cmwnOiAnX3VwZGF0ZScsXG4gICAgJ3Bhc3RlIC5qcy11cmwnOiAnX3VwZGF0ZSdcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy5fbGFzdFVSTCA9ICcnO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2FkZF9jdXN0b21fYmFzZW1hcC90aWxlX2pzb24vdGlsZV9qc29uJykoe1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX3VwZGF0ZTogZnVuY3Rpb24oZXYpIHtcbiAgICBldi5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLl9kZWJvdW5jZWRVcGRhdGUoKTtcbiAgfSxcblxuICBfZGVib3VuY2VkVXBkYXRlOiBfLmRlYm91bmNlKGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2Rpc2FibGVPa0J0bih0cnVlKTtcbiAgICB0aGlzLl9pbmRpY2F0ZUlzVmFsaWRhdGluZyh0cnVlKTtcblxuICAgIHZhciB1cmwgPSB0aGlzLl91cmxXaXRoSFRUUCgpO1xuICAgIGlmICh1cmwgPT09IHRoaXMuX2xhc3RVUkwpIHtcbiAgICAgIC8vIEV2ZW4gaWYgdHJpZ2dlcmVkIG5vdGhpbmcgcmVhbGx5IGNoYW5nZWQgc28ganVzdCB1cGRhdGUgVUkgYW5kIHJldHVybiBlYXJseVxuICAgICAgdGhpcy5faW5kaWNhdGVJc1ZhbGlkYXRpbmcoZmFsc2UpO1xuICAgICAgdGhpcy5fdXBkYXRlRXJyb3IoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9sYXN0VVJMID0gdXJsO1xuICAgIHRoaXMuX2luZGljYXRlSXNWYWxpZGF0aW5nKHRydWUpO1xuICAgIHZhciB0aWxlSlNPTiA9IG5ldyBjZGIuYWRtaW4uVGlsZUpTT04oe1xuICAgICAgdXJsOiB1cmxcbiAgICB9KTtcblxuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aWxlSlNPTi5mZXRjaCh7XG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHVybCA9PT0gc2VsZi5fbGFzdFVSTCkge1xuICAgICAgICAgIHNlbGYubW9kZWwuc2V0KCdsYXllcicsIHRpbGVKU09OLm5ld1RpbGVMYXllcigpKTtcbiAgICAgICAgICBzZWxmLl9kaXNhYmxlT2tCdG4oZmFsc2UpO1xuICAgICAgICAgIHNlbGYuX2luZGljYXRlSXNWYWxpZGF0aW5nKGZhbHNlKTtcbiAgICAgICAgICBzZWxmLl91cGRhdGVFcnJvcigpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodXJsID09PSBzZWxmLl9sYXN0VVJMKSB7XG4gICAgICAgICAgc2VsZi5faW5kaWNhdGVJc1ZhbGlkYXRpbmcoZmFsc2UpO1xuICAgICAgICAgIC8vIE5vdGUgdGhhdCB0aGlzIHRleHQgY2FuIG5vdCBiZSBsb25nZXIsIG9yIGl0IHdpbGwgZXhjZWVkIGF2YWlsYWJsZSBzcGFjZSBvZiB0aGUgZXJyb3IgbGFiZWwuXG4gICAgICAgICAgc2VsZi5fdXBkYXRlRXJyb3IoJ0ludmFsaWQgVVJMLCBwbGVhc2UgbWFrZSBzdXJlIGl0IGlzIGNvcnJlY3QnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9LCAxNTApLFxuXG4gIF9kaXNhYmxlT2tCdG46IGZ1bmN0aW9uKGRpc2FibGUpIHtcbiAgICB0aGlzLiQoJy5vaycpWyBkaXNhYmxlID8gJ2FkZENsYXNzJyA6ICdyZW1vdmVDbGFzcycgXSgnaXMtZGlzYWJsZWQnKTtcbiAgfSxcblxuICBfdXBkYXRlRXJyb3I6IGZ1bmN0aW9uKG1zZykge1xuICAgIHRoaXMuJCgnLmpzLWVycm9yJykudGV4dChtc2cpWyBtc2cgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJyBdKCdpcy12aXNpYmxlJyk7XG4gIH0sXG5cbiAgX2luZGljYXRlSXNWYWxpZGF0aW5nOiBmdW5jdGlvbihpbmRpY2F0ZSkge1xuICAgIGlmIChpbmRpY2F0ZSkge1xuICAgICAgdGhpcy4kKCcuanMtaWRsZScpLmhpZGUoKTtcbiAgICAgIHRoaXMuJCgnLmpzLXZhbGlkYXRpbmcnKS5zaG93KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuJCgnLmpzLXZhbGlkYXRpbmcnKS5oaWRlKCk7XG4gICAgICB0aGlzLiQoJy5qcy1pZGxlJykuc2hvdygpO1xuICAgIH1cbiAgfSxcblxuICAvLyBTbyBkb24ndCB0cnkgdG8gYmUgZmV0Y2hlZCByZWxhdGl2ZWx5IHRvIGN1cnJlbnQgVVJMIHBhdGggbGF0ZXJcbiAgX3VybFdpdGhIVFRQOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3RyID0gdGhpcy4kKCcuanMtdXJsJykudmFsKCk7XG4gICAgaWYgKHN0ci5pbmRleE9mKCdodHRwOi8vJykgPT09IC0xKSB7XG4gICAgICByZXR1cm4gJ2h0dHA6Ly8nICsgc3RyO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gc3RyO1xuICAgIH1cbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIFRpbGVKU09OVmlldyA9IHJlcXVpcmUoJy4vdGlsZV9qc29uX3ZpZXcnKTtcblxuLyoqXG4gKiBWaWV3IG1vZGVsIGZvciBUaWxlSlNPTiB0YWIgY29udGVudC5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIGRlZmF1bHRzOiB7XG4gICAgbmFtZTogJ3RpbGVfanNvbicsXG4gICAgbGFiZWw6ICdUaWxlSlNPTicsXG4gICAgbGF5ZXI6IHVuZGVmaW5lZCAvLyB3aWxsIGJlIHNldCB3aGVuIHZhbGlkXG4gIH0sXG5cbiAgY3JlYXRlVmlldzogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgbGF5ZXI6IHVuZGVmaW5lZFxuICAgIH0pO1xuICAgIHJldHVybiBuZXcgVGlsZUpTT05WaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzXG4gICAgfSk7XG4gIH0sXG5cbiAgaGFzQWxyZWFkeUFkZGVkTGF5ZXI6IGZ1bmN0aW9uKGJhc2VMYXllcnMpIHtcbiAgICB2YXIgdXJsVGVtcGxhdGUgPSB0aGlzLmdldCgnbGF5ZXInKS5nZXQoJ3VybFRlbXBsYXRlJyk7XG4gICAgcmV0dXJuIF8uYW55KGJhc2VMYXllcnMuY3VzdG9tKCksIGZ1bmN0aW9uKGN1c3RvbUxheWVyKSB7XG4gICAgICByZXR1cm4gY3VzdG9tTGF5ZXIuZ2V0KCd1cmxUZW1wbGF0ZScpID09PSB1cmxUZW1wbGF0ZTtcbiAgICB9KTtcbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xuXG4vKipcbiAqIE1vZGVsIGZvciBhbiBpbmRpdmlkdWFsIFdNUy9XTVRTIGxheWVyLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgZGVmYXVsdHM6IHtcbiAgICBzdGF0ZTogJ2lkbGUnLCAvLywgc2F2aW5nLCBzYXZlRG9uZSwgc2F2ZUZhaWxcbiAgICBsYXllcjogdW5kZWZpbmVkIC8vIHNldCBhZnRlciBzYXZlRG9uZVxuICB9LFxuXG4gIGNhblNhdmU6IGZ1bmN0aW9uKGJhc2VMYXllcnMpIHtcbiAgICByZXR1cm4gIV8uYW55KGJhc2VMYXllcnMuY3VzdG9tKCksIGZ1bmN0aW9uKGN1c3RvbUxheWVyKSB7XG4gICAgICByZXR1cm4gY3VzdG9tTGF5ZXIuZ2V0KCduYW1lJykgPT09IHRoaXMuZ2V0KCd0aXRsZScpO1xuICAgIH0sIHRoaXMpO1xuICB9LFxuXG4gIHNhdmU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0KCdzdGF0ZScsICdzYXZpbmcnKTtcbiAgICB0aGlzLl9zaG91bGRCZVByb3hpZWQoKSA/IHRoaXMuX2NyZWF0ZVByb3hpZWRMYXllcigpIDogdGhpcy5fbmV3VGlsZUxheWVyKCk7XG4gIH0sXG5cbiAgX3Nob3VsZEJlUHJveGllZDogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuZ2V0KCd0eXBlJykgPT09ICd3bXRzJykge1xuICAgICAgdmFyIHN1cHBvcnRlZE1hdHJpeFNldHMgPSBjZGIuYWRtaW4uV01TU2VydmljZS5zdXBwb3J0ZWRNYXRyaXhTZXRzKHRoaXMuZ2V0KCdtYXRyaXhfc2V0cycpIHx8IFtdKTtcbiAgICAgIHJldHVybiBzdXBwb3J0ZWRNYXRyaXhTZXRzLmxlbmd0aCA+IDA7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIF9jcmVhdGVQcm94aWVkTGF5ZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgdyA9IG5ldyBjZGIuYWRtaW4uV01TU2VydmljZSh7XG4gICAgICB3bXNfdXJsOiB0aGlzLnVybCgpLFxuICAgICAgdGl0bGU6IHRoaXMuZ2V0KCd0aXRsZScpLFxuICAgICAgbmFtZTogdGhpcy5nZXQoJ25hbWUnKSxcbiAgICAgIGxheWVyOiB0aGlzLmdldCgnbmFtZScpLFxuICAgICAgc3JzOiB0aGlzLmdldCgnc3JzJyksXG4gICAgICBib3VuZGluZ19ib3hlczogdGhpcy5nZXQoJ2xsYmJveCcpLFxuICAgICAgdHlwZTogdGhpcy5nZXQoJ3R5cGUnKSwgLy8gd21zL3dtdHNcbiAgICAgIG1hdHJpeF9zZXRzOiB0aGlzLmdldCgnbWF0cml4X3NldHMnKVxuICAgIH0pO1xuXG4gICAgLy8gRXZlbnQgdHJhY2tpbmcgXCJXTVMgbGF5ZXIgc2VsZWN0ZWRcIlxuICAgIGNkYi5nb2QudHJpZ2dlcignbWV0cmljcycsICdzZWxlY3Rfd21zJywge1xuICAgICAgZW1haWw6IHdpbmRvdy51c2VyX2RhdGEuZW1haWxcbiAgICB9KTtcblxuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB3LnNhdmUoe30sIHtcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKG0pIHtcbiAgICAgICAgdmFyIHRpbGVMYXllcjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aWxlTGF5ZXIgPSBtLm5ld1RpbGVMYXllcigpO1xuICAgICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGlsZUxheWVyKSB7XG4gICAgICAgICAgc2VsZi5fc2V0TmV3VGlsZUxheWVyKHRpbGVMYXllcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2VsZi5zZXQoJ3N0YXRlJywgJ3NhdmVGYWlsJyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHNlbGYuc2V0KCdzdGF0ZScsICdzYXZlRmFpbCcpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHc7XG4gIH0sXG5cbiAgX3NldE5ld1RpbGVMYXllcjogZnVuY3Rpb24odGlsZUxheWVyKSB7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgc3RhdGU6ICdzYXZlRG9uZScsXG4gICAgICB0aWxlTGF5ZXI6IHRpbGVMYXllclxuICAgIH0pO1xuICB9LFxuXG4gIF9uZXdUaWxlTGF5ZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB0aWxlTGF5ZXIgPSBjZGIuYWRtaW4uVGlsZUxheWVyLmJ5Q3VzdG9tVVJMKHRoaXMuX3h5elVSTFRlbXBsYXRlKCksIGZhbHNlKTtcbiAgICB0aWxlTGF5ZXIuc2V0KHtcbiAgICAgIG5hbWU6IHRoaXMuZ2V0KCd0aXRsZScpIHx8IHRoaXMuZ2V0KCduYW1lJyksXG4gICAgICBhdHRyaWJ1dGlvbjogdGhpcy5nZXQoJ2F0dHJpYnV0aW9uJyksXG4gICAgICBib3VuZGluZ19ib3hlczogdGhpcy5nZXQoJ2xsYmJveCcpXG4gICAgfSk7XG4gICAgdGhpcy5fc2V0TmV3VGlsZUxheWVyKHRpbGVMYXllcik7XG4gICAgcmV0dXJuIHRpbGVMYXllcjtcbiAgfSxcblxuICBfeHl6VVJMVGVtcGxhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB1cmxUZW1wbGF0ZSA9IHRoaXMuZ2V0KCd1cmxfdGVtcGxhdGUnKSB8fCAnJztcbiAgICAvLyBDb252ZXJ0IHRoZSBwcm94eSB0ZW1wbGF0ZSB2YXJpYWJsZXMgdG8gWFlaIGZvcm1hdCwgaHR0cDovL2Zvby5jb20vYmFyLyUlKHopcy8lJSh4KXMvJSUoeSlzLnBuZ1wiXG4gICAgcmV0dXJuIHVybFRlbXBsYXRlLnJlcGxhY2UoLyUlXFwoKFxcdylcXClzL2csICd7JDF9Jyk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcblxuLyoqXG4gKiBWaWV3IGZvciBhbiBpbmRpdmlkdWFsIGxheWVyIGl0ZW0uXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIHRhZ05hbWU6ICdsaScsXG4gIGNsYXNzTmFtZTogJ0xpc3Qtcm93JyxcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2sgLmpzLWFkZCc6ICdfb25DbGlja0FkZCdcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9hZGRfY3VzdG9tX2Jhc2VtYXAvd21zL2xheWVyJykoe1xuICAgICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgICAgY2FuU2F2ZTogdGhpcy5tb2RlbC5jYW5TYXZlKHRoaXMub3B0aW9ucy5iYXNlTGF5ZXJzKVxuICAgICAgfSlcbiAgICApO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9vbkNsaWNrQWRkOiBmdW5jdGlvbihldikge1xuICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICBpZiAodGhpcy5tb2RlbC5jYW5TYXZlKHRoaXMub3B0aW9ucy5iYXNlTGF5ZXJzKSkge1xuICAgICAgdGhpcy5tb2RlbC5zYXZlKCk7XG4gICAgfVxuICB9XG5cbn0pO1xuIiwidmFyIEJhY2tib25lID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ0JhY2tib25lJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydCYWNrYm9uZSddIDogbnVsbCk7XG52YXIgTGF5ZXJNb2RlbCA9IHJlcXVpcmUoJy4vbGF5ZXJfbW9kZWwuanMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7XG5cbiAgbW9kZWw6IExheWVyTW9kZWwsXG5cbiAgZmV0Y2g6IGZ1bmN0aW9uKHVybCwgY2FsbGJhY2spIHtcbiAgICB0aGlzLnVybCA9IHVybDtcblxuICAgIHZhciB3bXNTZXJ2aWNlID0gbmV3IGNkYi5hZG1pbi5XTVNTZXJ2aWNlKHtcbiAgICAgIHdtc191cmw6IHVybFxuICAgIH0pO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHdtc1NlcnZpY2UuZmV0Y2goKS5hbHdheXMoZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLnJlc2V0KHdtc1NlcnZpY2UuZ2V0KCdsYXllcnMnKSk7XG4gICAgICBzZWxmLmVhY2goZnVuY3Rpb24obW9kZWwpIHtcbiAgICAgICAgbW9kZWwuc2V0KCd0eXBlJywgd21zU2VydmljZS5nZXQoJ3R5cGUnKSk7IC8vIHdtcy93bXRzXG4gICAgICB9KTtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfSk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgJCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WyckJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyckJ10gOiBudWxsKTtcbnZhciBwbHVyYWxpemVTdHIgPSByZXF1aXJlKCcuLi8uLi8uLi92aWV3X2hlbHBlcnMvcGx1cmFsaXplX3N0cmluZycpO1xudmFyIExheWVyVmlldyA9IHJlcXVpcmUoJy4vbGF5ZXJfdmlldy5qcycpO1xuXG4vKipcbiAqIFN1YiB2aWV3LCB0byBzZWxlY3Qgd2hhdCBsYXllciB0byB1c2UgYXMgYmFzZW1hcC5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy1iYWNrJzogJ19vbkNsaWNrQmFjaydcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuXG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG5cbiAgICB2YXIgJGVsID0gJChcbiAgICAgIGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2FkZF9jdXN0b21fYmFzZW1hcC93bXMvc2VsZWN0X2xheWVyJykoe1xuICAgICAgICBzZWFyY2hRdWVyeTogdGhpcy5tb2RlbC5nZXQoJ3NlYXJjaFF1ZXJ5JyksXG4gICAgICAgIGxheWVyc0ZvdW5kOiB0aGlzLm1vZGVsLmdldExheWVycygpLFxuICAgICAgICBsYXllcnNBdmFpbGFibGVDb3VudDogdGhpcy5tb2RlbC5sYXllcnNBdmFpbGFibGVDb3VudCgpLFxuICAgICAgICBwbHVyYWxpemVTdHI6IHBsdXJhbGl6ZVN0clxuICAgICAgfSlcbiAgICApO1xuICAgIHZhciAkbGlzdCA9ICRlbC5maW5kKCcuanMtbGF5ZXJzJyk7XG4gICAgJGxpc3QuYXBwZW5kLmFwcGx5KCRsaXN0LCB0aGlzLl9yZW5kZXJlZExheWVycygpKTtcbiAgICB0aGlzLiRlbC5odG1sKCRlbCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX3JlbmRlcmVkTGF5ZXJzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbC5nZXRMYXllcnMoKS5tYXAoZnVuY3Rpb24obGF5ZXIpIHtcbiAgICAgIHZhciB2aWV3ID0gbmV3IExheWVyVmlldyh7XG4gICAgICAgIG1vZGVsOiBsYXllcixcbiAgICAgICAgYmFzZUxheWVyczogdGhpcy5tb2RlbC5nZXQoJ2Jhc2VMYXllcnMnKVxuICAgICAgfSk7XG4gICAgICB0aGlzLmFkZFZpZXcodmlldyk7XG4gICAgICByZXR1cm4gdmlldy5yZW5kZXIoKS5lbDtcbiAgICB9LCB0aGlzKTtcbiAgfSxcblxuICBfb25DbGlja0JhY2s6IGZ1bmN0aW9uKGV2KSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZXYpO1xuICAgIHRoaXMubW9kZWwuc2V0KCdjdXJyZW50VmlldycsICdlbnRlclVSTCcpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBXTVNWaWV3ID0gcmVxdWlyZSgnLi93bXNfdmlldy5qcycpO1xudmFyIExheWVyc0NvbGxlY3Rpb24gPSByZXF1aXJlKCcuL2xheWVyc19jb2xsZWN0aW9uLmpzJyk7XG5cbi8qKlxuICogVmlldyBtb2RlbCBmb3IgV01TL1dNVFMgdGFiIGNvbnRlbnQuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBkZWZhdWx0czoge1xuICAgIG5hbWU6ICd3bXMnLFxuICAgIGxhYmVsOiAnV01TL1dNVFMnLFxuICAgIGN1cnJlbnRWaWV3OiAnZW50ZXJVUkwnLCAvLyBbZmV0Y2hpbmdMYXllcnMsIHNlbGVjdExheWVyLCBzYXZpbmdMYXllcl1cbiAgICBsYXllcnNGZXRjaGVkOiBmYWxzZSxcbiAgICBsYXllcnM6IHVuZGVmaW5lZCxcbiAgICBiYXNlTGF5ZXJzOiB1bmRlZmluZWQgLy8gZXhwZWN0ZWQgd2hlbiBpbnN0YW50aWF0ZWRcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy5zZXQoJ2xheWVycycsIG5ldyBMYXllcnNDb2xsZWN0aW9uKCkpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIGNyZWF0ZVZpZXc6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0KHtcbiAgICAgIGN1cnJlbnRWaWV3OiAnZW50ZXJVUkwnLFxuICAgICAgbGF5ZXJzRmV0Y2hlZDogZmFsc2VcbiAgICB9KTtcbiAgICByZXR1cm4gbmV3IFdNU1ZpZXcoe1xuICAgICAgbW9kZWw6IHRoaXNcbiAgICB9KTtcbiAgfSxcblxuICBmZXRjaExheWVyczogZnVuY3Rpb24odXJsKSB7XG4gICAgdGhpcy5zZXQoJ2N1cnJlbnRWaWV3JywgJ2ZldGNoaW5nTGF5ZXJzJyk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuZ2V0KCdsYXllcnMnKS5mZXRjaCh1cmwsIGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi5zZXQoe1xuICAgICAgICBjdXJyZW50Vmlldzogc2VsZi5nZXQoJ2xheWVycycpLmxlbmd0aCA+IDAgPyAnc2VsZWN0TGF5ZXInIDogJ2VudGVyVVJMJyxcbiAgICAgICAgbGF5ZXJzRmV0Y2hlZDogdHJ1ZVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgbGF5ZXJzQXZhaWxhYmxlQ291bnQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBfLmRpZmZlcmVuY2UoXG4gICAgICB0aGlzLmdldCgnbGF5ZXJzJykucGx1Y2soJ3RpdGxlJyksXG4gICAgICB0aGlzLmdldCgnYmFzZUxheWVycycpLnBsdWNrKCduYW1lJylcbiAgICApLmxlbmd0aDtcbiAgfSxcblxuICBnZXQ6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICBpZiAobmFtZSA9PT0gJ2xheWVyJykge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdsYXllcnMnKVxuICAgICAgICAuZmluZChmdW5jdGlvbihtKSB7XG4gICAgICAgICAgcmV0dXJuIG0uZ2V0KCdzdGF0ZScpID09PSAnc2F2ZURvbmUnO1xuICAgICAgICB9KVxuICAgICAgICAuZ2V0KCd0aWxlTGF5ZXInKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGNkYi5jb3JlLk1vZGVsLnByb3RvdHlwZS5nZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG4gIH0sXG5cbiAgZ2V0TGF5ZXJzOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5nZXQoXCJzZWFyY2hRdWVyeVwiKSkge1xuICAgICAgdmFyIHJlZ0V4cCA9IG5ldyBSZWdFeHAodGhpcy5nZXQoXCJzZWFyY2hRdWVyeVwiKSwgJ2knKTtcbiAgICAgIHJldHVybiB0aGlzLmdldChcImxheWVyc1wiKS5maWx0ZXIoZnVuY3Rpb24obGF5ZXIpIHtcbiAgICAgICAgcmV0dXJuIGxheWVyLmdldChcIm5hbWVcIikubWF0Y2gocmVnRXhwKTtcbiAgICAgIH0sIHRoaXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXQoXCJsYXllcnNcIik7XG4gICAgfVxuICB9LFxuXG4gIGhhc0FscmVhZHlBZGRlZExheWVyOiBmdW5jdGlvbigpIHtcbiAgICAvLyBBbHJlYWR5IGFkZGVkIGxheWVycyBhcmUgZGlzYWJsZWQgdG8gYmUgc2F2ZWQgZm9yIGVhY2ggbGF5ZXJcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5nZXQoJ2xheWVycycpLmJpbmQoJ2NoYW5nZTpzdGF0ZScsIHRoaXMuX29uTGF5ZXJTdGF0ZUNoYW5nZSwgdGhpcyk7XG4gIH0sXG5cbiAgX29uTGF5ZXJTdGF0ZUNoYW5nZTogZnVuY3Rpb24oXywgbmV3U3RhdGUpIHtcbiAgICBzd2l0Y2ggKG5ld1N0YXRlKSB7XG4gICAgICBjYXNlICdzYXZpbmcnOlxuICAgICAgICB0aGlzLnNldCgnY3VycmVudFZpZXcnLCAnc2F2aW5nTGF5ZXInKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzYXZlRG9uZSc6XG4gICAgICAgIHRoaXMudHJpZ2dlcignc2F2ZUJhc2VtYXAnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzYXZlRmFpbCc6XG4gICAgICB0aGlzLnNldCgnY3VycmVudFZpZXcnLCAnc2F2ZUZhaWwnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aGlzLnNldCgnY3VycmVudFZpZXcnLCAnc2VsZWN0TGF5ZXInKTtcbiAgICB9XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vLi4vLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZS5qcycpO1xudmFyIFNlbGVjdExheWVyVmlldyA9IHJlcXVpcmUoJy4vc2VsZWN0X2xheWVyX3ZpZXcuanMnKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uLy4uL3ZpZXdfZmFjdG9yeS5qcycpO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFdNUy9XTVRTIHRhYiBjYXRlZ29yeS5cbiAqIEN1cnJlbnQgc3RhdGUgaXMgZGVmaW5lZCBieSBwcmVzZW5jZSAob3IgbGFjayBvZikgbGF5ZXJzXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGV2ZW50czoge1xuICAgICdrZXlkb3duIC5qcy1zZWFyY2gtaW5wdXQnOiAnX29uS2V5RG93bicsXG4gICAgJ3N1Ym1pdCAuanMtc2VhcmNoLWZvcm0nOiAna2lsbEV2ZW50JyxcbiAgICAna2V5ZG93biAuanMtdXJsJzogJ191cGRhdGUnLFxuICAgICdwYXN0ZSAuanMtdXJsJzogJ191cGRhdGUnLFxuICAgICdjbGljayAuanMtZmV0Y2gtbGF5ZXJzJzogJ19vbkNsaWNrRmV0Y2hMYXllcnMnLFxuICAgICdjbGljayAuanMtY2xlYW4tc2VhcmNoJzogJ19vbkNsZWFuU2VhcmNoQ2xpY2snLFxuICAgICdjbGljayAuanMtc2VhcmNoLWxpbmsnOiAnX3N1Ym1pdFNlYXJjaCdcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcbiAgICB2YXIgdmlldztcblxuICAgIHN3aXRjaCAodGhpcy5tb2RlbC5nZXQoJ2N1cnJlbnRWaWV3JykpIHtcbiAgICAgIGNhc2UgJ3NhdmluZ0xheWVyJzpcbiAgICAgICAgdmlldyA9IFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycsIHtcbiAgICAgICAgICB0aXRsZTogJ1NhdmluZyBsYXllcuKApicsXG4gICAgICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc2VsZWN0TGF5ZXInOlxuICAgICAgICB2aWV3ID0gbmV3IFNlbGVjdExheWVyVmlldyh7XG4gICAgICAgICAgbW9kZWw6IHRoaXMubW9kZWxcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc2F2ZUZhaWwnOlxuICAgICAgICB2aWV3ID0gVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9mYWlsJywge1xuICAgICAgICAgIG1zZzogJydcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZmV0Y2hpbmdMYXllcnMnOlxuICAgICAgICB2aWV3ID0gVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9sb2FkaW5nJywge1xuICAgICAgICAgIHRpdGxlOiAnRmV0Y2hpbmcgbGF5ZXJz4oCmJyxcbiAgICAgICAgICBxdW90ZTogcmFuZG9tUXVvdGUoKVxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdlbnRlclVSTCc6XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB2aWV3ID0gVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvYWRkX2N1c3RvbV9iYXNlbWFwL3dtcy9lbnRlcl91cmwnLCB7XG4gICAgICAgICAgbGF5ZXJzRmV0Y2hlZDogdGhpcy5tb2RlbC5nZXQoJ2xheWVyc0ZldGNoZWQnKSxcbiAgICAgICAgICBsYXllcnM6IHRoaXMubW9kZWwuZ2V0KCdsYXllcnMnKVxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHRoaXMuYWRkVmlldyh2aWV3KTtcbiAgICB0aGlzLiRlbC5hcHBlbmQodmlldy5yZW5kZXIoKS5lbCk7XG5cbiAgICB0aGlzLiQoXCIuanMtc2VhcmNoLWlucHV0XCIpLmZvY3VzKCk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfc2hvd0NsZWFuU2VhcmNoQnV0dG9uOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoJy5qcy1jbGVhbi1zZWFyY2gnKS5zaG93KCk7XG4gIH0sXG5cbiAgX2hpZGVDbGVhblNlYXJjaEJ1dHRvbjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKCcuanMtY2xlYW4tc2VhcmNoJykuaGlkZSgpO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlJywgdGhpcy5fb25DaGFuZ2VTZWFyY2hRdWVyeSwgdGhpcyk7XG4gICAgdGhpcy5tb2RlbC5nZXQoXCJsYXllcnNcIikuYmluZCgncmVzZXQnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gIH0sXG5cbiAgX3VwZGF0ZTogZnVuY3Rpb24oZXYpIHtcbiAgICBldi5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLl9kZWJvdW5jZWRVcGRhdGUoKTtcbiAgfSxcblxuICBfZGVib3VuY2VkVXBkYXRlOiBfLmRlYm91bmNlKGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2VuYWJsZUZldGNoTGF5ZXJzQnV0dG9uKCEhdGhpcy4kKCcuanMtdXJsJykudmFsKCkpO1xuICAgIHRoaXMuJCgnLmpzLWVycm9yJykucmVtb3ZlQ2xhc3MoJ2lzLXZpc2libGUnKTsgLy8gcmVzZXRzIGVycm9yIHN0YXRlIHdoZW4gY2hhbmdlZFxuICB9LCAxMDApLFxuXG4gIF9lbmFibGVGZXRjaExheWVyc0J1dHRvbjogZnVuY3Rpb24oZW5hYmxlKSB7XG4gICAgdGhpcy4kKCcuanMtZmV0Y2gtbGF5ZXJzJylbIGVuYWJsZSA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnIF0oJ2lzLWRpc2FibGVkJyk7XG4gIH0sXG5cbiAgX29uS2V5RG93bjogZnVuY3Rpb24oZXYpIHtcbiAgICB2YXIgZW50ZXJQcmVzc2VkID0gKGV2LmtleUNvZGUgPT0gJC51aS5rZXlDb2RlLkVOVEVSKTtcbiAgICBpZiAoZW50ZXJQcmVzc2VkKSB7XG4gICAgICB0aGlzLmtpbGxFdmVudChldik7XG4gICAgICB0aGlzLl9zdWJtaXRTZWFyY2goKTtcbiAgICB9IFxuICB9LFxuXG4gIF9zdWJtaXRTZWFyY2g6IGZ1bmN0aW9uKGV2KSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZXYpO1xuXG4gICAgdGhpcy5tb2RlbC5zZXQoXCJzZWFyY2hRdWVyeVwiLCB0aGlzLiQoXCIuanMtc2VhcmNoLWlucHV0XCIpLnZhbCgpKTtcbiAgfSxcblxuICBfb25DaGFuZ2VTZWFyY2hRdWVyeTogZnVuY3Rpb24oKSB7XG5cbiAgICB2YXIgc2VhcmNoUXVlcnkgPSB0aGlzLm1vZGVsLmdldChcInNlYXJjaFF1ZXJ5XCIpO1xuXG4gICAgaWYgKCFzZWFyY2hRdWVyeSkge1xuICAgICAgdGhpcy5faGlkZUNsZWFuU2VhcmNoQnV0dG9uKCk7XG4gICAgfVxuICBcbiAgfSxcblxuICBfb25DbGVhblNlYXJjaENsaWNrOiBmdW5jdGlvbihldikge1xuICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICB0aGlzLm1vZGVsLnNldChcInNlYXJjaFF1ZXJ5XCIsIFwiXCIpO1xuICB9LFxuXG4gIF9vbkNsaWNrRmV0Y2hMYXllcnM6IGZ1bmN0aW9uKGV2KSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZXYpO1xuICAgIHZhciB1cmwgPSB0aGlzLiQoJy5qcy11cmwnKS52YWwoKTtcbiAgICBpZiAodXJsKSB7XG4gICAgICB0aGlzLm1vZGVsLmZldGNoTGF5ZXJzKHVybCk7XG4gICAgfVxuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBYWVpWaWV3ID0gcmVxdWlyZSgnLi94eXpfdmlldycpO1xuXG4vKipcbiAqIFZpZXcgbW9kZWwgZm9yIFhZWiB0YWIgY29udGVudC5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIGRlZmF1bHRzOiB7XG4gICAgbmFtZTogJ3h5eicsXG4gICAgbGFiZWw6ICdYWVonLFxuICAgIHRtczogZmFsc2UsXG4gICAgbGF5ZXI6IHVuZGVmaW5lZCAvLyB3aWxsIGJlIHNldCB3aGVuIHZhbGlkXG4gIH0sXG5cbiAgY3JlYXRlVmlldzogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBYWVpWaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzXG4gICAgfSk7XG4gIH0sXG5cbiAgaGFzQWxyZWFkeUFkZGVkTGF5ZXI6IGZ1bmN0aW9uKGJhc2VMYXllcnMpIHtcbiAgICB2YXIgdXJsVGVtcGxhdGUgPSB0aGlzLmdldCgnbGF5ZXInKS5nZXQoJ3VybFRlbXBsYXRlJyk7XG4gICAgcmV0dXJuIF8uYW55KGJhc2VMYXllcnMuY3VzdG9tKCksIGZ1bmN0aW9uKGN1c3RvbUxheWVyKSB7XG4gICAgICByZXR1cm4gY3VzdG9tTGF5ZXIuZ2V0KCd1cmxUZW1wbGF0ZScpID09PSB1cmxUZW1wbGF0ZTtcbiAgICB9KTtcbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFhZWiB0YWIgY29udGVudC5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgY2xhc3NOYW1lOiAnWFlaUGFuZWwnLFxuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtdG1zJzogJ19jaGFuZ2VUTVMnLFxuICAgICdrZXlkb3duIC5qcy11cmwnOiAnX3VwZGF0ZScsXG4gICAgJ3Bhc3RlIC5qcy11cmwnOiAnX3VwZGF0ZSdcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy5fbGFzdENhbGxTZXEgPSAwO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2FkZF9jdXN0b21fYmFzZW1hcC94eXoveHl6Jykoe1xuICAgICAgfSlcbiAgICApO1xuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0Vmlld3M6IGZ1bmN0aW9uKCkge1xuICAgIC8vIEFkZCBUTVMgdG9vbHRpcFxuICAgIHZhciB0b29sdGlwID0gbmV3IGNkYi5jb21tb24uVGlwc3lUb29sdGlwKHtcbiAgICAgIGVsOiB0aGlzLiQoJy5qcy10bXMnKSxcbiAgICAgIHRpdGxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICQodGhpcykuZGF0YSgndGl0bGUnKVxuICAgICAgfVxuICAgIH0pXG4gICAgdGhpcy5hZGRWaWV3KHRvb2x0aXApO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOnRtcycsIHRoaXMuX3NldFRNU0NoZWNrYm94LCB0aGlzKTtcbiAgfSxcblxuICBfdXBkYXRlOiBmdW5jdGlvbihldikge1xuICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIHRoaXMuX2RlYm91bmNlZFVwZGF0ZSgpO1xuICB9LFxuXG4gIF9jaGFuZ2VUTVM6IGZ1bmN0aW9uKGV2KSB7XG4gICAgdGhpcy5tb2RlbC5zZXQoJ3RtcycsICF0aGlzLm1vZGVsLmdldCgndG1zJykpO1xuICAgIHRoaXMuX3VwZGF0ZShldik7XG4gIH0sXG5cbiAgX3NldFRNU0NoZWNrYm94OiBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKCcuanMtdG1zIC5DaGVja2JveC1pbnB1dCcpWyB0aGlzLm1vZGVsLmdldCgndG1zJykgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJyBdKCdpcy1jaGVja2VkJyk7XG4gIH0sXG5cbiAgX2RlYm91bmNlZFVwZGF0ZTogXy5kZWJvdW5jZShmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9kaXNhYmxlT2tCdG4odHJ1ZSk7XG4gICAgdGhpcy5faW5kaWNhdGVJc1ZhbGlkYXRpbmcodHJ1ZSk7XG4gICAgdmFyIGxheWVyO1xuICAgIHZhciB1cmxFcnJvck1zZztcblxuICAgIHZhciB1cmwgPSB0aGlzLiQoJy5qcy11cmwnKS52YWwoKTtcbiAgICB2YXIgdG1zID0gdGhpcy5tb2RlbC5nZXQoJ3RtcycpO1xuXG4gICAgaWYgKHVybCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgbGF5ZXIgPSBjZGIuYWRtaW4uVGlsZUxheWVyLmJ5Q3VzdG9tVVJMKHVybCwgdG1zKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdXJsRXJyb3JNc2cgPSAnSXQgZG9lcyBub3QgbG9vayBsaWtlIGEgdmFsaWQgWFlaIFVSTCc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5tb2RlbC5zZXQoJ2xheWVyJywgbGF5ZXIpO1xuICAgIGlmIChsYXllcikge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgLy8gTWFrZSBzdXJlIG9ubHkgdGhlIGxhc3QgY2FsbCBtYWRlIGlzIHRoZSBvbmUgdGhhdCBkZWZpbmVzIHZpZXcgY2hhbmdlLFxuICAgICAgLy8gYXZvaWRzIGxhZ2d5IHJlc3BvbnNlcyB0byBpbmRpY2F0ZSB3cm9uZyBzdGF0ZVxuICAgICAgdmFyIHRoaXNDYWxsU2VxID0gKyt0aGlzLl9sYXN0Q2FsbFNlcTtcbiAgICAgIGxheWVyLnZhbGlkYXRlVGVtcGxhdGVVUkwoe1xuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAodGhpc0NhbGxTZXEgPT09IHNlbGYuX2xhc3RDYWxsU2VxKSB7XG4gICAgICAgICAgICBzZWxmLl9kaXNhYmxlT2tCdG4oZmFsc2UpO1xuICAgICAgICAgICAgc2VsZi5faW5kaWNhdGVJc1ZhbGlkYXRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgc2VsZi5fdXBkYXRlRXJyb3IoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAodGhpc0NhbGxTZXEgPT09IHNlbGYuX2xhc3RDYWxsU2VxKSB7XG4gICAgICAgICAgICBzZWxmLl9kaXNhYmxlT2tCdG4oZmFsc2UpO1xuICAgICAgICAgICAgc2VsZi5faW5kaWNhdGVJc1ZhbGlkYXRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgdGV4dCBjYW4gbm90IGJlIGxvbmdlciwgb3IgaXQgd2lsbCBleGNlZWQgYXZhaWxhYmxlIHNwYWNlIG9mIHRoZSBlcnJvciBsYWJlbC5cbiAgICAgICAgICAgIHNlbGYuX3VwZGF0ZUVycm9yKFwiV2UgY291bGRuJ3QgdmFsaWRhdGUgdGhpcywgaWYgeW91J3JlIHN1cmUgaXQgY29udGFpbnMgZGF0YSBjbGljayBcXFwiYWRkIGJhc2VtYXBcXFwiXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmICh1cmwpIHtcbiAgICAgIHRoaXMuX2luZGljYXRlSXNWYWxpZGF0aW5nKGZhbHNlKTtcbiAgICAgIHRoaXMuX3VwZGF0ZUVycm9yKHVybEVycm9yTXNnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faW5kaWNhdGVJc1ZhbGlkYXRpbmcoZmFsc2UpO1xuICAgICAgdGhpcy5fdXBkYXRlRXJyb3IoKTtcbiAgICB9XG4gIH0sIDE1MCksXG5cbiAgX3NldFRNUzogZnVuY3Rpb24oZXYpIHtcbiAgICB2YXIgJGNoZWNrYm94ID0gJChldi50YXJnZXQpLmNsb3Nlc3QoJy5DaGVja2JveCcpO1xuICAgICRjaGVja2JveC5maW5kKCcuQ2hlY2tib3gtaW5wdXQnKS50b2dnbGVDbGFzcygnaXMtY2hlY2tlZCcpO1xuICAgIHRoaXMuX3VwZGF0ZShldik7XG4gIH0sXG5cbiAgX2Rpc2FibGVPa0J0bjogZnVuY3Rpb24oZGlzYWJsZSkge1xuICAgIHRoaXMuJCgnLm9rJylbIGRpc2FibGUgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJyBdKCdpcy1kaXNhYmxlZCcpO1xuICB9LFxuXG4gIF91cGRhdGVFcnJvcjogZnVuY3Rpb24obXNnKSB7XG4gICAgdGhpcy4kKCcuanMtZXJyb3InKS50ZXh0KG1zZylbIG1zZyA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnIF0oJ2lzLXZpc2libGUnKTtcbiAgfSxcblxuICBfaW5kaWNhdGVJc1ZhbGlkYXRpbmc6IGZ1bmN0aW9uKGluZGljYXRlKSB7XG4gICAgaWYgKGluZGljYXRlKSB7XG4gICAgICB0aGlzLiQoJy5qcy12YWxpZGF0aW5nJykuc2hvdygpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLiQoJy5qcy12YWxpZGF0aW5nJykuaGlkZSgpO1xuICAgIH1cbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBCYXNlRGlhbG9nID0gcmVxdWlyZSgnLi4vLi4vdmlld3MvYmFzZV9kaWFsb2cvdmlldycpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG5cbm1vZHVsZS5leHBvcnRzID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIGV2ZW50czogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBfLmV4dGVuZCh7fSwgQmFzZURpYWxvZy5wcm90b3R5cGUuZXZlbnRzLCB7XG4gICAgICAnY2xpY2sgLmpzLW9rJzogJ19jb250aW51ZSdcbiAgICB9KTtcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9idWlsZGVyX2ZlYXR1cmVzX3dhcm5pbmcvdGVtcGxhdGUnKTtcbiAgfSxcblxuICByZW5kZXJfY29udGVudDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnRlbXBsYXRlKHtcblxuICAgIH0pO1xuICB9LFxuXG4gIF9jb250aW51ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY2xvc2UoKTtcbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIEJhc2VEaWFsb2cgPSByZXF1aXJlKCcuLi8uLi92aWV3cy9iYXNlX2RpYWxvZy92aWV3Jyk7XG52YXIgcGx1cmFsaXplU3RyaW5nID0gcmVxdWlyZSgnLi4vLi4vdmlld19oZWxwZXJzL3BsdXJhbGl6ZV9zdHJpbmcnKTtcbnZhciByYW5kb21RdW90ZSA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfaGVscGVycy9yYW5kb21fcXVvdGUnKTtcblxuLyoqXG4gKiBMb2NrL3VubG9jayBkYXRhc2V0cy9tYXBzIGRpYWxvZy5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBCYXNlRGlhbG9nLmV4dGVuZCh7XG5cbiAgZXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gXy5leHRlbmQoe30sIEJhc2VEaWFsb2cucHJvdG90eXBlLmV2ZW50cywge1xuICAgICAgJ2NsaWNrIC5qcy1vayc6ICdfb2snXG4gICAgfSk7XG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgIHRoaXMub3B0aW9ucy50ZW1wbGF0ZSA9IHRoaXMub3B0aW9ucy50ZW1wbGF0ZSB8fCBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9jaGFuZ2VfbG9jay90ZW1wbGF0ZXMvZGFzaGJvYXJkJyk7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLm1vZGVsLmdldCgnc3RhdGUnKSA9PT0gJ1Byb2Nlc3NJdGVtc0RvbmUnKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICB9XG4gICAgfSwgdGhpcyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEBpbXBsZW1lbnRzIGNkYi51aS5jb21tb24uRGlhbG9nLnByb3RvdHlwZS5yZW5kZXJfY29udGVudFxuICAgKi9cbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzWydfcmVuZGVyJyArIHRoaXMubW9kZWwuZ2V0KCdzdGF0ZScpXSgpO1xuICB9LFxuXG4gIF9yZW5kZXJDb25maXJtQ2hhbmdlTG9jazogZnVuY3Rpb24oKSB7XG4gICAgLy8gQW4gZW50aXR5IGNhbiBiZSBhbiBVc2VyIG9yIE9yZ2FuaXphdGlvblxuICAgIHZhciBpdGVtc0NvdW50ID0gdGhpcy5tb2RlbC5nZXQoJ2l0ZW1zJykubGVuZ3RoO1xuICAgIHZhciBhcmVMb2NrZWQgPSB0aGlzLm1vZGVsLmdldCgnaW5pdGlhbExvY2tWYWx1ZScpO1xuXG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy50ZW1wbGF0ZSh7XG4gICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgIGl0ZW1zQ291bnQ6IGl0ZW1zQ291bnQsXG4gICAgICBvd25lck5hbWU6IHRoaXMub3B0aW9ucy5vd25lck5hbWUsXG4gICAgICBpc093bmVyOiB0aGlzLm9wdGlvbnMuaXNPd25lcixcbiAgICAgIHRoaXNPclRoZXNlU3RyOiBpdGVtc0NvdW50ID09PSAxID8gJ3RoaXMnIDogJ3RoZXNlJyxcbiAgICAgIGl0T3JUaGVtU3RyOiBpdGVtc0NvdW50ID09PSAxID8gJ2l0JyA6ICd0aGVtJyxcbiAgICAgIGFyZUxvY2tlZDogYXJlTG9ja2VkLFxuICAgICAgcG9zaXRpdmVPck5lZ2F0aXZlU3RyOiBhcmVMb2NrZWQgPyAncG9zaXRpdmUnIDogJ2FsZXJ0JyxcbiAgICAgIGxvY2tPclVubG9ja1N0cjogYXJlTG9ja2VkID8gJ3VubG9jaycgOiAnbG9jaycsXG4gICAgICBjb250ZW50VHlwZVBsdXJhbGl6ZWQ6IHBsdXJhbGl6ZVN0cmluZyhcbiAgICAgICAgdGhpcy5tb2RlbC5nZXQoJ2NvbnRlbnRUeXBlJykgPT09ICdkYXRhc2V0cycgPyAnZGF0YXNldCcgOiAnbWFwJywgLy9zaW5ndWxhclxuICAgICAgICB0aGlzLm1vZGVsLmdldCgnY29udGVudFR5cGUnKSwgLy8gcGx1cmFsXG4gICAgICAgIGl0ZW1zQ291bnRcbiAgICAgIClcbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICogQG92ZXJyaWRlcyBCYXNlRGlhbG9nLnByb3RvdHlwZS5fb2tcbiAgICovXG4gIF9vazogZnVuY3Rpb24oZSkge1xuICAgIHRoaXMua2lsbEV2ZW50KGUpO1xuICAgIHRoaXMubW9kZWwuaW52ZXJzZUxvY2soKTtcbiAgICB0aGlzLnJlbmRlcigpO1xuICB9LFxuXG4gIF9yZW5kZXJQcm9jZXNzaW5nSXRlbXM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBsb2NraW5nT3JVbmxvY2tpbmdTdHIgPSB0aGlzLm1vZGVsLmdldCgnaW5pdGlhbExvY2tWYWx1ZScpID8gJ1VubG9ja2luZycgOiAnTG9ja2luZyc7XG4gICAgcmV0dXJuIGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycpKHtcbiAgICAgIHRpdGxlOiBsb2NraW5nT3JVbmxvY2tpbmdTdHIgKyAnICcgKyBwbHVyYWxpemVTdHJpbmcodGhpcy5tb2RlbC5nZXQoJ2NvbnRlbnRUeXBlJykgPT09ICdkYXRhc2V0cycgPyAnZGF0YXNldCcgOiAnbWFwJywgdGhpcy5tb2RlbC5nZXQoJ2l0ZW1zJykubGVuZ3RoKSArICfigKYnLFxuICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICB9KTtcbiAgfSxcblxuICBfcmVuZGVyUHJvY2Vzc0l0ZW1zRmFpbDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGxvY2tpbmdPclVubG9ja2luZ1N0ciA9IHRoaXMubW9kZWwuZ2V0KCdpbml0aWFsTG9ja1ZhbHVlJykgPyAndW5sb2NrJyA6ICdsb2NrJztcbiAgICByZXR1cm4gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9mYWlsJykoe1xuICAgICAgbXNnOiAnRmFpbGVkIHRvICcgKyBsb2NraW5nT3JVbmxvY2tpbmdTdHIgKyAnIGFsbCBpdGVtcydcbiAgICB9KTtcbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBCYWNrYm9uZSA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydCYWNrYm9uZSddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnQmFja2JvbmUnXSA6IG51bGwpO1xudmFyIGJhdGNoUHJvY2Vzc0l0ZW1zID0gcmVxdWlyZSgnLi4vLi4vYmF0Y2hfcHJvY2Vzc19pdGVtcycpO1xuXG4vKipcbiAqIFZpZXcgbW9kZWwgZm9yIGNoYW5nZSBsb2NrIHZpZXcuXG4gKiBNYW5hZ2VzIHRoZSBsaWZlIGN5Y2xlIHN0YXRlcyBmb3IgdGhlIGNoYW5nZSBsb2NrIHZpZXcuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBkZWZhdWx0czoge1xuICAgIHN0YXRlOiAnQ29uZmlybUNoYW5nZUxvY2snLFxuICAgIGluaXRpYWxMb2NrVmFsdWU6IGZhbHNlLFxuICAgIGNvbnRlbnRUeXBlOiAnZGF0YXNldHMnLFxuICAgIGl0ZW1zOiB1bmRlZmluZWQgLy8gYSBCYWNrYm9uZSBjb2xsZWN0aW9uXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oYXR0cnMpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy5zZXQoJ2l0ZW1zJywgbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oYXR0cnMuaXRlbXMpKTtcbiAgICBpZiAodGhpcy5nZXQoJ2l0ZW1zJykuY2hhaW4oKS5tYXAoZnVuY3Rpb24oaXRlbSkgeyByZXR1cm4gaXRlbS5nZXQoJ2xvY2tlZCcpOyB9KS51bmlxKCkudmFsdWUoKS5sZW5ndGggPiAxKSB7XG4gICAgICB2YXIgZXJyb3JNc2cgPSAnSXQgaXMgYXNzdW1lZCB0aGF0IGFsbCBpdGVtcyBoYXZlIHRoZSBzYW1lIGxvY2tlZCBzdGF0ZSwgYSB1c2VyIHNob3VsZCBuZXZlciBiZSBhYmxlIHRvICcgK1xuICAgICAgICAnc2VsZWN0IGEgbWl4ZWQgaXRlbSB3aXRoIGN1cnJlbnQgVUkuIElmIHlvdSBnZXQgYW4gZXJyb3Igd2l0aCB0aGlzIG1lc3NhZ2Ugc29tZXRoaW5nIGlzIGJyb2tlbic7XG4gICAgICBpZiAod2luZG93LnRyYWNrSnMgJiYgd2luZG93LnRyYWNrSnMudHJhY2spIHtcbiAgICAgICAgd2luZG93LnRyYWNrSnMudHJhY2soZXJyb3JNc2cpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTXNnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnNldCgnaW5pdGlhbExvY2tWYWx1ZScsIHRoaXMuZ2V0KCdpdGVtcycpLmF0KDApLmdldCgnbG9ja2VkJykpO1xuICB9LFxuXG4gIGludmVyc2VMb2NrOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldCgnc3RhdGUnLCAnUHJvY2Vzc2luZ0l0ZW1zJyk7XG5cbiAgICBiYXRjaFByb2Nlc3NJdGVtcyh7XG4gICAgICBob3dNYW55SW5QYXJhbGxlbDogNSxcbiAgICAgIGl0ZW1zOiB0aGlzLmdldCgnaXRlbXMnKS50b0FycmF5KCksXG4gICAgICBwcm9jZXNzSXRlbTogdGhpcy5fbG9ja0l0ZW0uYmluZCh0aGlzLCAhdGhpcy5nZXQoJ2luaXRpYWxMb2NrVmFsdWUnKSksXG4gICAgICBkb25lOiB0aGlzLnNldC5iaW5kKHRoaXMsICdzdGF0ZScsICdQcm9jZXNzSXRlbXNEb25lJyksXG4gICAgICBmYWlsOiB0aGlzLnNldC5iaW5kKHRoaXMsICdzdGF0ZScsICdQcm9jZXNzSXRlbXNGYWlsJylcbiAgICB9KTtcbiAgfSxcblxuICBfbG9ja0l0ZW06IGZ1bmN0aW9uKG5ld0xvY2tlZFZhbHVlLCBpdGVtLCBjYWxsYmFjaykge1xuICAgIGl0ZW0uc2F2ZSh7IGxvY2tlZDogbmV3TG9ja2VkVmFsdWUgfSlcbiAgICAgIC5kb25lKGZ1bmN0aW9uKCkge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfSlcbiAgICAgIC5mYWlsKGZ1bmN0aW9uKCkge1xuICAgICAgICBjYWxsYmFjaygnc29tZXRoaW5nIGZhaWxlZCcpO1xuICAgICAgfSk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgU3RhcnRWaWV3ID0gcmVxdWlyZSgnLi9zdGFydF92aWV3Jyk7XG52YXIgUHJpdmFjeU9wdGlvbnMgPSByZXF1aXJlKCcuL29wdGlvbnNfY29sbGVjdGlvbicpO1xudmFyIEJhc2VEaWFsb2cgPSByZXF1aXJlKCcuLi8uLi92aWV3cy9iYXNlX2RpYWxvZy92aWV3Jyk7XG52YXIgcmFuZG9tUXVvdGUgPSByZXF1aXJlKCcuLi8uLi92aWV3X2hlbHBlcnMvcmFuZG9tX3F1b3RlJyk7XG52YXIgVmlld0ZhY3RvcnkgPSByZXF1aXJlKCcuLi8uLi92aWV3X2ZhY3RvcnknKTtcbnZhciBTaGFyZVZpZXcgPSByZXF1aXJlKCcuL3NoYXJlL3NoYXJlX3ZpZXcnKTtcblxuLyoqXG4gKiBDaGFuZ2UgcHJpdmFjeSBkYXRhc2V0cy9tYXBzIGRpYWxvZy5cbiAqL1xudmFyIENoYW5nZVByaXZhY3lWaWV3ID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcbiAgICB0aGlzLl9wcml2YWN5T3B0aW9ucyA9IFByaXZhY3lPcHRpb25zLmJ5VmlzQW5kVXNlcih0aGlzLm9wdGlvbnMudmlzLCB0aGlzLm9wdGlvbnMudXNlcik7XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEBpbXBsZW1lbnRzIGNkYi51aS5jb21tb24uRGlhbG9nLnByb3RvdHlwZS5yZW5kZXJfY29udGVudFxuICAgKi9cbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9wYW5lcy5nZXRBY3RpdmVQYW5lKCkucmVuZGVyKCkuZWw7XG4gIH0sXG5cbiAgb2s6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxlY3RlZE9wdGlvbiA9IHRoaXMuX3ByaXZhY3lPcHRpb25zLnNlbGVjdGVkT3B0aW9uKCk7XG4gICAgaWYgKCFzZWxlY3RlZE9wdGlvbi5jYW5TYXZlKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdzYXZpbmcnKTtcbiAgICBzZWxlY3RlZE9wdGlvbi5zYXZlVG9WaXModGhpcy5vcHRpb25zLnZpcywge1xuICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgIHNlbGYuY2xvc2UoKTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHNlbGYuX3BhbmVzLmFjdGl2ZSgnc2F2ZUZhaWwnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9wYW5lcyA9IG5ldyBjZGIudWkuY29tbW9uLlRhYlBhbmUoe1xuICAgICAgZWw6IHRoaXMuZWxcbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fcGFuZXMpO1xuICAgIHRoaXMuX3BhbmVzLmFkZFRhYignc3RhcnQnLFxuICAgICAgbmV3IFN0YXJ0Vmlldyh7XG4gICAgICAgIHByaXZhY3lPcHRpb25zOiB0aGlzLl9wcml2YWN5T3B0aW9ucyxcbiAgICAgICAgdXNlcjogdGhpcy5vcHRpb25zLnVzZXIsXG4gICAgICAgIHZpczogdGhpcy5vcHRpb25zLnZpc1xuICAgICAgfSlcbiAgICApO1xuICAgIHRoaXMuX3BhbmVzLmFkZFRhYignc2F2aW5nJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycsIHtcbiAgICAgICAgdGl0bGU6ICdTYXZpbmcgcHJpdmFjeeKApicsXG4gICAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgICB9KS5yZW5kZXIoKVxuICAgICk7XG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdzYXZlRmFpbCcsXG4gICAgICBWaWV3RmFjdG9yeS5jcmVhdGVCeVRlbXBsYXRlKCdjb21tb24vdGVtcGxhdGVzL2ZhaWwnLCB7XG4gICAgICAgIG1zZzogJydcbiAgICAgIH0pLnJlbmRlcigpXG4gICAgKTtcbiAgICB0aGlzLl9wYW5lcy5hY3RpdmUoJ3N0YXJ0Jyk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fcGFuZXMuYmluZCgndGFiRW5hYmxlZCcsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLl9wYW5lcy5nZXRQYW5lKCdzdGFydCcpLmJpbmQoJ2NsaWNrZWRTaGFyZScsIHRoaXMuX29wZW5TaGFyZURpYWxvZywgdGhpcyk7XG4gIH0sXG5cbiAgX29wZW5TaGFyZURpYWxvZzogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHZpZXcgPSBuZXcgU2hhcmVWaWV3KHtcbiAgICAgIGNsZWFuX29uX2hpZGU6IHRydWUsXG4gICAgICBlbnRlcl90b19jb25maXJtOiB0cnVlLFxuICAgICAgdXNlcjogdGhpcy5vcHRpb25zLnVzZXIsXG4gICAgICB2aXM6IHRoaXMub3B0aW9ucy52aXMsXG4gICAgICBDaGFuZ2VQcml2YWN5VmlldzogQ2hhbmdlUHJpdmFjeVZpZXdcbiAgICB9KTtcblxuICAgIC8vIE9yZGVyIG1hdHRlcnMsIGNsb3NlIHRoaXMgZGlhbG9nIGJlZm9yZSBhcHBlbmRpbmcgdGhlIHNoYXJlIG9uZSwgZm9yIHNpZGUtZWZmZWN0cyB0byB3b3JrIGFzIGV4cGVjdGVkIChib2R5LmlzLWluRGlhbG9nKVxuICAgIHRoaXMuY2xvc2UoKTtcbiAgICB2aWV3LmFwcGVuZFRvQm9keSgpO1xuICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBDaGFuZ2VQcml2YWN5VmlldztcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG5cbi8qKlxuICogRGVmYXVsdCBtb2RlbCBmb3IgYSBwcml2YWN5IG9wdGlvbi5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIGRlZmF1bHRzOiB7XG4gICAgcHJpdmFjeTogJ1BVQkxJQycsXG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICBwYXNzd29yZDogdW5kZWZpbmVkXG4gIH0sXG5cbiAgdmFsaWRhdGU6IGZ1bmN0aW9uKGF0dHJzKSB7XG4gICAgaWYgKGF0dHJzLmRpc2FibGVkICYmIGF0dHJzLnNlbGVjdGVkKSB7XG4gICAgICByZXR1cm4gJ09wdGlvbiBjYW4gbm90IGJlIGRpc2FibGVkIGFuZCBzZWxlY3RlZCBhdCB0aGUgc2FtZSB0aW1lJztcbiAgICB9XG4gIH0sXG5cbiAgY2xhc3NOYW1lczogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIF8uY2hhaW4oWydkaXNhYmxlZCcsICdzZWxlY3RlZCddKVxuICAgICAgLm1hcChmdW5jdGlvbihhdHRyKSB7IHJldHVybiAhIXRoaXMuYXR0cmlidXRlc1thdHRyXSA/ICdpcy0nK2F0dHIgOiB1bmRlZmluZWQ7IH0sIHRoaXMpXG4gICAgICAuY29tcGFjdCgpLnZhbHVlKCkuam9pbignICcpO1xuICB9LFxuXG4gIGNhblNhdmU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAhdGhpcy5nZXQoJ2Rpc2FibGVkJyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEBwYXJhbSB2aXMge09iamVjdH0gaW5zdGFuY2Ugb2YgY2RiLmFkbWluLlZpc3VhbGl6YXRpb25cbiAgICogQHBhcmFtIGNhbGxiYWNrcyB7T2JqZWN0fVxuICAgKi9cbiAgc2F2ZVRvVmlzOiBmdW5jdGlvbih2aXMsIGNhbGxiYWNrcykge1xuICAgIHJldHVybiB2aXMuc2F2ZSh0aGlzLl9hdHRyc1RvU2F2ZSgpLCBfLmV4dGVuZCh7IHdhaXQ6IHRydWUgfSwgY2FsbGJhY2tzKSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IGF0dHJzXG4gICAqIEBwcm90ZWN0ZWRcbiAgICovXG4gIF9hdHRyc1RvU2F2ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIF8ucGljayh0aGlzLmF0dHJpYnV0ZXMsICdwcml2YWN5JywgJ3Bhc3N3b3JkJyk7XG4gIH1cbn0pO1xuIiwidmFyIEJhY2tib25lID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ0JhY2tib25lJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydCYWNrYm9uZSddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBPcHRpb25Nb2RlbCA9IHJlcXVpcmUoJy4vb3B0aW9uX21vZGVsJyk7XG52YXIgUGFzc3dvcmRPcHRpb25Nb2RlbCA9IHJlcXVpcmUoJy4vcGFzc3dvcmRfb3B0aW9uX21vZGVsJyk7XG5cbi8qKlxuICogdHlwZSBwcm9wZXJ0eSBzaG91bGQgbWF0Y2ggdGhlIHZhbHVlIGdpdmVuIGZyb20gdGhlIEFQSS5cbiAqL1xudmFyIEFMTF9PUFRJT05TID0gW3tcbiAgcHJpdmFjeTogJ1BVQkxJQycsXG4gIGlsbHVzdHJhdGlvblR5cGU6ICdwb3NpdGl2ZScsXG4gIGljb25Gb250VHlwZTogJ3VubG9jaycsXG4gIHRpdGxlOiAnUHVibGljJyxcbiAgZGVzYzogJ0V2ZXJ5b25lIGNhbiB2aWV3IGFuZCBkb3dubG9hZCBpdCcsXG4gIGFsd2F5c0VuYWJsZTogdHJ1ZVxufSwge1xuICBwcml2YWN5OiAnTElOSycsXG4gIGlsbHVzdHJhdGlvblR5cGU6ICdhbGVydCcsXG4gIGljb25Gb250VHlwZTogJ3VubG9jaycsXG4gIHRpdGxlOiAnV2l0aCBsaW5rJyxcbiAgZGVzYzogJ09ubHkgdGhlIHBlb3BsZSB3aXRoIHRoZSBsaW5rIGNhbiB2aWV3IGl0J1xufSwge1xuICBwcml2YWN5OiAnUEFTU1dPUkQnLFxuICBpbGx1c3RyYXRpb25UeXBlOiAnYWxlcnQnLFxuICBpY29uRm9udFR5cGU6ICd1bmxvY2tXaXRoRWxsaXBzaXMnLFxuICB0aXRsZTogJ1Bhc3N3b3JkIHByb3RlY3RlZCcsXG4gIGRlc2M6ICdPbmx5IHRoZSBwZW9wbGUgd2l0aCB0aGUgcGFzc3dvcmQgY2FuIHZpZXcgaXQnXG59LCB7XG4gIHByaXZhY3k6ICdQUklWQVRFJyxcbiAgaWxsdXN0cmF0aW9uVHlwZTogJ25lZ2F0aXZlJyxcbiAgaWNvbkZvbnRUeXBlOiAnbG9jaycsXG4gIHRpdGxlOiAnUHJpdmF0ZScsXG4gIGRlc2M6ICdPbmx5IHlvdSBjYW4gYWNjZXNzIGl0J1xufV07XG5cblxuLyoqXG4gKiBDb2xsZWN0aW9uIHRoYXQgaG9sZHMgdGhlIGRpZmZlcmVudCBwcml2YWN5IG9wdGlvbnMuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoe1xuXG4gIG1vZGVsOiBmdW5jdGlvbihhdHRycywgb3B0aW9ucykge1xuICAgIGlmIChhdHRycy5wcml2YWN5ID09PSAnUEFTU1dPUkQnKSB7XG4gICAgICByZXR1cm4gbmV3IFBhc3N3b3JkT3B0aW9uTW9kZWwoYXR0cnMsIG9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbmV3IE9wdGlvbk1vZGVsKGF0dHJzLCBvcHRpb25zKTtcbiAgICB9XG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5iaW5kKCdjaGFuZ2U6c2VsZWN0ZWQnLCB0aGlzLl9kZXNlbGVjdExhc3RTZWxlY3RlZCwgdGhpcylcbiAgfSxcblxuICBzZWxlY3RlZE9wdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZmluZChmdW5jdGlvbihvcHRpb24pIHtcbiAgICAgIHJldHVybiBvcHRpb24uZ2V0KCdzZWxlY3RlZCcpO1xuICAgIH0pXG4gIH0sXG5cbiAgcGFzc3dvcmRPcHRpb246IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmZpbmQoZnVuY3Rpb24ob3B0aW9uKSB7XG4gICAgICByZXR1cm4gb3B0aW9uLmdldCgncHJpdmFjeScpID09PSAnUEFTU1dPUkQnO1xuICAgIH0pXG4gIH0sXG5cbiAgX2Rlc2VsZWN0TGFzdFNlbGVjdGVkOiBmdW5jdGlvbihtLCBpc1NlbGVjdGVkKSB7XG4gICAgaWYgKGlzU2VsZWN0ZWQpIHtcbiAgICAgIHRoaXMuZWFjaChmdW5jdGlvbihvcHRpb24pIHtcbiAgICAgICAgaWYgKG9wdGlvbiAhPT0gbSkge1xuICAgICAgICAgIG9wdGlvbi5zZXQoe3NlbGVjdGVkOiBmYWxzZX0sIHtzaWxlbnQ6IHRydWV9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbn0sIHsgLy8gQ2xhc3MgcHJvcGVydGllczpcblxuICAvKipcbiAgICogR2V0IGEgcHJpdmFjeSBvcHRpb25zIGNvbGxlY3Rpb24gZnJvbSBhIFZpcyBtb2RlbFxuICAgKlxuICAgKiBOb3RlIHRoYXQgc2luY2UgdGhlIHVzZXIncyBwZXJtaXNzaW9ucyBzaG91bGQgY2hhbmdlIHZlcnkgc2VsZG9tLCBpdCdzIHJlYXNvbmFibGUgdG8gYXNzdW1lIHRoZXkgd2lsbCBiZSBzdGF0aWMgZm9yXG4gICAqIHRoZSBjb2xsZWN0aW9uJ3MgbGlmZWN5Y2xlLCBzbyBzZXQgdGhlbSBvbiB0aGUgbW9kZWxzIGF0dHJzIHdoZW4gY3JlYXRpbmcgdGhlIGNvbGxlY3Rpb24uXG4gICAqIGNvbGxlY3Rpb24gaXMgY3JlYXRlZC5cbiAgICpcbiAgICogQHBhcmFtIHZpcyB7T2JqZWN0fSBpbnN0YW5jZSBvZiBjZGIuYWRtaW4uVmlzdWFsaXphdGlvblxuICAgKiBAcGFyYW0gdXNlciB7T2JqZWN0fSBpbnN0YW5jZSBvZiBjZGIuYWRtaW4uVXNlclxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBpbnN0YW5jZSBvZiB0aGlzIGNvbGxlY3Rpb25cbiAgICovXG4gIGJ5VmlzQW5kVXNlcjogZnVuY3Rpb24odmlzLCB1c2VyKSB7XG4gICAgdmFyIGNhblNlbGVjdFByZW1pdW1PcHRpb25zID0gdXNlci5nZXQoJ2FjdGlvbnMnKVsgdmlzLmlzVmlzdWFsaXphdGlvbigpID8gJ3ByaXZhdGVfbWFwcycgOiAncHJpdmF0ZV90YWJsZXMnIF07XG4gICAgdmFyIGN1cnJlbnRQcml2YWN5ID0gdmlzLmdldCgncHJpdmFjeScpO1xuICAgIHZhciBhdmFpbGFibGVPcHRpb25zID0gdmlzLnByaXZhY3lPcHRpb25zKCk7XG5cbiAgICByZXR1cm4gbmV3IHRoaXMoXG4gICAgICBfLmNoYWluKEFMTF9PUFRJT05TKVxuICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uKG9wdGlvbikge1xuICAgICAgICAgIHJldHVybiBfLmNvbnRhaW5zKGF2YWlsYWJsZU9wdGlvbnMsIG9wdGlvbi5wcml2YWN5KTtcbiAgICAgICAgfSlcbiAgICAgICAgLm1hcChmdW5jdGlvbihvcHRpb24pIHtcbiAgICAgICAgICAvLyBTZXQgc3RhdGUgdGhhdCBkZXBlbmRzIG9uIHZpcyBhbmQgdXNlciBhdHRycywgdGhleSBzaG91bGQgbm90IHZhcnkgZHVyaW5nIHRoZSBsaWZlY3ljbGUgb2YgdGhpcyBjb2xsZWN0aW9uXG4gICAgICAgICAgcmV0dXJuIF8uZGVmYXVsdHMoe1xuICAgICAgICAgICAgc2VsZWN0ZWQ6IG9wdGlvbi5wcml2YWN5ID09PSBjdXJyZW50UHJpdmFjeSxcbiAgICAgICAgICAgIGRpc2FibGVkOiAhKG9wdGlvbi5hbHdheXNFbmFibGUgfHwgY2FuU2VsZWN0UHJlbWl1bU9wdGlvbnMpXG4gICAgICAgICAgfSwgb3B0aW9uKVxuICAgICAgICB9KVxuICAgICAgICAudmFsdWUoKVxuICAgICk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBPcHRpb25Nb2RlbCA9IHJlcXVpcmUoJy4vb3B0aW9uX21vZGVsJyk7XG5cbi8qKlxuICogVmlldyBtb2RlbCBmb3IgdGhlIHNwZWNpYWwgcHJpdmFjeSBvcHRpb24gcmVwcmVzZW50aW5nIGEgcGFzc3dvcmQgcHJvdGVjdGVkIG1hcC5cbiAqIEl0IGhhbmRsZXMgdGhlIGxvZ2ljIHJlbGF0ZWQgdG8gdGhlIHBhc3N3b3JkIHRoYXQgbmVlZHMgdG8gYmUgc2V0IGZvciB0aGUgb3B0aW9uLlxuICovXG52YXIgUGFzc3dvcmRPcHRpb25Nb2RlbCA9IE9wdGlvbk1vZGVsLmV4dGVuZCh7XG4gIFxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICBPcHRpb25Nb2RlbC5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXG4gICAgLy8gSW5pdGlhbGx5IGEgZGVmYXVsdCBmYWtlIHBhc3N3b3JkIGlzIHNldCwgYnV0IGlmIG9wdGlvbiBpcyBzZWxlY3RlZCAobGlrZSBzd2l0Y2hpbmcgb3B0aW9uKSBpdCdzIHJlc2V0XG4gICAgdGhpcy5zZXQoJ3Bhc3N3b3JkJywgUGFzc3dvcmRPcHRpb25Nb2RlbC5ERUZBVUxUX0ZBS0VfUEFTU1dPUkQpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBAb3ZlcnJpZGUgT3B0aW9uTW9kZWwuYXR0cnNUb1NhdmVcbiAgICovXG4gIF9hdHRyc1RvU2F2ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGF0dHJzID0gT3B0aW9uTW9kZWwucHJvdG90eXBlLl9hdHRyc1RvU2F2ZS5jYWxsKHRoaXMpO1xuICAgIFxuICAgIGlmIChhdHRycy5wYXNzd29yZCA9PT0gUGFzc3dvcmRPcHRpb25Nb2RlbC5ERUZBVUxUX0ZBS0VfUEFTU1dPUkQpIHtcbiAgICAgIGRlbGV0ZSBhdHRycy5wYXNzd29yZDtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGF0dHJzO1xuICB9LCBcbiAgXG4gIGNhblNhdmU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBPcHRpb25Nb2RlbC5wcm90b3R5cGUuY2FuU2F2ZS5jYWxsKHRoaXMpICYmICFfLmlzRW1wdHkodGhpcy5nZXQoJ3Bhc3N3b3JkJykpO1xuICB9XG4gIFxufSwge1xuICBcbiAgREVGQVVMVF9GQUtFX1BBU1NXT1JEOiAnIUAjIUAjJ1xuICBcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBhc3N3b3JkT3B0aW9uTW9kZWw7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgUGVybWlzc2lvblZpZXcgPSByZXF1aXJlKCcuL3Blcm1pc3Npb25fdmlldycpO1xudmFyIFVzZXJEZXRhaWxzVmlldyA9IHJlcXVpcmUoJy4vdXNlcl9kZXRhaWxzX3ZpZXcnKTtcbnZhciBHcm91cERldGFpbHNWaWV3ID0gcmVxdWlyZSgnLi9ncm91cF9kZXRhaWxzX3ZpZXcnKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uLy4uL3ZpZXdfZmFjdG9yeScpO1xuXG4vKipcbiAqIENvbnRlbnQgdmlldyBvZiB0aGUgc2hhcmUgZGlhbG9nLCBsaXN0cyBvZiB1c2VycyB0byBzaGFyZSBpdGVtIHdpdGguXG4gKiAtIG1vZGVsOiB7T2JqZWN0fSB0aGUgc2hhcmUgdmlldyBtb2RlbFxuICogLSBjb2xsZWN0aW9uOiB7Y2RiLmFkbWluLkdyYW50YWJsZXN9XG4gKiAtIGhhc1NlYXJjaDoge0Jvb2xlYW59XG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIF8uZWFjaChbJ21vZGVsJywgJ2NvbGxlY3Rpb24nLCAncGFnZWRTZWFyY2hNb2RlbCddLCBmdW5jdGlvbihuYW1lKSB7XG4gICAgICBpZiAoXy5pc1VuZGVmaW5lZCh0aGlzLm9wdGlvbnNbbmFtZV0pKSB0aHJvdyBuZXcgRXJyb3IobmFtZSArICcgaXMgcmVxdWlyZWQnKTtcbiAgICB9LCB0aGlzKTtcblxuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy4kZWwuZW1wdHkoKTtcblxuICAgIGlmICghdGhpcy5vcHRpb25zLnBhZ2VkU2VhcmNoTW9kZWwuZ2V0KCdxJykpIHtcbiAgICAgIHRoaXMuX3JlbmRlck9yZ2FuaXphdGlvblBlcm1pc3Npb25WaWV3KClcbiAgICB9XG4gICAgdGhpcy5fcmVuZGVyR3JhbnRhYmxlc1ZpZXdzKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmJpbmQoJ3Jlc2V0JywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5jb2xsZWN0aW9uKTtcblxuICAgIHRoaXMub3B0aW9ucy5wYWdlZFNlYXJjaE1vZGVsLm9uKCdjaGFuZ2U6cScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMub3B0aW9ucy5wYWdlZFNlYXJjaE1vZGVsKTtcbiAgfSxcblxuICBfcmVuZGVyR3JhbnRhYmxlc1ZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZGVwZW5kZW50VmlzdWFsaXphdGlvbnMgPSB0aGlzLm1vZGVsLmdldCgndmlzJykudGFibGVNZXRhZGF0YSgpLmRlcGVuZGVudFZpc3VhbGl6YXRpb25zKCk7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmVhY2goZnVuY3Rpb24oZ3JhbnRhYmxlKSB7XG4gICAgICB0aGlzLl9hcHBlbmRWaWV3KFxuICAgICAgICBuZXcgUGVybWlzc2lvblZpZXcoe1xuICAgICAgICAgIG1vZGVsOiBncmFudGFibGUuZW50aXR5LFxuICAgICAgICAgIHBlcm1pc3Npb246IHRoaXMubW9kZWwuZ2V0KCdwZXJtaXNzaW9uJyksXG4gICAgICAgICAgaXNXcml0ZUFjY2Vzc1RvZ2dsZXJBdmFpbGFibGU6IHRoaXMubW9kZWwuaXNXcml0ZUFjY2Vzc1RvZ2dsZXJBdmFpbGFibGUoKSxcbiAgICAgICAgICBkZXRhaWxzVmlldzogdGhpcy5fY3JlYXRlRGV0YWlsc1ZpZXcoXG4gICAgICAgICAgICB0aGlzLl9kZXRhaWxzVmlld09wdHMuYmluZCh0aGlzLCBkZXBlbmRlbnRWaXN1YWxpemF0aW9ucywgZ3JhbnRhYmxlLmVudGl0eSksXG4gICAgICAgICAgICBncmFudGFibGVcbiAgICAgICAgICApXG4gICAgICAgIH0pXG4gICAgICApXG4gICAgfSwgdGhpcyk7XG4gIH0sXG5cbiAgX3JlbmRlck9yZ2FuaXphdGlvblBlcm1pc3Npb25WaWV3OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9hcHBlbmRWaWV3KFxuICAgICAgbmV3IFBlcm1pc3Npb25WaWV3KHtcbiAgICAgICAgbW9kZWw6IHRoaXMubW9kZWwuZ2V0KCdvcmdhbml6YXRpb24nKSxcbiAgICAgICAgcGVybWlzc2lvbjogdGhpcy5tb2RlbC5nZXQoJ3Blcm1pc3Npb24nKSxcbiAgICAgICAgaXNXcml0ZUFjY2Vzc1RvZ2dsZXJBdmFpbGFibGU6IHRoaXMubW9kZWwuaXNXcml0ZUFjY2Vzc1RvZ2dsZXJBdmFpbGFibGUoKSxcbiAgICAgICAgZGV0YWlsc1ZpZXc6IFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2NoYW5nZV9wcml2YWN5L3NoYXJlL2RldGFpbHMnLCB7XG4gICAgICAgICAgYXZhdGFyVXJsOiBmYWxzZSxcbiAgICAgICAgICB3aWxsUmV2b2tlQWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICB0aXRsZTogJ0RlZmF1bHQgc2V0dGluZ3MgZm9yIHlvdXIgT3JnYW5pemF0aW9uJyxcbiAgICAgICAgICBkZXNjOiAnTmV3IHVzZXJzIHdpbGwgaGF2ZSB0aGlzIHBlcm1pc3Npb24nLFxuICAgICAgICAgIHJvbGVMYWJlbDogZmFsc2VcbiAgICAgICAgfSwge1xuICAgICAgICAgIGNsYXNzTmFtZTogJ0NoYW5nZVByaXZhY3ktc2hhcmVMaXN0SXRlbUluZm8nXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgICk7XG4gIH0sXG5cbiAgX2FwcGVuZFZpZXc6IGZ1bmN0aW9uKHZpZXcpIHtcbiAgICB0aGlzLiRlbC5hcHBlbmQodmlldy5yZW5kZXIoKS5lbCk7XG4gICAgdGhpcy5hZGRWaWV3KHZpZXcpO1xuICB9LFxuXG4gIF9jcmVhdGVEZXRhaWxzVmlldzogZnVuY3Rpb24oZGV0YWlsc1ZpZXdPcHRzLCBncmFudGFibGUpIHtcbiAgICB2YXIgdHlwZSA9IGdyYW50YWJsZS5nZXQoJ3R5cGUnKTtcbiAgICBzd2l0Y2godHlwZSkge1xuICAgICAgY2FzZSAndXNlcic6XG4gICAgICAgIHJldHVybiBuZXcgVXNlckRldGFpbHNWaWV3KFxuICAgICAgICAgIGRldGFpbHNWaWV3T3B0cyhbZ3JhbnRhYmxlLmlkXSlcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdncm91cCc6XG4gICAgICAgIHJldHVybiBuZXcgR3JvdXBEZXRhaWxzVmlldyhcbiAgICAgICAgICBkZXRhaWxzVmlld09wdHMoXG4gICAgICAgICAgICBncmFudGFibGUuZW50aXR5LnVzZXJzLmNoYWluKClcbiAgICAgICAgICAgICAgLnJlamVjdCh0aGlzLl9pc0N1cnJlbnRVc2VyKVxuICAgICAgICAgICAgICAucGx1Y2soJ2lkJylcbiAgICAgICAgICAgICAgLnZhbHVlKClcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY2RiLmxvZy5lcnJvcignTm8gZGV0YWlscyB2aWV3IGZvciBncmFudGFibGUgbW9kZWwgb2YgdHlwZSAnICsgdHlwZSk7XG4gICAgICAgIHJldHVybiBuZXcgY2RiLmNvcmUuVmlldyhkZXRhaWxzVmlld09wdHMoKSk7XG4gICAgfVxuICB9LFxuXG4gIF9kZXRhaWxzVmlld09wdHM6IGZ1bmN0aW9uKGRlcGVuZGVudFZpc3VhbGl6YXRpb25zLCBncmFudGFibGVFbnRpdHksIHVzZXJJZHMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgY2xhc3NOYW1lOiAnQ2hhbmdlUHJpdmFjeS1zaGFyZUxpc3RJdGVtSW5mbycsXG4gICAgICBtb2RlbDogZ3JhbnRhYmxlRW50aXR5LFxuICAgICAgcGVybWlzc2lvbjogdGhpcy5tb2RlbC5nZXQoJ3Blcm1pc3Npb24nKSxcbiAgICAgIGlzVXNpbmdWaXM6IF8uYW55KGRlcGVuZGVudFZpc3VhbGl6YXRpb25zLCBmdW5jdGlvbih2aXMpIHtcbiAgICAgICAgcmV0dXJuIF8uYW55KHVzZXJJZHMsIGZ1bmN0aW9uKHVzZXJJZCkge1xuICAgICAgICAgIHJldHVybiB1c2VySWQgPT09IHZpcy5wZXJtaXNzaW9uLm93bmVyLmlkO1xuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9O1xuICB9LFxuXG4gIF9pc0N1cnJlbnRVc2VyOiBmdW5jdGlvbih1c2VyKSB7XG4gICAgcmV0dXJuIHVzZXIuaWQgPT09IGNkYi5jb25maWcuZ2V0KCd1c2VyJykuaWQ7XG4gIH0sXG5cbn0pO1xuIiwidmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBwbHVyYWxpemVTdHJpbmcgPSByZXF1aXJlKCcuLi8uLi8uLi92aWV3X2hlbHBlcnMvcGx1cmFsaXplX3N0cmluZycpXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIF8uZWFjaChbJ3Blcm1pc3Npb24nLCAnaXNVc2luZ1ZpcyddLCBmdW5jdGlvbihuYW1lKSB7XG4gICAgICBpZiAoXy5pc1VuZGVmaW5lZCh0aGlzLm9wdGlvbnNbbmFtZV0pKSB0aHJvdyBuZXcgRXJyb3IobmFtZSArICcgaXMgcmVxdWlyZWQnKTtcbiAgICB9LCB0aGlzKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9jaGFuZ2VfcHJpdmFjeS9zaGFyZS9kZXRhaWxzJykoe1xuICAgICAgICB3aWxsUmV2b2tlQWNjZXNzOiB0aGlzLl93aWxsUmV2b2tlQWNjZXNzKCksXG4gICAgICAgIGF2YXRhclVybDogdGhpcy5tb2RlbC5nZXQoJ2F2YXRhcl91cmwnKSxcbiAgICAgICAgdGl0bGU6IHRoaXMubW9kZWwuZ2V0KCdkaXNwbGF5X25hbWUnKSxcbiAgICAgICAgZGVzYzogdGhpcy5fZGVzYygpLFxuICAgICAgICByb2xlTGFiZWw6IGZhbHNlXG4gICAgICB9KVxuICAgICk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2Rlc2M6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB1c2Vyc0NvdW50ID0gdGhpcy5tb2RlbC51c2Vycy5sZW5ndGg7XG4gICAgdmFyIHhNZW1iZXJzID0gcGx1cmFsaXplU3RyaW5nLnByZWZpeFdpdGhDb3VudCgnbWVtYmVyJywgJ21lbWJlcnMnLCB1c2Vyc0NvdW50KTtcblxuICAgIGlmICh0aGlzLl93aWxsUmV2b2tlQWNjZXNzKCkpIHtcbiAgICAgIHJldHVybiB4TWVtYmVycyArICcuICcgKyBwbHVyYWxpemVTdHJpbmcoXCJNZW1iZXInc1wiLCBcIk1lbWJlcnMnXCIsIHVzZXJzQ291bnQpICsgJyBtYXBzIHdpbGwgYmUgYWZmZWN0ZWQnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25zLmlzVXNpbmdWaXMpIHtcbiAgICAgIHJldHVybiB4TWVtYmVycyArICcuICcgKyBwbHVyYWxpemVTdHJpbmcoJ01lbWJlciBpcycsICdNZW1iZXJzIGFyZScsIHVzZXJzQ291bnQpICsgJyB1c2luZyB0aGlzIGRhdGFzZXQnO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4geE1lbWJlcnM7XG4gICAgfVxuICB9LFxuXG4gIF93aWxsUmV2b2tlQWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLmlzVXNpbmdWaXMgJiYgIXRoaXMub3B0aW9ucy5wZXJtaXNzaW9uLmhhc1JlYWRBY2Nlc3ModGhpcy5tb2RlbCk7XG4gIH1cblxufSk7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqIFZpZXcgZm9yIGFuIGluZGl2aWR1YWwgYWNjZXNzIHRvZ2dsZXIuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIHRhZ05hbWU6ICdzcGFuJyxcblxuICBldmVudHM6IHtcbiAgICAnbW91c2VvdmVyIC5qcy10b2dnbGVyLmlzLWRpc2FibGVkJzogJ19vbkhvdmVyRGlzYWJsZWRUb2dnbGVyJyxcbiAgICAnbW91c2VvdXQgLmpzLXRvZ2dsZXInOiAnX2Nsb3NlVG9vbHRpcCcsXG4gICAgJ21vdXNlbGVhdmUgLmpzLXRvZ2dsZXInOiAnX2Nsb3NlVG9vbHRpcCcsXG4gICAgJ2NoYW5nZSAuanMtaW5wdXQnOiAnX29uQ2hhbmdlSW5wdXQnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgXy5lYWNoKFsnbW9kZWwnLCAncGVybWlzc2lvbicsICdoYXNBY2Nlc3MnLCAnY2FuQ2hhbmdlQWNjZXNzJywgJ3RvZ2dsZUFjY2VzcycsICdsYWJlbCddLCBmdW5jdGlvbihuYW1lKSB7XG4gICAgICBpZiAoXy5pc1VuZGVmaW5lZCh0aGlzLm9wdGlvbnNbbmFtZV0pKSB0aHJvdyBuZXcgRXJyb3IobmFtZSArICcgaXMgcmVxdWlyZWQnKTtcbiAgICB9LCB0aGlzKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9jaGFuZ2VfcHJpdmFjeS9zaGFyZS9wZXJtaXNzaW9uX3RvZ2dsZXInKSh7XG4gICAgICAgIGNpZDogdGhpcy5jaWQsXG4gICAgICAgIGhhc0FjY2VzczogdGhpcy5vcHRpb25zLmhhc0FjY2VzcygpLFxuICAgICAgICBjYW5DaGFuZ2VBY2Nlc3M6IHRoaXMub3B0aW9ucy5jYW5DaGFuZ2VBY2Nlc3MoKSxcbiAgICAgICAgbGFiZWw6IHRoaXMub3B0aW9ucy5sYWJlbFxuICAgICAgfSlcbiAgICApO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9vbkNoYW5nZUlucHV0OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm9wdGlvbnMudG9nZ2xlQWNjZXNzKCk7XG4gIH0sXG5cbiAgX29uSG92ZXJEaXNhYmxlZFRvZ2dsZXI6IGZ1bmN0aW9uKGV2KSB7XG4gICAgdmFyIGFjbEl0ZW0gPSB0aGlzLm9wdGlvbnMucGVybWlzc2lvbi5maW5kUmVwcmVzZW50YWJsZUFjbEl0ZW0odGhpcy5tb2RlbCk7XG4gICAgaWYgKGFjbEl0ZW0gJiYgIWFjbEl0ZW0uaXNPd24odGhpcy5tb2RlbCkpIHtcbiAgICAgIHRoaXMuX3Rvb2x0aXBWaWV3KCkuc2hvd1RpcHN5KCk7XG4gICAgfVxuICB9LFxuXG4gIF9jbG9zZVRvb2x0aXA6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3Rvb2x0aXBWaWV3KCkuaGlkZVRpcHN5KCk7XG4gIH0sXG5cbiAgX3Rvb2x0aXBWaWV3OiBmdW5jdGlvbihlbCkge1xuICAgIGlmICghdGhpcy5fdG9vbHRpcCkge1xuICAgICAgdGhpcy5fdG9vbHRpcCA9IHRoaXMuX25ld1Rvb2x0aXBWaWV3KCk7XG4gICAgICB0aGlzLmFkZFZpZXcodGhpcy5fdG9vbHRpcCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl90b29sdGlwO1xuICB9LFxuXG4gIF9uZXdUb29sdGlwVmlldzogZnVuY3Rpb24oZWwpIHtcbiAgICByZXR1cm4gbmV3IGNkYi5jb21tb24uVGlwc3lUb29sdGlwKHtcbiAgICAgIGVsOiB0aGlzLiQoJy5qcy10b2dnbGVyJyksXG4gICAgICB0cmlnZ2VyOiAnbWFudWFsJyxcbiAgICAgIHRpdGxlOiB0aGlzLl9pbmhlcml0ZWRBY2Nlc3NUb29sdGlwVGV4dC5iaW5kKHRoaXMpXG4gICAgfSk7XG4gIH0sXG5cbiAgX2luaGVyaXRlZEFjY2Vzc1Rvb2x0aXBUZXh0OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgYWNsSXRlbSA9IHRoaXMub3B0aW9ucy5wZXJtaXNzaW9uLmZpbmRSZXByZXNlbnRhYmxlQWNsSXRlbSh0aGlzLm1vZGVsKTtcbiAgICB2YXIgdHlwZSA9IGFjbEl0ZW0uZ2V0KCd0eXBlJyk7XG4gICAgc3dpdGNoKHR5cGUpIHtcbiAgICAgIGNhc2UgJ2dyb3VwJzpcbiAgICAgICAgcmV0dXJuICdBY2Nlc3MgaXMgaW5oZXJpdGVkIGZyb20gZ3JvdXAgJyArIGFjbEl0ZW0uZ2V0KCdlbnRpdHknKS5nZXQoJ25hbWUnKTtcbiAgICAgIGNhc2UgJ29yZyc6XG4gICAgICAgIHJldHVybiAnQWNjZXNzIGlzIGluaGVyaXRlZCBmcm9tIG9yZ2FuaXphdGlvbic7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjZGIubG9nLmVycm9yKCdUcnlpbmcgdG8gZGlzcGxheSBpbmhlcml0ZWQgYWNjZXNzIGZvciBhbiB1bnJlY29nbml6ZWQgdHlwZSAnICsgdHlwZSlcbiAgICAgICAgcmV0dXJuICcnXG4gICAgfVxuICB9XG5cbn0pO1xuIiwidmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBQZXJtaXNzaW9uVG9nZ2xlcnZpZXcgPSByZXF1aXJlKCcuL3Blcm1pc3Npb25fdG9nZ2xlcl92aWV3Jyk7XG52YXIgVmlld0ZhY3RvcnkgPSByZXF1aXJlKCcuLi8uLi8uLi92aWV3X2ZhY3RvcnknKTtcblxuLyoqXG4gKiBWaWV3IHRvIGNoYW5nZSBwZXJtaXNzaW9uIGZvciBhIGdpdmVuIG1vZGVsLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdDaGFuZ2VQcml2YWN5LXNoYXJlTGlzdEl0ZW0nLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIF8uZWFjaChbJ21vZGVsJywgJ3Blcm1pc3Npb24nLCAnaXNXcml0ZUFjY2Vzc1RvZ2dsZXJBdmFpbGFibGUnLCAnZGV0YWlsc1ZpZXcnXSwgZnVuY3Rpb24obmFtZSkge1xuICAgICAgaWYgKF8uaXNVbmRlZmluZWQodGhpcy5vcHRpb25zW25hbWVdKSkgdGhyb3cgbmV3IEVycm9yKG5hbWUgKyAnIGlzIHJlcXVpcmVkJyk7XG4gICAgfSwgdGhpcyk7XG5cbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm9wdGlvbnMucGVybWlzc2lvbi5hY2wuYmluZCgnYWRkIHJlbW92ZSByZXNldCBjaGFuZ2UnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbCh0aGlzLm9wdGlvbnMucGVybWlzc2lvbik7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcbiAgICB0aGlzLl9yZW5kZXJEZXRhaWxzKCk7XG4gICAgdGhpcy5fcmVuZGVyQWNjZXNzVG9nZ2xlcnMoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfcmVuZGVyRGV0YWlsczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fcmVuZGVyVmlldyh0aGlzLm9wdGlvbnMuZGV0YWlsc1ZpZXcpO1xuICB9LFxuXG4gIF9yZW5kZXJBY2Nlc3NUb2dnbGVyczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRvZ2dsZXJzID0gW1xuICAgICAgdGhpcy5fbmV3UmVhZFRvZ2dsZXIoKVxuICAgIF07XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLmlzV3JpdGVBY2Nlc3NUb2dnbGVyQXZhaWxhYmxlKSB7XG4gICAgICB0b2dnbGVycy51bnNoaWZ0KHRoaXMuX25ld1dyaXRlVG9nZ2xlcigpKTtcbiAgICB9XG5cbiAgICB0aGlzLl9yZW5kZXJWaWV3KFZpZXdGYWN0b3J5LmNyZWF0ZUJ5TGlzdCh0b2dnbGVycykpO1xuICB9LFxuXG4gIF9uZXdXcml0ZVRvZ2dsZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwID0gdGhpcy5vcHRpb25zLnBlcm1pc3Npb247XG4gICAgcmV0dXJuIG5ldyBQZXJtaXNzaW9uVG9nZ2xlcnZpZXcoe1xuICAgICAgY2xhc3NOYW1lOiAnQ2hhbmdlUHJpdmFjeS1zaGFyZUxpc3RJdGVtVG9nZ2xlckNvbnRhaW5lcicsXG4gICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgIHBlcm1pc3Npb246IHAsXG4gICAgICBsYWJlbDogJ1dyaXRlJyxcbiAgICAgIGhhc0FjY2VzczogcC5oYXNXcml0ZUFjY2Vzcy5iaW5kKHAsIHRoaXMubW9kZWwpLFxuICAgICAgY2FuQ2hhbmdlQWNjZXNzOiBwLmNhbkNoYW5nZVdyaXRlQWNjZXNzLmJpbmQocCwgdGhpcy5tb2RlbCksXG4gICAgICB0b2dnbGVBY2Nlc3M6IHRoaXMuX3RvZ2dsZVdyaXRlLmJpbmQodGhpcylcbiAgICB9KTtcbiAgfSxcblxuICBfbmV3UmVhZFRvZ2dsZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwID0gdGhpcy5vcHRpb25zLnBlcm1pc3Npb247XG4gICAgcmV0dXJuIG5ldyBQZXJtaXNzaW9uVG9nZ2xlcnZpZXcoe1xuICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICBwZXJtaXNzaW9uOiBwLFxuICAgICAgbGFiZWw6ICdSZWFkJyxcbiAgICAgIGhhc0FjY2VzczogcC5oYXNSZWFkQWNjZXNzLmJpbmQocCwgdGhpcy5tb2RlbCksXG4gICAgICBjYW5DaGFuZ2VBY2Nlc3M6IHAuY2FuQ2hhbmdlUmVhZEFjY2Vzcy5iaW5kKHAsIHRoaXMubW9kZWwpLFxuICAgICAgdG9nZ2xlQWNjZXNzOiB0aGlzLl90b2dnbGVSZWFkLmJpbmQodGhpcylcbiAgICB9KTtcbiAgfSxcblxuICBfcmVuZGVyVmlldzogZnVuY3Rpb24odmlldykge1xuICAgIHRoaXMuYWRkVmlldyh2aWV3KTtcbiAgICB0aGlzLiRlbC5hcHBlbmQodmlldy5yZW5kZXIoKS5lbClcbiAgfSxcblxuICBfdG9nZ2xlV3JpdGU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwID0gdGhpcy5vcHRpb25zLnBlcm1pc3Npb247XG4gICAgaWYgKHAuY2FuQ2hhbmdlV3JpdGVBY2Nlc3ModGhpcy5tb2RlbCkpIHtcbiAgICAgIGlmIChwLmhhc1dyaXRlQWNjZXNzKHRoaXMubW9kZWwpKSB7XG4gICAgICAgIHAucmV2b2tlV3JpdGVBY2Nlc3ModGhpcy5tb2RlbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwLmdyYW50V3JpdGVBY2Nlc3ModGhpcy5tb2RlbCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIF90b2dnbGVSZWFkOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcCA9IHRoaXMub3B0aW9ucy5wZXJtaXNzaW9uO1xuICAgIGlmIChwLmNhbkNoYW5nZVJlYWRBY2Nlc3ModGhpcy5tb2RlbCkpIHtcbiAgICAgIGlmIChwLmhhc1JlYWRBY2Nlc3ModGhpcy5tb2RlbCkpIHtcbiAgICAgICAgcC5yZXZva2VBY2Nlc3ModGhpcy5tb2RlbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwLmdyYW50UmVhZEFjY2Vzcyh0aGlzLm1vZGVsKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xuXG4vKipcbiAqIFZpZXcgbW9kZWwgZm9yIGEgc2hhcmUgdmlldyBtb2RhbC5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIGRlZmF1bHRzOiB7XG4gICAgdmlzOiB1bmRlZmluZWQsXG4gICAgcGVybWlzc2lvbjogdW5kZWZpbmVkLFxuICAgIG9yZ2FuaXphdGlvbjogdW5kZWZpbmVkXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oYXR0cnMpIHtcbiAgICBpZiAoIWF0dHJzLnZpcykgdGhyb3cgbmV3IEVycm9yKCd2aXMgaXMgcmVxdWlyZWQnKTtcbiAgICBpZiAoIWF0dHJzLm9yZ2FuaXphdGlvbikgdGhyb3cgbmV3IEVycm9yKCdvcmdhbml6YXRpb24gaXMgcmVxdWlyZWQnKTtcblxuICAgIHZhciB2aXMgPSB0aGlzLmdldCgndmlzJyk7XG4gICAgdGhpcy5zZXQoJ3Blcm1pc3Npb24nLCB2aXMucGVybWlzc2lvbi5jbG9uZSgpKTtcblxuICAgIGlmICghdmlzLmlzVmlzdWFsaXphdGlvbigpKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB2aXMudGFibGVNZXRhZGF0YSgpLmZldGNoKHtcbiAgICAgICAgc2lsZW50OiB0cnVlLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBzZWxmLnRyaWdnZXIoJ2FsbCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgbmFtZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCd2aXMnKS5nZXQoJ25hbWUnKTtcbiAgfSxcblxuICBpc1dyaXRlQWNjZXNzVG9nZ2xlckF2YWlsYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICF0aGlzLmdldCgndmlzJykuaXNWaXN1YWxpemF0aW9uKCk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uLy4uLy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcbnZhciByYW5kb21RdW90ZSA9IHJlcXVpcmUoJy4uLy4uLy4uL3ZpZXdfaGVscGVycy9yYW5kb21fcXVvdGUnKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uLy4uL3ZpZXdfZmFjdG9yeScpO1xudmFyIFBhZ2VkU2VhcmNoTW9kZWwgPSByZXF1aXJlKCcuLi8uLi8uLi9wYWdlZF9zZWFyY2hfbW9kZWwnKTtcbnZhciBQYWdlZFNlYXJjaFZpZXcgPSByZXF1aXJlKCcuLi8uLi8uLi92aWV3cy9wYWdlZF9zZWFyY2gvcGFnZWRfc2VhcmNoX3ZpZXcnKTtcbnZhciBTaGFyZU1vZGVsID0gcmVxdWlyZSgnLi9zaGFyZV9tb2RlbCcpO1xudmFyIEdyYW50YWJsZXNWaWV3ID0gcmVxdWlyZSgnLi9ncmFudGFibGVzX3ZpZXcnKTtcblxuLyoqXG4gKiBEaWFsb2cgdG8gc2hhcmUgaXRlbSB3aXRoIG90aGVyIHVzZXJzIGluIG9yZ2FuaXphdGlvbi5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBCYXNlRGlhbG9nLmV4dGVuZCh7XG5cbiAgZXZlbnRzOiBCYXNlRGlhbG9nLmV4dGVuZEV2ZW50cyh7XG4gICAgJ2NsaWNrIC5qcy1iYWNrJzogJ19vcGVuQ2hhbmdlUHJpdmFjeSdcbiAgfSksXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMuQ2hhbmdlUHJpdmFjeVZpZXcpIHRocm93IG5ldyBFcnJvcignQ2hhbmdlUHJpdmFjeVZpZXcgaXMgcmVxdWlyZWQnKTtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLm9yZ2FuaXphdGlvbiA9IHRoaXMudXNlci5vcmdhbml6YXRpb247XG4gICAgdGhpcy5tb2RlbCA9IG5ldyBTaGFyZU1vZGVsKHtcbiAgICAgIHZpczogdGhpcy5vcHRpb25zLnZpcyxcbiAgICAgIG9yZ2FuaXphdGlvbjogdGhpcy5vcmdhbml6YXRpb25cbiAgICB9KTtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBCYXNlRGlhbG9nLnByb3RvdHlwZS5yZW5kZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB0aGlzLiQoJy5jb250ZW50JykuYWRkQ2xhc3MoJ0RpYWxvZy1jb250ZW50LS1leHBhbmRlZCcpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIC8vIEBpbXBsZW1lbnRzIGNkYi51aS5jb21tb24uRGlhbG9nLnByb3RvdHlwZS5yZW5kZXJfY29udGVudFxuICByZW5kZXJfY29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHRoaXMuX2h0bWxOb2RlKFxuICAgICAgICBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9jaGFuZ2VfcHJpdmFjeS9zaGFyZS9zaGFyZV9oZWFkZXInKSh7XG4gICAgICAgICAgbmFtZTogdGhpcy5vcHRpb25zLnZpcy5nZXQoJ25hbWUnKVxuICAgICAgICB9KVxuICAgICAgKSxcbiAgICAgIHRoaXMuX2dyYW50YWJsZXNWaWV3LnJlbmRlcigpLmVsLFxuICAgICAgdGhpcy5faHRtbE5vZGUoY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvY2hhbmdlX3ByaXZhY3kvc2hhcmUvc2hhcmVfZm9vdGVyJykoKSlcbiAgICBdO1xuICB9LFxuXG4gIC8vIEBpbXBsZW1lbnRzIGNkYi51aS5jb21tb24uRGlhbG9nLnByb3RvdHlwZS5va1xuICBvazogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGxvYWRpbmdWaWV3ID0gVmlld0ZhY3RvcnkuY3JlYXRlRGlhbG9nQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9sb2FkaW5nJywge1xuICAgICAgdGl0bGU6ICdTaGFyaW5n4oCmJyxcbiAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgfSk7XG4gICAgbG9hZGluZ1ZpZXcuYXBwZW5kVG9Cb2R5KCk7XG5cbiAgICB2YXIgcGVybWlzc2lvbiA9IHRoaXMub3B0aW9ucy52aXMucGVybWlzc2lvbjtcbiAgICBwZXJtaXNzaW9uLm92ZXJ3cml0ZUFjbCh0aGlzLm1vZGVsLmdldCgncGVybWlzc2lvbicpKTtcbiAgICBwZXJtaXNzaW9uLnNhdmUoKVxuICAgICAgLmFsd2F5cyhmdW5jdGlvbigpIHtcbiAgICAgICAgbG9hZGluZ1ZpZXcuY2xvc2UoKTtcbiAgICAgIH0pXG4gICAgICAuZmFpbChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGZhaWxWaWV3ID0gVmlld0ZhY3RvcnkuY3JlYXRlRGlhbG9nQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9mYWlsJywge1xuICAgICAgICAgIG1zZzogJydcbiAgICAgICAgfSk7XG4gICAgICAgIGZhaWxWaWV3LmFwcGVuZFRvQm9keSgpO1xuICAgICAgfSlcbiAgICAgIC5kb25lKHRoaXMuX29wZW5DaGFuZ2VQcml2YWN5LmJpbmQodGhpcykpO1xuICB9LFxuXG4gIF9pbml0Vmlld3M6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBtb2RlbCA9IHRoaXMubW9kZWw7XG4gICAgdmFyIGdyYW50YWJsZXMgPSB0aGlzLm9yZ2FuaXphdGlvbi5ncmFudGFibGVzO1xuICAgIHZhciBwYWdlZFNlYXJjaE1vZGVsID0gbmV3IFBhZ2VkU2VhcmNoTW9kZWwoe1xuICAgICAgcGVyX3BhZ2U6IDUwLFxuICAgICAgb3JkZXI6ICduYW1lJyxcbiAgICB9KTtcbiAgICB0aGlzLl9ncmFudGFibGVzVmlldyA9IG5ldyBQYWdlZFNlYXJjaFZpZXcoe1xuICAgICAgaXNVc2VkSW5EaWFsb2c6IHRydWUsXG4gICAgICBwYWdlZFNlYXJjaE1vZGVsOiBwYWdlZFNlYXJjaE1vZGVsLFxuICAgICAgY29sbGVjdGlvbjogZ3JhbnRhYmxlcyxcbiAgICAgIGNyZWF0ZUxpc3RWaWV3OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBHcmFudGFibGVzVmlldyh7XG4gICAgICAgICAgbW9kZWw6IG1vZGVsLFxuICAgICAgICAgIGNvbGxlY3Rpb246IGdyYW50YWJsZXMsXG4gICAgICAgICAgcGFnZWRTZWFyY2hNb2RlbDogcGFnZWRTZWFyY2hNb2RlbFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwub24oJ2FsbCcsIHRoaXMuX2dyYW50YWJsZXNWaWV3LnJlbmRlciwgdGhpcy5fZ3JhbnRhYmxlc1ZpZXcpO1xuICB9LFxuXG4gIF9odG1sTm9kZTogZnVuY3Rpb24oaHRtbFN0cikge1xuICAgIHJldHVybiAkKGh0bWxTdHIpWzBdO1xuICB9LFxuXG4gIF9vcGVuQ2hhbmdlUHJpdmFjeTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHZpZXcgPSBuZXcgdGhpcy5vcHRpb25zLkNoYW5nZVByaXZhY3lWaWV3KHtcbiAgICAgIGNsZWFuX29uX2hpZGU6IHRydWUsXG4gICAgICBlbnRlcl90b19jb25maXJtOiB0cnVlLFxuICAgICAgdmlzOiB0aGlzLm9wdGlvbnMudmlzLFxuICAgICAgdXNlcjogdGhpcy51c2VyXG4gICAgfSk7XG4gICAgdmlldy5hcHBlbmRUb0JvZHkoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cblxufSk7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqIFZpZXcgZm9yIHRoZSB1c2VyIGRldGFpbHMgdG8gc2hvdyBpbiB0aGUgY29udGV4dCBvZiBhIHBlcm1pc3Npb24gaXRlbS5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgXy5lYWNoKFsncGVybWlzc2lvbicsICdpc1VzaW5nVmlzJ10sIGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIGlmIChfLmlzVW5kZWZpbmVkKHRoaXMub3B0aW9uc1tuYW1lXSkpIHRocm93IG5ldyBFcnJvcihuYW1lICsgJyBpcyByZXF1aXJlZCcpO1xuICAgIH0sIHRoaXMpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIHRoaXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2NoYW5nZV9wcml2YWN5L3NoYXJlL2RldGFpbHMnKSh7XG4gICAgICAgIHdpbGxSZXZva2VBY2Nlc3M6IHRoaXMuX3dpbGxSZXZva2VBY2Nlc3MoKSxcbiAgICAgICAgYXZhdGFyVXJsOiB0aGlzLm1vZGVsLmdldCgnYXZhdGFyX3VybCcpLFxuICAgICAgICB0aXRsZTogdGhpcy5tb2RlbC5nZXQoJ3VzZXJuYW1lJyksXG4gICAgICAgIGRlc2M6IHRoaXMuX2Rlc2MoKSxcbiAgICAgICAgcm9sZUxhYmVsOiB0aGlzLm1vZGVsLmdldCgndmlld2VyJykgPyAnVmlld2VyJyA6ICdCdWlsZGVyJ1xuICAgICAgfSlcbiAgICApO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9kZXNjOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZW1haWwgPSB0aGlzLm1vZGVsLmdldCgnZW1haWwnKVxuXG4gICAgaWYgKHRoaXMuX3dpbGxSZXZva2VBY2Nlc3MoKSkge1xuICAgICAgcmV0dXJuIGVtYWlsICsgXCIuIFVzZXIncyBtYXBzIHdpbGwgYmUgYWZmZWN0ZWRcIjtcbiAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5pc1VzaW5nVmlzKSB7XG4gICAgICByZXR1cm4gZW1haWwgKyBcIi4gVXNlciBpcyB1c2luZyB0aGlzIGRhdGFzZXRcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGVtYWlsO1xuICAgIH1cbiAgfSxcblxuICBfd2lsbFJldm9rZUFjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5pc1VzaW5nVmlzICYmICF0aGlzLm9wdGlvbnMucGVybWlzc2lvbi5oYXNSZWFkQWNjZXNzKHRoaXMubW9kZWwpO1xuICB9XG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgJCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WyckJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyckJ10gOiBudWxsKTtcbnZhciBwbHVyYWxpemVTdHIgPSByZXF1aXJlKCcuLi8uLi92aWV3X2hlbHBlcnMvcGx1cmFsaXplX3N0cmluZycpO1xuXG52YXIgRElTQUJMRURfU0FWRV9DTEFTU19OQU1FID0gJ2lzLWRpc2FibGVkJztcbnZhciBTSEFSRURfRU5USVRJRVNfU0FNUExFX1NJWkUgPSA1O1xuXG4vKipcbiAqIFZpZXcgcmVwcmVzZW50IHRoZSBzdGFydCBzY3JlZW4gd2hlbiBvcGVuaW5nIHRoZSBwcml2YWN5IGRpYWxvZy5cbiAqIERpc3BsYXkgcHJpdmFjeSBvcHRpb25zIGFuZCBwb3NzaWJseSBhIHVwZ3JhZGUgb3Igc2hhcmUgYmFubmVyIGRlcGVuZGluZyBvbiB1c2VyIHByaXZpbGVnZXMuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtb3B0aW9uJzogJ19vbkNsaWNrT3B0aW9uJyxcbiAgICAnY2xpY2sgLmpzLXNoYXJlJzogJ19vbkNsaWNrU2hhcmUnLFxuICAgICdrZXl1cCAuanMtcGFzc3dvcmQtaW5wdXQnOiAnX29uS2V5VXBQYXNzd29yZElucHV0J1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMucHJpdmFjeU9wdGlvbnMpIHRocm93IG5ldyBFcnJvcigncHJpdmFjeU9wdGlvbnMgaXMgcmVxdWlyZWQnKTtcbiAgICBpZiAoIXRoaXMub3B0aW9ucy51c2VyKSB0aHJvdyBuZXcgRXJyb3IoJ3VzZXIgaXMgcmVxdWlyZWQnKTtcbiAgICBpZiAoIXRoaXMub3B0aW9ucy52aXMpIHRocm93IG5ldyBFcnJvcigndmlzIGlzIHJlcXVpcmVkJyk7XG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2NoYW5nZV9wcml2YWN5L3N0YXJ0Jyk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gUGFzc3dvcmQgbWlnaHQgbm90IGJlIGF2YWlsYWJsZSAoaS5lLiBmb3IgY2hhbmdpbmcgcHJpdmFjeSBvZiBhIGRhdGFzZXQpXG4gICAgdmFyIHB3ZE9wdGlvbiA9IHRoaXMub3B0aW9ucy5wcml2YWN5T3B0aW9ucy5wYXNzd29yZE9wdGlvbigpO1xuICAgIHZhciBwYXNzd29yZCA9IHB3ZE9wdGlvbiA/IHB3ZE9wdGlvbi5nZXQoJ3Bhc3N3b3JkJykgOiAnJztcblxuICAgIHZhciBzZWxlY3RlZE9wdGlvbiA9IHRoaXMub3B0aW9ucy5wcml2YWN5T3B0aW9ucy5zZWxlY3RlZE9wdGlvbigpO1xuICAgIHZhciB1cGdyYWRlVXJsID0gY2RiLmNvbmZpZy5nZXQoJ3VwZ3JhZGVfdXJsJyk7XG4gICAgdmFyIHNoYXJlZEVudGl0aWVzID0gdGhpcy5vcHRpb25zLnZpcy5wZXJtaXNzaW9uLmdldFVzZXJzV2l0aEFueVBlcm1pc3Npb24oKTtcblxuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLnRlbXBsYXRlKHtcbiAgICAgICAgdmlzOiB0aGlzLm9wdGlvbnMudmlzLFxuICAgICAgICBwcml2YWN5T3B0aW9uczogdGhpcy5vcHRpb25zLnByaXZhY3lPcHRpb25zLFxuICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICAgIHNhdmVCdG5DbGFzc05hbWVzOiBzZWxlY3RlZE9wdGlvbi5jYW5TYXZlKCkgPyAnJyA6IERJU0FCTEVEX1NBVkVfQ0xBU1NfTkFNRSxcbiAgICAgICAgc2hvd1VwZ3JhZGVCYW5uZXI6IHVwZ3JhZGVVcmwgJiYgdGhpcy5vcHRpb25zLnByaXZhY3lPcHRpb25zLmFueShmdW5jdGlvbiAobykgeyByZXR1cm4gISFvLmdldCgnZGlzYWJsZWQnKTsgfSksXG4gICAgICAgIHVwZ3JhZGVVcmw6IHVwZ3JhZGVVcmwsXG4gICAgICAgIHNob3dUcmlhbDogdGhpcy5vcHRpb25zLnVzZXIuY2FuU3RhcnRUcmlhbCgpLFxuICAgICAgICBzaG93U2hhcmVCYW5uZXI6IHRoaXMub3B0aW9ucy51c2VyLm9yZ2FuaXphdGlvbixcbiAgICAgICAgc2hhcmVkRW50aXRpZXNDb3VudDogc2hhcmVkRW50aXRpZXMubGVuZ3RoLFxuICAgICAgICBwZXJzb25PclBlb3BsZVN0cjogcGx1cmFsaXplU3RyKCdwZXJzb24nLCAncGVvcGxlJywgc2hhcmVkRW50aXRpZXMubGVuZ3RoKSxcbiAgICAgICAgc2hhcmVkRW50aXRpZXNTYW1wbGVDb3VudDogU0hBUkVEX0VOVElUSUVTX1NBTVBMRV9TSVpFLFxuICAgICAgICBzaGFyZWRFbnRpdGllc1NhbXBsZTogXy50YWtlKHNoYXJlZEVudGl0aWVzLCBTSEFSRURfRU5USVRJRVNfU0FNUExFX1NJWkUpLFxuICAgICAgICBzaGFyZWRXaXRoT3JnYW5pemF0aW9uOiB0aGlzLm9wdGlvbnMudmlzLnBlcm1pc3Npb24uaXNTaGFyZWRXaXRoT3JnYW5pemF0aW9uKClcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIHRoaXMuZGVsZWdhdGVFdmVudHMoKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm9wdGlvbnMucHJpdmFjeU9wdGlvbnMuYmluZCgnY2hhbmdlOnNlbGVjdGVkIGNoYW5nZTpkaXNhYmxlZCcsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLm9wdGlvbnMucHJpdmFjeU9wdGlvbnMuYmluZCgnY2hhbmdlOnBhc3N3b3JkJywgdGhpcy5fb25DaGFuZ2VQYXNzd29yZCwgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbCh0aGlzLm9wdGlvbnMucHJpdmFjeU9wdGlvbnMpO1xuICB9LFxuXG4gIF9vbkNsaWNrT3B0aW9uOiBmdW5jdGlvbiAoZXYpIHtcbiAgICB2YXIgaSA9ICQoZXYudGFyZ2V0KS5jbG9zZXN0KCcuanMtb3B0aW9uJykuZGF0YSgnaW5kZXgnKTtcbiAgICB2YXIgb3B0aW9uID0gdGhpcy5vcHRpb25zLnByaXZhY3lPcHRpb25zLmF0KGkpO1xuXG4gICAgaWYgKCFvcHRpb24uZ2V0KCdkaXNhYmxlZCcpKSB7XG4gICAgICBvcHRpb24uc2V0KCdzZWxlY3RlZCcsIHRydWUpO1xuICAgIH1cblxuICAgIHZhciBwd2RPcHRpb24gPSB0aGlzLm9wdGlvbnMucHJpdmFjeU9wdGlvbnMucGFzc3dvcmRPcHRpb24oKTtcblxuICAgIGlmICgob3B0aW9uID09PSBwd2RPcHRpb24pICYmICghb3B0aW9uLmdldCgnZGlzYWJsZWQnKSkpIHtcbiAgICAgIHRoaXMuJCgnLmpzLXBhc3N3b3JkLWlucHV0JylcbiAgICAgICAgLnZhbCgnJykgLy8gcmVzZXQgYW55IGV4aXN0aW5nIGlucHV0IHZhbHVlXG4gICAgICAgIC5mb2N1cygpXG4gICAgICAgIC5rZXl1cCgpOyAvLyBtYW51YWxseSB0cmlnZ2VyIGEga2V5IHVwIGV2ZW50IHRvIGNoYW5nZSBwYXNzd29yZCBzdGF0ZVxuICAgIH0gZWxzZSBpZiAocHdkT3B0aW9uKSB7IC8vIFBhc3N3b3JkIG1pZ2h0IG5vdCBiZSBhdmFpbGFibGUgKGkuZS4gZm9yIGNoYW5naW5nIHByaXZhY3kgb2YgYSBkYXRhc2V0KVxuICAgICAgdGhpcy4kKCcuanMtcGFzc3dvcmQtaW5wdXQnKS52YWwocHdkT3B0aW9uLmdldCgncGFzc3dvcmQnKSk7XG4gICAgfVxuICB9LFxuXG4gIF9vbkNoYW5nZVBhc3N3b3JkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy4kKCcub2snKS50b2dnbGVDbGFzcyhESVNBQkxFRF9TQVZFX0NMQVNTX05BTUUsICF0aGlzLm9wdGlvbnMucHJpdmFjeU9wdGlvbnMuc2VsZWN0ZWRPcHRpb24oKS5jYW5TYXZlKCkpO1xuICB9LFxuXG4gIF9vbktleVVwUGFzc3dvcmRJbnB1dDogZnVuY3Rpb24gKGV2KSB7XG4gICAgdGhpcy5vcHRpb25zLnByaXZhY3lPcHRpb25zLnBhc3N3b3JkT3B0aW9uKCkuc2V0KCdwYXNzd29yZCcsIGV2LnRhcmdldC52YWx1ZSk7XG4gIH0sXG5cbiAgX29uQ2xpY2tTaGFyZTogZnVuY3Rpb24gKGV2KSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZXYpO1xuICAgIHRoaXMudHJpZ2dlcignY2xpY2tlZFNoYXJlJyk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgRGF0YXNldHNWaWV3ID0gcmVxdWlyZSgnLi9saXN0aW5nL2RhdGFzZXRzX3ZpZXcnKTtcbnZhciBJbXBvcnRzVmlldyA9IHJlcXVpcmUoJy4vbGlzdGluZy9pbXBvcnRzX3ZpZXcnKTtcblxuLyoqXG4gKiAgQ3JlYXRlIGxpc3Rpbmcgdmlld1xuICpcbiAqICBJdCB3aWxsIGRpc3BsYXkgYWxsIHRoZSBwb3NzaWJpbGl0aWVzIHRvIHNlbGVjdFxuICogIGFueSBvZiB5b3VyIGN1cnJlbnQgZGF0YXNldHMgb3IgY29ubmVjdCBhIG5ldyBkYXRhc2V0LlxuICpcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgY2xhc3NOYW1lOiAnQ3JlYXRlRGlhbG9nLWxpc3RpbmcgQ3JlYXRlRGlhbG9nLWxpc3RpbmctLW5vUGFkZGluZ1RvcCcsXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5vcHRpb25zLnVzZXI7XG4gICAgdGhpcy5jcmVhdGVNb2RlbCA9IHRoaXMub3B0aW9ucy5jcmVhdGVNb2RlbDtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL3ZpZXdzL2NyZWF0ZS9jcmVhdGVfbGlzdGluZycpO1xuXG4gICAgLy8gQnVnIHdpdGggYmluZGluZy4uLiBkbyBub3Qgd29yayB3aXRoIHRoZSB1c3VhbCBvbmUgZm9yIHNvbWUgcmVhc29uIDooXG4gICAgdGhpcy5jcmVhdGVNb2RlbC5iaW5kKCdjaGFuZ2U6bGlzdGluZycsIHRoaXMuX29uQ2hhbmdlTGlzdGluZy5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMuY3JlYXRlTW9kZWwpO1xuICAgIHRoaXMuX29uQ2hhbmdlTGlzdGluZygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy4kZWwuaHRtbCh0aGlzLnRlbXBsYXRlKCkpO1xuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9vbkNoYW5nZUxpc3Rpbmc6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLmxpc3RpbmdQYW5lKSB7XG4gICAgICB0aGlzLmxpc3RpbmdQYW5lLmFjdGl2ZSh0aGlzLmNyZWF0ZU1vZGVsLmdldCgnbGlzdGluZycpKTtcbiAgICB9XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgLy8gTGlzdGluZyBjb250ZW50IHBhbmVcbiAgICB0aGlzLmxpc3RpbmdQYW5lID0gbmV3IGNkYi51aS5jb21tb24uVGFiUGFuZSh7XG4gICAgICBlbDogdGhpcy4kKFwiLkxpc3RpbmdDb250ZW50XCIpXG4gICAgfSk7XG4gICAgdGhpcy5hZGRWaWV3KHRoaXMubGlzdGluZ1BhbmUpO1xuXG4gICAgLy8gRGF0YXNldHMgdmlld1xuICAgIHZhciBkYXRhc2V0c1ZpZXcgPSBuZXcgRGF0YXNldHNWaWV3KHtcbiAgICAgIGRlZmF1bHRVcmw6IHRoaXMudXNlci52aWV3VXJsKCkuZGFzaGJvYXJkKCkuZGF0YXNldHMoKSxcbiAgICAgIHVzZXI6IHRoaXMudXNlcixcbiAgICAgIGNyZWF0ZU1vZGVsOiB0aGlzLmNyZWF0ZU1vZGVsLFxuICAgICAgcm91dGVyTW9kZWw6IHRoaXMuY3JlYXRlTW9kZWwudmlzRmV0Y2hNb2RlbCxcbiAgICAgIGNvbGxlY3Rpb246IHRoaXMuY3JlYXRlTW9kZWwuY29sbGVjdGlvblxuICAgIH0pO1xuXG4gICAgZGF0YXNldHNWaWV3LnJlbmRlcigpO1xuICAgIHRoaXMuX2FkZExpc3RpbmdQYW5lKCdkYXRhc2V0cycsIGRhdGFzZXRzVmlldyk7XG5cbiAgICAvLyBJbXBvcnRzIHZpZXdcbiAgICBpZiAodGhpcy51c2VyLmNhbkNyZWF0ZURhdGFzZXRzKCkpIHtcbiAgICAgIHZhciBpbXBvcnRzVmlldyA9IG5ldyBJbXBvcnRzVmlldyh7XG4gICAgICAgIHVzZXI6IHRoaXMudXNlcixcbiAgICAgICAgY3JlYXRlTW9kZWw6IHRoaXMuY3JlYXRlTW9kZWxcbiAgICAgIH0pO1xuXG4gICAgICBpbXBvcnRzVmlldy5yZW5kZXIoKTtcbiAgICAgIHRoaXMuX2FkZExpc3RpbmdQYW5lKCdpbXBvcnQnLCBpbXBvcnRzVmlldyk7XG4gICAgfVxuICB9LFxuXG4gIF9hZGRMaXN0aW5nUGFuZTogZnVuY3Rpb24obmFtZSwgdmlldykge1xuICAgIHRoaXMubGlzdGluZ1BhbmUuYWRkVGFiKG5hbWUsIHZpZXcsIHtcbiAgICAgIGFjdGl2ZTogdGhpcy5jcmVhdGVNb2RlbC5nZXQoJ2xpc3RpbmcnKSA9PT0gbmFtZVxuICAgIH0pO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogTWFuYWdlcyBpZiB1cGNvbWluZyBpbXBvcnQgc2hvdWxkIGd1ZXNzIG9yIG5vdC5cbiAqIEV4cGVjdGVkIHRvIGJlIHJlbmRlcmVkIGluIHRoZSBmb290ZXIgb2YgYSBjcmVhdGUgZGlhbG9nLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2sgLmpzLXRvZ2dsZSc6ICdfdG9nZ2xlJ1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLmNyZWF0ZU1vZGVsID0gdGhpcy5vcHRpb25zLmNyZWF0ZU1vZGVsO1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9jcmVhdGUvZm9vdGVyL2d1ZXNzaW5nX3RvZ2dsZXInKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBodG1sU3RyID0gJyc7XG4gICAgaWYgKHRoaXMuY3JlYXRlTW9kZWwuc2hvd0d1ZXNzaW5nVG9nZ2xlcigpKSB7XG4gICAgICBodG1sU3RyID0gdGhpcy50ZW1wbGF0ZSh7XG4gICAgICAgIGlzR3Vlc3NpbmdFbmFibGVkOiB0aGlzLm1vZGVsLmdldCgnZ3Vlc3NpbmcnKSxcbiAgICAgICAgaW1wb3J0U3RhdGU6IHRoaXMuY3JlYXRlTW9kZWwuZ2V0SW1wb3J0U3RhdGUoKSxcbiAgICAgICAgaXNVcGxvYWRWYWxpZDogdGhpcy5jcmVhdGVNb2RlbC51cGxvYWQuaXNWYWxpZFRvVXBsb2FkKCksXG4gICAgICAgIGN1c3RvbUhvc3RlZDogY2RiLmNvbmZpZy5nZXQoJ2NhcnRvZGJfY29tX2hvc3RlZCcpLFxuICAgICAgICBpc1R3aXR0ZXJEZXByZWNhdGVkRm9yVXNlcjogIXRoaXMudXNlci5oYXNPd25Ud2l0dGVyQ3JlZGVudGlhbHMoKSAgICAgICAgXG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy4kZWwuaHRtbChodG1sU3RyKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNyZWF0ZU1vZGVsLmJpbmQoJ2NoYW5nZScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMuY3JlYXRlTW9kZWwpO1xuICB9LFxuXG4gIF90b2dnbGU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB2YWx1ZSA9ICF0aGlzLm1vZGVsLmdldCgnZ3Vlc3NpbmcnKTtcbiAgICB0aGlzLm1vZGVsLnNldCgnZ3Vlc3NpbmcnLCB2YWx1ZSk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgJCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WyckJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyckJ10gOiBudWxsKTtcblxuLyoqXG4gKiAgQ2hhbmdlIHRoZSBwcml2YWN5IG9mIHRoZSBuZXcgZGF0YXNldC5cbiAqICAtIElmIHRoZSB1c2VyIGNhbid0IGNoYW5nZSB0aGUgcHJpdmFjeSwgaXQgd2lsbCByZWZlciB0byB0aGUgdXBncmFkZSBwYWdlXG4gKiAgIHVubGVzcyBhcHAgaXMgdGhlIFwib3BlbiBzb3VyY2VcIiB2ZXJzaW9uXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuICBldmVudHM6IHtcbiAgICAnY2xpY2snOiAnX29uQ2xpY2snXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLmNyZWF0ZU1vZGVsID0gdGhpcy5vcHRpb25zLmNyZWF0ZU1vZGVsO1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9jcmVhdGUvZm9vdGVyL3ByaXZhY3lfdG9nZ2xlcl90ZW1wbGF0ZScpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuICAgIHRoaXMuJGVsLmVtcHR5KCk7XG5cbiAgICBpZiAodGhpcy5jcmVhdGVNb2RlbC5zaG93UHJpdmFjeVRvZ2dsZXIoKSkge1xuICAgICAgdmFyIGNhbkNoYW5nZVByaXZhY3kgPSB0aGlzLnVzZXIuY2FuQ3JlYXRlUHJpdmF0ZURhdGFzZXRzKCk7XG4gICAgICB2YXIgcHJpdmFjeSA9IHRoaXMubW9kZWwuZ2V0KCdwcml2YWN5Jyk7XG4gICAgICB2YXIgbmV4dFByaXZhY3kgPSBwcml2YWN5ID09PSAnUFVCTElDJyA/ICdQUklWQVRFJyA6ICdQVUJMSUMnO1xuICAgICAgdmFyIGljb24gPSBwcml2YWN5ID09PSAnUFVCTElDJyA/ICd1bmxvY2snIDogJ2xvY2snO1xuICAgICAgdmFyIHVwZ3JhZGVVcmwgPSBjZGIuY29uZmlnLmdldCgndXBncmFkZV91cmwnKSB8fCB3aW5kb3cudXBncmFkZV91cmw7XG4gICAgICB2YXIgY2FuVXBncmFkZSA9ICFjZGIuY29uZmlnLmdldCgnY2FydG9kYl9jb21faG9zdGVkJykgJiYgIWNhbkNoYW5nZVByaXZhY3kgJiYgdXBncmFkZVVybDtcbiAgICAgIHZhciBjb25uZWN0RGF0YXNldDtcblxuICAgICAgaWYgKHRoaXMuY3JlYXRlTW9kZWwpIHtcbiAgICAgICAgdmFyIG9wdGlvbiA9IHRoaXMuY3JlYXRlTW9kZWwuZ2V0T3B0aW9uICYmIHRoaXMuY3JlYXRlTW9kZWwuZ2V0T3B0aW9uKCk7XG4gICAgICAgIHZhciBsaXN0aW5nU3RhdGUgPSB0aGlzLmNyZWF0ZU1vZGVsLmdldCgnbGlzdGluZycpO1xuICAgICAgICB2YXIgaW1wb3J0U3RhdGUgPSB0aGlzLmNyZWF0ZU1vZGVsLmdldEltcG9ydFN0YXRlICYmIHRoaXMuY3JlYXRlTW9kZWwuZ2V0SW1wb3J0U3RhdGUoKTtcblxuICAgICAgICBjb25uZWN0RGF0YXNldCA9IG9wdGlvbiAmJiBvcHRpb24gIT09ICdsb2FkaW5nJyAmJlxuICAgICAgICAgIG9wdGlvbiA9PT0gJ2xpc3RpbmcnICYmXG4gICAgICAgICAgbGlzdGluZ1N0YXRlID09PSAnaW1wb3J0JyAmJlxuICAgICAgICAgIHR5cGVvZiBpbXBvcnRTdGF0ZSA9PT0gJ3N0cmluZycgJiYgaW1wb3J0U3RhdGUgIT09ICdzY3JhdGNoJztcbiAgICAgIH1cblxuICAgICAgdGhpcy4kZWwuaHRtbChcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSh7XG4gICAgICAgICAgcHJpdmFjeTogcHJpdmFjeSxcbiAgICAgICAgICBpc0Rpc2FibGVkOiAhY2FuQ2hhbmdlUHJpdmFjeSxcbiAgICAgICAgICBjYW5VcGdyYWRlOiBjYW5VcGdyYWRlLFxuICAgICAgICAgIG5leHRQcml2YWN5OiBuZXh0UHJpdmFjeSxcbiAgICAgICAgICB1cGdyYWRlVXJsOiB1cGdyYWRlVXJsLFxuICAgICAgICAgIGljb246IGljb24sXG4gICAgICAgICAgY29ubmVjdERhdGFzZXQ6IGNvbm5lY3REYXRhc2V0XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICB0aGlzLl9pbml0Vmlld3MoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6cHJpdmFjeScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gVG9vbHRpcFxuICAgIHRoaXMuYWRkVmlldyhcbiAgICAgIG5ldyBjZGIuY29tbW9uLlRpcHN5VG9vbHRpcCh7XG4gICAgICAgIGVsOiB0aGlzLiQoJy5qcy10b2dnbGVyJyksXG4gICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgIHRpdGxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuICQodGhpcykuYXR0cignZGF0YS10aXRsZScpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG4gIH0sXG5cbiAgX29uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy51c2VyLmNhbkNyZWF0ZVByaXZhdGVEYXRhc2V0cygpKSB7XG4gICAgICB2YXIgcHJpdmFjeSA9IHRoaXMubW9kZWwuZ2V0KCdwcml2YWN5Jyk7XG4gICAgICB0aGlzLm1vZGVsLnNldCgncHJpdmFjeScsIHByaXZhY3kgPT09ICdQVUJMSUMnID8gJ1BSSVZBVEUnIDogJ1BVQkxJQycpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuY2RiLmFkbWluID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydhZG1pbiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ2FkbWluJ10gOiBudWxsKTtcbnZhciByYW5kb21RdW90ZSA9IHJlcXVpcmUoJy4uLy4uLy4uLy4uLy4uL2NvbW1vbi92aWV3X2hlbHBlcnMvcmFuZG9tX3F1b3RlJyk7XG5cbi8qXG4gKiAgQ29udGVudCByZXN1bHQgZGVmYXVsdCB2aWV3XG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy1jb25uZWN0JzogJ19vbkNvbm5lY3RDbGljaydcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMub3B0aW9ucy5kZWZhdWx0VXJsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2RlZmF1bHRVcmwgaXMgcmVxdWlyZWQnKVxuICAgIH1cbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLnJvdXRlck1vZGVsID0gdGhpcy5vcHRpb25zLnJvdXRlck1vZGVsO1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKHRoaXMub3B0aW9ucy50ZW1wbGF0ZSk7XG5cbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB0eXBlID0gdGhpcy5yb3V0ZXJNb2RlbC5nZXQoJ2NvbnRlbnRfdHlwZScpO1xuXG4gICAgdGhpcy4kZWwuaHRtbCh0aGlzLnRlbXBsYXRlKHtcbiAgICAgIGRlZmF1bHRVcmw6ICAgICB0aGlzLm9wdGlvbnMuZGVmYXVsdFVybCxcbiAgICAgIHBhZ2U6ICAgICAgICAgICB0aGlzLnJvdXRlck1vZGVsLmdldCgncGFnZScpLFxuICAgICAgdGFnOiAgICAgICAgICAgIHRoaXMucm91dGVyTW9kZWwuZ2V0KCd0YWcnKSxcbiAgICAgIHE6ICAgICAgICAgICAgICB0aGlzLnJvdXRlck1vZGVsLmdldCgncScpLFxuICAgICAgc2hhcmVkOiAgICAgICAgIHRoaXMucm91dGVyTW9kZWwuZ2V0KCdzaGFyZWQnKSxcbiAgICAgIGxvY2tlZDogICAgICAgICB0aGlzLnJvdXRlck1vZGVsLmdldCgnbG9ja2VkJyksXG4gICAgICBsaWJyYXJ5OiAgICAgICAgdGhpcy5yb3V0ZXJNb2RlbC5nZXQoJ2xpYnJhcnknKSxcbiAgICAgIHF1b3RlOiAgICAgICAgICByYW5kb21RdW90ZSgpLFxuICAgICAgdHlwZTogICAgICAgICAgIHR5cGUsXG4gICAgICB0b3RhbEl0ZW1zOiAgICAgdGhpcy5jb2xsZWN0aW9uLnNpemUoKSxcbiAgICAgIHRvdGFsRW50cmllczogICB0aGlzLmNvbGxlY3Rpb24udG90YWxfZW50cmllc1xuICAgIH0pKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucm91dGVyTW9kZWwuYmluZCgnY2hhbmdlJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMuY29sbGVjdGlvbi5iaW5kKCdyZXNldCcsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMucm91dGVyTW9kZWwpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5jb2xsZWN0aW9uKTtcbiAgfSxcblxuICBfb25Db25uZWN0Q2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudHJpZ2dlcignY29ubmVjdERhdGFzZXQnLCB0aGlzKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIG1vbWVudCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydtb21lbnQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ21vbWVudCddIDogbnVsbCk7XG52YXIgVXRpbHMgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ11bJ1V0aWxzJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXVsnVXRpbHMnXSA6IG51bGwpO1xudmFyIHBsdXJhbGl6ZVN0cmluZyA9IHJlcXVpcmUoJy4uLy4uLy4uLy4uL3ZpZXdfaGVscGVycy9wbHVyYWxpemVfc3RyaW5nJyk7XG5cbi8qKlxuICogVmlldyByZXByZXNlbnRpbmcgYW4gaXRlbSBpbiB0aGUgbGlzdCB1bmRlciBkYXRhc2V0cyByb3V0ZS5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgdGFnTmFtZTogJ2xpJyxcbiAgY2xhc3NOYW1lOiAnRGF0YXNldHNMaXN0LWl0ZW0gRGF0YXNldHNMaXN0LWl0ZW0tLXNlbGVjdGFibGUnLFxuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtdGFnLWxpbmsnOiAnX29uVGFnQ2xpY2snLFxuICAgICdjbGljayc6ICdfdG9nZ2xlU2VsZWN0ZWQnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5vcHRpb25zLnVzZXI7XG4gICAgdGhpcy5yb3V0ZXJNb2RlbCA9IHRoaXMub3B0aW9ucy5jcmVhdGVNb2RlbC52aXNGZXRjaE1vZGVsO1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vdmlld3MvY3JlYXRlL2xpc3RpbmcvZGF0YXNldF9pdGVtJyk7XG4gICAgdGhpcy50YWJsZSA9IG5ldyBjZGIuYWRtaW4uQ2FydG9EQlRhYmxlTWV0YWRhdGEodGhpcy5tb2RlbC5nZXQoJ3RhYmxlJykpO1xuXG4gICAgdGhpcy5tb2RlbC5vbignY2hhbmdlJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHZpcyA9IHRoaXMubW9kZWw7XG4gICAgdmFyIHRhYmxlID0gdGhpcy50YWJsZTtcbiAgICB2YXIgdGFncyA9IHZpcy5nZXQoJ3RhZ3MnKSB8fCBbXTtcbiAgICB2YXIgZGVzY3JpcHRpb24gPSB2aXMuZ2V0KCdkZXNjcmlwdGlvbicpICYmIFV0aWxzLnN0cmlwSFRNTChtYXJrZG93bi50b0hUTUwodmlzLmdldCgnZGVzY3JpcHRpb24nKSkpIHx8ICcnO1xuXG4gICAgdmFyIGQgPSB7XG4gICAgICBpc1Jhc3RlcjogICAgICAgICAgICAgICAgdmlzLmdldCgna2luZCcpID09PSAncmFzdGVyJyxcbiAgICAgIGdlb21ldHJ5VHlwZTogICAgICAgICAgICB0YWJsZS5nZW9tQ29sdW1uVHlwZXMoKS5sZW5ndGggPiAwID8gdGFibGUuZ2VvbUNvbHVtblR5cGVzKClbMF0gOiAnJyxcbiAgICAgIHRpdGxlOiAgICAgICAgICAgICAgICAgICB2aXMuZ2V0KCduYW1lJyksXG4gICAgICBpc093bmVyOiAgICAgICAgICAgICAgICAgdmlzLnBlcm1pc3Npb24uaXNPd25lcih0aGlzLnVzZXIpLFxuICAgICAgb3duZXI6ICAgICAgICAgICAgICAgICAgIHZpcy5wZXJtaXNzaW9uLm93bmVyLnJlbmRlckRhdGEodGhpcy51c2VyKSxcbiAgICAgIHNob3dQZXJtaXNzaW9uSW5kaWNhdG9yOiAhdmlzLnBlcm1pc3Npb24uaGFzV3JpdGVBY2Nlc3ModGhpcy51c2VyKSxcbiAgICAgIGRlc2NyaXB0aW9uOiAgICAgICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHByaXZhY3k6ICAgICAgICAgICAgICAgICB2aXMuZ2V0KCdwcml2YWN5JykudG9Mb3dlckNhc2UoKSxcbiAgICAgIHRpbWVEaWZmOiAgICAgICAgICAgICAgICBtb21lbnQodmlzLmdldCgndXBkYXRlZF9hdCcpKS5mcm9tTm93KCksXG4gICAgICB0YWdzOiAgICAgICAgICAgICAgICAgICAgdGFncyxcbiAgICAgIHRhZ3NDb3VudDogICAgICAgICAgICAgICB0YWdzLmxlbmd0aCxcbiAgICAgIG1heFRhZ3NUb1Nob3c6ICAgICAgICAgICAzLFxuICAgICAgcm93Q291bnQ6ICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgIGRhdGFzZXRTaXplOiAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICBzeW5jU3RhdHVzOiAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgc3luY1JhbkF0OiAgICAgICAgICAgICAgIHVuZGVmaW5lZFxuICAgIH07XG5cbiAgICB2YXIgcm93Q291bnQgPSB0YWJsZS5nZXQoJ3Jvd19jb3VudCcpO1xuICAgIGlmIChyb3dDb3VudCA+PSAwKSB7XG4gICAgICBkLnJvd0NvdW50ID0gKCByb3dDb3VudCA8IDEwMDAwID8gVXRpbHMuZm9ybWF0TnVtYmVyKHJvd0NvdW50KSA6IFV0aWxzLnJlYWRpemFibGVOdW1iZXIocm93Q291bnQpICk7XG4gICAgICBkLnBsdXJhbGl6ZWRSb3dzID0gcGx1cmFsaXplU3RyaW5nKCdSb3cnLCByb3dDb3VudCk7XG4gICAgfVxuXG4gICAgdmFyIGRhdGFzZXRTaXplID0gdGFibGUuZ2V0KCdzaXplJyk7XG4gICAgaWYgKGRhdGFzZXRTaXplID49IDApIHtcbiAgICAgIGQuZGF0YXNldFNpemUgPSBVdGlscy5yZWFkYWJsaXplQnl0ZXMoZGF0YXNldFNpemUsIHRydWUpO1xuICAgIH1cblxuICAgIGlmICghXy5pc0VtcHR5KHZpcy5nZXQoXCJzeW5jaHJvbml6YXRpb25cIikpKSB7XG4gICAgICBkLnN5bmNSYW5BdCA9IG1vbWVudCh2aXMuZ2V0KFwic3luY2hyb25pemF0aW9uXCIpLnJhbl9hdCB8fCBuZXcgRGF0ZSgpKS5mcm9tTm93KCk7XG4gICAgICBkLnN5bmNTdGF0dXMgPSB2aXMuZ2V0KFwic3luY2hyb25pemF0aW9uXCIpLnN0YXRlO1xuICAgIH1cblxuICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZShkKSk7XG5cbiAgICB0aGlzLl9yZW5kZXJUb29sdGlwcygpO1xuXG4gICAgLy8gSXRlbSBzZWxlY3RlZD9cbiAgICB0aGlzLiRlbFsgdmlzLmdldCgnc2VsZWN0ZWQnKSA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnIF0oJ2lzLS1zZWxlY3RlZCcpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX3JlbmRlclRvb2x0aXBzOiBmdW5jdGlvbigpIHtcbiAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLm1vZGVsLmdldChcInN5bmNocm9uaXphdGlvblwiKSkpIHtcbiAgICAgIHRoaXMuYWRkVmlldyhcbiAgICAgICAgbmV3IGNkYi5jb21tb24uVGlwc3lUb29sdGlwKHtcbiAgICAgICAgICBlbDogdGhpcy4kKCcuRGF0YXNldHNMaXN0LWl0ZW1TdGF0dXMnKSxcbiAgICAgICAgICB0aXRsZTogZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgcmV0dXJuICQodGhpcykuYXR0cignZGF0YS10aXRsZScpXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKVxuICAgIH1cbiAgfSxcblxuICBfb25UYWdDbGljazogZnVuY3Rpb24oZXYpIHtcbiAgICB2YXIgdGFnID0gJChldi50YXJnZXQpLnZhbCgpO1xuXG4gICAgaWYgKHRhZykge1xuICAgICAgdGhpcy5yb3V0ZXJNb2RlbC5zZXQoJ3RhZycsIHRhZyk7XG4gICAgfVxuICB9LFxuXG4gIF90b2dnbGVTZWxlY3RlZDogZnVuY3Rpb24oZXYpIHtcbiAgICAvLyBMZXQgbGlua3MgdXNlIGRlZmF1bHQgYmVoYXZpb3VyXG4gICAgaWYgKGV2LnRhcmdldC50YWdOYW1lICE9PSAnQScpIHtcbiAgICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuY3JlYXRlTW9kZWwuY2FuU2VsZWN0KHRoaXMubW9kZWwpKSB7XG4gICAgICAgIHRoaXMubW9kZWwuc2V0KCdzZWxlY3RlZCcsICF0aGlzLm1vZGVsLmdldCgnc2VsZWN0ZWQnKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIFBhZ2luYXRpb25Nb2RlbCA9IHJlcXVpcmUoJy4uLy4uLy4uLy4uL3ZpZXdzL3BhZ2luYXRpb24vbW9kZWwnKTtcbnZhciBQYWdpbmF0aW9uVmlldyA9IHJlcXVpcmUoJy4uLy4uLy4uLy4uL3ZpZXdzL3BhZ2luYXRpb24vdmlldycpO1xuXG5cbi8qKlxuICogUmVzcG9uc2libGUgZm9yIHRoZSBkYXRhc2V0cyBwYWdpbmF0b3JcbiAqICBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19cbiAqIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFnZSAyIG9mIDQyIFsxXSAyIFszXVs0XVs1XSAgfFxuICogfF9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX3xcbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgY2xhc3NOYW1lOiAnRGF0YXNldHNQYWdpbmF0b3InLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucm91dGVyTW9kZWwgPSB0aGlzLm9wdGlvbnMucm91dGVyTW9kZWw7XG4gICAgdGhpcy5jb2xsZWN0aW9uID0gdGhpcy5vcHRpb25zLmNvbGxlY3Rpb247XG4gICAgdGhpcy5tb2RlbCA9IG5ldyBQYWdpbmF0aW9uTW9kZWwoe1xuICAgICAgY3VycmVudF9wYWdlOiB0aGlzLnJvdXRlck1vZGVsLmdldCgncGFnZScpXG4gICAgfSk7XG5cbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICB0aGlzLl9pbml0Vmlld3MoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuICAgIHRoaXMuJGVsLmFwcGVuZCh0aGlzLnBhZ2luYXRpb25WaWV3LnJlbmRlcigpLmVsKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpjdXJyZW50X3BhZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMucm91dGVyTW9kZWwuc2V0KCdwYWdlJywgdGhpcy5tb2RlbC5nZXQoJ2N1cnJlbnRfcGFnZScpKTtcbiAgICB9LCB0aGlzKTtcbiAgICB0aGlzLmNvbGxlY3Rpb24uYmluZCgncmVzZXQnLCB0aGlzLl91cGRhdGVQYWdpbmF0aW9uTW9kZWxCeUNvbGxlY3Rpb24sIHRoaXMpO1xuICAgIHRoaXMucm91dGVyTW9kZWwuYmluZCgnY2hhbmdlOnBhZ2UnLCB0aGlzLl91cGRhdGVQYWdpbmF0aW9uTW9kZWxCeVJvdXRlck1vZGVsLCB0aGlzKTtcblxuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5yb3V0ZXJNb2RlbCk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbCh0aGlzLmNvbGxlY3Rpb24pO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5tb2RlbCk7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wYWdpbmF0aW9uVmlldyA9IG5ldyBQYWdpbmF0aW9uVmlldyh7XG4gICAgICBtb2RlbDogdGhpcy5tb2RlbFxuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLnBhZ2luYXRpb25WaWV3KTtcbiAgfSxcblxuICBfdXBkYXRlUGFnaW5hdGlvbk1vZGVsQnlDb2xsZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLnNldCh7XG4gICAgICBwZXJfcGFnZTogICAgdGhpcy5jb2xsZWN0aW9uLm9wdGlvbnMuZ2V0KCdwZXJfcGFnZScpLFxuICAgICAgdG90YWxfY291bnQ6IHRoaXMuY29sbGVjdGlvbi50b3RhbF9lbnRyaWVzXG4gICAgfSk7XG4gIH0sXG5cbiAgX3VwZGF0ZVBhZ2luYXRpb25Nb2RlbEJ5Um91dGVyTW9kZWw6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuc2V0KCdjdXJyZW50X3BhZ2UnLCB0aGlzLnJvdXRlck1vZGVsLmdldCgncGFnZScpKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG52YXIgRGF0YXNldEl0ZW0gPSByZXF1aXJlKCcuL2RhdGFzZXRfaXRlbV92aWV3Jyk7XG52YXIgVXRpbHMgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ11bJ1V0aWxzJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXVsnVXRpbHMnXSA6IG51bGwpO1xudmFyIFVwbG9hZENvbmZpZyA9IHJlcXVpcmUoJy4uLy4uLy4uLy4uL2JhY2tncm91bmRfcG9sbGluZy9tb2RlbHMvdXBsb2FkX2NvbmZpZycpO1xudmFyIHBsdXJhbGl6ZVN0cmluZyA9IHJlcXVpcmUoJy4uLy4uLy4uLy4uL3ZpZXdfaGVscGVycy9wbHVyYWxpemVfc3RyaW5nJyk7XG5cbi8qKlxuICogIFJlbW90ZSBkYXRhc2V0IGl0ZW0gdmlld1xuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IERhdGFzZXRJdGVtLmV4dGVuZCh7XG5cbiAgdGFnTmFtZTogJ2xpJyxcbiAgY2xhc3NOYW1lOiAnRGF0YXNldHNMaXN0LWl0ZW0nLFxuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtdGFnLWxpbmsnOiAnX29uVGFnQ2xpY2snLFxuICAgICdjbGljayc6ICdfdG9nZ2xlU2VsZWN0ZWQnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vdmlld3MvY3JlYXRlL2xpc3RpbmcvcmVtb3RlX2RhdGFzZXRfaXRlbScpO1xuICAgIHRoaXMudGFibGUgPSBuZXcgY2RiLmFkbWluLkNhcnRvREJUYWJsZU1ldGFkYXRhKHRoaXMubW9kZWwuZ2V0KCdleHRlcm5hbF9zb3VyY2UnKSk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgdmlzID0gdGhpcy5tb2RlbDtcbiAgICB2YXIgdGFibGUgPSB0aGlzLnRhYmxlO1xuICAgIHZhciB0YWdzID0gdmlzLmdldCgndGFncycpIHx8IFtdO1xuICAgIHZhciBkZXNjcmlwdGlvbiA9IHZpcy5nZXQoJ2Rlc2NyaXB0aW9uJykgJiYgVXRpbHMuc3RyaXBIVE1MKG1hcmtkb3duLnRvSFRNTCh2aXMuZ2V0KCdkZXNjcmlwdGlvbicpKSkgfHwgJyc7XG4gICAgdmFyIHNvdXJjZSA9IHZpcy5nZXQoJ3NvdXJjZScpICYmIG1hcmtkb3duLnRvSFRNTCh2aXMuZ2V0KCdzb3VyY2UnKSkgfHwgJyc7XG5cbiAgICB2YXIgZCA9IHtcbiAgICAgIGlzUmFzdGVyOiAgICAgICAgICAgICAgICB2aXMuZ2V0KCdraW5kJykgPT09ICdyYXN0ZXInLFxuICAgICAgZ2VvbWV0cnlUeXBlOiAgICAgICAgICAgIHRhYmxlLmdlb21Db2x1bW5UeXBlcygpLmxlbmd0aCA+IDAgPyB0YWJsZS5nZW9tQ29sdW1uVHlwZXMoKVswXSA6ICcnLFxuICAgICAgdGl0bGU6ICAgICAgICAgICAgICAgICAgIHZpcy5nZXQoJ2Rpc3BsYXlfbmFtZScpIHx8IHZpcy5nZXQoJ25hbWUnKSxcbiAgICAgIHNvdXJjZTogICAgICAgICAgICAgICAgICBzb3VyY2UsXG4gICAgICBkZXNjcmlwdGlvbjogICAgICAgICAgICAgZGVzY3JpcHRpb24sXG4gICAgICB0aW1lRGlmZjogICAgICAgICAgICAgICAgbW9tZW50KHZpcy5nZXQoJ3VwZGF0ZWRfYXQnKSkuZnJvbU5vdygpLFxuICAgICAgdGFnczogICAgICAgICAgICAgICAgICAgIHRhZ3MsXG4gICAgICB0YWdzQ291bnQ6ICAgICAgICAgICAgICAgdGFncy5sZW5ndGgsXG4gICAgICByb3V0ZXJNb2RlbDogICAgICAgICAgICAgdGhpcy5yb3V0ZXJNb2RlbCxcbiAgICAgIG1heFRhZ3NUb1Nob3c6ICAgICAgICAgICAzLFxuICAgICAgY2FuSW1wb3J0RGF0YXNldDogICAgICAgIHRoaXMuX2NhbkltcG9ydERhdGFzZXQoKSxcbiAgICAgIHJvd0NvdW50OiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICBkYXRhc2V0U2l6ZTogICAgICAgICAgICAgdW5kZWZpbmVkXG4gICAgfTtcblxuICAgIHZhciByb3dDb3VudCA9IHRhYmxlLmdldCgncm93X2NvdW50Jyk7XG4gICAgaWYgKHJvd0NvdW50ID49IDApIHtcbiAgICAgIGQucm93Q291bnQgPSAoIHJvd0NvdW50IDwgMTAwMDAgPyBVdGlscy5mb3JtYXROdW1iZXIocm93Q291bnQpIDogVXRpbHMucmVhZGl6YWJsZU51bWJlcihyb3dDb3VudCkgKTtcbiAgICAgIGQucGx1cmFsaXplZFJvd3MgPSBwbHVyYWxpemVTdHJpbmcoJ1JvdycsIHJvd0NvdW50KTtcbiAgICB9XG5cbiAgICB2YXIgZGF0YXNldFNpemUgPSB0YWJsZS5nZXQoJ3NpemUnKTtcbiAgICBpZiAoZGF0YXNldFNpemUgPj0gMCkge1xuICAgICAgZC5kYXRhc2V0U2l6ZSA9IFV0aWxzLnJlYWRhYmxpemVCeXRlcyhcbiAgICAgICAgZGF0YXNldFNpemUsXG4gICAgICAgIGRhdGFzZXRTaXplLnRvU3RyaW5nKCkubGVuZ3RoID4gOSA/IGZhbHNlIDogdHJ1ZVxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLiRlbC5odG1sKHRoaXMudGVtcGxhdGUoZCkpO1xuICAgIHRoaXMuX3NldEl0ZW1DbGFzc2VzKCk7XG4gICAgdGhpcy5fcmVuZGVyVG9vbHRpcHMoKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9zZXRJdGVtQ2xhc3NlczogZnVuY3Rpb24oKSB7XG4gICAgLy8gSXRlbSBzZWxlY3RlZD9cbiAgICB0aGlzLiRlbFsgdGhpcy5tb2RlbC5nZXQoJ3NlbGVjdGVkJykgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJyBdKCdpcy0tc2VsZWN0ZWQnKTtcbiAgICAvLyBDaGVjayBpZiBpdCBpcyBzZWxlY3RhYmxlXG4gICAgdGhpcy4kZWxbIHRoaXMuX2NhbkltcG9ydERhdGFzZXQoKSA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnIF0oJ0RhdGFzZXRzTGlzdC1pdGVtLS1zZWxlY3RhYmxlJyk7XG4gICAgLy8gQ2hlY2sgaWYgaXQgaXMgaW1wb3J0YWJsZVxuICAgIHRoaXMuJGVsWyB0aGlzLl9jYW5JbXBvcnREYXRhc2V0KCkgPyAncmVtb3ZlQ2xhc3MnIDogJ2FkZENsYXNzJyBdKCdEYXRhc2V0c0xpc3QtaXRlbS0tYmFubmVkJyk7XG4gIH0sXG5cbiAgX3JlbmRlclRvb2x0aXBzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmFkZFZpZXcoXG4gICAgICBuZXcgY2RiLmNvbW1vbi5UaXBzeVRvb2x0aXAoe1xuICAgICAgICBlbDogdGhpcy4kKCcuRGF0YXNldHNMaXN0LWl0ZW1TdGF0dXMnKSxcbiAgICAgICAgdGl0bGU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICByZXR1cm4gJCh0aGlzKS5hdHRyKCdkYXRhLXRpdGxlJylcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApXG4gIH0sXG5cbiAgX29uVGFnQ2xpY2s6IGZ1bmN0aW9uKGV2KSB7XG4gICAgaWYgKGV2KSB7XG4gICAgICB0aGlzLmtpbGxFdmVudChldik7XG4gICAgfVxuXG4gICAgdmFyIHRhZyA9ICQoZXYudGFyZ2V0KS52YWwoKTtcblxuICAgIGlmICh0YWcpIHtcbiAgICAgIHRoaXMucm91dGVyTW9kZWwuc2V0KHtcbiAgICAgICAgdGFnOiB0YWcsXG4gICAgICAgIGxpYnJhcnk6IHRydWVcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBfY2FuSW1wb3J0RGF0YXNldDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRhYmxlX3NpemUgPSB0aGlzLnRhYmxlLmdldCgnc2l6ZScpIHx8IDA7XG4gICAgcmV0dXJuIChcbiAgICAgICAgdGhpcy51c2VyLmdldCgncmVtYWluaW5nX2J5dGVfcXVvdGEnKSAqIFVwbG9hZENvbmZpZy5maWxlVGltZXNCaWdnZXIgPj0gdGFibGVfc2l6ZSAmJlxuICAgICAgICB0aGlzLnVzZXIuZ2V0KCdsaW1pdHMnKVsnaW1wb3J0X2ZpbGVfc2l6ZSddID4gdGFibGVfc2l6ZVxuICAgICAgKTtcbiAgfSxcblxuICBfdG9nZ2xlU2VsZWN0ZWQ6IGZ1bmN0aW9uKGV2KSB7XG4gICAgLy8gTGV0IGxpbmtzIHVzZSBkZWZhdWx0IGJlaGF2aW91clxuICAgIGlmIChldi50YXJnZXQudGFnTmFtZSAhPT0gJ0EnKSB7XG4gICAgICB0aGlzLmtpbGxFdmVudChldik7XG4gICAgICBpZiAodGhpcy5fY2FuSW1wb3J0RGF0YXNldCgpICYmIHRoaXMub3B0aW9ucy5jcmVhdGVNb2RlbC5jYW5TZWxlY3QodGhpcy5tb2RlbCkpIHtcbiAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ3NlbGVjdGVkJywgIXRoaXMubW9kZWwuZ2V0KCdzZWxlY3RlZCcpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBEYXRhc2V0c0l0ZW0gPSByZXF1aXJlKCcuL2RhdGFzZXRzL2RhdGFzZXRfaXRlbV92aWV3Jyk7XG52YXIgUmVtb3RlRGF0YXNldHNJdGVtID0gcmVxdWlyZSgnLi9kYXRhc2V0cy9yZW1vdGVfZGF0YXNldF9pdGVtX3ZpZXcnKTtcblxuLyoqXG4gKiBWaWV3IHJlcHJlc2VudGluZyB0aGUgbGlzdCBvZiBpdGVtc1xuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICB0YWdOYW1lOiAndWwnLFxuXG4gIGNsYXNzTmFtZTogJ0RhdGFzZXRzTGlzdCcsXG5cbiAgZXZlbnRzOiB7fSxcblxuICBfSVRFTVM6IHtcbiAgICAncmVtb3Rlcyc6ICBSZW1vdGVEYXRhc2V0c0l0ZW0sXG4gICAgJ2RhdGFzZXRzJzogRGF0YXNldHNJdGVtXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5vcHRpb25zLnVzZXI7XG4gICAgdGhpcy5jcmVhdGVNb2RlbCA9IHRoaXMub3B0aW9ucy5jcmVhdGVNb2RlbDtcbiAgICB0aGlzLmNvbGxlY3Rpb24uYmluZCgncmVzZXQnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbCh0aGlzLmNvbGxlY3Rpb24pO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmVhY2godGhpcy5fYWRkSXRlbSwgdGhpcyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2FkZEl0ZW06IGZ1bmN0aW9uKG0sIGkpIHtcbiAgICB2YXIgdHlwZSA9IG0uZ2V0KCd0eXBlJykgPT09IFwicmVtb3RlXCIgPyAncmVtb3RlcycgOiAnZGF0YXNldHMnO1xuXG4gICAgdmFyIGl0ZW0gPSBuZXcgdGhpcy5fSVRFTVNbdHlwZV0oe1xuICAgICAgbW9kZWw6ICAgICAgIG0sXG4gICAgICBjcmVhdGVNb2RlbDogdGhpcy5jcmVhdGVNb2RlbCxcbiAgICAgIHVzZXI6ICAgICAgICB0aGlzLnVzZXJcbiAgICB9KTtcblxuICAgIHRoaXMuYWRkVmlldyhpdGVtKTtcbiAgICB0aGlzLiRlbC5hcHBlbmQoaXRlbS5yZW5kZXIoKS5lbCk7XG4gIH0sXG5cbiAgc2hvdzogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwucmVtb3ZlQ2xhc3MoJ2lzLWhpZGRlbicpO1xuICB9LFxuXG4gIGhpZGU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmFkZENsYXNzKCdpcy1oaWRkZW4nKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgRGF0YXNldHNMaXN0ID0gcmVxdWlyZSgnLi9kYXRhc2V0c19saXN0X3ZpZXcnKTtcbnZhciBDb250ZW50UmVzdWx0ID0gcmVxdWlyZSgnLi9kYXRhc2V0cy9jb250ZW50X3Jlc3VsdF92aWV3Jyk7XG52YXIgRGF0YXNldHNQYWdpbmF0b3IgPSByZXF1aXJlKCcuL2RhdGFzZXRzL2RhdGFzZXRzX3BhZ2luYXRvcl92aWV3Jyk7XG5cbi8qKlxuICogIERhdGFzZXRzIGxpc3Qgdmlld1xuICpcbiAqICBTaG93IGRhdGFzZXRzIHZpZXcgdG8gc2VsZWN0IHRoZW0gZm9yXG4gKiAgY3JlYXRpbmcgYSBtYXAgb3IgaW1wb3J0aW5nIGEgZGF0YXNldFxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5vcHRpb25zLnVzZXI7XG4gICAgdGhpcy5jcmVhdGVNb2RlbCA9IHRoaXMub3B0aW9ucy5jcmVhdGVNb2RlbDtcbiAgICB0aGlzLnJvdXRlck1vZGVsID0gdGhpcy5vcHRpb25zLnJvdXRlck1vZGVsO1xuXG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgdGhpcy5faW5pdEJpbmRpbmdzKCk7XG5cbiAgICBpZiAodGhpcy5jcmVhdGVNb2RlbC5nZXQoJ2NvbGxlY3Rpb25GZXRjaGVkJykpIHtcbiAgICAgIHRoaXMuX29uRGF0YUZldGNoZWQoKTtcbiAgICB9XG4gIH0sXG5cbiAgX2luaXRCaW5kaW5nczogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMucm91dGVyTW9kZWwuYmluZCgnY2hhbmdlJywgdGhpcy5fb25Sb3V0ZXJDaGFuZ2UsIHRoaXMpO1xuICAgIHRoaXMuY29sbGVjdGlvbi5iaW5kKCdsb2FkaW5nJywgdGhpcy5fb25EYXRhTG9hZGluZywgdGhpcyk7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmJpbmQoJ3Jlc2V0JywgdGhpcy5fb25EYXRhRmV0Y2hlZCwgdGhpcyk7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmJpbmQoJ2Vycm9yJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIC8vIE9sZCByZXF1ZXN0cyBjYW4gYmUgc3RvcHBlZCwgc28gYWJvcnRlZCByZXF1ZXN0cyBhcmUgbm90XG4gICAgICAvLyBjb25zaWRlcmVkIGFzIGFuIGVycm9yXG4gICAgICBpZiAoIWUgfHwgKGUgJiYgZS5zdGF0dXNUZXh0ICE9PSAnYWJvcnQnKSkge1xuICAgICAgICB0aGlzLl9vbkRhdGFFcnJvcigpO1xuICAgICAgfVxuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5yb3V0ZXJNb2RlbCk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbCh0aGlzLmNyZWF0ZU1vZGVsKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMuY29sbGVjdGlvbik7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY29udHJvbGxlZFZpZXdzID0ge307IC8vIEFsbCBhdmFpbGFibGUgdmlld3NcbiAgICB0aGlzLmVuYWJsZWRWaWV3cyA9IFtdOyAvLyBWaXNpYmxlIHZpZXdzXG5cbiAgICB2YXIgbm9EYXRhc2V0c1ZpZXcgPSBuZXcgQ29udGVudFJlc3VsdCh7XG4gICAgICBjbGFzc05hbWU6ICdDb250ZW50UmVzdWx0IG5vLWRhdGFzZXRzJyxcbiAgICAgIHVzZXI6IHRoaXMudXNlcixcbiAgICAgIGRlZmF1bHRVcmw6IHRoaXMub3B0aW9ucy5kZWZhdWx0VXJsLFxuICAgICAgcm91dGVyTW9kZWw6IHRoaXMucm91dGVyTW9kZWwsXG4gICAgICBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb24sXG4gICAgICB0ZW1wbGF0ZTogJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9jb250ZW50X25vX2RhdGFzZXRzJ1xuICAgIH0pO1xuICAgIG5vRGF0YXNldHNWaWV3LmJpbmQoJ2Nvbm5lY3REYXRhc2V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMudXNlci5jYW5DcmVhdGVEYXRhc2V0cygpKSB7XG4gICAgICAgIHRoaXMuY3JlYXRlTW9kZWwuc2V0KCdsaXN0aW5nJywgJ2ltcG9ydCcpO1xuICAgICAgfVxuICAgIH0sIHRoaXMpO1xuICAgIG5vRGF0YXNldHNWaWV3LnJlbmRlcigpLmhpZGUoKTtcbiAgICB0aGlzLmNvbnRyb2xsZWRWaWV3cy5ub19kYXRhc2V0cyA9IG5vRGF0YXNldHNWaWV3O1xuICAgIHRoaXMuJGVsLmFwcGVuZChub0RhdGFzZXRzVmlldy5lbCk7XG4gICAgdGhpcy5hZGRWaWV3KG5vRGF0YXNldHNWaWV3KTtcblxuICAgIHZhciBsaXN0VmlldyA9IG5ldyBEYXRhc2V0c0xpc3Qoe1xuICAgICAgdXNlcjogdGhpcy51c2VyLFxuICAgICAgY3JlYXRlTW9kZWw6IHRoaXMuY3JlYXRlTW9kZWwsXG4gICAgICByb3V0ZXJNb2RlbDogdGhpcy5yb3V0ZXJNb2RlbCxcbiAgICAgIGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvblxuICAgIH0pO1xuICAgIHRoaXMuY29udHJvbGxlZFZpZXdzLmxpc3QgPSBsaXN0VmlldztcbiAgICB0aGlzLiRlbC5hcHBlbmQobGlzdFZpZXcucmVuZGVyKCkuZWwpO1xuICAgIHRoaXMuYWRkVmlldyhsaXN0Vmlldyk7XG5cbiAgICB2YXIgbm9SZXN1bHRzVmlldyA9IG5ldyBDb250ZW50UmVzdWx0KHtcbiAgICAgIGRlZmF1bHRVcmw6IHRoaXMub3B0aW9ucy5kZWZhdWx0VXJsLFxuICAgICAgcm91dGVyTW9kZWw6IHRoaXMucm91dGVyTW9kZWwsXG4gICAgICBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb24sXG4gICAgICB0ZW1wbGF0ZTogJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9kYXRhc2V0c19ub19yZXN1bHQnXG4gICAgfSk7XG4gICAgbm9SZXN1bHRzVmlldy5yZW5kZXIoKS5oaWRlKCk7XG4gICAgdGhpcy5jb250cm9sbGVkVmlld3Mubm9fcmVzdWx0cyA9IG5vUmVzdWx0c1ZpZXc7XG4gICAgdGhpcy4kZWwuYXBwZW5kKG5vUmVzdWx0c1ZpZXcuZWwpO1xuICAgIHRoaXMuYWRkVmlldyhub1Jlc3VsdHNWaWV3KTtcblxuICAgIHZhciBlcnJvclZpZXcgPSBuZXcgQ29udGVudFJlc3VsdCh7XG4gICAgICBkZWZhdWx0VXJsOiB0aGlzLm9wdGlvbnMuZGVmYXVsdFVybCxcbiAgICAgIHJvdXRlck1vZGVsOiB0aGlzLnJvdXRlck1vZGVsLFxuICAgICAgY29sbGVjdGlvbjogdGhpcy5jb2xsZWN0aW9uLFxuICAgICAgdGVtcGxhdGU6ICdjb21tb24vdmlld3MvY3JlYXRlL2xpc3RpbmcvZGF0YXNldHNfZXJyb3InXG4gICAgfSk7XG4gICAgZXJyb3JWaWV3LnJlbmRlcigpLmhpZGUoKTtcbiAgICB0aGlzLmNvbnRyb2xsZWRWaWV3cy5lcnJvciA9IGVycm9yVmlldztcbiAgICB0aGlzLiRlbC5hcHBlbmQoZXJyb3JWaWV3LmVsKTtcbiAgICB0aGlzLmFkZFZpZXcoZXJyb3JWaWV3KTtcblxuICAgIHZhciBtYWluTG9hZGVyVmlldyA9IG5ldyBDb250ZW50UmVzdWx0KHtcbiAgICAgIGRlZmF1bHRVcmw6IHRoaXMub3B0aW9ucy5kZWZhdWx0VXJsLFxuICAgICAgcm91dGVyTW9kZWw6IHRoaXMucm91dGVyTW9kZWwsXG4gICAgICBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb24sXG4gICAgICB0ZW1wbGF0ZTogJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9kYXRhc2V0c19sb2FkZXInXG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbnRyb2xsZWRWaWV3cy5tYWluX2xvYWRlciA9IG1haW5Mb2FkZXJWaWV3O1xuICAgIHRoaXMuJGVsLmFwcGVuZChtYWluTG9hZGVyVmlldy5yZW5kZXIoKS5lbCk7XG4gICAgdGhpcy5hZGRWaWV3KG1haW5Mb2FkZXJWaWV3KTtcblxuICAgIHZhciBkYXRhc2V0c1BhZ2luYXRvciA9IG5ldyBEYXRhc2V0c1BhZ2luYXRvcih7XG4gICAgICByb3V0ZXJNb2RlbDogdGhpcy5yb3V0ZXJNb2RlbCxcbiAgICAgIGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvblxuICAgIH0pO1xuXG4gICAgdGhpcy5jb250cm9sbGVkVmlld3MuY29udGVudF9mb290ZXIgPSBkYXRhc2V0c1BhZ2luYXRvcjtcbiAgICB0aGlzLiRlbC5hcHBlbmQoZGF0YXNldHNQYWdpbmF0b3IucmVuZGVyKCkuZWwpO1xuICAgIHRoaXMuYWRkVmlldyhkYXRhc2V0c1BhZ2luYXRvcik7XG4gIH0sXG5cbiAgX29uUm91dGVyQ2hhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5faGlkZUJsb2NrcygpO1xuICAgIHRoaXMuX3Nob3dCbG9ja3MoWyAnbWFpbl9sb2FkZXInIF0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBBcmd1bWVudHMgbWF5IHZhcnksIGRlcGVuZGluZyBvbiBpZiBpdCdzIHRoZSBjb2xsZWN0aW9uIG9yIGEgbW9kZWwgdGhhdCB0cmlnZ2VycyB0aGUgZXZlbnQgY2FsbGJhY2suXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfb25EYXRhRmV0Y2hlZDogZnVuY3Rpb24gKCkge1xuICAgIHZhciBhY3RpdmVWaWV3cyA9IFsgJ2NvbnRlbnRfZm9vdGVyJyBdO1xuICAgIHZhciB0YWcgPSB0aGlzLnJvdXRlck1vZGVsLmdldCgndGFnJyk7XG4gICAgdmFyIHEgPSB0aGlzLnJvdXRlck1vZGVsLmdldCgncScpO1xuICAgIHZhciBzaGFyZWQgPSB0aGlzLnJvdXRlck1vZGVsLmdldCgnc2hhcmVkJyk7XG4gICAgdmFyIGxvY2tlZCA9IHRoaXMucm91dGVyTW9kZWwuZ2V0KCdsb2NrZWQnKTtcbiAgICB2YXIgbGlicmFyeSA9IHRoaXMucm91dGVyTW9kZWwuZ2V0KCdsaWJyYXJ5Jyk7XG4gICAgdmFyIGhhc0RhdGFMaWJyYXJ5ID0gY2RiLmNvbmZpZy5nZXQoJ2RhdGFfbGlicmFyeV9lbmFibGVkJyk7XG5cbiAgICBpZiAobGlicmFyeSAmJiB0aGlzLmNvbGxlY3Rpb24udG90YWxfdXNlcl9lbnRyaWVzID09PSAwKSB7XG4gICAgICBhY3RpdmVWaWV3cy5wdXNoKCdub19kYXRhc2V0cycpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbGxlY3Rpb24uc2l6ZSgpID09PSAwKSB7XG4gICAgICBpZiAoIXRhZyAmJiAhcSAmJiBzaGFyZWQgPT09ICdubycgJiYgIWxvY2tlZCkge1xuICAgICAgICBpZiAoIWxpYnJhcnkgJiYgaGFzRGF0YUxpYnJhcnkpIHtcbiAgICAgICAgICB0aGlzLmNyZWF0ZU1vZGVsLnNldCgnZGF0YXNldHNUYWJEaXNhYmxlZCcsIHRydWUpO1xuICAgICAgICAgIHRoaXMuX2dvVG9MaWJyYXJ5KCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFsaWJyYXJ5ICYmIHRoaXMudXNlci5jYW5DcmVhdGVEYXRhc2V0cygpKSB7XG4gICAgICAgICAgdGhpcy5jcmVhdGVNb2RlbC5zZXQoe1xuICAgICAgICAgICAgZGF0YXNldHNUYWJEaXNhYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgIGxpc3Rpbmc6ICdpbXBvcnQnXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgYWN0aXZlVmlld3MucHVzaCgnbm9fcmVzdWx0cycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWN0aXZlVmlld3MucHVzaCgnbm9fcmVzdWx0cycpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBhY3RpdmVWaWV3cy5wdXNoKCdsaXN0Jyk7XG4gICAgICB0aGlzLnJvdXRlck1vZGVsLnNldCgnZGF0YXNldHNUYWJEaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgIHRoaXMuY3JlYXRlTW9kZWwuc2V0KCdkYXRhc2V0c1RhYkRpc2FibGVkJywgZmFsc2UpO1xuICAgIH1cblxuICAgIHRoaXMuX2hpZGVCbG9ja3MoKTtcbiAgICB0aGlzLl9zaG93QmxvY2tzKGFjdGl2ZVZpZXdzKTtcbiAgfSxcblxuICBfb25EYXRhTG9hZGluZzogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX2hpZGVCbG9ja3MoKTtcbiAgICB0aGlzLl9zaG93QmxvY2tzKFsgJ21haW5fbG9hZGVyJyBdKTtcbiAgfSxcblxuICBfb25EYXRhRXJyb3I6IGZ1bmN0aW9uIChlKSB7XG4gICAgdGhpcy5faGlkZUJsb2NrcygpO1xuICAgIHRoaXMuX3Nob3dCbG9ja3MoWyAnZXJyb3InIF0pO1xuICB9LFxuXG4gIF9zaG93QmxvY2tzOiBmdW5jdGlvbiAodmlld3MpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgaWYgKHZpZXdzKSB7XG4gICAgICBfLmVhY2godmlld3MsIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIGlmIChzZWxmLmNvbnRyb2xsZWRWaWV3c1t2XSkge1xuICAgICAgICAgIHNlbGYuY29udHJvbGxlZFZpZXdzW3ZdLnNob3coKTtcbiAgICAgICAgICBzZWxmLmVuYWJsZWRWaWV3cy5wdXNoKHYpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5lbmFibGVkVmlld3MgPSBbXTtcbiAgICAgIF8uZWFjaCh0aGlzLmNvbnRyb2xsZWRWaWV3cywgZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdi5zaG93KCk7XG4gICAgICAgIHNlbGYuZW5hYmxlZFZpZXdzLnB1c2godik7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgX2dvVG9MaWJyYXJ5OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5yb3V0ZXJNb2RlbC5zZXQoe1xuICAgICAgc2hhcmVkOiAnbm8nLFxuICAgICAgbGlicmFyeTogdHJ1ZSxcbiAgICAgIHBhZ2U6IDFcbiAgICB9KTtcbiAgfSxcblxuICBfaGlkZUJsb2NrczogZnVuY3Rpb24gKHZpZXdzKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmICh2aWV3cykge1xuICAgICAgXy5lYWNoKHZpZXdzLCBmdW5jdGlvbiAodikge1xuICAgICAgICBpZiAoc2VsZi5jb250cm9sbGVkVmlld3Nbdl0pIHtcbiAgICAgICAgICBzZWxmLmNvbnRyb2xsZWRWaWV3c1t2XS5oaWRlKCk7XG4gICAgICAgICAgc2VsZi5lbmFibGVkVmlld3MgPSBfLndpdGhvdXQoc2VsZi5lbmFibGVkVmlld3MsIHYpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgXy5lYWNoKHRoaXMuY29udHJvbGxlZFZpZXdzLCBmdW5jdGlvbiAodikge1xuICAgICAgICB2LmhpZGUoKTtcbiAgICAgIH0pO1xuICAgICAgc2VsZi5lbmFibGVkVmlld3MgPSBbXTtcbiAgICB9XG4gIH0sXG5cbiAgX2lzQmxvY2tFbmFibGVkOiBmdW5jdGlvbiAobmFtZSkge1xuICAgIGlmIChuYW1lKSB7XG4gICAgICByZXR1cm4gXy5jb250YWlucyh0aGlzLmVuYWJsZWRWaWV3cywgbmFtZSk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG59KTtcbiIsInZhciBJbXBvcnRTZXJ2aWNlID0gcmVxdWlyZSgnLi9pbXBvcnRzL3NlcnZpY2VfaW1wb3J0L2ltcG9ydF9zZXJ2aWNlX3ZpZXcnKTtcbnZhciBJbXBvcnRUd2l0dGVyID0gcmVxdWlyZSgnLi9pbXBvcnRzL3R3aXR0ZXJfaW1wb3J0L2ltcG9ydF90d2l0dGVyX3ZpZXcnKTtcbnZhciBJbXBvcnREYXRhVmlldyA9IHJlcXVpcmUoJy4vaW1wb3J0cy9pbXBvcnRfZGF0YV92aWV3Jyk7XG52YXIgSW1wb3J0QXJjR0lTVmlldyA9IHJlcXVpcmUoJy4vaW1wb3J0cy9pbXBvcnRfYXJjZ2lzX3ZpZXcnKTtcblxuLyoqXG4gKiBBdHRyaWJ1dGVzOlxuICpcbiAqICBDbGFzc05hbWU6IGltcG9ydCBwYW5lIGNsYXNzIHZpZXdcbiAqICBlbmFibGVkOiBmdW5jdGlvbiB0aGF0IHRha2VzIGNkYi5jb25maWcgYW5kIHJldHVybnMgd2hldGhlciB0aGUgc2VydmljZSBpcyBlbmFibGVkXG4gKiAgZmFsbGJhY2tDbGFzc05hbWU6IC4uLlxuICogIG5hbWU6IGxvY2FsIG5hbWVcbiAqICB0aXRsZTogdGV4dCBmb3IgdGFiIGxpbmtcbiAqICBvcHRpb25zOlxuICogICAgLSBzZXJ2aWNlOlxuICogICAgLSBmaWxlRXh0ZW5zaW9uczpcbiAqICAgIC0gc2hvd0F2YWlsYWJsZUZvcm1hdHM6XG4gKiAgICAtIGFjY2VwdFN5bmM6XG4gKiAgICAtIGZpbGVBdHRyczpcbiAqXG4gKi9cbm1vZHVsZS5leHBvcnRzID0ge1xuICBGaWxlOiB7XG4gICAgQ2xhc3NOYW1lOiBJbXBvcnREYXRhVmlldyxcbiAgICBlbmFibGVkOiBmdW5jdGlvbiAoY29uZmlnLCB1c2VyRGF0YSkgeyByZXR1cm4gdHJ1ZTsgfSxcbiAgICBuYW1lOiAnZmlsZScsXG4gICAgdGl0bGU6ICdEYXRhIGZpbGUnLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIHR5cGU6ICd1cmwnLFxuICAgICAgZmlsZUVuYWJsZWQ6IHRydWUsXG4gICAgICBhY2NlcHRTeW5jOiB0cnVlXG4gICAgfVxuICB9LFxuICBHRHJpdmU6IHtcbiAgICBDbGFzc05hbWU6IEltcG9ydFNlcnZpY2UsXG4gICAgZW5hYmxlZDogZnVuY3Rpb24gKGNvbmZpZywgdXNlckRhdGEpIHsgcmV0dXJuICEhY29uZmlnLmdldCgnb2F1dGhfZ2RyaXZlJyk7IH0sXG4gICAgbmFtZTogJ2dkcml2ZScsXG4gICAgdGl0bGU6ICdHb29nbGUgRHJpdmUnLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIHNlcnZpY2U6ICdnZHJpdmUnLFxuICAgICAgZmlsZUV4dGVuc2lvbnM6IFsnR29vZ2xlIFNwcmVhZFNoZWV0JywgJ0NTViddLFxuICAgICAgc2hvd0F2YWlsYWJsZUZvcm1hdHM6IGZhbHNlLFxuICAgICAgYWNjZXB0U3luYzogdHJ1ZSxcbiAgICAgIGZpbGVBdHRyczoge1xuICAgICAgICBleHQ6IHRydWUsXG4gICAgICAgIHRpdGxlOiAnZmlsZW5hbWUnLFxuICAgICAgICBkZXNjcmlwdGlvbjoge1xuICAgICAgICAgIGNvbnRlbnQ6IFt7XG4gICAgICAgICAgICBuYW1lOiAnc2l6ZScsXG4gICAgICAgICAgICBmb3JtYXQ6ICdzaXplJyxcbiAgICAgICAgICAgIGtleTogdHJ1ZVxuICAgICAgICAgIH1dXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIERyb3Bib3g6IHtcbiAgICBDbGFzc05hbWU6IEltcG9ydFNlcnZpY2UsXG4gICAgZW5hYmxlZDogZnVuY3Rpb24gKGNvbmZpZywgdXNlckRhdGEpIHsgcmV0dXJuICEhY29uZmlnLmdldCgnb2F1dGhfZHJvcGJveCcpOyB9LFxuICAgIG5hbWU6ICdkcm9wYm94JyxcbiAgICB0aXRsZTogJ0Ryb3Bib3gnLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIHNlcnZpY2U6ICdkcm9wYm94JyxcbiAgICAgIGZpbGVFeHRlbnNpb25zOiBbJ0NTVicsICdYTFMnXSxcbiAgICAgIHNob3dBdmFpbGFibGVGb3JtYXRzOiBmYWxzZSxcbiAgICAgIGFjY2VwdFN5bmM6IHRydWUsXG4gICAgICBmaWxlQXR0cnM6IHtcbiAgICAgICAgZXh0OiB0cnVlLFxuICAgICAgICB0aXRsZTogJ2ZpbGVuYW1lJyxcbiAgICAgICAgZGVzY3JpcHRpb246IHtcbiAgICAgICAgICBjb250ZW50OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWU6ICdpZCcsXG4gICAgICAgICAgICAgIGZvcm1hdDogJydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWU6ICdzaXplJyxcbiAgICAgICAgICAgICAgZm9ybWF0OiAnc2l6ZScsXG4gICAgICAgICAgICAgIGtleTogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgc2VwYXJhdG9yOiAnLSdcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgQm94OiB7XG4gICAgQ2xhc3NOYW1lOiBJbXBvcnRTZXJ2aWNlLFxuICAgIGVuYWJsZWQ6IGZ1bmN0aW9uIChjb25maWcsIHVzZXJEYXRhKSB7IHJldHVybiAhIWNvbmZpZy5nZXQoJ29hdXRoX2JveCcpOyB9LFxuICAgIG5hbWU6ICdib3gnLFxuICAgIHRpdGxlOiAnQm94JyxcbiAgICBmYWxsYmFjazogJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9pbXBvcnRfYm94X2ZhbGxiYWNrJyxcbiAgICBvcHRpb25zOiB7XG4gICAgICBzZXJ2aWNlOiAnYm94JyxcbiAgICAgIGZpbGVFeHRlbnNpb25zOiBbJ0NTVicsICdYTFMnXSxcbiAgICAgIHNob3dBdmFpbGFibGVGb3JtYXRzOiBmYWxzZSxcbiAgICAgIGFjY2VwdFN5bmM6IHRydWUsXG4gICAgICBmaWxlQXR0cnM6IHtcbiAgICAgICAgZXh0OiB0cnVlLFxuICAgICAgICB0aXRsZTogJ2ZpbGVuYW1lJyxcbiAgICAgICAgZGVzY3JpcHRpb246IHtcbiAgICAgICAgICBjb250ZW50OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWU6ICdzaXplJyxcbiAgICAgICAgICAgICAgZm9ybWF0OiAnc2l6ZScsXG4gICAgICAgICAgICAgIGtleTogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgc2VwYXJhdG9yOiAnLSdcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgVHdpdHRlcjoge1xuICAgIENsYXNzTmFtZTogSW1wb3J0VHdpdHRlcixcbiAgICBlbmFibGVkOiBmdW5jdGlvbiAoY29uZmlnLCB1c2VyRGF0YSkge1xuICAgICAgcmV0dXJuIHVzZXJEYXRhLmdldCgndHdpdHRlcicpLmVuYWJsZWQgJiYgISFjb25maWcuZ2V0KCdkYXRhc291cmNlX3NlYXJjaF90d2l0dGVyJyk7XG4gICAgfSxcbiAgICBmYWxsYmFjazogJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9pbXBvcnRfdHdpdHRlcl9mYWxsYmFjaycsXG4gICAgbmFtZTogJ3R3aXR0ZXInLFxuICAgIHRpdGxlOiAnVHdpdHRlcidcbiAgfSxcbiAgTWFpbGNoaW1wOiB7XG4gICAgQ2xhc3NOYW1lOiBJbXBvcnRTZXJ2aWNlLFxuICAgIGVuYWJsZWQ6IGZ1bmN0aW9uIChjb25maWcsIHVzZXJEYXRhKSB7XG4gICAgICByZXR1cm4gdXNlckRhdGEuZ2V0KCdtYWlsY2hpbXAnKS5lbmFibGVkICYmICEhY29uZmlnLmdldCgnb2F1dGhfbWFpbGNoaW1wJyk7XG4gICAgfSxcbiAgICBmYWxsYmFjazogJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9pbXBvcnRfbWFpbGNoaW1wX2ZhbGxiYWNrJyxcbiAgICBuYW1lOiAnbWFpbGNoaW1wJyxcbiAgICB0aXRsZTogJ01haWxDaGltcCcsXG4gICAgb3B0aW9uczoge1xuICAgICAgc2VydmljZTogJ21haWxjaGltcCcsXG4gICAgICBmaWxlRXh0ZW5zaW9uczogW10sXG4gICAgICBhY2NlcHRTeW5jOiB0cnVlLFxuICAgICAgc2hvd0F2YWlsYWJsZUZvcm1hdHM6IGZhbHNlLFxuICAgICAgaGVhZGVyVGVtcGxhdGU6ICdjb21tb24vdmlld3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0X3R5cGVzL2RhdGFfaGVhZGVyX21haWxjaGltcCcsXG4gICAgICBmaWxlQXR0cnM6IHtcbiAgICAgICAgZXh0OiB0cnVlLFxuICAgICAgICB0aXRsZTogJ2ZpbGVuYW1lJyxcbiAgICAgICAgZGVzY3JpcHRpb246IHtcbiAgICAgICAgICBjb250ZW50OiBbe1xuICAgICAgICAgICAgbmFtZTogJ21lbWJlcl9jb3VudCcsXG4gICAgICAgICAgICBmb3JtYXQ6ICdudW1iZXInLFxuICAgICAgICAgICAga2V5OiB0cnVlXG4gICAgICAgICAgfV0sXG4gICAgICAgICAgaXRlbU5hbWU6ICdtZW1iZXInLFxuICAgICAgICAgIHNlcGFyYXRvcjogJydcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgLy8gSW5zdGFncmFtOiB7XG4gIC8vICAgQ2xhc3NOYW1lOiBJbXBvcnRTZXJ2aWNlLFxuICAvLyAgIGZhbGxiYWNrOiAnY29tbW9uL3ZpZXdzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydF9pbnN0YWdyYW1fZmFsbGJhY2snLFxuICAvLyAgIG5hbWU6ICdpbnN0YWdyYW0nLFxuICAvLyAgIHRpdGxlOiAnSW5zdGFncmFtJyxcbiAgLy8gICBvcHRpb25zOiB7XG4gIC8vICAgICBzZXJ2aWNlOiAnaW5zdGFncmFtJyxcbiAgLy8gICAgIGZpbGVFeHRlbnNpb25zOiBbXSxcbiAgLy8gICAgIGFjY2VwdFN5bmM6IGZhbHNlLFxuICAvLyAgICAgc2hvd0F2YWlsYWJsZUZvcm1hdHM6IGZhbHNlLFxuICAvLyAgICAgZmlsZUF0dHJzOiB7XG4gIC8vICAgICAgIGV4dDogZmFsc2UsXG4gIC8vICAgICAgIHRpdGxlOiAndGl0bGUnXG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyB9LFxuICBBcmNnaXM6IHtcbiAgICBDbGFzc05hbWU6IEltcG9ydEFyY0dJU1ZpZXcsXG4gICAgZW5hYmxlZDogZnVuY3Rpb24gKGNvbmZpZywgdXNlckRhdGEpIHsgcmV0dXJuIGNvbmZpZy5nZXQoJ2FyY2dpc19lbmFibGVkJyk7IH0sXG4gICAgZmFsbGJhY2s6ICdjb21tb24vdmlld3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0X2FyY2dpc19mYWxsYmFjaycsXG4gICAgbmFtZTogJ2FyY2dpcycsXG4gICAgdGl0bGU6ICdBcmNHSVMgU2VydmVyJnRyYWRlOydcbiAgfSxcbiAgU2FsZXNmb3JjZToge1xuICAgIENsYXNzTmFtZTogSW1wb3J0RGF0YVZpZXcsXG4gICAgZW5hYmxlZDogZnVuY3Rpb24gKGNvbmZpZywgdXNlckRhdGEpIHsgcmV0dXJuIGNvbmZpZy5nZXQoJ3NhbGVzZm9yY2VfZW5hYmxlZCcpOyB9LFxuICAgIGZhbGxiYWNrOiAnY29tbW9uL3ZpZXdzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydF9zYWxlc2ZvcmNlX2ZhbGxiYWNrJyxcbiAgICBuYW1lOiAnc2FsZXNmb3JjZScsXG4gICAgdGl0bGU6ICdTYWxlc2ZvcmNlJ1xuICAgIC8vIG9wdGlvbnM6IHtcbiAgICAvLyAgIHR5cGU6ICdzZXJ2aWNlJyxcbiAgICAvLyAgIHNlcnZpY2VfbmFtZTogJ3NhbGVzZm9yY2UnLFxuICAgIC8vICAgYWNjZXB0U3luYzogdHJ1ZSxcbiAgICAvLyAgIGZvcm1UZW1wbGF0ZTogJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9pbXBvcnRfdHlwZXMvZGF0YV9mb3JtX3NhbGVzZm9yY2UnLFxuICAgIC8vICAgaGVhZGVyVGVtcGxhdGU6ICdjb21tb24vdmlld3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0X3R5cGVzL2RhdGFfaGVhZGVyX3NhbGVzZm9yY2UnXG4gICAgLy8gfVxuICB9XG59O1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5jZGIuYWRtaW4gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ11bJ2FkbWluJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXVsnYWRtaW4nXSA6IG51bGwpO1xuXG4vKipcbiAqICBGb3JtIHZpZXcgZm9yIHVybCBpbXBvcnQgZm9yIGV4YW1wbGVcbiAqXG4gKiAgLSBJdCBhY2NlcHRzIGFuIHVybFxuICogIC0gSXQgY2hlY2tzIGlmIGl0IGlzIHZhbGlkXG4gKiAgLSBJdCBjb3VsZCBoYXZlIGEgZmlsZSBvcHRpb25cbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgb3B0aW9uczoge1xuICAgIHRlbXBsYXRlOiAnJyxcbiAgICBmaWxlRW5hYmxlZDogZmFsc2VcbiAgfSxcblxuICBldmVudHM6IHtcbiAgICAna2V5dXAgLmpzLXRleHRJbnB1dCc6ICdfb25UZXh0Q2hhbmdlZCcsXG4gICAgJ3N1Ym1pdCAuanMtZm9ybSc6ICdfb25TdWJtaXRGb3JtJ1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKHRoaXMub3B0aW9ucy50ZW1wbGF0ZSB8fCAnY29tbW9uL3ZpZXdzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydF90eXBlcy9kYXRhX2Zvcm0nKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICB0aGlzLl9jaGVja1Zpc2liaWxpdHkoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLnRlbXBsYXRlKHRoaXMub3B0aW9ucylcbiAgICApXG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6c3RhdGUnLCB0aGlzLl9jaGVja1Zpc2liaWxpdHksIHRoaXMpO1xuICB9LFxuXG4gIF9pbml0Vmlld3M6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZmlsZUVuYWJsZWQpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHRoaXMuJCgnLmpzLWZpbGVJbnB1dCcpLmJpbmQoJ2NoYW5nZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYgKHRoaXMuZmlsZXMgJiYgdGhpcy5maWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgc2VsZi5fb25GaWxlQ2hhbmdlZCh0aGlzLmZpbGVzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZhbHVlID0gXCJcIjtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLl9pbml0RHJvcHpvbmUoKTtcbiAgICB9XG4gIH0sXG5cbiAgX2luaXREcm9wem9uZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVsID0gJCgnaHRtbCcpWzBdOyAvLyA6KFxuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHRoaXMuZHJhZ3N0ZXIgPSBuZXcgRHJhZ3N0ZXIoZWwpO1xuXG4gICAgJChlbCkuYmluZChcImRyYWdzdGVyOmVudGVyXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBzZWxmLl9zaG93RHJvcHpvbmUoKTtcbiAgICB9KTtcblxuICAgICQoZWwpLmJpbmQoXCJkcmFnc3RlcjpsZWF2ZVwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgc2VsZi5faGlkZURyb3B6b25lKCk7XG4gICAgfSk7XG5cbiAgICBpZiAoZWwuZHJvcHpvbmUpIHsgLy8gYXZvaWQgbG9hZGluZyB0aGUgZHJvcHpvbmUgdHdpY2VcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmRyb3B6b25lID0gbmV3IERyb3B6b25lKGVsLCB7XG4gICAgICB1cmw6ICc6KScsXG4gICAgICBhdXRvUHJvY2Vzc1F1ZXVlOiBmYWxzZSxcbiAgICAgIHByZXZpZXdzQ29udGFpbmVyOiBmYWxzZVxuICAgIH0pO1xuXG4gICAgdGhpcy5kcm9wem9uZS5vbignZHJhZ292ZXInLCBmdW5jdGlvbigpIHtcbiAgICAgIHNlbGYuX3Nob3dEcm9wem9uZSgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5kcm9wem9uZS5vbihcImRyb3BcIiwgZnVuY3Rpb24gKGV2KSB7XG4gICAgICB2YXIgZmlsZXMgPSBldi5kYXRhVHJhbnNmZXIuZmlsZXM7XG4gICAgICBzZWxmLl9vbkZpbGVDaGFuZ2VkKGZpbGVzKTtcbiAgICAgIHNlbGYuX2hpZGVEcm9wem9uZSgpO1xuICAgIH0pO1xuICB9LFxuXG4gIF9kZXN0cm95RHJvcHpvbmU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbCA9ICQoJ2h0bWwnKVswXTsgLy8gOihcblxuICAgIGlmICh0aGlzLmRyYWdzdGVyKSB7XG4gICAgICB0aGlzLmRyYWdzdGVyLnJlbW92ZUxpc3RlbmVycygpO1xuICAgICAgdGhpcy5kcmFnc3Rlci5yZXNldCgpO1xuICAgICAgJChlbCkudW5iaW5kKCdkcmFnc3RlcjplbnRlciBkcmFnc3RlcjpsZWF2ZScpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmRyb3B6b25lKSB7XG4gICAgICB0aGlzLmRyb3B6b25lLmRlc3Ryb3koKTtcbiAgICB9XG4gIH0sXG5cbiAgX3NldFZhbGlkRmlsZUV4dGVuc2lvbnM6IGZ1bmN0aW9uKGxpc3QpIHtcbiAgICByZXR1cm4gUmVnRXhwKFwiKFxcLnxcXC8pKFwiICsgbGlzdC5qb2luKCd8JykgKyBcIikkXCIsIFwiaVwiKTtcbiAgfSxcblxuICBfb25UZXh0Q2hhbmdlZDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHZhbHVlID0gdGhpcy4kKCcuanMtdGV4dElucHV0JykudmFsKCk7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgdGhpcy5faGlkZVRleHRFcnJvcigpO1xuICAgIH1cbiAgfSxcblxuICBfb25GaWxlQ2hhbmdlZDogZnVuY3Rpb24oZmlsZXMpIHtcbiAgICB0aGlzLnRyaWdnZXIoJ2ZpbGVTZWxlY3RlZCcsIHRoaXMpO1xuXG4gICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgZmlsZXMgPSBmaWxlc1swXTtcbiAgICB9XG5cbiAgICB0aGlzLm1vZGVsLnNldCh7XG4gICAgICB0eXBlOiAnZmlsZScsXG4gICAgICB2YWx1ZTogZmlsZXNcbiAgICB9KTtcblxuICAgIGlmICh0aGlzLm1vZGVsLmdldCgnc3RhdGUnKSAhPT0gXCJlcnJvclwiKSB7XG4gICAgICB0aGlzLl9oaWRlRmlsZUVycm9yKCk7XG4gICAgICB0aGlzLm1vZGVsLnNldCgnc3RhdGUnLCAnc2VsZWN0ZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc2hvd0ZpbGVFcnJvcigpO1xuICAgIH1cbiAgfSxcblxuICBfc2hvd1RleHRFcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKCcuRm9ybS1pbnB1dEVycm9yJykuYWRkQ2xhc3MoJ2lzLXZpc2libGUnKTtcbiAgfSxcblxuICBfaGlkZVRleHRFcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKCcuRm9ybS1pbnB1dEVycm9yJykucmVtb3ZlQ2xhc3MoJ2lzLXZpc2libGUnKTtcbiAgfSxcblxuICBfc2hvd0Ryb3B6b25lOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoJy5Gb3JtLXVwbG9hZCcpLmFkZENsYXNzKCdpcy1kcm9wcGluZycpO1xuICAgIHRoaXMuX2hpZGVGaWxlRXJyb3IoKTtcbiAgfSxcblxuICBfaGlkZURyb3B6b25lOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoJy5Gb3JtLXVwbG9hZCcpLnJlbW92ZUNsYXNzKCdpcy1kcm9wcGluZycpO1xuICB9LFxuXG4gIF9zaG93RmlsZUVycm9yOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3N0YXRlJykgPT09IFwiZXJyb3JcIikge1xuICAgICAgdGhpcy4kKCcuanMtZmlsZUVycm9yJylcbiAgICAgICAgLnRleHQodGhpcy5tb2RlbC5nZXQoJ2dldF9lcnJvcl90ZXh0Jykud2hhdF9hYm91dClcbiAgICAgICAgLnNob3coKTtcbiAgICAgIHRoaXMuJCgnLmpzLWZpbGVMYWJlbCcpLmhpZGUoKTtcbiAgICAgIHRoaXMuJCgnLmpzLWZpbGVCdXR0b24nKS5hZGRDbGFzcygnQnV0dG9uLS1uZWdhdGl2ZScpO1xuICAgIH1cbiAgfSxcblxuICBfaGlkZUZpbGVFcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKCcuanMtZmlsZUVycm9yJykuaGlkZSgpO1xuICAgIHRoaXMuJCgnLmpzLWZpbGVMYWJlbCcpLnNob3coKTtcbiAgICB0aGlzLiQoJy5qcy1maWxlQnV0dG9uJykucmVtb3ZlQ2xhc3MoJ0J1dHRvbi0tbmVnYXRpdmUnKTtcbiAgfSxcblxuICBfb25TdWJtaXRGb3JtOiBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUpIHRoaXMua2lsbEV2ZW50KGUpO1xuXG4gICAgLy8gVVJMIHN1Ym1pdFxuICAgIHZhciB2YWx1ZSA9IHRoaXMuJCgnLmpzLXRleHRJbnB1dCcpLnZhbCgpO1xuXG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgdGhpcy5faGlkZVRleHRFcnJvcigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENoYW5nZSBmaWxlIGF0dHJpYnV0ZXMgOlNcbiAgICB0aGlzLnRyaWdnZXIoJ3VybFNlbGVjdGVkJywgdGhpcyk7XG5cbiAgICAvLyBDaGFuZ2UgbW9kZWxcbiAgICB2YXIgaW1wb3J0VHlwZSA9IHRoaXMubW9kZWwuZ2V0KCdzZXJ2aWNlX25hbWUnKSA/ICdzZXJ2aWNlJyA6ICd1cmwnO1xuICAgIHRoaXMubW9kZWwuc2V0KHtcbiAgICAgIHR5cGU6IGltcG9ydFR5cGUsXG4gICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICBzZXJ2aWNlX2l0ZW1faWQ6IHZhbHVlLFxuICAgICAgc3RhdGU6ICdpZGxlJ1xuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdzdGF0ZScpICE9PSBcImVycm9yXCIpIHtcbiAgICAgIC8vIFJlbW92ZSBlcnJvcnNcbiAgICAgIHRoaXMuX2hpZGVGaWxlRXJyb3IoKTtcbiAgICAgIHRoaXMuX2hpZGVUZXh0RXJyb3IoKTtcbiAgICAgIHRoaXMubW9kZWwuc2V0KCdzdGF0ZScsICdzZWxlY3RlZCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zaG93VGV4dEVycm9yKCk7XG4gICAgfVxuICB9LFxuXG4gIF9jaGVja1Zpc2liaWxpdHk6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzdGF0ZSA9IHRoaXMubW9kZWwuZ2V0KCdzdGF0ZScpO1xuICAgIHRoaXNbIHN0YXRlICE9PSBcInNlbGVjdGVkXCIgPyAnc2hvdycgOiAnaGlkZScgXSgpXG4gIH0sXG5cbiAgY2xlYW46IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2Rlc3Ryb3lEcm9wem9uZSgpO1xuICAgIHRoaXMuJCgnLmpzLWZpbGVJbnB1dCcpLnVuYmluZCgnY2hhbmdlJyk7XG4gICAgdGhpcy5lbGRlcignY2xlYW4nKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqICBEYXRhIGhlYWRlciB2aWV3XG4gKlxuICogIC0gSXQgd2lsbCBjaGFuZ2Ugd2hlbiB1cGxvYWQgc3RhdGUgY2hhbmdlc1xuICogIC0gUG9zc2liaWxpdHkgdG8gY2hhbmdlIHN0YXRlIHdpdGggYSBoZWFkZXIgYnV0dG9uXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtYmFjayc6ICdfZ29Ub1N0YXJ0J1xuICB9LFxuXG4gIG9wdGlvbnM6IHtcbiAgICBmaWxlRW5hYmxlZDogZmFsc2UsXG4gICAgYWNjZXB0U3luYzogZmFsc2VcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSh0aGlzLm9wdGlvbnMudGVtcGxhdGUgfHwgJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9pbXBvcnRfdHlwZXMvZGF0YV9oZWFkZXInKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICB0aGlzLl9jaGVja1Zpc2liaWxpdHkoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBhY2NlcHRTeW5jID0gdGhpcy5vcHRpb25zLmFjY2VwdFN5bmMgJiYgdGhpcy51c2VyLmdldCgnYWN0aW9ucycpICYmIHRoaXMudXNlci5nZXQoJ2FjdGlvbnMnKS5zeW5jX3RhYmxlcyAmJiB0aGlzLm1vZGVsLmdldCgndHlwZScpICE9PSBcImZpbGVcIjsgXG4gICAgXG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIHRoaXMudGVtcGxhdGUoe1xuICAgICAgICB0eXBlOiB0aGlzLm1vZGVsLmdldCgndHlwZScpLFxuICAgICAgICBmaWxlRW5hYmxlZDogdGhpcy5vcHRpb25zLmZpbGVFbmFibGVkLFxuICAgICAgICBhY2NlcHRTeW5jOiBhY2NlcHRTeW5jLFxuICAgICAgICBzdGF0ZTogdGhpcy5tb2RlbC5nZXQoJ3N0YXRlJylcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLl9jaGVja1Zpc2liaWxpdHkoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpzdGF0ZScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgfSxcblxuICBfY2hlY2tWaXNpYmlsaXR5OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNob3coKVxuICB9LFxuXG4gIF9nb1RvU3RhcnQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuc2V0KCdzdGF0ZScsICdpZGxlJyk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbmNkYi5hZG1pbiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXVsnYWRtaW4nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddWydhZG1pbiddIDogbnVsbCk7XG52YXIgVXRpbHMgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ11bJ1V0aWxzJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXVsnVXRpbHMnXSA6IG51bGwpO1xudmFyIFNlbGVjdGVkRGF0YXNldCA9IHJlcXVpcmUoJy4vaW1wb3J0X3NlbGVjdGVkX2RhdGFzZXRfdmlldycpO1xuXG4vKipcbiAqICBTZWxlY3RlZCBBcmNHSVMgZGF0YXNldFxuICpcbiAqICAtIERpc3BsYXlzIHRoZSByZXN1bHQgd2hlbiBhbiBBcmNHSVMgdXJsL2RhdGFzZXQgaXMgc2VsZWN0ZWQsIG5vIG1hdHRlciB0aGUgdHlwZS5cbiAqICAtIEl0IHdpbGwgc2hvdyBhdmFpbGFibGUgc3luYyBvcHRpb25zIGlmIHVzZXIgY2FuIGFuZCB0aGUgdXJsIGlzIGFuIEFyY0dJUyBsYXllci5cbiAqICAtIFVwZ3JhZGUgbGluayBmb3IgcGVvcGxlIHdobyBkb24ndCBoYXZlIHN5bmMgcGVybWlzc2lvbnMuXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gU2VsZWN0ZWREYXRhc2V0LmV4dGVuZCh7XG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgdGl0bGUgPSB0aGlzLm9wdGlvbnMuZmlsZUF0dHJzLnRpdGxlICYmIHRoaXMubW9kZWwuZ2V0KCd2YWx1ZScpW3RoaXMub3B0aW9ucy5maWxlQXR0cnMudGl0bGVdIHx8IHRoaXMubW9kZWwuZ2V0KCd2YWx1ZScpO1xuICAgIHZhciBkZXNjcmlwdGlvbiA9IHRoaXMuX2dlbkRlc2NyaXB0aW9uKCk7XG4gICAgdmFyIGV4dCA9IHRoaXMub3B0aW9ucy5maWxlQXR0cnMuZXh0ID8gVXRpbHMuZ2V0RmlsZUV4dGVuc2lvbih0aXRsZSkgOiAnJyA7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLmZpbGVBdHRycy5leHQpIHtcbiAgICAgIHRpdGxlID0gdGl0bGUgJiYgdGl0bGUucmVwbGFjZSgnLicgKyBleHQsICcnKTtcbiAgICB9XG5cbiAgICB2YXIgdXBncmFkZVVybCA9IHdpbmRvdy51cGdyYWRlX3VybDtcbiAgICB2YXIgdXNlckNhblN5bmMgPSB0aGlzLnVzZXIuZ2V0KCdhY3Rpb25zJykgJiYgdGhpcy51c2VyLmdldCgnYWN0aW9ucycpLnN5bmNfdGFibGVzO1xuICAgIHZhciBjdXN0b21JbnN0YWxsID0gY2RiLmNvbmZpZy5nZXQoJ2NhcnRvZGJfY29tX2hvc3RlZCcpO1xuXG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIHRoaXMudGVtcGxhdGUoe1xuICAgICAgICB0aXRsZTogdGl0bGUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbixcbiAgICAgICAgZXh0OiBleHQsXG4gICAgICAgIGludGVydmFsOiB0aGlzLm1vZGVsLmdldCgnaW50ZXJ2YWwnKSxcbiAgICAgICAgaW1wb3J0Q2FuU3luYzogdGhpcy5vcHRpb25zLmFjY2VwdFN5bmMgJiYgdGhpcy5faXNBcmNHSVNMYXllcih0aXRsZSksXG4gICAgICAgIHVzZXJDYW5TeW5jOiB1c2VyQ2FuU3luYyxcbiAgICAgICAgc2hvd1RyaWFsOiB0aGlzLnVzZXIuY2FuU3RhcnRUcmlhbCgpLFxuICAgICAgICBzaG93VXBncmFkZTogIXVzZXJDYW5TeW5jICYmICFjdXN0b21JbnN0YWxsICYmIHVwZ3JhZGVVcmwgJiYgIXRoaXMudXNlci5pc0luc2lkZU9yZygpLFxuICAgICAgICB1cGdyYWRlVXJsOiB1cGdyYWRlVXJsXG4gICAgICB9KVxuICAgICk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2lzQXJjR0lTTGF5ZXI6IGZ1bmN0aW9uKHVybCkge1xuICAgIHJldHVybiB1cmwuc2VhcmNoKC8oWzAtOV0rXFwvfFswLTldKykvKSAhPT0gLTFcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuY2RiLmFkbWluID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydhZG1pbiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ2FkbWluJ10gOiBudWxsKTtcbnZhciBGb3JtVmlldyA9IHJlcXVpcmUoJy4vZGF0YV9pbXBvcnQvZGF0YV9mb3JtX3ZpZXcnKTtcbnZhciBIZWFkZXJWaWV3ID0gcmVxdWlyZSgnLi9kYXRhX2ltcG9ydC9kYXRhX2hlYWRlcl92aWV3Jyk7XG52YXIgU2VsZWN0ZWREYXRhc2V0ID0gcmVxdWlyZSgnLi9pbXBvcnRfYXJjZ2lzX3NlbGVjdGVkX2RhdGFzZXRfdmlldycpO1xudmFyIEltcG9ydERhdGFWaWV3ID0gcmVxdWlyZSgnLi9pbXBvcnRfZGF0YV92aWV3Jyk7XG5cbi8qKlxuICogIEltcG9ydCBBcmNHSVMgcGFuZWxcbiAqXG4gKiAgLSBJdCBvbmx5IGFjY2VwdHMgYW4gdXJsLCBhbmQgaXQgY291bGQgYmUgYSBtYXAgb3IgYSBsYXllci5cbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBJbXBvcnREYXRhVmlldy5leHRlbmQoe1xuXG4gIG9wdGlvbnM6IHtcbiAgICBmaWxlRXh0ZW5zaW9uczogW10sXG4gICAgdHlwZTogJ3NlcnZpY2UnLFxuICAgIHNlcnZpY2U6ICdhcmNnaXMnLFxuICAgIGFjY2VwdFN5bmM6IHRydWUsXG4gICAgZmlsZUVuYWJsZWQ6IGZhbHNlLFxuICAgIGZpbGVBdHRyczoge1xuICAgICAgZXh0OiBmYWxzZSxcbiAgICAgIHRpdGxlOiAnJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnJ1xuICAgIH1cbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICAvLyBEYXRhIGhlYWRlclxuICAgIHZhciBoZWFkZXJWaWV3ID0gbmV3IEhlYWRlclZpZXcoe1xuICAgICAgZWw6IHRoaXMuJCgnLkltcG9ydFBhbmVsLWhlYWRlcicpLFxuICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICB1c2VyOiB0aGlzLnVzZXIsXG4gICAgICBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb24sXG4gICAgICBmaWxlRW5hYmxlZDogdGhpcy5vcHRpb25zLmZpbGVFbmFibGVkLFxuICAgICAgYWNjZXB0U3luYzogdGhpcy5vcHRpb25zLmFjY2VwdFN5bmMsXG4gICAgICB0ZW1wbGF0ZTogJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9pbXBvcnRfdHlwZXMvZGF0YV9oZWFkZXJfYXJjZ2lzJ1xuICAgIH0pO1xuICAgIGhlYWRlclZpZXcucmVuZGVyKCk7XG4gICAgdGhpcy5hZGRWaWV3KGhlYWRlclZpZXcpO1xuXG4gICAgLy8gRGF0YXNldCBzZWxlY3RlZFxuICAgIHZhciBzZWxlY3RlZCA9IG5ldyBTZWxlY3RlZERhdGFzZXQoe1xuICAgICAgZWw6IHRoaXMuJCgnLkRhdGFzZXRTZWxlY3RlZCcpLFxuICAgICAgdXNlcjogdGhpcy51c2VyLFxuICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICBhY2NlcHRTeW5jOiB0aGlzLm9wdGlvbnMuYWNjZXB0U3luYyxcbiAgICAgIGZpbGVBdHRyczogdGhpcy5vcHRpb25zLmZpbGVBdHRyc1xuICAgIH0pO1xuICAgIHNlbGVjdGVkLnJlbmRlcigpO1xuICAgIHRoaXMuYWRkVmlldyhzZWxlY3RlZCk7XG5cbiAgICAvLyBEYXRhIEZvcm1cbiAgICB2YXIgZm9ybVZpZXcgPSBuZXcgRm9ybVZpZXcoe1xuICAgICAgZWw6IHRoaXMuJCgnLkltcG9ydFBhbmVsLWZvcm0nKSxcbiAgICAgIHVzZXI6IHRoaXMudXNlcixcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLFxuICAgICAgdGVtcGxhdGU6ICdjb21tb24vdmlld3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0X3R5cGVzL2RhdGFfZm9ybV9hcmNnaXMnLFxuICAgICAgZmlsZUVuYWJsZWQ6IHRoaXMub3B0aW9ucy5maWxlRW5hYmxlZFxuICAgIH0pO1xuXG4gICAgZm9ybVZpZXcucmVuZGVyKCk7XG4gICAgdGhpcy5hZGRWaWV3KGZvcm1WaWV3KTtcblxuICB9XG5cbn0pXG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbmNkYi5hZG1pbiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXVsnYWRtaW4nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddWydhZG1pbiddIDogbnVsbCk7XG52YXIgSW1wb3J0RGVmYXVsdFZpZXcgPSByZXF1aXJlKCcuL2ltcG9ydF9kZWZhdWx0X3ZpZXcnKTtcbnZhciBVcGxvYWRNb2RlbCA9IHJlcXVpcmUoJy4uLy4uLy4uLy4uL2JhY2tncm91bmRfcG9sbGluZy9tb2RlbHMvdXBsb2FkX21vZGVsJyk7XG52YXIgRm9ybVZpZXcgPSByZXF1aXJlKCcuL2RhdGFfaW1wb3J0L2RhdGFfZm9ybV92aWV3Jyk7XG52YXIgSGVhZGVyVmlldyA9IHJlcXVpcmUoJy4vZGF0YV9pbXBvcnQvZGF0YV9oZWFkZXJfdmlldycpO1xudmFyIFNlbGVjdGVkRGF0YXNldCA9IHJlcXVpcmUoJy4vaW1wb3J0X3NlbGVjdGVkX2RhdGFzZXRfdmlldycpO1xuXG4vKipcbiAqICBJbXBvcnQgZGF0YSBwYW5lbFxuICpcbiAqICAtIEl0IGFjY2VwdHMgYW4gdXJsXG4gKiAgLSBJdCBjaGVja3MgaWYgaXQgaXMgdmFsaWRcbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBJbXBvcnREZWZhdWx0Vmlldy5leHRlbmQoe1xuXG4gIG9wdGlvbnM6IHtcbiAgICBmaWxlRXh0ZW5zaW9uczogW10sXG4gICAgdHlwZTogJ3VybCcsXG4gICAgc2VydmljZTogJycsXG4gICAgYWNjZXB0U3luYzogZmFsc2UsXG4gICAgZmlsZUVuYWJsZWQ6IGZhbHNlLFxuICAgIGZvcm1UZW1wbGF0ZTogJycsXG4gICAgaGVhZGVyVGVtcGxhdGU6ICcnLFxuICAgIGZpbGVBdHRyczoge31cbiAgfSxcblxuICBjbGFzc05hbWU6ICdJbXBvcnRQYW5lbCBJbXBvcnREYXRhUGFuZWwnLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMubW9kZWwgPSBuZXcgVXBsb2FkTW9kZWwoe1xuICAgICAgdHlwZTogdGhpcy5vcHRpb25zLnR5cGUsXG4gICAgICBzZXJ2aWNlX25hbWU6IHRoaXMub3B0aW9ucy5zZXJ2aWNlXG4gICAgfSwge1xuICAgICAgdXNlcjogdGhpcy51c2VyXG4gICAgfSk7XG5cbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL3ZpZXdzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydF90eXBlcy9pbXBvcnRfZGF0YScpO1xuXG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcbiAgICB0aGlzLiRlbC5odG1sKHRoaXMudGVtcGxhdGUoKSk7XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgLy8gRGF0YSBoZWFkZXJcbiAgICB2YXIgaGVhZGVyVmlldyA9IG5ldyBIZWFkZXJWaWV3KHtcbiAgICAgIGVsOiB0aGlzLiQoJy5JbXBvcnRQYW5lbC1oZWFkZXInKSxcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLFxuICAgICAgdXNlcjogdGhpcy51c2VyLFxuICAgICAgZmlsZUVuYWJsZWQ6IHRoaXMub3B0aW9ucy5maWxlRW5hYmxlZCxcbiAgICAgIGFjY2VwdFN5bmM6IHRoaXMub3B0aW9ucy5hY2NlcHRTeW5jLFxuICAgICAgdGVtcGxhdGU6IHRoaXMub3B0aW9ucy5oZWFkZXJUZW1wbGF0ZVxuICAgIH0pO1xuICAgIGhlYWRlclZpZXcucmVuZGVyKCk7XG4gICAgdGhpcy5hZGRWaWV3KGhlYWRlclZpZXcpO1xuXG4gICAgLy8gRGF0YXNldCBzZWxlY3RlZFxuICAgIHZhciBzZWxlY3RlZCA9IG5ldyBTZWxlY3RlZERhdGFzZXQoe1xuICAgICAgZWw6IHRoaXMuJCgnLkRhdGFzZXRTZWxlY3RlZCcpLFxuICAgICAgdXNlcjogdGhpcy51c2VyLFxuICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICBhY2NlcHRTeW5jOiB0aGlzLm9wdGlvbnMuYWNjZXB0U3luYyxcbiAgICAgIGZpbGVBdHRyczogdGhpcy5vcHRpb25zLmZpbGVBdHRyc1xuICAgIH0pO1xuICAgIHNlbGVjdGVkLnJlbmRlcigpO1xuICAgIHRoaXMuYWRkVmlldyhzZWxlY3RlZCk7XG5cbiAgICAvLyBEYXRhIEZvcm1cbiAgICB2YXIgZm9ybVZpZXcgPSBuZXcgRm9ybVZpZXcoe1xuICAgICAgZWw6IHRoaXMuJCgnLkltcG9ydFBhbmVsLWZvcm0nKSxcbiAgICAgIHVzZXI6IHRoaXMudXNlcixcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLFxuICAgICAgdGVtcGxhdGU6IHRoaXMub3B0aW9ucy5mb3JtVGVtcGxhdGUsXG4gICAgICBmaWxlRW5hYmxlZDogdGhpcy5vcHRpb25zLmZpbGVFbmFibGVkXG4gICAgfSk7XG5cbiAgICBmb3JtVmlldy5iaW5kKCdmaWxlU2VsZWN0ZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgIHNlbGVjdGVkLnNldE9wdGlvbnMoe1xuICAgICAgICBhY2NlcHRTeW5jOiBmYWxzZSxcbiAgICAgICAgZmlsZUF0dHJzOiB7XG4gICAgICAgICAgZXh0OiB0cnVlLFxuICAgICAgICAgIHRpdGxlOiAnbmFtZScsXG4gICAgICAgICAgZGVzY3JpcHRpb246IHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IFt7XG4gICAgICAgICAgICAgIG5hbWU6ICdzaXplJyxcbiAgICAgICAgICAgICAgZm9ybWF0OiAnc2l6ZSdcbiAgICAgICAgICAgIH1dXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGZvcm1WaWV3LmJpbmQoJ3VybFNlbGVjdGVkJywgZnVuY3Rpb24oKSB7XG4gICAgICBzZWxlY3RlZC5zZXRPcHRpb25zKHtcbiAgICAgICAgYWNjZXB0U3luYzogdHJ1ZSxcbiAgICAgICAgZmlsZUF0dHJzOiB7XG4gICAgICAgICAgZXh0OiBmYWxzZSxcbiAgICAgICAgICB0aXRsZTogJycsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICcnXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGZvcm1WaWV3LnJlbmRlcigpO1xuICAgIHRoaXMuYWRkVmlldyhmb3JtVmlldyk7XG5cbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpzdGF0ZScsIHRoaXMuX2NoZWNrU3RhdGUsIHRoaXMpO1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlJywgdGhpcy5fdHJpZ2dlckNoYW5nZSwgdGhpcyk7XG4gIH0sXG5cbiAgX2NoZWNrU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm1vZGVsLnByZXZpb3VzKCdzdGF0ZScpID09PSBcInNlbGVjdGVkXCIpIHtcbiAgICAgIHRoaXMubW9kZWwuc2V0KHtcbiAgICAgICAgdHlwZTogdW5kZWZpbmVkLFxuICAgICAgICB2YWx1ZTogJycsXG4gICAgICAgIHNlcnZpY2VfbmFtZTogJycsXG4gICAgICAgIHNlcnZpY2VfaXRlbV9pZDogJycsXG4gICAgICAgIGludGVydmFsOiAwXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxufSlcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqICBJbXBvcnQgZmFsbGJhY2sgZGVmYXVsdCBwYW5lbFxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdJbXBvcnRQYW5lbCcsXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7IFxuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCB0aGlzLm9wdGlvbnMudGVtcGxhdGUgfHwgJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9pbXBvcnRfZGVmYXVsdF9mYWxsYmFjaycgKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmFwcGVuZCh0aGlzLnRlbXBsYXRlKCkpO1xuICB9XG5cbn0pIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgVXBsb2FkTW9kZWwgPSByZXF1aXJlKCcuLi8uLi8uLi8uLi9iYWNrZ3JvdW5kX3BvbGxpbmcvbW9kZWxzL3VwbG9hZF9tb2RlbCcpO1xuXG4vKipcbiAqICBEZWZhdWx0IHZpZXcgZm9yIGFuIGltcG9ydCBpdGVtXG4gKlxuICogIC0gSXQgaXMgYmFzZWQgaW4gYW4gdXBsb2FkIG1vZGVsLlxuICogIC0gV2lsbCB0cmlnZ2VyIGEgY2hhbmdlIHdoZW4gbW9kZWwgY2hhbmdlcy5cbiAqICAtIEl0IHJldHVybnMgdGhlaXIgZGF0YSBpZiBpdCBpcyByZXF1ZXN0ZWQgd2l0aCBhIG1ldGhvZC5cbiAqL1xuXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMubW9kZWwgPSBuZXcgVXBsb2FkTW9kZWwobnVsbCwgeyB1c2VyOiB0aGlzLnVzZXIgfSk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2UnLCB0aGlzLl90cmlnZ2VyQ2hhbmdlLCB0aGlzKTtcbiAgfSxcblxuICBfdHJpZ2dlckNoYW5nZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2UnLCB0aGlzLm1vZGVsLnRvSlNPTigpLCB0aGlzKTtcbiAgfSxcblxuICBnZXRNb2RlbERhdGE6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm1vZGVsKSB7XG4gICAgICByZXR1cm4gdGhpcy5tb2RlbC50b0pTT04oKVxuICAgIH1cbiAgICByZXR1cm4ge31cbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuY2RiLmFkbWluID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydhZG1pbiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ2FkbWluJ10gOiBudWxsKTtcbnZhciBVdGlscyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXVsnVXRpbHMnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddWydVdGlscyddIDogbnVsbCk7XG52YXIgcGx1cmFsaXplU3RyaW5nID0gcmVxdWlyZSgnLi4vLi4vLi4vLi4vdmlld19oZWxwZXJzL3BsdXJhbGl6ZV9zdHJpbmcnKTtcblxuLyoqXG4gKiAgU2VsZWN0ZWQgZGF0YXNldFxuICpcbiAqICAtIERpc3BsYXlzIHRoZSByZXN1bHQgd2hlbiBhIGRhdGFzZXQgaXMgc2VsZWN0ZWQsIG5vIG1hdHRlciB0aGUgdHlwZS5cbiAqICAtIEl0IHdpbGwgc2hvdyBhdmFpbGFibGUgc3luYyBvcHRpb25zIGlmIHRoYXQgaW1wb3J0IGxldHMgaXQuXG4gKiAgLSBVcGdyYWRlIGxpbmsgZm9yIHBlb3BsZSB3aG8gZG9uJ3QgaGF2ZSBzeW5jIHBlcm1pc3Npb25zLlxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdEYXRhc2V0U2VsZWN0ZWQnLFxuXG4gIF9GT1JNQVRURVJTOiB7XG4gICAgJ3NpemUnOiBVdGlscy5yZWFkYWJsaXplQnl0ZXMsXG4gICAgJ251bWJlcic6IFV0aWxzLmZvcm1hdE51bWJlclxuICB9LFxuXG4gIG9wdGlvbnM6IHtcbiAgICBhY2NlcHRTeW5jOiBmYWxzZSxcbiAgICBmaWxlQXR0cnM6IHtcbiAgICAgIGV4dDogZmFsc2UsXG4gICAgICB0aXRsZTogJycsXG4gICAgICBkZXNjcmlwdGlvbjoge1xuICAgICAgICBjb250ZW50OiBbe1xuICAgICAgICAgIG5hbWU6ICdpZCcsXG4gICAgICAgICAgZm9ybWF0OiAnJ1xuICAgICAgICB9XSxcbiAgICAgICAgaXRlbU5hbWU6ICcnLFxuICAgICAgICBzZXBhcmF0b3I6ICcnXG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtaW50ZXJ2YWwtMCc6ICdfb25JbnRlcnZhbFplcm8nLFxuICAgICdjbGljayAuanMtaW50ZXJ2YWwtMSc6ICdfb25JbnRlcnZhbEhvdXInLFxuICAgICdjbGljayAuanMtaW50ZXJ2YWwtMic6ICdfb25JbnRlcnZhbERheScsXG4gICAgJ2NsaWNrIC5qcy1pbnRlcnZhbC0zJzogJ19vbkludGVydmFsV2VlaycsXG4gICAgJ2NsaWNrIC5qcy1pbnRlcnZhbC00JzogJ19vbkludGVydmFsTW9udGgnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5vcHRpb25zLnVzZXI7XG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9pbXBvcnRfc2VsZWN0ZWRfZGF0YXNldCcpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICAgIHRoaXMuX2NoZWNrVmlzaWJpbGl0eSgpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRpdGxlID0gdGhpcy5vcHRpb25zLmZpbGVBdHRycy50aXRsZSAmJiB0aGlzLm1vZGVsLmdldCgndmFsdWUnKVt0aGlzLm9wdGlvbnMuZmlsZUF0dHJzLnRpdGxlXSB8fCB0aGlzLm1vZGVsLmdldCgndmFsdWUnKTtcbiAgICB2YXIgZGVzY3JpcHRpb24gPSB0aGlzLl9nZW5EZXNjcmlwdGlvbigpO1xuICAgIHZhciBleHQgPSB0aGlzLm9wdGlvbnMuZmlsZUF0dHJzLmV4dCA/IFV0aWxzLmdldEZpbGVFeHRlbnNpb24odGl0bGUpIDogJycgO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5maWxlQXR0cnMuZXh0KSB7XG4gICAgICB0aXRsZSA9IHRpdGxlICYmIHRpdGxlLnJlcGxhY2UoJy4nICsgZXh0LCAnJyk7XG4gICAgfVxuXG4gICAgdmFyIHVwZ3JhZGVVcmwgPSB3aW5kb3cudXBncmFkZV91cmw7XG4gICAgdmFyIHVzZXJDYW5TeW5jID0gdGhpcy51c2VyLmdldCgnYWN0aW9ucycpICYmIHRoaXMudXNlci5nZXQoJ2FjdGlvbnMnKS5zeW5jX3RhYmxlcztcbiAgICB2YXIgY3VzdG9tSW5zdGFsbCA9IGNkYi5jb25maWcuZ2V0KCdjYXJ0b2RiX2NvbV9ob3N0ZWQnKTtcblxuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLnRlbXBsYXRlKHtcbiAgICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sXG4gICAgICAgIGV4dDogZXh0LFxuICAgICAgICBpbnRlcnZhbDogdGhpcy5tb2RlbC5nZXQoJ2ludGVydmFsJyksXG4gICAgICAgIGltcG9ydENhblN5bmM6IHRoaXMub3B0aW9ucy5hY2NlcHRTeW5jLFxuICAgICAgICB1c2VyQ2FuU3luYzogdXNlckNhblN5bmMsXG4gICAgICAgIHNob3dUcmlhbDogdGhpcy51c2VyLmNhblN0YXJ0VHJpYWwoKSxcbiAgICAgICAgc2hvd1VwZ3JhZGU6ICF1c2VyQ2FuU3luYyAmJiAhY3VzdG9tSW5zdGFsbCAmJiB1cGdyYWRlVXJsICYmICF0aGlzLnVzZXIuaXNJbnNpZGVPcmcoKSxcbiAgICAgICAgdXBncmFkZVVybDogdXBncmFkZVVybFxuICAgICAgfSlcbiAgICApO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOnZhbHVlJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOmludGVydmFsJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOnN0YXRlJywgdGhpcy5fY2hlY2tWaXNpYmlsaXR5LCB0aGlzKTtcbiAgfSxcblxuICBfZ2VuRGVzY3JpcHRpb246IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZmlsZUF0dHJzICYmIHRoaXMub3B0aW9ucy5maWxlQXR0cnMuZGVzY3JpcHRpb24pIHtcbiAgICAgIHZhciBkZXNjcmlwdGlvbk9wdHMgPSB0aGlzLm9wdGlvbnMuZmlsZUF0dHJzLmRlc2NyaXB0aW9uO1xuICAgICAgdmFyIGRlc2NyaXB0aW9uS2V5VmFsdWUgPSAnJztcbiAgICAgIHZhciBkZXNjcmlwdGlvblN0ciA9ICcnO1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICBpZiAoZGVzY3JpcHRpb25PcHRzLmNvbnRlbnQgJiYgZGVzY3JpcHRpb25PcHRzLmNvbnRlbnQubGVuZ3RoID4gMCkge1xuICAgICAgICBfLmVhY2goZGVzY3JpcHRpb25PcHRzLmNvbnRlbnQsIGZ1bmN0aW9uKGl0ZW0sIGkpIHtcblxuICAgICAgICAgIGlmIChpID4gMCAmJiBkZXNjcmlwdGlvbk9wdHMuc2VwYXJhdG9yKSB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvblN0ciArPSBcIiBcIiArIGRlc2NyaXB0aW9uT3B0cy5zZXBhcmF0b3IgKyAnICc7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIHZhbHVlID0gc2VsZi5tb2RlbC5nZXQoJ3ZhbHVlJylbaXRlbS5uYW1lXTtcbiAgICAgICAgICB2YXIgZm9ybWF0ID0gaXRlbS5mb3JtYXQgJiYgc2VsZi5fRk9STUFUVEVSU1tpdGVtLmZvcm1hdF07XG4gICAgICAgICAgZGVzY3JpcHRpb25TdHIgKz0gZm9ybWF0ICYmIGZvcm1hdCh2YWx1ZSkgfHwgdmFsdWU7XG5cbiAgICAgICAgICBpZiAoaXRlbS5rZXkpIHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uS2V5VmFsdWUgPSBpdGVtLm5hbWU7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfVxuXG4gICAgICBpZiAoZGVzY3JpcHRpb25PcHRzLml0ZW1OYW1lICYmIGRlc2NyaXB0aW9uS2V5VmFsdWUpIHtcbiAgICAgICAgZGVzY3JpcHRpb25TdHIgKz0gJyAnICsgKGRlc2NyaXB0aW9uT3B0cy5pdGVtTmFtZSAmJiBwbHVyYWxpemVTdHJpbmcoZGVzY3JpcHRpb25PcHRzLml0ZW1OYW1lLCBkZXNjcmlwdGlvbktleVZhbHVlKSB8fCAnJyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBkZXNjcmlwdGlvblN0cjtcbiAgICB9XG5cbiAgICByZXR1cm4gJyc7XG4gIH0sXG5cbiAgX29uSW50ZXJ2YWxaZXJvOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLnNldCgnaW50ZXJ2YWwnLCAwKTtcbiAgfSxcblxuICBfb25JbnRlcnZhbEhvdXI6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuYWNjZXB0U3luYyAmJiB0aGlzLnVzZXIuZ2V0KCdhY3Rpb25zJykuc3luY190YWJsZXMpIHtcbiAgICAgIHRoaXMubW9kZWwuc2V0KCdpbnRlcnZhbCcsIDM2MDApO1xuICAgIH1cbiAgfSxcblxuICBfb25JbnRlcnZhbERheTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5hY2NlcHRTeW5jICYmIHRoaXMudXNlci5nZXQoJ2FjdGlvbnMnKS5zeW5jX3RhYmxlcykge1xuICAgICAgdGhpcy5tb2RlbC5zZXQoJ2ludGVydmFsJywgODY0MDApO1xuICAgIH1cbiAgfSxcblxuICBfb25JbnRlcnZhbFdlZWs6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuYWNjZXB0U3luYyAmJiB0aGlzLnVzZXIuZ2V0KCdhY3Rpb25zJykuc3luY190YWJsZXMpIHtcbiAgICAgIHRoaXMubW9kZWwuc2V0KCdpbnRlcnZhbCcsIDYwNDgwMCk7XG4gICAgfVxuICB9LFxuXG4gIF9vbkludGVydmFsTW9udGg6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuYWNjZXB0U3luYyAmJiB0aGlzLnVzZXIuZ2V0KCdhY3Rpb25zJykuc3luY190YWJsZXMpIHtcbiAgICAgIHRoaXMubW9kZWwuc2V0KCdpbnRlcnZhbCcsIDI1OTIwMDApO1xuICAgIH1cbiAgfSxcblxuICAvLyBDaGFuZ2Ugb3B0aW9uc1xuICBzZXRPcHRpb25zOiBmdW5jdGlvbihkKSB7XG4gICAgaWYgKGQgJiYgIV8uaXNFbXB0eShkKSkge1xuICAgICAgXy5leHRlbmQodGhpcy5vcHRpb25zLCBkKTtcbiAgICB9XG4gIH0sXG5cbiAgX2NoZWNrVmlzaWJpbGl0eTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHN0YXRlID0gdGhpcy5tb2RlbC5nZXQoJ3N0YXRlJyk7XG4gICAgaWYgKHN0YXRlID09PSAnc2VsZWN0ZWQnKSB7XG4gICAgICB0aGlzLnNob3coKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5oaWRlKCk7XG4gICAgfVxuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5jZGIuYWRtaW4gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ11bJ2FkbWluJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXVsnYWRtaW4nXSA6IG51bGwpO1xudmFyIEltcG9ydERlZmF1bHRWaWV3ID0gcmVxdWlyZSgnLi4vaW1wb3J0X2RlZmF1bHRfdmlldycpO1xudmFyIFVwbG9hZE1vZGVsID0gcmVxdWlyZSgnLi4vLi4vLi4vLi4vLi4vYmFja2dyb3VuZF9wb2xsaW5nL21vZGVscy91cGxvYWRfbW9kZWwnKTtcbnZhciBTZXJ2aWNlSGVhZGVyID0gcmVxdWlyZSgnLi9zZXJ2aWNlX2hlYWRlcl92aWV3Jyk7XG52YXIgU2VydmljZUxvYWRlciA9IHJlcXVpcmUoJy4vc2VydmljZV9sb2FkZXJfdmlldycpO1xudmFyIFNlcnZpY2VMaXN0ID0gcmVxdWlyZSgnLi9zZXJ2aWNlX2xpc3RfdmlldycpO1xudmFyIFNlcnZpY2VTZWxlY3RlZEZpbGUgPSByZXF1aXJlKCcuLi9pbXBvcnRfc2VsZWN0ZWRfZGF0YXNldF92aWV3Jyk7XG52YXIgU2VydmljZVRva2VuID0gcmVxdWlyZSgnLi4vLi4vLi4vLi4vLi4vc2VydmljZV9tb2RlbHMvc2VydmljZV90b2tlbl9tb2RlbCcpO1xudmFyIFNlcnZpY2VPYXV0aCA9IHJlcXVpcmUoJy4uLy4uLy4uLy4uLy4uL3NlcnZpY2VfbW9kZWxzL3NlcnZpY2Vfb2F1dGhfbW9kZWwnKTtcbnZhciBTZXJ2aWNlQ29sbGVjdGlvbiA9IHJlcXVpcmUoJy4vc2VydmljZV9pdGVtc19jb2xsZWN0aW9uJyk7XG5cbi8qKlxuICogIEltcG9ydCBzZXJ2aWNlIHZpZXdcbiAqXG4gKiAgLSBVc2UgYSBzZXJ2aWNlIGltcG9ydCBwYW5lbFxuICogIC0gSXQgd2lsbCByZXF1ZXN0IGxvZ2luIHRvIHRoZSBzZXJ2aWNlXG4gKiAgLSBJZiBpdCB3b3JrcywgYSBsaXN0IG9mIGF2YWlsYWJsZSBmaWxlcyB3aWxsIGFwcGVhci5cbiAqICAtIE9uY2UgYSBmaWxlIGlzIHNlbGVjdGVkLCBzeW5jIG9wdGlvbnMgd2lsbCBhcHBlYXIuXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gSW1wb3J0RGVmYXVsdFZpZXcuZXh0ZW5kKHtcblxuICBfREFUQVNPVVJDRV9OQU1FOiAnJyxcbiAgX1dJTkRPV19JTlRFUlZBTDogMTAwMCwgLy8gbWlsaXNlY29uZHNcblxuICBjbGFzc05hbWU6ICdJbXBvcnRQYW5lbCBJbXBvcnRQYW5lbFNlcnZpY2UnLFxuXG4gIG9wdGlvbnM6IHtcbiAgICBzZXJ2aWNlOiAnJywgICAgICAgICAgICAgICAgICAvLyBOYW1lIG9mIHRoZSBzZXJ2aWNlXG4gICAgc2hvd0F2YWlsYWJsZUZvcm1hdHM6IGZhbHNlLCAgLy8gSWYgYWxsIGF2YWlsYWJsZSBmb3JtYXQgbGluayBzaG91bGQgYXBwZWFyIG9yIG5vdFxuICAgIGZpbGVFeHRlbnNpb25zOiBbXSwgICAgICAgICAgIC8vIEZpbGUgZXh0ZW5zaW9uc1xuICAgIGFjY2VwdFN5bmM6IGZhbHNlLCAgICAgICAgICAgIC8vIEFjY2VwdCBzeW5jIHRoaXMgc2VydmljZT9cbiAgICBmaWxlQXR0cnM6IHsgICAgICAgICAgICAgICAgICAvLyBBdHRyaWJ1dGVzIG9yIGNoYW5nZXMgZm9yIHNlcnZpY2UgbGlzdCBvciBzZWxlY3RlZCBmaWxlOlxuICAgICAgZXh0OiBmYWxzZSwgICAgICAgICAgICAgICAgIC8vIElmIGZpbGVzIHNob3VsZCBzaG93IGV4dGVuc2lvblxuICAgICAgdGl0bGU6ICdmaWxlbmFtZScsICAgICAgICAgIC8vIFRpdGxlIGF0dHJpYnV0ZVxuICAgICAgZGVzY3JpcHRpb246ICc8JS0gc2l6ZSAlPicsIC8vIERlc2NyaXB0aW9uIGF0dHJpYnV0ZVxuICAgICAgZm9ybWF0RGVzY3JpcHRpb246ICdzaXplJywgIC8vIElmIGFueSBmb3JtYXQgZnVuY3Rpb24gc2hvdWxkIGJlIGFwcGxpZWQgb3ZlciB0aGUgZGVzY3JpcHRpb25cbiAgICAgIGhlYWRlclRlbXBsYXRlOiAnJyAgICAgICAgICAvLyBIZWFkZXIgdGVtcGxhdGVcbiAgICB9XG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMuc2VydmljZSkge1xuICAgICAgY2RiLmxvZy5pbmZvKCdTZXJ2aWNlIHByb3ZpZGVyIG5vdCBzZXQgZm9yIGltcG9ydCBwYW5lbCEnKVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9EQVRBU09VUkNFX05BTUUgPSB0aGlzLm9wdGlvbnMuc2VydmljZTtcbiAgICB9XG5cbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLm1vZGVsID0gbmV3IFVwbG9hZE1vZGVsKHtcbiAgICAgIHR5cGU6ICdzZXJ2aWNlJyxcbiAgICAgIHNlcnZpY2VfbmFtZTogdGhpcy5fREFUQVNPVVJDRV9OQU1FXG4gICAgfSwgeyB1c2VyOiB0aGlzLnVzZXIgfSk7XG5cbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL3ZpZXdzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydF90eXBlcy9pbXBvcnRfc2VydmljZScpO1xuXG4gICAgdGhpcy5faW5pdE1vZGVscygpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy4kZWwuaHRtbCh0aGlzLnRlbXBsYXRlKHRoaXMub3B0aW9ucykpO1xuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0TW9kZWxzOiBmdW5jdGlvbigpIHtcbiAgICAvLyBUb2tlblxuICAgIHRoaXMudG9rZW4gPSBuZXcgU2VydmljZVRva2VuKG51bGwsIHsgZGF0YXNvdXJjZV9uYW1lOiB0aGlzLl9EQVRBU09VUkNFX05BTUUgfSk7XG4gICAgLy8gU2VydmljZSBtb2RlbFxuICAgIHRoaXMuc2VydmljZSA9IG5ldyBTZXJ2aWNlT2F1dGgobnVsbCwgeyBkYXRhc291cmNlX25hbWU6IHRoaXMuX0RBVEFTT1VSQ0VfTkFNRSB9KTtcbiAgICAvLyBMaXN0IGNvbGxlY3Rpb25cbiAgICB0aGlzLmNvbGxlY3Rpb24gPSBuZXcgU2VydmljZUNvbGxlY3Rpb24obnVsbCwgeyBkYXRhc291cmNlX25hbWU6IHRoaXMuX0RBVEFTT1VSQ0VfTkFNRSB9KTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZScsIHRoaXMuX3RyaWdnZXJDaGFuZ2UsIHRoaXMpO1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOnN0YXRlJywgdGhpcy5fY2hlY2tTdGF0ZSwgdGhpcyk7XG4gICAgdGhpcy50b2tlbi5iaW5kKCdjaGFuZ2U6b2F1dGhfdmFsaWQnLCB0aGlzLl9vbk9hdXRoQ2hhbmdlLCB0aGlzKTtcbiAgICB0aGlzLnNlcnZpY2UuYmluZCgnY2hhbmdlOnVybCcsIHRoaXMuX29wZW5XaW5kb3csIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5zZXJ2aWNlKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMudG9rZW4pO1xuICB9LFxuXG4gIF9pbml0Vmlld3M6IGZ1bmN0aW9uKCkge1xuICAgIC8vIEhlYWRlclxuICAgIHZhciBoZWFkZXIgPSBuZXcgU2VydmljZUhlYWRlcih7XG4gICAgICBlbDogdGhpcy4kKCcuSW1wb3J0UGFuZWwtaGVhZGVyJyksXG4gICAgICB1c2VyOiB0aGlzLnVzZXIsXG4gICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgIGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvbixcbiAgICAgIHRpdGxlOiB0aGlzLm9wdGlvbnMudGl0bGUsXG4gICAgICBzaG93QXZhaWxhYmxlRm9ybWF0czogdGhpcy5vcHRpb25zLnNob3dBdmFpbGFibGVGb3JtYXRzLFxuICAgICAgZmlsZUV4dGVuc2lvbnM6IHRoaXMub3B0aW9ucy5maWxlRXh0ZW5zaW9ucyxcbiAgICAgIGFjY2VwdFN5bmM6IHRoaXMub3B0aW9ucy5hY2NlcHRTeW5jLFxuICAgICAgdGVtcGxhdGU6IHRoaXMub3B0aW9ucy5oZWFkZXJUZW1wbGF0ZVxuICAgIH0pO1xuICAgIGhlYWRlci5yZW5kZXIoKTtcbiAgICB0aGlzLmFkZFZpZXcoaGVhZGVyKTtcblxuICAgIC8vIExvYWRlclxuICAgIHZhciBsb2FkZXIgPSBuZXcgU2VydmljZUxvYWRlcih7XG4gICAgICBlbDogdGhpcy4kKCcuU2VydmljZUxvYWRlcicpLFxuICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICB0b2tlbjogdGhpcy50b2tlbixcbiAgICAgIHNlcnZpY2U6IHRoaXMuc2VydmljZVxuICAgIH0pO1xuICAgIGxvYWRlci5yZW5kZXIoKTtcbiAgICB0aGlzLmFkZFZpZXcobG9hZGVyKTtcblxuICAgIC8vIExpc3RcbiAgICB2YXIgbGlzdCA9IG5ldyBTZXJ2aWNlTGlzdCh7XG4gICAgICBlbDogdGhpcy4kKCcuU2VydmljZUxpc3QnKSxcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLFxuICAgICAgY29sbGVjdGlvbjogdGhpcy5jb2xsZWN0aW9uLFxuICAgICAgdGl0bGU6IHRoaXMub3B0aW9ucy50aXRsZSxcbiAgICAgIGZpbGVBdHRyczogdGhpcy5vcHRpb25zLmZpbGVBdHRyc1xuICAgIH0pO1xuICAgIGxpc3QucmVuZGVyKCk7XG4gICAgdGhpcy5hZGRWaWV3KGxpc3QpO1xuXG4gICAgLy8gU2VsZWN0ZWQgZmlsZVxuICAgIHZhciBzZWxlY3RlZCA9IG5ldyBTZXJ2aWNlU2VsZWN0ZWRGaWxlKHtcbiAgICAgIGVsOiB0aGlzLiQoJy5TZXJ2aWNlU2VsZWN0ZWQnKSxcbiAgICAgIHVzZXI6IHRoaXMudXNlcixcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLFxuICAgICAgYWNjZXB0U3luYzogdGhpcy5vcHRpb25zLmFjY2VwdFN5bmMsXG4gICAgICBmaWxlQXR0cnM6IHRoaXMub3B0aW9ucy5maWxlQXR0cnNcbiAgICB9KTtcbiAgICBzZWxlY3RlZC5yZW5kZXIoKTtcbiAgICB0aGlzLmFkZFZpZXcoc2VsZWN0ZWQpO1xuICB9LFxuXG4gIF9vbk9hdXRoQ2hhbmdlOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy50b2tlbi5nZXQoJ29hdXRoX3ZhbGlkJykpIHtcbiAgICAgIHRoaXMuX2dldEZpbGVzKCk7XG4gICAgfVxuICB9LFxuXG4gIF9nZXRGaWxlczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdGhpcy5tb2RlbC5zZXQoJ3N0YXRlJywgJ3JldHJpZXZpbmcnKTtcblxuICAgIHRoaXMuY29sbGVjdGlvbi5mZXRjaCh7XG4gICAgICAvLyBkYXRhOiB7XG4gICAgICAvLyAgIGZpbHRlcjogdGhpcy5vcHRpb25zLmFjY2VwdEZpbGVUeXBlc1xuICAgICAgLy8gfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5tb2RlbC5zZXQoJ3N0YXRlJywgJ2Vycm9yJyk7XG4gICAgICB9LFxuICAgICAgc3VjY2VzczogIGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLm1vZGVsLnNldCgnc3RhdGUnLCAnbGlzdCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIF9jaGVja1N0YXRlOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3N0YXRlJykgPT09IFwibGlzdFwiKSB7XG4gICAgICBpZiAodGhpcy5jb2xsZWN0aW9uLnNpemUoKSA9PT0gMSkge1xuICAgICAgICB2YXIgaXRlbSA9IHRoaXMuY29sbGVjdGlvbi5hdCgwKTtcbiAgICAgICAgdGhpcy5tb2RlbC5zZXQoe1xuICAgICAgICAgIHN0YXRlOiAnc2VsZWN0ZWQnLFxuICAgICAgICAgIHZhbHVlOiBpdGVtLnRvSlNPTigpLFxuICAgICAgICAgIHNlcnZpY2VfaXRlbV9pZDogaXRlbS5nZXQoJ2lkJylcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLm1vZGVsLmdldCgnc3RhdGUnKSAhPT0gXCJzZWxlY3RlZFwiKSB7XG4gICAgICB0aGlzLm1vZGVsLnNldCh7XG4gICAgICAgIHZhbHVlOiAnJyxcbiAgICAgICAgc2VydmljZV9pdGVtX2lkOiAnJyxcbiAgICAgICAgaW50ZXJ2YWw6IDBcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBfb3BlbldpbmRvdzogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHVybCA9IHRoaXMuc2VydmljZS5nZXQoJ3VybCcpO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgaSA9IHdpbmRvdy5vcGVuKHVybCwgbnVsbCwgXCJtZW51YmFyPW5vLHRvb2xiYXI9bm8sd2lkdGg9NjAwLGhlaWdodD00OTVcIik7XG4gICAgdmFyIGUgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoaSAmJiBpLmNsb3NlZCkge1xuICAgICAgICBzZWxmLl9nZXRGaWxlcygpO1xuICAgICAgICBjbGVhckludGVydmFsKGUpXG4gICAgICB9IGVsc2UgaWYgKCFpKSB7XG4gICAgICAgIHNlbGYubW9kZWwuc2V0KCdzdGF0ZScsICdlcnJvcicpO1xuICAgICAgICBjbGVhckludGVydmFsKGUpXG4gICAgICB9XG4gICAgfSwgdGhpcy5fV0lORE9XX0lOVEVSVkFMKTtcbiAgfVxuXG59KVxuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogIFNlcnZpY2UgaGVhZGVyXG4gKlxuICogIC0gSXQgd2lsbCBjaGFuZ2Ugd2hlbiB1cGxvYWQgc3RhdGUgY2hhbmdlc1xuICogIC0gUG9zc2liaWxpdHkgdG8gY2hhbmdlIHN0YXRlIHdpdGggYSBoZWFkZXIgYnV0dG9uXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtYmFjayc6ICdfZ29Ub0xpc3QnXG4gIH0sXG5cbiAgb3B0aW9uczoge1xuICAgIHRpdGxlOiAnU2VydmljZScsXG4gICAgc2hvd0F2YWlsYWJsZUZvcm1hdHM6IGZhbHNlLFxuICAgIGFjY2VwdFN5bmM6IGZhbHNlLFxuICAgIGZpbGVFeHRlbnNpb25zOiBbXSxcbiAgICB0ZW1wbGF0ZTogJydcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSggdGhpcy5vcHRpb25zLnRlbXBsYXRlIHx8ICdjb21tb24vdmlld3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0X3R5cGVzL3NlcnZpY2VfaGVhZGVyJyApO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIHRoaXMudGVtcGxhdGUoe1xuICAgICAgICBpdGVtczogdGhpcy5jb2xsZWN0aW9uLnNpemUoKSxcbiAgICAgICAgc2VydmljZV9uYW1lOiB0aGlzLm1vZGVsLmdldChcInNlcnZpY2VfbmFtZVwiKSxcbiAgICAgICAgc2hvd0F2YWlsYWJsZUZvcm1hdHM6IHRoaXMub3B0aW9ucy5zaG93QXZhaWxhYmxlRm9ybWF0cyxcbiAgICAgICAgZmlsZUV4dGVuc2lvbnM6IHRoaXMub3B0aW9ucy5maWxlRXh0ZW5zaW9ucyxcbiAgICAgICAgYWNjZXB0U3luYzogdGhpcy5vcHRpb25zLmFjY2VwdFN5bmMgJiYgdGhpcy51c2VyLmdldCgnYWN0aW9ucycpLnN5bmNfdGFibGVzLFxuICAgICAgICBzdGF0ZTogdGhpcy5tb2RlbC5nZXQoJ3N0YXRlJyksXG4gICAgICAgIHRpdGxlOiB0aGlzLm9wdGlvbnMudGl0bGVcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLl9jaGVja1Zpc2liaWxpdHkoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpzdGF0ZScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgfSxcblxuICBfY2hlY2tWaXNpYmlsaXR5OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3RhdGUgPSB0aGlzLm1vZGVsLmdldCgnc3RhdGUnKTtcbiAgICB0aGlzWyBzdGF0ZSAhPT0gXCJsaXN0XCIgPyAnc2hvdycgOiAnaGlkZScgXSgpXG4gIH0sXG5cbiAgX2dvVG9MaXN0OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLnNldCgnc3RhdGUnLCAnbGlzdCcpO1xuICB9XG5cbn0pO1xuIiwidmFyIFV0aWxzID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydVdGlscyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ1V0aWxzJ10gOiBudWxsKTtcblxuLyoqXG4gKiAgU2VydmljZSBsaXN0IGl0ZW0gZm9ybWF0IHV0aWxzXG4gKlxuICogIC0gQ3JlYXRlIGN1c3RvbWl6ZWQgZnVuY3Rpb25zIGZvciBzZXJ2aWNlIGxpc3QgaXRlbXMuXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gIC8vIER1ZSB0byB0aGUgZmFjdCB0aGF0IGJhY2tlbmQgZGF0YSBzb3VyY2Ugc2VydmljZVxuICAvLyByZXR1cm5zIDAgc2l6ZSB3aGVuIGl0IGRvZXNuJ3Qga25vdyBpdFxuICBmb3JtYXRTaXplOiBmdW5jdGlvbihzKSB7XG4gICAgaWYgKHMgJiYgcyA+IDApIHtcbiAgICAgIHJldHVybiBVdGlscy5yZWFkYWJsaXplQnl0ZXMocyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAnVW5rbm93bidcbiAgICB9XG4gIH1cblxufSIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqICBTZXJ2aWNlIGl0ZW0gbW9kZWxcbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuICBcbiAgZGVmYXVsdHM6IHtcbiAgICBpZDogJycsXG4gICAgZmlsZW5hbWU6ICcnLFxuICAgIGNoZWNrc3VtOiAnJyxcbiAgICBzZXJ2aWNlOiAnJyxcbiAgICBzaXplOiAnJyxcbiAgICB0aXRsZTogJydcbiAgfVxuXG59KTsiLCJ2YXIgU2VydmljZUl0ZW0gPSByZXF1aXJlKCcuL3NlcnZpY2VfaXRlbV9tb2RlbC5qcycpO1xudmFyIEJhY2tib25lID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ0JhY2tib25lJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydCYWNrYm9uZSddIDogbnVsbCk7XG5cbi8qKlxuICogIFNlcnZpY2UgaXRlbSBtb2RlbCArIFNlcnZpY2UgaXRlbXMgY29sbGVjdGlvblxuICpcbiAqICAtIEl0IG5lZWRzIGEgZGF0YXNvdXJjZSBuYW1lIG9yIGl0IHdvbid0IHdvcmsuXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoe1xuXG4gIF9EQVRBU09VUkNFX05BTUU6ICdkcm9wYm94JyxcblxuICBtb2RlbDogU2VydmljZUl0ZW0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oY29sbCwgb3B0cykge1xuICAgIGlmIChvcHRzLmRhdGFzb3VyY2VfbmFtZSkge1xuICAgICAgdGhpcy5fREFUQVNPVVJDRV9OQU1FID0gb3B0cy5kYXRhc291cmNlX25hbWU7XG4gICAgfVxuICB9LFxuXG4gIGZldGNoOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnRyaWdnZXIoXCJmZXRjaFwiLCB0aGlzKTtcblxuICAgIC8vIFBhc3MgdGhyb3VnaCB0byBvcmlnaW5hbCBmZXRjaC5cbiAgICByZXR1cm4gQmFja2JvbmUuQ29sbGVjdGlvbi5wcm90b3R5cGUuZmV0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfSxcblxuICBwYXJzZTogZnVuY3Rpb24ocikge1xuICAgIHJldHVybiByLmZpbGVzO1xuICB9LFxuXG4gIHVybDogZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgdmFyIHZlcnNpb24gPSBjZGIuY29uZmlnLnVybFZlcnNpb24oJ2ltcG9ydHNfc2VydmljZScsIG1ldGhvZCk7XG4gICAgcmV0dXJuICcvYXBpLycgKyB2ZXJzaW9uICsgJy9pbXBvcnRzL3NlcnZpY2UvJyArIHRoaXMuX0RBVEFTT1VSQ0VfTkFNRSArICcvbGlzdF9maWxlcydcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIFV0aWxzID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydVdGlscyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ1V0aWxzJ10gOiBudWxsKTtcbnZhciBTZXJ2aWNlVXRpbHNGb3JtYXQgPSByZXF1aXJlKCcuL3NlcnZpY2VfaXRlbV9kZXNjcmlwdGlvbl9mb3JtYXQnKTtcbnZhciBwbHVyYWxpemVTdHJpbmcgPSByZXF1aXJlKCcuLi8uLi8uLi8uLi8uLi92aWV3X2hlbHBlcnMvcGx1cmFsaXplX3N0cmluZycpO1xuXG4vKipcbiAqICBTZXJ2aWNlIGxpc3QgaXRlbSB2aWV3XG4gKlxuICogIC0gRGlzcGxheXMgdGhlIGl0ZW0gaW5mby5cbiAqICAtIEl0IGxldHMgdXNlciB0byBzZWxlY3QgdGhlIGl0ZW0gZm9yIGEgZnV0dXJlIGltcG9ydC5cbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgb3B0aW9uczoge1xuICAgIHRpdGxlOiAnJyxcbiAgICBmaWxlQXR0cnM6IHtcbiAgICAgIGV4dDogZmFsc2UsXG4gICAgICB0aXRsZTogJ2ZpbGVuYW1lJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnc2l6ZScsXG4gICAgICBpdGVtTmFtZTogJ2ZpbGUnLFxuICAgICAgZm9ybWF0RGVzY3JpcHRpb246ICcnXG4gICAgfVxuICB9LFxuXG4gIF9GT1JNQVRURVJTOiB7XG4gICAgJ3NpemUnOiBTZXJ2aWNlVXRpbHNGb3JtYXQuZm9ybWF0U2l6ZSxcbiAgICAnbnVtYmVyJzogVXRpbHMuZm9ybWF0TnVtYmVyXG4gIH0sXG5cbiAgY2xhc3NOYW1lOiAnU2VydmljZUxpc3QtaXRlbScsXG4gIHRhZ05hbWU6ICdsaScsXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy1jaG9vc2UnOiAnX29uU2VsZWN0SXRlbSdcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL3ZpZXdzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydF90eXBlcy9zZXJ2aWNlX2xpc3RfaXRlbScpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRpdGxlID0gdGhpcy5tb2RlbC5nZXQodGhpcy5vcHRpb25zLmZpbGVBdHRycy50aXRsZSk7XG4gICAgdmFyIGRlc2NyaXB0aW9uID0gdGhpcy5fZ2VuRGVzY3JpcHRpb24oKTtcbiAgICB2YXIgZXh0ID0gdGhpcy5vcHRpb25zLmZpbGVBdHRycy5leHQgPyBVdGlscy5nZXRGaWxlRXh0ZW5zaW9uKHRpdGxlKSA6ICcnIDtcblxuICAgIGlmICh0aGlzLm9wdGlvbnMuZmlsZUF0dHJzLmV4dCkge1xuICAgICAgdGl0bGUgPSB0aXRsZSAmJiB0aXRsZS5yZXBsYWNlKCcuJyArIGV4dCwgJycpO1xuICAgIH1cblxuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLnRlbXBsYXRlKHtcbiAgICAgICAgbmFtZTogdGhpcy5vcHRpb25zLnRpdGxlLFxuICAgICAgICBleHQ6IGV4dCxcbiAgICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb25cbiAgICAgIH0pXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfZ2VuRGVzY3JpcHRpb246IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZmlsZUF0dHJzICYmIHRoaXMub3B0aW9ucy5maWxlQXR0cnMuZGVzY3JpcHRpb24pIHtcbiAgICAgIHZhciBkZXNjcmlwdGlvbk9wdHMgPSB0aGlzLm9wdGlvbnMuZmlsZUF0dHJzLmRlc2NyaXB0aW9uO1xuICAgICAgdmFyIGRlc2NyaXB0aW9uS2V5VmFsdWUgPSAnJztcbiAgICAgIHZhciBkZXNjcmlwdGlvblN0ciA9ICcnO1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICBpZiAoZGVzY3JpcHRpb25PcHRzLmNvbnRlbnQgJiYgZGVzY3JpcHRpb25PcHRzLmNvbnRlbnQubGVuZ3RoID4gMCkge1xuICAgICAgICBfLmVhY2goZGVzY3JpcHRpb25PcHRzLmNvbnRlbnQsIGZ1bmN0aW9uKGl0ZW0sIGkpIHtcblxuICAgICAgICAgIGlmIChpID4gMCAmJiBkZXNjcmlwdGlvbk9wdHMuc2VwYXJhdG9yKSB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvblN0ciArPSBcIiBcIiArIGRlc2NyaXB0aW9uT3B0cy5zZXBhcmF0b3IgKyAnICc7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIHZhbHVlID0gc2VsZi5tb2RlbC5nZXQoaXRlbS5uYW1lKTtcbiAgICAgICAgICB2YXIgZm9ybWF0ID0gaXRlbS5mb3JtYXQgJiYgc2VsZi5fRk9STUFUVEVSU1tpdGVtLmZvcm1hdF07XG4gICAgICAgICAgZGVzY3JpcHRpb25TdHIgKz0gZm9ybWF0ICYmIGZvcm1hdCh2YWx1ZSkgfHwgdmFsdWU7XG5cbiAgICAgICAgICBpZiAoaXRlbS5rZXkpIHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uS2V5VmFsdWUgPSBpdGVtLm5hbWU7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfVxuXG4gICAgICBpZiAoZGVzY3JpcHRpb25PcHRzLml0ZW1OYW1lICYmIGRlc2NyaXB0aW9uS2V5VmFsdWUpIHtcbiAgICAgICAgZGVzY3JpcHRpb25TdHIgKz0gJyAnICsgKGRlc2NyaXB0aW9uT3B0cy5pdGVtTmFtZSAmJiBwbHVyYWxpemVTdHJpbmcoZGVzY3JpcHRpb25PcHRzLml0ZW1OYW1lLCBkZXNjcmlwdGlvbktleVZhbHVlKSB8fCAnJyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBkZXNjcmlwdGlvblN0cjtcbiAgICB9XG5cbiAgICByZXR1cm4gJyc7XG4gIH0sXG5cbiAgX29uU2VsZWN0SXRlbTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50cmlnZ2VyKCdzZWxlY3RlZCcsIHRoaXMubW9kZWwsIHRoaXMpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgU2VydmljZUxpc3RJdGVtID0gcmVxdWlyZSgnLi9zZXJ2aWNlX2xpc3RfaXRlbV92aWV3Jyk7XG52YXIgcGx1cmFsaXplU3RyaW5nID0gcmVxdWlyZSgnLi4vLi4vLi4vLi4vLi4vdmlld19oZWxwZXJzL3BsdXJhbGl6ZV9zdHJpbmcnKTtcblxuLyoqXG4gKiAgU2VydmljZSBsaXN0IHZpZXdcbiAqXG4gKiAgLSBJdCB3aWxsIGRpc3BsYXkgYWxsIHRoZSBpdGVtcyBhdmFpbGFibGUgdW5kZXJcbiAqICB0aGUgc2VydmljZSBhbmQgdGhlIHBvc3NpYmlsaXR5IHRvIGNob3NlIG9uZSBvZlxuICogIHRoZW0uXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIF9URVhUUzoge1xuICAgIGl0ZW06IF90KCdpdGVtJylcbiAgfSxcblxuICBvcHRpb25zOiB7XG4gICAgdGl0bGU6ICdzZXJ2aWNlJyxcbiAgICBmaWxlQXR0cnM6IHt9XG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9pbXBvcnRfdHlwZXMvc2VydmljZV9saXN0Jyk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gICAgdGhpcy5fY2hlY2tWaXNpYmlsaXR5KCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcbiAgICB2YXIgc2l6ZSA9IHRoaXMuY29sbGVjdGlvbi5zaXplKCk7XG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIHRoaXMudGVtcGxhdGUoe1xuICAgICAgICBzaXplOiBzaXplLFxuICAgICAgICB0aXRsZTogdGhpcy5vcHRpb25zLnRpdGxlLFxuICAgICAgICBwbHVyYWxpemU6IHBsdXJhbGl6ZVN0cmluZyh0aGlzLl9URVhUUy5pdGVtLCBzaXplKVxuICAgICAgfSlcbiAgICApO1xuICAgIGlmICh0aGlzLmNvbGxlY3Rpb24uc2l6ZSgpID4gMCkge1xuICAgICAgdGhpcy5jb2xsZWN0aW9uLmVhY2godGhpcy5fYWRkSXRlbSwgdGhpcyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY29sbGVjdGlvbi5iaW5kKCdyZXNldCcsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpzdGF0ZScsIHRoaXMuX2NoZWNrVmlzaWJpbGl0eSwgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbCh0aGlzLmNvbGxlY3Rpb24pO1xuICB9LFxuXG4gIF9hZGRJdGVtOiBmdW5jdGlvbihtKSB7XG4gICAgdmFyIGl0ZW0gPSBuZXcgU2VydmljZUxpc3RJdGVtKHtcbiAgICAgIG1vZGVsOiBtLFxuICAgICAgdGl0bGU6IHRoaXMub3B0aW9ucy50aXRsZSxcbiAgICAgIGZpbGVBdHRyczogdGhpcy5vcHRpb25zLmZpbGVBdHRyc1xuICAgIH0pO1xuICAgIGl0ZW0uYmluZCgnc2VsZWN0ZWQnLCB0aGlzLl9vblNlbGVjdGVkSXRlbSwgdGhpcyk7XG4gICAgdGhpcy4kKCcuU2VydmljZUxpc3QtaXRlbXMnKS5hcHBlbmQoaXRlbS5yZW5kZXIoKS5lbCk7XG4gICAgdGhpcy5hZGRWaWV3KGl0ZW0pO1xuICB9LFxuXG4gIF9vblNlbGVjdGVkSXRlbTogZnVuY3Rpb24obWRsKSB7XG4gICAgdGhpcy5tb2RlbC5zZXQoe1xuICAgICAgc3RhdGU6ICdzZWxlY3RlZCcsXG4gICAgICB2YWx1ZTogbWRsLnRvSlNPTigpLFxuICAgICAgc2VydmljZV9pdGVtX2lkOiBtZGwuZ2V0KCdpZCcpXG4gICAgfSk7XG4gIH0sXG5cbiAgX2NoZWNrVmlzaWJpbGl0eTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHN0YXRlID0gdGhpcy5tb2RlbC5nZXQoJ3N0YXRlJyk7XG4gICAgaWYgKHN0YXRlID09PSAnbGlzdCcpIHtcbiAgICAgIHRoaXMuc2hvdygpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmhpZGUoKTtcbiAgICB9XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcblxuLyoqXG4gKiAgU2VydmljZSBsb2FkZXIgdmlld1xuICpcbiAqICAtIEl0IHdpbGwgYmUgb24gY2hhcmdlIHRvIG1ha2UgdG9rZW4gYW5kIG9hdXRoIHBldGl0aW9uc1xuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2sgLmpzLWNvbm5lY3QnOiAnX2NoZWNrVG9rZW4nXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50b2tlbiA9IHRoaXMub3B0aW9ucy50b2tlbjtcbiAgICB0aGlzLnNlcnZpY2UgPSB0aGlzLm9wdGlvbnMuc2VydmljZTtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL3ZpZXdzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydF90eXBlcy9zZXJ2aWNlX2xvYWRlcicpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICAgIHRoaXMuX2NoZWNrVmlzaWJpbGl0eSgpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIHRoaXMudGVtcGxhdGUoe1xuICAgICAgICBzZXJ2aWNlX25hbWU6IHRoaXMubW9kZWwuZ2V0KCdzZXJ2aWNlX25hbWUnKSxcbiAgICAgICAgc3RhdGU6IHRoaXMubW9kZWwuZ2V0KCdzdGF0ZScpXG4gICAgICB9KVxuICAgICk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6c3RhdGUnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6c3RhdGUnLCB0aGlzLl9jaGVja1Zpc2liaWxpdHksIHRoaXMpO1xuICB9LFxuXG4gIF9jaGVja1Rva2VuOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5tb2RlbC5zZXQoJ3N0YXRlJywgJ3Rva2VuJyk7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy50b2tlbi5mZXRjaCh7XG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihyKSB7XG4gICAgICAgIGlmICghci5nZXQoJ29hdXRoX3ZhbGlkJykpIHtcbiAgICAgICAgICBzZWxmLl9nZXRPYXV0aFVSTCgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgc2VsZi5fZ2V0T2F1dGhVUkwoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBfY2hlY2tWaXNpYmlsaXR5OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3RhdGUgPSB0aGlzLm1vZGVsLmdldCgnc3RhdGUnKTtcbiAgICBpZiAoc3RhdGUgIT09ICdsaXN0JyAmJiBzdGF0ZSAhPT0gJ3NlbGVjdGVkJykge1xuICAgICAgdGhpcy5zaG93KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaGlkZSgpO1xuICAgIH1cbiAgfSxcblxuICBfZ2V0T2F1dGhVUkw6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLm1vZGVsLnNldCgnc3RhdGUnLCAnb2F1dGgnKTtcbiAgICB0aGlzLnNlcnZpY2Uuc2V0KHsgdXJsOiAnJyB9LCB7IHNpbGVudDogdHJ1ZSB9KTtcbiAgICB0aGlzLnNlcnZpY2UuZmV0Y2goe1xuICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLm1vZGVsLnNldCgnc3RhdGUnLCAnZXJyb3InKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG59KSIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuY2RiLmFkbWluID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydhZG1pbiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ2FkbWluJ10gOiBudWxsKTtcbnZhciBVdGlscyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXVsnVXRpbHMnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddWydVdGlscyddIDogbnVsbCk7XG5cbi8qKlxuICogIENyZWRpdHMgaW5mbyB2aWV3XG4gKlxuICogIC0gUGVyY2VudGFnZSBvZiB1c2VcbiAqICAtIFBvc3NpYmxlIG1vbmV5IHNwZW50XG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vdmlld3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0X3R5cGVzL2NyZWRpdHNfaW5mbycpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHR3aXR0ZXJEYXRhID0gdGhpcy51c2VyLmdldCgndHdpdHRlcicpO1xuICAgIHZhciByZW1haW5pbmcgPSB0d2l0dGVyRGF0YS5xdW90YSAtIHR3aXR0ZXJEYXRhLm1vbnRobHlfdXNlO1xuICAgIHZhciBwZXIgPSBNYXRoLm1pbigxMDAsTWF0aC5jZWlsKCh0aGlzLm1vZGVsLmdldCgndmFsdWUnKSAqIDEwMCkgLyByZW1haW5pbmcpKTtcblxuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLnRlbXBsYXRlKHtcbiAgICAgICAgdmFsdWU6IHRoaXMubW9kZWwuZ2V0KCd2YWx1ZScpLFxuICAgICAgICByZW1haW5pbmc6IHJlbWFpbmluZyxcbiAgICAgICAgcGVyOiBwZXIsXG4gICAgICAgIGhhcmRMaW1pdDogdHdpdHRlckRhdGEuaGFyZF9saW1pdCxcbiAgICAgICAgcmVtYWluaW5nRm9ybWF0dGVkOiBVdGlscy5mb3JtYXROdW1iZXIocmVtYWluaW5nKSxcbiAgICAgICAgcXVvdGE6IHR3aXR0ZXJEYXRhLnF1b3RhLFxuICAgICAgICBibG9ja19wcmljZTogdHdpdHRlckRhdGEuYmxvY2tfcHJpY2UsXG4gICAgICAgIGJsb2NrX3NpemU6IFV0aWxzLnJlYWRpemFibGVOdW1iZXIodHdpdHRlckRhdGEuYmxvY2tfc2l6ZSlcbiAgICAgIH0pXG4gICAgKVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICB9XG5cbn0pOyIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuY2RiLmFkbWluID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydhZG1pbiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ2FkbWluJ10gOiBudWxsKTtcbnZhciBDcmVkaXRzSW5mbyA9IHJlcXVpcmUoJy4vY3JlZGl0c19pbmZvX3ZpZXcnKTtcblxuLyoqXG4gKiAgU2V0IG1heCB1c2Ugb2YgY3JlZGl0cyBmb3IgVHdpdHRlclxuICpcbiAqICAtIFNsaWRlciByYW5nZSA9IDEwMDAgY3JlZGl0c1xuICogIC0gTGFzdCBzdGVwIHNob3VsZCBiZSBpbmZpbml0ZSBpZiB1c2VyIGRvZXNuJ3RcbiAqICAgIGhhdmUgXCJzb2Z0X2xpbWl0XCIuXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIF9ERUZBVUxUX1BFUl9WQUxVRTogODAsIC8vIERlZmF1bHQgcGVyY2VudGFnZSB2YWx1ZSBmb3Igc2xpZGVyXG4gIF9NSU5fUEVSX1ZBTFVFOiAxLCAgICAgIC8vIERlZmF1bHQgbWluIHBlcmNlbnRhZ2UgdmFsdWUgZm9yIHNsaWRlclxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2Rpc2FibGVkID0gKHRoaXMub3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMuZGlzYWJsZWQpID8gdGhpcy5vcHRpb25zLmRpc2FibGVkIDogZmFsc2U7ICAgIFxuICAgIFxuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMubW9kZWwgPSBuZXcgY2RiLmNvcmUuTW9kZWwoKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICB0aGlzLl9zZXRNb2RlbCgpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy4kKFwiLmpzLXNsaWRlclwiKS5zbGlkZXIoXCJkZXN0cm95XCIpO1xuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIF8uYmluZEFsbCh0aGlzLCAnX29uU2xpZGVDaGFuZ2UnKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTp2YWx1ZScsIHRoaXMuX29uVmFsdWVDaGFuZ2UsIHRoaXMpO1xuICB9LFxuXG4gIF9zZXRNb2RlbDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHR3aXR0ZXJEYXRhID0gdGhpcy51c2VyLmdldCgndHdpdHRlcicpO1xuICAgIHZhciBtYXggPSB0d2l0dGVyRGF0YS5xdW90YSAtIHR3aXR0ZXJEYXRhLm1vbnRobHlfdXNlO1xuICAgIHZhciBtaW4gPSAgKHRoaXMuX01JTl9QRVJfVkFMVUUgKiBtYXgpIC8gMTAwOyAvLyBKdXN0IDElIG9mIHRoZSBxdW90YVxuICAgIHZhciBkZWZhdWx0VmFsdWUgPSAobWF4ICogdGhpcy5fREVGQVVMVF9QRVJfVkFMVUUpIC8gMTAwO1xuICAgIHZhciB2YWx1ZSA9IG1heCA+IDAgPyBkZWZhdWx0VmFsdWUgOiAobWF4ICsgMSk7XG4gICAgXG4gICAgdmFyIHNlbGYgPSB0aGlzOyAgICBcbiAgICB0aGlzLm1vZGVsLnNldCh7XG4gICAgICBtYXg6ICh0d2l0dGVyRGF0YS5oYXJkX2xpbWl0ID8gbWF4IDogbWF4ICsgMSApLFxuICAgICAgbWluOiBtaW4sXG4gICAgICBzdGVwOiBtaW4sXG4gICAgICB2YWx1ZTogbWF4ID4gMCA/IHZhbHVlIDogdHdpdHRlckRhdGEucXVvdGEsXG4gICAgICBkaXNhYmxlZDogc2VsZi5fZGlzYWJsZWQgfHwgbWF4IDw9IDBcbiAgICB9KTtcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9zZXRNb2RlbCgpO1xuICAgIC8vIFNsaWRlclxuICAgIHRoaXMuJChcIi5qcy1zbGlkZXJcIikuc2xpZGVyKFxuICAgICAgXy5leHRlbmQoe1xuICAgICAgICAgIHJhbmdlOiAnbWluJyxcbiAgICAgICAgICBvcmllbnRhdGlvbjogXCJob3Jpem9udGFsXCIsXG4gICAgICAgICAgc2xpZGU6IHRoaXMuX29uU2xpZGVDaGFuZ2UsXG4gICAgICAgICAgY2hhbmdlOiB0aGlzLl9vblNsaWRlQ2hhbmdlXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMubW9kZWwuYXR0cmlidXRlc1xuICAgICAgKVxuICAgICk7XG5cbiAgICAvLyBJbmZvXG4gICAgdmFyIGNyZWRpdHNJbmZvID0gbmV3IENyZWRpdHNJbmZvKHtcbiAgICAgIGVsOiB0aGlzLiQoJy5qcy1pbmZvJyksXG4gICAgICB1c2VyOiB0aGlzLnVzZXIsXG4gICAgICBtb2RlbDogdGhpcy5tb2RlbFxuICAgIH0pO1xuICAgIGNyZWRpdHNJbmZvLnJlbmRlcigpO1xuICAgIHRoaXMuYWRkVmlldyhjcmVkaXRzSW5mbyk7XG4gIH0sXG5cbiAgX29uU2xpZGVDaGFuZ2U6IGZ1bmN0aW9uKGV2LCB1aSkge1xuICAgIHRoaXMubW9kZWwuc2V0KCd2YWx1ZScsIHVpLnZhbHVlKTtcbiAgfSxcblxuICBfb25WYWx1ZUNoYW5nZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50cmlnZ2VyKCdtYXhDcmVkaXRzQ2hhbmdlJywgdGhpcy5nZXRNYXhDcmVkaXRzKCksIHRoaXMpO1xuICB9LFxuXG4gIGdldE1heENyZWRpdHM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB0d2l0dGVyRGF0YSA9IHRoaXMudXNlci5nZXQoJ3R3aXR0ZXInKTtcbiAgICB2YXIgbWF4ID0gdHdpdHRlckRhdGEucXVvdGEgLSB0d2l0dGVyRGF0YS5tb250aGx5X3VzZTtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLm1vZGVsLmdldCgndmFsdWUnKTtcbiAgICByZXR1cm4gdmFsdWUgPiBtYXggPyAwIDogdmFsdWVcbiAgfVxuXG59KTsiLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbmNkYi5hZG1pbiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXVsnYWRtaW4nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddWydhZG1pbiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBJbXBvcnREZWZhdWx0VmlldyA9IHJlcXVpcmUoJy4uLy4uLy4uLy4uLy4uL2RpYWxvZ3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0cy9pbXBvcnRfZGVmYXVsdF92aWV3Jyk7XG52YXIgVXBsb2FkTW9kZWwgPSByZXF1aXJlKCcuLi8uLi8uLi8uLi8uLi9iYWNrZ3JvdW5kX3BvbGxpbmcvbW9kZWxzL3VwbG9hZF9tb2RlbCcpO1xudmFyIERhdGVzUmFuZ2VQaWNrZXIgPSByZXF1aXJlKCcuLi8uLi8uLi8uLi8uLi92aWV3cy9kYXRlX3BpY2tlcnMvZGF0ZXNfcmFuZ2VfcGlja2VyJyk7XG52YXIgVHdpdHRlckNhdGVnb3JpZXMgPSByZXF1aXJlKCcuLi8uLi8uLi8uLi8uLi9kaWFsb2dzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydHMvdHdpdHRlcl9pbXBvcnQvdHdpdHRlcl9jYXRlZ29yaWVzL3R3aXR0ZXJfY2F0ZWdvcmllc192aWV3Jyk7XG52YXIgQ3JlZGl0c1VzYWdlID0gcmVxdWlyZSgnLi9jcmVkaXRzX3VzYWdlX3ZpZXcuanMnKTtcblxuLyoqXG4gKiAgSW1wb3J0IHR3aXR0ZXIgcGFuZWxcbiAqXG4gKiAgLSBJdCBhY2NlcHRzIHVwIHRvIDMgY2F0ZWdvcmllc1xuICogIC0gRGF0ZSByYW5nZSBjYW4ndCBiZSBsb25nZXIgdGhhbiAzMCBkYXlzXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gSW1wb3J0RGVmYXVsdFZpZXcuZXh0ZW5kKHtcblxuICBvcHRpb25zOiB7XG4gICAgYWNjZXB0U3luYzogZmFsc2UsXG4gICAgdHlwZTogJ3NlcnZpY2UnLFxuICAgIHNlcnZpY2U6ICd0d2l0dGVyX3NlYXJjaCdcbiAgfSxcblxuICBjbGFzc05hbWU6ICdJbXBvcnRQYW5lbCBJbXBvcnRUd2l0dGVyUGFuZWwnLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMubW9kZWwgPSBuZXcgVXBsb2FkTW9kZWwoe1xuICAgICAgdHlwZTogdGhpcy5vcHRpb25zLnR5cGUsXG4gICAgICBzZXJ2aWNlX25hbWU6IHRoaXMub3B0aW9ucy5zZXJ2aWNlXG4gICAgfSwge1xuICAgICAgdXNlcjogdGhpcy51c2VyXG4gICAgfSk7XG5cbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL3ZpZXdzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydF90eXBlcy9pbXBvcnRfdHdpdHRlcicpO1xuXG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgX2Rpc2FibGVkRHVlTGFja09mQ3JlZGVudGlhbHM6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gIXRoaXMudXNlci5oYXNPd25Ud2l0dGVyQ3JlZGVudGlhbHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSgpKTtcbiAgICB0aGlzLl9pbml0Vmlld3MoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICAvLyBDYXRlZ29yaWVzXG4gICAgdmFyIGNhdGVnb3JpZXMgPSB0aGlzLmNhdGVnb3JpZXMgPSBuZXcgVHdpdHRlckNhdGVnb3JpZXMoe1xuICAgICAgZGlzYWJsZWQ6IHRoaXMuX2Rpc2FibGVkRHVlTGFja09mQ3JlZGVudGlhbHMoKVxuICAgIH0pO1xuICAgIGNhdGVnb3JpZXMuYmluZCgnY2hhbmdlQ2F0ZWdvcnknLCB0aGlzLl9zZXRNb2RlbCwgdGhpcyk7XG4gICAgdGhpcy4kKCcuSW1wb3J0VHdpdHRlclBhbmVsLWNhdGVnb3JpZXMnKS5hcHBlbmQoY2F0ZWdvcmllcy5yZW5kZXIoKS5lbCk7XG4gICAgdGhpcy5hZGRWaWV3KGNhdGVnb3JpZXMpO1xuXG4gICAgLy8gRGF0ZSBwaWNrZXJcbiAgICB2YXIgZGF0ZXBpY2tlciA9IHRoaXMuZGF0ZXBpY2tlciA9IG5ldyBEYXRlc1JhbmdlUGlja2VyKHtcbiAgICAgIGNsYXNzTmFtZTogJ0RhdGVQaWNrZXIgRGF0ZVBpY2tlci0td2l0aEJvcmRlcicsXG4gICAgICBkaXNhYmxlZDogdGhpcy5fZGlzYWJsZWREdWVMYWNrT2ZDcmVkZW50aWFscygpICAgICAgXG4gICAgfSk7XG4gICAgZGF0ZXBpY2tlci5iaW5kKCdjaGFuZ2VEYXRlJywgdGhpcy5fc2V0TW9kZWwsIHRoaXMpO1xuICAgIHRoaXMuJCgnLmpzLXBpY2tlcicpLmFwcGVuZChkYXRlcGlja2VyLnJlbmRlcigpLmVsKTtcbiAgICB0aGlzLmFkZFZpZXcoZGF0ZXBpY2tlcik7XG5cbiAgICAvLyBVc2Ugc2xpZGVyXG4gICAgdmFyIGNyZWRpdHNVc2FnZSA9IHRoaXMuY3JlZGl0c1VzYWdlID0gbmV3IENyZWRpdHNVc2FnZSh7XG4gICAgICBlbDogdGhpcy4kKCcuQ3JlZGl0c1VzYWdlJyksXG4gICAgICB1c2VyOiB0aGlzLnVzZXIsXG4gICAgICBkaXNhYmxlZDogdGhpcy5fZGlzYWJsZWREdWVMYWNrT2ZDcmVkZW50aWFscygpICAgICAgXG4gICAgfSk7XG4gICAgY3JlZGl0c1VzYWdlLmJpbmQoJ21heENyZWRpdHNDaGFuZ2UnLCB0aGlzLl9zZXRNb2RlbCwgdGhpcyk7XG4gICAgY3JlZGl0c1VzYWdlLnJlbmRlcigpO1xuICAgIHRoaXMuYWRkVmlldyhjcmVkaXRzVXNhZ2UpO1xuXG4gICAgdGhpcy5fc2V0TW9kZWwoKTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZScsIHRoaXMuX3RyaWdnZXJDaGFuZ2UsIHRoaXMpO1xuICB9LFxuXG4gIF9nZXRDYXRlZ29yaWVzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgY2F0ZWdvcmllcyA9IHRoaXMuY2F0ZWdvcmllcy5nZXRDYXRlZ29yaWVzKCk7XG4gICAgcmV0dXJuIF8uZmlsdGVyKGNhdGVnb3JpZXMsIGZ1bmN0aW9uKGMpIHtcbiAgICAgIHJldHVybiBjLmNhdGVnb3J5ICYmIGMudGVybXMubGVuZ3RoID4gMFxuICAgIH0pO1xuICB9LFxuXG4gIF9nZXREYXRlczogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZGF0ZXBpY2tlci5nZXREYXRlcygpO1xuICB9LFxuXG4gIF9nZXRNYXhDcmVkaXRzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5jcmVkaXRzVXNhZ2UuZ2V0TWF4Q3JlZGl0cygpO1xuICB9LFxuXG4gIF9zZXRNb2RlbDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNhdGVnb3JpZXMgPSB0aGlzLl9nZXRDYXRlZ29yaWVzKCk7XG4gICAgdmFyIGRhdGVzID0gdGhpcy5fZ2V0RGF0ZXMoKTtcbiAgICB2YXIgbWF4Q3JlZGl0cyA9IHRoaXMuX2dldE1heENyZWRpdHMoKTtcbiAgICB2YXIgZCA9IHtcbiAgICAgIGNhdGVnb3JpZXM6IGNhdGVnb3JpZXMsXG4gICAgICBkYXRlczogZGF0ZXNcbiAgICB9O1xuXG4gICAgdGhpcy5tb2RlbC5zZXQoe1xuICAgICAgdmFsdWU6IGQsXG4gICAgICBzZXJ2aWNlX2l0ZW1faWQ6IGQsXG4gICAgICB1c2VyX2RlZmluZWRfbGltaXRzOiB7XG4gICAgICAgIHR3aXR0ZXJfY3JlZGl0c19saW1pdDogbWF4Q3JlZGl0c1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbn0pXG4iLCJ2YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBUd2l0dGVyQ2F0ZWdvcnlNb2RlbCA9IHJlcXVpcmUoJy4vdHdpdHRlcl9jYXRlZ29yeV9tb2RlbCcpO1xuICBcbi8vIFR3aXR0ZXIgY2F0ZWdvcmllcyBjb2xsZWN0aW9uXG5cbm1vZHVsZS5leHBvcnRzID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoe1xuICBtb2RlbDogVHdpdHRlckNhdGVnb3J5TW9kZWxcbn0pOyIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuY2RiLmFkbWluID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydhZG1pbiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ2FkbWluJ10gOiBudWxsKTtcbnZhciBUd2l0dGVyQ2F0ZWdvcmllc0NvbGxlY3Rpb24gPSByZXF1aXJlKCcuL3R3aXR0ZXJfY2F0ZWdvcmllc19jb2xsZWN0aW9uJyk7XG52YXIgVHdpdHRlckNhdGVnb3JpZXNNb2RlbCA9IHJlcXVpcmUoJy4vdHdpdHRlcl9jYXRlZ29yeV9tb2RlbCcpO1xudmFyIFR3aXR0ZXJDYXRlZ29yeVZpZXcgPSByZXF1aXJlKCcuL3R3aXR0ZXJfY2F0ZWdvcnlfdmlldycpO1xuXG4vKipcbiAqICBUd2l0dGVyIGNhdGVnb3J5IGxpc3Qgdmlld1xuICogIC0gSXQgd2lsbCBnZW5lcmF0ZSBhIGNvbGxlY3Rpb24gdG8gc3RvcmUgYWxsIHRoZSBcbiAqICAgIHRlcm1zIGFkZGVkLlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIF9NQVhfQ0FURUdPUklFUzogNCxcbiAgX01BWF9URVJNUzogMjksXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fZGlzYWJsZWQgPSAodGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5kaXNhYmxlZCkgPyB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgOiBmYWxzZTtcbiAgICBcbiAgICAvLyBBZGQgYSBmaXJzdCBlbXB0eSBtb2RlbFxuICAgIHZhciBtID0gdGhpcy5fZ2VuZXJhdGVDYXRlZ29yeSgpO1xuICAgIHRoaXMuY29sbGVjdGlvbiA9IG5ldyBUd2l0dGVyQ2F0ZWdvcmllc0NvbGxlY3Rpb24oWyBtIF0pO1xuXG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcbiAgICB0aGlzLmNvbGxlY3Rpb24uZWFjaCh0aGlzLl9hZGRDYXRlZ29yeSwgdGhpcyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmJpbmQoJ2NoYW5nZScsIHRoaXMuX21hbmFnZUNhdGVnb3JpZXMsIHRoaXMpO1xuICAgIHRoaXMuY29sbGVjdGlvbi5iaW5kKCdjaGFuZ2UnLCB0aGlzLl9vbkNhdGVnb3J5Q2hhbmdlLCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMuY29sbGVjdGlvbik7XG4gIH0sXG5cbiAgX21hbmFnZUNhdGVnb3JpZXM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgY29sbGVjdGlvbl9zaXplID0gdGhpcy5jb2xsZWN0aW9uLnNpemUoKTtcblxuICAgIC8vIENoZWNrIGlmIGFscmVhZHkgY3JlYXRlZCBtb2RlbHMgYXJlIGNvbXBsZXRlZFxuICAgIHZhciBub25GaWxsZWQgPSB0aGlzLmNvbGxlY3Rpb24uZmlsdGVyKGZ1bmN0aW9uKG0pIHtcbiAgICAgIHJldHVybiBtLmdldCgndGVybXMnKS5sZW5ndGggPT09IDBcbiAgICB9KTtcblxuICAgIC8vIGlmIHNvLCBnZW5lcmF0ZSBuZXcgb25lXG4gICAgaWYgKG5vbkZpbGxlZC5sZW5ndGggPT09IDAgJiYgY29sbGVjdGlvbl9zaXplIDwgdGhpcy5fTUFYX0NBVEVHT1JJRVMpIHtcbiAgICAgIHZhciBtID0gdGhpcy5fZ2VuZXJhdGVDYXRlZ29yeSgpO1xuICAgICAgdGhpcy5jb2xsZWN0aW9uLmFkZChtKTtcbiAgICAgIHRoaXMuX2FkZENhdGVnb3J5KG0pO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIGVsc2UsIGxldCdzIGNoZWNrXG4gICAgaWYgKG5vbkZpbGxlZC5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgbSA9IF8uZmlyc3Qobm9uRmlsbGVkKTtcbiAgICAgIHZhciB2ID0gXy5maW5kKHRoaXMuX3N1YnZpZXdzLCBmdW5jdGlvbih2aWV3KXsgcmV0dXJuIG0uY2lkID09PSB2aWV3Lm1vZGVsLmNpZCB9KTtcbiAgICAgIHZhciBwb3MgPSB2LiRlbC5pbmRleCgpO1xuICAgICAgXG4gICAgICAvLyBPbmx5IG9uZSBpdGVtIGluIHRoZSBjb2xsZWN0aW9uLCBkbyBub3RoaW5nXG4gICAgICBpZiAoY29sbGVjdGlvbl9zaXplID09PSAxKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIC8vIElmIGl0IGlzIHRoZSBsYXN0IGl0ZW0gYnV0IHRoZXJlIGlzIG5vIG1vcmUgaXRlbXMsIGRvIG5vdGhpbmdcbiAgICAgIGlmIChwb3MgPT09IChjb2xsZWN0aW9uX3NpemUgLSAxKSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAvLyBJZiBpdCBpcyBub3QgdGhlIGxhc3QgaXRlbSBhbmQgdGhlcmUgaXMgYW5vdGhlciBub24tZmlsbGVkIGVsZW1lbnRcbiAgICAgIC8vIGxldCdzIHJlbW92ZSB0aGF0IG9uZS5cbiAgICAgIGlmIChwb3MgIT09IChjb2xsZWN0aW9uX3NpemUgLSAxKSAmJiBub25GaWxsZWQubGVuZ3RoID4gMSkge1xuICAgICAgICBtID0gbm9uRmlsbGVkWzFdO1xuICAgICAgICB2ID0gXy5maW5kKHRoaXMuX3N1YnZpZXdzLCBmdW5jdGlvbih2aWV3KXsgcmV0dXJuIG0uY2lkID09PSB2aWV3Lm1vZGVsLmNpZCB9KTtcbiAgICAgICAgdGhpcy5fcmVtb3ZlQ2F0ZWdvcnkodik7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlb3JkZXIgY2F0ZWdvcnkgaW5kZXhlcyA6KFxuICAgICAgdGhpcy5fc2V0Q2F0ZWdvcnlJbmRleCgpO1xuICAgIH1cbiAgfSxcblxuICAvLyBTZXQgcHJvcGVyIGluZGV4IGFmdGVyIGFueSBjYXRlZ29yeSByZW1vdmVkXG4gIF9zZXRDYXRlZ29yeUluZGV4OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAvLyBIYWNrIHRvIHNldCBwcm9wZXJseSBjYXRlZ29yeSBudW1iZXJzXG4gICAgdGhpcy4kKCcudHdpdHRlci1jYXRlZ29yeScpLmVhY2goZnVuY3Rpb24oaSxlbCkge1xuICAgICAgLy8gR2V0IGNhdGVnb3J5LCByZW1vdmluZyBDYXRlZ29yeSB3b3JkXG4gICAgICB2YXIgY2F0ZWdvcnkgPSAkKGVsKS5maW5kKCcuanMtY2F0ZWdvcnknKS50ZXh0KCkucmVwbGFjZSgnQ2F0ZWdvcnkgJywnJyk7XG5cbiAgICAgIGlmIChjYXRlZ29yeSAhPT0gKGkrMSkgKSB7XG4gICAgICAgIC8vIEZpbmQgbW9kZWxcbiAgICAgICAgdmFyIG0gPSBzZWxmLmNvbGxlY3Rpb24uZmluZChmdW5jdGlvbihtKSB7IHJldHVybiBtLmdldCgnY2F0ZWdvcnknKSA9PT0gY2F0ZWdvcnkgfSk7XG4gICAgICAgIC8vIEZpbmQgdmlld1xuICAgICAgICBtLnNldCgnY2F0ZWdvcnknLCAoaSsxKS50b1N0cmluZygpICk7ICBcbiAgICAgIH1cbiAgICAgIFxuICAgIH0pXG4gIH0sXG5cbiAgX2dlbmVyYXRlQ2F0ZWdvcnk6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVHdpdHRlckNhdGVnb3JpZXNNb2RlbCh7XG4gICAgICBkaXNhYmxlZDogdGhpcy5fZGlzYWJsZWQsXG4gICAgICB0ZXJtczogW10sXG4gICAgICBjYXRlZ29yeTogKHRoaXMuY29sbGVjdGlvbiA/ICggdGhpcy5jb2xsZWN0aW9uLnNpemUoKSArIDEgKSA6IDEgKS50b1N0cmluZygpXG4gICAgfSk7XG4gIH0sXG5cbiAgX2FkZENhdGVnb3J5OiBmdW5jdGlvbihtKSB7XG4gICAgdmFyIGNhdGVnb3J5ID0gbmV3IFR3aXR0ZXJDYXRlZ29yeVZpZXcoeyBtb2RlbDogbSB9KTtcbiAgICBcbiAgICBjYXRlZ29yeS5iaW5kKCdzdWJtaXQnLCB0aGlzLl9vbkNhdGVnb3J5U3VibWl0LCB0aGlzKTtcbiAgICBjYXRlZ29yeS5iaW5kKCdsaW1pdCcsIHRoaXMuX29uQ2F0ZWdvcnlMaW1pdCwgdGhpcyk7XG4gICAgY2F0ZWdvcnkuYmluZCgnbm9saW1pdCcsIHRoaXMuX29uQ2F0ZWdvcnlOb0xpbWl0LCB0aGlzKTtcblxuICAgIHRoaXMuJGVsLmFwcGVuZChjYXRlZ29yeS5yZW5kZXIoKS5lbCk7XG4gICAgXG4gICAgdGhpcy5hZGRWaWV3KGNhdGVnb3J5KTtcbiAgICB0aGlzLnRyaWdnZXIoXCJhZGRDYXRlZ29yeVwiKTtcbiAgfSxcblxuICBfcmVtb3ZlQ2F0ZWdvcnk6IGZ1bmN0aW9uKHYpIHtcbiAgICB2LmhpZGUoKTtcbiAgICB2LmNsZWFuKCk7XG4gICAgdi5tb2RlbC5kZXN0cm95KCk7XG4gICAgdGhpcy50cmlnZ2VyKFwicmVtb3ZlQ2F0ZWdvcnlcIik7XG4gIH0sXG5cbiAgX29uQ2F0ZWdvcnlTdWJtaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudHJpZ2dlcignc3VibWl0Q2F0ZWdvcnknLCB0aGlzLmNvbGxlY3Rpb24udG9KU09OKCksIHRoaXMpO1xuICB9LFxuXG4gIF9vbkNhdGVnb3J5TGltaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudHJpZ2dlcignbGltaXRDYXRlZ29yeScsIHRoaXMuY29sbGVjdGlvbi50b0pTT04oKSwgdGhpcyk7XG4gIH0sXG5cbiAgX29uQ2F0ZWdvcnlOb0xpbWl0OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnRyaWdnZXIoJ25vTGltaXRDYXRlZ29yeScsIHRoaXMuY29sbGVjdGlvbi50b0pTT04oKSwgdGhpcyk7XG4gIH0sXG5cbiAgX29uQ2F0ZWdvcnlDaGFuZ2U6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudHJpZ2dlcignY2hhbmdlQ2F0ZWdvcnknLCB0aGlzLmNvbGxlY3Rpb24udG9KU09OKCksIHRoaXMpO1xuICB9LFxuXG4gIGdldENhdGVnb3JpZXM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmNvbGxlY3Rpb24udG9KU09OKCk7XG4gIH1cblxufSk7IiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8vIFR3aXR0ZXIgY2F0ZWdvcnkgbW9kZWxcblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIF9NQVhfQ09VTlRFUjogMTAxNCxcblxuICBfQ0hBUl9NQVA6IHtcbiAgICAnICc6IDIsXG4gICAgJy0nOiAyLFxuICAgICdfJzogMixcbiAgICAnLic6IDJcbiAgfSxcbiAgXG4gIGRlZmF1bHRzOiB7XG4gICAgdGVybXM6ICAgIFtdLFxuICAgIGNhdGVnb3J5OiAnJyxcbiAgICBjb3VudGVyOiAgMTAxNFxuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuYmluZCgnY2hhbmdlOnRlcm1zJywgdGhpcy5fc2V0Q291bnRlciwgdGhpcyk7XG4gIH0sXG5cbiAgX3NldENvdW50ZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjb3VudCA9IHRoaXMuX01BWF9DT1VOVEVSO1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8vIENoZWNrIHRlcm1zIG51bWJlclxuICAgIGlmICh0aGlzLmdldCgndGVybXMnKS5sZW5ndGggPiAxKSB7XG4gICAgICBjb3VudCA9IGNvdW50IC0gKCAoIHRoaXMuZ2V0KCd0ZXJtcycpLmxlbmd0aCAtIDEgKSAqIDQgKVxuICAgIH1cblxuICAgIC8vIENoZWNrIGNoYXJhY3RlcnNcbiAgICBfLmVhY2godGhpcy5nZXQoJ3Rlcm1zJyksIGZ1bmN0aW9uKHRlcm0pIHtcbiAgICAgIF8uZWFjaCh0ZXJtLCBmdW5jdGlvbihjKSB7XG4gICAgICAgIGlmIChzZWxmLl9DSEFSX01BUFtjXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgY291bnQgPSBjb3VudCAtIHNlbGYuX0NIQVJfTUFQW2NdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvdW50LS1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBDb3VudCBuZXZlciBzaG91bGQgYmUgZmV3ZXIgdGhlbiAwIHBsZWFzZSFcbiAgICB0aGlzLnNldCgnY291bnRlcicsIE1hdGgubWF4KDAsY291bnQpKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG5cbi8qKlxuICogIFR3aXR0ZXIgY2F0ZWdvcnkgaXRlbSB2aWV3XG4gKiAgLSBJdCBqdXN0IG5lZWRzIGEgdHdpdHRlciBjYXRlZ29yeSBtb2RlbFxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ1R3aXR0ZXJDYXRlZ29yeScsXG5cbiAgX01BWF9DQVRFR09SSUVTOiA0LFxuICBfTUFYX1RFUk1TOiAyOSxcblxuICBldmVudHM6IHtcbiAgICAna2V5ZG93biAuanMtdGVybXMnOiAgICdfb25JbnB1dENoYW5nZScsXG4gICAgJ2tleXByZXNzIC5qcy10ZXJtcyc6ICAnX29uSW5wdXRDaGFuZ2UnLFxuICAgICdrZXl1cCAuanMtdGVybXMnOiAgICAgJ19vbklucHV0Q2hhbmdlJ1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vdmlld3MvY3JlYXRlL2xpc3RpbmcvaW1wb3J0X3R5cGVzL3R3aXR0ZXJfY2F0ZWdvcnknKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmFwcGVuZChcbiAgICAgIHRoaXMudGVtcGxhdGUoe1xuICAgICAgICBkaXNhYmxlZDogdGhpcy5tb2RlbC5nZXQoJ2Rpc2FibGVkJyksICAgICAgICBcbiAgICAgICAgdGVybXM6IHRoaXMubW9kZWwuZ2V0KCd0ZXJtcycpLFxuICAgICAgICBjYXRlZ29yeTogdGhpcy5tb2RlbC5nZXQoJ2NhdGVnb3J5JyksXG4gICAgICAgIGNvdW50ZXI6IHRoaXMubW9kZWwuZ2V0KCdjb3VudGVyJylcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIC8vIFNob3cgY2F0ZWdvcnlcbiAgICB0aGlzLnNob3coKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIF8uYmluZEFsbCh0aGlzLCAnX29uSW5wdXRDaGFuZ2UnKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpjYXRlZ29yeScsIHRoaXMuX29uQ2F0ZWdvcnlDaGFuZ2UsIHRoaXMpO1xuICB9LFxuXG4gIF9vbkNhdGVnb3J5Q2hhbmdlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoJy5qcy1jYXRlZ29yeScpLnRleHQoJ0NhdGVnb3J5ICcgKyB0aGlzLm1vZGVsLmdldCgnY2F0ZWdvcnknKSk7XG4gIH0sXG5cbiAgX29uSW5wdXRDaGFuZ2U6IGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgdmFsdWUgPSAkKGUudGFyZ2V0KS52YWwoKTtcblxuICAgIC8vIEl0IHdhcyBhIEVOVEVSIGtleSBldmVudD8gU2VuZCBzaWduYWwhXG4gICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMudHJpZ2dlcignc3VibWl0JywgdGhpcy5tb2RlbCwgdGhpcyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQ2hhbmdlIGljb24gY2xhc3NcbiAgICB0aGlzLiQoJy5DREItSWNvbkZvbnQtdHdpdHRlcicpW3ZhbHVlLmxlbmd0aCA+IDAgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10oJ2lzLWhpZ2hsaWdodGVkJyk7XG5cbiAgICAvLyBDaGVjayBpZiBpdCBpcyBwb3NzaWJsZSB0byBhZGQgbmV3IGNoYXJhY3RlcnNcbiAgICAvLyBpZiBub3QsIHN0b3AgdGhlIGFjdGlvbiwgdW5sZXNzIHVzZXIgaXMgZGVsZXRpbmdcbiAgICAvLyBhbnkgcHJldmlvdXMgY2hhcmFjdGVyXG4gICAgaWYgKCggdGhpcy5tb2RlbC5nZXQoJ2NvdW50ZXInKSA9PT0gMCB8fCB0aGlzLm1vZGVsLmdldCgndGVybXMnKS5sZW5ndGggPiB0aGlzLl9NQVhfVEVSTVMpICYmXG4gICAgICBlLmtleUNvZGUgIT09IDM3IC8qIGxlZnQgKi8gJiYgZS5rZXlDb2RlICE9PSAzOSAvKiByaWdodCAqLyAmJiBlLmtleUNvZGUgIT09IDggJiYgdmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5raWxsRXZlbnQoZSk7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2xpbWl0JywgdGhpcy5tb2RlbCwgdGhpcyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudHJpZ2dlcignbm9saW1pdCcsIHRoaXMubW9kZWwsIHRoaXMpO1xuICAgIH1cblxuICAgIHZhciAkaW5wdXQgPSAkKGUudGFyZ2V0KTtcbiAgICB2YXIgdmFsdWUgPSAkaW5wdXQudmFsKCk7XG4gICAgdmFyIGQgPSB7fTtcblxuICAgIC8vIEdldCB2YWxpZCB0ZXJtcyBhcnJheVxuICAgIGlmICghdmFsdWUpIHtcbiAgICAgIHZhbHVlID0gW107XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhbHVlID0gdmFsdWUuc3BsaXQoJywnKTtcbiAgICB9XG5cbiAgICBkWyd0ZXJtcyddID0gdmFsdWU7XG5cbiAgICB0aGlzLm1vZGVsLnNldChkKTtcbiAgfSxcblxuICBzaG93OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5hZGRDbGFzcygnZW5hYmxlZCcpO1xuICB9LFxuXG4gIGhpZGU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLnJlbW92ZUNsYXNzKCdlbmFibGVkJyk7XG4gIH1cblxufSk7IiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5jZGIuYWRtaW4gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ11bJ2FkbWluJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXVsnYWRtaW4nXSA6IG51bGwpO1xudmFyIEltcG9ydE9wdGlvbnMgPSByZXF1aXJlKCcuL2ltcG9ydF9vcHRpb25zJyk7XG52YXIgSW1wb3J0RmFsbGJhY2sgPSByZXF1aXJlKCcuL2ltcG9ydHMvaW1wb3J0X2RlZmF1bHRfZmFsbGJhY2tfdmlldycpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG5cbi8qKlxuICogIEltcG9ydHMgdmlld1xuICpcbiAqICBEaXNwbGF5cyBhbGwgdGhlIGltcG9ydCBvcHRpb25zIGF2YWlsYWJsZVxuICogIHRocm91Z2ggbmV3IGNyZWF0ZSBkaWFsb2cuXG4gKlxuICogIElNUE9SVEFOVCEhXG4gKlxuICogIElmIHlvdSBuZWVkIHRvIGFkZCBhIG5ldyBpbXBvcnQgcGFuZTpcbiAqXG4gKiAgLSBDcmVhdGUgdGhlIHByb3BlciBjbGFzcyB3aXRoaW4gaW1wb3J0cyBmb2xkZXIgYW5kIGl0cyB0ZXN0cy5cbiAqICAtIEFkZCBuZWNlc3NhcnkgaW5mbyBpbiBpbXBvcnRfb3B0aW9ucyBmaWxlLlxuICogIC0gQ3JlYXRlIGEgY2hlY2sgZnVuY3Rpb24gaGVyZSBpZiBuZWVkZWQsIGlmIG5vdCB3aWxsIGFwcGVhclxuICogICAgYWx3YXlzIGVuYWJsZWQgKGZvciBldmVyeWJvZHkhKS5cbiAqXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuICBjbGFzc05hbWU6ICdJbXBvcnRPcHRpb25zJyxcblxuICBfVEFCU19QRVJfUk9XOiA1LFxuICBfREVGQVVMVF9JTVBPUlQ6ICdmaWxlJyxcbiAgX0lNUE9SVF9PUFRJT05TOiBJbXBvcnRPcHRpb25zLFxuXG4gIF9URVhUUzoge1xuICAgIGtleTogX3QoJzwlLSBuYW1lICU+IGtleSBpcyBub3Qgc3BlY2lmaWVkIGFuZCBwYW5lbCBjYW5cXCd0IGJlIGVuYWJsZWQnKSxcbiAgICBhY2NvdW50OiBfdCgnPCUtIG5hbWUgJT4gZGF0YSBzb3VyY2UgaXMgbm90IGF2YWlsYWJsZSBpbiB5b3VyIHBsYW4uIFBsZWFzZSB1cGdyYWRlJyksXG4gICAgbGltaXRzOiBfdCgnWW91XFwndmUgcmVhY2hlZCB0aGUgbGltaXRzIGZvciB5b3VyIGFjY291bnQuIFBsZWFzZSB1cGdyYWRlJyksXG4gICAgY3JlZGl0czogX3QoJ1lvdVxcJ3ZlIHJlYWNoZWQgdGhlIGF2YWlsYWJsZSA8JS0gbmFtZSAlPiBjcmVkaXRzIGZvciB5b3VyIGFjY291bnQgdGhpcyBtb250aCcpXG4gIH0sXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy1nb05leHQnOiAnX21vdmVOZXh0VGFicycsXG4gICAgJ2NsaWNrIC5qcy1nb1ByZXYnOiAnX21vdmVQcmV2VGFicydcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5vcHRpb25zLnVzZXI7XG4gICAgdGhpcy5tb2RlbCA9IG5ldyBjZGIuY29yZS5Nb2RlbCh7IHBhZ2U6IDEsIG1heFBhZ2VzOiAwIH0pO1xuICAgIHRoaXMuY3JlYXRlTW9kZWwgPSB0aGlzLm9wdGlvbnMuY3JlYXRlTW9kZWw7XG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi92aWV3cy9jcmVhdGUvbGlzdGluZy9pbXBvcnRfdmlldycpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX2Rlc3Ryb3lCaW5kcygpO1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuICAgIHRoaXMuJGVsLmVtcHR5KCk7XG5cbiAgICAvLyBBcHBlbmQgdGVtcGxhdGUgY29udGVudFxuICAgIHRoaXMuJGVsLmFwcGVuZCh0aGlzLnRlbXBsYXRlKCkpO1xuICAgIC8vIEdlbmVyYXRlIHRhYnMhXG4gICAgdGhpcy5fZ2VuVGFicygpO1xuICAgIC8vIEdlbmVyYXRlIHRhYnMgbmF2aWdhdGlvblxuICAgIHRoaXMuX2dlblRhYnNOYXZpZ2F0aW9uKCk7XG4gICAgLy8gR2VuZXJhdGUgcGFuZXMhXG4gICAgdGhpcy5fZ2VuUGFuZXMoKTtcbiAgICAvLyBTZXQgYmluZHNcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICAvLyBTZXQgb3B0aW9uXG4gICAgdGhpcy5fc2V0T3B0aW9uKCk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICAvKipcbiAgICogIFRBQlMgJiYgUEFORVMhXG4gICAqL1xuICBfZ2VuVGFiczogZnVuY3Rpb24gKCkge1xuICAgIHZhciB0YWJzID0gJyc7XG4gICAgdmFyIHRhYlRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL3ZpZXdzL2NyZWF0ZS9saXN0aW5nL2ltcG9ydF90YWInKTtcblxuICAgIF8uZWFjaCh0aGlzLl9JTVBPUlRfT1BUSU9OUywgZnVuY3Rpb24gKHRhYikge1xuICAgICAgaWYgKCFfLmlzRW1wdHkodGFiKSAmJiB0YWIuZW5hYmxlZChjZGIuY29uZmlnLCB0aGlzLnVzZXIpKSB7XG4gICAgICAgIHRhYnMgKz0gdGFiVGVtcGxhdGUodGFiKTtcbiAgICAgIH1cbiAgICB9LCB0aGlzKTtcblxuICAgIHRoaXMuJCgnLkltcG9ydE9wdGlvbnMtdGFic0xpc3QnKS5hcHBlbmQodGFicyk7XG5cbiAgICAvLyBDcmVhdGUgdGFic1xuICAgIHRoaXMuaW1wb3J0VGFicyA9IG5ldyBjZGIuYWRtaW4uVGFicyh7XG4gICAgICBlbDogdGhpcy4kKCcuSW1wb3J0T3B0aW9ucy10YWJzTGlzdCcpLFxuICAgICAgc2xhc2g6IHRydWVcbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5pbXBvcnRUYWJzKTtcbiAgfSxcblxuICBfZ2VuVGFic05hdmlnYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbnVtVGFicyA9IHRoaXMuJCgnLkltcG9ydE9wdGlvbnMtdGFiJykuc2l6ZSgpO1xuICAgIGlmIChudW1UYWJzIDw9IDEpIHtcbiAgICAgIHRoaXMuJCgnLkltcG9ydE9wdGlvbnMtdGFicycpLmhpZGUoKTtcbiAgICB9XG5cbiAgICAvLyBTZXQgbWF4IHBhZ2VzXG4gICAgdGhpcy5tb2RlbC5zZXQoJ21heFBhZ2VzJywgTWF0aC5jZWlsKG51bVRhYnMgLyB0aGlzLl9UQUJTX1BFUl9ST1cpKTtcbiAgICB0aGlzLl9jaGVja1RhYnNOYXZpZ2F0aW9uKCk7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdtYXhQYWdlcycpIDw9IDEpIHtcbiAgICAgIHRoaXMuJCgnLkltcG9ydE9wdGlvbnMtbmF2aWdhdGlvbicpLmhpZGUoKTtcbiAgICB9XG4gIH0sXG5cbiAgX21vdmVOZXh0VGFiczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBwYWdlID0gdGhpcy5tb2RlbC5nZXQoJ3BhZ2UnKTtcbiAgICB2YXIgbWF4UGFnZXMgPSB0aGlzLm1vZGVsLmdldCgnbWF4UGFnZXMnKTtcblxuICAgIGlmIChwYWdlIDwgbWF4UGFnZXMpIHtcbiAgICAgIHRoaXMubW9kZWwuc2V0KCdwYWdlJywgcGFnZSArIDEpO1xuICAgIH1cbiAgfSxcblxuICBfbW92ZVByZXZUYWJzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHBhZ2UgPSB0aGlzLm1vZGVsLmdldCgncGFnZScpO1xuICAgIGlmIChwYWdlID4gMSkge1xuICAgICAgdGhpcy5tb2RlbC5zZXQoJ3BhZ2UnLCBwYWdlIC0gMSk7XG4gICAgfVxuICB9LFxuXG4gIF9tb3ZlVGFic05hdmlnYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcGFnZSA9IHRoaXMubW9kZWwuZ2V0KCdwYWdlJyk7XG4gICAgdmFyIHJvd1dpZHRoID0gODAwO1xuXG4gICAgdGhpcy4kKCcuSW1wb3J0T3B0aW9ucy10YWJzTGlzdCcpLmNzcygnbWFyZ2luLWxlZnQnLCAnLScgKyAocm93V2lkdGggKiAocGFnZSAtIDEpKSArICdweCcpO1xuICAgIHRoaXMuX2NoZWNrVGFic05hdmlnYXRpb24oKTtcbiAgfSxcblxuICBfY2hlY2tUYWJzTmF2aWdhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgIHZhciBwYWdlID0gdGhpcy5tb2RlbC5nZXQoJ3BhZ2UnKTtcbiAgICB2YXIgbWF4UGFnZXMgPSB0aGlzLm1vZGVsLmdldCgnbWF4UGFnZXMnKTtcblxuICAgIC8vIENoZWNrIHByZXYgYnV0dG9uXG4gICAgdGhpcy4kKCcuanMtZ29QcmV2JylbIHBhZ2UgPiAxID8gJ3JlbW92ZUNsYXNzJyA6ICdhZGRDbGFzcycgXSgnaXMtZGlzYWJsZWQnKTtcblxuICAgIC8vIENoZWNrIG5leHQgYnV0dG9uXG4gICAgdGhpcy4kKCcuanMtZ29OZXh0JylbIHBhZ2UgPCBtYXhQYWdlcyA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnIF0oJ2lzLWRpc2FibGVkJyk7XG4gIH0sXG5cbiAgX2dlblBhbmVzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgLy8gQ3JlYXRlIFRhYlBhbmVcbiAgICB0aGlzLmltcG9ydFBhbmVzID0gbmV3IGNkYi51aS5jb21tb24uVGFiUGFuZSh7XG4gICAgICBlbDogdGhpcy4kKCcuSW1wb3J0T3B0aW9ucy1wYW5lcycpXG4gICAgfSk7XG4gICAgdGhpcy5hZGRWaWV3KHRoaXMuaW1wb3J0UGFuZXMpO1xuXG4gICAgLy8gTGluayB0YWJzIHdpdGggcGFuZXNcbiAgICB0aGlzLmltcG9ydFRhYnMubGlua1RvUGFuZWwodGhpcy5pbXBvcnRQYW5lcyk7XG5cbiAgICAvLyBSZW5kZXIgcGFuZXMhXG4gICAgXy5lYWNoKHRoaXMuX0lNUE9SVF9PUFRJT05TLCBmdW5jdGlvbiAoSW1wLCBpKSB7XG4gICAgICB2YXIgcGFuZSA9ICcnO1xuXG4gICAgICAvLyBDaGVjayBpZiBpbXBvcnQgb3B0aW9uIGZ1bmN0aW9uIGV4aXN0c1xuICAgICAgdmFyIGZuID0gc2VsZlsnX2NoZWNrJyArIGkgKyAnSW1wb3J0J107XG4gICAgICB2YXIgaXNFbmFibGVkID0gKGZuICYmIGZuKEltcCwgc2VsZikpO1xuXG4gICAgICBpZiAoKGlzRW5hYmxlZCB8fCBpc0VuYWJsZWQgPT09IHVuZGVmaW5lZCkgJiYgIV8uaXNFbXB0eShJbXApKSB7XG4gICAgICAgIHBhbmUgPSBuZXcgSW1wLkNsYXNzTmFtZShcbiAgICAgICAgICBfLmV4dGVuZChcbiAgICAgICAgICAgIChJbXAub3B0aW9ucyB8fCB7fSksIHtcbiAgICAgICAgICAgICAgdXNlcjogc2VsZi51c2VyLFxuICAgICAgICAgICAgICB0aXRsZTogSW1wLnRpdGxlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChJbXAuZmFsbGJhY2spIHtcbiAgICAgICAgcGFuZSA9IG5ldyBJbXBvcnRGYWxsYmFjayh7XG4gICAgICAgICAgdGVtcGxhdGU6IEltcC5mYWxsYmFja1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKHBhbmUpIHtcbiAgICAgICAgcGFuZS5yZW5kZXIoKTtcbiAgICAgICAgcGFuZS5iaW5kKCdjaGFuZ2UnLCBzZWxmLl9zZXRVcGxvYWRNb2RlbCwgc2VsZik7XG4gICAgICAgIHNlbGYuaW1wb3J0UGFuZXMuYWRkVGFiKEltcC5uYW1lLCBwYW5lKTtcbiAgICAgICAgc2VsZi5hZGRWaWV3KHBhbmUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIF9jaGVja0dEcml2ZUltcG9ydDogZnVuY3Rpb24gKGltcCwgdikge1xuICAgIGlmICghY2RiLmNvbmZpZy5nZXQoJ29hdXRoX2dkcml2ZScpKSB7XG4gICAgICB2Ll9zZXRGYWlsZWRUYWIoJ2dkcml2ZScsICdrZXknKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgX2NoZWNrRHJvcGJveEltcG9ydDogZnVuY3Rpb24gKGltcCwgdikge1xuICAgIGlmICghY2RiLmNvbmZpZy5nZXQoJ29hdXRoX2Ryb3Bib3gnKSkge1xuICAgICAgdi5fc2V0RmFpbGVkVGFiKCdkcm9wYm94JywgJ2tleScpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcblxuICBfY2hlY2tCb3hJbXBvcnQ6IGZ1bmN0aW9uIChpbXAsIHYpIHtcbiAgICBpZiAoIWNkYi5jb25maWcuZ2V0KCdvYXV0aF9ib3gnKSkge1xuICAgICAgdi5fc2V0RmFpbGVkVGFiKCdib3gnLCAna2V5Jyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIF9jaGVja1R3aXR0ZXJJbXBvcnQ6IGZ1bmN0aW9uIChpbXAsIHYpIHtcbiAgICAvLyBDaGVjayBpZiB1c2VyIGhhdmUgdHdpdHRlciBkYXRhc291cmNlIGVuYWJsZWQhXG4gICAgaWYgKCFjZGIuY29uZmlnLmdldCgnZGF0YXNvdXJjZV9zZWFyY2hfdHdpdHRlcicpKSB7XG4gICAgICB2Ll9zZXRGYWlsZWRUYWIoJ3R3aXR0ZXInLCAna2V5Jyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBjYW4gY3JlYXRlIG9yIGltcG9ydCBhIG5ldyBmaWxlIG9yIHVzZXIgaGFzXG4gICAgLy8gZW5vdWdoIHJpZ2h0cyB0byBlbmFibGUgdHdpdHRlciFcbiAgICBpZiAoIXYudXNlci5nZXQoJ3R3aXR0ZXInKS5lbmFibGVkKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBjYW4gY3JlYXRlIG9yIGltcG9ydCBhIG5ldyBmaWxlIG9yIHVzZXIgaGFzXG4gICAgLy8gZW5vdWdoIHJpZ2h0cyB0byBlbmFibGUgdHdpdHRlciFcbiAgICBpZiAoKHYudXNlci5nZXQoJ3R3aXR0ZXInKS5xdW90YSAtIHYudXNlci5nZXQoJ3R3aXR0ZXInKS5tb250aGx5X3VzZSkgPD0gMCAmJiB2LnVzZXIuZ2V0KCd0d2l0dGVyJykuaGFyZF9saW1pdCkge1xuICAgICAgdi5fc2V0RmFpbGVkVGFiKCd0d2l0dGVyJywgJ2NyZWRpdHMnKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcblxuICBfY2hlY2tJbnN0YWdyYW1JbXBvcnQ6IGZ1bmN0aW9uIChpbXAsIHYpIHtcbiAgICBpZiAoIXYudXNlci5mZWF0dXJlRW5hYmxlZCgnaW5zdGFncmFtX2ltcG9ydCcpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICghY2RiLmNvbmZpZy5nZXQoJ29hdXRoX2luc3RhZ3JhbScpKSB7XG4gICAgICB2Ll9zZXRGYWlsZWRUYWIoJ2luc3RhZ3JhbScsICdrZXknKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgX2NoZWNrU2FsZXNmb3JjZUltcG9ydDogZnVuY3Rpb24gKGltcCwgdikge1xuICAgIC8vIENvbm5lY3RvciBpcyBub3cgZGlzYWJsZWQgZm9yIGV2ZXJ5b25lLlxuICAgIC8vIFlvdSBjYW4gdXNlIHRoZSBmb2xsb3dpbmcgY2hlY2sgdG8gZGV0ZXJtaW5lIGlmXG4gICAgLy8gdXNlci9vcmcgaGFzIHRoaXMgY29ubmVjdG9yIGVuYWJsZWQ6XG4gICAgLy8gdi51c2VyLmdldCgnc2FsZXNmb3JjZScpLmVuYWJsZWRcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG5cbiAgX2NoZWNrTWFpbGNoaW1wSW1wb3J0OiBmdW5jdGlvbiAoaW1wLCB2KSB7XG4gICAgLy8gQ29uZmlnIGF2YWlsYWJsZT9cbiAgICBpZiAoIWNkYi5jb25maWcuZ2V0KCdvYXV0aF9tYWlsY2hpbXAnKSkge1xuICAgICAgdi5fc2V0RmFpbGVkVGFiKCdtYWlsY2hpbXAnLCAna2V5Jyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIEZlYXR1cmUgZW5hYmxlZD9cbiAgICBpZiAoIXYudXNlci5mZWF0dXJlRW5hYmxlZCgnbWFpbGNoaW1wX2ltcG9ydCcpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIF9zZXRGYWlsZWRUYWI6IGZ1bmN0aW9uICh0YWIsIHR5cGUpIHtcbiAgICB2YXIgJHRhYiA9IHRoaXMuaW1wb3J0VGFicy5nZXRUYWIodGFiKTtcbiAgICAkdGFiLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICAgIHRoaXMuX2NyZWF0ZVRvb2x0aXAodGFiLCB0eXBlKTtcbiAgfSxcblxuICBfY3JlYXRlVG9vbHRpcDogZnVuY3Rpb24gKHRhYiwgdHlwZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgJHRhYiA9IHRoaXMuaW1wb3J0VGFicy5nZXRUYWIodGFiKTtcblxuICAgIC8vIFRpcHN5P1xuICAgIHZhciB0b29sdGlwID0gbmV3IGNkYi5jb21tb24uVGlwc3lUb29sdGlwKHtcbiAgICAgIGVsOiAkdGFiLFxuICAgICAgdGl0bGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF8udGVtcGxhdGUoc2VsZi5fVEVYVFNbdHlwZV0pKHsgbmFtZTogdGFiIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRWaWV3KHRvb2x0aXApO1xuICB9LFxuXG4gIF9zZXRVcGxvYWRNb2RlbDogZnVuY3Rpb24gKGQpIHtcbiAgICB0aGlzLmNyZWF0ZU1vZGVsLnVwbG9hZC5zZXRGcmVzaChkKTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6cGFnZScsIHRoaXMuX21vdmVUYWJzTmF2aWdhdGlvbiwgdGhpcyk7XG4gICAgaWYgKHRoaXMuaW1wb3J0UGFuZXMpIHtcbiAgICAgIHRoaXMuaW1wb3J0UGFuZXMuYmluZCgndGFiRW5hYmxlZCcsIHRoaXMuX29uVGFiQ2hhbmdlLCB0aGlzKTtcbiAgICB9XG4gIH0sXG5cbiAgX2Rlc3Ryb3lCaW5kczogZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmltcG9ydFBhbmVzKSB7XG4gICAgICB0aGlzLmltcG9ydFBhbmVzLnVuYmluZCgndGFiRW5hYmxlZCcsIG51bGwsIHRoaXMpO1xuICAgIH1cbiAgfSxcblxuICBfc2V0T3B0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gRmlyc3Qgb3B0aW9uID4gZGF0YSBmaWxlXG4gICAgdGhpcy5pbXBvcnRQYW5lcy5hY3RpdmUodGhpcy5fREVGQVVMVF9JTVBPUlQpO1xuICAgIHRoaXMuX3VwZGF0ZUltcG9ydE9wdGlvbigpO1xuICB9LFxuXG4gIF91cGRhdGVJbXBvcnRPcHRpb246IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNyZWF0ZU1vZGVsLnNldEFjdGl2ZUltcG9ydFBhbmUodGhpcy5pbXBvcnRQYW5lcy5hY3RpdmVUYWIpO1xuICB9LFxuXG4gIC8qKlxuICAgKiAgRVZFTlRTXG4gICAqL1xuICBfb25UYWJDaGFuZ2U6IGZ1bmN0aW9uICh0YWJOYW1lKSB7XG4gICAgdmFyIHYgPSB0aGlzLmltcG9ydFBhbmVzLmdldFBhbmUodGFiTmFtZSk7XG4gICAgLy8gU2V0IHVwbG9hZCBtb2RlbCBmcm9tIGFjdGl2YXRlZCBwYW5lIHRvIGNyZWF0ZSBtb2RlbFxuICAgIHZhciB1cGxvYWQgPSB2LmdldE1vZGVsRGF0YSAmJiB2LmdldE1vZGVsRGF0YSgpO1xuICAgIGlmICh1cGxvYWQpIHtcbiAgICAgIHRoaXMuX3NldFVwbG9hZE1vZGVsKHVwbG9hZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3NldFVwbG9hZE1vZGVsKHt9KTtcbiAgICB9XG4gICAgdGhpcy5fdXBkYXRlSW1wb3J0T3B0aW9uKCk7XG4gIH0sXG5cbiAgY2xlYW46IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9kZXN0cm95QmluZHMoKTtcbiAgICBjZGIuY29yZS5WaWV3LnByb3RvdHlwZS5jbGVhbi5jYWxsKHRoaXMpO1xuICB9XG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgVXRpbHMgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ11bJ1V0aWxzJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXVsnVXRpbHMnXSA6IG51bGwpO1xudmFyIHBsdXJhbGl6ZVN0cmluZyA9IHJlcXVpcmUoJy4uLy4uLy4uL3ZpZXdfaGVscGVycy9wbHVyYWxpemVfc3RyaW5nJyk7XG5cbi8qKlxuICogIExpc3RpbmcgZGF0YXNldHMgbmF2aWdhdGlvbi5cbiAqXG4gKiAgLSAnRmlsdGVyIGJ5JyBkYXRhc2V0cy5cbiAqICAtICdTZWFyY2gnIGFueSBwYXR0ZXJuIHdpdGhpbiBkYXRhc2V0IGNvbGxlY3Rpb24uXG4gKlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBldmVudHM6IHtcbiAgICAnc3VibWl0IC5qcy1zZWFyY2gtZm9ybSc6ICAgJ19zdWJtaXRTZWFyY2gnLFxuICAgICdrZXlkb3duIC5qcy1zZWFyY2gtZm9ybSc6ICAnX29uU2VhcmNoS2V5RG93bicsXG4gICAgJ2NsaWNrIC5qcy1zZWFyY2gtZm9ybSc6ICAgICdraWxsRXZlbnQnLFxuICAgICdjbGljayAuanMtc2VhcmNoLWxpbmsnOiAgICAnX29uU2VhcmNoQ2xpY2snLFxuICAgICdjbGljayAuanMtY2xlYW4tc2VhcmNoJzogICAnX29uQ2xlYW5TZWFyY2hDbGljaycsXG4gICAgJ2NsaWNrIC5qcy1zaGFyZWQnOiAgICAgICAgICdfb25TaGFyZWRDbGljaycsXG4gICAgJ2NsaWNrIC5qcy1saWJyYXJ5JzogICAgICAgICdfb25MaWJyYXJ5Q2xpY2snLFxuICAgICdjbGljayAuanMtY29ubmVjdCc6ICAgICAgICAnX29uQ29ubmVjdENsaWNrJyxcbiAgICAnY2xpY2sgLmpzLWRhdGFzZXRzJzogICAgICAgJ19vbkRhdGFzZXRzQ2xpY2snLFxuICAgICdjbGljayAuanMtY3JlYXRlX2VtcHR5JzogICAnX29uQ3JlYXRlRW1wdHlDbGljaydcbiAgfSxcblxuICBfVEVYVFM6IHtcbiAgICBjcmVhdGVGcm9tU2NyYXRjaExhYmVsOiB7XG4gICAgICBtYXA6ICdDcmVhdGUgZW1wdHkgbWFwJyxcbiAgICAgIGRhdGFzZXQ6ICdDcmVhdGUgZW1wdHkgZGF0YXNldCcsXG4gICAgICBhZGRMYXllcjogJ0FkZCBhbiBlbXB0eSBsYXllcidcbiAgICB9XG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5yb3V0ZXJNb2RlbCA9IHRoaXMub3B0aW9ucy5yb3V0ZXJNb2RlbDtcbiAgICB0aGlzLmNyZWF0ZU1vZGVsID0gdGhpcy5vcHRpb25zLmNyZWF0ZU1vZGVsO1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vdmlld3MvY3JlYXRlL2xpc3RpbmcvbmF2aWdhdGlvbicpO1xuICAgIHRoaXMubW9kZWwgPSBuZXcgY2RiLmNvcmUuTW9kZWwoKTtcblxuICAgIHRoaXMuX3ByZVJlbmRlcigpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIC8vIEl0IGlzIG5lY2Vzc2FyeSB0byBhZGQgdHdvIHN0YXRpYyBlbGVtZW50cyBiZWNhdXNlXG4gIC8vIHRoZXkgY2FuJ3QgYmUgcmVtb3ZlZC9yZXBsYWNlZCB1c2luZyByZW5kZXIgbWV0aG9kXG4gIC8vIGVhY2ggdGltZSBhIGNoYW5nZSAoaW4gYSBtb2RlbCBvciBhIGNvbGxlY3Rpb24pIGhhcHBlbnMuXG4gIC8vIFRoaXMgaXMgZHVlIHRvIHRoZSBiZWhhdmlvdXIgb2YgdGhlIENTUyBhbmltYXRpb25zLlxuICBfcHJlUmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgJHVJbm5lciA9ICQoJzxkaXY+JykuYWRkQ2xhc3MoJ3UtaW5uZXInKTtcbiAgICB2YXIgJGZpbHRlcnNJbm5lciA9ICQoJzxkaXY+JykuYWRkQ2xhc3MoJ0ZpbHRlcnMtaW5uZXInKTtcbiAgICB0aGlzLiRlbC5hcHBlbmQoJHVJbm5lci5hcHBlbmQoJGZpbHRlcnNJbm5lcikpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24obSwgYykge1xuICAgIGlmICh0aGlzLnRvb2x0aXBWaWV3KSB7XG4gICAgICB0aGlzLnRvb2x0aXBWaWV3LmNsZWFuKCk7XG4gICAgfVxuXG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG5cbiAgICB2YXIgc2VsZWN0ZWRJdGVtc0NvdW50ID0gdGhpcy5fc2VsZWN0ZWRJdGVtcygpLmxlbmd0aDtcbiAgICAvLyBJZiBhIGNoYW5nZSBpcyBtYWRlIGZyb20gY29udGVudCB0eXBlIHdlIGhhdmUgdG8ga25vd1xuICAgIC8vIHByZXZlbnRpbmcgc2hvdyB3cm9uZyBkYXRhIGFib3V0IHRvdGFsIGl0ZW1zXG4gICAgdmFyIGNoYW5nZWRDb250ZW50VHlwZSA9IGMgJiYgYy5jaGFuZ2VzICYmIGMuY2hhbmdlcy5jb250ZW50X3R5cGU7XG4gICAgdmFyIGNyZWF0ZU1vZGVsVHlwZSA9IHRoaXMuY3JlYXRlTW9kZWwuZ2V0KCd0eXBlJyk7XG5cbiAgICB0aGlzLiQoJy5GaWx0ZXJzLWlubmVyJykuaHRtbChcbiAgICAgIHRoaXMudGVtcGxhdGUoXG4gICAgICAgIF8uZXh0ZW5kKHtcbiAgICAgICAgICAgIGNyZWF0ZU1vZGVsOiAgICAgICAgICAgdGhpcy5jcmVhdGVNb2RlbCxcbiAgICAgICAgICAgIGNhbkNyZWF0ZURhdGFzZXQ6ICAgICAgdGhpcy51c2VyLmNhbkNyZWF0ZURhdGFzZXRzKCksXG4gICAgICAgICAgICBsaXN0aW5nOiAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlTW9kZWwuZ2V0KCdsaXN0aW5nJyksXG4gICAgICAgICAgICBpc0luc2lkZU9yZzogICAgICAgICAgIHRoaXMudXNlci5pc0luc2lkZU9yZygpLFxuICAgICAgICAgICAgc2VsZWN0ZWRJdGVtc0NvdW50OiAgICBzZWxlY3RlZEl0ZW1zQ291bnQsXG4gICAgICAgICAgICBtYXhMYXllcnNCeU1hcDogICAgICAgIHRoaXMudXNlci5nZXRNYXhMYXllcnMoKSxcbiAgICAgICAgICAgIHRvdGFsU2hhcmVkOiAgICAgICAgICAgY2hhbmdlZENvbnRlbnRUeXBlID8gMCA6IHRoaXMuY29sbGVjdGlvbi50b3RhbF9zaGFyZWQsXG4gICAgICAgICAgICBwYWdlSXRlbXM6ICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5zaXplKCksXG4gICAgICAgICAgICByb3V0ZXJNb2RlbDogICAgICAgICAgIHRoaXMucm91dGVyTW9kZWwsXG4gICAgICAgICAgICBjcmVhdGVGcm9tU2NyYXRjaExhYmVsOiB0aGlzLl9URVhUUy5jcmVhdGVGcm9tU2NyYXRjaExhYmVsW2NyZWF0ZU1vZGVsVHlwZV0sXG4gICAgICAgICAgICBkYXRhc2V0c1RhYkRpc2FibGVkOiB0aGlzLl9kYXRhc2V0c1RhYkRpc2FibGVkKCksXG4gICAgICAgICAgICBoYXNEYXRhTGlicmFyeTogY2RiLmNvbmZpZy5nZXQoJ2RhdGFfbGlicmFyeV9lbmFibGVkJylcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRoaXMucm91dGVyTW9kZWwuYXR0cmlidXRlc1xuICAgICAgICApXG4gICAgICApXG4gICAgKTtcblxuICAgIGlmKHRoaXMuX2RhdGFzZXRzVGFiRGlzYWJsZWQoKSkge1xuICAgICAgdGhpcy50b29sdGlwVmlldyA9IG5ldyBjZGIuY29tbW9uLlRpcHN5VG9vbHRpcCh7XG4gICAgICAgIGVsOiB0aGlzLiQoJy5qcy1kYXRhc2V0cycpLFxuICAgICAgICB0aXRsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBfdCgnVGhlcmUgYXJlIG5vIGRhdGFzZXRzIGNvbm5lY3RlZCB0byB5b3VyIGFjY291bnQnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLmFkZFZpZXcodGhpcy50b29sdGlwVmlldyk7XG4gICAgfVxuXG4gICAgdGhpcy5fYW5pbWF0ZSgpO1xuICAgIGlmICh0aGlzLnJvdXRlck1vZGVsLmlzU2VhcmNoaW5nKCkpIHtcbiAgICAgIHRoaXMuX2ZvY3VzU2VhcmNoSW5wdXQoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLm9uKCdjaGFuZ2U6aXNTZWFyY2hFbmFibGVkJywgdGhpcy5fb25DaGFuZ2VJc1NlYXJjaEVuYWJsZWQsIHRoaXMpO1xuICAgIHRoaXMuY3JlYXRlTW9kZWwuYmluZCgnY2hhbmdlOmxpc3RpbmcnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5yb3V0ZXJNb2RlbC5iaW5kKCdjaGFuZ2UnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmJpbmQoJ3Jlc2V0JywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIGNkYi5nb2QuYmluZCgnY2xvc2VEaWFsb2dzJywgdGhpcy5fYW5pbWF0ZSwgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbChjZGIuZ29kKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMuY3JlYXRlTW9kZWwpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5jb2xsZWN0aW9uKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMucm91dGVyTW9kZWwpO1xuICB9LFxuXG4gIF9vbkNoYW5nZUlzU2VhcmNoRW5hYmxlZDogZnVuY3Rpb24obW9kZWwsIGlzU2VhcmNoRW5hYmxlZCkge1xuICAgIHRoaXMuX2VuYWJsZVNlYXJjaFVJKGlzU2VhcmNoRW5hYmxlZCk7XG5cbiAgICBpZiAodGhpcy5yb3V0ZXJNb2RlbC5pc1NlYXJjaGluZygpKSB7XG4gICAgICB0aGlzLl9jbGVhblNlYXJjaCgpO1xuICAgIH0gZWxzZSBpZiAoaXNTZWFyY2hFbmFibGVkKSB7XG4gICAgICB0aGlzLl8kc2VhcmNoSW5wdXQoKS52YWwoJycpO1xuICAgICAgdGhpcy5fZm9jdXNTZWFyY2hJbnB1dCgpO1xuICAgIH1cbiAgfSxcblxuICBfJHNlYXJjaElucHV0OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy4kKCcuanMtc2VhcmNoLWlucHV0JylcbiAgfSxcblxuICBfZm9jdXNTZWFyY2hJbnB1dDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fJHNlYXJjaElucHV0KClcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLmZvY3VzKCk7XG4gIH0sXG5cbiAgX29uU2VhcmNoS2V5RG93bjogZnVuY3Rpb24oZSkge1xuICAgIC8vIEVTQ1xuICAgIGlmIChlLmtleUNvZGUgPT09IDI3KSB7XG4gICAgICB0aGlzLmtpbGxFdmVudChlKTtcbiAgICAgIHRoaXMuX2NsZWFuU2VhcmNoKCk7XG4gICAgfVxuICB9LFxuXG4gIF9zZWxlY3RlZEl0ZW1zOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5jb2xsZWN0aW9uLndoZXJlKHsgc2VsZWN0ZWQ6IHRydWUgfSk7XG4gIH0sXG5cbiAgX2FuaW1hdGU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2VuYWJsZVNlYXJjaFVJKCEhdGhpcy5yb3V0ZXJNb2RlbC5pc1NlYXJjaGluZygpKTtcblxuICAgIC8vIENoZWNrIGlmIHVzZXIgZG9lc24ndCBoYXZlIGFueSB0YWJsZSBhbmQgaXQgaXMgaW4gbGlicmFyeSBzZWN0aW9uXG4gICAgLy8gdG8gcmVtb3ZlIHVzZWxlc3Mgc2hhZG93XG4gICAgdmFyIGluTGlicmFyeVNlY3Rpb24gPSB0aGlzLnJvdXRlck1vZGVsLmdldCgnbGlicmFyeScpO1xuICAgIHZhciBpbkRhdGFzZXRzU2VjdGlvbiA9IHRoaXMuY3JlYXRlTW9kZWwuZ2V0KCdsaXN0aW5nJykgPT09IFwiZGF0YXNldHNcIjtcbiAgICB2YXIgaGFzRGF0YXNldHMgPSB0aGlzLmNvbGxlY3Rpb24udG90YWxfdXNlcl9lbnRyaWVzID4gMDtcbiAgICB0aGlzLiRlbC50b2dnbGVDbGFzcygnbm8tc2hhZG93JywgaW5MaWJyYXJ5U2VjdGlvbiAmJiAhaGFzRGF0YXNldHMgJiYgaW5EYXRhc2V0c1NlY3Rpb24pO1xuICB9LFxuXG4gIF9lbmFibGVTZWFyY2hVSTogZnVuY3Rpb24oZW5hYmxlKSB7XG4gICAgdGhpcy4kKCcuanMtc2VhcmNoLWZpZWxkJykudG9nZ2xlKGVuYWJsZSk7XG4gICAgdGhpcy4kKCcuanMtbGlua3MtbGlzdCcpLnRvZ2dsZUNsYXNzKCdpcy1oaWRkZW4nLCBlbmFibGUpO1xuICAgIHRoaXMuJCgnLmpzLW9yZGVyLWxpc3QnKS50b2dnbGVDbGFzcygnaXMtaGlkZGVuJywgZW5hYmxlKTtcbiAgfSxcblxuICBfb25EYXRhc2V0c0NsaWNrOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5fZGF0YXNldHNUYWJEaXNhYmxlZCgpKSByZXR1cm47XG5cbiAgICB0aGlzLnJvdXRlck1vZGVsLnNldCh7XG4gICAgICBzaGFyZWQ6ICdubycsXG4gICAgICBsaWJyYXJ5OiBmYWxzZSxcbiAgICAgIHBhZ2U6IDFcbiAgICB9KTtcbiAgICB0aGlzLmNyZWF0ZU1vZGVsLnNldCgnbGlzdGluZycsICdkYXRhc2V0cycpO1xuICB9LFxuXG4gIF9vblNoYXJlZENsaWNrOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnJvdXRlck1vZGVsLnNldCh7XG4gICAgICBzaGFyZWQ6ICdvbmx5JyxcbiAgICAgIGxpYnJhcnk6IGZhbHNlLFxuICAgICAgcGFnZTogMVxuICAgIH0pO1xuICAgIHRoaXMuY3JlYXRlTW9kZWwuc2V0KCdsaXN0aW5nJywgJ2RhdGFzZXRzJyk7XG4gIH0sXG5cbiAgX29uTGlicmFyeUNsaWNrOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnJvdXRlck1vZGVsLnNldCh7XG4gICAgICBzaGFyZWQ6ICdubycsXG4gICAgICBsaWJyYXJ5OiB0cnVlLFxuICAgICAgcGFnZTogMVxuICAgIH0pO1xuICAgIHRoaXMuY3JlYXRlTW9kZWwuc2V0KCdsaXN0aW5nJywgJ2RhdGFzZXRzJyk7XG5cbiAgICAvLyBFdmVudCB0cmFja2luZyBcIkNsaWNrZWQgQ29tbW9uIGRhdGFcIlxuICAgIGNkYi5nb2QudHJpZ2dlcignbWV0cmljcycsICdjb21tb25fZGF0YScsIHtcbiAgICAgIGVtYWlsOiB3aW5kb3cudXNlcl9kYXRhLmVtYWlsXG4gICAgfSk7XG4gIH0sXG5cbiAgX29uQ29ubmVjdENsaWNrOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy51c2VyLmNhbkNyZWF0ZURhdGFzZXRzKCkpIHtcbiAgICAgIHRoaXMuY3JlYXRlTW9kZWwuc2V0KCdsaXN0aW5nJywgJ2ltcG9ydCcpO1xuICAgIH1cbiAgfSxcblxuICBfb25DcmVhdGVFbXB0eUNsaWNrOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy51c2VyLmNhbkNyZWF0ZURhdGFzZXRzKCkpIHtcbiAgICAgIHRoaXMuY3JlYXRlTW9kZWwuY3JlYXRlRnJvbVNjcmF0Y2goKTtcbiAgICB9XG4gIH0sXG5cbiAgX2RhdGFzZXRzVGFiRGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVNb2RlbC5nZXQoJ2RhdGFzZXRzVGFiRGlzYWJsZWQnKTtcbiAgfSxcblxuICAvLyBTZWxlY3Rpb24gYWN0aW9uc1xuXG4gIF9vblNlYXJjaENsaWNrOiBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUpIHRoaXMua2lsbEV2ZW50KGUpO1xuICAgIHRoaXMubW9kZWwuc2V0KCdpc1NlYXJjaEVuYWJsZWQnLCAhdGhpcy5tb2RlbC5nZXQoJ2lzU2VhcmNoRW5hYmxlZCcpKTtcbiAgfSxcblxuICAvLyBGaWx0ZXIgYWN0aW9uc1xuXG4gIF9vbkNsZWFuU2VhcmNoQ2xpY2s6IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZSkgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuX2NsZWFuU2VhcmNoKCk7XG4gIH0sXG5cbiAgX2NsZWFuU2VhcmNoOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnJvdXRlck1vZGVsLnNldCh7XG4gICAgICBxOiAnJyxcbiAgICAgIHRhZzogJycsXG4gICAgICBzaGFyZWQ6ICdubycsXG4gICAgICBsaWJyYXJ5OiB0aGlzLmNyZWF0ZU1vZGVsLnNob3dMaWJyYXJ5KClcbiAgICB9KTtcbiAgICB0aGlzLm1vZGVsLnNldCgnaXNTZWFyY2hFbmFibGVkJywgZmFsc2UpO1xuICB9LFxuXG4gIF9zdWJtaXRTZWFyY2g6IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZSkgdGhpcy5raWxsRXZlbnQoZSk7XG4gICAgdmFyIHZhbCA9IFV0aWxzLnN0cmlwSFRNTCh0aGlzLiQoJy5qcy1zZWFyY2gtaW5wdXQnKS52YWwoKS50cmltKCksJycpO1xuICAgIHZhciB0YWcgPSB2YWwuc2VhcmNoKCc6JykgPT09IDAgPyB2YWwucmVwbGFjZSgnOicsICcnKSA6ICcnO1xuICAgIHZhciBxID0gdmFsLnNlYXJjaCgnOicpICE9PSAwID8gdmFsIDogJyc7XG5cbiAgICB0aGlzLnJvdXRlck1vZGVsLnNldCh7XG4gICAgICBwYWdlOiAxLFxuICAgICAgdGFnOiB0YWcsXG4gICAgICBxOiBxLFxuICAgICAgc2hhcmVkOiAneWVzJ1xuICAgIH0pO1xuXG4gICAgdGhpcy5jcmVhdGVNb2RlbC5zZXQoJ2xpc3RpbmcnLCAnZGF0YXNldHMnKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIEJhc2VEaWFsb2cgPSByZXF1aXJlKCcuLi8uLi92aWV3cy9iYXNlX2RpYWxvZy92aWV3Jyk7XG52YXIgVmlld0ZhY3RvcnkgPSByZXF1aXJlKCcuLi8uLi92aWV3X2ZhY3RvcnknKTtcbnZhciByYW5kb21RdW90ZSA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfaGVscGVycy9yYW5kb21fcXVvdGUnKTtcblxuLyoqXG4gKiBDcmVhdGUgYSB2aXMgZnJvbSBhIGRhdGFzZXQsIHJlcXVpcmVkIGZvciBzb21lIGNvbnRleHRzIHRvIGhhdmUgYSB2aXMgYmVmb3JlIGJlIGFibGUgdG8gY2Fycnkgb3V0IG5leHQgdGFza1xuICogIC0gZHVwbGljYXRlIHZpc1xuICogIC0gYWRkIGxheWVyXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcbiAgICBpZiAoIXRoaXMubW9kZWwpIHRocm93IG5ldyBFcnJvcignbW9kZWwgaXMgcmVxdWlyZWQgKGNkYi5hZG1pbi5WaXN1YWxpemF0aW9uKScpO1xuICAgIGlmICghdGhpcy5vcHRpb25zLnRpdGxlKSB0aHJvdyBuZXcgRXJyb3IoJ3RpdGxlIGlzIHJlcXVpcmVkJyk7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMuZXhwbGFuYXRpb24pIHRocm93IG5ldyBFcnJvcigndGl0bGUgaXMgcmVxdWlyZWQnKTtcbiAgICBpZiAoIXRoaXMub3B0aW9ucy5yb3V0ZXIpIHRocm93IG5ldyBFcnJvcigncm91dGVyIGNhbGxiYWNrIGlzIHJlcXVpcmVkJyk7XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9wYW5lcy5nZXRBY3RpdmVQYW5lKCkucmVuZGVyKCkuZWw7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fcGFuZXMgPSBuZXcgY2RiLnVpLmNvbW1vbi5UYWJQYW5lKHtcbiAgICAgIGVsOiB0aGlzLmVsXG4gICAgfSk7XG4gICAgdGhpcy5hZGRWaWV3KHRoaXMuX3BhbmVzKTtcbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ2NvbmZpcm0nLFxuICAgICAgVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvY3JlYXRlX3Zpc19maXJzdC90ZW1wbGF0ZScsIHtcbiAgICAgICAgdGl0bGU6IHRoaXMub3B0aW9ucy50aXRsZSxcbiAgICAgICAgZXhwbGFuYXRpb246IHRoaXMub3B0aW9ucy5leHBsYW5hdGlvblxuICAgICAgfSlcbiAgICApO1xuICAgIHRoaXMuX3BhbmVzLmFkZFRhYignbG9hZGluZycsXG4gICAgICBWaWV3RmFjdG9yeS5jcmVhdGVCeVRlbXBsYXRlKCdjb21tb24vdGVtcGxhdGVzL2xvYWRpbmcnLCB7XG4gICAgICAgIHRpdGxlOiAnQ3JlYXRpbmcgbWFw4oCmJyxcbiAgICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ2ZhaWwnLFxuICAgICAgVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9mYWlsJywge1xuICAgICAgICBtc2c6ICdDb3VsZCBub3QgY3JlYXRlIG1hcCBmb3Igc29tZSByZWFzb24nXG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdjb25maXJtJyk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fcGFuZXMuYmluZCgndGFiRW5hYmxlZCcsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgfSxcblxuICBvazogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdsb2FkaW5nJyk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMubW9kZWwuY2hhbmdlVG9WaXN1YWxpemF0aW9uKHtcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHZpcykge1xuICAgICAgICBzZWxmLm9wdGlvbnMucm91dGVyLmNoYW5nZVRvVmlzKHZpcyk7XG4gICAgICAgIGlmIChzZWxmLm9wdGlvbnMuc3VjY2Vzcykge1xuICAgICAgICAgIHNlbGYub3B0aW9ucy5zdWNjZXNzKHZpcyk7XG4gICAgICAgIH1cbiAgICAgICAgc2VsZi5jbGVhbigpO1xuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5fcGFuZXMuYWN0aXZlKCdmYWlsJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfZmFjdG9yeScpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZScpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VEaWFsb2cuZXh0ZW5kKHtcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG5cbiAgICBpZiAoIXRoaXMub3B0aW9ucy50YWJsZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCd0YWJsZSBpcyByZXF1aXJlZCcpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5vcHRpb25zLmNvbHVtbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb2x1bW4gaXMgcmVxdWlyZWQnKTtcbiAgICB9XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9wYW5lcy5nZXRBY3RpdmVQYW5lKCkucmVuZGVyKCkuZWw7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24oKSB7XG5cbiAgICB0aGlzLnRhYmxlID0gdGhpcy5vcHRpb25zLnRhYmxlO1xuICAgIHRoaXMuY29sdW1uID0gdGhpcy5vcHRpb25zLmNvbHVtbjtcblxuICAgIHRoaXMuX3BhbmVzID0gbmV3IGNkYi51aS5jb21tb24uVGFiUGFuZSh7XG4gICAgICBlbDogdGhpcy5lbFxuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLl9wYW5lcyk7XG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdjb25maXJtJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2RlbGV0ZV9jb2x1bW4vdGVtcGxhdGUnLCB7XG4gICAgICAgIGNvbHVtbjogdGhpcy5jb2x1bW5cbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ2xvYWRpbmcnLFxuICAgICAgVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9sb2FkaW5nJywge1xuICAgICAgICB0aXRsZTogJ0RlbGV0aW5nIGNvbHVtbuKApicsXG4gICAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdmYWlsJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvZmFpbCcsIHtcbiAgICAgICAgbXNnOiAnQ291bGQgbm90IGRlbGV0ZSBjb2x1bW4gZm9yIHNvbWUgcmVhc29uJ1xuICAgICAgfSlcbiAgICApO1xuICAgIHRoaXMuX3BhbmVzLmFjdGl2ZSgnY29uZmlybScpO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3BhbmVzLmJpbmQoJ3RhYkVuYWJsZWQnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gIH0sXG5cbiAgb2s6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3BhbmVzLmFjdGl2ZSgnbG9hZGluZycpO1xuICAgIHRoaXMudGFibGUuZGVsZXRlQ29sdW1uKHRoaXMuY29sdW1uKTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcbnZhciBwbHVyYWxpemVTdHJpbmcgPSByZXF1aXJlKCcuLi92aWV3X2hlbHBlcnMvcGx1cmFsaXplX3N0cmluZycpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZScpO1xudmFyIE1hcENhcmRQcmV2aWV3ID0gcmVxdWlyZSgnLi4vdmlld3MvbWFwY2FyZF9wcmV2aWV3Jyk7XG52YXIgJCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WyckJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyckJ10gOiBudWxsKTtcbnZhciBtb21lbnQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snbW9tZW50J10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydtb21lbnQnXSA6IG51bGwpO1xuXG52YXIgQUZGRUNURURfRU5USVRJRVNfU0FNUExFX0NPVU5UID0gMztcbnZhciBBRkZFQ1RFRF9WSVNfQ09VTlQgPSAzO1xuXG4vKipcbiAqIERlbGV0ZSBpdGVtcyBkaWFsb2dcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBCYXNlRGlhbG9nLmV4dGVuZCh7XG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgIGlmICghdGhpcy5vcHRpb25zLnZpZXdNb2RlbCkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigndmlld01vZGVsIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuICAgIGlmICghdGhpcy5vcHRpb25zLnVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3VzZXIgaXMgcmVxdWlyZWQnKTtcbiAgICB9XG5cbiAgICB0aGlzLl92aWV3TW9kZWwgPSB0aGlzLm9wdGlvbnMudmlld01vZGVsO1xuICAgIHRoaXMuX3ZpZXdNb2RlbC5sb2FkUHJlcmVxdWlzaXRlcygpO1xuICAgIHRoaXMuX3ZpZXdNb2RlbC5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLl92aWV3TW9kZWwuc3RhdGUoKSA9PT0gJ0RlbGV0ZUl0ZW1zRG9uZScpIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9LCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMuX3ZpZXdNb2RlbCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBCYXNlRGlhbG9nLnByb3RvdHlwZS5yZW5kZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLl9sb2FkTWFwUHJldmlld3MoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICAvKipcbiAgICogQGltcGxlbWVudHMgY2RiLnVpLmNvbW1vbi5EaWFsb2cucHJvdG90eXBlLnJlbmRlcl9jb250ZW50XG4gICAqL1xuICByZW5kZXJfY29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXNbJ19yZW5kZXInICsgdGhpcy5fdmlld01vZGVsLnN0YXRlKCldKCk7XG4gIH0sXG5cbiAgX3JlbmRlckxvYWRpbmdQcmVyZXF1aXNpdGVzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9sb2FkaW5nJykoe1xuICAgICAgdGl0bGU6ICdDaGVja2luZyB3aGF0IGNvbnNlcXVlbmNlcyBkZWxldGluZyB0aGUgc2VsZWN0ZWQgJyArIHRoaXMuX3BsdXJhbGl6ZWRDb250ZW50VHlwZSgpICsgJyB3b3VsZCBoYXZlLi4uJyxcbiAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgfSk7XG4gIH0sXG5cbiAgX3JlbmRlckxvYWRQcmVyZXF1aXNpdGVzRmFpbDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvZmFpbCcpKHtcbiAgICAgIG1zZzogJ0ZhaWxlZCB0byBjaGVjayBjb25zZXF1ZW5jZXMgb2YgZGVsZXRpbmcgdGhlIHNlbGVjdGVkICcgKyB0aGlzLl9wbHVyYWxpemVkQ29udGVudFR5cGUoKVxuICAgIH0pO1xuICB9LFxuXG4gIF9yZW5kZXJDb25maXJtRGVsZXRpb246IGZ1bmN0aW9uKCkge1xuICAgIC8vIEFuIGVudGl0eSBjYW4gYmUgYW4gVXNlciBvciBPcmdhbml6YXRpb25cbiAgICB2YXIgYWZmZWN0ZWRFbnRpdGllcyA9IHRoaXMuX3ZpZXdNb2RlbC5hZmZlY3RlZEVudGl0aWVzKCk7XG4gICAgdmFyIGFmZmVjdGVkVmlzRGF0YSA9IHRoaXMuX3ZpZXdNb2RlbC5hZmZlY3RlZFZpc0RhdGEoKTtcblxuICAgIHJldHVybiBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9kZWxldGVfaXRlbXNfdmlld190ZW1wbGF0ZScpKHtcbiAgICAgIGZpcnN0SXRlbU5hbWU6IHRoaXMuX2dldEZpcnN0SXRlbU5hbWUoKSxcbiAgICAgIHNlbGVjdGVkQ291bnQ6IHRoaXMuX3ZpZXdNb2RlbC5sZW5ndGgsXG4gICAgICBpc0RhdGFzZXRzOiB0aGlzLl92aWV3TW9kZWwuaXNEZWxldGluZ0RhdGFzZXRzKCksXG4gICAgICBwbHVyYWxpemVkQ29udGVudFR5cGU6IHRoaXMuX3BsdXJhbGl6ZWRDb250ZW50VHlwZSgpLFxuICAgICAgYWZmZWN0ZWRFbnRpdGllc0NvdW50OiBhZmZlY3RlZEVudGl0aWVzLmxlbmd0aCxcbiAgICAgIGFmZmVjdGVkRW50aXRpZXNTYW1wbGU6IGFmZmVjdGVkRW50aXRpZXMuc2xpY2UoMCwgQUZGRUNURURfRU5USVRJRVNfU0FNUExFX0NPVU5UKSxcbiAgICAgIGFmZmVjdGVkRW50aXRpZXNTYW1wbGVDb3VudDogQUZGRUNURURfRU5USVRJRVNfU0FNUExFX0NPVU5ULFxuICAgICAgYWZmZWN0ZWRWaXNDb3VudDogYWZmZWN0ZWRWaXNEYXRhLmxlbmd0aCxcbiAgICAgIHBsdXJhbGl6ZWRNYXBzOiBwbHVyYWxpemVTdHJpbmcoJ21hcCcsIGFmZmVjdGVkVmlzRGF0YS5sZW5ndGgpLFxuICAgICAgYWZmZWN0ZWRWaXNWaXNpYmxlQ291bnQ6IEFGRkVDVEVEX1ZJU19DT1VOVCxcbiAgICAgIHZpc2libGVBZmZlY3RlZFZpczogdGhpcy5fcHJlcGFyZVZpc2libGVBZmZlY3RlZFZpc0ZvclRlbXBsYXRlKGFmZmVjdGVkVmlzRGF0YS5zbGljZSgwLCBBRkZFQ1RFRF9WSVNfQ09VTlQpKVxuICAgIH0pO1xuICB9LFxuXG4gIF9wcmVwYXJlVmlzaWJsZUFmZmVjdGVkVmlzRm9yVGVtcGxhdGU6IGZ1bmN0aW9uKHZpc2libGVBZmZlY3RlZFZpc0RhdGEpIHtcbiAgICByZXR1cm4gdmlzaWJsZUFmZmVjdGVkVmlzRGF0YS5tYXAoZnVuY3Rpb24odmlzRGF0YSkge1xuICAgICAgdmFyIHZpcyA9IG5ldyBjZGIuYWRtaW4uVmlzdWFsaXphdGlvbih2aXNEYXRhKTtcbiAgICAgIHZhciBvd25lciA9IHZpcy5wZXJtaXNzaW9uLm93bmVyO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmlzSWQ6IHZpcy5nZXQoJ2lkJyksXG4gICAgICAgIG5hbWU6IHZpcy5nZXQoJ25hbWUnKSxcbiAgICAgICAgdXJsOiB2aXMudmlld1VybCh0aGlzLm9wdGlvbnMudXNlcikuZWRpdCgpLFxuICAgICAgICBvd25lcjogb3duZXIsXG4gICAgICAgIG93bmVyTmFtZTogb3duZXIuZ2V0KCd1c2VybmFtZScpLFxuICAgICAgICBpc093bmVyOiB2aXMucGVybWlzc2lvbi5pc093bmVyKHRoaXMub3B0aW9ucy51c2VyKSxcbiAgICAgICAgc2hvd1Blcm1pc3Npb25JbmRpY2F0b3I6ICF2aXMucGVybWlzc2lvbi5oYXNXcml0ZUFjY2Vzcyh0aGlzLm9wdGlvbnMudXNlciksXG4gICAgICAgIHRpbWVEaWZmOiBtb21lbnQodmlzLmdldCgndXBkYXRlZF9hdCcpKS5mcm9tTm93KCksXG4gICAgICAgIGF1dGhUb2tlbnM6IHZpcy5nZXQoJ2F1dGhfdG9rZW5zJykuam9pbignOycpXG4gICAgICB9O1xuICAgIH0sIHRoaXMpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBAb3ZlcnJpZGVzIEJhc2VEaWFsb2cucHJvdG90eXBlLm9rXG4gICAqL1xuICBvazogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fdmlld01vZGVsLmRlbGV0ZUl0ZW1zKCk7XG4gICAgdGhpcy5yZW5kZXIoKTtcbiAgfSxcblxuICBfbG9hZE1hcFByZXZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB0aGlzLiRlbC5maW5kKCcuTWFwQ2FyZCcpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgdXNlcm5hbWUgPSAkKHRoaXMpLmRhdGEoJ3Zpc093bmVyTmFtZScpO1xuICAgICAgdmFyIG1hcENhcmRQcmV2aWV3ID0gbmV3IE1hcENhcmRQcmV2aWV3KHtcbiAgICAgICAgZWw6ICQodGhpcykuZmluZCgnLmpzLWhlYWRlcicpLFxuICAgICAgICB3aWR0aDogMjk4LFxuICAgICAgICBoZWlnaHQ6IDEzMCxcbiAgICAgICAgbWFwc0FwaVJlc291cmNlOiBjZGIuY29uZmlnLmdldE1hcHNSZXNvdXJjZU5hbWUodXNlcm5hbWUpLFxuICAgICAgICB2aXNJZDogJCh0aGlzKS5kYXRhKCd2aXNJZCcpLFxuICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgIGF1dGhUb2tlbnM6ICQodGhpcykuZGF0YSgndmlzQXV0aFRva2VucycpLnNwbGl0KCc7JylcbiAgICAgIH0pLmxvYWQoKTtcblxuICAgICAgc2VsZi5hZGRWaWV3KG1hcENhcmRQcmV2aWV3KTtcbiAgICB9KTtcbiAgfSxcblxuICBfcmVuZGVyRGVsZXRpbmdJdGVtczogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycpKHtcbiAgICAgIHRpdGxlOiAnRGVsZXRpbmcgdGhlIHNlbGVjdGVkICcgKyB0aGlzLl9wbHVyYWxpemVkQ29udGVudFR5cGUoKSArICcuLi4nLFxuICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICB9KTtcbiAgfSxcblxuICBfcmVuZGVyRGVsZXRlSXRlbXNGYWlsOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbWVzc2FnZSA9IHRoaXMuX3ZpZXdNb2RlbC5lcnJvck1lc3NhZ2UoKS5yZXBsYWNlKC9cXG4vZywgJzxicj4nKTtcbiAgICBpZiAobWVzc2FnZSA9PT0gJ3NvbWV0aGluZyBmYWlsZWQnKSB7XG4gICAgICBtZXNzYWdlID0gJyc7XG4gICAgfVxuICAgIHJldHVybiBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vdGVtcGxhdGVzL2ZhaWwnKSh7XG4gICAgICBtc2c6ICdGYWlsZWQgdG8gZGVsZXRlIHRoZSBzZWxlY3RlZCAnICsgdGhpcy5fcGx1cmFsaXplZENvbnRlbnRUeXBlKCkgKyAnLiAnICsgbWVzc2FnZVxuICAgIH0pO1xuICB9LFxuXG4gIF9wbHVyYWxpemVkQ29udGVudFR5cGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBwbHVyYWxpemVTdHJpbmcoXG4gICAgICB0aGlzLl92aWV3TW9kZWwuaXNEZWxldGluZ0RhdGFzZXRzKCkgPyAnZGF0YXNldCcgOiAnbWFwJyxcbiAgICAgIHRoaXMuX3ZpZXdNb2RlbC5sZW5ndGhcbiAgICApO1xuICB9LFxuXG4gIF9nZXRGaXJzdEl0ZW1OYW1lOiBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMub3B0aW9ucy52aWV3TW9kZWwpIHJldHVybjtcblxuICAgIHZhciBmaXJzdEl0ZW0gPSB0aGlzLm9wdGlvbnMudmlld01vZGVsLmF0KDApO1xuXG4gICAgaWYgKGZpcnN0SXRlbSkge1xuICAgICAgcmV0dXJuIGZpcnN0SXRlbS5nZXQoXCJuYW1lXCIpO1xuICAgIH1cbiAgfVxuXG59KTtcbiIsInZhciBCYWNrYm9uZSA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydCYWNrYm9uZSddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnQmFja2JvbmUnXSA6IG51bGwpO1xudmFyIGJhdGNoUHJvY2Vzc0l0ZW1zID0gcmVxdWlyZSgnLi4vLi4vY29tbW9uL2JhdGNoX3Byb2Nlc3NfaXRlbXMnKTtcblxuLyoqXG4gKiBWaWV3IG1vZGVsIGZvciBkZWxldGUgaXRlbXMgdmlldy5cbiAqIE1hbmFnZXMgdGhlIHN0YXRlcyBjaGFuZ2VzIGZvciB0aGUgZGVsZXRlIGl0ZW1zIHZpZXcuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKG1vZGVscywgb3B0cykge1xuICAgIGlmICghb3B0cy5jb250ZW50VHlwZSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignY29udGVudFR5cGUgaXMgcmVxdWlyZWQnKVxuICAgIH1cblxuICAgIHRoaXMuX2NvbnRlbnRUeXBlID0gb3B0cy5jb250ZW50VHlwZTtcbiAgfSxcblxuICBzdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXRlO1xuICB9LFxuXG4gIGVycm9yTWVzc2FnZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2Vycm9yTWVzc2FnZTtcbiAgfSxcblxuICBzZXRTdGF0ZTogZnVuY3Rpb24obmV3U3RhdGUpIHtcbiAgICB0aGlzLl9zdGF0ZSA9IG5ld1N0YXRlO1xuICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgdGhpcy50cmlnZ2VyKG5ld1N0YXRlKTtcbiAgfSxcblxuICBpc0RlbGV0aW5nRGF0YXNldHM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9jb250ZW50VHlwZSA9PT0gJ2RhdGFzZXRzJztcbiAgfSxcblxuICBsb2FkUHJlcmVxdWlzaXRlczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNldFN0YXRlVG9Db25maXJtRGVsZXRpb24gPSB0aGlzLnNldFN0YXRlLmJpbmQodGhpcywgJ0NvbmZpcm1EZWxldGlvbicpO1xuXG4gICAgaWYgKHRoaXMuaXNEZWxldGluZ0RhdGFzZXRzKCkpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoJ0xvYWRpbmdQcmVyZXF1aXNpdGVzJyk7XG5cbiAgICAgIGJhdGNoUHJvY2Vzc0l0ZW1zKHtcbiAgICAgICAgaG93TWFueUluUGFyYWxsZWw6IDUsXG4gICAgICAgIGl0ZW1zOiB0aGlzLnRvQXJyYXkoKSxcbiAgICAgICAgcHJvY2Vzc0l0ZW06IHRoaXMuX2xvYWRQcmVyZXF1aXNpdGVzRm9yTW9kZWwsXG4gICAgICAgIGRvbmU6IHNldFN0YXRlVG9Db25maXJtRGVsZXRpb24sXG4gICAgICAgIGZhaWw6IHRoaXMuc2V0U3RhdGUuYmluZCh0aGlzLCAnTG9hZFByZXJlcXVpc2l0ZXNGYWlsJylcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZXRTdGF0ZVRvQ29uZmlybURlbGV0aW9uKCk7XG4gICAgfVxuICB9LFxuXG4gIGFmZmVjdGVkRW50aXRpZXM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmNoYWluKClcbiAgICAgIC5tYXAoZnVuY3Rpb24obSkge1xuICAgICAgICByZXR1cm4gbS5zaGFyZWRXaXRoRW50aXRpZXMoKTtcbiAgICAgIH0pXG4gICAgICAuZmxhdHRlbigpLmNvbXBhY3QoKS52YWx1ZSgpO1xuICB9LFxuXG4gIGFmZmVjdGVkVmlzRGF0YTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHZpc0RhdGEgPSB0aGlzLmNoYWluKClcbiAgICAgIC5tYXAoZnVuY3Rpb24obSkge1xuICAgICAgICAgIHZhciBtZXRhZGF0YSA9IG0udGFibGVNZXRhZGF0YSgpO1xuICAgICAgICAgIHJldHVybiBbXVxuICAgICAgICAgICAgLmNvbmNhdChtZXRhZGF0YS5nZXQoJ2RlcGVuZGVudF92aXN1YWxpemF0aW9ucycpKVxuICAgICAgICAgICAgLmNvbmNhdChtZXRhZGF0YS5nZXQoJ25vbl9kZXBlbmRlbnRfdmlzdWFsaXphdGlvbnMnKSk7XG4gICAgICAgIH0pXG4gICAgICAuZmxhdHRlbigpLmNvbXBhY3QoKS52YWx1ZSgpO1xuXG4gICAgcmV0dXJuIF8udW5pcSh2aXNEYXRhLCBmdW5jdGlvbihtZXRhZGF0YSkge1xuICAgICAgcmV0dXJuIG1ldGFkYXRhLmlkO1xuICAgIH0pO1xuICB9LFxuXG4gIGRlbGV0ZUl0ZW1zOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldFN0YXRlKCdEZWxldGluZ0l0ZW1zJyk7XG5cbiAgICAvLyBJTkZPOiBEb24ndCBwdXQgbW9yZSB0aGFuIDEgZGVsZXRlIGluIHBhcmFsbGVsIGJlY2F1c2UgdGhpcyBsZWFkIHRvIGFcbiAgICAvLyByYWNlIGNvbmRpY2l0aW9uIGluIHRoZSBkZXJpdmVkIG1hcCBkZWxldGlvbiAoaWYgYW55KVxuICAgIGJhdGNoUHJvY2Vzc0l0ZW1zKHtcbiAgICAgIGhvd01hbnlJblBhcmFsbGVsOiAxLFxuICAgICAgaXRlbXM6IHRoaXMudG9BcnJheSgpLFxuICAgICAgcHJvY2Vzc0l0ZW06IHRoaXMuX2RlbGV0ZUl0ZW0sXG4gICAgICBkb25lOiB0aGlzLnNldFN0YXRlLmJpbmQodGhpcywgJ0RlbGV0ZUl0ZW1zRG9uZScpLFxuICAgICAgZmFpbDogdGhpcy5fZGVsZXRpb25GYWlsZWQuYmluZCh0aGlzKVxuICAgIH0pO1xuICB9LFxuXG4gIF9kZWxldGlvbkZhaWxlZDogZnVuY3Rpb24oZXJyb3IpIHtcbiAgICB0aGlzLl9lcnJvck1lc3NhZ2UgPSBlcnJvcjtcbiAgICB0aGlzLnNldFN0YXRlKCdEZWxldGVJdGVtc0ZhaWwnKTtcbiAgfSxcblxuICBfbG9hZFByZXJlcXVpc2l0ZXNGb3JNb2RlbDogZnVuY3Rpb24obSwgY2FsbGJhY2spIHtcbiAgICB2YXIgbWV0YWRhdGEgPSBtLnRhYmxlTWV0YWRhdGEoKTtcblxuICAgIC8vIFRPRE86IGV4dHJhY3QgdG8gYmUgaW5jbHVkZWQgaW4gZmV0Y2ggY2FsbCBpbnN0ZWFkPyBtb2RpZnlpbmcgZ2xvYmFsIHN0YXRlIGlzIG5vdCB2ZXJ5IG5pY2VcbiAgICBtZXRhZGF0YS5ub19kYXRhX2ZldGNoID0gdHJ1ZTtcblxuICAgIG1ldGFkYXRhLmZldGNoKHtcbiAgICAgIHdhaXQ6IHRydWUsIC8vIFRPRE86IGZyb20gb2xkIGNvZGUgKGRlbGV0ZV9kaWFsb2cpLCB3aHkgaXMgaXQgbmVjZXNzYXJ5P1xuICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKG1vZGVsLCBqcVhIUikge1xuICAgICAgICBjYWxsYmFjayhqcVhIUi5yZXNwb25zZVRleHQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIF9kZWxldGVJdGVtOiBmdW5jdGlvbihpdGVtLCBjYWxsYmFjaykge1xuICAgIGl0ZW0uZGVzdHJveSh7IHdhaXQ6IHRydWUgfSlcbiAgICAgIC5kb25lKGZ1bmN0aW9uKCkge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfSlcbiAgICAgIC5mYWlsKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBlcnJvck1lc3NhZ2U7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBKU09OLnBhcnNlKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCkuZXJyb3JzLmpvaW4oJzsgJyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAnc29tZXRoaW5nIGZhaWxlZCc7XG4gICAgICAgIH1cblxuICAgICAgICBjYWxsYmFjayhlcnJvck1lc3NhZ2UpO1xuICAgICAgfSk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfZmFjdG9yeScpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZScpO1xuXG4vKipcbiAqIENyZWF0ZSBhIHZpcyBmcm9tIGEgZGF0YXNldCwgcmVxdWlyZWQgZm9yIHNvbWUgY29udGV4dHMgdG8gaGF2ZSBhIHZpcyBiZWZvcmUgYmUgYWJsZSB0byBjYXJyeSBvdXQgbmV4dCB0YXNrXG4gKiAgLSBkdXBsaWNhdGUgdmlzXG4gKiAgLSBhZGQgbGF5ZXJcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBCYXNlRGlhbG9nLmV4dGVuZCh7XG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuXG4gICAgLy8gQ2xlYW4gb24gaGlkZSBhbmQgZW50ZXIgdG8gY29uZmlybVxuICAgIC8vIGhhdmUgdG8gYmUgbWFuZGF0b3J5XG4gICAgXy5leHRlbmQoXG4gICAgICB0aGlzLm9wdGlvbnMsXG4gICAgICB7XG4gICAgICAgIGNsZWFuX29uX2hpZGU6IHRydWUsXG4gICAgICAgIGVudGVyX3RvX2NvbmZpcm06IHRydWVcbiAgICAgIH1cbiAgICApO1xuXG4gICAgaWYgKCF0aGlzLm1vZGVsKSB0aHJvdyBuZXcgRXJyb3IoJ21vZGVsIGlzIHJlcXVpcmVkIChsYXllciknKTtcbiAgICB0aGlzLl9pbml0Vmlld3MoKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXJfY29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3BhbmVzLmdldEFjdGl2ZVBhbmUoKS5yZW5kZXIoKS5lbDtcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9wYW5lcyA9IG5ldyBjZGIudWkuY29tbW9uLlRhYlBhbmUoe1xuICAgICAgZWw6IHRoaXMuZWxcbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fcGFuZXMpO1xuICAgIHRoaXMuX3BhbmVzLmFkZFRhYignY29uZmlybScsXG4gICAgICBWaWV3RmFjdG9yeS5jcmVhdGVCeVRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9kZWxldGVfbGF5ZXIvdGVtcGxhdGUnLCB7XG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdsb2FkaW5nJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycsIHtcbiAgICAgICAgdGl0bGU6ICdEZWxldGluZyBsYXllcuKApicsXG4gICAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdmYWlsJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvZmFpbCcsIHtcbiAgICAgICAgbXNnOiAnQ291bGQgbm90IGRlbGV0ZSBsYXllciBmb3Igc29tZSByZWFzb24nXG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdjb25maXJtJyk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fcGFuZXMuYmluZCgndGFiRW5hYmxlZCcsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgfSxcblxuICBvazogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdsb2FkaW5nJyk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMubW9kZWwuZGVzdHJveSh7XG4gICAgICB3YWl0OiB0cnVlLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgIHNlbGYuY2xvc2UoKTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHNlbGYuX3BhbmVzLmFjdGl2ZSgnZmFpbCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfZmFjdG9yeScpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZScpO1xuXG4vKipcbiAqIE1vZGFsIHRvIGRlbGV0ZSBhIHJvdy9mZWF0dXJlIChlLmcuIGEgcG9pbnQgb3IgcG9seWdvbiksIG9uIHRoZSB0YWJsZSBvciBtYXAgdmlldyAuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcblxuICAgIGlmICghdGhpcy5vcHRpb25zLnRhYmxlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3RhYmxlIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLm9wdGlvbnMucm93KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JvdyBpcyByZXF1aXJlZCcpO1xuICAgIH1cblxuICAgIHRoaXMub3B0aW9ucy5uYW1lID0gdGhpcy5vcHRpb25zLm5hbWUgfHwgJ3Jvdyc7XG5cbiAgICB0aGlzLl9pbml0Vmlld3MoKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXJfY29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3BhbmVzLmdldEFjdGl2ZVBhbmUoKS5yZW5kZXIoKS5lbDtcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnRhYmxlID0gdGhpcy5vcHRpb25zLnRhYmxlO1xuICAgIHRoaXMucm93ID0gdGhpcy5vcHRpb25zLnJvdztcblxuICAgIHRoaXMuX3BhbmVzID0gbmV3IGNkYi51aS5jb21tb24uVGFiUGFuZSh7XG4gICAgICBlbDogdGhpcy5lbFxuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLl9wYW5lcyk7XG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdjb25maXJtJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2RlbGV0ZV9yb3cvdGVtcGxhdGUnLCB7XG4gICAgICAgIG5hbWU6IHRoaXMub3B0aW9ucy5uYW1lXG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdsb2FkaW5nJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycsIHtcbiAgICAgICAgdGl0bGU6ICdEZWxldGluZyAnICsgdGhpcy5vcHRpb25zLm5hbWUgKyAn4oCmJyxcbiAgICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ2ZhaWwnLFxuICAgICAgVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9mYWlsJywge1xuICAgICAgICBtc2c6ICdDb3VsZCBub3QgZGVsZXRlICcgKyB0aGlzLm9wdGlvbnMubmFtZSArICcgZm9yIHNvbWUgcmVhc29uJ1xuICAgICAgfSlcbiAgICApO1xuICAgIHRoaXMuX3BhbmVzLmFjdGl2ZSgnY29uZmlybScpO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3BhbmVzLmJpbmQoJ3RhYkVuYWJsZWQnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gIH0sXG5cbiAgb2s6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpc1xuICAgIHRoaXMuX3BhbmVzLmFjdGl2ZSgnbG9hZGluZycpO1xuICAgIHRoaXMudGFibGUudHJpZ2dlcigncmVtb3Zpbmc6cm93Jyk7XG4gICAgdGhpcy5yb3cuZGVzdHJveSh7XG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi50YWJsZS50cmlnZ2VyKCdyZW1vdmU6cm93Jywgc2VsZi5yb3cpO1xuICAgICAgICBzZWxmLmNsb3NlKCk7XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLl9wYW5lcy5hY3RpdmUoJ2ZhaWwnKTtcbiAgICAgIH1cbiAgICB9LCB7XG4gICAgICB3YWl0OiB0aGlzLm9wdGlvbnMud2FpdFxuICAgIH0pO1xuICB9XG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uL3ZpZXdfZmFjdG9yeScpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZScpO1xudmFyIEVycm9yRGV0YWlsc1ZpZXcgPSByZXF1aXJlKCcuLi92aWV3cy9lcnJvcl9kZXRhaWxzX3ZpZXcnKTtcblxuLyoqXG4gKiBEaWFsb2cgdG8gbWFuYWdlIGR1cGxpY2F0aW9uIHByb2Nlc3Mgb2YgYSBjZGIuYWRtaW4uQ2FydG9EQlRhYmxlTWV0YWRhdGEgb2JqZWN0LlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VEaWFsb2cuZXh0ZW5kKHtcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgaWYgKCF0aGlzLm1vZGVsKSB0aHJvdyBuZXcgRXJyb3IoJ21vZGVsIGlzIHJlcXVpcmVkIChjZGIuYWRtaW4uQ2FydG9EQlRhYmxlTWV0YWRhdGEpJyk7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMudXNlcikgdGhyb3cgbmV3IEVycm9yKCd1c2VyIGlzIHJlcXVpcmVkJyk7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICAgIHRoaXMuX2R1cGxpY2F0ZURhdGFzZXQoKTtcbiAgfSxcblxuICByZW5kZXJfY29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3BhbmVzLmdldEFjdGl2ZVBhbmUoKS5yZW5kZXIoKS5lbDtcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9wYW5lcyA9IG5ldyBjZGIudWkuY29tbW9uLlRhYlBhbmUoe1xuICAgICAgZWw6IHRoaXMuZWxcbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fcGFuZXMpO1xuICAgIHRoaXMuX3BhbmVzLmFkZFRhYignbG9hZGluZycsXG4gICAgICBWaWV3RmFjdG9yeS5jcmVhdGVCeVRlbXBsYXRlKCdjb21tb24vdGVtcGxhdGVzL2xvYWRpbmcnLCB7XG4gICAgICAgIHRpdGxlOiB0aGlzLm1vZGVsLmlzSW5TUUxWaWV3KCkgPyAnQ3JlYXRpbmcgZGF0YXNldCBmcm9tIHlvdXIgcXVlcnknIDogJ0R1cGxpY2F0aW5nIHlvdXIgZGF0YXNldCcsXG4gICAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdsb2FkaW5nJyk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fcGFuZXMuYmluZCgndGFiRW5hYmxlZCcsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgfSxcblxuICBfZHVwbGljYXRlRGF0YXNldDogZnVuY3Rpb24obmV3TmFtZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgbmV3TmFtZSA9IHRoaXMubW9kZWwuZ2V0KCduYW1lJykgKyAnX2NvcHknO1xuICAgIHRoaXMubW9kZWwuZHVwbGljYXRlKG5ld05hbWUsIHtcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKG5ld1RhYmxlKSB7XG4gICAgICAgIHNlbGYuX3JlZGlyZWN0VG8obmV3VGFibGUudmlld1VybCgpKTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogc2VsZi5fc2hvd0Vycm9yLmJpbmQoc2VsZilcbiAgICB9KTtcbiAgfSxcblxuICBfc2hvd0Vycm9yOiBmdW5jdGlvbihtb2RlbCkge1xuICAgIHZhciB2aWV3O1xuICAgIHRyeSB7XG4gICAgICB2YXIgZXJyID0gXy5jbG9uZShtb2RlbC5hdHRyaWJ1dGVzKTtcbiAgICAgIHZpZXcgPSBuZXcgRXJyb3JEZXRhaWxzVmlldyh7XG4gICAgICAgIGVycjogXy5leHRlbmQoZXJyLCBtb2RlbC5hdHRyaWJ1dGVzLmdldF9lcnJvcl90ZXh0KSxcbiAgICAgICAgdXNlcjogdGhpcy5vcHRpb25zLnVzZXJcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2goZXJyKSB7XG4gICAgICB2aWV3ID0gVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9mYWlsJywge1xuICAgICAgICBtc2c6IFwiU29ycnksIHNvbWV0aGluZyB3ZW50IHdyb25nLCBidXQgd2UncmUgbm90IHN1cmUgd2h5LlwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdmYWlsJywgdmlldy5yZW5kZXIoKSk7XG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdmYWlsJyk7XG4gIH0sXG5cbiAgX3JlZGlyZWN0VG86IGZ1bmN0aW9uKHVybCkge1xuICAgIHdpbmRvdy5sb2NhdGlvbiA9IHVybDtcbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIEJhc2VEaWFsb2cgPSByZXF1aXJlKCcuLi92aWV3cy9iYXNlX2RpYWxvZy92aWV3Jyk7XG52YXIgVmlld0ZhY3RvcnkgPSByZXF1aXJlKCcuLi92aWV3X2ZhY3RvcnknKTtcbnZhciByYW5kb21RdW90ZSA9IHJlcXVpcmUoJy4uL3ZpZXdfaGVscGVycy9yYW5kb21fcXVvdGUnKTtcbnZhciBFcnJvckRldGFpbHNWaWV3ID0gcmVxdWlyZSgnLi4vdmlld3MvZXJyb3JfZGV0YWlsc192aWV3Jyk7XG5cbi8qKlxuICogRGlhbG9nIHRvIG1hbmFnZSBkdXBsaWNhdGlvbiBwcm9jZXNzIG9mIGEgY2RiLmFkbWluLlZpc3VhbGl6YXRpb24gb2JqZWN0LlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VEaWFsb2cuZXh0ZW5kKHtcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgaWYgKCF0aGlzLm1vZGVsKSB0aHJvdyBuZXcgRXJyb3IoJ21vZGVsIGlzIHJlcXVpcmVkIChjZGIuYWRtaW4uVmlzdWFsaXphdGlvbiknKTtcbiAgICBpZiAoIXRoaXMub3B0aW9ucy51c2VyKSB0aHJvdyBuZXcgRXJyb3IoJ3VzZXIgaXMgcmVxdWlyZWQnKTtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gICAgdGhpcy5fZHVwbGljYXRlTWFwKCk7XG4gIH0sXG5cbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9wYW5lcy5nZXRBY3RpdmVQYW5lKCkucmVuZGVyKCkuZWw7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fcGFuZXMgPSBuZXcgY2RiLnVpLmNvbW1vbi5UYWJQYW5lKHtcbiAgICAgIGVsOiB0aGlzLmVsXG4gICAgfSk7XG4gICAgdGhpcy5hZGRWaWV3KHRoaXMuX3BhbmVzKTtcbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ2xvYWRpbmcnLFxuICAgICAgVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9sb2FkaW5nJywge1xuICAgICAgICB0aXRsZTogJ0R1cGxpY2F0aW5nIHlvdXIgbWFwJyxcbiAgICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLl9wYW5lcy5hY3RpdmUoJ2xvYWRpbmcnKTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9wYW5lcy5iaW5kKCd0YWJFbmFibGVkJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICB9LFxuXG4gIF9kdXBsaWNhdGVNYXA6IGZ1bmN0aW9uKG5ld05hbWUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIG5ld05hbWUgPSB0aGlzLm1vZGVsLmdldCgnbmFtZScpICsgJyBjb3B5JztcbiAgICB0aGlzLm1vZGVsLmNvcHkoe1xuICAgICAgbmFtZTogbmV3TmFtZVxuICAgIH0sIHtcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKG5ld1Zpcykge1xuICAgICAgICBzZWxmLl9yZWRpcmVjdFRvKG5ld1Zpcy52aWV3VXJsKHNlbGYub3B0aW9ucy51c2VyKS5lZGl0KCkudG9TdHJpbmcoKSk7XG4gICAgICB9LFxuICAgICAgZXJyb3I6IHNlbGYuX3Nob3dFcnJvci5iaW5kKHNlbGYpXG4gICAgfSk7XG4gIH0sXG5cbiAgX3Nob3dFcnJvcjogZnVuY3Rpb24obW9kZWwpIHtcbiAgICB2YXIgdmlldztcbiAgICB0cnkge1xuICAgICAgdmFyIGVyciA9IF8uY2xvbmUobW9kZWwuYXR0cmlidXRlcyk7XG4gICAgICB2aWV3ID0gbmV3IEVycm9yRGV0YWlsc1ZpZXcoe1xuICAgICAgICBlcnI6IF8uZXh0ZW5kKGVyciwgbW9kZWwuYXR0cmlidXRlcy5nZXRfZXJyb3JfdGV4dCksXG4gICAgICAgIHVzZXI6IHRoaXMub3B0aW9ucy51c2VyXG4gICAgICB9KTtcbiAgICB9IGNhdGNoKGVycikge1xuICAgICAgdmlldyA9IFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvZmFpbCcsIHtcbiAgICAgICAgbXNnOiBcIlNvcnJ5LCBzb21ldGhpbmcgd2VudCB3cm9uZywgYnV0IHdlJ3JlIG5vdCBzdXJlIHdoeS5cIlxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuX3BhbmVzLmFkZFRhYignZmFpbCcsIHZpZXcucmVuZGVyKCkpO1xuICAgIHRoaXMuX3BhbmVzLmFjdGl2ZSgnZmFpbCcpO1xuICB9LFxuXG4gIF9yZWRpcmVjdFRvOiBmdW5jdGlvbih1cmwpIHtcbiAgICB3aW5kb3cubG9jYXRpb24gPSB1cmw7XG4gIH1cbn0pO1xuIiwidmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG52YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIFV0aWxzID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydVdGlscyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ1V0aWxzJ10gOiBudWxsKTtcblxuXG4vKipcbiAqICBFZGl0IHZpc3VhbGl6YXRpb24gKGRhdGFzZXQgb3IgbWFwKSBkaWFsb2dcbiAqXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIG9wdGlvbnM6IHtcbiAgICBtYXhMZW5ndGg6IDIwMFxuICB9LFxuXG4gIGV2ZW50czoge1xuICAgICdrZXlkb3duIC5qcy1uYW1lJzogJ19vbk5hbWVLZXlEb3duJyxcbiAgICAnY2xpY2sgLmpzLXByaXZhY3knOiAnX3Nob3dQcml2YWN5JyxcbiAgICAnc3VibWl0JzogJ19vblN1Ym1pdCdcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvZWRpdF92aXNfbWV0YWRhdGEvZWRpdF92aXNfZm9ybScpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy5fZGVzdHJveVRhZ3MoKTtcbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGhpcy50ZW1wbGF0ZSh7XG4gICAgICAgIGlzRGF0YXNldDogdGhpcy5tb2RlbC5pc0RhdGFzZXQoKSxcbiAgICAgICAgaXNEYXRhTGlicmFyeUVuYWJsZWQ6IHRoaXMudXNlci5mZWF0dXJlRW5hYmxlZCgnZGF0YV9saWJyYXJ5JyksXG4gICAgICAgIHZpc1ZhbHVlOiB0aGlzLm1vZGVsLmdldCgnbmFtZScpLFxuICAgICAgICB2aXNEZXNjcmlwdGlvbjogdGhpcy5tb2RlbC5nZXQoJ2Rlc2NyaXB0aW9uJyksXG4gICAgICAgIHZpc1ByaXZhY3k6IHRoaXMubW9kZWwuZ2V0KCdwcml2YWN5JykudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgdmlzU291cmNlOiB0aGlzLm1vZGVsLmdldCgnc291cmNlJyksXG4gICAgICAgIHZpc0F0dHJpYnV0aW9uczogdGhpcy5tb2RlbC5nZXQoJ2F0dHJpYnV0aW9ucycpLFxuICAgICAgICB2aXNEaXNwbGF5TmFtZTogdGhpcy5tb2RlbC5nZXQoJ2Rpc3BsYXlfbmFtZScpLFxuICAgICAgICBpc05hbWVFZGl0YWJsZTogdGhpcy5tb2RlbC5pc05hbWVFZGl0YWJsZSgpLFxuICAgICAgICBpc01ldGFkYXRhRWRpdGFibGU6IHRoaXMubW9kZWwuaXNNZXRhZGF0YUVkaXRhYmxlKCksXG4gICAgICAgIG1heExlbmd0aDogdGhpcy5vcHRpb25zLm1heExlbmd0aFxuICAgICAgfSlcbiAgICApO1xuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnZXJyb3InLCB0aGlzLl9zZXRGaWVsZHMsIHRoaXMpO1xuICAgIHRoaXMubW9kZWwuYmluZCgndmFsaWQnLCB0aGlzLl9zZXRGaWVsZHMsIHRoaXMpO1xuICB9LFxuXG4gIF9pbml0Vmlld3M6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8vIE1hcmtkb3duIHRvb2x0aXBcbiAgICB0aGlzLmFkZFZpZXcoXG4gICAgICBuZXcgY2RiLmNvbW1vbi5UaXBzeVRvb2x0aXAoe1xuICAgICAgICBlbDogdGhpcy4kKCcuanMtbWFya2Rvd24nKSxcbiAgICAgICAgaHRtbDogdHJ1ZSxcbiAgICAgICAgdGl0bGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiAkKHRoaXMpLmRhdGEoJ3RpdGxlJyk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcblxuICAgIC8vIE5hbWUgZXJyb3IgdG9vbHRpcFxuICAgIHRoaXMuYWRkVmlldyhcbiAgICAgIG5ldyBjZGIuY29tbW9uLlRpcHN5VG9vbHRpcCh7XG4gICAgICAgIGVsOiB0aGlzLiQoJy5qcy1uYW1lJyksXG4gICAgICAgIHRpdGxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gc2VsZi5tb2RlbC5nZXRFcnJvcigpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG5cbiAgICAvLyBUYWdzXG4gICAgXy5lYWNoKHRoaXMubW9kZWwuZ2V0KCd0YWdzJyksIGZ1bmN0aW9uKGxpKSB7XG4gICAgICB0aGlzLiQoXCIuanMtdGFnc0xpc3RcIikuYXBwZW5kKFwiPGxpPlwiICsgY2RiLmNvcmUuc2FuaXRpemUuaHRtbChsaSkgKyBcIjwvbGk+XCIpO1xuICAgIH0sIHRoaXMpO1xuXG4gICAgdmFyIHRhZ3NQbGFjZWhvbGRlciA9ICghdGhpcy5tb2RlbC5pc01ldGFkYXRhRWRpdGFibGUoKSAmJiB0aGlzLm1vZGVsLmdldCgndGFncycpLmxlbmd0aCA9PT0gMCkgPyAnTm8gdGFncycgOiAnQWRkIHRhZ3MnO1xuXG4gICAgdGhpcy4kKFwiLmpzLXRhZ3NMaXN0XCIpLnRhZ2l0KHtcbiAgICAgIGFsbG93U3BhY2VzOiB0cnVlLFxuICAgICAgcGxhY2Vob2xkZXJUZXh0OiB0YWdzUGxhY2Vob2xkZXIsXG4gICAgICByZWFkT25seTogIXRoaXMubW9kZWwuaXNNZXRhZGF0YUVkaXRhYmxlKCksXG4gICAgICBvbkJsdXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoc2VsZi5tb2RlbC5pc01ldGFkYXRhRWRpdGFibGUoKSkge1xuICAgICAgICAgIHNlbGYuJCgnLmpzLXRhZ3MnKS5yZW1vdmVDbGFzcygnaXMtZm9jdXMnKVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb25Gb2N1czogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChzZWxmLm1vZGVsLmlzTWV0YWRhdGFFZGl0YWJsZSgpKSB7XG4gICAgICAgICAgc2VsZi4kKCcuanMtdGFncycpLmFkZENsYXNzKCdpcy1mb2N1cycpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvblN1Ym1pdFRhZ3M6IGZ1bmN0aW9uKGV2LCB0YWdMaXN0KSB7XG4gICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHNlbGYuX29uU3VibWl0KCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIExpY2Vuc2VzIGRyb3Bkb3duXG4gICAgaWYgKHRoaXMubW9kZWwuaXNEYXRhc2V0KCkpIHtcbiAgICAgIHRoaXMuX2xpY2Vuc2VEcm9wZG93biA9IG5ldyBjZGIuZm9ybXMuQ29tYm8oe1xuICAgICAgICBjbGFzc05hbWU6ICdTZWxlY3QnLFxuICAgICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgICBwcm9wZXJ0eTogJ2xpY2Vuc2UnLFxuICAgICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgICAgZGlzYWJsZWQ6ICF0aGlzLm1vZGVsLmlzTWV0YWRhdGFFZGl0YWJsZSgpLFxuICAgICAgICBleHRyYTogdGhpcy5fZ2V0TGljZW5zZXNGb3JGb3Jtc0NvbWJvKClcbiAgICAgIH0pO1xuICAgICAgdGhpcy5hZGRWaWV3KHRoaXMuX2xpY2Vuc2VEcm9wZG93bik7XG4gICAgICB0aGlzLiQoJy5qcy1saWNlbnNlJykuYXBwZW5kKHRoaXMuX2xpY2Vuc2VEcm9wZG93bi5yZW5kZXIoKS5lbCk7XG4gICAgfVxuICB9LFxuXG4gIF9nZXRMaWNlbnNlc0ZvckZvcm1zQ29tYm86IGZ1bmN0aW9uKCkge1xuICAgIHZhciBpdGVtcyA9IGNkYi5jb25maWcuZ2V0KCdsaWNlbnNlcycpO1xuICAgIHZhciBlbXB0eU9wdGlvbiA9IFt7XG4gICAgICBpZDogJycsXG4gICAgICBuYW1lOiAnLSdcbiAgICB9XTtcbiAgICByZXR1cm4gXy5jaGFpbihlbXB0eU9wdGlvbi5jb25jYXQoaXRlbXMpKVxuICAgICAgLmNvbXBhY3QoKVxuICAgICAgLm1hcChmdW5jdGlvbihkKSB7XG4gICAgICAgIHJldHVybiBbZC5uYW1lLCBkLmlkXTtcbiAgICAgIH0pXG4gICAgICAudmFsdWUoKTtcbiAgfSxcblxuICBfc2V0RmllbGRzOiBmdW5jdGlvbigpIHtcbiAgICAvLyBmb3IgdGhlIG1vbWVudCBvbmx5IG5hbWUgaW5wdXQgaXMgcmVxdWlyZWRcbiAgICB0aGlzLiQoJy5qcy1uYW1lJykudG9nZ2xlQ2xhc3MoJ2lzLWludmFsaWQnLCAhIXRoaXMubW9kZWwuZ2V0RXJyb3IoKSk7XG4gIH0sXG5cbiAgX3Nob3dQcml2YWN5OiBmdW5jdGlvbihldikge1xuICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICB0aGlzLnRyaWdnZXIoJ29uUHJpdmFjeScsIHRoaXMpO1xuICB9LFxuXG4gIC8vIEZvcm0gZXZlbnRzXG5cbiAgX29uTmFtZUtleURvd246IGZ1bmN0aW9uKGV2KSB7XG4gICAgaWYgKGV2LmtleUNvZGUgPT09ICQudWkua2V5Q29kZS5FTlRFUikge1xuICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX29uU3VibWl0KCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9LFxuXG4gIF9vblN1Ym1pdDogZnVuY3Rpb24oZXYpIHtcbiAgICBpZiAoZXYpIHtcbiAgICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICB9XG5cbiAgICAvLyB2YWx1ZXNcbiAgICB2YXIgYXR0cnMgPSB7fTtcbiAgICBpZiAodGhpcy5tb2RlbC5pc05hbWVFZGl0YWJsZSgpKSB7XG4gICAgICBhdHRyc1snbmFtZSddID0gVXRpbHMuc3RyaXBIVE1MKHRoaXMuJCgnLmpzLW5hbWUnKS52YWwoKSk7XG4gICAgfVxuICAgIGlmICh0aGlzLm1vZGVsLmlzTWV0YWRhdGFFZGl0YWJsZSgpKSB7XG4gICAgICBhdHRyc1snZGVzY3JpcHRpb24nXSA9IFV0aWxzLnJlbW92ZUhUTUxFdmVudHModGhpcy4kKCcuanMtZGVzY3JpcHRpb24nKS52YWwoKSk7XG4gICAgICBhdHRyc1sndGFncyddID0gdGhpcy4kKCcuanMtdGFnc0xpc3QnKS50YWdpdChcImFzc2lnbmVkVGFnc1wiKTtcblxuICAgICAgaWYgKHRoaXMubW9kZWwuaXNEYXRhc2V0KCkpIHtcbiAgICAgICAgYXR0cnMuc291cmNlID0gdGhpcy4kKCcuanMtc291cmNlJykudmFsKCk7XG4gICAgICAgIGF0dHJzLmF0dHJpYnV0aW9ucyA9IHRoaXMuJCgnLmpzLWF0dHJpYnV0aW9ucycpLnZhbCgpO1xuICAgICAgICBhdHRycy5kaXNwbGF5X25hbWUgPSB0aGlzLiQoJy5qcy1kaXNwbGF5TmFtZScpLnZhbCgpO1xuICAgICAgICAvLyBsaWNlbnNlIGlzIHNldCB0aHJvdWdoIGRyb3Bkb3duIHZpZXcsIHNvIG5vIG5lZWQgdG8gZG8gYW4gZXhwbGljaXQgc2V0IGhlcmVcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLm1vZGVsLnNldChhdHRycyk7XG5cbiAgICBpZiAodGhpcy5tb2RlbC5pc1ZhbGlkKCkpIHtcbiAgICAgIHRoaXMudHJpZ2dlcignb25TdWJtaXQnLCB0aGlzLm1vZGVsLCB0aGlzKTtcbiAgICB9XG4gIH0sXG5cbiAgLy8gQ2xlYW4gZnVuY3Rpb25zXG5cbiAgX2Rlc3Ryb3lUYWdzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoJy5qcy10YWdzTGlzdCcpLnRhZ2l0KCdkZXN0cm95Jyk7XG4gIH0sXG5cbiAgY2xlYW46IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2Rlc3Ryb3lUYWdzKCk7XG4gICAgdGhpcy5lbGRlcignY2xlYW4nKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqICBFZGl0IHZpcyBtZXRhZGF0YSBkaWFsb2cgbW9kZWxcbiAqICB0byBjb250cm9sIGlmIG5hbWUgYW5kIG1ldGFkYXRhXG4gKiAgYXJlIGVkaXRhYmxlIG9yIG5vdC5cbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIGRlZmF1bHRzOiB7XG4gICAgbmFtZTogJycsXG4gICAgZGVzY3JpcHRpb246ICcnLFxuICAgIHRhZ3M6ICcnLFxuICAgIHByaXZhY3k6ICcnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oYXR0cnMsIG9wdHMpIHtcbiAgICBpZiAoIW9wdHMgfHwgIW9wdHMudmlzIHx8ICFvcHRzLnVzZXIgfHwgIW9wdHMuZGF0YUxheWVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Zpc3VhbGl6YXRpb24sIHVzZXIgYW5kIGRhdGFMYXllciBtb2RlbHMgYXJlIHJlcXVpcmVkJyk7XG4gICAgfVxuICAgIHRoaXMudmlzID0gb3B0cy52aXM7XG4gICAgdGhpcy51c2VyID0gb3B0cy51c2VyO1xuICAgIHRoaXMuZGF0YUxheWVyID0gb3B0cy5kYXRhTGF5ZXI7XG5cbiAgICB2YXIgZGF0YSA9IHtcbiAgICAgIG5hbWU6IHRoaXMudmlzLmdldCgnbmFtZScpLFxuICAgICAgZGVzY3JpcHRpb246IHRoaXMudmlzLmdldCgnZGVzY3JpcHRpb24nKSxcbiAgICAgIHRhZ3M6IHRoaXMudmlzLmdldCgndGFncycpLFxuICAgICAgcHJpdmFjeTogdGhpcy52aXMuZ2V0KCdwcml2YWN5JylcbiAgICB9O1xuICAgIGlmICghdGhpcy52aXMuaXNWaXN1YWxpemF0aW9uKCkpIHtcbiAgICAgIC8vIEFkZGl0aW9uYWwgZmllbGRzLCBvbmx5IGZvciBkYXRhc2V0LCB3LyBmYWxsYmFja3MgZm9yIGRlZmF1bHRzXG4gICAgICBkYXRhLnNvdXJjZSA9IHRoaXMudmlzLmdldCgnc291cmNlJykgfHwgJyc7XG4gICAgICBkYXRhLmF0dHJpYnV0aW9ucyA9IHRoaXMudmlzLmdldCgnYXR0cmlidXRpb25zJykgfHwgJyc7XG4gICAgICBkYXRhLmxpY2Vuc2UgPSB0aGlzLnZpcy5nZXQoJ2xpY2Vuc2UnKSB8fCAnJztcbiAgICAgIGRhdGEuZGlzcGxheV9uYW1lID0gdGhpcy52aXMuZ2V0KCdkaXNwbGF5X25hbWUnKSB8fCAnJztcbiAgICB9XG4gICAgdGhpcy5zZXQoZGF0YSk7XG5cbiAgICAvLyBWYWxpZGF0aW9uIGNvbnRyb2wgdmFyaWFibGVcbiAgICB0aGlzLnZhbGlkYXRpb25FcnJvciA9ICcnO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuYmluZCgndmFsaWQnLCBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMudmFsaWRhdGlvbkVycm9yID0gJyc7XG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy5iaW5kKCdlcnJvcicsIGZ1bmN0aW9uKG0sIGVycm9yKSB7XG4gICAgICB0aGlzLnZhbGlkYXRpb25FcnJvciA9IGVycm9yO1xuICAgIH0sIHRoaXMpO1xuICB9LFxuXG4gIC8vIFZhbGlkYXRpb25cbiAgX3ZhbGlkYXRlOiBmdW5jdGlvbihhdHRycykge1xuICAgIHZhciB2YWxpZCA9IGNkYi5jb3JlLk1vZGVsLnByb3RvdHlwZS5fdmFsaWRhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICBpZiAodmFsaWQpIHtcbiAgICAgIHRoaXMudHJpZ2dlcigndmFsaWQnKVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sXG5cbiAgdmFsaWRhdGU6IGZ1bmN0aW9uKGF0dHJzKSB7XG4gICAgaWYgKCFhdHRycykgcmV0dXJuO1xuXG4gICAgaWYgKCFhdHRycy5uYW1lKSB7XG4gICAgICByZXR1cm4gXCJOYW1lIGNhbid0IGJlIGJsYW5rXCJcbiAgICB9XG4gIH0sXG5cbiAgZ2V0RXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnZhbGlkYXRpb25FcnJvcjtcbiAgfSxcblxuICBpc1ZhbGlkOiBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMudmFsaWRhdGUpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gIXRoaXMudmFsaWRhdGUodGhpcy5hdHRyaWJ1dGVzKSAmJiB0aGlzLnZhbGlkYXRpb25FcnJvciA9PT0gXCJcIjtcbiAgfSxcblxuICAvLyBIZWxwZXIgZnVuY3Rpb25zXG4gIGlzRGF0YXNldDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICF0aGlzLnZpcy5pc1Zpc3VhbGl6YXRpb24oKTtcbiAgfSxcblxuICBpc1Zpc0VkaXRhYmxlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy52aXMucGVybWlzc2lvbi5pc093bmVyKHRoaXMudXNlcik7XG4gIH0sXG5cbiAgaXNBdHRyaWJ1dGVFZGl0YWJsZTogZnVuY3Rpb24odHlwZSkge1xuICAgIGlmICh0aGlzLnZpcy5pc1Zpc3VhbGl6YXRpb24oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuaXNWaXNFZGl0YWJsZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgaXNSZWFkT25seSA9IHR5cGUgPT09IFwibmFtZVwiID8gdGhpcy5kYXRhTGF5ZXIuaXNSZWFkT25seSgpIDogZmFsc2U7XG4gICAgICBpZiAoIXRoaXMuZGF0YUxheWVyKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhTGF5ZXIgJiYgKGlzUmVhZE9ubHkgfHwgIXRoaXMuZGF0YUxheWVyLnBlcm1pc3Npb24uaXNPd25lcih0aGlzLnVzZXIpKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgaXNOYW1lRWRpdGFibGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmlzQXR0cmlidXRlRWRpdGFibGUoJ25hbWUnKTtcbiAgfSxcblxuICBpc01ldGFkYXRhRWRpdGFibGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmlzQXR0cmlidXRlRWRpdGFibGUoJ3Jlc3QnKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIEJhc2VEaWFsb2cgPSByZXF1aXJlKCcuLi8uLi92aWV3cy9iYXNlX2RpYWxvZy92aWV3Jyk7XG52YXIgVmlld0ZhY3RvcnkgPSByZXF1aXJlKCcuLi8uLi92aWV3X2ZhY3RvcnknKTtcbnZhciBGb3JtVmlldyA9IHJlcXVpcmUoJy4vZWRpdF92aXNfZm9ybV92aWV3Jyk7XG52YXIgRWRpdFZpc01ldGFkYXRhTW9kZWwgPSByZXF1aXJlKCcuL2VkaXRfdmlzX21ldGFkYXRhX2RpYWxvZ19tb2RlbCcpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZScpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG5cblxuLyoqXG4gKiAgRWRpdCB2aXN1YWxpemF0aW9uIChkYXRhc2V0IG9yIG1hcCkgZGlhbG9nXG4gKlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VEaWFsb2cuZXh0ZW5kKHtcblxuICBldmVudHM6IEJhc2VEaWFsb2cuZXh0ZW5kRXZlbnRzKHtcbiAgICAnY2xpY2sgLmpzLWJhY2snOiAnX3Nob3dGb3JtJ1xuICB9KSxcblxuICBjbGFzc05hbWU6ICdEaWFsb2cgaXMtb3BlbmluZyBFZGl0VmlzTWV0YWRhdGEnLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcblxuICAgIGlmICghdGhpcy5vcHRpb25zLnZpcykge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigndmlzIG1vZGVsIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgdGhpcy52aXMgPSB0aGlzLm9wdGlvbnMudmlzO1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMuZGF0YUxheWVyID0gdGhpcy5vcHRpb25zLmRhdGFMYXllcjtcbiAgICB0aGlzLm1vZGVsID0gbmV3IEVkaXRWaXNNZXRhZGF0YU1vZGVsKHt9LCB7XG4gICAgICB2aXM6IHRoaXMudmlzLFxuICAgICAgZGF0YUxheWVyOiB0aGlzLmRhdGFMYXllcixcbiAgICAgIHVzZXI6IHRoaXMudXNlclxuICAgIH0pO1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9lZGl0X3Zpc19tZXRhZGF0YS9lZGl0X3Zpc19tZXRhZGF0YV9kaWFsb2cnKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuICAgIEJhc2VEaWFsb2cucHJvdG90eXBlLnJlbmRlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuJCgnLmNvbnRlbnQnKS5hZGRDbGFzcygnRGlhbG9nLWNvbnRlbnQtLWV4cGFuZGVkJyk7XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB2aXNUeXBlID0gdGhpcy52aXMuaXNWaXN1YWxpemF0aW9uKCkgPyAnbWFwJyA6ICdkYXRhc2V0JztcbiAgICByZXR1cm4gdGhpcy50ZW1wbGF0ZSh7XG4gICAgICB2aXNUeXBlOiB2aXNUeXBlLFxuICAgICAgdmlzVHlwZUNhcGl0YWxpemVkOiB2aXNUeXBlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdmlzVHlwZS5zbGljZSgxKSxcbiAgICAgIGlzTmFtZUVkaXRhYmxlOiB0aGlzLm1vZGVsLmlzTmFtZUVkaXRhYmxlKCksXG4gICAgICBpc01ldGFkYXRhRWRpdGFibGU6IHRoaXMubW9kZWwuaXNNZXRhZGF0YUVkaXRhYmxlKClcbiAgICB9KTtcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICAvLyBQYW5lc1xuICAgIHRoaXMuX3BhbmVzID0gbmV3IGNkYi51aS5jb21tb24uVGFiUGFuZSh7XG4gICAgICBlbDogdGhpcy4kKCcuanMtY29udGVudCcpXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgZm9ybVxuICAgIHZhciBmb3JtID0gbmV3IEZvcm1WaWV3KHtcbiAgICAgIGVsOiB0aGlzLiQoJy5qcy1mb3JtJyksXG4gICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgIHVzZXI6IHRoaXMudXNlcixcbiAgICAgIG1heExlbmd0aDogdGhpcy5vcHRpb25zLm1heExlbmd0aFxuICAgIH0pO1xuXG4gICAgZm9ybS5iaW5kKCdvblByaXZhY3knLCB0aGlzLl9zaG93UHJpdmFjeSwgdGhpcyk7XG4gICAgZm9ybS5iaW5kKCdvblN1Ym1pdCcsIHRoaXMuX3NhdmVBdHRyaWJ1dGVzLCB0aGlzKTtcbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ2Zvcm0nLCBmb3JtLnJlbmRlcigpKTtcblxuICAgIC8vIENyZWF0ZSBsb2FkaW5nXG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdsb2FkaW5nJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycsIHtcbiAgICAgICAgdGl0bGU6ICdTYXZpbmcgbmV3IGRhdGEuLi4nLFxuICAgICAgICBxdW90ZTogcmFuZG9tUXVvdGUoKVxuICAgICAgfSkucmVuZGVyKClcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIGVycm9yXG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdlcnJvcicsXG4gICAgICBWaWV3RmFjdG9yeS5jcmVhdGVCeVRlbXBsYXRlKCdjb21tb24vdGVtcGxhdGVzL2ZhaWwnLCB7XG4gICAgICAgIG1zZzogJ1NvcnJ5LCBzb21ldGhpbmcgd2VudCB3cm9uZyBidXQgeW91IGNhbiBnZXQgPGJ1dHRvbiBjbGFzcz1cIkJ1dHRvbi0tbGluayBqcy1iYWNrXCI+YmFjayB0byB0aGUgZm9ybTwvYnV0dG9uPi4nXG4gICAgICB9KS5yZW5kZXIoKVxuICAgICk7XG5cbiAgICB0aGlzLl9wYW5lcy5hY3RpdmUoJ2Zvcm0nKTtcbiAgfSxcblxuICBfc2F2ZUF0dHJpYnV0ZXM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgbmV3QXR0cnMgPSBfLm9taXQodGhpcy5tb2RlbC50b0pTT04oKSwgJ3ByaXZhY3knKTtcbiAgICB2YXIgb2xkQXR0cnMgPSB7XG4gICAgICBuYW1lOiB0aGlzLnZpcy5nZXQoJ25hbWUnKSxcbiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLnZpcy5nZXQoJ2Rlc2NyaXB0aW9uJyksXG4gICAgICB0YWdzOiB0aGlzLnZpcy5nZXQoJ3RhZ3MnKVxuICAgIH07XG4gICAgaWYgKHRoaXMubW9kZWwuaXNEYXRhc2V0KCkpIHtcbiAgICAgIG9sZEF0dHJzLnNvdXJjZSA9IHRoaXMudmlzLmdldCgnc291cmNlJyk7XG4gICAgICBvbGRBdHRycy5hdHRyaWJ1dGlvbnMgPSB0aGlzLnZpcy5nZXQoJ2F0dHJpYnV0aW9ucycpO1xuICAgICAgb2xkQXR0cnMubGljZW5zZSA9IHRoaXMudmlzLmdldCgnbGljZW5zZScpO1xuICAgIH1cblxuICAgIGlmICghXy5pc0VtcHR5KHRoaXMudmlzLmNoYW5nZWRBdHRyaWJ1dGVzKG5ld0F0dHJzKSkpIHtcbiAgICAgIHRoaXMuX3BhbmVzLmFjdGl2ZSgnbG9hZGluZycpO1xuICAgICAgdGhpcy52aXMuc2F2ZShuZXdBdHRycyx7XG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNlbGYub3B0aW9ucy5vbkRvbmUgJiYgc2VsZi5vcHRpb25zLm9uRG9uZShvbGRBdHRycy5uYW1lICE9PSBuZXdBdHRycy5uYW1lKTtcbiAgICAgICAgICBzZWxmLmhpZGUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNlbGYudmlzLnNldChvbGRBdHRycyk7XG4gICAgICAgICAgc2VsZi5fcGFuZXMuYWN0aXZlKCdlcnJvcicpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmhpZGUoKTtcbiAgICB9XG4gIH0sXG5cbiAgX3Nob3dQcml2YWN5OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm9wdGlvbnMub25TaG93UHJpdmFjeSAmJiB0aGlzLm9wdGlvbnMub25TaG93UHJpdmFjeSgpO1xuICAgIHRoaXMuaGlkZSgpO1xuICB9LFxuXG4gIF9zaG93Rm9ybTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdmb3JtJyk7XG4gIH1cblxufSk7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcblxuLyoqXG4gKiBzaG93cyBhIGRpYWxvZyB0byBnZXQgdGhlIHRhYmxlIGV4cG9ydGVkXG4gKiBuZXcgRXhwb3J0RGlhbG9nKHtcbiAqICB0YWJsZTogdGFibGVfbW9kZWxcbiAqIH0pXG4gKlxuICogKE1pZ3JhdGVkIGFsbW9zdC1hcy1pcyBmcm9tIG9sZCBlZGl0b3IgdG8gbm90IGJyZWFrIGZ1bmN0aW9uYWxpdHkpXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIF9DU1ZfRklMVEVSOiAnU0VMRUNUICogRlJPTSAoJSVzcWwlJSkgYXMgc3VicSAnLFxuICBfTUFYX1NRTF9HRVRfTEVOR1RIOiAxMDAwLFxuICBldmVudHM6IEJhc2VEaWFsb2cuZXh0ZW5kRXZlbnRzKHtcbiAgICAnY2xpY2sgLmpzLW9wdGlvbjpub3QoLmlzLWRpc2FibGVkKSc6ICdfZXhwb3J0J1xuICB9KSxcblxuICAvKipcbiAgICogQWxsb3dlZCBmb3JtYXRzIG9uIHRoZSBleHBvcnRlclxuICAgKiBAdHlwZSB7QXJyYXl9XG4gICAqL1xuICBmb3JtYXRzOiBbXG4gICAge2Zvcm1hdDogJ2NzdicsIGZldGNoZXI6ICdmZXRjaENTVicsIGdlb21SZXF1aXJlZDogZmFsc2UsIGlsbHVzdHJhdGlvbkljb25Nb2RpZmllcjogJ0lsbHVzdHJhdGlvbkljb24tLW5ldXRyYWwnIH0sXG4gICAge2Zvcm1hdDogJ3NocCcsIGZldGNoZXI6ICdmZXRjaCcsIGdlb21SZXF1aXJlZDogdHJ1ZSwgaWxsdXN0cmF0aW9uSWNvbk1vZGlmaWVyOiAnSWxsdXN0cmF0aW9uSWNvbi0tbWFnZW50YScgfSxcbiAgICB7Zm9ybWF0OiAna21sJywgZmV0Y2hlcjogJ2ZldGNoJywgZ2VvbVJlcXVpcmVkOiB0cnVlLCBpbGx1c3RyYXRpb25JY29uTW9kaWZpZXI6ICdJbGx1c3RyYXRpb25JY29uLS1zdW5yaXNlJyB9LFxuICAgIHtmb3JtYXQ6ICdnZW9qc29uJywgbGFiZWw6ICdnZW8ganNvbicsIGZldGNoZXI6ICdmZXRjaCcsIGdlb21SZXF1aXJlZDogdHJ1ZSwgaWxsdXN0cmF0aW9uSWNvbk1vZGlmaWVyOiAnSWxsdXN0cmF0aW9uSWNvbi0tY3lhbicgfSxcbiAgICB7Zm9ybWF0OiAnc3ZnJywgZmV0Y2hlcjogJ2ZldGNoU1ZHJywgZ2VvbVJlcXVpcmVkOiB0cnVlLCBpbGx1c3RyYXRpb25JY29uTW9kaWZpZXI6ICdJbGx1c3RyYXRpb25JY29uLS1yb3lhbERhcmsnIH1cbiAgXSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgXy5leHRlbmQodGhpcy5vcHRpb25zLCB7XG4gICAgICBjbGVhbl9vbl9oaWRlOiB0cnVlLFxuICAgICAgdGFibGVfaWQ6IHRoaXMubW9kZWwuaWRcbiAgICB9KTtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgXy5iaW5kQWxsKHRoaXMsICdfZXhwb3J0Jyk7XG4gICAgdGhpcy5iYXNlVXJsID0gY2RiLmNvbmZpZy5nZXRTcWxBcGlVcmwoKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpnZW9tZXRyeV90eXBlcycsIHRoaXMucmVmcmVzaCwgdGhpcyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIHNlYXJjaCBhIGZvcm1hdCBiYXNlZCBvbiBpdHMgbmFtZSBpbiB0aGUgZm9ybWF0IGFycmF5XG4gICAqIEBwYXJhbSAge3N0cmluZ30gZm9ybWF0IEZvcm1hdCBuYW1lXG4gICAqIEByZXR1cm4ge09iamVjdH1cbiAgICovXG4gIGdldEZvcm1hdDogZnVuY3Rpb24gKGZvcm1hdCkge1xuICAgIGZvciAodmFyIG4gaW4gdGhpcy5mb3JtYXRzKSB7XG4gICAgICBpZiAodGhpcy5mb3JtYXRzW25dLmZvcm1hdCA9PT0gZm9ybWF0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZvcm1hdHNbbl07XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBBbnN3ZXIgdG8gYnV0dG9uIGV2ZW50IGFuZCBsYXVjaG4gdGhlIGV4cG9ydCBtZXRob2QgYXNzb2NpYXRlZCB0byB0aGF0IGZvcm1hdFxuICAgKiBAcGFyYW0gIHtFdmVudH0gZXZcbiAgICovXG4gIF9leHBvcnQ6IGZ1bmN0aW9uIChldikge1xuICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICB2YXIgJGJ1dHRvbiA9ICQoZXYuY3VycmVudFRhcmdldCk7XG4gICAgdmFyIGZvcm1hdE5hbWUgPSAkYnV0dG9uLmRhdGEoJ2Zvcm1hdCcpO1xuICAgIHZhciBmb3JtYXQgPSB0aGlzLmdldEZvcm1hdChmb3JtYXROYW1lKTtcbiAgICB0aGlzW2Zvcm1hdC5mZXRjaGVyXShmb3JtYXROYW1lKTtcbiAgfSxcblxuICAvKipcbiAgICogQ3JlYXRlIGEgZGljdGlvbmFyeSB3aXRoIHRoZSBvcHRpb25zIHNoYXJlZCBiZXR3ZWVuIGFsbCB0aGUgbWV0aG9kc1xuICAgKiBAcmV0dXJuIHtPYmplY3R9XG4gICAqL1xuICBnZXRCYXNlT3B0aW9uczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBvcHRpb25zID0ge307XG4gICAgb3B0aW9ucy5maWxlbmFtZSA9IHRoaXMubW9kZWwuZ2V0KCduYW1lJyk7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLnVzZXJfZGF0YSkge1xuICAgICAgb3B0aW9ucy5hcGlfa2V5ID0gdGhpcy5vcHRpb25zLnVzZXJfZGF0YS5hcGlfa2V5O1xuICAgIH1cblxuICAgIHJldHVybiBvcHRpb25zO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBiYXNlIHNxbCB0byByZXRyaWV2ZSB0aGUgZGF0YVxuICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAqL1xuICBnZXRQbGFpblNxbDogZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuc3FsKSB7XG4gICAgICBzcWwgPSB0aGlzLm9wdGlvbnMuc3FsO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5tb2RlbC5zcWxWaWV3KSB7XG4gICAgICAgIHNxbCA9IHRoaXMubW9kZWwuc3FsVmlldy5nZXRTUUwoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNxbCA9ICdzZWxlY3QgKiBmcm9tICcgKyB0aGlzLm1vZGVsLmdldCgnbmFtZScpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc3FsO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgc3BlY2lmaWMgc3FsIGZpbHRlcmVkIGJ5IHRoZV9nZW9tLCB1c2VkIG9uIENTViBleHBvcnRzXG4gICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICovXG4gIGdldEdlb21GaWx0ZXJlZFNxbDogZnVuY3Rpb24gKCkge1xuICAgIHZhciBzcWwgPSB0aGlzLmdldFBsYWluU3FsKCk7XG4gICAgLy8gaWYgd2UgaGF2ZSBcInRoZV9nZW9tXCIgaW4gb3VyIGN1cnJlbnQgc2NoZW1hLCB3ZSBhcHBseSBhIGN1c3RvbSBzcWxcbiAgICBpZiAodGhpcy5tb2RlbC5pc0dlb3JlZmVyZW5jZWQoKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX0NTVl9GSUxURVIucmVwbGFjZSgvJSVzcWwlJS9nLCBzcWwpO1xuICAgIH1cbiAgICAvLyBPdGhlcndpc2UsIHdlIGFwcGx5IHJlZ3VsYXIgc3FsXG4gICAgcmV0dXJuIHNxbDtcbiAgfSxcblxuICAvKipcbiAgICogUG9wdWxhdGVzIHRoZSBoaWRkZW4gZm9ybSB3aXRoIHRoZSBmb3JtYXQgcmVsYXRlZCB2YWx1ZXMgYW5kIHN1Ym1pdHMgdGhlbSB0byBnZXQgdGhlIGZpbGVcbiAgICogQHBhcmFtICB7T2JqZWN0fSBvcHRpb25zIEJhc2Ugb3B0aW9uc1xuICAgKiBAcGFyYW0gIHtTdHJpbmd9IHNxbCBTcWwgb2YgdGhlIGRvY3VtZW50IHRvIGJlIHJldHJpZXZlZFxuICAgKi9cbiAgX2ZldGNoOiBmdW5jdGlvbiAob3B0aW9ucywgc3FsKSB7XG4gICAgdGhpcy5fc2hvd0VsQW5kSGlkZVJlc3QoJy5qcy1wcmVwYXJpbmctZG93bmxvYWQnKTtcbiAgICB0aGlzLiQoJy5mb3JtYXQnKS52YWwob3B0aW9ucy5mb3JtYXQpO1xuICAgIHRoaXMuJCgnLnEnKS52YWwoc3FsKTtcbiAgICB0aGlzLiQoJy5maWxlbmFtZScpLnZhbChvcHRpb25zLmZpbGVuYW1lKTtcbiAgICB0aGlzLiQoJy5hcGlfa2V5JykudmFsKG9wdGlvbnMuYXBpX2tleSk7XG5cbiAgICBpZiAob3B0aW9ucy5mb3JtYXQgPT09ICdjc3YnKSB7XG4gICAgICB0aGlzLiQoJy5za2lwZmllbGRzJykudmFsKCd0aGVfZ2VvbV93ZWJtZXJjYXRvcicpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLiQoJy5za2lwZmllbGRzJykudmFsKCd0aGVfZ2VvbSx0aGVfZ2VvbV93ZWJtZXJjYXRvcicpO1xuICAgIH1cblxuICAgIGlmICh3aW5kb3cudXNlcl9kYXRhICYmIHdpbmRvdy51c2VyX2RhdGEuZW1haWwpIHtcbiAgICAgIC8vIEV2ZW50IHRyYWNraW5nIFwiRXhwb3J0ZWQgdGFibGUgZGF0YVwiXG4gICAgICBjZGIuZ29kLnRyaWdnZXIoJ21ldHJpY3MnLCAnZXhwb3J0X3RhYmxlJywge1xuICAgICAgICBlbWFpbDogd2luZG93LnVzZXJfZGF0YS5lbWFpbFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gY2hlY2sgaWYgdGhlIHNxbCBpcyBiaWcgb3Igbm90LCBhbmQgc2VuZCB0aGUgcmVxdWVzdCBhcyBhIHZlcmIgb3Igb3RoZXIuIFRoaXMgaXMgYSBIQUNLLlxuICAgIGlmIChzcWwubGVuZ3RoIDwgdGhpcy5fTUFYX1NRTF9HRVRfTEVOR1RIKSB7XG4gICAgICB2YXIgbG9jYXRpb24gPSB0aGlzLiQoJ2Zvcm0nKS5hdHRyKCdhY3Rpb24nKSArICc/JyArIHRoaXMuJCgnZm9ybScpLnNlcmlhbGl6ZSgpO1xuICAgICAgdGhpcy5fZmV0Y2hHRVQobG9jYXRpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJIGNhbid0IGZpbmQgYSB3YXkgb2YgbWFraW5nIHRoZSBpZnJhbWUgdHJpZ2dlciBsb2FkIGV2ZW50IHdoZW4gaXRzIGdldCBhIGZvcm0gcG9zdGVkLFxuICAgICAgLy8gc28gd2UgbmVlZCB0byBsZWF2ZSBsaWtlIGl0IHdhcyB1bnRpbFxuICAgICAgdGhpcy5zdWJtaXQoKTtcbiAgICB9XG5cbiAgICB0aGlzLiQoJy5kYicpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgdGhpcy4kKCcuc2tpcGZpZWxkcycpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLmF1dG9DbG9zZSkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgdGhpcy50cmlnZ2VyKCdnZW5lcmF0aW5nJywgdGhpcy4kKCcuanMtcHJlcGFyaW5nLWRvd25sb2FkJykuaHRtbCgpKTtcbiAgICB9XG4gIH0sXG5cbiAgc2hvd0Vycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICB0aGlzLiQoJy5qcy1lcnJvcicpLmh0bWwoXG4gICAgICB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vdGVtcGxhdGVzL2ZhaWwnKSh7XG4gICAgICAgIG1zZzogZXJyb3JcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLl9zaG93RWxBbmRIaWRlUmVzdCgnLmpzLWVycm9yJyk7XG4gIH0sXG5cbiAgX2ZldGNoR0VUOiBmdW5jdGlvbiAodXJsKSB7XG4gICAgZnVuY3Rpb24gZ2V0RXJyb3IgKGNvbnRlbnQpIHtcbiAgICAgIC8vIHNxbCBhcGkgcmV0dXJucyBhIGpzb24gd2hlbiBpdCBmYWlsc1xuICAgICAgLy8gYnV0IGlmIHRoZSBicm93c2VyIGlzIHJ1bm5pbmcgc29tZSBwbHVnaW4gdGhhdFxuICAgICAgLy8gZm9ybWF0cyBpdCwgdGhlIHdpbmRvdyBjb250ZW50IGlzIHRoZSBodG1sXG4gICAgICAvLyBzbyBzZWFyY2ggZm9yIHRoZSB3b3JkIFwiZXJyb3JcIlxuICAgICAgdmFyIGVycm9yID0gbnVsbDtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBqc29uID0gSlNPTi5wYXJzZShjb250ZW50KTtcbiAgICAgICAgZXJyb3IgPSBqc29uLmVycm9yWzBdO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBpZiAoY29udGVudCAmJiBjb250ZW50LmluZGV4T2YoJ2Vycm9yJykgIT09IC0xKSB7XG4gICAgICAgICAgZXJyb3IgPSAnYW4gZXJyb3Igb2NjdXJyZWQnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZXJyb3I7XG4gICAgfVxuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBjaGVja0ludGVydmFsO1xuXG4gICAgdmFyIHcgPSB3aW5kb3cub3Blbih1cmwpO1xuICAgIHcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgY2xlYXJJbnRlcnZhbChjaGVja0ludGVydmFsKTtcbiAgICAgIHZhciBlcnJvciA9IGdldEVycm9yKHcuZG9jdW1lbnQuYm9keS50ZXh0Q29udGVudCk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgc2VsZi5zaG93RXJyb3IoZXJyb3IpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZi5jbG9zZSgpO1xuICAgICAgfVxuICAgICAgdy5jbG9zZSgpO1xuICAgIH07XG4gICAgd2luZG93LmZvY3VzKCk7XG4gICAgY2hlY2tJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uIGNoZWNrICgpIHtcbiAgICAgIC8vIHNhZmFyaSBuZWVkcyB0byBjaGVjayB0aGUgYm9keSBiZWNhdXNlIGl0IG5ldmVyXG4gICAgICAvLyBjYWxscyBvbmxvYWRcbiAgICAgIGlmICh3LmNsb3NlZCB8fCAody5kb2N1bWVudCAmJiB3LmRvY3VtZW50LmJvZHkudGV4dENvbnRlbnQubGVuZ3RoID09PSAwKSkge1xuICAgICAgICBzZWxmLmNsb3NlKCk7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoY2hlY2tJbnRlcnZhbCk7XG4gICAgICB9XG4gICAgfSwgMTAwKTtcbiAgfSxcblxuICAvKipcbiAgICogU3VibWl0cyB0aGUgZm9ybS4gVGhpcyBtZXRob2QgaXMgc2VwYXJhdGVkIHRvIGVhc2UgdGhlIHRlc3RpbmdcbiAgICovXG4gIHN1Ym1pdDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuJCgnZm9ybScpLnN1Ym1pdCgpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBCYXNlIGZldGNoLCBmb3IgdGhlIGZvcm1hdHMgdGhhdCBkb24ndCByZXF1aXJlIHNwZWNpYWwgdGhyZWF0bWVudFxuICAgKiBAcGFyYW0gIHtTdHJpbmd9IGZvcm1hdE5hbWVcbiAgICovXG4gIGZldGNoOiBmdW5jdGlvbiAoZm9ybWF0TmFtZSkge1xuICAgIHZhciBvcHRpb25zID0gdGhpcy5nZXRCYXNlT3B0aW9ucygpO1xuICAgIG9wdGlvbnMuZm9ybWF0ID0gZm9ybWF0TmFtZTtcbiAgICB2YXIgc3FsID0gdGhpcy5nZXRQbGFpblNxbCgpO1xuICAgIHRoaXMuX2ZldGNoKG9wdGlvbnMsIHNxbCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIG9wdGlvbnMgbmVlZGVkIGZvciBjc3YgZm9ybWF0IGFuZCBmZXRjaCB0aGUgZG9jdW1lbnRcbiAgICogQHBhcmFtICB7U3RyaW5nfSBmb3JtYXROYW1lXG4gICAqL1xuICBmZXRjaENTVjogZnVuY3Rpb24gKCkge1xuICAgIHZhciBvcHRpb25zID0gdGhpcy5nZXRCYXNlT3B0aW9ucygpO1xuICAgIG9wdGlvbnMuZm9ybWF0ID0gJ2Nzdic7XG4gICAgdmFyIHNxbCA9IHRoaXMuZ2V0R2VvbUZpbHRlcmVkU3FsKCk7XG4gICAgdGhpcy4kKCcuc2tpcGZpZWxkcycpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XG4gICAgdGhpcy5fZmV0Y2gob3B0aW9ucywgc3FsKTtcbiAgfSxcbiAgLyoqXG4gICAqIEdldHMgdGhlIG9wdGlvbnMgbmVlZGVkIGZvciBzdmcgZm9ybWF0IGFuZCBmZXRjaCB0aGUgZG9jdW1lbnRcbiAgICogQHBhcmFtICB7U3RyaW5nfSBmb3JtYXROYW1lXG4gICAqL1xuICBmZXRjaFNWRzogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuJCgnLmRiJykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICB0aGlzLmZldGNoKCdzdmcnKTtcbiAgfSxcbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGh0bWwgcG9wdWxhdGVkIHdpdGggY3VycmVudCBkYXRhXG4gICAqIEByZXR1cm4ge1N0cmluZ31cbiAgICovXG4gIHJlbmRlcl9jb250ZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGlzR2VvcmVmZXJlbmNlZCA9IHRoaXMubW9kZWwuaXNHZW9yZWZlcmVuY2VkKCk7XG5cbiAgICBpZiAoXy5pc0Jvb2xlYW4oaXNHZW9yZWZlcmVuY2VkKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2V4cG9ydC9leHBvcnRfdGVtcGxhdGUnKSh7XG4gICAgICAgIHByZXBhcmluZ0Rvd25sb2FkQ29udGVudDogdGhpcy5fcmVuZGVyTG9hZGluZ0NvbnRlbnQoJ1dlIGFyZSBwcmVwYXJpbmcgeW91ciBkb3dubG9hZC4gRGVwZW5kaW5nIG9uIHRoZSBzaXplLCBpdCBjb3VsZCB0YWtlIHNvbWUgdGltZS4nKSxcbiAgICAgICAgZm9ybWF0czogdGhpcy5mb3JtYXRzLFxuICAgICAgICB1cmw6IHRoaXMuYmFzZVVybCxcbiAgICAgICAgaXNHZW9yZWZlcmVuY2VkOiBpc0dlb3JlZmVyZW5jZWRcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5fcmVuZGVyTG9hZGluZ0NvbnRlbnQoJ0NoZWNraW5nIGdlb3JlZmVyZW5jZXPigKYnKTtcbiAgICB9XG4gIH0sXG5cbiAgcmVmcmVzaDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuJCgnLmNvbnRlbnQnKS5odG1sKHRoaXMucmVuZGVyX2NvbnRlbnQoKSk7XG4gIH0sXG5cbiAgX3JlbmRlckxvYWRpbmdDb250ZW50OiBmdW5jdGlvbiAodGl0bGUpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9sb2FkaW5nJykoe1xuICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgcXVvdGU6IGNkYi5lZGl0b3IucmFuZG9tUXVvdGUoKVxuICAgIH0pO1xuICB9LFxuXG4gIF9zaG93RWxBbmRIaWRlUmVzdDogZnVuY3Rpb24gKGNsYXNzTmFtZVRvU2hvdykge1xuICAgIFtcbiAgICAgICcuanMtc3RhcnQnLFxuICAgICAgJy5qcy1wcmVwYXJpbmctZG93bmxvYWQnLFxuICAgICAgJy5qcy1lcnJvcidcbiAgICBdLmZvckVhY2goZnVuY3Rpb24gKGNsYXNzTmFtZSkge1xuICAgICAgdGhpcy4kKGNsYXNzTmFtZSlbIGNsYXNzTmFtZSA9PT0gY2xhc3NOYW1lVG9TaG93ID8gJ3Nob3cnIDogJ2hpZGUnIF0oKTtcbiAgICB9LCB0aGlzKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIEJhc2VEaWFsb2cgPSByZXF1aXJlKCcuLi8uLi92aWV3cy9iYXNlX2RpYWxvZy92aWV3Jyk7XG52YXIgcmFuZG9tUXVvdGUgPSByZXF1aXJlKCcuLi8uLi92aWV3X2hlbHBlcnMvcmFuZG9tX3F1b3RlJyk7XG5cbi8qKlxuICogTG9jay91bmxvY2sgZGF0YXNldHMvbWFwcyBkaWFsb2cuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIGV2ZW50czogQmFzZURpYWxvZy5leHRlbmRFdmVudHMoe1xuICAgICdjbGljayAuanMtb2snOiAnX2NvbmZpcm0nLFxuICAgICdjbGljayAuanMtZG93bmxvYWQnOiAnX2Rvd25sb2FkJyxcbiAgICAnY2xpY2sgLmpzLWNhbmNlbCc6ICdfYWJvcnRFeHBvcnQnXG4gIH0pLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChhdHRycykge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcblxuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcl9jb250ZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHN0YXRlID0gdGhpcy5tb2RlbC5nZXQoJ3N0YXRlJyk7XG5cbiAgICBpZiAoc3RhdGUgPT09ICdjb21wbGV0ZScpIHtcbiAgICAgIHZhciB3ID0gd2luZG93Lm9wZW4odGhpcy5tb2RlbC5nZXQoJ3VybCcpKTtcblxuICAgICAgLy8gSWYgdyBpcyB1bmRlZmluZWQsIHBvcHVwIHdhcyBibG9ja2VkOiB3ZSBzaG93IGEgXCJjbGljayB0byBkb3dubG9hZFwiIG1vZGFsLiBFbHNlLCBkb3dubG9hZCBoYXMgc3RhcnRlZC5cbiAgICAgIGlmICh3ID09IG51bGwpIHJldHVybiBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9leHBvcnRfbWFwL3RlbXBsYXRlcy9kb3dubG9hZCcpO1xuXG4gICAgICB3LmZvY3VzKCk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gJ2ZhaWx1cmUnKSB7XG4gICAgICByZXR1cm4gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9mYWlsJykoe1xuICAgICAgICBtc2c6ICdFeHBvcnQgaGFzIGZhaWxlZCdcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09ICdwZW5kaW5nJyB8fCBzdGF0ZSA9PT0gJ2V4cG9ydGluZycgfHwgc3RhdGUgPT09ICd1cGxvYWRpbmcnKSB7XG4gICAgICB2YXIgbG9hZGluZ1RpdGxlID0gc3RhdGUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzdGF0ZS5zbGljZSgxKSArICcgLi4uJztcblxuICAgICAgcmV0dXJuIHRoaXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycpKHtcbiAgICAgICAgdGl0bGU6IGxvYWRpbmdUaXRsZSxcbiAgICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvZXhwb3J0X21hcC90ZW1wbGF0ZXMvY29uZmlybScpO1xuICAgIH1cbiAgfSxcblxuICBfY29uZmlybTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubW9kZWwucmVxdWVzdEV4cG9ydCgpO1xuICB9LFxuXG4gIF9kb3dubG9hZDogZnVuY3Rpb24gKCkge1xuICAgIHdpbmRvdy5vcGVuKHRoaXMubW9kZWwuZ2V0KCd1cmwnKSk7XG4gICAgd2luZG93LmZvY3VzKCk7XG5cbiAgICB0aGlzLmNsb3NlKCk7XG4gIH0sXG5cbiAgX2Fib3J0RXhwb3J0OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tb2RlbC5jYW5jZWxFeHBvcnQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOnN0YXRlJywgZnVuY3Rpb24gKCkgeyB0aGlzLnJlbmRlcigpOyB9LCB0aGlzKTtcbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcblxuLyoqXG4gKiAgQWRkIGNvbHVtbiB2aWV3XG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ0FkZENvbHVtbiBqcy1hZGRGaWVsZCcsXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy1hZGRDb2x1bW4nOiAnX2FkZENvbHVtbicgIFxuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwgPSBuZXcgY2RiLmNvcmUuTW9kZWwoe1xuICAgICAgc3RhdGU6ICdpZGxlJ1xuICAgIH0pO1xuICAgIHRoaXMudGFibGUgPSB0aGlzLm9wdGlvbnMudGFibGU7XG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2ZlYXR1cmVfZGF0YS9hZGRfY29sdW1uL2FkZF9jb2x1bW4nKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLnRlbXBsYXRlKHtcbiAgICAgICAgc3RhdGU6IHRoaXMubW9kZWwuZ2V0KCdzdGF0ZScpXG4gICAgICB9KVxuICAgIClcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpzdGF0ZScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgfSxcblxuICBfYWRkQ29sdW1uOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgLy8gTG9hZGluZ1xuICAgIHRoaXMubW9kZWwuc2V0KCdzdGF0ZScsICdsb2FkaW5nJyk7XG5cbiAgICB0aGlzLnRhYmxlLmFkZENvbHVtbignY29sdW1uXycgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSwgJ3N0cmluZycsIHtcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKG1kbCwgZGF0YSkge1xuICAgICAgICBzZWxmLnRyaWdnZXIoJ25ld0NvbHVtbicsIG1kbCwgdGhpcyk7XG4gICAgICAgIHNlbGYubW9kZWwuc2V0KCdzdGF0ZScsICdpZGxlJyk7XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLm1vZGVsLnNldCgnc3RhdGUnLCAnZXJyb3InKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIEJhc2VEaWFsb2cgPSByZXF1aXJlKCcuLi8uLi92aWV3cy9iYXNlX2RpYWxvZy92aWV3Jyk7XG52YXIgRm9ybVZpZXcgPSByZXF1aXJlKCcuL2Zvcm1fdmlldycpO1xudmFyIFZpZXdGYWN0b3J5ID0gcmVxdWlyZSgnLi4vLi4vdmlld19mYWN0b3J5Jyk7XG52YXIgcmFuZG9tUXVvdGUgPSByZXF1aXJlKCcuLi8uLi92aWV3X2hlbHBlcnMvcmFuZG9tX3F1b3RlJyk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcblxuXG4vKipcbiAqICBGZWF0dXJlIGRhdGEgZWRpdGlvbiBkaWFsb2dcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBCYXNlRGlhbG9nLmV4dGVuZCh7XG5cbiAgZXZlbnRzOiBCYXNlRGlhbG9nLmV4dGVuZEV2ZW50cyh7XG4gICAgJ2NsaWNrIC5qcy1iYWNrJzogJ19zaG93Rm9ybSdcbiAgfSksXG5cbiAgY2xhc3NOYW1lOiAnRGlhbG9nIGlzLW9wZW5pbmcgRmVhdHVyZURhdGEnLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcblxuICAgIGlmICghdGhpcy5vcHRpb25zLnRhYmxlKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCd0YWJsZSBpcyByZXF1aXJlZCcpO1xuICAgIH1cblxuICAgIHRoaXMucm93ID0gdGhpcy5vcHRpb25zLnJvdztcbiAgICB0aGlzLnRhYmxlID0gdGhpcy5vcHRpb25zLnRhYmxlO1xuICAgIHRoaXMuYmFzZUxheWVyID0gdGhpcy5vcHRpb25zLmJhc2VMYXllcjtcbiAgICB0aGlzLmRhdGFMYXllciA9IHRoaXMub3B0aW9ucy5kYXRhTGF5ZXI7XG4gICAgdGhpcy5wcm92aWRlciA9IHRoaXMub3B0aW9ucy5wcm92aWRlcjtcbiAgICB0aGlzLmN1cnJlbnRab29tID0gdGhpcy5vcHRpb25zLmN1cnJlbnRab29tO1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMuX3RlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvZmVhdHVyZV9kYXRhL2ZlYXR1cmVfZGF0YV9kaWFsb2cnKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuICAgIEJhc2VEaWFsb2cucHJvdG90eXBlLnJlbmRlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuJCgnLmNvbnRlbnQnKS5hZGRDbGFzcygnRGlhbG9nLWNvbnRlbnQtLWV4cGFuZGVkJyk7XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl90ZW1wbGF0ZSh7XG4gICAgICBmZWF0dXJlVHlwZTogdGhpcy5yb3cuZ2V0RmVhdHVyZVR5cGUoKSxcbiAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgfSk7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgLy8gUGFuZXNcbiAgICB0aGlzLl9wYW5lcyA9IG5ldyBjZGIudWkuY29tbW9uLlRhYlBhbmUoe1xuICAgICAgZWw6IHRoaXMuJCgnLmpzLWNvbnRlbnQnKVxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIG1hcFxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLl9jcmVhdGVQcmV2aWV3TWFwKClcbiAgICB9LCAyMDApO1xuXG4gICAgLy8gQ3JlYXRlIGZvcm1cbiAgICB0aGlzLmZvcm0gPSBuZXcgRm9ybVZpZXcoe1xuICAgICAgZWw6IHRoaXMuJCgnLmpzLWZvcm0nKSxcbiAgICAgIHRhYmxlOiB0aGlzLnRhYmxlLFxuICAgICAgcm93OiB0aGlzLnJvd1xuICAgIH0pO1xuXG4gICAgdGhpcy5mb3JtLmJpbmQoJ29uU3VibWl0JywgdGhpcy5fY2hhbmdlQXR0cmlidXRlcywgdGhpcyk7XG4gICAgdGhpcy5mb3JtLmJpbmQoJ29uRXJyb3InLCB0aGlzLl9zY3JvbGxUb0Vycm9yLCB0aGlzKTtcbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ2Zvcm0nLCB0aGlzLmZvcm0ucmVuZGVyKCkpO1xuXG4gICAgdGhpcy5hZGRWaWV3KHRoaXMuZm9ybSk7XG5cbiAgICAvLyBDcmVhdGUgbG9hZGluZ1xuICAgIHRoaXMuX3BhbmVzLmFkZFRhYignbG9hZGluZycsXG4gICAgICBWaWV3RmFjdG9yeS5jcmVhdGVCeVRlbXBsYXRlKCdjb21tb24vdGVtcGxhdGVzL2xvYWRpbmcnLCB7XG4gICAgICAgIHRpdGxlOiAnU2F2aW5nIG5ldyBkYXRhLi4uJyxcbiAgICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICAgIH0pLnJlbmRlcigpXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSBlcnJvclxuICAgIHRoaXMuX3BhbmVzLmFkZFRhYignZXJyb3InLFxuICAgICAgVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9mYWlsJywge1xuICAgICAgICBtc2c6ICdTb3JyeSwgc29tZXRoaW5nIHdlbnQgd3JvbmcgYnV0IHlvdSBjYW4gZ2V0IDxidXR0b24gY2xhc3M9XCJCdXR0b24tLWxpbmsganMtYmFja1wiPmJhY2sgdG8gdGhlIGZvcm08L2J1dHRvbj4uJ1xuICAgICAgfSkucmVuZGVyKClcbiAgICApO1xuXG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdmb3JtJyk7XG4gIH0sXG5cbiAgX3Njcm9sbFRvRXJyb3I6IGZ1bmN0aW9uKG1kbCkge1xuICAgIHRoaXMuJCgnLmpzLWNvbnRlbnQnKS5hbmltYXRlKHtcbiAgICAgIHNjcm9sbFRvcDogKCB0aGlzLiQoXCIuRWRpdEZpZWxkLWxhYmVsW3ZhbHVlPSdcIiArIG1kbC5nZXQoJ2F0dHJpYnV0ZScpICsgXCInXVwiKS5wb3NpdGlvbigpLnRvcCAtIDIwIClcbiAgICB9KTtcbiAgfSxcblxuICBfY2hhbmdlQXR0cmlidXRlczogZnVuY3Rpb24oYXR0cnMpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIG5ld0RhdGEgPSBfLm9iamVjdChfLnBsdWNrKGF0dHJzLCAnYXR0cmlidXRlJyksIF8ucGx1Y2soYXR0cnMsICd2YWx1ZScpKTtcbiAgICB2YXIgb2xkRGF0YSA9IHt9O1xuXG4gICAgLy8gQ2hhbmdlIHN0YXRlXG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdsb2FkaW5nJyk7XG5cbiAgICAvLyBVbnNldCBjb2x1bW5zIGFscmVhZHkgbm90IHByZXNlbnQgaW4gdGhlXG4gICAgLy8gbmV3IGZvcm0gZGF0YVxuICAgIF8uZWFjaCh0aGlzLnJvdy5hdHRyaWJ1dGVzLCBmdW5jdGlvbih2YWwsIGtleSkge1xuICAgICAgaWYgKG5ld0RhdGFba2V5XSA9PT0gdW5kZWZpbmVkICYmICFjZGIuYWRtaW4uUm93LmlzUmVzZXJ2ZWRDb2x1bW4oa2V5KSAmJiBrZXkgIT09IFwiaWRcIikge1xuICAgICAgICBzZWxmLnJvdy51bnNldChrZXkpIFxuICAgICAgfVxuICAgICAgb2xkRGF0YVtrZXldID0gdmFsO1xuICAgIH0pO1xuXG4gICAgaWYgKCFfLmlzRW1wdHkodGhpcy5yb3cuY2hhbmdlZEF0dHJpYnV0ZXMobmV3RGF0YSkpKSB7XG4gICAgICAvLyBTYXZlIG5ldyBhdHRyaWJ1dGVzXG4gICAgICB0aGlzLnJvdy5zYXZlKG5ld0RhdGEsIHtcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgc2VsZi5fb2soKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNlbGYucm93LnNldChvbGREYXRhKTtcbiAgICAgICAgICBzZWxmLl9wYW5lcy5hY3RpdmUoJ2Vycm9yJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLl9jYW5jZWwoKTtcbiAgICB9XG4gIH0sXG5cbiAgX2NyZWF0ZVByZXZpZXdNYXA6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8vIENyZWF0ZSBtYXBcbiAgICB2YXIgZGl2ID0gdGhpcy4kKCcuanMtbWFwJyk7XG5cbiAgICB2YXIgbWFwVmlld0NsYXNzID0gY2RiLmFkbWluLkxlYWZsZXRNYXBWaWV3O1xuICAgIGlmICh0aGlzLnByb3ZpZGVyID09PSAnZ29vZ2xlbWFwcycpIHtcbiAgICAgIHZhciBtYXBWaWV3Q2xhc3MgPSBjZGIuYWRtaW4uR29vZ2xlTWFwc01hcFZpZXc7XG4gICAgfVxuXG4gICAgLy8gTmV3IG1hcFxuICAgIHRoaXMubWFwID0gbmV3IGNkYi5hZG1pbi5NYXAoKTtcblxuICAgIHRoaXMubWFwVmlldyA9IG5ldyBtYXBWaWV3Q2xhc3Moe1xuICAgICAgZWw6IGRpdixcbiAgICAgIG1hcDogdGhpcy5tYXAsXG4gICAgICB1c2VyOiB0aGlzLnVzZXJcbiAgICB9KTtcblxuICAgIC8vIEJhc2UgbGF5ZXJcbiAgICB0aGlzLmJhc2VMYXllci5zZXQoJ2F0dHJpYnV0aW9uJywgJycpO1xuICAgIHRoaXMubWFwLmFkZExheWVyKHRoaXMuYmFzZUxheWVyKTtcblxuICAgIC8vIERhdGEgbGF5ZXJcbiAgICB0aGlzLmRhdGFMYXllci5zZXQoJ3F1ZXJ5JywgJ1NFTEVDVCAqIEZST00gJyArIHRoaXMudGFibGUuZ2V0KCduYW1lJykgKyAnIFdIRVJFIGNhcnRvZGJfaWQ9JyArIHRoaXMucm93LmdldCgnY2FydG9kYl9pZCcpKTtcbiAgICB0aGlzLmRhdGFMYXllci5zZXQoJ2F0dHJpYnV0aW9uJywgJycpO1xuICAgIHRoaXMubWFwLmFkZExheWVyKHRoaXMuZGF0YUxheWVyKTtcblxuICAgIC8vIFNldCBib3VuZHNcbiAgICB2YXIgc3FsID0gbmV3IGNkYi5hZG1pbi5TUUwoe1xuICAgICAgdXNlcjogdGhpcy51c2VyLmdldCgndXNlcm5hbWUnKSxcbiAgICAgIGFwaV9rZXk6IHRoaXMudXNlci5nZXQoJ2FwaV9rZXknKVxuICAgIH0pO1xuICAgIHNxbC5nZXRCb3VuZHMoJ1NFTEVDVCAqIEZST00gJyArIHRoaXMudGFibGUuZ2V0KCduYW1lJykgKyAnIFdIRVJFIGNhcnRvZGJfaWQ9JyArIHRoaXMucm93LmdldCgnY2FydG9kYl9pZCcpKS5kb25lKGZ1bmN0aW9uKHIpIHtcbiAgICAgIGlmIChyKSB7XG4gICAgICAgIGlmIChyWzBdWzBdID09PSByWzFdWzBdICYmIHJbMF1bMV0gPT09IHJbMV1bMV0pIHtcbiAgICAgICAgICAvLyBQb2ludCBnZW9tZXRyeVxuICAgICAgICAgIHNlbGYubWFwLnNldENlbnRlcihyWzBdKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBSZXN0IG9mIGdlb21ldHJpZXNcbiAgICAgICAgICBzZWxmLm1hcC5zZXRCb3VuZHMocik7XG4gICAgICAgIH1cbiAgICAgICAgc2VsZi5tYXAuc2V0Wm9vbShzZWxmLmN1cnJlbnRab29tKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBfc2hvd0Zvcm06IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3BhbmVzLmFjdGl2ZSgnZm9ybScpO1xuICB9LFxuXG4gIF9vazogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5vcHRpb25zLm9uRG9uZSAmJiB0aGlzLm9wdGlvbnMub25Eb25lKCk7XG4gICAgdGhpcy5lbGRlcignX29rJyk7XG4gIH0sXG5cbiAgX2NhbmNlbDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbGRlcignX2NhbmNlbCcpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcblxuLyoqXG4gKiAgQ29sbGVjdGlvbiB3aXRoIGFsbCBmaWVsZHMgbW9kZWxcbiAqICBpbmNsdWRlZC5cbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7XG5cbiAgaXNWYWxpZDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICF0aGlzLmdldEludmFsaWQoKTtcbiAgfSxcblxuICBnZXRJbnZhbGlkOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5maW5kKGZ1bmN0aW9uKG1kbCkge1xuICAgICAgcmV0dXJuICFtZGwuaXNWYWxpZCgpXG4gICAgfSk7XG4gIH1cblxufSkiLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBTdHJpbmdGaWVsZFZpZXcgPSByZXF1aXJlKCcuLi8uLi8uLi9lZGl0X2ZpZWxkcy9zdHJpbmdfZmllbGQvc3RyaW5nX2ZpZWxkX3ZpZXcnKTtcbnZhciBOdW1iZXJGaWVsZFZpZXcgPSByZXF1aXJlKCcuLi8uLi8uLi9lZGl0X2ZpZWxkcy9udW1iZXJfZmllbGQvbnVtYmVyX2ZpZWxkX3ZpZXcnKTtcbnZhciBCb29sZWFuRmllbGRWaWV3ID0gcmVxdWlyZSgnLi4vLi4vLi4vZWRpdF9maWVsZHMvYm9vbGVhbl9maWVsZC9ib29sZWFuX2ZpZWxkX3ZpZXcnKTtcbnZhciBEYXRlRmllbGRWaWV3ID0gcmVxdWlyZSgnLi4vLi4vLi4vZWRpdF9maWVsZHMvZGF0ZV9maWVsZC9kYXRlX2ZpZWxkX3ZpZXcnKTtcblxuLyoqXG4gKiAgRm9ybSBmaWVsZCB2aWV3IGZvciBlZGl0IGZlYXR1cmUgbWV0YWRhdGFcbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgZXZlbnRzOiB7XG4gICAgJ2tleWRvd24gLmpzLWNvbHVtbk5hbWUnOiAnX29uSW5wdXRDaGFuZ2UnLFxuICAgICdmb2N1c291dCAuanMtY29sdW1uTmFtZSc6ICdfb25Db2xOYW1lQ2hhbmdlJyxcbiAgfSxcblxuICBfRklFTERfVklFVzoge1xuICAgICdzdHJpbmcnOiBTdHJpbmdGaWVsZFZpZXcsXG4gICAgJ251bWJlcic6IE51bWJlckZpZWxkVmlldyxcbiAgICAnYm9vbGVhbic6IEJvb2xlYW5GaWVsZFZpZXcsXG4gICAgJ2RhdGUnOiBEYXRlRmllbGRWaWV3LFxuICAgICd0aW1lc3RhbXAgd2l0aCB0aW1lIHpvbmUnOiBEYXRlRmllbGRWaWV3LFxuICAgICd0aW1lc3RhbXAgd2l0aG91dCB0aW1lIHpvbmUnOiBEYXRlRmllbGRWaWV3XG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbCA9IG5ldyBjZGIuY29yZS5Nb2RlbCh7XG4gICAgICBjb2x1bW5FcnJvcjogJycsXG4gICAgICB0eXBlRXJyb3I6ICcnLFxuICAgICAgZmllbGRFcnJvcjogJydcbiAgICB9KTtcbiAgICB0aGlzLnRhYmxlID0gdGhpcy5vcHRpb25zLnRhYmxlO1xuICAgIHRoaXMucm93ID0gdGhpcy5vcHRpb25zLnJvdztcbiAgICB0aGlzLmZpZWxkTW9kZWwgPSB0aGlzLm9wdGlvbnMuZmllbGRNb2RlbDtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvZmVhdHVyZV9kYXRhL2Zvcm1fZmllbGQvZm9ybV9maWVsZCcpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIHRoaXMudGVtcGxhdGUoe1xuICAgICAgICB0eXBlOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCd0eXBlJyksXG4gICAgICAgIHZhbHVlOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCd2YWx1ZScpLFxuICAgICAgICBhdHRyaWJ1dGU6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2F0dHJpYnV0ZScpLFxuICAgICAgICByZWFkT25seTogdGhpcy5maWVsZE1vZGVsLmdldCgncmVhZE9ubHknKSxcbiAgICAgICAgdHlwZUVycm9yOiB0aGlzLm1vZGVsLmdldCgndHlwZUVycm9yJyksXG4gICAgICAgIGNvbHVtbkVycm9yOiB0aGlzLm1vZGVsLmdldCgnY29sdW1uRXJyb3InKVxuICAgICAgfSlcbiAgICApO1xuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZmllbGRNb2RlbC5iaW5kKCdjaGFuZ2U6cmVhZE9ubHknLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5maWVsZE1vZGVsLmJpbmQoJ2NoYW5nZTp0eXBlJywgdGhpcy5fb25UeXBlQ2hhbmdlZCwgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbCh0aGlzLmZpZWxkTW9kZWwpO1xuICB9LFxuXG4gIF9pbml0Vmlld3M6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8vIEZpZWxkIHZpZXdcbiAgICB2YXIgZWRpdG9yRmllbGQgPSB0aGlzLl9GSUVMRF9WSUVXW3RoaXMuZmllbGRNb2RlbC5nZXQoJ3R5cGUnKV0gfHwgdGhpcy5fRklFTERfVklFV1snc3RyaW5nJ107XG4gICAgdmFyIHYgPSBuZXcgZWRpdG9yRmllbGQoe1xuICAgICAgcmVhZE9ubHk6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3JlYWRPbmx5JyksXG4gICAgICBtb2RlbDogdGhpcy5maWVsZE1vZGVsXG4gICAgfSkuYmluZCgnb25TdWJtaXQnLCBmdW5jdGlvbihlKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ29uU3VibWl0Jyk7XG4gICAgfSwgdGhpcyk7XG5cbiAgICB0aGlzLiQoJy5qcy1lZGl0RmllbGQnKS5hcHBlbmQodi5yZW5kZXIoKS5lbCk7XG4gICAgdGhpcy5hZGRWaWV3KHYpO1xuXG4gICAgLy8gRmllbGQgdG9vbHRpcFxuICAgIHZhciBmaWVsZFRvb2x0aXAgPSBuZXcgY2RiLmNvbW1vbi5UaXBzeVRvb2x0aXAoe1xuICAgICAgZWw6IHRoaXMuJCgnLmpzLWVkaXRGaWVsZCcpLFxuICAgICAgdGl0bGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gc2VsZi5maWVsZE1vZGVsLmdldEVycm9yKClcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcoZmllbGRUb29sdGlwKTtcblxuICAgIC8vIENvbHVtbiB0eXBlIGNvbWJvXG4gICAgLy8gQ3VycmVudCB2YWx1ZSBoYXMgdG8gYmUgYXZhaWxhYmxlIGluIHRoZSBleHRyYSBhcnJheSxcbiAgICAvLyBpZiBub3Qgc2VsZWN0IHdpbGwgcGxhY2UgZmlyc3QgaXRlbSBhcyB2YWx1ZVxuICAgIHZhciB0eXBlcyA9IFt0aGlzLmZpZWxkTW9kZWwuZ2V0KCd0eXBlJyldLmNvbmNhdChfLmZpbHRlcihbJ3N0cmluZycsICdib29sZWFuJywgJ251bWJlcicsICdkYXRlJ10sIGZ1bmN0aW9uKHR5cGUpe1xuICAgICAgcmV0dXJuIHNlbGYudGFibGUuaXNUeXBlQ2hhbmdlQWxsb3dlZChzZWxmLmZpZWxkTW9kZWwuZ2V0KCdhdHRyaWJ1dGUnKSwgdHlwZSlcbiAgICB9KSk7XG4gICAgdmFyIGNvbWJvID0gbmV3IGNkYi5mb3Jtcy5Db21ibyh7XG4gICAgICBlbDogdGhpcy4kKCcuanMtZmllbGRUeXBlJyksXG4gICAgICBtb2RlbDogdGhpcy5maWVsZE1vZGVsLFxuICAgICAgcHJvcGVydHk6ICd0eXBlJyxcbiAgICAgIGRpc2FibGVkOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdyZWFkT25seScpLFxuICAgICAgd2lkdGg6ICc4NXB4JyxcbiAgICAgIGV4dHJhOiB0eXBlc1xuICAgIH0pO1xuXG4gICAgdGhpcy4kKFwiLmpzLWZpZWxkVHlwZVwiKS5hcHBlbmQoY29tYm8ucmVuZGVyKCkpO1xuICAgIGNvbWJvLmJpbmQoJ2NoYW5nZScsIGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgIHRoaXMuZmllbGRNb2RlbC5zZXQoe1xuICAgICAgICB2YWx1ZTogbnVsbCxcbiAgICAgICAgdHlwZTogdHlwZVxuICAgICAgfSlcbiAgICB9LCB0aGlzKTtcbiAgICB0aGlzLmFkZFZpZXcoY29tYm8pO1xuXG4gICAgLy8gQ29sdW1uIHR5cGUgdG9vbHRpcFxuICAgIHZhciB0eXBlVG9vbHRpcCA9IG5ldyBjZGIuY29tbW9uLlRpcHN5VG9vbHRpcCh7XG4gICAgICBlbDogdGhpcy4kKCcuanMtZmllbGRUeXBlJyksXG4gICAgICB0aXRsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBzZWxmLm1vZGVsLmdldCgndHlwZUVycm9yJylcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodHlwZVRvb2x0aXApO1xuXG4gICAgLy8gQ29sdW1uIG5hbWUgdG9vbHRpcFxuICAgIHZhciB0eXBlVG9vbHRpcCA9IG5ldyBjZGIuY29tbW9uLlRpcHN5VG9vbHRpcCh7XG4gICAgICBlbDogdGhpcy4kKCcuanMtY29sdW1uTmFtZScpLFxuICAgICAgdGl0bGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gc2VsZi5tb2RlbC5nZXQoJ2NvbHVtbkVycm9yJyk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5hZGRWaWV3KHR5cGVUb29sdGlwKTtcbiAgfSxcblxuICBfb25UeXBlQ2hhbmdlZDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBwcmV2aW91c1R5cGUgPSB0aGlzLmZpZWxkTW9kZWwucHJldmlvdXMoJ3R5cGUnKTtcbiAgICB2YXIgcHJldmlvdXNWYWx1ZSA9IHRoaXMuZmllbGRNb2RlbC5wcmV2aW91cygndmFsdWUnKTtcblxuICAgIHRoaXMubW9kZWwuc2V0KCd0eXBlRXJyb3InLCAnJyk7XG5cbiAgICAvLyBSZWFkb25seSBldmVyeXRoaW5nXG4gICAgdGhpcy5maWVsZE1vZGVsLnNldCgncmVhZE9ubHknLCB0cnVlKTtcblxuICAgIHRoaXMudGFibGUuY2hhbmdlQ29sdW1uVHlwZSh0aGlzLmZpZWxkTW9kZWwuZ2V0KCdhdHRyaWJ1dGUnKSwgdGhpcy5maWVsZE1vZGVsLmdldCgndHlwZScpLCB7XG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gcmVmcmVzaCByZWNvcmQgZGF0YSBhZnRlciBjaGFuZ2VcbiAgICAgICAgLy8gcmVhZE9ubHkgdG8gZmFsc2VcbiAgICAgICAgc2VsZi5fcmVmcmVzaFJlY29yZERhdGEoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgc2VsZi5maWVsZE1vZGVsLnNldCgncmVhZE9ubHknLCBmYWxzZSk7XG4gICAgICAgIH0pXG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBBdm9pZGluZyBzaWxlbnQ6dHJ1ZSBhbmQgdGhlIGV2ZW50IHRyaWdnZXJcbiAgICAgICAgLy8gd2hlbiBvdGhlciBhdHRyaWJ1dGUgaXMgY2hhbmdlZFxuICAgICAgICBzZWxmLmZpZWxkTW9kZWwuYXR0cmlidXRlcy5yZWFkT25seSA9IGZhbHNlO1xuICAgICAgICBzZWxmLmZpZWxkTW9kZWwuYXR0cmlidXRlcy52YWx1ZSA9IHByZXZpb3VzVmFsdWU7XG4gICAgICAgIHNlbGYuZmllbGRNb2RlbC5hdHRyaWJ1dGVzLnR5cGUgPSBwcmV2aW91c1R5cGU7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgbXNnID0gSlNPTi5wYXJzZShlLnJlc3BvbnNlVGV4dCkuZXJyb3JzWzBdO1xuICAgICAgICAgIHNlbGYubW9kZWwuc2V0KCd0eXBlRXJyb3InLCBtc2cpO1xuICAgICAgICB9IGNhdGNoIChlKSB7fVxuICAgICAgICBzZWxmLnJlbmRlcigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIF9vbklucHV0Q2hhbmdlOiBmdW5jdGlvbihldikge1xuICAgIGlmIChldi5rZXlDb2RlID09PSAxMykge1xuICAgICAgJChldi50YXJnZXQpLmJsdXIoKTtcbiAgICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICB9XG4gIH0sXG5cbiAgX29uQ29sTmFtZUNoYW5nZTogZnVuY3Rpb24oZXYpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHZhbCA9ICQoZXYudGFyZ2V0KS52YWwoKTtcbiAgICB2YXIgb2xkVmFsID0gdGhpcy5maWVsZE1vZGVsLmdldCgnYXR0cmlidXRlJyk7XG4gICAgXG4gICAgaWYgKG9sZFZhbCAhPT0gdmFsKSB7XG4gICAgICB0aGlzLmZpZWxkTW9kZWwuc2V0KHtcbiAgICAgICAgYXR0cmlidXRlOiB2YWwsXG4gICAgICAgIHJlYWRPbmx5OiB0cnVlXG4gICAgICB9KTtcblxuICAgICAgdGhpcy50YWJsZS5yZW5hbWVDb2x1bW4ob2xkVmFsLCB2YWwsIHtcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24obWRsLCBkYXRhKSB7XG4gICAgICAgICAgc2VsZi5tb2RlbC5zZXQoJ2NvbHVtbkVycm9yJywgJycpO1xuICAgICAgICAgIHNlbGYuZmllbGRNb2RlbC5zZXQoe1xuICAgICAgICAgICAgYXR0cmlidXRlOiBkYXRhLm5hbWUsXG4gICAgICAgICAgICByZWFkT25seTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKG1kbCwgZXJyKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBtc2cgPSBKU09OLnBhcnNlKGVyci5yZXNwb25zZVRleHQpLmVycm9yc1swXTtcbiAgICAgICAgICAgIHNlbGYubW9kZWwuc2V0KCdjb2x1bW5FcnJvcicsIG1zZyk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge31cbiAgICAgICAgICBzZWxmLmZpZWxkTW9kZWwuc2V0KHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZTogb2xkVmFsLFxuICAgICAgICAgICAgcmVhZE9ubHk6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBfcmVmcmVzaFJlY29yZERhdGE6IGZ1bmN0aW9uKG9uQ29tcGxldGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB0aGlzLnJvdy5mZXRjaCh7XG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihyKSB7XG4gICAgICAgIHZhciBuZXdWYWx1ZSA9IHIgJiYgci5yb3dzWzBdICYmIHIucm93c1swXVtzZWxmLmZpZWxkTW9kZWwuZ2V0KCdhdHRyaWJ1dGUnKV07XG4gICAgICAgIHNlbGYuZmllbGRNb2RlbC5zZXQoJ3ZhbHVlJywgbmV3VmFsdWUpO1xuICAgICAgICBvbkNvbXBsZXRlICYmIG9uQ29tcGxldGUoKTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZSgpO1xuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIFxufSk7IiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgRm9ybUZpZWxkVmlldyA9IHJlcXVpcmUoJy4vZm9ybV9maWVsZC9mb3JtX2ZpZWxkX3ZpZXcnKTtcbnZhciBBZGRDb2x1bW5WaWV3ID0gcmVxdWlyZSgnLi9hZGRfY29sdW1uL2FkZF9jb2x1bW5fdmlldycpO1xudmFyIEVkaXRGaWVsZE1vZGVsID0gcmVxdWlyZSgnLi4vLi4vZWRpdF9maWVsZHMvZWRpdF9maWVsZF9tb2RlbCcpO1xudmFyIEZvcm1Db2xsZWN0aW9uID0gcmVxdWlyZSgnLi9mb3JtX2NvbGxlY3Rpb24nKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xuXG4vKipcbiAqICBGb3JtIHZpZXcgZm9yIGVkaXQgZmVhdHVyZSBtZXRhZGF0YVxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2sgLmpzLXN1Ym1pdCc6ICdfb25TdWJtaXQnLFxuICAgICdzdWJtaXQnOiAnX29uU3VibWl0J1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwgPSBuZXcgY2RiLmNvcmUuTW9kZWwoeyBzdGF0ZTogJ2lkbGUnIH0pO1xuICAgIHRoaXMudGFibGUgPSB0aGlzLm9wdGlvbnMudGFibGU7XG4gICAgdGhpcy5yb3cgPSB0aGlzLm9wdGlvbnMucm93O1xuICAgIHRoaXMuY29sbGVjdGlvbiA9IG5ldyBGb3JtQ29sbGVjdGlvbigpO1xuICAgIHRoaXMuX2dlbmVyYXRlQ29sbGVjdGlvbigpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy5fbmV3Q29sdW1uKCk7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmVhY2godGhpcy5fcmVuZGVyRmllbGQsIHRoaXMpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9nZW5lcmF0ZUNvbGxlY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgdGFibGVTY2hlbWEgPSB0aGlzLnRhYmxlLmdldCgnc2NoZW1hJyk7XG4gICAgdmFyIGhpZGRlbkNvbHVtbnMgPSB0aGlzLnRhYmxlLmhpZGRlbkNvbHVtbnM7XG5cbiAgICBfLmVhY2godGFibGVTY2hlbWEsIGZ1bmN0aW9uKHBhaXIpIHtcbiAgICAgIGlmICghXy5jb250YWlucyhoaWRkZW5Db2x1bW5zLCBwYWlyWzBdKSkge1xuICAgICAgICB2YXIgbWRsID0gc2VsZi5fZ2VuZXJhdGVNb2RlbChwYWlyWzBdLCBwYWlyWzFdLCBzZWxmLnJvdy5nZXQocGFpclswXSkpO1xuICAgICAgICBzZWxmLmNvbGxlY3Rpb24uYWRkKG1kbCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgX2dlbmVyYXRlTW9kZWw6IGZ1bmN0aW9uKGNvbHVtbiwgdHlwZSwgdmFsdWUpIHtcbiAgICByZXR1cm4gbmV3IEVkaXRGaWVsZE1vZGVsKHtcbiAgICAgIGF0dHJpYnV0ZTogY29sdW1uLFxuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgdHlwZTogdHlwZVxuICAgIH0pO1xuICB9LFxuXG4gIF9yZW5kZXJGaWVsZDogZnVuY3Rpb24obWRsKSB7XG4gICAgdmFyIHYgPSBuZXcgRm9ybUZpZWxkVmlldyh7XG4gICAgICBmaWVsZE1vZGVsOiBtZGwsXG4gICAgICB0YWJsZTogdGhpcy50YWJsZSxcbiAgICAgIHJvdzogdGhpcy5yb3dcbiAgICB9KTtcbiAgICB0aGlzLiQoJy5qcy1hZGRGaWVsZCcpLmJlZm9yZSh2LnJlbmRlcigpLmVsKTtcbiAgICB2LmJpbmQoJ29uU3VibWl0JywgdGhpcy5fb25TdWJtaXQsIHRoaXMpO1xuICAgIHRoaXMuYWRkVmlldyh2KTtcbiAgfSxcblxuICBfbmV3Q29sdW1uOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbmV3Q29sdW1uID0gbmV3IEFkZENvbHVtblZpZXcoeyB0YWJsZTogdGhpcy50YWJsZSB9KTtcbiAgICBuZXdDb2x1bW4uYmluZCgnbmV3Q29sdW1uJywgZnVuY3Rpb24oZCl7XG4gICAgICAvLyBhZGQgaXQgdG8gdGhlIGZvcm1cbiAgICAgIHZhciBtZGwgPSB0aGlzLl9nZW5lcmF0ZU1vZGVsKGQuZ2V0KCdfbmFtZScpLCBkLmdldCgndHlwZScpLCBudWxsKTtcbiAgICAgIHRoaXMuY29sbGVjdGlvbi5hZGQobWRsKTtcbiAgICAgIHRoaXMuX3JlbmRlckZpZWxkKG1kbCk7XG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy5hZGRWaWV3KG5ld0NvbHVtbik7XG4gICAgdGhpcy4kZWwuYXBwZW5kKG5ld0NvbHVtbi5yZW5kZXIoKS5lbCk7XG4gIH0sXG5cbiAgX29uU3VibWl0OiBmdW5jdGlvbihldikge1xuICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiBhbGwgbW9kZWxzIGFyZSB2YWxpZCwgaWYgc29cbiAgICAvLyBsZXQncyBnbyBteSBidWRkeSFcbiAgICB2YXIgaW52YWxpZCA9IHRoaXMuY29sbGVjdGlvbi5nZXRJbnZhbGlkKCk7XG4gICAgaWYgKCFpbnZhbGlkKSB7XG4gICAgICB2YXIgYXR0cnMgPSB0aGlzLmNvbGxlY3Rpb24udG9KU09OKCk7XG4gICAgICB0aGlzLnRyaWdnZXIoJ29uU3VibWl0JywgYXR0cnMsIHRoaXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ29uRXJyb3InLCBpbnZhbGlkLCB0aGlzKTtcbiAgICB9XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBCYWNrYm9uZSA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydCYWNrYm9uZSddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnQmFja2JvbmUnXSA6IG51bGwpO1xudmFyIFN0ZXBzVmlldyA9IHJlcXVpcmUoJy4vc3RlcHNfdmlldycpO1xudmFyIFJvd01vZGVsID0gcmVxdWlyZSgnLi9yb3dfbW9kZWwnKTtcbnZhciBEZWZhdWx0Rm9vdGVyVmlldyA9IHJlcXVpcmUoJy4vZGVmYXVsdF9mb290ZXJfdmlldycpO1xudmFyIFZpZXdGYWN0b3J5ID0gcmVxdWlyZSgnLi4vLi4vdmlld19mYWN0b3J5Jyk7XG5cbi8qKlxuICogTW9kZWwgZm9yIHRoZSBhZG1pbmlzdHJhdGl2ZSByZWdpb25zIGdlb3JlZmVyZW5jZSBvcHRpb24uXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBUQUJfTEFCRUw6ICdBZG1pbi4gUmVnaW9ucycsXG4gIEtJTkQ6ICdhZG1pbjEnLFxuXG4gIGRlZmF1bHRzOiB7XG4gICAgc3RlcDogMCxcbiAgICBjb2x1bW5zOiBbXVxuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKGF0dHJzKSB7XG4gICAgaWYgKCFhdHRycy5nZW9jb2RlU3R1ZmYpIHRocm93IG5ldyBFcnJvcignZ2VvY29kZVN0dWZmIGlzIHJlcXVpcmVkJyk7XG4gICAgaWYgKCFhdHRycy5jb2x1bW5zTmFtZXMpIHRocm93IG5ldyBFcnJvcignY29sdW1uc05hbWVzIGlzIHJlcXVpcmVkJyk7XG4gICAgaWYgKCFhdHRycy5jb2x1bW5zKSB0aHJvdyBuZXcgRXJyb3IoJ2NvbHVtbnMgaXMgcmVxdWlyZWQnKTtcbiAgfSxcblxuICBjcmVhdGVWaWV3OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9pbml0Um93cygpO1xuICAgIHRoaXMuX3NldFN0YXRlRm9yRmlyc3RTdGVwKCk7XG5cbiAgICByZXR1cm4gVmlld0ZhY3RvcnkuY3JlYXRlQnlMaXN0KFtcbiAgICAgIG5ldyBTdGVwc1ZpZXcoe1xuICAgICAgICB0aXRsZTogJ1NlbGVjdCB0aGUgY29sdW1uIHRoYXQgaGFzIEFkbWluaXN0cmF0aXZlIFJlZ2lvbnMnLFxuICAgICAgICBkZXNjOiBcIkdlb3JlZmVyZW5jZSB5b3VyIGRhdGEgYnkgY291bnRyeSwgc3RhdGUsIHByb3ZpbmNlIG9yIG11bmljaXBhbGl0eVwiLFxuICAgICAgICBtb2RlbDogdGhpc1xuICAgICAgfSksXG4gICAgICBuZXcgRGVmYXVsdEZvb3RlclZpZXcoe1xuICAgICAgICBtb2RlbDogdGhpc1xuICAgICAgfSlcbiAgICBdKTtcbiAgfSxcblxuICBhc3NlcnRJZkNhbkNvbnRpbnVlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLmdldCgnc3RlcCcpID09PSAwID8gdGhpcy5fY29sdW1uTmFtZVZhbHVlKCkgOiB0aGlzLmdldCgnZ2VvbWV0cnlUeXBlJyk7XG4gICAgdGhpcy5zZXQoJ2NhbkNvbnRpbnVlJywgISF2YWx1ZSk7XG4gIH0sXG5cbiAgY29udGludWU6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLmdldCgnc3RlcCcpID09PSAwKSB7XG4gICAgICB0aGlzLl9zZXRTdGF0ZUZvclNlY29uZFN0ZXAoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZ2VvY29kZSgpO1xuICAgIH1cbiAgfSxcblxuICBnb0JhY2s6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3NldFN0YXRlRm9yRmlyc3RTdGVwKCk7XG4gIH0sXG5cbiAgYXZhaWxhYmxlR2VvbWV0cmllc0ZldGNoRGF0YTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdnZW9jb2RlU3R1ZmYnKS5hdmFpbGFibGVHZW9tZXRyaWVzRmV0Y2hEYXRhKHRoaXMuS0lORCwgdGhpcy5fbG9jYXRpb25WYWx1ZSgpLCB0aGlzLl9pc0xvY2F0aW9uRnJlZVRleHQoKSk7XG4gIH0sXG5cbiAgX3NldFN0YXRlRm9yRmlyc3RTdGVwOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldCh7XG4gICAgICBzdGVwOiAwLFxuICAgICAgY2FuR29CYWNrOiBmYWxzZSxcbiAgICAgIGNhbkNvbnRpbnVlOiBmYWxzZSxcbiAgICAgIGhpZGVGb290ZXI6IGZhbHNlXG4gICAgfSk7XG4gICAgdGhpcy5nZXQoJ3Jvd3MnKS5pbnZva2UoJ3Vuc2V0JywgJ3ZhbHVlJyk7XG4gIH0sXG5cbiAgX3NldFN0YXRlRm9yU2Vjb25kU3RlcDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgc3RlcDogMSxcbiAgICAgIGNhbkdvQmFjazogdHJ1ZSxcbiAgICAgIGNhbkNvbnRpbnVlOiBmYWxzZSxcbiAgICAgIGhpZGVGb290ZXI6IHRydWUsXG4gICAgICBnZW9tZXRyeVR5cGU6ICcnXG4gICAgfSk7XG4gIH0sXG5cbiAgX2luaXRSb3dzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcm93cyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKFtcbiAgICAgIG5ldyBSb3dNb2RlbCh7XG4gICAgICAgIGNvbWJvVmlld0NsYXNzOiAnQ29tYm8nLFxuICAgICAgICBsYWJlbDogJ1NlbGVjdCBZb3VyIFJlZ2lvbiBOYW1lJyxcbiAgICAgICAgcGxhY2Vob2xkZXI6ICdTZWxlY3QgY29sdW1uJyxcbiAgICAgICAgZGF0YTogdGhpcy5nZXQoJ2NvbHVtbnNOYW1lcycpXG4gICAgICB9KSxcbiAgICAgIG5ldyBSb3dNb2RlbCh7XG4gICAgICAgIGxhYmVsOiBcIlNlbGVjdCBZb3VyIENvdW50cnkgRGF0YVwiLFxuICAgICAgICBkYXRhOiB0aGlzLmdldCgnY29sdW1ucycpXG4gICAgICB9KVxuICAgIF0pO1xuICAgIHRoaXMuc2V0KCdyb3dzJywgcm93cyk7XG4gIH0sXG5cbiAgX2dlb2NvZGU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBnZW9jb2RlU3R1ZmYgPSB0aGlzLmdldCgnZ2VvY29kZVN0dWZmJyk7XG4gICAgdmFyIGxvY2F0aW9uVmFsdWUgPSB0aGlzLl9sb2NhdGlvblZhbHVlKCk7XG4gICAgdmFyIGlzTG9jYXRpb25GcmVlVGV4dCA9IHRoaXMuX2lzTG9jYXRpb25GcmVlVGV4dCgpO1xuXG4gICAgdmFyIGQgPSBnZW9jb2RlU3R1ZmYuZ2VvY29kaW5nQ2hvc2VuRGF0YSh7XG4gICAgICB0eXBlOiAnYWRtaW4nLFxuICAgICAga2luZDogZ2VvY29kZVN0dWZmLmlzTG9jYXRpb25Xb3JsZChsb2NhdGlvblZhbHVlLCBpc0xvY2F0aW9uRnJlZVRleHQsIHRydWUpID8gJ2FkbWluMCcgOiB0aGlzLktJTkQsIC8vIG1pZ3JhdGVkIGZyb20gb2xkIGNvZGUsIHVuY2xlYXIgd2h5IHRoaXMgaXMgbmVlZGVkXG4gICAgICBsb2NhdGlvbjogbG9jYXRpb25WYWx1ZSxcbiAgICAgIGNvbHVtbl9uYW1lOiB0aGlzLl9jb2x1bW5OYW1lVmFsdWUoKSxcbiAgICAgIGdlb21ldHJ5X3R5cGU6IHRoaXMuZ2V0KCdnZW9tZXRyeVR5cGUnKVxuICAgIH0sIGlzTG9jYXRpb25GcmVlVGV4dCwgdHJ1ZSk7XG5cbiAgICB0aGlzLnNldCgnZ2VvY29kZURhdGEnLCBkKTtcbiAgfSxcblxuICBfY29sdW1uTmFtZVZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3Jvd3MnKS5maXJzdCgpLmdldCgndmFsdWUnKTtcbiAgfSxcblxuICBfbG9jYXRpb25WYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xvY2F0aW9uKCkuZ2V0KCd2YWx1ZScpO1xuICB9LFxuXG4gIF9pc0xvY2F0aW9uRnJlZVRleHQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9sb2NhdGlvbigpLmdldCgnaXNGcmVlVGV4dCcpO1xuICB9LFxuXG4gIF9sb2NhdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdyb3dzJykubGFzdCgpO1xuICB9XG5cbn0pO1xuIiwidmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIEdlb21ldHJ5SXRlbVZpZXcgPSByZXF1aXJlKCcuL2dlb21ldHJ5X2l0ZW1fdmlldycpO1xudmFyIFZpZXdGYWN0b3J5ID0gcmVxdWlyZSgnLi4vLi4vdmlld19mYWN0b3J5Jyk7XG52YXIgcmFuZG9tUXVvdGUgPSByZXF1aXJlKCcuLi8uLi92aWV3X2hlbHBlcnMvcmFuZG9tX3F1b3RlJyk7XG5cbi8qKlxuICogVmlldyB0byBzZWxlY3Qgd2hpY2ggZ2VvbWV0cnkgdHlwZSB0byB1c2UgZm9yIGdlb3JlZmVyZW5jZSBwcm9jZXNzLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmF2YWlsYWJsZUdlb21ldHJpZXMgPSBuZXcgY2RiLmFkbWluLkdlb2NvZGluZ3MuQXZhaWxhYmxlR2VvbWV0cmllcygpO1xuXG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gICAgdGhpcy5fZmV0Y2hBdmFpbGFibGVHZW9tZXRyaWVzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGhpcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL2Nob29zZV9nZW9tZXRyeScpKClcbiAgICApO1xuICAgIF8uZWFjaChcbiAgICAgIHRoaXMuYXZhaWxhYmxlR2VvbWV0cmllcy5nZXQoJ2F2YWlsYWJsZV9nZW9tZXRyaWVzJykgPyB0aGlzLl9jcmVhdGVJdGVtc1ZpZXdzKCkgOiBbdGhpcy5fY3JlYXRlTG9hZGluZ1ZpZXcoKV0sXG4gICAgICB0aGlzLl9hcHBlbmRWaWV3LCB0aGlzXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfYXBwZW5kVmlldzogZnVuY3Rpb24odmlldykge1xuICAgIHRoaXMuYWRkVmlldyh2aWV3KTtcbiAgICB0aGlzLiQoJy5qcy1pdGVtcycpLmFwcGVuZCh2aWV3LnJlbmRlcigpLmVsKTtcbiAgfSxcblxuICBfY3JlYXRlSXRlbXNWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHRoaXMuX2NyZWF0ZUl0ZW1WaWV3KHtcbiAgICAgICAgdHlwZTogJ3BvaW50JyxcbiAgICAgICAgdGl0bGVzOiB7XG4gICAgICAgICAgYXZhaWxhYmxlOiAnR2VvcmVmZXJlbmNlIHlvdXIgZGF0YSB3aXRoIHBvaW50cycsXG4gICAgICAgICAgdW5hdmFpbGFibGU6ICdObyBwb2ludCBkYXRhIGF2YWlsYWJsZSBmb3IgeW91ciBzZWxlY3Rpb24nXG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgdGhpcy5fY3JlYXRlSXRlbVZpZXcoe1xuICAgICAgICB0eXBlOiAncG9seWdvbicsXG4gICAgICAgIHRpdGxlczoge1xuICAgICAgICAgIGF2YWlsYWJsZTogJ0dlb3JlZmVyZW5jZSB5b3VyIGRhdGEgd2l0aCBhZG1pbmlzdHJhdGl2ZSByZWdpb25zJyxcbiAgICAgICAgICB1bmF2YWlsYWJsZTogJ05vIHBvbHlnb24gZGF0YSBhdmFpbGFibGUgZm9yIHlvdXIgc2VsZWN0aW9uLicsXG4gICAgICAgICAgbGVhcm5Nb3JlOiBcIlNvcnJ5LCB3ZSBkb24ndCBoYXZlIHBvbHlnb25zIGF2YWlsYWJsZSBmb3IgdGhlIGRhdGF0eXBlIHlvdSBhcmUgdHJ5aW5nIHRvIGdlb2NvZGUuIFwiICtcbiAgICAgICAgICAgICdGb3IgZXhhbXBsZSwgaWYgeW91IGFyZSBnZW9jb2RpbmcgcGxhY2VuYW1lcyB3ZSBjYW4gb25seSBnaXZlIHlvdSBwb2ludHMgZm9yIHdoZXJlIHRob3NlIHBsYWNlcyBleGlzdC4nXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgXTtcbiAgfSxcblxuICBfY3JlYXRlSXRlbVZpZXc6IGZ1bmN0aW9uKGQpIHtcbiAgICByZXR1cm4gbmV3IEdlb21ldHJ5SXRlbVZpZXcoXy5leHRlbmQoe1xuICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICBhdmFpbGFibGVHZW9tZXRyaWVzOiB0aGlzLmF2YWlsYWJsZUdlb21ldHJpZXNcbiAgICB9LCBkKSk7XG4gIH0sXG5cbiAgX2NyZWF0ZUxvYWRpbmdWaWV3OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9sb2FkaW5nJywge1xuICAgICAgdGl0bGU6ICdDaGVja2luZyBmb3IgYXZhaWxhYmxlIGdlb21ldHJpZXPigKYnLFxuICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICB9KTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmF2YWlsYWJsZUdlb21ldHJpZXMuYmluZCgnY2hhbmdlOmF2YWlsYWJsZV9nZW9tZXRyaWVzJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5hdmFpbGFibGVHZW9tZXRyaWVzKTtcbiAgfSxcblxuICBfZmV0Y2hBdmFpbGFibGVHZW9tZXRyaWVzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmF2YWlsYWJsZUdlb21ldHJpZXMuZmV0Y2goe1xuICAgICAgZGF0YTogdGhpcy5tb2RlbC5hdmFpbGFibGVHZW9tZXRyaWVzRmV0Y2hEYXRhKClcbiAgICB9KTtcbiAgfVxuXG59KTtcbiIsInZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBTdGVwc1ZpZXcgPSByZXF1aXJlKCcuL3N0ZXBzX3ZpZXcnKTtcbnZhciBSb3dNb2RlbCA9IHJlcXVpcmUoJy4vcm93X21vZGVsJyk7XG52YXIgRGVmYXVsdEZvb3RlclZpZXcgPSByZXF1aXJlKCcuL2RlZmF1bHRfZm9vdGVyX3ZpZXcnKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfZmFjdG9yeScpO1xuXG4vKipcbiAqIE1vZGVsIGZvciB0aGUgY2l0eSBuYW1lcyBnZW9yZWZlcmVuY2Ugb3B0aW9uLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgVEFCX0xBQkVMOiAnQ2l0eSBOYW1lcycsXG4gIEtJTkQ6ICduYW1lZHBsYWNlJyxcblxuICBkZWZhdWx0czoge1xuICAgIHN0ZXA6IDAsXG4gICAgY29sdW1uczogW11cbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbihhdHRycykge1xuICAgIGlmICghYXR0cnMuZ2VvY29kZVN0dWZmKSB0aHJvdyBuZXcgRXJyb3IoJ2dlb2NvZGVTdHVmZiBpcyByZXF1aXJlZCcpO1xuICAgIGlmICghYXR0cnMuY29sdW1uc05hbWVzKSB0aHJvdyBuZXcgRXJyb3IoJ2NvbHVtbnNOYW1lcyBpcyByZXF1aXJlZCcpO1xuICAgIGlmICghYXR0cnMuY29sdW1ucykgdGhyb3cgbmV3IEVycm9yKCdjb2x1bW5zIGlzIHJlcXVpcmVkJyk7XG4gIH0sXG5cbiAgY3JlYXRlVmlldzogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5faW5pdFJvd3MoKTtcbiAgICB0aGlzLl9zZXRTdGF0ZUZvckZpcnN0U3RlcCgpO1xuXG4gICAgcmV0dXJuIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5TGlzdChbXG4gICAgICBuZXcgU3RlcHNWaWV3KHtcbiAgICAgICAgdGl0bGU6IFwiU2VsZWN0IHRoZSBjb2x1bW4gdGhhdCBjb250YWlucyB0aGUgQ2l0eSdzIE5hbWVcIixcbiAgICAgICAgZGVzYzogJ05vIG1hdHRlciB0aGUgdHlwZSBvZiB0aGUgY29sdW1ucyB5b3Ugc2VsZWN0LCB3ZSB3aWxsIHRyYW5zZm9ybSB0aGVtIHRvIG51bWJlciBmb3IgZ2VvcmVmZXJlbmNpbmcuJyxcbiAgICAgICAgbW9kZWw6IHRoaXNcbiAgICAgIH0pLFxuICAgICAgbmV3IERlZmF1bHRGb290ZXJWaWV3KHtcbiAgICAgICAgbW9kZWw6IHRoaXNcbiAgICAgIH0pXG4gICAgXSk7XG4gIH0sXG5cbiAgYXNzZXJ0SWZDYW5Db250aW51ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHZhbHVlID0gdGhpcy5nZXQoJ3N0ZXAnKSA9PT0gMCA/IHRoaXMuX2NvbHVtbk5hbWVWYWx1ZSgpIDogdGhpcy5nZXQoJ2dlb21ldHJ5VHlwZScpO1xuICAgIHRoaXMuc2V0KCdjYW5Db250aW51ZScsICEhdmFsdWUpO1xuICB9LFxuXG4gIGNvbnRpbnVlOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5nZXQoJ3N0ZXAnKSA9PT0gMCkge1xuICAgICAgdGhpcy5fc2V0U3RhdGVGb3JTZWNvbmRTdGVwKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2dlb2NvZGUoKTtcbiAgICB9XG4gIH0sXG5cbiAgZ29CYWNrOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9zZXRTdGF0ZUZvckZpcnN0U3RlcCgpO1xuICB9LFxuXG4gIGF2YWlsYWJsZUdlb21ldHJpZXNGZXRjaERhdGE6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnZ2VvY29kZVN0dWZmJykuYXZhaWxhYmxlR2VvbWV0cmllc0ZldGNoRGF0YSh0aGlzLktJTkQsIHRoaXMuX2xvY2F0aW9uVmFsdWUoKSwgdGhpcy5faXNMb2NhdGlvbkZyZWVUZXh0KCkpO1xuICB9LFxuXG4gIF9zZXRTdGF0ZUZvckZpcnN0U3RlcDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgc3RlcDogMCxcbiAgICAgIGNhbkdvQmFjazogZmFsc2UsXG4gICAgICBjYW5Db250aW51ZTogZmFsc2UsXG4gICAgICBoaWRlRm9vdGVyOiBmYWxzZVxuICAgIH0pO1xuICB9LFxuXG4gIF9zZXRTdGF0ZUZvclNlY29uZFN0ZXA6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0KHtcbiAgICAgIHN0ZXA6IDEsXG4gICAgICBjYW5Hb0JhY2s6IHRydWUsXG4gICAgICBjYW5Db250aW51ZTogZmFsc2UsXG4gICAgICBoaWRlRm9vdGVyOiB0cnVlLFxuICAgICAgZ2VvbWV0cnlUeXBlOiAnJ1xuICAgIH0pO1xuICB9LFxuXG4gIF9nZW9jb2RlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZCA9IHRoaXMuZ2V0KCdnZW9jb2RlU3R1ZmYnKS5nZW9jb2RpbmdDaG9zZW5EYXRhKHtcbiAgICAgIHR5cGU6ICdjaXR5JyxcbiAgICAgIGtpbmQ6IHRoaXMuS0lORCxcbiAgICAgIGxvY2F0aW9uOiB0aGlzLl9sb2NhdGlvblZhbHVlKCksXG4gICAgICBjb2x1bW5fbmFtZTogdGhpcy5fY29sdW1uTmFtZVZhbHVlKCksXG4gICAgICBnZW9tZXRyeV90eXBlOiB0aGlzLmdldCgnZ2VvbWV0cnlUeXBlJylcbiAgICB9LCB0aGlzLl9pc0xvY2F0aW9uRnJlZVRleHQoKSwgdHJ1ZSk7XG5cbiAgICB2YXIgcmVnaW9uID0gdGhpcy5fcmVnaW9uVmFsdWUoKTtcbiAgICBpZiAoIV8uaXNFbXB0eShyZWdpb24pKSB7XG4gICAgICBkLnJlZ2lvbiA9IHJlZ2lvbjtcbiAgICAgIGQucmVnaW9uX3RleHQgPSB0aGlzLl9pc1JlZ2lvbkZyZWVUZXh0KCk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXQoJ2dlb2NvZGVEYXRhJywgZCk7XG4gIH0sXG5cbiAgX2luaXRSb3dzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcm93cyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKFtcbiAgICAgIG5ldyBSb3dNb2RlbCh7XG4gICAgICAgIGNvbWJvVmlld0NsYXNzOiAnQ29tYm8nLFxuICAgICAgICBsYWJlbDogJ0luIHdoaWNoIGNvbHVtbiBhcmUgeW91ciBjaXR5IG5hbWVzIHN0b3JlZD8nLFxuICAgICAgICBwbGFjZWhvbGRlcjogJ1NlbGVjdCBjb2x1bW4nLFxuICAgICAgICBkYXRhOiB0aGlzLmdldCgnY29sdW1uc05hbWVzJylcbiAgICAgIH0pLFxuICAgICAgbmV3IFJvd01vZGVsKHtcbiAgICAgICAgbGFiZWw6IFwiQWRtaW4uIFJlZ2lvbiB3aGVyZSBjaXR5J3MgbG9jYXRlZCwgaWYga25vd25cIixcbiAgICAgICAgZGF0YTogdGhpcy5nZXQoJ2NvbHVtbnMnKVxuICAgICAgfSksXG4gICAgICBuZXcgUm93TW9kZWwoe1xuICAgICAgICBsYWJlbDogXCJDb3VudHJ5IHdoZXJlIGNpdHkncyBsb2NhdGVkLCBpZiBrbm93blwiLFxuICAgICAgICBkYXRhOiB0aGlzLmdldCgnY29sdW1ucycpXG4gICAgICB9KVxuICAgIF0pO1xuICAgIHRoaXMuc2V0KCdyb3dzJywgcm93cyk7XG4gIH0sXG5cbiAgX2NvbHVtbk5hbWVWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdyb3dzJykuZmlyc3QoKS5nZXQoJ3ZhbHVlJyk7XG4gIH0sXG5cbiAgX3JlZ2lvblZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVnaW9uKCkuZ2V0KCd2YWx1ZScpO1xuICB9LFxuXG4gIF9pc1JlZ2lvbkZyZWVUZXh0OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVnaW9uKCkuZ2V0KCdpc0ZyZWVUZXh0Jyk7XG4gIH0sXG5cbiAgX3JlZ2lvbjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdyb3dzJykuYXQoMSk7IC8vIDJuZCByb3dcbiAgfSxcblxuICBfbG9jYXRpb25WYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xvY2F0aW9uKCkuZ2V0KCd2YWx1ZScpO1xuICB9LFxuXG4gIF9pc0xvY2F0aW9uRnJlZVRleHQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9sb2NhdGlvbigpLmdldCgnaXNGcmVlVGV4dCcpO1xuICB9LFxuXG4gIF9sb2NhdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdyb3dzJykubGFzdCgpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogVmlldyBmb3IgdGhlIGRlZmF1bHQgZm9vdGVyXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtZm9yY2UtYWxsLXJvd3MnOiAnX29uQ2xpY2tGb3JjZUFsbFJvd3MnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGhpcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL2RlZmF1bHRfZm9vdGVyJykoKVxuICAgICk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6Y2FuQ29udGludWUnLCB0aGlzLl9vbkNoYW5nZUNhbkNvbnRpbnVlLCB0aGlzKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpoaWRlRm9vdGVyJywgdGhpcy5fb25DaGFuZ2VIaWRlRm9vdGVyLCB0aGlzKTtcblxuICAgIHZhciBnZW9jb2RlU3R1ZmYgPSB0aGlzLl9nZW9jb2RlU3R1ZmYoKTtcbiAgICBnZW9jb2RlU3R1ZmYuYmluZCgnY2hhbmdlOmZvcmNlQWxsUm93cycsIHRoaXMuX29uQ2hhbmdlRm9yY2VBbGxSb3dzLCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKGdlb2NvZGVTdHVmZik7XG4gIH0sXG5cbiAgX29uQ2hhbmdlQ2FuQ29udGludWU6IGZ1bmN0aW9uKG0sIGNhbkNvbnRpbnVlKSB7XG4gICAgdGhpcy4kKCcub2snKS50b2dnbGVDbGFzcygnaXMtZGlzYWJsZWQnLCAhY2FuQ29udGludWUpO1xuICB9LFxuXG4gIF9vbkNoYW5nZUhpZGVGb290ZXI6IGZ1bmN0aW9uKG0sIGhpZGVGb290ZXIpIHtcbiAgICB0aGlzLiRlbC50b2dnbGUoIWhpZGVGb290ZXIpO1xuICB9LFxuXG4gIF9vbkNoYW5nZUZvcmNlQWxsUm93czogZnVuY3Rpb24obSwgaGFzRm9yY2VBbGxSb3dzKSB7XG4gICAgdGhpcy4kKCcuanMtZm9yY2UtYWxsLXJvd3MgYnV0dG9uJykudG9nZ2xlQ2xhc3MoJ2lzLWNoZWNrZWQnLCAhIWhhc0ZvcmNlQWxsUm93cyk7XG4gIH0sXG5cbiAgX29uQ2xpY2tGb3JjZUFsbFJvd3M6IGZ1bmN0aW9uKGV2KSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZXYpO1xuICAgIHZhciBtID0gdGhpcy5fZ2VvY29kZVN0dWZmKCk7XG4gICAgbS5zZXQoJ2ZvcmNlQWxsUm93cycsICFtLmdldCgnZm9yY2VBbGxSb3dzJykpO1xuICB9LFxuXG4gIF9nZW9jb2RlU3R1ZmY6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLm1vZGVsLmdldCgnZ2VvY29kZVN0dWZmJyk7XG4gIH1cblxufSk7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqIFNpbXBsZSBvYmplY3QgZm9yIGNvbW1vbiBsb2dpYyBpbiB0aGUgZ2VvcmVmZXJlbmNlIG1vZGFsLCBlLmcuIGZvciBhdmFpbGFibGUgZ2VvbWV0cmllcywgYW5kXG4gKiBjcmVhdGluZyBjaG9zZW4gZ2VvY29kaW5nIGRhdGEsIGV0Yy5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIGRlZmF1bHRzOiB7XG4gICAgdGFibGVOYW1lOiB1bmRlZmluZWQsXG4gICAgZm9yY2VBbGxSb3dzOiBmYWxzZVxuICB9LFxuXG4gIGluaXRpYWxpZTogZnVuY3Rpb24oYXR0cnMpIHtcbiAgICBpZiAoIWF0dHJzLnRhYmxlTmFtZSkgdGhyb3cgbmV3IEVycm9yKCd0YWJsZU5hbWUgaXMgcmVxdWlyZWQnKTtcbiAgfSxcblxuICAvKipcbiAgICogQHBhcmFtIHtTdHJpbmd9IGtpbmRcbiAgICogQHBhcmFtIHtTdHJpbmd9IGxvY2F0aW9uXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gaXNMb2NhdGlvbkZyZWVUZXh0XG4gICAqIEByZXR1cm4ge09iamVjdH0gaGFzaFxuICAgKi9cbiAgYXZhaWxhYmxlR2VvbWV0cmllc0ZldGNoRGF0YTogZnVuY3Rpb24oa2luZCwgbG9jYXRpb24sIGlzTG9jYXRpb25GcmVlVGV4dCkge1xuICAgIGlmICgha2luZCkgdGhyb3cgbmV3IEVycm9yKCdraW5kIGlzIHJlcXVpcmVkJyk7XG5cbiAgICB2YXIgZCA9IHtcbiAgICAgIGtpbmQ6IGtpbmRcbiAgICB9O1xuXG4gICAgaWYgKF8uaXNFbXB0eShsb2NhdGlvbikpIHtcbiAgICAgIGQuZnJlZV90ZXh0ID0gJ1dvcmxkJztcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGlzTG9jYXRpb25GcmVlVGV4dCkge1xuICAgICAgICBkLmZyZWVfdGV4dCA9IGxvY2F0aW9uO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZC5jb2x1bW5fbmFtZSA9IGxvY2F0aW9uO1xuICAgICAgICBkLnRhYmxlX25hbWUgPSB0aGlzLmdldCgndGFibGVOYW1lJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGQ7XG4gIH0sXG5cbiAgLy8gQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBpZiBsb2NhdGlvbiBpcyBjb25zaWRlcmVkIGEgXCJ3b3JsZFwiIGdlb2NvZGluZyBzZWFyY2ggdmFsdWUuXG4gIGlzTG9jYXRpb25Xb3JsZDogZnVuY3Rpb24obG9jYXRpb24sIGlzRnJlZVRleHQsIHVzZUZhbGxiYWNrSWZMb2NhdGlvbklzTWlzc2luZykge1xuICAgIHZhciBpc0xvY2F0aW9uTWlzc2luZ0FuZFNob3VsZEZhbGxiYWNrID0gKGxvY2F0aW9uID09PSB1bmRlZmluZWQgJiYgdXNlRmFsbGJhY2tJZkxvY2F0aW9uSXNNaXNzaW5nKTtcbiAgICB2YXIgaXNXb3JsZCA9IGxvY2F0aW9uID09PSAnJyB8fCBpc0xvY2F0aW9uTWlzc2luZ0FuZFNob3VsZEZhbGxiYWNrO1xuICAgIHJldHVybiBpc1dvcmxkIHx8ICghIWlzRnJlZVRleHQgJiYgbG9jYXRpb24uc2VhcmNoKCd3b3JsZCcpICE9PSAtMSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgdGhlIGV4cGVjdGVkIGRhdGEgZm9yIHRoZSAnZ2VvY29kaW5nQ2hvc2VuJyBldmVudCBvbiB0aGUgY2RiLmdvZCBtb2RlbC5cbiAgICogQWRoZXJlcyB0byB0aGUgZXhpc3Rpbmcgd29ya2Zsb3cgYW5kIHdhcyBleHRyYWN0ZWQgZnJvbSBvbGQgdmlld3MuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBkXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gaXNMb2NhdGlvbkZyZWVUZXh0IHRydWUgaWYgbG9jYXRpb24gcHJvcCB3YXMgY3JlYXRlZCB0aHJvdWdoIGEgZnJlZS10ZXh0IGlucHV0IGZpZWxkLCBhbmRcbiAgICogIGZhbHNlIGlmIG1hdGNoZXMgYSBjb2x1bW4gbmFtZSBvbiB0aGUgdGFibGVcbiAgICogQHBhcmFtIHtCb29sZWFufSB1c2VGYWxsYmFja0lmTG9jYXRpb25Jc01pc3NpbmcgdHJ1ZSBpZiBzaG91bGQgdXNlIGZhbGxiYWNrIHZhbHVlIGZvciBhIG1pc3NpbmcgbG9jYXRpb24gdmFsdWUuXG4gICAqIEByZXR1cm4ge09iamVjdH1cbiAgICovXG4gIGdlb2NvZGluZ0Nob3NlbkRhdGE6IGZ1bmN0aW9uKGQsIGlzTG9jYXRpb25GcmVlVGV4dCwgdXNlRmFsbGJhY2tJZkxvY2F0aW9uSXNNaXNzaW5nKSB7XG4gICAgZC50YWJsZV9uYW1lID0gdGhpcy5nZXQoJ3RhYmxlTmFtZScpO1xuXG4gICAgaWYgKHRoaXMuaXNMb2NhdGlvbldvcmxkKGQubG9jYXRpb24sIGlzTG9jYXRpb25GcmVlVGV4dCwgdXNlRmFsbGJhY2tJZkxvY2F0aW9uSXNNaXNzaW5nKSkge1xuICAgICAgZC5sb2NhdGlvbiA9ICd3b3JsZCc7XG4gICAgICBkLnRleHQgPSB0cnVlOyAvLyBTZXQgZnJlZSB0ZXh0XG4gICAgfSBlbHNlIGlmIChfLmlzQm9vbGVhbihpc0xvY2F0aW9uRnJlZVRleHQpICYmIGlzTG9jYXRpb25GcmVlVGV4dCkge1xuICAgICAgZC50ZXh0ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5nZXQoJ2ZvcmNlQWxsUm93cycpKSB7XG4gICAgICBkLmZvcmNlX2FsbF9yb3dzID0gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZDtcbiAgfVxuXG59KTtcbiIsInZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogVmlldyBmb3IgYW4gaW5kaXZpZHVhbCBnZW9tZXRyeSB0eXBlXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ09wdGlvbkNhcmQgT3B0aW9uQ2FyZC0tYmxvY2t5JyxcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2snOiAnX29uQ2xpY2snXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMudHlwZSkgY2RiLmxvZy5lcnJvcigndHlwZSBpcyByZXF1aXJlZCcpO1xuICAgIGlmICghdGhpcy5vcHRpb25zLnRpdGxlcykgY2RiLmxvZy5lcnJvcigndGl0bGVzIGlzIHJlcXVpcmVkJyk7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMudGl0bGVzLmF2YWlsYWJsZSkgY2RiLmxvZy5lcnJvcigndGl0bGVzLmF2YWlsYWJsZSBpcyByZXF1aXJlZCcpO1xuICAgIGlmICghdGhpcy5vcHRpb25zLnRpdGxlcy51bmF2YWlsYWJsZSkgY2RiLmxvZy5lcnJvcigndGl0bGVzLnVuYXZhaWxhYmxlIGlzIHJlcXVpcmVkJyk7XG4gICAgdGhpcy5hdmFpbGFibGVHZW9tZXRyaWVzID0gdGhpcy5vcHRpb25zLmF2YWlsYWJsZUdlb21ldHJpZXM7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcblxuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2UvZ2VvbWV0cnlfaXRlbV8nICsgdGhpcy5vcHRpb25zLnR5cGUpKHtcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIHRoaXMuX29uQ2hhbmdlQXZhaWxhYmxlR2VvbWV0cmllcygpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5hdmFpbGFibGVHZW9tZXRyaWVzLmJpbmQoJ2NoYW5nZTphdmFpbGFibGVfZ2VvbWV0cmllcycsIHRoaXMuX29uQ2hhbmdlQXZhaWxhYmxlR2VvbWV0cmllcywgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbCh0aGlzLmF2YWlsYWJsZUdlb21ldHJpZXMpO1xuXG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6Z2VvbWV0cnlUeXBlJywgdGhpcy5fb25DaGFuZ2VHZW9tZXRyeVR5cGUsIHRoaXMpO1xuICB9LFxuXG4gIF9vbkNoYW5nZUdlb21ldHJ5VHlwZTogZnVuY3Rpb24obSwgdHlwZSkge1xuICAgIHRoaXMuJGVsLnRvZ2dsZUNsYXNzKCdpcy1zZWxlY3RlZCcsIHR5cGUgPT09IHRoaXMub3B0aW9ucy50eXBlKTtcbiAgfSxcblxuICBfb25DaGFuZ2VBdmFpbGFibGVHZW9tZXRyaWVzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXNBdmFpbGFibGUgPSB0aGlzLl9pc0F2YWlsYWJsZSgpO1xuXG4gICAgdGhpcy4kZWwudG9nZ2xlQ2xhc3MoJ09wdGlvbkNhcmQtLXN0YXRpYycsICFpc0F2YWlsYWJsZSk7XG4gICAgdGhpcy4kKCcuanMtaWNvbicpLnRvZ2dsZUNsYXNzKCd1LWRpc2FibGVkJywgIWlzQXZhaWxhYmxlKTtcbiAgICB0aGlzLiQoJy5qcy13YXJuaW5nJykudG9nZ2xlKCFpc0F2YWlsYWJsZSk7XG4gICAgdGhpcy4kKCcuanMtdGl0bGUnKVxuICAgICAgLnRvZ2dsZUNsYXNzKCd1LWRpc2FibGVkJywgIWlzQXZhaWxhYmxlKVxuICAgICAgLnRleHQodGhpcy5vcHRpb25zLnRpdGxlc1tpc0F2YWlsYWJsZSA/ICdhdmFpbGFibGUnIDogJ3VuYXZhaWxhYmxlJ10pO1xuICB9LFxuXG4gIF9vbkNsaWNrOiBmdW5jdGlvbihldikge1xuICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICBpZiAodGhpcy5faXNBdmFpbGFibGUoKSkge1xuICAgICAgdGhpcy5tb2RlbC5zZXQoJ2dlb21ldHJ5VHlwZScsIHRoaXMub3B0aW9ucy50eXBlKTtcbiAgICAgIHRoaXMubW9kZWwuY29udGludWUoKTtcbiAgICB9XG4gIH0sXG5cbiAgX2lzQXZhaWxhYmxlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gXy5jb250YWlucyh0aGlzLmF2YWlsYWJsZUdlb21ldHJpZXMuZ2V0KCdhdmFpbGFibGVfZ2VvbWV0cmllcycpLCB0aGlzLm9wdGlvbnMudHlwZSk7XG4gIH1cblxufSk7XG4iLCJ2YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgTG9uTGF0Q29sdW1uc01vZGVsID0gcmVxdWlyZSgnLi9sb25fbGF0X2NvbHVtbnNfbW9kZWwnKTtcbnZhciBDaXR5TmFtZXNNb2RlbCA9IHJlcXVpcmUoJy4vY2l0eV9uYW1lc19tb2RlbCcpO1xudmFyIEFkbWluUmVnaW9uc01vZGVsID0gcmVxdWlyZSgnLi9hZG1pbl9yZWdpb25zX21vZGVsJyk7XG52YXIgUG9zdGFsQ29kZXNNb2RlbCA9IHJlcXVpcmUoJy4vcG9zdGFsX2NvZGVzX21vZGVsJyk7XG52YXIgSXBBZGRyZXNzZXNNb2RlbCA9IHJlcXVpcmUoJy4vaXBfYWRkcmVzc2VzX21vZGVsJyk7XG52YXIgU3RyZWV0QWRkcmVzc2VzTW9kZWwgPSByZXF1aXJlKCcuL3N0cmVldF9hZGRyZXNzZXMvc3RyZWV0X2FkZHJlc3Nlc19tb2RlbCcpO1xudmFyIEdlb2NvZGVTdHVmZk1vZGVsID0gcmVxdWlyZSgnLi9nZW9jb2RlX3N0dWZmX21vZGVsJyk7XG52YXIgVXNlckdlb2NvZGluZ01vZGVsID0gcmVxdWlyZSgnLi91c2VyX2dlb2NvZGluZ19tb2RlbCcpO1xuXG4vKipcbiAqIFZpZXcgbW9kZWwgZm9yIG1lcmdlIGRhdGFzZXRzIHZpZXcuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBfRVhDTFVERURfQ09MVU1OX05BTUVTOiBbJ2NhcnRvZGJfaWQnLCAndGhlX2dlb20nLCAndXBkYXRlZF9hdCcsICdjcmVhdGVkX2F0JywgJ2NhcnRvZGJfZ2VvcmVmX3N0YXR1cyddLFxuICBfQUxMT1dFRF9DT0xVTU5fVFlQRVM6IFsnc3RyaW5nJywgJ251bWJlcicsICdib29sZWFuJywgJ2RhdGUnXSxcblxuICBkZWZhdWx0czoge1xuICAgIG9wdGlvbnM6IHVuZGVmaW5lZCAvLyBDb2xsZWN0aW9uLCBjcmVhdGVkIHdpdGggbW9kZWxcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbihhdHRycykge1xuICAgIGlmICghYXR0cnMudGFibGUpIHRocm93IG5ldyBFcnJvcigndGFibGUgaXMgcmVxdWlyZWQnKTtcbiAgICBpZiAoIWF0dHJzLnVzZXIpIHRocm93IG5ldyBFcnJvcigndXNlciBpcyByZXF1aXJlZCcpO1xuICAgIHRoaXMuX2luaXRHZW9jb2RlU3R1ZmYoKTtcbiAgICB0aGlzLl9pbml0T3B0aW9ucygpO1xuICB9LFxuXG4gIGNoYW5nZWRTZWxlY3RlZFRhYjogZnVuY3Rpb24obmV3VGFiKSB7XG4gICAgdGhpcy5nZXQoJ29wdGlvbnMnKS5jaGFpbigpXG4gICAgICAud2l0aG91dChuZXdUYWIpLmVhY2godGhpcy5fZGVzZWxlY3QpO1xuICB9LFxuXG4gIGNyZWF0ZVZpZXc6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZFRhYk1vZGVsKCkuY3JlYXRlVmlldygpO1xuICB9LFxuXG4gIGNhbkNvbnRpbnVlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fc2VsZWN0ZWRUYWJNb2RlbCgpLmdldCgnY2FuQ29udGludWUnKTtcbiAgfSxcblxuICBjb250aW51ZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuY2FuQ29udGludWUoKSkge1xuICAgICAgdGhpcy5fc2VsZWN0ZWRUYWJNb2RlbCgpLmNvbnRpbnVlKCk7XG4gICAgfVxuICB9LFxuXG4gIGNhbkdvQmFjazogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlbGVjdGVkVGFiTW9kZWwoKS5nZXQoJ2NhbkdvQmFjaycpO1xuICB9LFxuXG4gIGdvQmFjazogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuY2FuR29CYWNrKCkpIHtcbiAgICAgIHRoaXMuX3NlbGVjdGVkVGFiTW9kZWwoKS5nb0JhY2soKTtcbiAgICB9XG4gIH0sXG5cbiAgX3NlbGVjdGVkVGFiTW9kZWw6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnb3B0aW9ucycpLmZpbmQodGhpcy5faXNTZWxlY3RlZCk7XG4gIH0sXG5cbiAgX2NvbHVtbnNOYW1lczogZnVuY3Rpb24oKSB7XG4gICAgLy8gTWFpbnRhaW5lZCBvbGQgbG9naWMsIHNvIGZvciBzb21lIHJlYXNvbiB0aGUgY29sdW1uIHR5cGVzIGZpbHRlciBpcyBub3QgYXBwbGllZCBmb3IgdGhlIHBsYWNlcyB3aGVyZSB0aGUgY29sdW1uIG5hbWVzIGFyZSB1c2RcbiAgICByZXR1cm4gXy5jaGFpbih0aGlzLmdldCgndGFibGUnKS5nZXQoJ3NjaGVtYScpKVxuICAgICAgLmZpbHRlcih0aGlzLl9pc0FsbG93ZWRDb2x1bW5OYW1lLCB0aGlzKVxuICAgICAgLm1hcCh0aGlzLl9jb2x1bW5OYW1lKVxuICAgICAgLnZhbHVlKCk7XG4gIH0sXG5cbiAgX2ZpbHRlcmVkQ29sdW1uczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRhYmxlID0gdGhpcy5nZXQoJ3RhYmxlJyk7XG4gICAgLy8gb3JpZ2luYWxfc2NoZW1hIG1heSBiZSBzZXQgaWYgbm90IGluIFNRTCB2aWV3IChzZWUgd2hlcmUgYXR0ciBpcyBzZXQgaW4gdGhlIHRhYmxlIG1vZGVsKVxuICAgIC8vIG1haW50YWluZWQgZnJvbSBjb2RlIHRvIG5vdCBicmVhayBiZWhhdmlvciB3aGVuIGltcGxlbWVudGluZyB0aGlzIG5ldyBtb2RhbFxuICAgIHJldHVybiBfLmNoYWluKHRhYmxlLmdldCgnb3JpZ2luYWxfc2NoZW1hJykgfHwgdGFibGUuZ2V0KCdzY2hlbWEnKSlcbiAgICAgIC5maWx0ZXIodGhpcy5faXNBbGxvd2VkQ29sdW1uTmFtZSwgdGhpcylcbiAgICAgIC5maWx0ZXIodGhpcy5faXNBbGxvd2VkQ29sdW1uVHlwZSwgdGhpcylcbiAgICAgIC5tYXAodGhpcy5faW52ZXJDb2x1bW5SYXdWYWx1ZXMpXG4gICAgICAudmFsdWUoKTtcbiAgfSxcblxuICBfaW52ZXJDb2x1bW5SYXdWYWx1ZXM6IGZ1bmN0aW9uKHJhd0NvbHVtbikge1xuICAgIC8vIFRoZSBjZGIuZm9ybXMuQ3VzdG9tVGV4dENvbWJvIGV4cGVjdHMgdGhlIGRhdGEgdG8gYmUgaW4gb3JkZXIgb2YgW3R5cGUsIG5hbWVdLCBzbyBuZWVkIHRvIHRyYW5zbGF0ZSB0aGUgcmF3IHNjaGVtYVxuICAgIHZhciB0eXBlID0gcmF3Q29sdW1uWzFdO1xuICAgIHZhciBuYW1lID0gcmF3Q29sdW1uWzBdO1xuICAgIHJldHVybiBbdHlwZSwgbmFtZV07XG4gIH0sXG5cbiAgX2lzQWxsb3dlZENvbHVtbk5hbWU6IGZ1bmN0aW9uKHJhd0NvbHVtbikge1xuICAgIHJldHVybiAhXy5jb250YWlucyh0aGlzLl9FWENMVURFRF9DT0xVTU5fTkFNRVMsIHRoaXMuX2NvbHVtbk5hbWUocmF3Q29sdW1uKSk7XG4gIH0sXG5cbiAgX2lzQWxsb3dlZENvbHVtblR5cGU6IGZ1bmN0aW9uKHJhd0NvbHVtbikge1xuICAgIHJldHVybiBfLmNvbnRhaW5zKHRoaXMuX0FMTE9XRURfQ09MVU1OX1RZUEVTLCB0aGlzLl9jb2x1bW5UeXBlKHJhd0NvbHVtbikpO1xuICB9LFxuXG4gIF9jb2x1bW5OYW1lOiBmdW5jdGlvbihyYXdDb2x1bW4pIHtcbiAgICByZXR1cm4gcmF3Q29sdW1uWzBdO1xuICB9LFxuXG4gIF9jb2x1bW5UeXBlOiBmdW5jdGlvbihyYXdDb2x1bW4pIHtcbiAgICByZXR1cm4gcmF3Q29sdW1uWzFdO1xuICB9LFxuXG4gIF9pc1NlbGVjdGVkOiBmdW5jdGlvbihtKSB7XG4gICAgcmV0dXJuIG0uZ2V0KCdzZWxlY3RlZCcpO1xuICB9LFxuXG4gIF9kZXNlbGVjdDogZnVuY3Rpb24obSkge1xuICAgIG0uc2V0KCdzZWxlY3RlZCcsIGZhbHNlKTtcbiAgfSxcblxuICBfaW5pdEdlb2NvZGVTdHVmZjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIG0gPSBuZXcgR2VvY29kZVN0dWZmTW9kZWwoe1xuICAgICAgdGFibGVOYW1lOiB0aGlzLmdldCgndGFibGUnKS5nZXQoJ2lkJylcbiAgICB9KTtcbiAgICB0aGlzLnNldCgnZ2VvY29kZVN0dWZmJywgbSk7XG4gIH0sXG5cbiAgX2luaXRPcHRpb25zOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZ2VvY29kZVN0dWZmID0gdGhpcy5nZXQoJ2dlb2NvZGVTdHVmZicpO1xuICAgIHZhciBjb2x1bW5zTmFtZXMgPSB0aGlzLl9jb2x1bW5zTmFtZXMoKTtcbiAgICB2YXIgY29sdW1ucyA9IHRoaXMuX2ZpbHRlcmVkQ29sdW1ucygpO1xuXG4gICAgdGhpcy5zZXQoJ29wdGlvbnMnLFxuICAgICAgbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oW1xuICAgICAgICBuZXcgTG9uTGF0Q29sdW1uc01vZGVsKHtcbiAgICAgICAgICBnZW9jb2RlU3R1ZmY6IGdlb2NvZGVTdHVmZixcbiAgICAgICAgICBjb2x1bW5zTmFtZXM6IGNvbHVtbnNOYW1lcyxcbiAgICAgICAgICBzZWxlY3RlZDogdHJ1ZVxuICAgICAgICB9KSxcbiAgICAgICAgbmV3IENpdHlOYW1lc01vZGVsKHtcbiAgICAgICAgICBnZW9jb2RlU3R1ZmY6IGdlb2NvZGVTdHVmZixcbiAgICAgICAgICBjb2x1bW5zTmFtZXM6IGNvbHVtbnNOYW1lcyxcbiAgICAgICAgICBjb2x1bW5zOiBjb2x1bW5zXG4gICAgICAgIH0pLFxuICAgICAgICBuZXcgQWRtaW5SZWdpb25zTW9kZWwoe1xuICAgICAgICAgIGdlb2NvZGVTdHVmZjogZ2VvY29kZVN0dWZmLFxuICAgICAgICAgIGNvbHVtbnNOYW1lczogY29sdW1uc05hbWVzLFxuICAgICAgICAgIGNvbHVtbnM6IGNvbHVtbnNcbiAgICAgICAgfSksXG4gICAgICAgIG5ldyBQb3N0YWxDb2Rlc01vZGVsKHtcbiAgICAgICAgICBnZW9jb2RlU3R1ZmY6IGdlb2NvZGVTdHVmZixcbiAgICAgICAgICBjb2x1bW5zTmFtZXM6IGNvbHVtbnNOYW1lcyxcbiAgICAgICAgICBjb2x1bW5zOiBjb2x1bW5zXG4gICAgICAgIH0pLFxuICAgICAgICBuZXcgSXBBZGRyZXNzZXNNb2RlbCh7XG4gICAgICAgICAgZ2VvY29kZVN0dWZmOiBnZW9jb2RlU3R1ZmYsXG4gICAgICAgICAgY29sdW1uc05hbWVzOiBjb2x1bW5zTmFtZXMsXG4gICAgICAgICAgY29sdW1uczogY29sdW1uc1xuICAgICAgICB9KSxcbiAgICAgICAgbmV3IFN0cmVldEFkZHJlc3Nlc01vZGVsKHtcbiAgICAgICAgICBnZW9jb2RlU3R1ZmY6IGdlb2NvZGVTdHVmZixcbiAgICAgICAgICBjb2x1bW5zOiBjb2x1bW5zLFxuICAgICAgICAgIGlzR29vZ2xlTWFwc1VzZXI6IHRoaXMuX2lzR21lR2VvY29kZXJFbmFibGVkKCksXG4gICAgICAgICAgdXNlckdlb2NvZGluZzogdGhpcy5fdXNlckdlb2NvZGluZygpLFxuICAgICAgICAgIGxhc3RCaWxsaW5nRGF0ZTogdGhpcy5nZXQoJ3VzZXInKS5nZXQoJ2JpbGxpbmdfcGVyaW9kJyksXG4gICAgICAgICAgZXN0aW1hdGlvbjogbmV3IGNkYi5hZG1pbi5HZW9jb2RpbmdzLkVzdGltYXRpb24oe1xuICAgICAgICAgICAgaWQ6IHRoaXMuZ2V0KCd0YWJsZScpLmdldFVucXVvdGVkTmFtZSgpXG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgIF0pXG4gICAgKTtcblxuICAgIGlmICh0aGlzLmdldCgndXNlcicpLmZlYXR1cmVFbmFibGVkKCdnZW9yZWZfZGlzYWJsZWQnKSkge1xuICAgICAgdGhpcy5fZGlzYWJsZUdlb3JlZlRhYnMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fbWF5YmVEaXNhYmxlZFN0cmVldEFkZHJlc3NlcygpO1xuICAgIH1cbiAgfSxcblxuICBfZGlzYWJsZUdlb3JlZlRhYnM6IGZ1bmN0aW9uKCkge1xuICAgIF8uZWFjaCh0aGlzLl9nZW9yZWZUYWJzKCksIHRoaXMuX2Rpc2FibGVUYWIuYmluZCh0aGlzLCBcIllvdSBkb24ndCBoYXZlIHRoaXMgb3B0aW9uIGF2YWlsYWJsZSBpbiB0aGlzIHZlcnNpb25cIikpO1xuICB9LFxuXG4gIF9nZW9yZWZUYWJzOiBmdW5jdGlvbigpIHtcbiAgICAgLy8gZXhjbHVkZSAxc3QgdGFiIChMb25MYXQpLCBzaW5jZSBpdCBzaG91bGQgbm90IGJlIGFmZmVjdGVkIGJ5IHRoaXMgZmVhdHVyZSBmbGFnXG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdvcHRpb25zJykucmVzdCgpO1xuICB9LFxuXG4gIF9tYXliZURpc2FibGVkU3RyZWV0QWRkcmVzc2VzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXNHbWVHZW9jb2RlckVuYWJsZWQgPSB0aGlzLl9pc0dtZUdlb2NvZGVyRW5hYmxlZCgpO1xuICAgIGlmICh0aGlzLl9pc0dvb2dsZU1hcHNFbmFibGVkKCkpIHtcbiAgICAgIGlmICghaXNHbWVHZW9jb2RlckVuYWJsZWQpIHtcbiAgICAgICAgdGhpcy5fZGlzYWJsZVRhYignR29vZ2xlIE1hcHMgZ2VvY29kZXIgaXMgbm90IGNvbmZpZ3VyZWQuIFBsZWFzZSBjb250YWN0IHVzIGF0IHNhbGVzQGNhcnRvLmNvbScsIHRoaXMuX3N0cmVldEFkZHJUYWJNb2RlbCgpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGlzR21lR2VvY29kZXJFbmFibGVkKSB7XG4gICAgICAgIHRoaXMuX2Rpc2FibGVUYWIoJ0dlb2NvZGVyIGlzIG5vdCBjb25maWd1cmVkIHByb3Blcmx5LiBQbGVhc2UgY29udGFjdCB1cyBhdCBzYWxlc0BjYXJ0by5jb20nLCB0aGlzLl9zdHJlZXRBZGRyVGFiTW9kZWwoKSk7XG4gICAgICB9IGVsc2UgaWYgKCF0aGlzLl91c2VyR2VvY29kaW5nKCkuaGFzUXVvdGEoKSkge1xuICAgICAgICAvLyBDcmVkaXRzIGFyZSBvbmx5IHVzZWQgZm9yIHVzZXJzIHRoYXQgdXNlIG5vbi1HTUUgZ2VvY29kZXJcbiAgICAgICAgdGhpcy5fZGlzYWJsZVRhYignWW91ciBnZW9jb2RpbmcgcXVvdGEgaXMgbm90IGRlZmluZWQuIFBsZWFzZSBjb250YWN0IHVzIGF0IHNhbGVzQGNhcnRvLmNvbScsIHRoaXMuX3N0cmVldEFkZHJUYWJNb2RlbCgpKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgX3VzZXJHZW9jb2Rpbmc6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVXNlckdlb2NvZGluZ01vZGVsKHRoaXMuZ2V0KCd1c2VyJykuZ2V0KCdnZW9jb2RpbmcnKSk7XG4gIH0sXG5cbiAgX2lzR29vZ2xlTWFwc0VuYWJsZWQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9oYXNVc2VyQWN0aW9uRW5hYmxlZCgnZ29vZ2xlX21hcHNfZW5hYmxlZCcpO1xuICB9LFxuXG4gIF9pc0dtZUdlb2NvZGVyRW5hYmxlZDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2hhc1VzZXJBY3Rpb25FbmFibGVkKCdnb29nbGVfbWFwc19nZW9jb2Rlcl9lbmFibGVkJyk7XG4gIH0sXG5cbiAgX2hhc1VzZXJBY3Rpb25FbmFibGVkOiBmdW5jdGlvbihhY3Rpb25OYW1lKSB7XG4gICAgcmV0dXJuICEhdGhpcy5nZXQoJ3VzZXInKS5nZXQoJ2FjdGlvbnMnKVthY3Rpb25OYW1lXTtcbiAgfSxcblxuICBfc3RyZWV0QWRkclRhYk1vZGVsOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ29wdGlvbnMnKS5maW5kKGZ1bmN0aW9uKG0pIHtcbiAgICAgIHJldHVybiBtIGluc3RhbmNlb2YgU3RyZWV0QWRkcmVzc2VzTW9kZWw7XG4gICAgfSk7XG4gIH0sXG5cbiAgX2Rpc2FibGVUYWI6IGZ1bmN0aW9uKG1zZywgdGFiTW9kZWwpIHtcbiAgICB0YWJNb2RlbC5zZXQoJ2Rpc2FibGVkJywgbXNnKTtcbiAgfVxuXG59KTtcbiIsInZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBCYXNlRGlhbG9nID0gcmVxdWlyZSgnLi4vLi4vdmlld3MvYmFzZV9kaWFsb2cvdmlldy5qcycpO1xudmFyIEdlb3JlZmVyZW5jZU1vZGVsID0gcmVxdWlyZSgnLi9nZW9yZWZlcmVuY2VfbW9kZWwnKTtcbnZhciBUYWJJdGVtVmlldyA9IHJlcXVpcmUoJy4vdGFiX2l0ZW1fdmlldycpO1xuXG4vKipcbiAqIERpYWxvZyB0byBnZW9yZWZlcmVuY2UgYSB0YWJsZS5cbiAqIFRoaXMgdmlldyBvbmx5IGFjdHMgYXMgYSBoaWdoLWxldmVsIHZpZXcsIHRoYXQgbWFuYWdlZCB0aGUgZ2VuZXJhbCB2aWV3IGxvZ2ljIGZvciB0aGUgbW9kYWwuXG4gKiBXaGF0IGlzIHN1cHBvc2VkIHRvIGhhcHBlbiBpcyBkZWxlZ2F0ZWQgdG8gdGhlIG1vZGVsIGFuZCBpbiB0dXJuIHRoZSBzZWxlY3RlZCBnZW9yZWZlcmVuY2Ugb3B0aW9uLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VEaWFsb2cuZXh0ZW5kKHtcblxuICBldmVudHM6IEJhc2VEaWFsb2cuZXh0ZW5kRXZlbnRzKHtcbiAgICAnY2xpY2sgLmpzLWJhY2s6bm90KC5pcy1kaXNhYmxlZCknOiAnX29uR29CYWNrJ1xuICB9KSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMub3B0aW9ucy51c2VyKSB0aHJvdyBuZXcgRXJyb3IoJ3VzZXIgaXMgcmVxdWlyZWQnKTtcbiAgICB0aGlzLm9wdGlvbnMuY2xlYW5fb25faGlkZSA9IHRydWU7XG4gICAgdGhpcy5vcHRpb25zLmVudGVyX3RvX2NvbmZpcm0gPSB0cnVlO1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcblxuICAgIHRoaXMubW9kZWwgPSBuZXcgR2VvcmVmZXJlbmNlTW9kZWwoe1xuICAgICAgdGFibGU6IHRoaXMub3B0aW9ucy50YWJsZSxcbiAgICAgIHVzZXI6IHRoaXMub3B0aW9ucy51c2VyXG4gICAgfSk7XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEBvdmVycmlkZSBCYXNlRGlhbG9nLnByb3RvdHlwZS5yZW5kZXJcbiAgICovXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgQmFzZURpYWxvZy5wcm90b3R5cGUucmVuZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgdGhpcy4kKCcuY29udGVudCcpLmFkZENsYXNzKCdEaWFsb2ctY29udGVudFdyYXBwZXInKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICByZW5kZXJfY29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRhYmxlID0gdGhpcy5tb2RlbC5nZXQoJ3RhYmxlJyk7XG4gICAgdmFyICRlbCA9ICQoXG4gICAgICB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2UvZ2VvcmVmZXJlbmNlJykoe1xuICAgICAgICBoYXNOb0dlb2ZlcmVuY2VkRGF0YTogIXRhYmxlLmlzR2VvcmVmZXJlbmNlZCgpICYmIHRhYmxlLmRhdGEoKS5sZW5ndGggPiAwXG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5fcmVuZGVyVGFicygkZWwuZmluZCgnLmpzLXRhYnMnKSk7XG4gICAgdGhpcy5fcmVuZGVyVGFiQ29udGVudCgkZWwpO1xuXG4gICAgcmV0dXJuICRlbDtcbiAgfSxcblxuICBvazogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5jb250aW51ZSgpO1xuICB9LFxuXG4gIF9pbml0Vmlld3M6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3RhYlZpZXdzID0gdGhpcy5tb2RlbC5nZXQoJ29wdGlvbnMnKS5tYXAodGhpcy5fY3JlYXRlRGVmYXVsdFRhYlZpZXcsIHRoaXMpO1xuICB9LFxuXG4gIF9jcmVhdGVEZWZhdWx0VGFiVmlldzogZnVuY3Rpb24obW9kZWwpIHtcbiAgICB2YXIgdmlldyA9IG5ldyBUYWJJdGVtVmlldyh7XG4gICAgICBtb2RlbDogbW9kZWxcbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodmlldyk7XG4gICAgcmV0dXJuIHZpZXc7XG4gIH0sXG5cbiAgX3JlbmRlclRhYnM6IGZ1bmN0aW9uKCR0YXJnZXQpIHtcbiAgICAkdGFyZ2V0LmFwcGVuZC5hcHBseSgkdGFyZ2V0LCBfLm1hcCh0aGlzLl90YWJWaWV3cywgdGhpcy5fZ2V0UmVuZGVyZWRFbGVtZW50KSk7XG4gIH0sXG5cbiAgX2dldFJlbmRlcmVkRWxlbWVudDogZnVuY3Rpb24odmlldykge1xuICAgIHJldHVybiB2aWV3LnJlbmRlcigpLmVsO1xuICB9LFxuXG4gIF9yZW5kZXJUYWJDb250ZW50OiBmdW5jdGlvbigkdGFyZ2V0KSB7XG4gICAgaWYgKHRoaXMuX3RhYkNvbnRlbnRWaWV3KSB7XG4gICAgICB0aGlzLl90YWJDb250ZW50Vmlldy5jbGVhbigpO1xuICAgIH1cbiAgICB0aGlzLl90YWJDb250ZW50VmlldyA9IHRoaXMubW9kZWwuY3JlYXRlVmlldygpO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLl90YWJDb250ZW50Vmlldyk7XG4gICAgJHRhcmdldC5maW5kKCcuanMtdGFiLWNvbnRlbnQnKS5odG1sKHRoaXMuX3RhYkNvbnRlbnRWaWV3LnJlbmRlcigpLmVsKTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgb3B0aW9ucyA9IHRoaXMubW9kZWwuZ2V0KCdvcHRpb25zJyk7XG4gICAgb3B0aW9ucy5iaW5kKCdjaGFuZ2U6c2VsZWN0ZWQnLCB0aGlzLl9vbkNoYW5nZVNlbGVjdGVkVGFiLCB0aGlzKTtcbiAgICBvcHRpb25zLmJpbmQoJ2NoYW5nZTpjYW5Hb0JhY2snLCB0aGlzLl9vbkNoYW5nZUNhbkdvQmFjaywgdGhpcyk7XG4gICAgb3B0aW9ucy5iaW5kKCdjaGFuZ2U6Z2VvY29kZURhdGEnLCB0aGlzLl9vbkNoYW5nZUdlb2NvZGVEYXRhLCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKG9wdGlvbnMpO1xuICB9LFxuXG4gIF9vbkNoYW5nZVNlbGVjdGVkVGFiOiBmdW5jdGlvbih0YWJNb2RlbCwgaXNTZWxlY3RlZCkge1xuICAgIGlmIChpc1NlbGVjdGVkKSB7XG4gICAgICB0aGlzLm1vZGVsLmNoYW5nZWRTZWxlY3RlZFRhYih0YWJNb2RlbCk7XG4gICAgICB0aGlzLl9yZW5kZXJUYWJDb250ZW50KHRoaXMuJGVsKTtcbiAgICB9XG4gIH0sXG5cbiAgX29uQ2hhbmdlQ2FuR29CYWNrOiBmdW5jdGlvbih0YWJNb2RlbCwgY2FuR29CYWNrKSB7XG4gICAgdGhpcy4kKCcuanMtYmFjaycpLnRvZ2dsZSghIWNhbkdvQmFjayk7XG4gIH0sXG5cbiAgX29uR29CYWNrOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmdvQmFjaygpO1xuICB9LFxuXG4gIF9vbkNoYW5nZUdlb2NvZGVEYXRhOiBmdW5jdGlvbih0YWJNb2RlbCwgZGF0YSkge1xuICAgIGNkYi5nb2QudHJpZ2dlcignZ2VvY29kaW5nQ2hvc2VuJywgZGF0YSk7XG4gICAgdGhpcy5jbG9zZSgpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBSb3dNb2RlbCA9IHJlcXVpcmUoJy4vcm93X21vZGVsJyk7XG52YXIgUm93c1ZpZXcgPSByZXF1aXJlKCcuL3Jvd3NfdmlldycpO1xudmFyIERlZmF1bHRGb290ZXJWaWV3ID0gcmVxdWlyZSgnLi9kZWZhdWx0X2Zvb3Rlcl92aWV3Jyk7XG52YXIgVmlld0ZhY3RvcnkgPSByZXF1aXJlKCcuLi8uLi92aWV3X2ZhY3RvcnknKTtcblxuLyoqXG4gKiBNb2RlbCBmb3IgdGhlIElQIGFkZHJlc3NlcyBnZW9yZWZlcmVuY2Ugb3B0aW9uLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgVEFCX0xBQkVMOiAnSVAgQWRkcmVzc2VzJyxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbihhdHRycykge1xuICAgIGlmICghYXR0cnMuZ2VvY29kZVN0dWZmKSB0aHJvdyBuZXcgRXJyb3IoJ2dlb2NvZGVTdHVmZiBpcyByZXF1aXJlZCcpO1xuICAgIGlmICghYXR0cnMuY29sdW1uc05hbWVzKSB0aHJvdyBuZXcgRXJyb3IoJ2NvbHVtbnNOYW1lcyBpcyByZXF1aXJlZCcpO1xuICB9LFxuXG4gIGNyZWF0ZVZpZXc6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2luaXRSb3dzKCk7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgY2FuQ29udGludWU6IGZhbHNlLFxuICAgICAgaGlkZUZvb3RlcjogZmFsc2VcbiAgICB9KTtcblxuICAgIHJldHVybiBWaWV3RmFjdG9yeS5jcmVhdGVCeUxpc3QoW1xuICAgICAgVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL2RlZmF1bHRfY29udGVudF9oZWFkZXInLCB7XG4gICAgICAgIHRpdGxlOiBcIlNlbGVjdCB0aGUgY29sdW1uIHRoYXQgdGhhdCBjb250YWlucyB0aGUgSVAncyBuYW1lXCIsXG4gICAgICAgIGRlc2M6ICdDb252ZXJ0IElQIGFkZHJlc3MgaW50byBnZW9ncmFwaGljYWwgbG9jYXRpb25zLidcbiAgICAgIH0pLFxuICAgICAgbmV3IFJvd3NWaWV3KHtcbiAgICAgICAgbW9kZWw6IHRoaXNcbiAgICAgIH0pLFxuICAgICAgbmV3IERlZmF1bHRGb290ZXJWaWV3KHtcbiAgICAgICAgbW9kZWw6IHRoaXNcbiAgICAgIH0pXG4gICAgXSk7XG4gIH0sXG5cbiAgYXNzZXJ0SWZDYW5Db250aW51ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXQoJ2NhbkNvbnRpbnVlJywgISF0aGlzLl9jb2x1bW5OYW1lVmFsdWUoKSk7XG4gIH0sXG5cbiAgY29udGludWU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkID0gdGhpcy5nZXQoJ2dlb2NvZGVTdHVmZicpLmdlb2NvZGluZ0Nob3NlbkRhdGEoe1xuICAgICAgdHlwZTogJ2lwJyxcbiAgICAgIGtpbmQ6ICdpcGFkZHJlc3MnLFxuICAgICAgY29sdW1uX25hbWU6IHRoaXMuX2NvbHVtbk5hbWVWYWx1ZSgpLFxuICAgICAgZ2VvbWV0cnlfdHlwZTogJ3BvaW50J1xuICAgIH0pO1xuXG4gICAgdGhpcy5zZXQoJ2dlb2NvZGVEYXRhJywgZCk7XG4gIH0sXG5cbiAgX2luaXRSb3dzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcm93cyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKFtcbiAgICAgIG5ldyBSb3dNb2RlbCh7XG4gICAgICAgIGNvbWJvVmlld0NsYXNzOiAnQ29tYm8nLFxuICAgICAgICBsYWJlbDogJ0luIHdoaWNoIGNvbHVtbiBhcmUgeW91ciBJUCBhZGRyZXNzZXMgc3RvcmVkPycsXG4gICAgICAgIHBsYWNlaG9sZGVyOiAnU2VsZWN0IGNvbHVtbicsXG4gICAgICAgIGRhdGE6IHRoaXMuZ2V0KCdjb2x1bW5zTmFtZXMnKVxuICAgICAgfSlcbiAgICBdKTtcbiAgICB0aGlzLnNldCgncm93cycsIHJvd3MpO1xuICB9LFxuXG4gIF9jb2x1bW5OYW1lVmFsdWU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgncm93cycpLmZpcnN0KCkuZ2V0KCd2YWx1ZScpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBSb3dNb2RlbCA9IHJlcXVpcmUoJy4vcm93X21vZGVsJyk7XG52YXIgUm93c1ZpZXcgPSByZXF1aXJlKCcuL3Jvd3NfdmlldycpO1xudmFyIERlZmF1bHRGb290ZXJWaWV3ID0gcmVxdWlyZSgnLi9kZWZhdWx0X2Zvb3Rlcl92aWV3Jyk7XG52YXIgVmlld0ZhY3RvcnkgPSByZXF1aXJlKCcuLi8uLi92aWV3X2ZhY3RvcnknKTtcblxuLyoqXG4gKiBNb2RlbCBmb3IgdGhlIExvbi9MYXQgZ2VvcmVmZXJlbmNlIG9wdGlvbi5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIFRBQl9MQUJFTDogJ0xvbi9MYXQgQ29sdW1ucycsXG5cbiAgZGVmYXVsdHM6IHtcbiAgICBjb2x1bW5zTmFtZXM6IFtdXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oYXR0cnMpIHtcbiAgICBpZiAoIWF0dHJzLmdlb2NvZGVTdHVmZikgdGhyb3cgbmV3IEVycm9yKCdnZW9jb2RlU3R1ZmYgaXMgcmVxdWlyZWQnKTtcbiAgICBpZiAoIWF0dHJzLmNvbHVtbnNOYW1lcykgdGhyb3cgbmV3IEVycm9yKCdjb2x1bW5zTmFtZXMgaXMgcmVxdWlyZWQnKTtcbiAgfSxcblxuICBjcmVhdGVWaWV3OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldCh7XG4gICAgICBjYW5Db250aW51ZTogZmFsc2UsXG4gICAgICBoaWRlRm9vdGVyOiBmYWxzZVxuICAgIH0pO1xuICAgIHRoaXMuX2luaXRSb3dzKCk7XG5cbiAgICByZXR1cm4gVmlld0ZhY3RvcnkuY3JlYXRlQnlMaXN0KFtcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2dlb3JlZmVyZW5jZS9kZWZhdWx0X2NvbnRlbnRfaGVhZGVyJywge1xuICAgICAgICB0aXRsZTogJ1NlbGVjdCB0aGUgY29sdW1ucyBjb250YWluaW5nIHlvdXIgTG9uL0xhdCBjb2x1bW5zJyxcbiAgICAgICAgZGVzYzogJ1RoZSBzZWxlY3RlZCBjb2x1bW5zIGFyZSB0cmFuc2Zvcm1lZCBpbnRvIGdlb3JlZmVyZW5jZSBjb29yZGluYXRlcy4nXG4gICAgICB9KSxcbiAgICAgIG5ldyBSb3dzVmlldyh7XG4gICAgICAgIG1vZGVsOiB0aGlzXG4gICAgICB9KSxcbiAgICAgIG5ldyBEZWZhdWx0Rm9vdGVyVmlldyh7XG4gICAgICAgIG1vZGVsOiB0aGlzXG4gICAgICB9KVxuICAgIF0pO1xuICB9LFxuXG4gIGFzc2VydElmQ2FuQ29udGludWU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjYW5Db250aW51ZSA9IHRoaXMuZ2V0KCdyb3dzJykuYWxsKGZ1bmN0aW9uKG0pIHtcbiAgICAgIHJldHVybiAhIW0uZ2V0KCd2YWx1ZScpO1xuICAgIH0pO1xuICAgIHRoaXMuc2V0KCdjYW5Db250aW51ZScsIGNhbkNvbnRpbnVlKTtcbiAgfSxcblxuICBjb250aW51ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGQgPSB0aGlzLmdldCgnZ2VvY29kZVN0dWZmJykuZ2VvY29kaW5nQ2hvc2VuRGF0YSh7XG4gICAgICB0eXBlOiAnbG9ubGF0JyxcbiAgICAgIGxvbmdpdHVkZTogdGhpcy5nZXQoJ3Jvd3MnKS5maXJzdCgpLmdldCgndmFsdWUnKSxcbiAgICAgIGxhdGl0dWRlOiB0aGlzLmdldCgncm93cycpLmxhc3QoKS5nZXQoJ3ZhbHVlJylcbiAgICB9KTtcblxuICAgIHRoaXMuc2V0KCdnZW9jb2RlRGF0YScsIGQpO1xuICB9LFxuXG4gIF9pbml0Um93czogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHJvd3MgPSBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbihbXG4gICAgICBuZXcgUm93TW9kZWwoe1xuICAgICAgICBjb21ib1ZpZXdDbGFzczogJ0NvbWJvJyxcbiAgICAgICAgbGFiZWw6ICdTZWxlY3QgeW91ciBMb25naXR1ZGUnLFxuICAgICAgICBwbGFjZWhvbGRlcjogJ1NlbGVjdCBjb2x1bW4nLFxuICAgICAgICBwcm9wZXJ0eTogJ2xvbmdpdHVkZScsXG4gICAgICAgIGRhdGE6IHRoaXMuZ2V0KCdjb2x1bW5zTmFtZXMnKVxuICAgICAgfSksXG4gICAgICBuZXcgUm93TW9kZWwoe1xuICAgICAgICBjb21ib1ZpZXdDbGFzczogJ0NvbWJvJyxcbiAgICAgICAgbGFiZWw6ICdTZWxlY3QgeW91ciBMYXRpdHVkZScsXG4gICAgICAgIHBsYWNlaG9sZGVyOiAnU2VsZWN0IGNvbHVtbicsXG4gICAgICAgIHByb3BlcnR5OiAnbGF0aXR1ZGUnLFxuICAgICAgICBkYXRhOiB0aGlzLmdldCgnY29sdW1uc05hbWVzJylcbiAgICAgIH0pXG4gICAgXSk7XG4gICAgdGhpcy5zZXQoJ3Jvd3MnLCByb3dzKTtcbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBCYWNrYm9uZSA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydCYWNrYm9uZSddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnQmFja2JvbmUnXSA6IG51bGwpO1xudmFyIFJvd01vZGVsID0gcmVxdWlyZSgnLi9yb3dfbW9kZWwnKTtcbnZhciBTdGVwc1ZpZXcgPSByZXF1aXJlKCcuL3N0ZXBzX3ZpZXcnKTtcbnZhciBEZWZhdWx0Rm9vdGVyVmlldyA9IHJlcXVpcmUoJy4vZGVmYXVsdF9mb290ZXJfdmlldycpO1xudmFyIFZpZXdGYWN0b3J5ID0gcmVxdWlyZSgnLi4vLi4vdmlld19mYWN0b3J5Jyk7XG5cbi8qKlxuICogTW9kZWwgZm9yIHRoZSBwb3N0YWwgY29kZXMgZ2VvcmVmZXJlbmNlIG9wdGlvbi5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIFRBQl9MQUJFTDogJ1Bvc3RhbCBDb2RlcycsXG4gIEtJTkQ6ICdwb3N0YWxjb2RlJyxcblxuICBkZWZhdWx0czoge1xuICAgIHN0ZXA6IDAsXG4gICAgY29sdW1uczogW11cbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbihhdHRycykge1xuICAgIGlmICghYXR0cnMuZ2VvY29kZVN0dWZmKSB0aHJvdyBuZXcgRXJyb3IoJ2dlb2NvZGVTdHVmZiBpcyByZXF1aXJlZCcpO1xuICAgIGlmICghYXR0cnMuY29sdW1uc05hbWVzKSB0aHJvdyBuZXcgRXJyb3IoJ2NvbHVtbnNOYW1lcyBpcyByZXF1aXJlZCcpO1xuICAgIGlmICghYXR0cnMuY29sdW1ucykgdGhyb3cgbmV3IEVycm9yKCdjb2x1bW5zIGlzIHJlcXVpcmVkJyk7XG4gIH0sXG5cbiAgY3JlYXRlVmlldzogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5faW5pdFJvd3MoKTtcbiAgICB0aGlzLl9zZXRTdGF0ZUZvckZpcnN0U3RlcCgpO1xuXG4gICAgcmV0dXJuIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5TGlzdChbXG4gICAgICBuZXcgU3RlcHNWaWV3KHtcbiAgICAgICAgdGl0bGU6ICdTZWxlY3QgdGhlIGNvbHVtbiB0aGF0IGhhcyB0aGUgUG9zdGFsIENvZGVzJyxcbiAgICAgICAgZGVzYzogJ0dlb3JlZmVyZW5jZSB5b3VyIGRhdGEgYnkgcG9zdGFsIGNvZGVzLicsXG4gICAgICAgIG1vZGVsOiB0aGlzXG4gICAgICB9KSxcbiAgICAgIG5ldyBEZWZhdWx0Rm9vdGVyVmlldyh7XG4gICAgICAgIG1vZGVsOiB0aGlzXG4gICAgICB9KVxuICAgIF0pO1xuICB9LFxuXG4gIGFzc2VydElmQ2FuQ29udGludWU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB2YWx1ZSA9IHRoaXMuZ2V0KCdzdGVwJykgPT09IDAgPyB0aGlzLl9jb2x1bW5OYW1lVmFsdWUoKSA6IHRoaXMuZ2V0KCdnZW9tZXRyeVR5cGUnKTtcbiAgICB0aGlzLnNldCgnY2FuQ29udGludWUnLCAhIXZhbHVlKTtcbiAgfSxcblxuICBjb250aW51ZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuZ2V0KCdzdGVwJykgPT09IDApIHtcbiAgICAgIHRoaXMuX3NldFN0YXRlRm9yU2Vjb25kU3RlcCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9nZW9jb2RlKCk7XG4gICAgfVxuICB9LFxuXG4gIGdvQmFjazogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fc2V0U3RhdGVGb3JGaXJzdFN0ZXAoKTtcbiAgfSxcblxuICBhdmFpbGFibGVHZW9tZXRyaWVzRmV0Y2hEYXRhOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2dlb2NvZGVTdHVmZicpLmF2YWlsYWJsZUdlb21ldHJpZXNGZXRjaERhdGEodGhpcy5LSU5ELCB0aGlzLl9sb2NhdGlvblZhbHVlKCksIHRoaXMuX2lzTG9jYXRpb25GcmVlVGV4dCgpKTtcbiAgfSxcblxuICBfc2V0U3RhdGVGb3JGaXJzdFN0ZXA6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0KHtcbiAgICAgIHN0ZXA6IDAsXG4gICAgICBjYW5Hb0JhY2s6IGZhbHNlLFxuICAgICAgY2FuQ29udGludWU6IGZhbHNlLFxuICAgICAgaGlkZUZvb3RlcjogZmFsc2VcbiAgICB9KTtcbiAgfSxcblxuICBfc2V0U3RhdGVGb3JTZWNvbmRTdGVwOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldCh7XG4gICAgICBzdGVwOiAxLFxuICAgICAgY2FuR29CYWNrOiB0cnVlLFxuICAgICAgY2FuQ29udGludWU6IGZhbHNlLFxuICAgICAgaGlkZUZvb3RlcjogdHJ1ZSxcbiAgICAgIGdlb21ldHJ5VHlwZTogJydcbiAgICB9KTtcbiAgfSxcblxuICBfZ2VvY29kZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGQgPSB0aGlzLmdldCgnZ2VvY29kZVN0dWZmJykuZ2VvY29kaW5nQ2hvc2VuRGF0YSh7XG4gICAgICB0eXBlOiAncG9zdGFsJyxcbiAgICAgIGtpbmQ6IHRoaXMuS0lORCxcbiAgICAgIGxvY2F0aW9uOiB0aGlzLl9sb2NhdGlvblZhbHVlKCksXG4gICAgICBjb2x1bW5fbmFtZTogdGhpcy5fY29sdW1uTmFtZVZhbHVlKCksXG4gICAgICBnZW9tZXRyeV90eXBlOiB0aGlzLmdldCgnZ2VvbWV0cnlUeXBlJylcbiAgICB9LCB0aGlzLl9pc0xvY2F0aW9uRnJlZVRleHQoKSwgdHJ1ZSk7XG5cbiAgICB0aGlzLnNldCgnZ2VvY29kZURhdGEnLCBkKTtcbiAgfSxcblxuICBfaW5pdFJvd3M6IGZ1bmN0aW9uKCkge1xuICAgIHZhciByb3dzID0gbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oW1xuICAgICAgbmV3IFJvd01vZGVsKHtcbiAgICAgICAgY29tYm9WaWV3Q2xhc3M6ICdDb21ibycsXG4gICAgICAgIGxhYmVsOiAnSW4gd2hpY2ggY29sdW1uIGFyZSB5b3VyIHBvc3RhbCBjb2RlcyBzdG9yZWQ/JyxcbiAgICAgICAgcGxhY2Vob2xkZXI6ICdTZWxlY3QgY29sdW1uJyxcbiAgICAgICAgZGF0YTogdGhpcy5nZXQoJ2NvbHVtbnNOYW1lcycpXG4gICAgICB9KSxcbiAgICAgIG5ldyBSb3dNb2RlbCh7XG4gICAgICAgIGxhYmVsOiAnQ291bnRyeSB3aGVyZSBwb3N0YWwgY29kZXMgYXJlIGxvY2F0ZWQsIGlmIGtub3duJyxcbiAgICAgICAgZGF0YTogdGhpcy5nZXQoJ2NvbHVtbnMnKVxuICAgICAgfSlcbiAgICBdKTtcbiAgICB0aGlzLnNldCgncm93cycsIHJvd3MpO1xuICB9LFxuXG4gIF9jb2x1bW5OYW1lVmFsdWU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgncm93cycpLmZpcnN0KCkuZ2V0KCd2YWx1ZScpO1xuICB9LFxuXG4gIF9sb2NhdGlvblZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fbG9jYXRpb24oKS5nZXQoJ3ZhbHVlJyk7XG4gIH0sXG5cbiAgX2lzTG9jYXRpb25GcmVlVGV4dDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xvY2F0aW9uKCkuZ2V0KCdpc0ZyZWVUZXh0Jyk7XG4gIH0sXG5cbiAgX2xvY2F0aW9uOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3Jvd3MnKS5sYXN0KCk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBSb3dWaWV3ID0gcmVxdWlyZSgnLi9yb3dfdmlldycpO1xuXG4vKipcbiAqIE1vZGVsIGZvciBhbiBpbmRpdmlkdWFsIHJvd1xuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgZGVmYXVsdHM6IHtcbiAgICBjb21ib1ZpZXdDbGFzczogJ0N1c3RvbVRleHRDb21ibycsXG4gICAgbGFiZWw6ICcnLFxuICAgIHBsYWNlaG9sZGVyOiAnU2VsZWN0IGNvbHVtbiBvciB0eXBlIGl0JyxcbiAgICBpc0ZyZWVUZXh0OiBmYWxzZSxcbiAgICBkYXRhOiBbXVxuICB9LFxuXG4gIGNyZWF0ZVZpZXc6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgUm93Vmlldyh7XG4gICAgICBtb2RlbDogdGhpc1xuICAgIH0pO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogVmlldyBmb3IgdGhlIHN0cmVldCBhZGRyZXNzZXMgZ2VvcmVmZXJlbmNlIG9wdGlvbi5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgY2xhc3NOYW1lOiAnRm9ybS1yb3cgRm9ybS1yb3ctLXN0ZXAnLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIHRoaXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2dlb3JlZmVyZW5jZS9yb3cnKSh7XG4gICAgICAgIGxhYmVsOiB0aGlzLm1vZGVsLmdldCgnbGFiZWwnKVxuICAgICAgfSlcbiAgICApO1xuICAgIHRoaXMuJCgnLmpzLXNlbGVjdCcpLmFwcGVuZCh0aGlzLl9zZWxlY3RWaWV3LnJlbmRlcigpLmVsKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTp2YWx1ZScsIHRoaXMuX29uQ2hhbmdlVmFsdWUsIHRoaXMpO1xuICB9LFxuXG4gIF9pbml0Vmlld3M6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3NlbGVjdFZpZXcgPSBuZXcgY2RiLmZvcm1zW3RoaXMubW9kZWwuZ2V0KCdjb21ib1ZpZXdDbGFzcycpXSh7XG4gICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgIHBsYWNlaG9sZGVyOiB0aGlzLm1vZGVsLmdldCgncGxhY2Vob2xkZXInKSxcbiAgICAgIGRpc2FibGVkOiB0aGlzLm1vZGVsLmdldCgnZGlzYWJsZWQnKSxcbiAgICAgIGV4dHJhOiB0aGlzLm1vZGVsLmdldCgnZGF0YScpLFxuICAgICAgY2xhc3NOYW1lOiAnU2VsZWN0JyxcbiAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICBwcm9wZXJ0eTogJ3ZhbHVlJyxcblxuICAgICAgLy8gVGhpcyBpcyBvbmx5IG5lZWRlZCBmb3IgYSBDb21ib0ZyZWVUZXh0IHZpZXcsIGJ1dCBkb2Vzbid0IGh1cnQgZm9yIHRoZSBub3JtYWwgQ29tYm8gc28gbGV0J3MgbGVhdmUgaXRcbiAgICAgIHRleHQ6ICdpc0ZyZWVUZXh0J1xuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLl9zZWxlY3RWaWV3KTtcblxuICAgIC8vIFNpbXVsYXRlIGEgaW5pdGlhbCBzZWxlY3Rpb24gdG8gdXBkYXRlIG1vZGVsIHRvIGJlIGluIHN5bmMgd2l0aCB0aGUgdmlld1xuICAgIHRoaXMuX3NlbGVjdFZpZXcucmVuZGVyKCkuX2NoYW5nZVNlbGVjdGlvbigpO1xuICB9LFxuXG4gIF9vbkNoYW5nZVZhbHVlOiBmdW5jdGlvbihtLCB2YWwpIHtcbiAgICB0aGlzLiRlbC50b2dnbGVDbGFzcygnaXMtZG9uZScsICEhdmFsKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqIFZpZXcgdG8gcmVuZGVyIGEgc2V0IG9mIHJvd3MuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy5fcmVuZGVyUm93cygpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciByb3dzID0gdGhpcy5tb2RlbC5nZXQoJ3Jvd3MnKTtcbiAgICByb3dzLmJpbmQoJ2NoYW5nZScsIHRoaXMubW9kZWwuYXNzZXJ0SWZDYW5Db250aW51ZSwgdGhpcy5tb2RlbCk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbChyb3dzKTtcbiAgfSxcblxuICBfcmVuZGVyUm93czogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5nZXQoJ3Jvd3MnKS5jaGFpbigpXG4gICAgICAubWFwKHRoaXMuX2NyZWF0ZVJvd1ZpZXcsIHRoaXMpXG4gICAgICAubWFwKHRoaXMuX2FwcGVuZFJvd1RvRE9NLCB0aGlzKTtcbiAgfSxcblxuICBfY3JlYXRlUm93VmlldzogZnVuY3Rpb24obSkge1xuICAgIHZhciB2aWV3ID0gbS5jcmVhdGVWaWV3KCk7XG4gICAgdGhpcy5hZGRWaWV3KHZpZXcpO1xuICAgIHJldHVybiB2aWV3O1xuICB9LFxuXG4gIF9hcHBlbmRSb3dUb0RPTTogZnVuY3Rpb24odmlldykge1xuICAgIHRoaXMuJGVsLmFwcGVuZCh2aWV3LnJlbmRlcigpLmVsKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIFJvd3NWaWV3ID0gcmVxdWlyZSgnLi9yb3dzX3ZpZXcnKTtcbnZhciBDaG9vc2VHZW9tZXRyeVZpZXcgPSByZXF1aXJlKCcuL2Nob29zZV9nZW9tZXRyeV92aWV3Jyk7XG52YXIgVmlld0ZhY3RvcnkgPSByZXF1aXJlKCcuLi8uLi92aWV3X2ZhY3RvcnknKTtcblxuLyoqXG4gKiBWaWV3IGZvciB0aGUgZ2VvcmVmZXJlbmNlIHR5cGVzIHRoYXQgcmVxdWlyZXMgdGhlIHR3by1zdGVwcyBmbG93LlxuICogRmlyc3Qgc2VsZWN0IGNvbHVtbnMgdmFsdWVzLCBhbmQgdGhlbiB0aGUgZ2VvbWV0cnkgdHlwZSB0byB1c2UuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG5cbiAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3N0ZXAnKSA9PT0gMSkge1xuICAgICAgdGhpcy5fcmVuZGVyQ2hvb3NlR2VvbWV0cnkoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fcmVuZGVySGVhZGVyKCk7XG4gICAgICB0aGlzLl9yZW5kZXJSb3dzKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX3JlbmRlckhlYWRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fYXBwZW5kVmlldyhcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2dlb3JlZmVyZW5jZS9kZWZhdWx0X2NvbnRlbnRfaGVhZGVyJywge1xuICAgICAgICB0aXRsZTogdGhpcy5vcHRpb25zLnRpdGxlLFxuICAgICAgICBkZXNjOiB0aGlzLm9wdGlvbnMuZGVzY1xuICAgICAgfSlcbiAgICApO1xuICB9LFxuXG4gIF9yZW5kZXJSb3dzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9hcHBlbmRWaWV3KFxuICAgICAgbmV3IFJvd3NWaWV3KHtcbiAgICAgICAgbW9kZWw6IHRoaXMubW9kZWxcbiAgICAgIH0pXG4gICAgKTtcbiAgfSxcblxuICBfcmVuZGVyQ2hvb3NlR2VvbWV0cnk6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2FwcGVuZFZpZXcoXG4gICAgICBuZXcgQ2hvb3NlR2VvbWV0cnlWaWV3KHtcbiAgICAgICAgbW9kZWw6IHRoaXMubW9kZWxcbiAgICAgIH0pXG4gICAgKTtcbiAgfSxcblxuICBfYXBwZW5kVmlldzogZnVuY3Rpb24odmlldykge1xuICAgIHRoaXMuYWRkVmlldyh2aWV3KTtcbiAgICB0aGlzLiRlbC5hcHBlbmQodmlldy5yZW5kZXIoKS4kZWwpO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOnN0ZXAnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gIH1cblxufSk7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdHZW9yZWZlcmVuY2UtZXN0aW1hdGlvbicsXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCFfLmlzQm9vbGVhbih0aGlzLm9wdGlvbnMuaGFzSGFyZExpbWl0KSkgdGhyb3cgbmV3IEVycm9yKCdoYXNIYXJkTGltaXQgaXMgcmVxdWlyZWQnKTtcbiAgICBpZiAoIXRoaXMub3B0aW9ucy51c2VyR2VvY29kaW5nKSB0aHJvdyBuZXcgRXJyb3IoJ3VzZXJHZW9jb2RpbmcgaXMgcmVxdWlyZWQnKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlc3RpbWF0aW9uID0gdGhpcy5tb2RlbC5nZXQoJ2VzdGltYXRpb24nKTtcbiAgICB2YXIgcm93cyA9IHRoaXMubW9kZWwuZ2V0KCdyb3dzJyk7XG5cbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGhpcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL3N0cmVldF9hZGRyZXNzZXMvZXN0aW1hdGlvbicpKHtcbiAgICAgICAgaGFzRXN0aW1hdGlvbjogZXN0aW1hdGlvbiAhPT0gdW5kZWZpbmVkICYmIHJvd3MgIT09IHVuZGVmaW5lZCxcbiAgICAgICAgaGFzSGFyZExpbWl0OiB0aGlzLm9wdGlvbnMuaGFzSGFyZExpbWl0LFxuICAgICAgICBjb3N0SW5DcmVkaXRzOiB0aGlzLm1vZGVsLmNvc3RJbkNyZWRpdHMoKSxcbiAgICAgICAgY29zdEluRG9sbGFyczogdGhpcy5tb2RlbC5jb3N0SW5Eb2xsYXJzKCksXG4gICAgICAgIGJsb2NrUHJpY2VJbkRvbGxhcnM6IHRoaXMub3B0aW9ucy51c2VyR2VvY29kaW5nLmJsb2NrUHJpY2VJbkRvbGxhcnMoKSxcbiAgICAgICAgaGFzUm93czogcm93cyAhPT0gMFxuICAgICAgfSlcbiAgICApO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlIGVycm9yJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ0dlb3JlZmVyZW5jZS1xdW90YScsXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGhpcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL3N0cmVldF9hZGRyZXNzZXMvcXVvdGEnKSh7XG4gICAgICAgIHF1b3RhTGVmdDogdGhpcy5tb2RlbC5xdW90YUxlZnRUaGlzTW9udGgoKSxcbiAgICAgICAgcXVvdGFVc2VkSW5QY3Q6IHRoaXMubW9kZWwucXVvdGFVc2VkVGhpc01vbnRoSW5QY3QoKVxuICAgICAgfSlcbiAgICApO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbn0pO1xuIiwidmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBtb21lbnQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snbW9tZW50J10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydtb21lbnQnXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgU3RyZWV0QWRkcmVzc2VzVmlldyA9IHJlcXVpcmUoJy4vc3RyZWV0X2FkZHJlc3Nlc192aWV3Jyk7XG52YXIgUm93TW9kZWwgPSByZXF1aXJlKCcuLi9yb3dfbW9kZWwnKTtcbnZhciBTdHJlZXRSb3dNb2RlbCA9IHJlcXVpcmUoJy4vc3RyZWV0X3Jvd19tb2RlbCcpO1xuXG4vKipcbiAqIE1vZGVsIGZvciB0aGUgc3RyZWV0IGFkZHJlc3NlcyBnZW9yZWZlcmVuY2Ugb3B0aW9uLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgVEFCX0xBQkVMOiAnU3RyZWV0IEFkZHJlc3NlcycsXG4gIE1BWF9TVFJFRVRfUk9XUzogMyxcblxuICBkZWZhdWx0czoge1xuICAgIGNvbHVtbnNOYW1lczogW10sXG4gICAgY29sdW1uczogW10sXG4gICAgZXN0aW1hdGlvbjogdW5kZWZpbmVkXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oYXR0cnMpIHtcbiAgICBpZiAoIWF0dHJzLmdlb2NvZGVTdHVmZikgdGhyb3cgbmV3IEVycm9yKCdnZW9jb2RlU3R1ZmYgaXMgcmVxdWlyZWQnKTtcbiAgICBpZiAoIV8uaXNCb29sZWFuKGF0dHJzLmlzR29vZ2xlTWFwc1VzZXIpKSB0aHJvdyBuZXcgRXJyb3IoJ2lzR29vZ2xlTWFwc1VzZXIgaXMgcmVxdWlyZWQnKTtcbiAgICBpZiAoIWF0dHJzLnVzZXJHZW9jb2RpbmcpIHRocm93IG5ldyBFcnJvcigndXNlckdlb2NvZGluZyBpcyByZXF1aXJlZCcpO1xuICAgIGlmICghYXR0cnMuY29sdW1ucykgdGhyb3cgbmV3IEVycm9yKCdjb2x1bW5zIGlzIHJlcXVpcmVkJyk7XG4gICAgaWYgKCFhdHRycy5lc3RpbWF0aW9uKSB0aHJvdyBuZXcgRXJyb3IoJ2VzdGltYXRpb24gaXMgcmVxdWlyZWQnKTsgLy8gY2RiLmFkbWluLkdlb2NvZGluZ3MuRXN0aW1hdGlvbnNcbiAgfSxcblxuICBjcmVhdGVWaWV3OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldCh7XG4gICAgICBjYW5Db250aW51ZTogZmFsc2UsXG4gICAgICBoaWRlRm9vdGVyOiBmYWxzZSxcbiAgICAgIG11c3RBZ3JlZVRvVE9TOiBmYWxzZSxcbiAgICAgIGNvbmZpcm1UT1M6IGZhbHNlLFxuICAgICAgaGFzQWdyZWVkVG9UT1M6IGZhbHNlXG4gICAgfSk7XG4gICAgdGhpcy5faW5pdFJvd3MoKTtcblxuICAgIHJldHVybiBuZXcgU3RyZWV0QWRkcmVzc2VzVmlldyh7XG4gICAgICBtb2RlbDogdGhpc1xuICAgIH0pO1xuICB9LFxuXG4gIGlzRGlzYWJsZWQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAhdGhpcy5nZXQoJ2lzR29vZ2xlTWFwc1VzZXInKSAmJiB0aGlzLmdldCgndXNlckdlb2NvZGluZycpLmhhc1JlYWNoZWRNb250aGx5UXVvdGEoKTtcbiAgfSxcblxuICBzaG93Q29zdHNJbmZvOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gIXRoaXMuZ2V0KCdpc0dvb2dsZU1hcHNVc2VyJyk7XG4gIH0sXG5cbiAgZ2V0Rm9ybWF0dGVySXRlbUJ5Um93OiBmdW5jdGlvbihtKSB7XG4gICAgdmFyIHZhbCA9IG0uZ2V0KCd2YWx1ZScpO1xuICAgIGlmICh2YWwpIHtcbiAgICAgIHJldHVybiBtLmdldCgnaXNGcmVlVGV4dCcpID8gdmFsLnRyaW0oKSA6ICd7JyArIHZhbCArICd9JztcbiAgICB9XG4gIH0sXG5cbiAgYXNzZXJ0SWZDYW5BZGRNb3JlUm93czogZnVuY3Rpb24oKSB7XG4gICAgLy8gSWYgY2FuIGFkZCBtb3JlIHJvd3MsIGVuYWJsZSB0aGUgYWRkIGJ1dHRvbiBvbmx5IG9uIHRoZSBsYXN0IHN0cmVldCByb3dcbiAgICB2YXIgc3RyZWV0Um93cyA9IHRoaXMuZ2V0KCdyb3dzJykuZmlsdGVyKHRoaXMuX2lzU3RyZWV0Um93KTtcbiAgICBfLmludm9rZShzdHJlZXRSb3dzLCAnc2V0JywgJ2NhbkFkZFJvdycsIGZhbHNlKTtcbiAgICBfLmxhc3Qoc3RyZWV0Um93cykuc2V0KCdjYW5BZGRSb3cnLCBzdHJlZXRSb3dzLmxlbmd0aCA8IHRoaXMuTUFYX1NUUkVFVF9ST1dTKTtcbiAgfSxcblxuICBkYXlzTGVmdFRvTmV4dEJpbGxpbmc6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB0b2RheSA9IG1vbWVudCgpLnN0YXJ0T2YoJ2RheScpO1xuICAgIHJldHVybiBtb21lbnQodGhpcy5nZXQoJ2xhc3RCaWxsaW5nRGF0ZScpKS5hZGQoMzAsICdkYXlzJykuZGlmZih0b2RheSwgJ2RheXMnKVxuICB9LFxuXG4gIGNvbnRpbnVlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbXVzdEFncmVlVG9UT1MgPSB0aGlzLmdldCgnbXVzdEFncmVlVG9UT1MnKTtcblxuICAgIGlmICh0aGlzLl9oYXNBZ3JlZWRUb1RPUygpIHx8ICFtdXN0QWdyZWVUb1RPUykge1xuICAgICAgdmFyIGQgPSB0aGlzLmdldCgnZ2VvY29kZVN0dWZmJykuZ2VvY29kaW5nQ2hvc2VuRGF0YSh7XG4gICAgICAgIHR5cGU6ICdhZGRyZXNzJyxcbiAgICAgICAga2luZDogJ2hpZ2gtcmVzb2x1dGlvbicsXG4gICAgICAgIGZvcm1hdHRlcjogdGhpcy5nZXQoJ2Zvcm1hdHRlcicpXG4gICAgICB9KTtcbiAgICAgIHRoaXMuc2V0KCdnZW9jb2RlRGF0YScsIGQpO1xuICAgIH0gZWxzZSBpZiAobXVzdEFncmVlVG9UT1MpIHtcbiAgICAgIHRoaXMuc2V0KCdjb25maXJtVE9TJywgdHJ1ZSk7XG4gICAgfVxuICB9LFxuXG4gIGhhc0hhcmRMaW1pdDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICEhdGhpcy5nZXQoJ3VzZXJHZW9jb2RpbmcnKS5nZXQoJ2hhcmRfbGltaXQnKTtcbiAgfSxcblxuICBfaGFzQWdyZWVkVG9UT1M6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnbXVzdEFncmVlVG9UT1MnKSAmJiB0aGlzLmdldCgnaGFzQWdyZWVkVG9UT1MnKTtcbiAgfSxcblxuICBfaXNTdHJlZXRSb3c6IGZ1bmN0aW9uKHJvdykge1xuICAgIHJldHVybiByb3cgaW5zdGFuY2VvZiBTdHJlZXRSb3dNb2RlbDtcbiAgfSxcblxuICBfaW5pdFJvd3M6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjb2x1bW5zID0gdGhpcy5nZXQoJ2NvbHVtbnMnKTtcbiAgICB2YXIgaXNEaXNhYmxlZCA9IHRoaXMuaXNEaXNhYmxlZCgpO1xuICAgIHZhciByb3dzID0gbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oW1xuICAgICAgbmV3IFN0cmVldFJvd01vZGVsKHtcbiAgICAgICAgbGFiZWw6ICdXaGljaCBjb2x1bW4gYXJlIHlvdXIgc3RyZWV0IGFkZHJlc3NlcyBzdG9yZWQgaW4/JyxcbiAgICAgICAgZGF0YTogY29sdW1ucyxcbiAgICAgICAgY2FuQWRkUm93OiB0cnVlLFxuICAgICAgICBkaXNhYmxlZDogaXNEaXNhYmxlZFxuICAgICAgfSksXG4gICAgICBuZXcgUm93TW9kZWwoe1xuICAgICAgICBsYWJlbDogJ1N0YXRlL3Byb3ZpbmNlIHdoZXJlIGFkZHJlc3MgaXMgbG9jYXRlZCwgaWYga25vd24nLFxuICAgICAgICBkYXRhOiBjb2x1bW5zLFxuICAgICAgICBkaXNhYmxlZDogaXNEaXNhYmxlZFxuICAgICAgfSksXG4gICAgICBuZXcgUm93TW9kZWwoe1xuICAgICAgICBsYWJlbDogJ0NvdW50cnkgd2hlcmUgc3RyZWV0IGFkZHJlc3MgaXMgbG9jYXRlZCwgaWYga25vd24nLFxuICAgICAgICBkYXRhOiBjb2x1bW5zLFxuICAgICAgICBkaXNhYmxlZDogaXNEaXNhYmxlZFxuICAgICAgfSlcbiAgICBdKTtcbiAgICB0aGlzLnNldCgncm93cycsIHJvd3MpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uLy4uL3ZpZXdfZmFjdG9yeScpO1xudmFyIEVzdGltYXRpb25WaWV3ID0gcmVxdWlyZSgnLi9lc3RpbWF0aW9uX3ZpZXcnKTtcbnZhciBRdW90YVZpZXcgPSByZXF1aXJlKCcuL3F1b3RhX3ZpZXcnKTtcbnZhciBEZWZhdWx0Rm9vdGVyVmlldyA9IHJlcXVpcmUoJy4uL2RlZmF1bHRfZm9vdGVyX3ZpZXcnKTtcbnZhciBwbHVyYWxpemVTdHJpbmcgPSByZXF1aXJlKCcuLi8uLi8uLi92aWV3X2hlbHBlcnMvcGx1cmFsaXplX3N0cmluZycpO1xuXG4vKipcbiAqIFZpZXcgdG8gc2VsZWN0IGxvbmcvbGF0IGNvdXBsZSB0byBkbyB0aGUgZ2VvcmVmZXJlbmNlLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICB0aGlzLl9mZXRjaEVzdGltYXRpb24oKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2Uvc3RyZWV0X2FkZHJlc3Nlcy9zdHJlZXRfYWRkcmVzc2VzJykoe1xuICAgICAgfSlcbiAgICApO1xuICAgIHRoaXMuX3JlbmRlckhlYWRlcigpO1xuICAgIHRoaXMuX3JlbmRlclJvd3MoKTtcblxuICAgIHZhciBzaG93Q29zdHNJbmZvID0gdGhpcy5tb2RlbC5zaG93Q29zdHNJbmZvKCk7XG4gICAgaWYgKHNob3dDb3N0c0luZm8pIHtcbiAgICAgIHRoaXMuX3JlbmRlckVzdGltYXRpb24oKTtcbiAgICAgIHRoaXMuX3JlbmRlclF1b3RhKCk7XG4gICAgfVxuICAgIHRoaXMuJCgnLmpzLWNvc3RzLWluZm8nKS50b2dnbGUoISFzaG93Q29zdHNJbmZvKTtcblxuICAgIHRoaXMuX3JlbmRlckZvb3RlcigpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9yZW5kZXJIZWFkZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB2aWV3ID0gVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL2RlZmF1bHRfY29udGVudF9oZWFkZXInLCB7XG4gICAgICB0aXRsZTogJ1NlbGVjdCB0aGUgY29sdW1uKHMpIHRoYXQgaGFzIHlvdXIgc3RyZWV0IGFkZHJlc3MnLFxuICAgICAgZGVzYzogJ1VzZSB0aGlzIG9wdGlvbiBpZiB5b3UgbmVlZCBoaWdoIHJlc29sdXRpb24gZ2VvY29kaW5nIG9mIHlvdXIgc3RyZWV0IGFkcmVzc2VzIGRhdGEuJ1xuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh2aWV3KTtcbiAgICB0aGlzLiRlbC5wcmVwZW5kKHZpZXcucmVuZGVyKCkuJGVsKTtcbiAgfSxcblxuICBfcmVuZGVyUm93czogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fJHJvd3MoKS50b2dnbGVDbGFzcygndS1kaXNhYmxlZCcsICEhdGhpcy5tb2RlbC5pc0Rpc2FibGVkKCkpO1xuICAgIHRoaXMubW9kZWwuZ2V0KCdyb3dzJykuY2hhaW4oKVxuICAgICAgLm1hcCh0aGlzLl9jcmVhdGVSb3dWaWV3LCB0aGlzKVxuICAgICAgLm1hcCh0aGlzLl9hcHBlbmRSb3dUb0RPTSwgdGhpcyk7XG4gIH0sXG5cbiAgX3JlbmRlckVzdGltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgIHZhciB2aWV3ID0gbmV3IEVzdGltYXRpb25WaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLmdldCgnZXN0aW1hdGlvbicpLFxuICAgICAgdXNlckdlb2NvZGluZzogdGhpcy5tb2RlbC5nZXQoJ3VzZXJHZW9jb2RpbmcnKSxcbiAgICAgIGhhc0hhcmRMaW1pdDogdGhpcy5tb2RlbC5oYXNIYXJkTGltaXQoKVxuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh2aWV3KTtcbiAgICB0aGlzLiQoJy5qcy1lc3RpbWF0aW9uJykuYXBwZW5kKHZpZXcucmVuZGVyKCkuZWwpO1xuICB9LFxuXG4gIF9yZW5kZXJRdW90YTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHZpZXcgPSBuZXcgUXVvdGFWaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLmdldCgndXNlckdlb2NvZGluZycpXG4gICAgfSk7XG4gICAgdGhpcy5hZGRWaWV3KHZpZXcpO1xuICAgIHRoaXMuJCgnLmpzLXF1b3RhJykuYXBwZW5kKHZpZXcucmVuZGVyKCkuZWwpO1xuICB9LFxuXG4gIF9yZW5kZXJGb290ZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjb250ZW50O1xuXG4gICAgaWYgKHRoaXMubW9kZWwuaXNEaXNhYmxlZCgpKSB7XG4gICAgICBjb250ZW50ID0gdGhpcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL3N0cmVldF9hZGRyZXNzZXMvdXBncmFkZV9mb290ZXInKSh7XG4gICAgICAgIGNhcnRvZGJfY29tX2hvc3RlZDogY2RiLmNvbmZpZy5nZXQoJ2NhcnRvZGJfY29tX2hvc3RlZCcpLFxuICAgICAgICB1cGdyYWRlVVJMOiBjZGIuY29uZmlnLmdldCgndXBncmFkZV91cmwnKSxcbiAgICAgICAgcGx1cmFsaXplU3RyaW5nOiBwbHVyYWxpemVTdHJpbmcsXG4gICAgICAgIGRheXNMZWZ0VG9OZXh0QmlsbGluZzogdGhpcy5tb2RlbC5kYXlzTGVmdFRvTmV4dEJpbGxpbmcoKVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciB2aWV3ID0gbmV3IERlZmF1bHRGb290ZXJWaWV3KHtcbiAgICAgICAgbW9kZWw6IHRoaXMubW9kZWxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5hZGRWaWV3KHZpZXcpO1xuICAgICAgY29udGVudCA9IHZpZXcucmVuZGVyKCkuJGVsO1xuICAgIH1cblxuICAgIHRoaXMuJGVsLmFwcGVuZChjb250ZW50KTtcbiAgfSxcblxuICBfY3JlYXRlUm93VmlldzogZnVuY3Rpb24obSkge1xuICAgIHZhciB2aWV3ID0gbS5jcmVhdGVWaWV3KCk7XG4gICAgdGhpcy5hZGRWaWV3KHZpZXcpO1xuICAgIHJldHVybiB2aWV3O1xuICB9LFxuXG4gIF9hcHBlbmRSb3dUb0RPTTogZnVuY3Rpb24odmlldykge1xuICAgIHRoaXMuXyRyb3dzKCkuYXBwZW5kKHZpZXcucmVuZGVyKCkuZWwpO1xuICB9LFxuXG4gIF8kcm93czogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuJCgnLmpzLXJvd3MnKTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcm93cyA9IHRoaXMubW9kZWwuZ2V0KCdyb3dzJyk7XG4gICAgcm93cy5iaW5kKCdjaGFuZ2UnLCB0aGlzLl9vbkNoYW5nZVJvd3MsIHRoaXMpO1xuICAgIHJvd3MuYmluZCgnYWRkJywgdGhpcy5fb25BZGRSb3csIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwocm93cyk7XG5cbiAgICB2YXIgZXN0aW1hdGlvbiA9IHRoaXMubW9kZWwuZ2V0KCdlc3RpbWF0aW9uJyk7XG4gICAgZXN0aW1hdGlvbi5iaW5kKCdjaGFuZ2UnLCB0aGlzLl9vbkNoYW5nZUVzdGltYXRpb24sIHRoaXMpO1xuICAgIGVzdGltYXRpb24uYmluZCgnZXJyb3InLCB0aGlzLl9vbkVzdGltYXRpb25FcnJvciwgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbChlc3RpbWF0aW9uKTtcblxuICAgIHZhciBnZW9jb2RlU3R1ZmYgPSB0aGlzLm1vZGVsLmdldCgnZ2VvY29kZVN0dWZmJyk7XG4gICAgZ2VvY29kZVN0dWZmLmJpbmQoJ2NoYW5nZTpmb3JjZUFsbFJvd3MnLCB0aGlzLl9vbkNoYW5nZUZvcmNlQWxsUm93cywgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbChnZW9jb2RlU3R1ZmYpO1xuXG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6Y29uZmlybVRPUycsIHRoaXMuX29uQ2hhbmdlQ29uZmlybVRPUywgdGhpcyk7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6aXNHb29nbGVNYXBzVXNlcicsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgfSxcblxuICBfb25DaGFuZ2VGb3JjZUFsbFJvd3M6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuZ2V0KCdlc3RpbWF0aW9uJykucmVzZXQoKTtcbiAgICB0aGlzLl9mZXRjaEVzdGltYXRpb24oKTtcbiAgfSxcblxuICBfZmV0Y2hFc3RpbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5tb2RlbC5zaG93Q29zdHNJbmZvKCkpIHtcbiAgICAgIHRoaXMubW9kZWwuZ2V0KCdlc3RpbWF0aW9uJykuZmV0Y2goe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgZm9yY2VfYWxsX3Jvd3M6IHRoaXMubW9kZWwuZ2V0KCdnZW9jb2RlU3R1ZmYnKS5nZXQoJ2ZvcmNlQWxsUm93cycpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBfb25DaGFuZ2VSb3dzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZm9ybWF0dGVyID0gdGhpcy5tb2RlbC5nZXQoJ3Jvd3MnKS5jaGFpbigpXG4gICAgICAubWFwKHRoaXMubW9kZWwuZ2V0Rm9ybWF0dGVySXRlbUJ5Um93KVxuICAgICAgLmNvbXBhY3QoKSAvLyB0aGVyZSBtaWdodCBiZSByb3dzIHRoYXQgaGF2ZSBubyB2YWx1ZSwgaWYgc28gc2tpcCB0aGVtXG4gICAgICAudmFsdWUoKS5qb2luKCcsICcpO1xuXG4gICAgdGhpcy5tb2RlbC5zZXQoe1xuICAgICAgZm9ybWF0dGVyOiBmb3JtYXR0ZXIsXG4gICAgICBjYW5Db250aW51ZTogIV8uaXNFbXB0eShmb3JtYXR0ZXIpXG4gICAgfSk7XG4gIH0sXG5cbiAgX29uQWRkUm93OiBmdW5jdGlvbihuZXdSb3csIHJvd3MsIG9wdHMpIHtcbiAgICB2YXIgcm93VmlldyA9IHRoaXMuX2NyZWF0ZVJvd1ZpZXcobmV3Um93KTtcbiAgICB0aGlzLiQoJy5qcy1yb3dzJykuY2hpbGRyZW4oKS5lcShvcHRzLmluZGV4KS5iZWZvcmUocm93Vmlldy5yZW5kZXIoKS5lbCk7XG4gICAgdGhpcy5tb2RlbC5hc3NlcnRJZkNhbkFkZE1vcmVSb3dzKCk7XG4gIH0sXG5cbiAgX29uQ2hhbmdlRXN0aW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIG11c3RBZ3JlZVRvVE9TID0gdGhpcy5tb2RlbC5nZXQoJ2VzdGltYXRpb24nKS5tYXlIYXZlQ29zdCgpICYmICF0aGlzLm1vZGVsLmhhc0hhcmRMaW1pdCgpO1xuICAgIHRoaXMubW9kZWwuc2V0KCdtdXN0QWdyZWVUb1RPUycsIG11c3RBZ3JlZVRvVE9TKTtcbiAgfSxcblxuICBfb25Fc3RpbWF0aW9uRXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgIC8vIEZvcmNlIHJlLXJlbmRlciwgaGFuZGxlZCBpbiBzdWJ2aWV3XG4gICAgdGhpcy5tb2RlbC5nZXQoJ2VzdGltYXRpb24nKS5zZXQoe1xuICAgICAgZXN0aW1hdGlvbjogLTEsXG4gICAgICByb3dzOiAtMVxuICAgIH0pO1xuICB9LFxuXG4gIF9vbkNoYW5nZUNvbmZpcm1UT1M6IGZ1bmN0aW9uKG0sIGNvbmZpcm1UT1MpIHtcbiAgICBpZiAoY29uZmlybVRPUykge1xuICAgICAgdGhpcy5tb2RlbC5zZXQoJ2NvbmZpcm1UT1MnLCBmYWxzZSwgeyBzaWxlbnQ6IHRydWUgfSk7IC8vIHRvIHJlLXJlbmFibGUgaWYgY2FuY2VsbGVkXG4gICAgICB2YXIgdmlldyA9IFZpZXdGYWN0b3J5LmNyZWF0ZURpYWxvZ0J5VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2dlb3JlZmVyZW5jZS9zdHJlZXRfYWRkcmVzc2VzL2NvbmZpcm1fdG9zJywge1xuICAgICAgICAvLyB0ZW1wbGF0ZSBkYXRhXG4gICAgICAgIGNvc3RJbkRvbGxhcnM6IHRoaXMubW9kZWwuZ2V0KCdlc3RpbWF0aW9uJykuY29zdEluRG9sbGFycygpXG4gICAgICB9LCB7XG4gICAgICAgIC8vIGRpYWxvZyBvcHRpb25zXG4gICAgICAgIHRyaWdnZXJEaWFsb2dFdmVudHM6IGZhbHNlLCAvLyB0byBhdm9pZCBjbG9zaW5nIHRoaXMgbW9kYWxcbiAgICAgICAgZW50ZXJfdG9fY29uZmlybTogdHJ1ZSxcbiAgICAgICAgY2xlYW5fb25faGlkZTogZmFsc2VcbiAgICAgIH0pO1xuICAgICAgdmlldy5vayA9IHRoaXMuX29uQWdyZWVUb1RPUy5iaW5kKHRoaXMpO1xuICAgICAgdGhpcy5hZGRWaWV3KHZpZXcpO1xuICAgICAgdmlldy5hcHBlbmRUb0JvZHkoKTtcbiAgICB9XG4gIH0sXG5cbiAgX29uQWdyZWVUb1RPUzogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5zZXQoJ2hhc0FncmVlZFRvVE9TJywgdHJ1ZSk7XG4gICAgdGhpcy5tb2RlbC5jb250aW51ZSgpO1xuICB9XG5cbn0pO1xuIiwidmFyIFJvd01vZGVsID0gcmVxdWlyZSgnLi4vcm93X21vZGVsJyk7XG52YXIgU3RyZWV0Um93VmlldyA9IHJlcXVpcmUoJy4vc3RyZWV0X3Jvd192aWV3Jyk7XG5cbi8qKlxuICogU3BlY2lhbGl6YXRpb24gZm9yIHRoZSBzdHJlZXQgcm93LCB0byBhZGQgYW4gYWRkaXRvbmFsIHJvd1xuICovXG5tb2R1bGUuZXhwb3J0cyA9IFJvd01vZGVsLmV4dGVuZCh7XG5cbiAgY3JlYXRlVmlldzogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBTdHJlZXRSb3dWaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzXG4gICAgfSk7XG4gIH0sXG5cbiAgYWRkUm93OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbmV3Um93TW9kZWwgPSBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih7XG4gICAgICBsYWJlbDogJ0FkZGl0aW9uYWwgaW5mb3JtYXRpb24gdG8gY29tcGxldGUgc3RyZWV0IGFkZHJlc3MnLFxuICAgICAgZGF0YTogdGhpcy5nZXQoJ2RhdGEnKVxuICAgIH0pO1xuICAgIHRoaXMuY29sbGVjdGlvbi5hZGQobmV3Um93TW9kZWwsIHsgYXQ6IHRoaXMuX2luZGV4QWZ0ZXJUaGlzTW9kZWwoKSB9KTtcbiAgfSxcblxuICBfaW5kZXhBZnRlclRoaXNNb2RlbDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuY29sbGVjdGlvbi5pbmRleE9mKHRoaXMpICsgMTtcbiAgfVxuXG59KTtcbiIsInZhciBSb3dWaWV3ID0gcmVxdWlyZSgnLi4vcm93X3ZpZXcnKTtcblxuLyoqXG4gKiBTcGVjaWFsIHZpZXcgZm9yIHRoZSBzdHJlZXQgYWRkcmVzc2VzIGdlb3JlZmVyZW5jZSBvcHRpb25cbiAqIFRoaXMgYWxsb3dzIHRvIHBvdGVudGlhbGx5IGFkZCBtb3JlXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gUm93Vmlldy5leHRlbmQoe1xuXG4gIGV2ZW50czogUm93Vmlldy5leHRlbmRFdmVudHMoe1xuICAgICdjbGljayAuanMtYWRkLXJvdyc6ICdfb25DbGlja0FkZFJvdydcbiAgfSksXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgUm93Vmlldy5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIHRoaXMuX2luaXRTdHJlZXRSb3dCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgUm93Vmlldy5wcm90b3R5cGUucmVuZGVyLmNhbGwodGhpcyk7XG4gICAgaWYgKCF0aGlzLm1vZGVsLmdldCgnZGlzYWJsZWQnKSkge1xuICAgICAgdGhpcy4kZWwuYXBwZW5kKFxuICAgICAgICB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2Uvc3RyZWV0X2FkZHJlc3Nlcy9yb3dfYWRkX3JvdycpKClcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0U3RyZWV0Um93QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOmNhbkFkZFJvdycsIHRoaXMuX29uQ2hhbmdlQ2FuQWRkUm93LCB0aGlzKTtcbiAgfSxcblxuICBfb25DbGlja0FkZFJvdzogZnVuY3Rpb24oZXYpIHtcbiAgICB0aGlzLmtpbGxFdmVudChldik7XG4gICAgdGhpcy5tb2RlbC5hZGRSb3coKTtcbiAgfSxcblxuICBfb25DaGFuZ2VDYW5BZGRSb3c6IGZ1bmN0aW9uKG0sIGNhbkFkZFJvdykge1xuICAgIHRoaXMuJCgnLmpzLWFkZC1yb3cnKS50b2dnbGUoISFjYW5BZGRSb3cpO1xuICB9XG5cbn0pO1xuIiwidmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcblxuLyoqXG4gKiBWaWV3IGZvciBhbiBpbmR2aWR1YWwgdGFiIGl0ZW1cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgdGFnTmFtZTogJ2xpJyxcbiAgY2xhc3NOYW1lOiAnRmlsdGVycy10eXBlSXRlbSBGaWx0ZXJzLXR5cGVJdGVtLS1tb3JlTWFyZ2lucycsXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy1idG4nOiAnX29uQ2xpY2snXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcblxuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9nZW9yZWZlcmVuY2UvdGFiX2l0ZW0nKSh7XG4gICAgICAgIGxhYmVsOiB0aGlzLm1vZGVsLlRBQl9MQUJFTCxcbiAgICAgICAgaXNEaXNhYmxlZDogdGhpcy5tb2RlbC5nZXQoJ2Rpc2FibGVkJylcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLl9vbkNoYW5nZVNlbGVjdGVkKHRoaXMubW9kZWwsIHRoaXMubW9kZWwuZ2V0KCdzZWxlY3RlZCcpKTtcbiAgICB0aGlzLl9vbkNoYW5nZURpc2FibGVkKHRoaXMubW9kZWwsIHRoaXMubW9kZWwuZ2V0KCdkaXNhYmxlZCcpKTtcbiAgICB0aGlzLl9jcmVhdGVEaXNhYmxlZFRvb2x0aXAoKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOnNlbGVjdGVkJywgdGhpcy5fb25DaGFuZ2VTZWxlY3RlZCwgdGhpcyk7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6ZGlzYWJsZWQnLCB0aGlzLl9vbkNoYW5nZURpc2FibGVkLCB0aGlzKTtcbiAgfSxcblxuICBfb25DaGFuZ2VTZWxlY3RlZDogZnVuY3Rpb24obSwgaXNTZWxlY3RlZCkge1xuICAgIHRoaXMuJCgnYnV0dG9uJykudG9nZ2xlQ2xhc3MoJ2lzLXNlbGVjdGVkJywgISFpc1NlbGVjdGVkKTtcbiAgfSxcblxuICBfb25DaGFuZ2VEaXNhYmxlZDogZnVuY3Rpb24obSwgaXNEaXNhYmxlZCkge1xuICAgIGlzRGlzYWJsZWQgPyB0aGlzLnVuZGVsZWdhdGVFdmVudHMoKSA6IHRoaXMuZGVsZWdhdGVFdmVudHMoKTtcbiAgfSxcblxuICBfY3JlYXRlRGlzYWJsZWRUb29sdGlwOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbXNnID0gdGhpcy5tb2RlbC5nZXQoJ2Rpc2FibGVkJyk7XG4gICAgaWYgKCFfLmlzRW1wdHkobXNnKSkge1xuICAgICAgdGhpcy5hZGRWaWV3KFxuICAgICAgICBuZXcgY2RiLmNvbW1vbi5UaXBzeVRvb2x0aXAoe1xuICAgICAgICAgIGVsOiB0aGlzLiQoJy5qcy1idG4nKSxcbiAgICAgICAgICBmYWxsYmFjazogbXNnLFxuICAgICAgICAgIGdyYXZpdHk6ICdzJyxcbiAgICAgICAgICBvZmZzZXQ6IC0zMFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9XG4gIH0sXG5cbiAgX29uQ2xpY2s6IGZ1bmN0aW9uKGV2KSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZXYpO1xuICAgIHRoaXMubW9kZWwuc2V0KCdzZWxlY3RlZCcsIHRydWUpO1xuICB9XG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqIEEgdmFsdWUgb2JqZWN0IHRvIGVuY2Fwc3VsYXRlIGxvZ2ljIHJlbGF0ZWQgdG8gdXNlciB2aWV3IG1vZGVsLlxuICpcbiAqIEV4cGVjdGVkIHRvIGJlIGNyZWF0ZSB3aXRoIGdlb2NvZGluZyB2YWx1ZSBmcm9tIGFuIHVzZXIsIGUuZy46XG4gKiAgIG5ldyBVc2VyR2VvY29kaW5nKHVzZXIuZ2V0KCdnZW9jb2RpbmcnKSk7XG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBkZWZhdWx0czoge1xuICAgIHF1b3RhOiBudWxsLCAvLyBpcyBiYXNlZCBvbiBtb250aGx5IHVzYWdlXG4gICAgYmxvY2tfcHJpY2U6IG51bGwsIC8vIGNvc3QgKGluIGNlbnRzKSBwZXIgZWFjaCAxMDAwIGNyZWRpdHMgZXh0cmFcbiAgICBtb250aGx5X3VzZTogMCxcbiAgICBoYXJkX2xpbWl0OiBmYWxzZVxuICB9LFxuXG4gIGhhc1F1b3RhOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcXVvdGEgPSB0aGlzLmdldCgncXVvdGEnKTtcbiAgICByZXR1cm4gcXVvdGEgIT09IG51bGwgJiYgcXVvdGEgIT09IHVuZGVmaW5lZCAmJiBxdW90YSAhPT0gJyc7XG4gIH0sXG5cbiAgaGFzUmVhY2hlZE1vbnRobHlRdW90YTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdoYXJkX2xpbWl0JykgJiYgdGhpcy5fbWF5YmUoZnVuY3Rpb24ocXVvdGEsIG1vbnRobHlVc2UpIHtcbiAgICAgIHJldHVybiAobW9udGhseVVzZSA+PSBxdW90YSk7XG4gICAgfSwgZmFsc2UpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBxdW90YSBsZWZ0LlxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IGEgbm9uLW5lZ2F0aXZlIG51bWJlciAoLmUuZyBpbiB0aGUgY2FzZSBvZiBtb250aGx5IHVzYWdlIGV4Y2VlZHMgdGhlIHF1b3RhLCByZXR1cm5zIDApXG4gICAqL1xuICBxdW90YUxlZnRUaGlzTW9udGg6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9tYXliZShmdW5jdGlvbihxdW90YSwgbW9udGhseVVzZSkge1xuICAgICAgcmV0dXJuIE1hdGgubWF4KHF1b3RhIC0gbW9udGhseVVzZSwgMCk7XG4gICAgfSwgMCk7XG4gIH0sXG5cbiAgcXVvdGFVc2VkVGhpc01vbnRoSW5QY3Q6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9tYXliZShmdW5jdGlvbihxdW90YSwgbW9udGhseVVzZSkge1xuICAgICAgcmV0dXJuIChtb250aGx5VXNlICogMTAwKSAvIHF1b3RhO1xuICAgIH0sIDApO1xuICB9LFxuXG4gIGJsb2NrUHJpY2VJbkRvbGxhcnM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBNYXRoLmNlaWwodGhpcy5nZXQoJ2Jsb2NrX3ByaWNlJykgLyAxMDApO1xuICB9LFxuXG4gIC8vIE1ha2Ugc3VyZSBtb250aGx5X3VzZSBhbmQgcXVvdGEgYXJlIHNldFxuICBfbWF5YmU6IGZ1bmN0aW9uKGZuLCBmYWxsYmFja1ZhbCkge1xuICAgIHZhciBtb250aGx5VXNlID0gdGhpcy5nZXQoJ21vbnRobHlfdXNlJyk7XG4gICAgdmFyIHF1b3RhID0gdGhpcy5nZXQoJ3F1b3RhJyk7XG5cbiAgICBpZiAobW9udGhseVVzZSA+PSAwICYmIHF1b3RhID49IDApIHtcbiAgICAgIHJldHVybiBmbihxdW90YSwgbW9udGhseVVzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxsYmFja1ZhbDtcbiAgICB9XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBVdGlscyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXVsnVXRpbHMnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddWydVdGlscyddIDogbnVsbClcblxuLyoqXG4gKiAgTGltaXRzIHJlYWNoIGNvbnRlbnRcbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy10b2dnbGVyJzogJ19vbkx1bXBTdW1DbGljaydcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLm1vZGVsID0gbmV3IGNkYi5jb3JlLk1vZGVsKHtcbiAgICAgIGx1bXBTdW06IGZhbHNlXG4gICAgfSk7XG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2xpbWl0c19yZWFjaC9saW1pdHNfcmVhY2hlZF9jb250ZW50Jyk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgY2FuVXBncmFkZSA9IGNkYi5jb25maWcuZ2V0KCd1cGdyYWRlX3VybCcpICYmICFjZGIuY29uZmlnLmdldCgnY2FydG9kYl9jb21faG9zdGVkJykgJiYgIXRoaXMudXNlci5pc0luc2lkZU9yZygpO1xuICAgIHZhciBjdXJyZW50UGxhbiA9IHRoaXMudXNlci5nZXQoXCJhY2NvdW50X3R5cGVcIik7XG5cbiAgICB2YXIgYXZhaWxhYmxlUGxhbnMgPSBfLmNvbXBhY3QodGhpcy5jb2xsZWN0aW9uLm1hcChmdW5jdGlvbihwbGFuLCBpbmRleCkge1xuICAgICAgdmFyIHByaWNlID0gcGxhbi5nZXQoJ3ByaWNlJyk7XG4gICAgICB2YXIgcGxhbk5hbWUgPSBwbGFuLmdldCgndGl0bGUnKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZTogcGxhbk5hbWUudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgcHJpY2U6IFV0aWxzLmZvcm1hdE51bWJlcihwcmljZSksXG4gICAgICAgIGlzVXNlclBsYW46IHBsYW5OYW1lLnNlYXJjaChjdXJyZW50UGxhbikgIT09IC0xLFxuICAgICAgICBsdW1wU3VtUHJpY2U6IHByaWNlID09IFwiMFwiID8gXCIwXCIgOiBVdGlscy5mb3JtYXROdW1iZXIocGxhbi5nZXQoJ2x1bXBfc3VtJykucHJpY2UpLFxuICAgICAgICBxdW90YTogVXRpbHMucmVhZGFibGl6ZUJ5dGVzKHBsYW4uZ2V0KCdieXRlc19xdW90YScpKS5yZXBsYWNlKC9cXC4wMC9nLCcnKS5yZXBsYWNlKFwiIFwiLCBcIlwiKSxcbiAgICAgICAgbGF5ZXJzOiBwbGFuLmdldCgnbWF4X2xheWVycycpLFxuICAgICAgICBwcml2YXRlTWFwczogcGxhbi5nZXQoJ3ByaXZhdGVfdGFibGVzJyksXG4gICAgICAgIHJlbW92YWJsZUJyYW5kOiBwbGFuLmdldCgncmVtb3ZhYmxlX2JyYW5kJylcbiAgICAgIH1cbiAgICB9KSk7XG5cbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGhpcy50ZW1wbGF0ZSh7XG4gICAgICAgIGx1bXBTdW06IHRoaXMubW9kZWwuZ2V0KCdsdW1wU3VtJyksXG4gICAgICAgIGl0ZW1IaWdobGlnaHRlZDogdGhpcy5fZ2V0SGlnaGxpZ2h0ZWQoYXZhaWxhYmxlUGxhbnMsIHRoaXMudXNlci5nZXQoXCJhY2NvdW50X3R5cGVcIikpLFxuICAgICAgICBjYW5VcGdyYWRlOiBjYW5VcGdyYWRlLFxuICAgICAgICBhdmFpbGFibGVQbGFuczogYXZhaWxhYmxlUGxhbnMsXG4gICAgICAgIG9yZ2FuaXphdGlvbkFkbWluOiB0aGlzLnVzZXIuaXNPcmdPd25lcigpLFxuICAgICAgICBvcmdhbml6YXRpb25Vc2VyOiAodGhpcy51c2VyLmlzSW5zaWRlT3JnKCkgJiYgIXRoaXMudXNlci5pc09yZ093bmVyKCkpLFxuICAgICAgICBjdXN0b21Ib3N0ZWQ6IGNkYi5jb25maWcuZ2V0KCdjYXJ0b2RiX2NvbV9ob3N0ZWQnKSxcbiAgICAgICAgdXBncmFkZVVSTDogY2RiLmNvbmZpZy5nZXQoJ3VwZ3JhZGVfdXJsJyksXG4gICAgICAgIGNhblN0YXJ0VHJpYWw6IHRoaXMudXNlci5jYW5TdGFydFRyaWFsKClcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMuY29sbGVjdGlvbi5iaW5kKCdyZXNldCcsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMuY29sbGVjdGlvbik7XG4gIH0sXG5cbiAgX2dldEhpZ2hsaWdodGVkOiBmdW5jdGlvbihwbGFucywgY3VycmVudFBsYW4pIHtcbiAgICB2YXIgaXRlbSA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSBwbGFucy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgIGlmIChwbGFuc1tpXS5uYW1lLnNlYXJjaChjdXJyZW50UGxhbikgIT09IC0xKSB7XG4gICAgICAgIGl0ZW0gPSBpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXRlbSA8IDIgPyAyIDogMztcbiAgfSxcblxuICBfb25MdW1wU3VtQ2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuc2V0KCdsdW1wU3VtJywgIXRoaXMubW9kZWwuZ2V0KCdsdW1wU3VtJykpO1xuICB9XG5cbn0pXG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBVc2VyUGxhbnNDb2xsZWN0aW9uID0gcmVxdWlyZSgnLi91c2VyX3BsYW5zX2NvbGxlY3Rpb24nKTtcbnZhciBMaW1pdHNSZWFjaGVkQ29udGVudFZpZXcgPSByZXF1aXJlKCcuL2xpbWl0c19yZWFjaGVkX2NvbnRlbnRfdmlldycpO1xudmFyIEJhc2VEaWFsb2cgPSByZXF1aXJlKCcuLi8uLi92aWV3cy9iYXNlX2RpYWxvZy92aWV3Jyk7XG52YXIgcmFuZG9tUXVvdGUgPSByZXF1aXJlKCcuLi8uLi92aWV3X2hlbHBlcnMvcmFuZG9tX3F1b3RlJyk7XG52YXIgVmlld0ZhY3RvcnkgPSByZXF1aXJlKCcuLi8uLi92aWV3X2ZhY3RvcnknKTtcblxuLyoqXG4gKiAgU2hvdyB1cGdyYWRlIHBvc3NpYmlsaXRpZXMgcGVyIHVzZXIgdHlwZVxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VEaWFsb2cuZXh0ZW5kKHtcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLnVzZXJQbGFucyA9IG5ldyBVc2VyUGxhbnNDb2xsZWN0aW9uKG51bGwsIHsgdXNlcjogdGhpcy51c2VyIH0pO1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXJfY29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNhblVwZ3JhZGUgPSBjZGIuY29uZmlnLmdldCgndXBncmFkZV91cmwnKSAmJiAhY2RiLmNvbmZpZy5nZXQoJ2NhcnRvZGJfY29tX2hvc3RlZCcpICYmICF0aGlzLnVzZXIuaXNJbnNpZGVPcmcoKTtcbiAgICB2YXIgb3JnYW5pemF0aW9uQWRtaW5FbWFpbCA9IHRoaXMudXNlci5pc0luc2lkZU9yZygpICYmIHRoaXMudXNlci5vcmdhbml6YXRpb24uZ2V0KCdvd25lcicpLmVtYWlsIHx8ICcnO1xuICAgIHZhciAkZWwgPSAkKGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL2xpbWl0c19yZWFjaC9saW1pdHNfcmVhY2hlZCcpKHtcbiAgICAgIGNhblVwZ3JhZGU6IGNhblVwZ3JhZGUsXG4gICAgICBvcmdhbml6YXRpb25BZG1pbkVtYWlsOiBvcmdhbml6YXRpb25BZG1pbkVtYWlsLFxuICAgICAgb3JnYW5pemF0aW9uQWRtaW46IHRoaXMudXNlci5pc09yZ093bmVyKCksXG4gICAgICBvcmdhbml6YXRpb25Vc2VyOiAodGhpcy51c2VyLmlzSW5zaWRlT3JnKCkgJiYgIXRoaXMudXNlci5pc09yZ093bmVyKCkpLFxuICAgICAgbGF5ZXJzQ291bnQ6IHRoaXMudXNlci5nZXRNYXhMYXllcnMoKSxcbiAgICAgIGN1c3RvbUhvc3RlZDogY2RiLmNvbmZpZy5nZXQoJ2NhcnRvZGJfY29tX2hvc3RlZCcpXG4gICAgfSkpO1xuICAgIHRoaXMuX2luaXRWaWV3cygkZWwpO1xuICAgIHJldHVybiAkZWw7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy51c2VyUGxhbnMuYmluZCgnZXJyb3InLCBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuX3BhbmVzLmFjdGl2ZSgnZXJyb3InKTtcbiAgICB9LCB0aGlzKTtcbiAgICB0aGlzLnVzZXJQbGFucy5iaW5kKCdyZXNldCcsIGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdjb250ZW50Jyk7XG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbCh0aGlzLnVzZXJQbGFucyk7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24oJGVsKSB7XG4gICAgdGhpcy5fcGFuZXMgPSBuZXcgY2RiLnVpLmNvbW1vbi5UYWJQYW5lKHtcbiAgICAgIGVsOiAkZWwuZmluZCgnLmpzLWNvbnRlbnQnKVxuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLl9wYW5lcyk7XG5cbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ2xvYWRpbmcnLFxuICAgICAgVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9sb2FkaW5nJywge1xuICAgICAgICB0aXRsZTogJ0dldHRpbmcgcGxhbnMgaW5mb+KApicsXG4gICAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgICB9KS5yZW5kZXIoKVxuICAgICk7XG5cbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ2Vycm9yJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvZmFpbCcsIHtcbiAgICAgICAgbXNnOiAnU29ycnksIHNvbWV0aGluZyB3ZW50IHdyb25nIHRyeWluZyB0byBnZXQgeW91ciBhdmFpbGFibGUgcGxhbnMuJ1xuICAgICAgfSkucmVuZGVyKClcbiAgICApO1xuXG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdjb250ZW50JyxcbiAgICAgIG5ldyBMaW1pdHNSZWFjaGVkQ29udGVudFZpZXcoe1xuICAgICAgICB1c2VyOiB0aGlzLnVzZXIsXG4gICAgICAgIGNvbGxlY3Rpb246IHRoaXMudXNlclBsYW5zXG4gICAgICB9KS5yZW5kZXIoKVxuICAgICk7XG5cbiAgICB2YXIgY2FuVXBncmFkZSA9IGNkYi5jb25maWcuZ2V0KCd1cGdyYWRlX3VybCcpICYmICFjZGIuY29uZmlnLmdldCgnY2FydG9kYl9jb21faG9zdGVkJykgJiYgIXRoaXMudXNlci5pc0luc2lkZU9yZygpO1xuXG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKGNhblVwZ3JhZGUgPyAnbG9hZGluZycgOiAnY29udGVudCcpO1xuXG4gICAgaWYgKGNhblVwZ3JhZGUpIHtcbiAgICAgIHRoaXMudXNlclBsYW5zLmZldGNoKHtcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHRoaXMudHJpZ2dlcignZXJyb3InKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcblxuLyoqXG4gKiAgVXNlciBwbGFucyBtb2RlbFxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgZGVmYXVsdHM6IHtcbiAgICB0aXRsZTogJycsXG4gICAgZGVzYzogJycsXG4gICAgcHJpY2U6IDAsXG4gICAgdGFibGVzX3F1b3RhOiAnJyxcbiAgICBieXRlc19xdW90YTogMCxcbiAgICBzdXBwb3J0OiAnJyxcbiAgICBwcml2YXRlX3RhYmxlczogZmFsc2UsXG4gICAgcmVtb3ZhYmxlX2JyYW5kOiBmYWxzZSxcbiAgICBtYXhfbGF5ZXJzOiA0XG4gIH1cblxufSkiLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBCYWNrYm9uZSA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydCYWNrYm9uZSddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnQmFja2JvbmUnXSA6IG51bGwpO1xudmFyIFVzZXJQbGFuTW9kZWwgPSByZXF1aXJlKCcuL3VzZXJfcGxhbl9tb2RlbCcpO1xuXG4vKipcbiAqICBVc2VyIHBsYW5zIGNvbGxlY3Rpb25cbiAqXG4gKiAgLSBJdCB3aWxsIGdldCB0aGUgYXZhaWxhYmxlIHBsYW5zIHBlciB1c2VyXG4gKi9cblxuXG5tb2R1bGUuZXhwb3J0cyA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHtcblxuICBtb2RlbDogVXNlclBsYW5Nb2RlbCxcblxuICB1cmw6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAnLy8nICsgY2RiLmNvbmZpZy5nZXQoJ2FjY291bnRfaG9zdCcpICsgJy9hY2NvdW50LycgKyB0aGlzLnVzZXIuZ2V0KCd1c2VybmFtZScpICsgJy5qc29uJ1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKG1vZGVscywgb3B0cykge1xuICAgIGlmICghb3B0cy51c2VyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3VzZXIgbW9kZWwgaXMgbmVlZGVkJylcbiAgICB9XG4gICAgdGhpcy51c2VyID0gb3B0cy51c2VyO1xuICB9LFxuXG4gIHN5bmM6IGZ1bmN0aW9uKG1ldGhvZCwgbW9kZWwsIG9wdGlvbnMpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHBhcmFtcyA9IF8uZXh0ZW5kKHtcbiAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgZGF0YVR5cGU6ICdqc29ucCcsXG4gICAgICB1cmw6IHNlbGYudXJsKCksXG4gICAgICBwcm9jZXNzRGF0YTogZmFsc2VcbiAgICB9LCBvcHRpb25zKTtcblxuICAgIHJldHVybiAkLmFqYXgocGFyYW1zKTtcbiAgfSxcblxuICBwYXJzZTogZnVuY3Rpb24ocikge1xuICAgIHJldHVybiByLmF2YWlsYWJsZV9wbGFuc1xuICB9XG5cbn0pIiwidmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG52YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBHdWVzc2luZ1RvZ2dsZXJWaWV3ID0gcmVxdWlyZSgnLi4vLi4vY3JlYXRlL2Zvb3Rlci9ndWVzc2luZ190b2dnbGVyX3ZpZXcnKTtcbnZhciBQcml2YWN5VG9nZ2xlclZpZXcgPSByZXF1aXJlKCcuLi8uLi9jcmVhdGUvZm9vdGVyL3ByaXZhY3lfdG9nZ2xlcl92aWV3Jyk7XG5cbi8qKlxuICogRm9vdGVyIHZpZXcgZm9yIHRoZSBhZGQgbGF5ZXIgbW9kYWwuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtb2snOiAnX2ZpbmlzaCdcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy51c2VyID0gdGhpcy5vcHRpb25zLnVzZXI7XG4gICAgdGhpcy5ndWVzc2luZ01vZGVsID0gbmV3IGNkYi5jb3JlLk1vZGVsKHsgZ3Vlc3Npbmc6IHRydWUgfSk7XG4gICAgdGhpcy5wcml2YWN5TW9kZWwgPSBuZXcgY2RiLmNvcmUuTW9kZWwoe1xuICAgICAgcHJpdmFjeTogdGhpcy51c2VyLmNhbkNyZWF0ZVByaXZhdGVEYXRhc2V0cygpID8gJ1BSSVZBVEUnIDogJ1BVQkxJQydcbiAgICB9KTtcbiAgICB0aGlzLl90ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL21hcC9hZGRfbGF5ZXIvZm9vdGVyJyk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcblxuICAgIHZhciAkZWwgPSAkKFxuICAgICAgdGhpcy5fdGVtcGxhdGUoe1xuICAgICAgICBjYW5GaW5pc2g6IHRoaXMubW9kZWwuY2FuRmluaXNoKCksXG4gICAgICAgIGxpc3Rpbmc6IHRoaXMubW9kZWwuZ2V0KCdsaXN0aW5nJylcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLiRlbC5odG1sKCRlbCk7XG5cbiAgICB0aGlzLl9pbml0Vmlld3MoKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0Vmlld3M6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBndWVzc2luZ1RvZ2dsZXJWaWV3ID0gbmV3IEd1ZXNzaW5nVG9nZ2xlclZpZXcoe1xuICAgICAgbW9kZWw6IHRoaXMuZ3Vlc3NpbmdNb2RlbCxcbiAgICAgIHVzZXI6IHRoaXMudXNlcixcbiAgICAgIGNyZWF0ZU1vZGVsOiB0aGlzLm1vZGVsXG4gICAgfSk7XG4gICAgdGhpcy4kKCcuanMtZm9vdGVyLWluZm8nKS5hcHBlbmQoZ3Vlc3NpbmdUb2dnbGVyVmlldy5yZW5kZXIoKS5lbCk7XG4gICAgdGhpcy5hZGRWaWV3KGd1ZXNzaW5nVG9nZ2xlclZpZXcpO1xuXG4gICAgdGhpcy5wcml2YWN5VG9nZ2xlclZpZXcgPSBuZXcgUHJpdmFjeVRvZ2dsZXJWaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzLnByaXZhY3lNb2RlbCxcbiAgICAgIHVzZXI6IHRoaXMudXNlcixcbiAgICAgIGNyZWF0ZU1vZGVsOiB0aGlzLm1vZGVsXG4gICAgfSk7XG4gICAgdGhpcy4kKCcuanMtZm9vdGVyQWN0aW9ucycpLnByZXBlbmQodGhpcy5wcml2YWN5VG9nZ2xlclZpZXcucmVuZGVyKCkuZWwpO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLnByaXZhY3lUb2dnbGVyVmlldyk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC51cGxvYWQuYmluZCgnY2hhbmdlJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMubW9kZWwuc2VsZWN0ZWREYXRhc2V0cy5iaW5kKCdhbGwnLCB0aGlzLl91cGRhdGUsIHRoaXMpO1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlJywgdGhpcy5fdXBkYXRlLCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMubW9kZWwudXBsb2FkKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMubW9kZWwuc2VsZWN0ZWREYXRhc2V0cyk7XG4gIH0sXG5cbiAgX3VwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNvbnRlbnRQYW5lID0gdGhpcy5tb2RlbC5nZXQoJ2NvbnRlbnRQYW5lJyk7XG4gICAgdmFyIGxpc3RpbmcgPSB0aGlzLm1vZGVsLmdldCgnbGlzdGluZycpO1xuICAgIGlmIChjb250ZW50UGFuZSA9PT0gJ2xpc3RpbmcnICYmIGxpc3RpbmcgIT09ICdzY3JhdGNoJykge1xuICAgICAgdGhpcy5yZW5kZXIoKS5zaG93KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaGlkZSgpO1xuICAgIH1cbiAgfSxcblxuICBfZmluaXNoOiBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZSk7XG4gICAgaWYgKHRoaXMubW9kZWwuY2FuRmluaXNoKCkpIHtcbiAgICAgIC8vIFNldCBwcm9wZXIgZ3Vlc3NpbmcgdmFsdWVzIGJlZm9yZSBzdGFydGluZyB0aGUgdXBsb2FkXG4gICAgICAvLyBpZiBkaWFsb2cgaXMgaW4gaW1wb3J0IHNlY3Rpb25cbiAgICAgIGlmICh0aGlzLm1vZGVsLmdldCgnbGlzdGluZycpID09PSAnaW1wb3J0Jykge1xuICAgICAgICB0aGlzLm1vZGVsLnVwbG9hZC5zZXQoJ3ByaXZhY3knLCB0aGlzLnByaXZhY3lNb2RlbC5nZXQoJ3ByaXZhY3knKSk7XG4gICAgICAgIHRoaXMubW9kZWwudXBsb2FkLnNldEd1ZXNzaW5nKHRoaXMuZ3Vlc3NpbmdNb2RlbC5nZXQoJ2d1ZXNzaW5nJykpO1xuICAgICAgfVxuICAgICAgdGhpcy5tb2RlbC5maW5pc2goKTtcbiAgICB9XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIFVwbG9hZE1vZGVsID0gcmVxdWlyZSgnLi4vLi4vYmFja2dyb3VuZF9wb2xsaW5nL21vZGVscy91cGxvYWRfbW9kZWwnKTtcbnZhciBWaXNGZXRjaE1vZGVsID0gcmVxdWlyZSgnLi4vLi4vdmlzdWFsaXphdGlvbnNfZmV0Y2hfbW9kZWwnKTtcblxudmFyIElNUE9SVCA9ICdpbXBvcnQnO1xudmFyIERBVEFTRVRTID0gJ2RhdGFzZXRzJztcbnZhciBTQ1JBVENIID0gJ3NjcmF0Y2gnO1xuXG52YXIgSU1QT1JUX0ZJTEUgPSAnZmlsZSc7XG52YXIgSU1QT1JUX1RXSVRURVIgPSAndHdpdHRlcic7XG5cbi8qKlxuICogQWRkIGxheWVyIG1vZGVsXG4gKlxuICogXCJJbXBsZW1lbnRzXCIgdGhlIENyZWF0ZUxpc3RpbmdNb2RlbC5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIGRlZmF1bHRzOiB7XG4gICAgdHlwZTogJ2FkZExheWVyJyxcbiAgICBjb250ZW50UGFuZTogJ2xpc3RpbmcnLCAvLyBbbGlzdGluZywgbG9hZGluZ11cbiAgICBsaXN0aW5nOiBEQVRBU0VUUywgLy8gW0lNUE9SVCwgREFUQVNFVFMsIFNDUkFUQ0hdXG4gICAgY29sbGVjdGlvbkZldGNoZWQ6IGZhbHNlLFxuICAgIGFjdGl2ZUltcG9ydFBhbmU6IElNUE9SVF9GSUxFXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oYXR0cnMsIG9wdHMpIHtcbiAgICB0aGlzLnVzZXIgPSBvcHRzLnVzZXI7XG4gICAgdGhpcy52aXMgPSBvcHRzLnZpcztcbiAgICB0aGlzLm1hcCA9IG9wdHMubWFwO1xuXG4gICAgdGhpcy51cGxvYWQgPSBuZXcgVXBsb2FkTW9kZWwoe1xuICAgICAgY3JlYXRlX3ZpczogZmFsc2VcbiAgICB9LCB7XG4gICAgICB1c2VyOiB0aGlzLnVzZXJcbiAgICB9KTtcblxuICAgIHRoaXMuc2VsZWN0ZWREYXRhc2V0cyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG4gICAgdGhpcy5jb2xsZWN0aW9uID0gbmV3IGNkYi5hZG1pbi5WaXN1YWxpemF0aW9ucygpO1xuICAgIHRoaXMudmlzRmV0Y2hNb2RlbCA9IG5ldyBWaXNGZXRjaE1vZGVsKHtcbiAgICAgIGNvbnRlbnRfdHlwZTogREFUQVNFVFMsXG4gICAgICBsaWJyYXJ5OiB0aGlzLnNob3dMaWJyYXJ5KClcbiAgICB9KTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICB0aGlzLl9tYXliZVByZWZldGNoRGF0YXNldHMoKTtcbiAgfSxcblxuICAvLyBGb3IgY3JlYXRlLWxpc3Rpbmcgdmlld1xuICBjYW5TZWxlY3Q6IGZ1bmN0aW9uKGRhdGFzZXQpIHtcbiAgICByZXR1cm4gZGF0YXNldC5nZXQoJ3NlbGVjdGVkJykgfHwgdGhpcy5zZWxlY3RlZERhdGFzZXRzLmxlbmd0aCA8IDE7IC8vIGZvciBub3cgb25seSBhbGxvdyAxIGl0ZW1cbiAgfSxcblxuICAvLyBGb3IgY3JlYXRlLWxpc3Rpbmcgdmlld1xuICBzaG93TGlicmFyeTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIC8vIEZvciBjcmVhdGUtbGlzdGluZyB2aWV3XG4gIHNob3dEYXRhc2V0czogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgLy8gRm9yIGNyZWF0ZS1saXN0aW5nLWltcG9ydCB2aWV3XG4gIHNldEFjdGl2ZUltcG9ydFBhbmU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICB0aGlzLnNldCgnYWN0aXZlSW1wb3J0UGFuZScsIG5hbWUpO1xuICB9LFxuXG4gIC8vIEZvciBmb290ZXJcbiAgY2FuRmluaXNoOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5fYXRJbXBvcnRQYW5lKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnVwbG9hZC5pc1ZhbGlkVG9VcGxvYWQoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuX2F0RGF0YXNldHNQYW5lKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkRGF0YXNldHMubGVuZ3RoID4gMDtcbiAgICB9XG4gIH0sXG5cbiAgZmluaXNoOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5fYXRJbXBvcnRQYW5lKCkpIHtcbiAgICAgIGNkYi5nb2QudHJpZ2dlcignaW1wb3J0QnlVcGxvYWREYXRhJywgdGhpcy51cGxvYWQudG9KU09OKCksIHRoaXMpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fYXREYXRhc2V0c1BhbmUoKSkge1xuICAgICAgdmFyIG1kbCA9IHRoaXMuc2VsZWN0ZWREYXRhc2V0cy5hdCgwKTtcbiAgICAgIGlmIChtZGwuZ2V0KCd0eXBlJykgPT09ICdyZW1vdGUnKSB7XG4gICAgICAgIHZhciBkID0ge1xuICAgICAgICAgIGNyZWF0ZV92aXM6IGZhbHNlLFxuICAgICAgICAgIHR5cGU6ICdyZW1vdGUnLFxuICAgICAgICAgIHZhbHVlOiBtZGwuZ2V0KCduYW1lJyksXG4gICAgICAgICAgcmVtb3RlX3Zpc3VhbGl6YXRpb25faWQ6IG1kbC5nZXQoJ2lkJyksXG4gICAgICAgICAgc2l6ZTogbWRsLmdldCgnZXh0ZXJuYWxfc291cmNlJykgPyBtZGwuZ2V0KCdleHRlcm5hbF9zb3VyY2UnKS5zaXplIDogdW5kZWZpbmVkXG4gICAgICAgIH07XG4gICAgICAgIC8vIFNlZSBCYWNrZ3JvdW5kSW1wb3J0ZXIgd2hlcmUgdGhlIHNhbWUgZXZlbnQgaXMgYm91bmQgdG8gYmUgaGFuZGxlZC4uXG4gICAgICAgIGNkYi5nb2QudHJpZ2dlcignaW1wb3J0QnlVcGxvYWREYXRhJywgZCwgdGhpcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9hZGROZXdMYXllcihtZGwudGFibGVNZXRhZGF0YSgpLmdldCgnbmFtZScpKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgLy8gRm9yIGZvb3RlciAodHlwZSBndWVzc2luZylcbiAgZ2V0SW1wb3J0U3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnYWN0aXZlSW1wb3J0UGFuZScpO1xuICB9LFxuXG4gIC8vIEZvciBmb290ZXIgKHR5cGUgZ3Vlc3NpbmcpXG4gIHNob3dHdWVzc2luZ1RvZ2dsZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9hdEltcG9ydFBhbmUoKTtcbiAgfSxcblxuICAvLyBGb3IgY3JlYXRlLWZvb3RlciB2aWV3XG4gIHNob3dQcml2YWN5VG9nZ2xlcjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGhpZGRlbkR1ZVRvRGVwcmVjYXRpb24gPSB0aGlzLl9hdFR3aXR0ZXJJbXBvcnRQYW5lKCkgJiYgIXRoaXMudXNlci5oYXNPd25Ud2l0dGVyQ3JlZGVudGlhbHMoKTtcbiAgICB2YXIgaGFzVG9CZVNob3dlZCA9IHRoaXMuX2F0SW1wb3J0UGFuZSgpICYmICFoaWRkZW5EdWVUb0RlcHJlY2F0aW9uO1xuICAgIHJldHVybiBoYXNUb0JlU2hvd2VkO1xuICB9LFxuXG4gIF9hdEltcG9ydFBhbmU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2xpc3RpbmcnKSA9PT0gSU1QT1JUO1xuICB9LFxuXG4gIF9hdERhdGFzZXRzUGFuZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnbGlzdGluZycpID09PSBEQVRBU0VUUztcbiAgfSxcblxuICBfYXRTY3JhdGNoUGFuZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnbGlzdGluZycpID09PSBTQ1JBVENIO1xuICB9LFxuXG4gIF9hdFR3aXR0ZXJJbXBvcnRQYW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdhY3RpdmVJbXBvcnRQYW5lJykgPT09IElNUE9SVF9UV0lUVEVSO1xuICB9LFxuXG4gIC8vIEZvciBjcmVhdGUtZnJvbS1zY3JhdGNoIHZpZXdcbiAgY3JlYXRlRnJvbVNjcmF0Y2g6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0KCdjb250ZW50UGFuZScsICdjcmVhdGluZ0Zyb21TY3JhdGNoJyk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciB0YWJsZSA9IG5ldyBjZGIuYWRtaW4uQ2FydG9EQlRhYmxlTWV0YWRhdGEoKTtcbiAgICB0YWJsZS5zYXZlKHt9LCB7XG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5fYWRkTmV3TGF5ZXIodGFibGUuZ2V0KCduYW1lJykpO1xuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihyZXEsIHJlc3ApIHtcbiAgICAgICAgaWYgKHJlc3AucmVzcG9uc2VUZXh0LmluZGV4T2YoJ1lvdSBoYXZlIHJlYWNoZWQgeW91ciB0YWJsZSBxdW90YScpICE9PSAtMSkge1xuICAgICAgICAgIHRoaXMuc2V0KCdjb250ZW50UGFuZScsICdkYXRhc2V0UXVvdGFFeGNlZWRlZCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuc2V0KCdjb250ZW50UGFuZScsICdhZGRMYXllckZhaWxlZCcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy51cGxvYWQuYmluZCgnY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZTp1cGxvYWQnLCB0aGlzKTtcbiAgICB9LCB0aGlzKTtcbiAgICB0aGlzLnZpc0ZldGNoTW9kZWwuYmluZCgnY2hhbmdlJywgdGhpcy5fZmV0Y2hDb2xsZWN0aW9uLCB0aGlzKTtcbiAgICB0aGlzLmJpbmQoJ2NoYW5nZTpsaXN0aW5nJywgdGhpcy5fbWF5YmVQcmVmZXRjaERhdGFzZXRzKTtcblxuICAgIHRoaXMuY29sbGVjdGlvbi5iaW5kKCdjaGFuZ2U6c2VsZWN0ZWQnLCBmdW5jdGlvbihjaGFuZ2VkTW9kZWwsIHdhc1NlbGVjdGVkKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkRGF0YXNldHNbIHdhc1NlbGVjdGVkID8gJ2FkZCcgOiAncmVtb3ZlJyBdKGNoYW5nZWRNb2RlbCk7XG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmJpbmQoJ3Jlc2V0JywgZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkRGF0YXNldHMuZWFjaChmdW5jdGlvbihtb2RlbCkge1xuICAgICAgICB2YXIgc2FtZU1vZGVsID0gdGhpcy5jb2xsZWN0aW9uLmdldChtb2RlbC5pZCk7XG4gICAgICAgIGlmIChzYW1lTW9kZWwpIHtcbiAgICAgICAgICBzYW1lTW9kZWwuc2V0KCdzZWxlY3RlZCcsIHRydWUpO1xuICAgICAgICB9XG4gICAgICB9LCB0aGlzKTtcbiAgICB9LCB0aGlzKTtcbiAgfSxcblxuICBfbWF5YmVQcmVmZXRjaERhdGFzZXRzOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5fYXREYXRhc2V0c1BhbmUoKSAmJiAhdGhpcy5nZXQoJ2NvbGxlY3Rpb25GZXRjaGVkJykgJiYgIXRoaXMudmlzRmV0Y2hNb2RlbC5pc1NlYXJjaGluZygpKSB7XG4gICAgICB0aGlzLnNldCgnY29sbGVjdGlvbkZldGNoZWQnLCB0cnVlKTtcbiAgICAgIHRoaXMuX2ZldGNoQ29sbGVjdGlvbigpO1xuICAgIH1cbiAgfSxcblxuICBfZmV0Y2hDb2xsZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcGFyYW1zID0gdGhpcy52aXNGZXRjaE1vZGVsLmF0dHJpYnV0ZXM7XG4gICAgdmFyIHR5cGVzO1xuXG4gICAgaWYgKHRoaXMudmlzRmV0Y2hNb2RlbC5pc1NlYXJjaGluZygpKSB7XG4gICAgICAvLyBTdXBwb3J0aW5nIHNlYXJjaCBpbiBkYXRhIGxpYnJhcnkgYW5kIHVzZXIgZGF0YXNldHMgYXQgdGhlIHNhbWUgdGltZVxuICAgICAgdHlwZXMgPSAndGFibGUscmVtb3RlJztcbiAgICB9IGVsc2Uge1xuICAgICAgdHlwZXMgPSBwYXJhbXMubGlicmFyeSA/ICdyZW1vdGUnIDogJ3RhYmxlJztcbiAgICB9XG5cbiAgICB0aGlzLmNvbGxlY3Rpb24ub3B0aW9ucy5zZXQoe1xuICAgICAgbG9ja2VkOiAnJyxcbiAgICAgIHE6IHBhcmFtcy5xLFxuICAgICAgcGFnZTogcGFyYW1zLnBhZ2UgfHwgMSxcbiAgICAgIHRhZ3M6IHBhcmFtcy50YWcsXG4gICAgICBwZXJfcGFnZTogdGhpcy5jb2xsZWN0aW9uWydfVEFCTEVTX1BFUl9QQUdFJ10sXG4gICAgICBzaGFyZWQ6IHBhcmFtcy5zaGFyZWQsXG4gICAgICBvcmRlcjogJ3VwZGF0ZWRfYXQnLFxuICAgICAgdHlwZTogJycsXG4gICAgICB0eXBlczogdHlwZXMsXG4gICAgICBleGNsdWRlX3Jhc3RlcjogdHJ1ZVxuICAgIH0pO1xuXG4gICAgdGhpcy5jb2xsZWN0aW9uLmZldGNoKCk7XG4gIH0sXG5cbiAgX29uQ29sbGVjdGlvbkNoYW5nZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZWxlY3RlZERhdGFzZXRzLnJlc2V0KHRoaXMuY29sbGVjdGlvbi53aGVyZSh7IHNlbGVjdGVkOiB0cnVlIH0pKTtcbiAgfSxcblxuICBfYWRkTmV3TGF5ZXI6IGZ1bmN0aW9uKHRhYmxlTmFtZSkge1xuICAgIHRoaXMuc2V0KCdjb250ZW50UGFuZScsICdhZGRpbmdOZXdMYXllcicpO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMubWFwLmFkZENhcnRvZGJMYXllckZyb21UYWJsZSh0YWJsZU5hbWUsIHRoaXMudXNlci5nZXQoJ3VzZXJuYW1lJyksIHtcbiAgICAgIHZpczogdGhpcy52aXMsXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gbGF5ZXJzIG5lZWQgdG8gYmUgc2F2ZWQgYmVjYXVzZSB0aGUgb3JkZXIgbWF5IGNoYW5nZWRcbiAgICAgICAgc2VsZi5tYXAubGF5ZXJzLnNhdmVMYXllcnMoKTtcbiAgICAgICAgc2VsZi50cmlnZ2VyKCdhZGRMYXllckRvbmUnKTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24ocmVxLCByZXNwKSB7XG4gICAgICAgIGlmIChyZXNwLnJlc3BvbnNlVGV4dC5pbmRleE9mKCdZb3UgaGF2ZSByZWFjaGVkIHlvdXIgdGFibGUgcXVvdGEnKSAhPT0gLTEpIHtcbiAgICAgICAgICBzZWxmLnNldCgnY29udGVudFBhbmUnLCAnZGF0YXNldFF1b3RhRXhjZWVkZWQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWxmLnNldCgnY29udGVudFBhbmUnLCAnYWRkTGF5ZXJGYWlsZWQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcbnZhciBDcmVhdGVMaXN0aW5nID0gcmVxdWlyZSgnLi4vY3JlYXRlL2NyZWF0ZV9saXN0aW5nJyk7XG52YXIgRm9vdGVyVmlldyA9IHJlcXVpcmUoJy4vYWRkX2xheWVyL2Zvb3Rlcl92aWV3Jyk7XG52YXIgVmlld0ZhY3RvcnkgPSByZXF1aXJlKCcuLi8uLi92aWV3X2ZhY3RvcnknKTtcbnZhciByYW5kb21RdW90ZSA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfaGVscGVycy9yYW5kb21fcXVvdGUnKTtcbnZhciBOYXZpZ2F0aW9uVmlldyA9IHJlcXVpcmUoJy4uL2NyZWF0ZS9saXN0aW5nL25hdmlnYXRpb25fdmlldycpO1xuXG4vKipcbiAqIEFkZCBsYXllciBkaWFsb2csIHR5cGljYWxseSB1c2VkIGZyb20gZWRpdG9yXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgaWYgKCF0aGlzLm1vZGVsKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdtb2RlbCBpcyByZXF1aXJlZCcpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMub3B0aW9ucy51c2VyKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCd1c2VyIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgdGhpcy5fdGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9tYXAvYWRkX2xheWVyX3RlbXBsYXRlJyk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgLy8gaW1wbGVtZW50cyBjZGIudWkuY29tbW9uLkRpYWxvZy5wcm90b3R5cGUucmVuZGVyXG4gIHJlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuICAgIEJhc2VEaWFsb2cucHJvdG90eXBlLnJlbmRlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuJCgnLmNvbnRlbnQnKS5hZGRDbGFzcygnRGlhbG9nLWNvbnRlbnQtLWV4cGFuZGVkJyk7XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgdGhpcy4kKCcuanMtZm9vdGVyJykuYXBwZW5kKHRoaXMuX2Zvb3RlclZpZXcucmVuZGVyKCkuZWwpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIC8vIGltcGxlbWVudHMgY2RiLnVpLmNvbW1vbi5EaWFsb2cucHJvdG90eXBlLnJlbmRlclxuICByZW5kZXJfY29udGVudDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLl90ZW1wbGF0ZSh7XG4gICAgfSk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnYWRkTGF5ZXJEb25lJywgdGhpcy5jbG9zZSwgdGhpcyk7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6Y29udGVudFBhbmUnLCB0aGlzLl9vbkNoYW5nZUNvbnRlbnRWaWV3LCB0aGlzKTtcbiAgICBjZGIuZ29kLmJpbmQoJ2ltcG9ydEJ5VXBsb2FkRGF0YScsIHRoaXMuY2xvc2UsIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwoY2RiLmdvZCk7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX2NvbnRlbnRQYW5lID0gbmV3IGNkYi51aS5jb21tb24uVGFiUGFuZSh7XG4gICAgICBlbDogdGhpcy4kKCcuanMtY29udGVudC1jb250YWluZXInKVxuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLl9jb250ZW50UGFuZSk7XG5cbiAgICB0aGlzLl9uYXZpZ2F0aW9uVmlldyA9IG5ldyBOYXZpZ2F0aW9uVmlldyh7XG4gICAgICBlbDogdGhpcy4kKCcuanMtbmF2aWdhdGlvbicpLFxuICAgICAgdXNlcjogdGhpcy5vcHRpb25zLnVzZXIsXG4gICAgICByb3V0ZXJNb2RlbDogdGhpcy5tb2RlbC52aXNGZXRjaE1vZGVsLFxuICAgICAgY3JlYXRlTW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICBjb2xsZWN0aW9uOiB0aGlzLm1vZGVsLmNvbGxlY3Rpb25cbiAgICB9KTtcbiAgICB0aGlzLl9uYXZpZ2F0aW9uVmlldy5yZW5kZXIoKTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fbmF2aWdhdGlvblZpZXcpO1xuXG4gICAgdGhpcy5fYWRkVGFiKCdsaXN0aW5nJyxcbiAgICAgIG5ldyBDcmVhdGVMaXN0aW5nKHtcbiAgICAgICAgY3JlYXRlTW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICAgIHVzZXI6IHRoaXMub3B0aW9ucy51c2VyXG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5fYWRkVGFiKCdjcmVhdGluZ0Zyb21TY3JhdGNoJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycsIHtcbiAgICAgICAgdGl0bGU6ICdDcmVhdGluZyBlbXB0eSBkYXRhc2V04oCmJyxcbiAgICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLl9hZGRUYWIoJ2FkZGluZ05ld0xheWVyJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycsIHtcbiAgICAgICAgdGl0bGU6ICdBZGRpbmcgbmV3IGxheWVy4oCmJyxcbiAgICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLl9hZGRUYWIoJ2FkZExheWVyRmFpbGVkJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvZmFpbCcsIHtcbiAgICAgICAgbXNnOiAnQ291bGQgbm90IGFkZCBsYXllcidcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLl9jb250ZW50UGFuZS5hY3RpdmUodGhpcy5tb2RlbC5nZXQoJ2NvbnRlbnRQYW5lJykpO1xuXG4gICAgdGhpcy5fZm9vdGVyVmlldyA9IG5ldyBGb290ZXJWaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLFxuICAgICAgdXNlcjogdGhpcy5vcHRpb25zLnVzZXJcbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fZm9vdGVyVmlldyk7XG4gIH0sXG5cbiAgX2FkZFRhYjogZnVuY3Rpb24gKG5hbWUsIHZpZXcpIHtcbiAgICB0aGlzLl9jb250ZW50UGFuZS5hZGRUYWIobmFtZSwgdmlldy5yZW5kZXIoKSk7XG4gICAgdGhpcy5hZGRWaWV3KHZpZXcpO1xuICB9LFxuXG4gIF9vbkNoYW5nZUNvbnRlbnRWaWV3OiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHBhbmUgPSB0aGlzLm1vZGVsLmdldCgnY29udGVudFBhbmUnKTtcbiAgICB0aGlzLl9jb250ZW50UGFuZS5hY3RpdmUocGFuZSk7XG4gICAgaWYgKHBhbmUgPT09ICdsb2FkaW5nJykge1xuICAgICAgdGhpcy5fZm9vdGVyVmlldy5oaWRlKCk7XG4gICAgfVxuICAgIGlmIChwYW5lICE9PSAnbGlzdGluZycpIHtcbiAgICAgIHRoaXMuX25hdmlnYXRpb25WaWV3LmhpZGUoKTtcbiAgICB9XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xuXG4vKipcbiAqICBBc3NldCBpdGVtIHByZXZpZXdpbmcgaW1hZ2VcbiAqXG4gKiAgLSBJdCBuZWVkcyBhIG1vZGVsIHdpdGggYXNzZXQgdXJsIGFuZCBzdGF0ZSAoaXMtaWRsZSwgaXMtc2VsZWN0ZWQsIGlzLWRlc3Ryb3lpbmcpLlxuICpcbiAqICBuZXcgQXNzZXRzSXRlbVZpZXcoe1xuICogICAgbW9kZWw6IGFzc2V0X21vZGVsXG4gKiAgfSlcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgX1NJWkU6IDYwLCAvLyBUaHVtYm5haWwgc2l6ZSAoc2FtZSBjbSBmb3Igd2lkdGggYW5kIGhlaWdodClcbiAgX01JTl9TSVpFOiAzMiwgLy8gTWluaW1hbCB0aHVtYm5haWwgc2l6ZSAoc2FtZSBjbSBmb3Igd2lkdGggYW5kIGhlaWdodClcblxuICB0YWdOYW1lOiAnbGknLFxuXG4gIG9wdGlvbnM6IHtcbiAgICB0ZW1wbGF0ZTogJ2NvbW1vbi9kaWFsb2dzL21hcC9pbWFnZV9waWNrZXIvYXNzZXRzX2l0ZW0nXG4gIH0sXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIGEuZGVsZXRlJzogJ19vcGVuRHJvcGRvd24nLFxuICAgICdjbGljayc6ICAgICAgICAgICdfb25DbGljaydcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSh0aGlzLm9wdGlvbnMudGVtcGxhdGUpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy4kZWwuYXBwZW5kKHRoaXMudGVtcGxhdGUodGhpcy5tb2RlbC50b0pTT04oKSkpO1xuXG4gICAgdGhpcy5fY2FsY0JrZ0ltZyh0aGlzLm1vZGVsLmdldChcInB1YmxpY191cmxcIikpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgXy5iaW5kQWxsKHRoaXMsICdfb25DbGljaycsICdfb3BlbkRyb3Bkb3duJyk7XG5cbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpzdGF0ZScsIHRoaXMuX2NoYW5nZVN0YXRlLCB0aGlzKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2Rlc3Ryb3knLCB0aGlzLnJlbW92ZSwgdGhpcyk7XG4gIH0sXG5cbiAgX2NhbGNCa2dJbWc6IGZ1bmN0aW9uKHNyYykge1xuICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICBpbWcub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgdyA9IHRoaXMud2lkdGg7XG4gICAgICB2YXIgaCA9IHRoaXMuaGVpZ2h0O1xuXG4gICAgICB2YXIgJHRodW1ibmFpbCA9IHNlbGYuJChcImEuaW1hZ2VcIik7XG5cbiAgICAgIHNlbGYuJGVsLmNzcyhcImJhY2tncm91bmRcIixcIm5vbmVcIik7XG5cbiAgICAgIGlmKHNlbGYubW9kZWwuZ2V0KFwia2luZFwiKSA9PT0gJ21hcmtlcicpIHtcbiAgICAgICAgaWYoaCA+IHNlbGYuX1NJWkUpIHtcbiAgICAgICAgICAkdGh1bWJuYWlsLmNzcyh7XG4gICAgICAgICAgICBcImJhY2tncm91bmQtc2l6ZVwiOiAgXCJjb3ZlclwiLFxuICAgICAgICAgICAgXCJiYWNrZ3JvdW5kLW9yaWdpblwiOiBcImNvbnRlbnQtYm94XCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICgodyB8fCBoKSA8IHNlbGYuX01JTl9TSVpFKSB7XG4gICAgICAgICAgLy8gU2NhbGUgdXAgaW1hZ2VzIHNtYWxsZXIgdGhhbiBjb25zaWRlcmVkIG1pbiBzaXplIChlLmcuIG1ha2kgaWNvbnMpLlxuICAgICAgICAgICR0aHVtYm5haWwuY3NzKHtcbiAgICAgICAgICAgIFwiYmFja2dyb3VuZC1zaXplXCI6IHNlbGYuX01JTl9TSVpFICsgXCJweFwiXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICgodyB8fCBoKSA+IHNlbGYuX1NJWkUpIHtcbiAgICAgICAgICAkdGh1bWJuYWlsLmNzcyh7XG4gICAgICAgICAgICBcImJhY2tncm91bmQtc2l6ZVwiOiAgXCJjb3ZlclwiLFxuICAgICAgICAgICAgXCJiYWNrZ3JvdW5kLW9yaWdpblwiOiBcImNvbnRlbnQtYm94XCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkdGh1bWJuYWlsLmNzcyh7XG4gICAgICAgICAgICBcImJhY2tncm91bmQtcG9zaXRpb25cIjogXCIwIDBcIixcbiAgICAgICAgICAgIFwiYmFja2dyb3VuZC1yZXBlYXRcIjogXCJyZXBlYXRcIlxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbihlKXsgY2RiLmxvZy5pbmZvKGUpIH07XG4gICAgaW1nLnNyYyA9IHNyYztcbiAgfSxcblxuICBfb25DbGljazogZnVuY3Rpb24oZSkge1xuICAgIHRoaXMua2lsbEV2ZW50KGUpO1xuXG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdzdGF0ZScpICE9PSAnc2VsZWN0ZWQnICYmIHRoaXMubW9kZWwuZ2V0KCdzdGF0ZScpICE9ICdkZXN0cm95aW5nJykge1xuICAgICAgdGhpcy50cmlnZ2VyKCdzZWxlY3RlZCcsIHRoaXMubW9kZWwpO1xuICAgICAgdGhpcy5tb2RlbC5zZXQoJ3N0YXRlJywgJ3NlbGVjdGVkJyk7XG4gICAgfVxuICB9LFxuXG4gIF9jaGFuZ2VTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWxcbiAgICAgIC5yZW1vdmVDbGFzcygnaXMtaWRsZSBpcy1zZWxlY3RlZCBpcy1kZXN0cm95aW5nJylcbiAgICAgIC5hZGRDbGFzcyhcImlzLVwiICsgdGhpcy5tb2RlbC5nZXQoJ3N0YXRlJykpO1xuICB9LFxuXG4gIF9vcGVuRHJvcGRvd246IGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB0aGlzLmtpbGxFdmVudChlKTtcbiAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXG4gICAgdGhpcy5kcm9wZG93biA9IG5ldyBjZGIuYWRtaW4uRHJvcGRvd25NZW51KHtcbiAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duIGJvcmRlciB0aW55JyxcbiAgICAgIHRhcmdldDogJChlLnRhcmdldCksXG4gICAgICB3aWR0aDogMTk2LFxuICAgICAgc3BlZWRJbjogMTUwLFxuICAgICAgc3BlZWRPdXQ6IDMwMCxcbiAgICAgIHRlbXBsYXRlX2Jhc2U6ICdjb21tb24vZGlhbG9ncy9tYXAvaW1hZ2VfcGlja2VyL3JlbW92ZV9hc3NldCcsXG4gICAgICB2ZXJ0aWNhbF9wb3NpdGlvbjogXCJkb3duXCIsXG4gICAgICBob3Jpem9udGFsX3Bvc2l0aW9uOiBcImxlZnRcIixcbiAgICAgIGhvcml6b250YWxfb2Zmc2V0OiAzLFxuICAgICAgdGljazogXCJsZWZ0XCJcbiAgICB9KTtcblxuICAgIHRoaXMuZHJvcGRvd24uYmluZChcIm9wdGlvbkNsaWNrZWRcIiwgZnVuY3Rpb24oZXYpIHtcbiAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBzZWxmLl9kZWxldGVBc3NldCgpO1xuICAgIH0pO1xuXG4gICAgJCgnYm9keScpLmFwcGVuZCh0aGlzLmRyb3Bkb3duLnJlbmRlcigpLmVsKTtcbiAgICB0aGlzLmRyb3Bkb3duLm9wZW4oZSk7XG4gICAgY2RiLmdvZC5iaW5kKFwiY2xvc2VEaWFsb2dzXCIsIHRoaXMuZHJvcGRvd24uaGlkZSwgdGhpcy5kcm9wZG93bik7XG4gIH0sXG5cbiAgX2RlbGV0ZUFzc2V0OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5tb2RlbC5zZXQoJ3N0YXRlJywgJ2Rlc3Ryb3lpbmcnKTtcblxuICAgIHRoaXMubW9kZWwuZGVzdHJveSh7XG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHt9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLm1vZGVsLnNldCgnc3RhdGUnLCAnaWRsZScpO1xuICAgICAgfVxuICAgIH0pXG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBTdGF0aWNBc3NldEl0ZW1WaWV3ID0gcmVxdWlyZSgnLi9zdGF0aWNfYXNzZXRzX2l0ZW1fdmlldycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdBc3NldFBhbmUnLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwgPSB0aGlzLm9wdGlvbnMubW9kZWw7XG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL21hcC9pbWFnZV9waWNrZXIvYXNzZXRzX3RlbXBsYXRlJyk7XG4gICAgdGhpcy5fc2V0dXBBc3NldHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSgpKTtcbiAgICB0aGlzLl9yZW5kZXJBc3NldHMoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfc2V0dXBBc3NldHM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBvcHRzID0ge307XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLmZvbGRlciAhPT0gdW5kZWZpbmVkKSAgb3B0cy5mb2xkZXIgPSB0aGlzLm9wdGlvbnMuZm9sZGVyO1xuICAgIGlmICh0aGlzLm9wdGlvbnMuc2l6ZSAgICE9PSB1bmRlZmluZWQpICBvcHRzLnNpemUgICA9IHRoaXMub3B0aW9ucy5zaXplO1xuICAgIGlmICh0aGlzLm9wdGlvbnMuaG9zdCAgICE9PSB1bmRlZmluZWQpICBvcHRzLmhvc3QgICA9IHRoaXMub3B0aW9ucy5ob3N0O1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZXh0ICAgICE9PSB1bmRlZmluZWQpICBvcHRzLmV4dCAgICA9IHRoaXMub3B0aW9ucy5leHQ7XG5cbiAgICBpZiAoIV8uaXNFbXB0eShvcHRzKSkge1xuICAgICAgdGhpcy5vcHRpb25zLmljb25zID0gXy5tYXAodGhpcy5vcHRpb25zLmljb25zLCBmdW5jdGlvbihhKSB7XG4gICAgICAgIHJldHVybiBfLmV4dGVuZChhLCBvcHRzKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMuY29sbGVjdGlvbiA9IG5ldyBjZGIuYWRtaW4uU3RhdGljQXNzZXRzKHRoaXMub3B0aW9ucy5pY29ucyk7XG4gIH0sXG5cbiAgX3JlbmRlckFzc2V0czogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBpdGVtcyA9IHRoaXMuY29sbGVjdGlvbi53aGVyZSh7IGtpbmQ6IHRoaXMub3B0aW9ucy5raW5kIH0pO1xuXG4gICAgXyhpdGVtcykuZWFjaChmdW5jdGlvbihtZGwpIHtcbiAgICAgIHZhciBpdGVtID0gbmV3IFN0YXRpY0Fzc2V0SXRlbVZpZXcoe1xuICAgICAgICBjbGFzc05hbWU6ICdBc3NldEl0ZW0gJyArIChzZWxmLm9wdGlvbnMuZm9sZGVyIHx8ICcnKSxcbiAgICAgICAgdGVtcGxhdGU6ICdjb21tb24vZGlhbG9ncy9tYXAvaW1hZ2VfcGlja2VyL3N0YXRpY19hc3NldHNfaXRlbScsXG4gICAgICAgIG1vZGVsOiBtZGxcbiAgICAgIH0pO1xuICAgICAgaXRlbS5iaW5kKCdzZWxlY3RlZCcsIHNlbGYuX3NlbGVjdEl0ZW0sIHNlbGYpO1xuXG4gICAgICBzZWxmLiQoJ3VsJykuYXBwZW5kKGl0ZW0ucmVuZGVyKCkuZWwpO1xuICAgICAgc2VsZi5hZGRWaWV3KGl0ZW0pO1xuICAgIH0pO1xuICB9LFxuXG4gIF9zZWxlY3RJdGVtOiBmdW5jdGlvbihtKSB7XG4gICAgdGhpcy5tb2RlbC5zZXQoJ3ZhbHVlJywgbS5nZXQoJ3B1YmxpY191cmwnKSk7XG4gICAgdGhpcy50cmlnZ2VyKCdmaWxlQ2hvc2VuJywgdGhpcyk7XG4gICAgdGhpcy5fdW5zZWxlY3RJdGVtcyhtKTtcbiAgfSxcblxuICAvLyBVbnNlbGVjdCBhbGwgaW1hZ2VzIGV4cGVjdCB0aGUgc2VsZWN0ZWQgb25lXG4gIF91bnNlbGVjdEl0ZW1zOiBmdW5jdGlvbihtKSB7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmVhY2goZnVuY3Rpb24obWRsKSB7XG4gICAgICBpZiAobWRsICE9PSBtICYmIG1kbC5nZXQoJ3N0YXRlJykgPT09ICdzZWxlY3RlZCcpIHtcbiAgICAgICAgbWRsLnNldCgnc3RhdGUnLCAnaWRsZScpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuY2RiLmFkbWluID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydhZG1pbiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ2FkbWluJ10gOiBudWxsKTtcbnZhciBVcGxvYWRNb2RlbCA9IHJlcXVpcmUoJy4vdXBsb2FkX21vZGVsJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ0Fzc2V0UGFuZScsXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy1maWxlQnV0dG9uJzogJ19vbkJveENsaWNrJ1xuICB9LFxuXG4gIF9VUExPQURFUjoge1xuICAgIHVybDogICAgICAgICAgICAgICcvYXBpL3YxL3VzZXJzLzwlLSBpZCAlPi9hc3NldHMnLFxuICAgIHVwbG9hZHM6ICAgICAgICAgIDEsIC8vIE1heCB1cGxvYWRzIGF0IHRoZSBzYW1lIHRpbWVcbiAgICBtYXhGaWxlU2l6ZTogICAgICAxMDQ4NTc2LCAvLyAxTUJcbiAgICBhY2NlcHRGaWxlVHlwZXM6ICBbJ3BuZycsJ3N2ZycsJ2pwZWcnLCdqcGcnXSxcbiAgICBhY2NlcHRTeW5jOiAgICAgICB1bmRlZmluZWQsXG4gICAgcmVzb2x1dGlvbjogICAgICAgXCIxMDI0eDEwMjRcIlxuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIF8uYmluZEFsbCh0aGlzLCAnX29uRGJ4Q2hvb3NlclN1Y2Nlc3MnKTtcblxuICAgIHRoaXMua2luZCA9IHRoaXMub3B0aW9ucy5raW5kO1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMuX3NldHVwTW9kZWwoKTtcbiAgICB0aGlzLmNvbGxlY3Rpb24gPSB0aGlzLm9wdGlvbnMuY29sbGVjdGlvbjtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuXG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL21hcC9pbWFnZV9waWNrZXIvYm94X3RlbXBsYXRlJyk7XG5cbiAgICB0aGlzLiRlbC5odG1sKHRoaXMudGVtcGxhdGUoKSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfc2V0dXBNb2RlbDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbCA9IG5ldyBVcGxvYWRNb2RlbCh7XG4gICAgICB0eXBlOiB0aGlzLm9wdGlvbnMudHlwZSxcbiAgICAgIGtpbmQ6IHRoaXMub3B0aW9ucy5raW5kXG4gICAgfSwge1xuICAgICAgdXNlcklkOiB0aGlzLnVzZXIuZ2V0KFwiaWRcIilcbiAgICB9KTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpzdGF0ZScsIHRoaXMuX29uQ2hhbmdlU3RhdGUsIHRoaXMpO1xuICB9LFxuXG4gIF9vblN0YXRlVXBsb2FkZWQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY29sbGVjdGlvbi5mZXRjaCgpO1xuICAgIHRoaXMubW9kZWwuc2V0RnJlc2goeyBraW5kOiB0aGlzLmtpbmQgfSk7XG4gIH0sXG5cbiAgX29uU3RhdGVFcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fc2hvd0ZpbGVFcnJvcigpO1xuICAgIHRoaXMudHJpZ2dlcihcImhpZGVfbG9hZGVyXCIsIHRoaXMpO1xuICAgIHRoaXMuJChcIi5qcy1pbXBvcnQtcGFuZWxcIikuc2hvdygpO1xuICAgIHRoaXMubW9kZWwuc2V0RnJlc2goeyBraW5kOiB0aGlzLmtpbmQgfSk7XG4gIH0sXG5cbiAgX3Nob3dGaWxlRXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm1vZGVsLmdldCgnc3RhdGUnKSA9PT0gXCJlcnJvclwiKSB7XG4gICAgICB0aGlzLiQoJy5qcy1maWxlRXJyb3InKVxuICAgICAgICAudGV4dCh0aGlzLm1vZGVsLmdldCgnZ2V0X2Vycm9yX3RleHQnKS53aGF0X2Fib3V0KVxuICAgICAgICAuc2hvdygpO1xuICAgICAgdGhpcy4kKCcuanMtZmlsZUJ1dHRvbicpLmFkZENsYXNzKCdCdXR0b24tLW5lZ2F0aXZlJyk7XG4gICAgfVxuICB9LFxuXG4gIF9oaWRlRmlsZUVycm9yOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoJy5qcy1maWxlRXJyb3InKS5oaWRlKCk7XG4gICAgdGhpcy4kKCcuanMtZmlsZUxhYmVsJykuc2hvdygpO1xuICAgIHRoaXMuJCgnLmpzLWZpbGVCdXR0b24nKS5yZW1vdmVDbGFzcygnQnV0dG9uLS1uZWdhdGl2ZScpO1xuICB9LFxuXG4gIF9vbkNoYW5nZVN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3RhdGUgPSB0aGlzLm1vZGVsLmdldCgnc3RhdGUnKTtcblxuICAgIGlmIChzdGF0ZSA9PT0gJ3VwbG9hZGVkJykge1xuICAgICAgdGhpcy5fb25TdGF0ZVVwbG9hZGVkKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzdGF0ZSA9PSBcImVycm9yXCIpIHtcbiAgICAgICAgdGhpcy5fb25TdGF0ZUVycm9yKCk7XG4gICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAnaWRsZScgfHwgc3RhdGUgPT09IFwidXBsb2FkaW5nXCIpIHtcbiAgICAgICAgdGhpcy4kKFwiLmpzLWltcG9ydC1wYW5lbFwiKS5oaWRlKCk7XG4gICAgICAgIHRoaXMudHJpZ2dlcihcInNob3dfbG9hZGVyXCIsIHRoaXMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy4kKFwiLmpzLWltcG9ydC1wYW5lbFwiKS5zaG93KCk7XG4gICAgICAgIHRoaXMudHJpZ2dlcihcImhpZGVfbG9hZGVyXCIsIHRoaXMpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuXG4gIF9vbkJveENsaWNrOiBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZSk7XG5cbiAgICBCb3guY2hvb3NlKHtcbiAgICAgIHN1Y2Nlc3M6ICAgICAgdGhpcy5fb25EYnhDaG9vc2VyU3VjY2VzcyxcbiAgICAgIG11bHRpc2VsZWN0OiAgZmFsc2UsXG4gICAgICBsaW5rVHlwZTogICAgIFwiZGlyZWN0XCIsXG4gICAgICBleHRlbnNpb25zOiAgIF8ubWFwKHRoaXMuX1VQTE9BREVSLmFjY2VwdEZpbGVUeXBlcywgZnVuY3Rpb24oZXh0KSB7IHJldHVybiAnLicgKyBleHQgfSlcbiAgICB9KTtcbiAgfSxcblxuICBfb25EYnhDaG9vc2VyU3VjY2VzczogZnVuY3Rpb24oZmlsZXMpIHtcbiAgICBpZiAoZmlsZXMgJiYgZmlsZXNbMF0pIHtcbiAgICAgIHRoaXMubW9kZWwuc2V0KHtcbiAgICAgICAgdHlwZTogJ3VybCcsXG4gICAgICAgIHZhbHVlOiBmaWxlc1swXS5saW5rLFxuICAgICAgICBzdGF0ZTogJ3VwbG9hZGluZydcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLm1vZGVsLnVwbG9hZCgpO1xuXG4gICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3N0YXRlJykgIT09IFwiZXJyb3JcIikge1xuICAgICAgICAvLyBSZW1vdmUgZXJyb3JzXG4gICAgICAgIHRoaXMuX2hpZGVGaWxlRXJyb3IoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3Nob3dGaWxlRXJyb3IoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxufSk7XG4iLCIvLyBNYWtpIGljb25zIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL21hcGJveC9tYWtpXG4vLyBhbmQgaHR0cHM6Ly9naXRodWIuY29tL21hcGJveC9tYWtpL2Jsb2IvbWItcGFnZXMvX2luY2x1ZGVzL21ha2kuanNvblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGRpc2NsYWltZXI6ICc8YSBocmVmPVwiaHR0cHM6Ly9naXRodWIuY29tL21hcGJveC9tYWtpXCIgdGFyZ2V0PVwiX2JsYW5rXCI+TWFraSBJY29uczwvYT4sIGFuIG9wZW4gc291cmNlIHByb2plY3QgYnkgPGEgaHJlZj1cImh0dHA6Ly9tYXBib3guY29tXCIgdGFyZ2V0PVwiX2JsYW5rXCI+TWFwYm94PC9hPicsXG4gIGljb25zOiBbXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJDaXJjbGUgc3Ryb2tlZFwiLFxuICAgICAgICBcImljb25cIjogXCJjaXJjbGUtc3Ryb2tlZFwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIkNpcmNsZSBzb2xpZFwiLFxuICAgICAgICBcImljb25cIjogXCJjaXJjbGVcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJTcXVhcmUgc3Ryb2tlZFwiLFxuICAgICAgICBcImljb25cIjogXCJzcXVhcmUtc3Ryb2tlZFwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIlNxdWFyZSBzb2xpZFwiLFxuICAgICAgICBcImljb25cIjogXCJzcXVhcmVcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJUcmlhbmdsZSBzdHJva2VkXCIsXG4gICAgICAgIFwiaWNvblwiOiBcInRyaWFuZ2xlLXN0cm9rZWRcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJUcmlhbmdsZSBzb2xpZFwiLFxuICAgICAgICBcImljb25cIjogXCJ0cmlhbmdsZVwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIlN0YXIgc3Ryb2tlZFwiLFxuICAgICAgICBcImljb25cIjogXCJzdGFyLXN0cm9rZWRcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJTdGFyIHNvbGlkXCIsXG4gICAgICAgIFwiaWNvblwiOiBcInN0YXJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJDcm9zc1wiLFxuICAgICAgICBcImljb25cIjogXCJjcm9zc1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIk1hcmtlciBTdHJva2VcIixcbiAgICAgICAgXCJpY29uXCI6IFwibWFya2VyLXN0cm9rZWRcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJNYXJrZXIgU29saWRcIixcbiAgICAgICAgXCJpY29uXCI6IFwibWFya2VyXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiUmVsaWdpb3VzIEpld2lzaFwiLFxuICAgICAgICBcImljb25cIjogXCJyZWxpZ2lvdXMtamV3aXNoXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiUmVsaWdpb3VzIENocmlzdGlhblwiLFxuICAgICAgICBcImljb25cIjogXCJyZWxpZ2lvdXMtY2hyaXN0aWFuXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiUmVsaWdpb3VzIE11c2xpbVwiLFxuICAgICAgICBcImljb25cIjogXCJyZWxpZ2lvdXMtbXVzbGltXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiQ2VtZXRlcnlcIixcbiAgICAgICAgXCJpY29uXCI6IFwiY2VtZXRlcnlcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJSb2NrZXRcIixcbiAgICAgICAgXCJpY29uXCI6IFwicm9ja2V0XCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiQWlycG9ydFwiLFxuICAgICAgICBcImljb25cIjogXCJhaXJwb3J0XCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiSGVsaXBvcnRcIixcbiAgICAgICAgXCJpY29uXCI6IFwiaGVsaXBvcnRcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJSYWlsXCIsXG4gICAgICAgIFwiaWNvblwiOiBcInJhaWxcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJSYWlsIE1ldHJvXCIsXG4gICAgICAgIFwiaWNvblwiOiBcInJhaWwtbWV0cm9cIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJSYWlsIExpZ2h0XCIsXG4gICAgICAgIFwiaWNvblwiOiBcInJhaWwtbGlnaHRcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJCdXNcIixcbiAgICAgICAgXCJpY29uXCI6IFwiYnVzXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiRnVlbFwiLFxuICAgICAgICBcImljb25cIjogXCJmdWVsXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiUGFya2luZ1wiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJwYXJraW5nXCIsXG4gICAgICAgICAgICBcInRyYW5zcG9ydGF0aW9uXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwicGFya2luZ1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIlBhcmtpbmcgR2FyYWdlXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcInBhcmtpbmdcIixcbiAgICAgICAgICAgIFwidHJhbnNwb3J0YXRpb25cIixcbiAgICAgICAgICAgIFwiZ2FyYWdlXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwicGFya2luZy1nYXJhZ2VcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJBaXJmaWVsZFwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJhaXJmaWVsZFwiLFxuICAgICAgICAgICAgXCJhaXJwb3J0XCIsXG4gICAgICAgICAgICBcInBsYW5lXCIsXG4gICAgICAgICAgICBcImxhbmRpbmcgc3RyaXBcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJhaXJmaWVsZFwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIlJvYWRibG9ja1wiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJyb2FkYmxvY2tcIixcbiAgICAgICAgICAgIFwic3RvcFwiLFxuICAgICAgICAgICAgXCJ3YXJuaW5nXCIsXG4gICAgICAgICAgICBcImRlYWQgZW5kXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwicm9hZGJsb2NrXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiRmVycnlcIixcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwic2hpcFwiLFxuICAgICAgICAgICAgXCJib2F0XCIsXG4gICAgICAgICAgICBcIndhdGVyXCIsXG4gICAgICAgICAgICBcImZlcnJ5XCIsXG4gICAgICAgICAgICBcInRyYW5zcG9ydGF0aW9uXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwiZmVycnlcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJIYXJib3JcIixcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwibWFyaW5lXCIsXG4gICAgICAgICAgICBcImRvY2tcIixcbiAgICAgICAgICAgIFwid2F0ZXJcIixcbiAgICAgICAgICAgIFwid2hhcmZcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJoYXJib3JcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJCaWN5Y2xlXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcImN5Y2xpbmdcIixcbiAgICAgICAgICAgIFwiY3ljbGVcIixcbiAgICAgICAgICAgIFwidHJhbnNwb3J0YXRpb25cIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJiaWN5Y2xlXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiUGFya1wiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJyZWNyZWF0aW9uXCIsXG4gICAgICAgICAgICBcInBhcmtcIixcbiAgICAgICAgICAgIFwiZm9yZXN0XCIsXG4gICAgICAgICAgICBcInRyZWVcIixcbiAgICAgICAgICAgIFwiZ3JlZW5cIixcbiAgICAgICAgICAgIFwid29vZHNcIixcbiAgICAgICAgICAgIFwibmF0dXJlXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwicGFya1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIlBhcmsgMlwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJyZWNyZWF0aW9uXCIsXG4gICAgICAgICAgICBcInBhcmtcIixcbiAgICAgICAgICAgIFwiZm9yZXN0XCIsXG4gICAgICAgICAgICBcInRyZWVcIixcbiAgICAgICAgICAgIFwiZ3JlZW5cIixcbiAgICAgICAgICAgIFwid29vZHNcIixcbiAgICAgICAgICAgIFwibmF0dXJlXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwicGFyazJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJNdXNldW1cIixcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwicmVjcmVhdGlvblwiLFxuICAgICAgICAgICAgXCJtdXNldW1cIixcbiAgICAgICAgICAgIFwidG91cmlzbVwiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcIm11c2V1bVwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIkxvZGdpbmdcIixcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwibG9kZ2luZ1wiLFxuICAgICAgICAgICAgXCJob3RlbFwiLFxuICAgICAgICAgICAgXCJyZWNyZWF0aW9uXCIsXG4gICAgICAgICAgICBcIm1vdGVsXCIsXG4gICAgICAgICAgICBcInRvdXJpc21cIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJsb2RnaW5nXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiTW9udW1lbnRcIixcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwicmVjcmVhdGlvblwiLFxuICAgICAgICAgICAgXCJzdGF0dWVcIixcbiAgICAgICAgICAgIFwibW9udW1lbnRcIixcbiAgICAgICAgICAgIFwidG91cmlzbVwiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcIm1vbnVtZW50XCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiWm9vXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcInJlY3JlYXRpb25cIixcbiAgICAgICAgICAgIFwiem9vXCIsXG4gICAgICAgICAgICBcImFuaW1hbFwiLFxuICAgICAgICAgICAgXCJnaXJhZmZlXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwiem9vXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiR2FyZGVuXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcInJlY3JlYXRpb25cIixcbiAgICAgICAgICAgIFwiZ2FyZGVuXCIsXG4gICAgICAgICAgICBcInBhcmtcIixcbiAgICAgICAgICAgIFwiZmxvd2VyXCIsXG4gICAgICAgICAgICBcIm5hdHVyZVwiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcImdhcmRlblwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIkNhbXBzaXRlXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcInJlY3JlYXRpb25cIixcbiAgICAgICAgICAgIFwiY2FtcHNpdGVcIixcbiAgICAgICAgICAgIFwiY2FtcFwiLFxuICAgICAgICAgICAgXCJjYW1waW5nXCIsXG4gICAgICAgICAgICBcInRlbnRcIixcbiAgICAgICAgICAgIFwibmF0dXJlXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwiY2FtcHNpdGVcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJUaGVhdHJlXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcInJlY3JlYXRpb25cIixcbiAgICAgICAgICAgIFwidGhlYXRyZVwiLFxuICAgICAgICAgICAgXCJ0aGVhdGVyXCIsXG4gICAgICAgICAgICBcImVudGVydGFpbm1lbnRcIixcbiAgICAgICAgICAgIFwicGxheVwiLFxuICAgICAgICAgICAgXCJwZXJmb3JtYW5jZVwiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcInRoZWF0cmVcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJBcnQgZ2FsbGVyeVwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJhcnRcIixcbiAgICAgICAgICAgIFwiY2VudGVyXCIsXG4gICAgICAgICAgICBcIm11c2V1bVwiLFxuICAgICAgICAgICAgXCJnYWxsZXJ5XCIsXG4gICAgICAgICAgICBcImNyZWF0aXZlXCIsXG4gICAgICAgICAgICBcInJlY3JlYXRpb25cIixcbiAgICAgICAgICAgIFwiZW50ZXJ0YWlubWVudFwiLFxuICAgICAgICAgICAgXCJzdHVkaW9cIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJhcnQtZ2FsbGVyeVwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIlBpdGNoXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcInBpdGNoXCIsXG4gICAgICAgICAgICBcInRyYWNrXCIsXG4gICAgICAgICAgICBcImF0aGxldGljXCIsXG4gICAgICAgICAgICBcInNwb3J0c1wiLFxuICAgICAgICAgICAgXCJmaWVsZFwiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcInBpdGNoXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiU29jY2VyXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcInNvY2NlclwiLFxuICAgICAgICAgICAgXCJzcG9ydHNcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJzb2NjZXJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJBbWVyaWNhbiBGb290YmFsbFwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJmb290YmFsbFwiLFxuICAgICAgICAgICAgXCJzcG9ydHNcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJhbWVyaWNhLWZvb3RiYWxsXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiVGVubmlzXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcInRlbm5pc1wiLFxuICAgICAgICAgICAgXCJjb3VydFwiLFxuICAgICAgICAgICAgXCJiYWxsXCIsXG4gICAgICAgICAgICBcInNwb3J0c1wiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcInRlbm5pc1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIkJhc2tldGJhbGxcIixcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwiYmFza2V0YmFsbFwiLFxuICAgICAgICAgICAgXCJiYWxsXCIsXG4gICAgICAgICAgICBcInNwb3J0c1wiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcImJhc2tldGJhbGxcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJCYXNlYmFsbFwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJiYXNlYmFsbFwiLFxuICAgICAgICAgICAgXCJzb2Z0YmFsbFwiLFxuICAgICAgICAgICAgXCJiYWxsXCIsXG4gICAgICAgICAgICBcInNwb3J0c1wiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcImJhc2ViYWxsXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiR29sZlwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJnb2xmXCIsXG4gICAgICAgICAgICBcInNwb3J0c1wiLFxuICAgICAgICAgICAgXCJjb3Vyc2VcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJnb2xmXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiU3dpbW1pbmdcIixcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwic3dpbW1pbmdcIixcbiAgICAgICAgICAgIFwid2F0ZXJcIixcbiAgICAgICAgICAgIFwic3dpbVwiLFxuICAgICAgICAgICAgXCJzcG9ydHNcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJzd2ltbWluZ1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIkNyaWNrZXRcIixcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwiY3JpY2tldFwiLFxuICAgICAgICAgICAgXCJzcG9ydHNcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJjcmlja2V0XCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiU2tpaW5nXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcIndpbnRlclwiLFxuICAgICAgICAgICAgXCJza2lpbmdcIixcbiAgICAgICAgICAgIFwic2tpXCIsXG4gICAgICAgICAgICBcInNwb3J0c1wiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcInNraWluZ1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIlNjaG9vbFwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJzY2hvb2xcIixcbiAgICAgICAgICAgIFwiaGlnaHNjaG9vbFwiLFxuICAgICAgICAgICAgXCJlbGVtZW50YXJ5XCIsXG4gICAgICAgICAgICBcImNoaWxkcmVuXCIsXG4gICAgICAgICAgICBcImFtZW5pdHlcIixcbiAgICAgICAgICAgIFwibWlkZGxlXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwic2Nob29sXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiQ29sbGVnZVwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJjb2xsZWdlXCIsXG4gICAgICAgICAgICBcInNjaG9vbFwiLFxuICAgICAgICAgICAgXCJhbWVuaXR5XCIsXG4gICAgICAgICAgICBcInVuaXZlcnNpdHlcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJjb2xsZWdlXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiTGlicmFyeVwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJsaWJyYXJ5XCIsXG4gICAgICAgICAgICBcImJvb2tzXCIsXG4gICAgICAgICAgICBcImFtZW5pdHlcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJsaWJyYXJ5XCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiUG9zdFwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJwb3N0XCIsXG4gICAgICAgICAgICBcIm9mZmljZVwiLFxuICAgICAgICAgICAgXCJhbWVuaXR5XCIsXG4gICAgICAgICAgICBcIm1haWxcIixcbiAgICAgICAgICAgIFwibGV0dGVyXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwicG9zdFwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIkZpcmUgc3RhdGlvblwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJmaXJlXCIsXG4gICAgICAgICAgICBcInN0YXRpb25cIixcbiAgICAgICAgICAgIFwiYW1lbml0eVwiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcImZpcmUtc3RhdGlvblwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIlRvd24gaGFsbFwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJ0b3duaGFsbFwiLFxuICAgICAgICAgICAgXCJtYXlvclwiLFxuICAgICAgICAgICAgXCJidWlsZGluZ1wiLFxuICAgICAgICAgICAgXCJhbWVuaXR5XCIsXG4gICAgICAgICAgICBcImdvdmVybm1lbnRcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJ0b3duLWhhbGxcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJQb2xpY2VcIixcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwicG9saWNlXCIsXG4gICAgICAgICAgICBcImphaWxcIixcbiAgICAgICAgICAgIFwiYXJyZXN0XCIsXG4gICAgICAgICAgICBcImFtZW5pdHlcIixcbiAgICAgICAgICAgIFwic3RhdGlvblwiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcInBvbGljZVwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIlByaXNvblwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJwcmlzb25cIixcbiAgICAgICAgICAgIFwiamFpbFwiLFxuICAgICAgICAgICAgXCJhbWVuaXR5XCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwicHJpc29uXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiRW1iYXNzeVwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJlbWJhc3N5XCIsXG4gICAgICAgICAgICBcImRpcGxvbWFjeVwiLFxuICAgICAgICAgICAgXCJjb25zdWxhdGVcIixcbiAgICAgICAgICAgIFwiYW1lbml0eVwiLFxuICAgICAgICAgICAgXCJmbGFnXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwiZW1iYXNzeVwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIkJlZXJcIixcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwiYmFyXCIsXG4gICAgICAgICAgICBcImJlZXJcIixcbiAgICAgICAgICAgIFwiZHJpbmtcIixcbiAgICAgICAgICAgIFwiY29tbWVyY2lhbFwiLFxuICAgICAgICAgICAgXCJiaWVyZ2FydGVuXCIsXG4gICAgICAgICAgICBcInB1YlwiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcImJlZXJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJSZXN0YXVyYW50XCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcInJlc3RhdXJhbnRcIixcbiAgICAgICAgICAgIFwiY29tbWVyY2lhbFwiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcInJlc3RhdXJhbnRcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJDYWZlXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcImNhZmVcIixcbiAgICAgICAgICAgIFwiY29mZmVlXCIsXG4gICAgICAgICAgICBcImNvbW1lcmNpYWxcIixcbiAgICAgICAgICAgIFwidGVhXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwiY2FmZVwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIlNob3BcIixcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwic2hvcFwiLFxuICAgICAgICAgICAgXCJtYWxsXCIsXG4gICAgICAgICAgICBcImNvbW1lcmNpYWxcIixcbiAgICAgICAgICAgIFwic3RvcmVcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJzaG9wXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiRmFzdCBGb29kXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcImZvb2RcIixcbiAgICAgICAgICAgIFwiZmFzdFwiLFxuICAgICAgICAgICAgXCJjb21tZXJjaWFsXCIsXG4gICAgICAgICAgICBcImJ1cmdlclwiLFxuICAgICAgICAgICAgXCJkcml2ZS10aHJvdWdoXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwiZmFzdC1mb29kXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiQmFyXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcImJhclwiLFxuICAgICAgICAgICAgXCJkcmlua1wiLFxuICAgICAgICAgICAgXCJjb21tZXJjaWFsXCIsXG4gICAgICAgICAgICBcImNsdWJcIixcbiAgICAgICAgICAgIFwibWFydGluaVwiLFxuICAgICAgICAgICAgXCJsb3VuZ2VcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJiYXJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJCYW5rXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcImJhbmtcIixcbiAgICAgICAgICAgIFwiYXRtXCIsXG4gICAgICAgICAgICBcImNvbW1lcmNpYWxcIixcbiAgICAgICAgICAgIFwibW9uZXlcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJiYW5rXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiR3JvY2VyeVwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJmb29kXCIsXG4gICAgICAgICAgICBcImdyb2NlcnlcIixcbiAgICAgICAgICAgIFwiY29tbWVyY2lhbFwiLFxuICAgICAgICAgICAgXCJzdG9yZVwiLFxuICAgICAgICAgICAgXCJtYXJrZXRcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJncm9jZXJ5XCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiQ2luZW1hXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcImNpbmVtYVwiLFxuICAgICAgICAgICAgXCJ0aGVhdHJlXCIsXG4gICAgICAgICAgICBcImZpbG1cIixcbiAgICAgICAgICAgIFwibW92aWVcIixcbiAgICAgICAgICAgIFwiY29tbWVyY2lhbFwiLFxuICAgICAgICAgICAgXCJ0aGVhdGVyXCIsXG4gICAgICAgICAgICBcImVudGVydGFpbm1lbnRcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJjaW5lbWFcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJQaGFybWFjeVwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJwaGFybWFjeVwiLFxuICAgICAgICAgICAgXCJkcnVnc1wiLFxuICAgICAgICAgICAgXCJtZWRpY2F0aW9uXCIsXG4gICAgICAgICAgICBcInNvY2lhbFwiLFxuICAgICAgICAgICAgXCJtZWRpY2luZVwiLFxuICAgICAgICAgICAgXCJwcmVzY3JpcHRpb25cIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJwaGFybWFjeVwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIkhvc3BpdGFsXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcImhvc3BpdGFsXCIsXG4gICAgICAgICAgICBcImhlYWx0aFwiLFxuICAgICAgICAgICAgXCJtZWRpY2F0aW9uXCIsXG4gICAgICAgICAgICBcInNvY2lhbFwiLFxuICAgICAgICAgICAgXCJtZWRpY2luZVwiLFxuICAgICAgICAgICAgXCJtZWRpY2FsXCIsXG4gICAgICAgICAgICBcImNsaW5pY1wiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcImhvc3BpdGFsXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiRGFuZ2VyXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcIm1pbmVmaWVsZFwiLFxuICAgICAgICAgICAgXCJsYW5kbWluZVwiLFxuICAgICAgICAgICAgXCJkaXNhc3RlclwiLFxuICAgICAgICAgICAgXCJkYW5nZXJvdXNcIixcbiAgICAgICAgICAgIFwiaGF6YXJkXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwiZGFuZ2VyXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiSW5kdXN0cmlhbFwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJpbmR1c3RyaWFsXCIsXG4gICAgICAgICAgICBcImZhY3RvcnlcIixcbiAgICAgICAgICAgIFwicHJvcGVydHlcIixcbiAgICAgICAgICAgIFwiYnVpbGRpbmdcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJpbmR1c3RyaWFsXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiV2FyZWhvdXNlXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcIndhcmVob3VzZVwiLFxuICAgICAgICAgICAgXCJwcm9wZXJ0eVwiLFxuICAgICAgICAgICAgXCJzdG9yYWdlXCIsXG4gICAgICAgICAgICBcImJ1aWxkaW5nXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwid2FyZWhvdXNlXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiQ29tbWVyY2lhbFwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJjb21tZXJjaWFsXCIsXG4gICAgICAgICAgICBcInByb3BlcnR5XCIsXG4gICAgICAgICAgICBcImJ1c2luZXNzXCIsXG4gICAgICAgICAgICBcImJ1aWxkaW5nXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJpY29uXCI6IFwiY29tbWVyY2lhbFwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIkJ1aWxkaW5nXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcImJ1aWxkaW5nXCIsXG4gICAgICAgICAgICBcInByb3BlcnR5XCIsXG4gICAgICAgICAgICBcInN0cnVjdHVyZVwiLFxuICAgICAgICAgICAgXCJidXNpbmVzc1wiLFxuICAgICAgICAgICAgXCJidWlsZGluZ1wiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcImJ1aWxkaW5nXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJuYW1lXCI6IFwiUGxhY2Ugb2Ygd29yc2hpcFwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJyZWxpZ2lvblwiLFxuICAgICAgICAgICAgXCJjZXJlbW9ueVwiLFxuICAgICAgICAgICAgXCJyZWxpZ2lvdXNcIixcbiAgICAgICAgICAgIFwibm9uZGVub21pbmF0aW9uYWxcIixcbiAgICAgICAgICAgIFwiY2h1cmNoXCIsXG4gICAgICAgICAgICBcInRlbXBsZVwiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcInBsYWNlLW9mLXdvcnNoaXBcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJBbGNvaG9sIHNob3BcIixcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwiYWxjb2hvbFwiLFxuICAgICAgICAgICAgXCJsaXF1b3JcIixcbiAgICAgICAgICAgIFwic3RvcmVcIixcbiAgICAgICAgICAgIFwic2hvcFwiLFxuICAgICAgICAgICAgXCJiZWVyXCIsXG4gICAgICAgICAgICBcIndpbmVcIixcbiAgICAgICAgICAgIFwidm9ka2FcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJhbGNvaG9sLXNob3BcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJMb2dnaW5nXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcImxvZ2dlclwiLFxuICAgICAgICAgICAgXCJjaGFpbnNhd1wiLFxuICAgICAgICAgICAgXCJ3b29kc1wiLFxuICAgICAgICAgICAgXCJpbmR1c3RyeVwiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcImxvZ2dpbmdcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJPaWwgd2VsbFwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJvaWxcIixcbiAgICAgICAgICAgIFwibmF0dXJhbFwiLFxuICAgICAgICAgICAgXCJlbnZpcm9ubWVudFwiLFxuICAgICAgICAgICAgXCJpbmR1c3RyeVwiLFxuICAgICAgICAgICAgXCJyZXNvdXJjZXNcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJvaWwtd2VsbFwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIlNsYXVnaHRlcmhvdXNlXCIsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcImNvd3NcIixcbiAgICAgICAgICAgIFwiY2F0dGxlXCIsXG4gICAgICAgICAgICBcImZvb2RcIixcbiAgICAgICAgICAgIFwibWVhdFwiLFxuICAgICAgICAgICAgXCJpbmR1c3RyeVwiLFxuICAgICAgICAgICAgXCJyZXNvdXJjZXNcIlxuICAgICAgICBdLFxuICAgICAgICBcImljb25cIjogXCJzbGF1Z2h0ZXJob3VzZVwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmFtZVwiOiBcIkRhbVwiLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJ3YXRlclwiLFxuICAgICAgICAgICAgXCJuYXR1cmFsXCIsXG4gICAgICAgICAgICBcImh5ZHJvXCIsXG4gICAgICAgICAgICBcImh5ZHJvZWxlY3RyaWNcIixcbiAgICAgICAgICAgIFwiZW5lcmd5XCIsXG4gICAgICAgICAgICBcImVudmlyb25tZW50XCIsXG4gICAgICAgICAgICBcImluZHVzdHJ5XCIsXG4gICAgICAgICAgICBcInJlc291cmNlc1wiXG4gICAgICAgIF0sXG4gICAgICAgIFwiaWNvblwiOiBcImRhbVwiXG4gICAgfSxcbiAgICB7XG4gICAgXCJuYW1lXCI6IFwiV2F0ZXJcIixcbiAgICBcInRhZ3NcIjogW1xuICAgICAgICBcIndhdGVyXCIsXG4gICAgICAgIFwibmF0dXJhbFwiLFxuICAgICAgICBcImh5ZHJvXCIsXG4gICAgICAgIFwibGFrZVwiLFxuICAgICAgICBcInJpdmVyXCIsXG4gICAgICAgIFwib2NlYW5cIixcbiAgICAgICAgXCJyZXNvdXJjZXNcIlxuICAgIF0sXG4gICAgXCJpY29uXCI6IFwid2F0ZXJcIlxuICAgIH0sXG4gICAge1xuICAgIFwibmFtZVwiOiBcIldldGxhbmRcIixcbiAgICBcInRhZ3NcIjogW1xuICAgICAgICBcIndhdGVyXCIsXG4gICAgICAgIFwic3dhbXBcIixcbiAgICAgICAgXCJuYXR1cmFsXCJcbiAgICBdLFxuICAgIFwiaWNvblwiOiBcIndldGxhbmRcIlxuICAgIH0sXG4gICAge1xuICAgIFwibmFtZVwiOiBcIkRpc2FiaWxpdHlcIixcbiAgICBcInRhZ3NcIjogW1xuICAgICAgICBcImhhbmRpY2FwXCIsXG4gICAgICAgIFwid2hlZWxjaGFpclwiLFxuICAgICAgICBcImFjY2Vzc1wiXG4gICAgXSxcbiAgICBcImljb25cIjogXCJkaXNhYmlsaXR5XCJcbiAgICB9LFxuICAgIHtcbiAgICBcIm5hbWVcIjogXCJUZWxlcGhvbmVcIixcbiAgICBcInRhZ3NcIjogW1xuICAgICAgICBcInBheXBob25lXCIsXG4gICAgICAgIFwiY2FsbFwiXG4gICAgXSxcbiAgICBcImljb25cIjogXCJ0ZWxlcGhvbmVcIlxuICAgIH0sXG4gICAge1xuICAgIFwibmFtZVwiOiBcIkVtZXJnZW5jeSBUZWxlcGhvbmVcIixcbiAgICBcInRhZ3NcIjogW1xuICAgICAgICBcInBheXBob25lXCIsXG4gICAgICAgIFwiZGFuZ2VyXCIsXG4gICAgICAgIFwic2FmZXR5XCIsXG4gICAgICAgIFwiY2FsbFwiXG4gICAgXSxcbiAgICBcImljb25cIjogXCJlbWVyZ2VuY3ktdGVsZXBob25lXCJcbiAgICB9LFxuICAgIHtcbiAgICBcIm5hbWVcIjogXCJUb2lsZXRzXCIsXG4gICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgXCJiYXRocm9vbVwiLFxuICAgICAgICBcIm1lblwiLFxuICAgICAgICBcIndvbWVuXCIsXG4gICAgICAgIFwic2lua1wiLFxuICAgICAgICBcIndhc2hyb29tXCIsXG4gICAgICAgIFwibGF2YXRvcnlcIlxuICAgIF0sXG4gICAgXCJpY29uXCI6IFwidG9pbGV0c1wiXG4gICAgfSxcbiAgICB7XG4gICAgXCJuYW1lXCI6IFwiV2FzdGUgQmFza2V0XCIsXG4gICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgXCJ0cmFzaFwiLFxuICAgICAgICBcInJ1YmJpc2hcIixcbiAgICAgICAgXCJiaW5cIixcbiAgICAgICAgXCJnYXJiYWdlXCJcbiAgICBdLFxuICAgIFwiaWNvblwiOiBcIndhc3RlLWJhc2tldFwiXG4gICAgfSxcbiAgICB7XG4gICAgXCJuYW1lXCI6IFwiTXVzaWNcIixcbiAgICBcInRhZ3NcIjogW1xuICAgICAgICBcInN0YWdlXCIsXG4gICAgICAgIFwicGVyZm9ybWFuY2VcIixcbiAgICAgICAgXCJiYW5kXCIsXG4gICAgICAgIFwiY29uY2VydFwiLFxuICAgICAgICBcInZlbnVlXCJcbiAgICBdLFxuICAgIFwiaWNvblwiOiBcIm11c2ljXCJcbiAgICB9LFxuICAgIHtcbiAgICBcIm5hbWVcIjogXCJMYW5kIFVzZVwiLFxuICAgIFwidGFnc1wiOiBbXG4gICAgICAgIFwiem9uaW5nXCIsXG4gICAgICAgIFwidXNhZ2VcIixcbiAgICAgICAgXCJhcmVhXCJcbiAgICBdLFxuICAgIFwiaWNvblwiOiBcImxhbmQtdXNlXCJcbiAgICB9LFxuICAgIHtcbiAgICBcIm5hbWVcIjogXCJDaXR5XCIsXG4gICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgXCJhcmVhXCIsXG4gICAgICAgIFwicG9pbnRcIixcbiAgICAgICAgXCJwbGFjZVwiLFxuICAgICAgICBcInVyYmFuXCJcbiAgICBdLFxuICAgIFwiaWNvblwiOiBcImNpdHlcIlxuICAgIH0sXG4gICAge1xuICAgIFwibmFtZVwiOiBcIlRvd25cIixcbiAgICBcInRhZ3NcIjogW1xuICAgICAgICBcImFyZWFcIixcbiAgICAgICAgXCJwb2ludFwiLFxuICAgICAgICBcInBsYWNlXCIsXG4gICAgICAgIFwic21hbGxcIlxuICAgIF0sXG4gICAgXCJpY29uXCI6IFwidG93blwiXG4gICAgfSxcbiAgICB7XG4gICAgXCJuYW1lXCI6IFwiVmlsbGFnZVwiLFxuICAgIFwidGFnc1wiOiBbXG4gICAgICAgIFwiYXJlYVwiLFxuICAgICAgICBcInBvaW50XCIsXG4gICAgICAgIFwicGxhY2VcIixcbiAgICAgICAgXCJzbWFsbFwiLFxuICAgICAgICBcInJ1cmFsXCJcbiAgICBdLFxuICAgIFwiaWNvblwiOiBcInZpbGxhZ2VcIlxuICAgIH0sXG4gICAge1xuICAgIFwibmFtZVwiOiBcIkZhcm1cIixcbiAgICBcInRhZ3NcIjogW1xuICAgICAgICBcImJ1aWxkaW5nXCIsXG4gICAgICAgIFwiZmFybWluZ1wiLFxuICAgICAgICBcImNyb3BzXCIsXG4gICAgICAgIFwicGxhbnRzXCIsXG4gICAgICAgIFwiYWdyaWN1bHR1cmVcIixcbiAgICAgICAgXCJydXJhbFwiXG4gICAgXSxcbiAgICBcImljb25cIjogXCJmYXJtXCJcbiAgICB9LFxuICAgIHtcbiAgICBcIm5hbWVcIjogXCJCYWtlcnlcIixcbiAgICBcInRhZ3NcIjogW1xuICAgICAgICBcImJha2VyeVwiLFxuICAgICAgICBcInBhc3RyeVwiLFxuICAgICAgICBcImNyb2lzc2FudFwiLFxuICAgICAgICBcImZvb2RcIixcbiAgICAgICAgXCJzaG9wXCIsXG4gICAgICAgIFwiYnJlYWRcIlxuICAgIF0sXG4gICAgXCJpY29uXCI6IFwiYmFrZXJ5XCJcbiAgICB9LFxuICB7XG4gICAgXCJuYW1lXCI6IFwiRG9nIFBhcmtcIixcbiAgICBcInRhZ3NcIjogW1xuICAgICAgICBcImRvZ1wiLFxuICAgICAgICBcInBldFwiXG4gICAgXSxcbiAgICBcImljb25cIjogXCJkb2ctcGFya1wiXG4gICAgfSxcbiAgIHtcbiAgICBcIm5hbWVcIjogXCJMaWdodGhvdXNlXCIsXG4gICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgXCJidWlsZGluZ1wiLFxuICAgICAgICBcIm5hdmlnYXRpb25cIixcbiAgICAgICAgXCJuYXV0aWNhbFwiLFxuICAgICAgICBcIm9jZWFuXCIsXG4gICAgICAgIFwibG9naXN0aWNzXCJcbiAgICBdLFxuICAgIFwiaWNvblwiOiBcImxpZ2h0aG91c2VcIlxuICAgIH0sXG4gICAge1xuICAgIFwibmFtZVwiOiBcIkNsb3RoaW5nIFN0b3JlXCIsXG4gICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgXCJjbG90aGluZ1wiLFxuICAgICAgICBcInN0b3JlXCIsXG4gICAgICAgIFwic2hvcFwiXG4gICAgXSxcbiAgICBcImljb25cIjogXCJjbG90aGluZy1zdG9yZVwiXG4gICAgfSxcbiAgICB7XG4gICAgXCJuYW1lXCI6IFwiUG9sbGluZyBQbGFjZVwiLFxuICAgIFwiaWNvblwiOiBcInBvbGxpbmctcGxhY2VcIlxuICAgIH0sXG4gICAge1xuICAgIFwibmFtZVwiOiBcIlBsYXlncm91bmRcIixcbiAgICBcImljb25cIjogXCJwbGF5Z3JvdW5kXCJcbiAgICB9LFxuICAgIHtcbiAgICBcIm5hbWVcIjogXCJFbnRyYW5jZVwiLFxuICAgIFwiaWNvblwiOiBcImVudHJhbmNlXCJcbiAgICB9LFxuICAgIHtcbiAgICBcIm5hbWVcIjogXCJIZWFydFwiLFxuICAgIFwiaWNvblwiOiBcImhlYXJ0XCJcbiAgICB9LFxuICAgIHtcbiAgICBcIm5hbWVcIjogXCJMb25kb24gVW5kZXJncm91bmRcIixcbiAgICBcImljb25cIjogXCJsb25kb24tdW5kZXJncm91bmRcIlxuICAgIH0sXG4gICAge1xuICAgIFwibmFtZVwiOiBcIk1pbmVmaWVsZFwiLFxuICAgIFwiaWNvblwiOiBcIm1pbmVmaWVsZFwiXG4gICAgfSxcbiAgICB7XG4gICAgXCJuYW1lXCI6IFwiUmFpbCBVbmRlcmdyb3VuZFwiLFxuICAgIFwiaWNvblwiOiBcInJhaWwtdW5kZXJncm91bmRcIlxuICAgIH0sXG4gICAge1xuICAgIFwibmFtZVwiOiBcIlJhaWwgQWJvdmVcIixcbiAgICBcImljb25cIjogXCJyYWlsLWFib3ZlXCJcbiAgICB9LFxuICAgIHtcbiAgICAgXCJuYW1lXCI6IFwiQ2FtZXJhXCIsXG4gICAgIFwiaWNvblwiOiBcImNhbWVyYVwiXG4gICAgfSxcbiAgICB7XG4gICAgXCJuYW1lXCI6IFwiTGF1bmRyeVwiLFxuICAgIFwiaWNvblwiOiBcImxhdW5kcnlcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5hbWVcIjogXCJDYXJcIixcbiAgICAgICAgXCJpY29uXCI6IFwiY2FyXCJcbiAgICB9LFxuICAgIHtcbiAgICBcIm5hbWVcIjogXCJTdWl0Y2FzZVwiLFxuICAgIFwiaWNvblwiOiBcInN1aXRjYXNlXCJcbiAgICB9LFxuICAgIHtcbiAgICBcIm5hbWVcIjogXCJIYWlyZHJlc3NlclwiLFxuICAgIFwiaWNvblwiOiBcImhhaXJkcmVzc2VyXCJcbiAgICB9LFxuICAgIHtcbiAgICBcIm5hbWVcIjogXCJDaGVtaXN0XCIsXG4gICAgXCJpY29uXCI6IFwiY2hlbWlzdFwiXG4gICAgfSxcbiAgICB7XG4gICAgXCJuYW1lXCI6IFwiTW9iaWxlIHBob25lXCIsXG4gICAgXCJpY29uXCI6IFwibW9iaWxlcGhvbmVcIlxuICAgIH0sXG4gICAge1xuICAgIFwibmFtZVwiOiBcIlNjb290ZXJcIixcbiAgICBcImljb25cIjogXCJzY29vdGVyXCJcbiAgICB9XG4gIF1cbn07XG4iLCJtb2R1bGUuZXhwb3J0cyA9IHtcbiAgaWNvbnM6IFtcbiAgICB7IGtpbmQ6IFwicGF0dGVyblwiLCBleHQ6IFwicG5nXCIsIG5hbWU6ICdkaWFnb25hbF8xcHhfZmFzdCcsIGljb246ICdkaWFnb25hbF8xcHhfZmFzdCd9LFxuICAgIHsga2luZDogXCJwYXR0ZXJuXCIsIGV4dDogXCJwbmdcIiwgbmFtZTogJ2RpYWdvbmFsXzFweF9tZWQnLCBpY29uOiAnZGlhZ29uYWxfMXB4X21lZCcsIH0sXG4gICAgeyBraW5kOiBcInBhdHRlcm5cIiwgZXh0OiBcInBuZ1wiLCBuYW1lOiAnZGlhZ29uYWxfMXB4X3Nsb3cnLCBpY29uOiAnZGlhZ29uYWxfMXB4X3Nsb3cnfSxcbiAgICB7IGtpbmQ6IFwicGF0dGVyblwiLCBleHQ6IFwicG5nXCIsIG5hbWU6ICdkaWFnb25hbF8ycHhfZmFzdCcsIGljb246ICdkaWFnb25hbF8ycHhfZmFzdCcsIH0sXG4gICAgeyBraW5kOiBcInBhdHRlcm5cIiwgZXh0OiBcInBuZ1wiLCBuYW1lOiAnZGlhZ29uYWxfMnB4X21lZCcsIGljb246ICdkaWFnb25hbF8ycHhfbWVkJywgfSxcbiAgICB7IGtpbmQ6IFwicGF0dGVyblwiLCBleHQ6IFwicG5nXCIsIG5hbWU6ICdkaWFnb25hbF8ycHhfc2xvdycsIGljb246ICdkaWFnb25hbF8ycHhfc2xvdyd9LFxuICAgIHsga2luZDogXCJwYXR0ZXJuXCIsIGV4dDogXCJwbmdcIiwgbmFtZTogJ2RvbnV0c180cHhfbWVkJywgaWNvbjogJ2RvbnV0c180cHhfbWVkJywgfSxcbiAgICB7IGtpbmQ6IFwicGF0dGVyblwiLCBleHQ6IFwicG5nXCIsIG5hbWU6ICdkb251dHNfNnB4X21lZCcsIGljb246ICdkb251dHNfNnB4X21lZCcsIH0sXG4gICAgeyBraW5kOiBcInBhdHRlcm5cIiwgZXh0OiBcInBuZ1wiLCBuYW1lOiAnZG90c18ycHhfZmFzdCcsIGljb246ICdkb3RzXzJweF9mYXN0JywgfSxcbiAgICB7IGtpbmQ6IFwicGF0dGVyblwiLCBleHQ6IFwicG5nXCIsIG5hbWU6ICdkb3RzXzJweF9tZWQnLCBpY29uOiAnZG90c18ycHhfbWVkJywgfSxcbiAgICB7IGtpbmQ6IFwicGF0dGVyblwiLCBleHQ6IFwicG5nXCIsIG5hbWU6ICdkb3RzXzJweF9zbG93JywgaWNvbjogJ2RvdHNfMnB4X3Nsb3cnfSxcbiAgICB7IGtpbmQ6IFwicGF0dGVyblwiLCBleHQ6IFwicG5nXCIsIG5hbWU6ICdkb3RzXzRweF9mYXN0JywgaWNvbjogJ2RvdHNfNHB4X2Zhc3QnfSxcbiAgICB7IGtpbmQ6IFwicGF0dGVyblwiLCBleHQ6IFwicG5nXCIsIG5hbWU6ICdkb3RzXzRweF9tZWQnLCBpY29uOiAnZG90c180cHhfbWVkJywgfSxcbiAgICB7IGtpbmQ6IFwicGF0dGVyblwiLCBleHQ6IFwicG5nXCIsIG5hbWU6ICdkb3RzXzZweF9mYXN0JywgaWNvbjogJ2RvdHNfNnB4X2Zhc3QnIH0sXG4gICAgeyBraW5kOiBcInBhdHRlcm5cIiwgZXh0OiBcInBuZ1wiLCBuYW1lOiAnZG90c182cHhfbWVkJywgIGljb246ICdkb3RzXzZweF9tZWQnIH1cbiAgXVxufTtcbiIsIi8vIFBpbiBtYXBzIGZyb20gaHR0cDovL3d3dy5mbGF0aWNvbi5jb20vcGFja3MvcGlucy1vZi1tYXBzL1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGRpc2NsYWltZXI6ICc8YSBocmVmPVwiaHR0cDovL3d3dy5mbGF0aWNvbi5jb20vcGFja3MvcGlucy1vZi1tYXBzL1wiIHRhcmdldD1cIl9ibGFua1wiPlBpbiBNYXBzPC9hPiwgaWNvbnMgYnkgPGEgaHJlZj1cImh0dHA6Ly9mcmVlcGlrLmNvbVwiIHRhcmdldD1cIl9ibGFua1wiPmZyZWVwaWsuY29tPC9hPicsXG4gIGljb25zOiBbXG4gICAgeyBuYW1lOiAnYWlyJywgaWNvbjogJ2FpcicgfSxcbiAgICB7IG5hbWU6ICdhaXIyJywgaWNvbjogJ2FpcjInIH0sXG4gICAgeyBuYW1lOiAnYW5jaG9yMicsIGljb246ICdhbmNob3IyJyB9LFxuICAgIHsgbmFtZTogJ2FuY2hvcjMnLCBpY29uOiAnYW5jaG9yMycgfSxcbiAgICB7IG5hbWU6ICdiYWcxJywgaWNvbjogJ2JhZzEnIH0sXG4gICAgeyBuYW1lOiAnYmFnMicsIGljb246ICdiYWcyJyB9LFxuICAgIHsgbmFtZTogJ2JhbGxvb24nLCBpY29uOiAnYmFsbG9vbicgfSxcbiAgICB7IG5hbWU6ICdibGFjazQxJywgaWNvbjogJ2JsYWNrNDEnIH0sXG4gICAgeyBuYW1lOiAnYm9hdDEnLCBpY29uOiAnYm9hdDEnIH0sXG4gICAgeyBuYW1lOiAnYm9vazE2JywgaWNvbjogJ2Jvb2sxNicgfSxcbiAgICB7IG5hbWU6ICdidWlsZGluZycsIGljb246ICdidWlsZGluZycgfSxcbiAgICB7IG5hbWU6ICdidXJnZXInLCBpY29uOiAnYnVyZ2VyJyB9LFxuICAgIHsgbmFtZTogJ2J1czYnLCBpY29uOiAnYnVzNicgfSxcbiAgICB7IG5hbWU6ICdjYXJhdmFuMicsIGljb246ICdjYXJhdmFuMicgfSxcbiAgICB7IG5hbWU6ICdjaHVyY2gxJywgaWNvbjogJ2NodXJjaDEnIH0sXG4gICAgeyBuYW1lOiAnY2h1cmNoMycsIGljb246ICdjaHVyY2gzJyB9LFxuICAgIHsgbmFtZTogJ2NsdWInLCBpY29uOiAnY2x1YicgfSxcbiAgICB7IG5hbWU6ICdjb2NrdGFpbDMnLCBpY29uOiAnY29ja3RhaWwzJyB9LFxuICAgIHsgbmFtZTogJ2NvZmZlZTInLCBpY29uOiAnY29mZmVlMicgfSxcbiAgICB7IG5hbWU6ICdkYXJrMTEnLCBpY29uOiAnZGFyazExJyB9LFxuICAgIHsgbmFtZTogJ2Rpc2FibGVkJywgaWNvbjogJ2Rpc2FibGVkJyB9LFxuICAgIHsgbmFtZTogJ2RvZzInLCBpY29uOiAnZG9nMicgfSxcbiAgICB7IG5hbWU6ICdmYXZvdXJpdGUxJywgaWNvbjogJ2Zhdm91cml0ZTEnIH0sXG4gICAgeyBuYW1lOiAnZmxhZzUnLCBpY29uOiAnZmxhZzUnIH0sXG4gICAgeyBuYW1lOiAnZmxhdCcsIGljb246ICdmbGF0JyB9LFxuICAgIHsgbmFtZTogJ2hvdGVsJywgaWNvbjogJ2hvdGVsJyB9LFxuICAgIHsgbmFtZTogJ2luZm9ybWF0aW9uMycsIGljb246ICdpbmZvcm1hdGlvbjMnIH0sXG4gICAgeyBuYW1lOiAnbG9jYXRpb24xMCcsIGljb246ICdsb2NhdGlvbjEwJyB9LFxuICAgIHsgbmFtZTogJ2xvY2F0aW9uMTEnLCBpY29uOiAnbG9jYXRpb24xMScgfSxcbiAgICB7IG5hbWU6ICdsb2NhdGlvbjUnLCBpY29uOiAnbG9jYXRpb241JyB9LFxuICAgIHsgbmFtZTogJ2xvY2F0aW9uNicsIGljb246ICdsb2NhdGlvbjYnIH0sXG4gICAgeyBuYW1lOiAnbG9jYXRpb243JywgaWNvbjogJ2xvY2F0aW9uNycgfSxcbiAgICB7IG5hbWU6ICdsb2NhdGlvbjgnLCBpY29uOiAnbG9jYXRpb244JyB9LFxuICAgIHsgbmFtZTogJ2xvY2F0aW9uOScsIGljb246ICdsb2NhdGlvbjknIH0sXG4gICAgeyBuYW1lOiAnbWFya2VyMicsIGljb246ICdtYXJrZXIyJyB9LFxuICAgIHsgbmFtZTogJ21hcmtlcjMnLCBpY29uOiAnbWFya2VyMycgfSxcbiAgICB7IG5hbWU6ICdtYXJrZXI0JywgaWNvbjogJ21hcmtlcjQnIH0sXG4gICAgeyBuYW1lOiAnbWFya2VyNScsIGljb246ICdtYXJrZXI1JyB9LFxuICAgIHsgbmFtZTogJ21hcmtlcjYnLCBpY29uOiAnbWFya2VyNicgfSxcbiAgICB7IG5hbWU6ICdtYXJrZXI3JywgaWNvbjogJ21hcmtlcjcnIH0sXG4gICAgeyBuYW1lOiAnbW9udW1lbnQyJywgaWNvbjogJ21vbnVtZW50MicgfSxcbiAgICB7IG5hbWU6ICdtb3VudGFpbnMnLCBpY29uOiAnbW91bnRhaW5zJyB9LFxuICAgIHsgbmFtZTogJ3AnLCBpY29uOiAncCcgfSxcbiAgICB7IG5hbWU6ICdwZXRyb2wnLCBpY29uOiAncGV0cm9sJyB9LFxuICAgIHsgbmFtZTogJ3BldHJvbDInLCBpY29uOiAncGV0cm9sMicgfSxcbiAgICB7IG5hbWU6ICdwaGFybWFjeScsIGljb246ICdwaGFybWFjeScgfSxcbiAgICB7IG5hbWU6ICdwaG9uZTEzJywgaWNvbjogJ3Bob25lMTMnIH0sXG4gICAgeyBuYW1lOiAncGluMTAnLCBpY29uOiAncGluMTAnIH0sXG4gICAgeyBuYW1lOiAncGlucycsIGljb246ICdwaW5zJyB9LFxuICAgIHsgbmFtZTogJ3BpbnMxJywgaWNvbjogJ3BpbnMxJyB9LFxuICAgIHsgbmFtZTogJ3BpbnMxMCcsIGljb246ICdwaW5zMTAnIH0sXG4gICAgeyBuYW1lOiAncGluczExJywgaWNvbjogJ3BpbnMxMScgfSxcbiAgICB7IG5hbWU6ICdwaW5zMTInLCBpY29uOiAncGluczEyJyB9LFxuICAgIHsgbmFtZTogJ3BpbnMxMycsIGljb246ICdwaW5zMTMnIH0sXG4gICAgeyBuYW1lOiAncGluczE0JywgaWNvbjogJ3BpbnMxNCcgfSxcbiAgICB7IG5hbWU6ICdwaW5zMTUnLCBpY29uOiAncGluczE1JyB9LFxuICAgIHsgbmFtZTogJ3BpbnMxNicsIGljb246ICdwaW5zMTYnIH0sXG4gICAgeyBuYW1lOiAncGluczE3JywgaWNvbjogJ3BpbnMxNycgfSxcbiAgICB7IG5hbWU6ICdwaW5zMTgnLCBpY29uOiAncGluczE4JyB9LFxuICAgIHsgbmFtZTogJ3BpbnMxOScsIGljb246ICdwaW5zMTknIH0sXG4gICAgeyBuYW1lOiAncGluczInLCBpY29uOiAncGluczInIH0sXG4gICAgeyBuYW1lOiAncGluczIwJywgaWNvbjogJ3BpbnMyMCcgfSxcbiAgICB7IG5hbWU6ICdwaW5zMjEnLCBpY29uOiAncGluczIxJyB9LFxuICAgIHsgbmFtZTogJ3BpbnMyMicsIGljb246ICdwaW5zMjInIH0sXG4gICAgeyBuYW1lOiAncGluczIzJywgaWNvbjogJ3BpbnMyMycgfSxcbiAgICB7IG5hbWU6ICdwaW5zMjQnLCBpY29uOiAncGluczI0JyB9LFxuICAgIHsgbmFtZTogJ3BpbnMyNScsIGljb246ICdwaW5zMjUnIH0sXG4gICAgeyBuYW1lOiAncGluczI2JywgaWNvbjogJ3BpbnMyNicgfSxcbiAgICB7IG5hbWU6ICdwaW5zMjcnLCBpY29uOiAncGluczI3JyB9LFxuICAgIHsgbmFtZTogJ3BpbnMyOCcsIGljb246ICdwaW5zMjgnIH0sXG4gICAgeyBuYW1lOiAncGluczI5JywgaWNvbjogJ3BpbnMyOScgfSxcbiAgICB7IG5hbWU6ICdwaW5zMycsIGljb246ICdwaW5zMycgfSxcbiAgICB7IG5hbWU6ICdwaW5zMzAnLCBpY29uOiAncGluczMwJyB9LFxuICAgIHsgbmFtZTogJ3BpbnMzMScsIGljb246ICdwaW5zMzEnIH0sXG4gICAgeyBuYW1lOiAncGluczMyJywgaWNvbjogJ3BpbnMzMicgfSxcbiAgICB7IG5hbWU6ICdwaW5zMzMnLCBpY29uOiAncGluczMzJyB9LFxuICAgIHsgbmFtZTogJ3BpbnMzNCcsIGljb246ICdwaW5zMzQnIH0sXG4gICAgeyBuYW1lOiAncGluczM1JywgaWNvbjogJ3BpbnMzNScgfSxcbiAgICB7IG5hbWU6ICdwaW5zMzYnLCBpY29uOiAncGluczM2JyB9LFxuICAgIHsgbmFtZTogJ3BpbnMzNycsIGljb246ICdwaW5zMzcnIH0sXG4gICAgeyBuYW1lOiAncGluczM4JywgaWNvbjogJ3BpbnMzOCcgfSxcbiAgICB7IG5hbWU6ICdwaW5zMzknLCBpY29uOiAncGluczM5JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM0JywgaWNvbjogJ3BpbnM0JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM0MCcsIGljb246ICdwaW5zNDAnIH0sXG4gICAgeyBuYW1lOiAncGluczQxJywgaWNvbjogJ3BpbnM0MScgfSxcbiAgICB7IG5hbWU6ICdwaW5zNDInLCBpY29uOiAncGluczQyJyB9LFxuICAgIHsgbmFtZTogJ3BpbnM0MycsIGljb246ICdwaW5zNDMnIH0sXG4gICAgeyBuYW1lOiAncGluczQ0JywgaWNvbjogJ3BpbnM0NCcgfSxcbiAgICB7IG5hbWU6ICdwaW5zNDUnLCBpY29uOiAncGluczQ1JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM0NicsIGljb246ICdwaW5zNDYnIH0sXG4gICAgeyBuYW1lOiAncGluczQ3JywgaWNvbjogJ3BpbnM0NycgfSxcbiAgICB7IG5hbWU6ICdwaW5zNDgnLCBpY29uOiAncGluczQ4JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM0OScsIGljb246ICdwaW5zNDknIH0sXG4gICAgeyBuYW1lOiAncGluczUnLCBpY29uOiAncGluczUnIH0sXG4gICAgeyBuYW1lOiAncGluczUwJywgaWNvbjogJ3BpbnM1MCcgfSxcbiAgICB7IG5hbWU6ICdwaW5zNTEnLCBpY29uOiAncGluczUxJyB9LFxuICAgIHsgbmFtZTogJ3BpbnM1MicsIGljb246ICdwaW5zNTInIH0sXG4gICAgeyBuYW1lOiAncGluczUzJywgaWNvbjogJ3BpbnM1MycgfSxcbiAgICB7IG5hbWU6ICdwaW5zNTQnLCBpY29uOiAncGluczU0JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM1NScsIGljb246ICdwaW5zNTUnIH0sXG4gICAgeyBuYW1lOiAncGluczU2JywgaWNvbjogJ3BpbnM1NicgfSxcbiAgICB7IG5hbWU6ICdwaW5zNTcnLCBpY29uOiAncGluczU3JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM1OCcsIGljb246ICdwaW5zNTgnIH0sXG4gICAgeyBuYW1lOiAncGluczU5JywgaWNvbjogJ3BpbnM1OScgfSxcbiAgICB7IG5hbWU6ICdwaW5zNicsIGljb246ICdwaW5zNicgfSxcbiAgICB7IG5hbWU6ICdwaW5zNjAnLCBpY29uOiAncGluczYwJyB9LFxuICAgIHsgbmFtZTogJ3BpbnM2MScsIGljb246ICdwaW5zNjEnIH0sXG4gICAgeyBuYW1lOiAncGluczYyJywgaWNvbjogJ3BpbnM2MicgfSxcbiAgICB7IG5hbWU6ICdwaW5zNjMnLCBpY29uOiAncGluczYzJyB9LFxuICAgIHsgbmFtZTogJ3BpbnM2NCcsIGljb246ICdwaW5zNjQnIH0sXG4gICAgeyBuYW1lOiAncGluczY1JywgaWNvbjogJ3BpbnM2NScgfSxcbiAgICB7IG5hbWU6ICdwaW5zNjYnLCBpY29uOiAncGluczY2JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM2NycsIGljb246ICdwaW5zNjcnIH0sXG4gICAgeyBuYW1lOiAncGluczY4JywgaWNvbjogJ3BpbnM2OCcgfSxcbiAgICB7IG5hbWU6ICdwaW5zNjknLCBpY29uOiAncGluczY5JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM3JywgaWNvbjogJ3BpbnM3JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM3MCcsIGljb246ICdwaW5zNzAnIH0sXG4gICAgeyBuYW1lOiAncGluczcxJywgaWNvbjogJ3BpbnM3MScgfSxcbiAgICB7IG5hbWU6ICdwaW5zNzInLCBpY29uOiAncGluczcyJyB9LFxuICAgIHsgbmFtZTogJ3BpbnM3MycsIGljb246ICdwaW5zNzMnIH0sXG4gICAgeyBuYW1lOiAncGluczc0JywgaWNvbjogJ3BpbnM3NCcgfSxcbiAgICB7IG5hbWU6ICdwaW5zNzUnLCBpY29uOiAncGluczc1JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM3NicsIGljb246ICdwaW5zNzYnIH0sXG4gICAgeyBuYW1lOiAncGluczc3JywgaWNvbjogJ3BpbnM3NycgfSxcbiAgICB7IG5hbWU6ICdwaW5zNzgnLCBpY29uOiAncGluczc4JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM3OScsIGljb246ICdwaW5zNzknIH0sXG4gICAgeyBuYW1lOiAncGluczgnLCBpY29uOiAncGluczgnIH0sXG4gICAgeyBuYW1lOiAncGluczgwJywgaWNvbjogJ3BpbnM4MCcgfSxcbiAgICB7IG5hbWU6ICdwaW5zODEnLCBpY29uOiAncGluczgxJyB9LFxuICAgIHsgbmFtZTogJ3BpbnM4MicsIGljb246ICdwaW5zODInIH0sXG4gICAgeyBuYW1lOiAncGluczgzJywgaWNvbjogJ3BpbnM4MycgfSxcbiAgICB7IG5hbWU6ICdwaW5zODQnLCBpY29uOiAncGluczg0JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM4NScsIGljb246ICdwaW5zODUnIH0sXG4gICAgeyBuYW1lOiAncGluczg2JywgaWNvbjogJ3BpbnM4NicgfSxcbiAgICB7IG5hbWU6ICdwaW5zODcnLCBpY29uOiAncGluczg3JyB9LFxuICAgIHsgbmFtZTogJ3BpbnM4OCcsIGljb246ICdwaW5zODgnIH0sXG4gICAgeyBuYW1lOiAncGluczg5JywgaWNvbjogJ3BpbnM4OScgfSxcbiAgICB7IG5hbWU6ICdwaW5zOScsIGljb246ICdwaW5zOScgfSxcbiAgICB7IG5hbWU6ICdwaW5zOTAnLCBpY29uOiAncGluczkwJyB9LFxuICAgIHsgbmFtZTogJ3BpbnM5MScsIGljb246ICdwaW5zOTEnIH0sXG4gICAgeyBuYW1lOiAncG9zaXRpb24nLCBpY29uOiAncG9zaXRpb24nIH0sXG4gICAgeyBuYW1lOiAncmVzdGF1cmFudDInLCBpY29uOiAncmVzdGF1cmFudDInIH0sXG4gICAgeyBuYW1lOiAncmlnaHQxNCcsIGljb246ICdyaWdodDE0JyB9LFxuICAgIHsgbmFtZTogJ3JvYWQzJywgaWNvbjogJ3JvYWQzJyB9LFxuICAgIHsgbmFtZTogJ3Nob3AyJywgaWNvbjogJ3Nob3AyJyB9LFxuICAgIHsgbmFtZTogJ3Nob3BwaW5nOCcsIGljb246ICdzaG9wcGluZzgnIH0sXG4gICAgeyBuYW1lOiAnc2l0JywgaWNvbjogJ3NpdCcgfSxcbiAgICB7IG5hbWU6ICdza2kxJywgaWNvbjogJ3NraTEnIH0sXG4gICAgeyBuYW1lOiAnc29jY2VyMScsIGljb246ICdzb2NjZXIxJyB9LFxuICAgIHsgbmFtZTogJ3N1aXRjYXNlMScsIGljb246ICdzdWl0Y2FzZTEnIH0sXG4gICAgeyBuYW1lOiAnc3VpdGNhc2UyJywgaWNvbjogJ3N1aXRjYXNlMicgfSxcbiAgICB7IG5hbWU6ICd0ZWxlcGhvbmUzJywgaWNvbjogJ3RlbGVwaG9uZTMnIH0sXG4gICAgeyBuYW1lOiAndGVudCcsIGljb246ICd0ZW50JyB9LFxuICAgIHsgbmFtZTogJ3RlbnQxJywgaWNvbjogJ3RlbnQxJyB9LFxuICAgIHsgbmFtZTogJ3RyYWluMycsIGljb246ICd0cmFpbjMnIH0sXG4gICAgeyBuYW1lOiAndHJhaW40JywgaWNvbjogJ3RyYWluNCcgfSxcbiAgICB7IG5hbWU6ICd0dXJuNycsIGljb246ICd0dXJuNycgfSxcbiAgICB7IG5hbWU6ICd3YWxrJywgaWNvbjogJ3dhbGsnIH0sXG4gICAgeyBuYW1lOiAnd2lmaTExJywgaWNvbjogJ3dpZmkxMScgfVxuICBdXG59O1xuIiwiLy8gU2ltcGxlIGljb25zIGZyb20gaHR0cDovL3d3dy5mbGF0aWNvbi5jb20vcGFja3Mvc2ltcGxlaWNvbi1wbGFjZXMvXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgZGlzY2xhaW1lcjogJzxhIGhyZWY9XCJodHRwOi8vd3d3LmZsYXRpY29uLmNvbS9wYWNrcy9zaW1wbGVpY29uLXBsYWNlcy9cIiB0YXJnZXQ9XCJfYmxhbmtcIj5TaW1wbGVJY29ucyBQbGFjZXM8L2E+LCBpY29ucyBieSA8YSBocmVmPVwiaHR0cDovL3d3dy5zaW1wbGVpY29uLmNvbVwiIHRhcmdldD1cIl9ibGFua1wiPnNpbXBsZWljb24uY29tPC9hPicsXG4gIGljb25zOiBbXG4gICAgeyBuYW1lOiAnYmVhY2gzJywgaWNvbjogJ2JlYWNoMycgfSxcbiAgICB7IG5hbWU6ICdiZWFjaDQnLCBpY29uOiAnYmVhY2g0JyB9LFxuICAgIHsgbmFtZTogJ2JvYXQxMicsIGljb246ICdib2F0MTInIH0sXG4gICAgeyBuYW1lOiAnYnVpbGRpbmcyMScsIGljb246ICdidWlsZGluZzIxJyB9LFxuICAgIHsgbmFtZTogJ2J1aWxkaW5nMjInLCBpY29uOiAnYnVpbGRpbmcyMicgfSxcbiAgICB7IG5hbWU6ICdidWlsZGluZzIzJywgaWNvbjogJ2J1aWxkaW5nMjMnIH0sXG4gICAgeyBuYW1lOiAnYnVpbGRpbmcyNCcsIGljb246ICdidWlsZGluZzI0JyB9LFxuICAgIHsgbmFtZTogJ2J1aWxkaW5nczUnLCBpY29uOiAnYnVpbGRpbmdzNScgfSxcbiAgICB7IG5hbWU6ICdjYXN0bGU3JywgaWNvbjogJ2Nhc3RsZTcnIH0sXG4gICAgeyBuYW1lOiAnY2h1cmNoNycsIGljb246ICdjaHVyY2g3JyB9LFxuICAgIHsgbmFtZTogJ2NvY29udXQ1JywgaWNvbjogJ2NvY29udXQ1JyB9LFxuICAgIHsgbmFtZTogJ2NvbXBhc3M0NCcsIGljb246ICdjb21wYXNzNDQnIH0sXG4gICAgeyBuYW1lOiAnY29tcGFzczQ1JywgaWNvbjogJ2NvbXBhc3M0NScgfSxcbiAgICB7IG5hbWU6ICdjb21wYXNzNDYnLCBpY29uOiAnY29tcGFzczQ2JyB9LFxuICAgIHsgbmFtZTogJ2NvbXBhc3M0NycsIGljb246ICdjb21wYXNzNDcnIH0sXG4gICAgeyBuYW1lOiAnY29tcGFzczQ5JywgaWNvbjogJ2NvbXBhc3M0OScgfSxcbiAgICB7IG5hbWU6ICdjb21wYXNzNTAnLCBpY29uOiAnY29tcGFzczUwJyB9LFxuICAgIHsgbmFtZTogJ2ZhY3Rvcnk3JywgaWNvbjogJ2ZhY3Rvcnk3JyB9LFxuICAgIHsgbmFtZTogJ2ZhY3Rvcnk4JywgaWNvbjogJ2ZhY3Rvcnk4JyB9LFxuICAgIHsgbmFtZTogJ2ZsYWczMScsIGljb246ICdmbGFnMzEnIH0sXG4gICAgeyBuYW1lOiAnZmxhZzMyJywgaWNvbjogJ2ZsYWczMicgfSxcbiAgICB7IG5hbWU6ICdoZWFydDIwNicsIGljb246ICdoZWFydDIwNicgfSxcbiAgICB7IG5hbWU6ICdob21lODQnLCBpY29uOiAnaG9tZTg0JyB9LFxuICAgIHsgbmFtZTogJ2hvbWU4NScsIGljb246ICdob21lODUnIH0sXG4gICAgeyBuYW1lOiAnaG9tZTg2JywgaWNvbjogJ2hvbWU4NicgfSxcbiAgICB7IG5hbWU6ICdob21lODcnLCBpY29uOiAnaG9tZTg3JyB9LFxuICAgIHsgbmFtZTogJ2hvbWU4OCcsIGljb246ICdob21lODgnIH0sXG4gICAgeyBuYW1lOiAnaG9tZTg5JywgaWNvbjogJ2hvbWU4OScgfSxcbiAgICB7IG5hbWU6ICdob21lOTAnLCBpY29uOiAnaG9tZTkwJyB9LFxuICAgIHsgbmFtZTogJ21hcDM1JywgaWNvbjogJ21hcDM1JyB9LFxuICAgIHsgbmFtZTogJ21hcDM2JywgaWNvbjogJ21hcDM2JyB9LFxuICAgIHsgbmFtZTogJ21hcDM3JywgaWNvbjogJ21hcDM3JyB9LFxuICAgIHsgbmFtZTogJ21hcDM4JywgaWNvbjogJ21hcDM4JyB9LFxuICAgIHsgbmFtZTogJ21hcDM5JywgaWNvbjogJ21hcDM5JyB9LFxuICAgIHsgbmFtZTogJ21hcDQwJywgaWNvbjogJ21hcDQwJyB9LFxuICAgIHsgbmFtZTogJ21hcDQxJywgaWNvbjogJ21hcDQxJyB9LFxuICAgIHsgbmFtZTogJ21hcDQyJywgaWNvbjogJ21hcDQyJyB9LFxuICAgIHsgbmFtZTogJ21hcDQzJywgaWNvbjogJ21hcDQzJyB9LFxuICAgIHsgbmFtZTogJ21hcDQ0JywgaWNvbjogJ21hcDQ0JyB9LFxuICAgIHsgbmFtZTogJ21hcDQ1JywgaWNvbjogJ21hcDQ1JyB9LFxuICAgIHsgbmFtZTogJ21hcDQ2JywgaWNvbjogJ21hcDQ2JyB9LFxuICAgIHsgbmFtZTogJ21hcDQ3JywgaWNvbjogJ21hcDQ3JyB9LFxuICAgIHsgbmFtZTogJ21hcDQ4JywgaWNvbjogJ21hcDQ4JyB9LFxuICAgIHsgbmFtZTogJ21hcDQ5JywgaWNvbjogJ21hcDQ5JyB9LFxuICAgIHsgbmFtZTogJ21hcDUwJywgaWNvbjogJ21hcDUwJyB9LFxuICAgIHsgbmFtZTogJ21hcDUxJywgaWNvbjogJ21hcDUxJyB9LFxuICAgIHsgbmFtZTogJ21hcDUyJywgaWNvbjogJ21hcDUyJyB9LFxuICAgIHsgbmFtZTogJ21hcDUzJywgaWNvbjogJ21hcDUzJyB9LFxuICAgIHsgbmFtZTogJ21hcDU0JywgaWNvbjogJ21hcDU0JyB9LFxuICAgIHsgbmFtZTogJ21hcDU1JywgaWNvbjogJ21hcDU1JyB9LFxuICAgIHsgbmFtZTogJ21hcDU2JywgaWNvbjogJ21hcDU2JyB9LFxuICAgIHsgbmFtZTogJ21hcDU3JywgaWNvbjogJ21hcDU3JyB9LFxuICAgIHsgbmFtZTogJ21hcDU4JywgaWNvbjogJ21hcDU4JyB9LFxuICAgIHsgbmFtZTogJ21hcDU5JywgaWNvbjogJ21hcDU5JyB9LFxuICAgIHsgbmFtZTogJ21hcDYwJywgaWNvbjogJ21hcDYwJyB9LFxuICAgIHsgbmFtZTogJ3BhbG05JywgaWNvbjogJ3BhbG05JyB9LFxuICAgIHsgbmFtZTogJ3BsYWNlaG9sZGVyNCcsIGljb246ICdwbGFjZWhvbGRlcjQnIH0sXG4gICAgeyBuYW1lOiAnc2FpbGJvYXQ1JywgaWNvbjogJ3NhaWxib2F0NScgfSxcbiAgICB7IG5hbWU6ICdzdW5iYXRoaW5nJywgaWNvbjogJ3N1bmJhdGhpbmcnIH0sXG4gICAgeyBuYW1lOiAnc3VuYmF0aGluZzEnLCBpY29uOiAnc3VuYmF0aGluZzEnIH0sXG4gICAgeyBuYW1lOiAndG93ZXIxNScsIGljb246ICd0b3dlcjE1JyB9LFxuICAgIHsgbmFtZTogJ3Rvd24nLCBpY29uOiAndG93bicgfVxuICBdXG59O1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5jZGIuYWRtaW4gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ11bJ2FkbWluJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXVsnYWRtaW4nXSA6IG51bGwpO1xudmFyIFVwbG9hZE1vZGVsID0gcmVxdWlyZSgnLi91cGxvYWRfbW9kZWwnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgY2xhc3NOYW1lOiAnQXNzZXRQYW5lJyxcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2sgLmpzLWZpbGVCdXR0b24nOiAnX29uRHJvcGJveENsaWNrJ1xuICB9LFxuXG4gIF9VUExPQURFUjoge1xuICAgIHVybDogICAgICAgICAgICAgICcvYXBpL3YxL3VzZXJzLzwlLSBpZCAlPi9hc3NldHMnLFxuICAgIHVwbG9hZHM6ICAgICAgICAgIDEsIC8vIE1heCB1cGxvYWRzIGF0IHRoZSBzYW1lIHRpbWVcbiAgICBtYXhGaWxlU2l6ZTogICAgICAxMDQ4NTc2LCAvLyAxTUJcbiAgICBhY2NlcHRGaWxlVHlwZXM6ICBbJ3BuZycsJ3N2ZycsJ2pwZWcnLCdqcGcnXSxcbiAgICBhY2NlcHRTeW5jOiAgICAgICB1bmRlZmluZWQsXG4gICAgcmVzb2x1dGlvbjogICAgICAgXCIxMDI0eDEwMjRcIlxuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIF8uYmluZEFsbCh0aGlzLCAnX29uRGJ4Q2hvb3NlclN1Y2Nlc3MnKTtcblxuICAgIHRoaXMua2luZCA9IHRoaXMub3B0aW9ucy5raW5kO1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMuX3NldHVwTW9kZWwoKTtcbiAgICB0aGlzLmNvbGxlY3Rpb24gPSB0aGlzLm9wdGlvbnMuY29sbGVjdGlvbjtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuXG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL21hcC9pbWFnZV9waWNrZXIvZHJvcGJveF90ZW1wbGF0ZScpO1xuXG4gICAgdGhpcy4kZWwuaHRtbCh0aGlzLnRlbXBsYXRlKCkpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX3NldHVwTW9kZWw6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwgPSBuZXcgVXBsb2FkTW9kZWwoe1xuICAgICAgdHlwZTogdGhpcy5vcHRpb25zLnR5cGUsXG4gICAgICBraW5kOiB0aGlzLm9wdGlvbnMua2luZFxuICAgIH0sIHtcbiAgICAgIHVzZXJJZDogdGhpcy51c2VyLmdldChcImlkXCIpXG4gICAgfSk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6c3RhdGUnLCB0aGlzLl9vbkNoYW5nZVN0YXRlLCB0aGlzKTtcbiAgfSxcblxuICBfb25TdGF0ZVVwbG9hZGVkOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNvbGxlY3Rpb24uZmV0Y2goKTtcbiAgICB0aGlzLm1vZGVsLnNldEZyZXNoKHsga2luZDogdGhpcy5raW5kIH0pO1xuICB9LFxuXG4gIF9vblN0YXRlRXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3Nob3dGaWxlRXJyb3IoKTtcbiAgICB0aGlzLnRyaWdnZXIoXCJoaWRlX2xvYWRlclwiLCB0aGlzKTtcbiAgICB0aGlzLiQoXCIuanMtaW1wb3J0LXBhbmVsXCIpLnNob3coKTtcbiAgICB0aGlzLm1vZGVsLnNldEZyZXNoKHsga2luZDogdGhpcy5raW5kIH0pO1xuICB9LFxuXG4gIF9zaG93RmlsZUVycm9yOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3N0YXRlJykgPT09IFwiZXJyb3JcIikge1xuICAgICAgdGhpcy4kKCcuanMtZmlsZUVycm9yJylcbiAgICAgICAgLnRleHQodGhpcy5tb2RlbC5nZXQoJ2dldF9lcnJvcl90ZXh0Jykud2hhdF9hYm91dClcbiAgICAgICAgLnNob3coKTtcbiAgICAgIHRoaXMuJCgnLmpzLWZpbGVCdXR0b24nKS5hZGRDbGFzcygnQnV0dG9uLS1uZWdhdGl2ZScpO1xuICAgIH1cbiAgfSxcblxuICBfaGlkZUZpbGVFcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKCcuanMtZmlsZUVycm9yJykuaGlkZSgpO1xuICAgIHRoaXMuJCgnLmpzLWZpbGVMYWJlbCcpLnNob3coKTtcbiAgICB0aGlzLiQoJy5qcy1maWxlQnV0dG9uJykucmVtb3ZlQ2xhc3MoJ0J1dHRvbi0tbmVnYXRpdmUnKTtcbiAgfSxcblxuICBfb25DaGFuZ2VTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHN0YXRlID0gdGhpcy5tb2RlbC5nZXQoJ3N0YXRlJyk7XG5cbiAgICBpZiAoc3RhdGUgPT09ICd1cGxvYWRlZCcpIHtcbiAgICAgIHRoaXMuX29uU3RhdGVVcGxvYWRlZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoc3RhdGUgPT0gXCJlcnJvclwiKSB7XG4gICAgICAgIHRoaXMuX29uU3RhdGVFcnJvcigpO1xuICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gJ2lkbGUnIHx8IHN0YXRlID09PSBcInVwbG9hZGluZ1wiKSB7XG4gICAgICAgIHRoaXMuJChcIi5qcy1pbXBvcnQtcGFuZWxcIikuaGlkZSgpO1xuICAgICAgICB0aGlzLnRyaWdnZXIoXCJzaG93X2xvYWRlclwiLCB0aGlzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuJChcIi5qcy1pbXBvcnQtcGFuZWxcIikuc2hvdygpO1xuICAgICAgICB0aGlzLnRyaWdnZXIoXCJoaWRlX2xvYWRlclwiLCB0aGlzKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cblxuICBfb25Ecm9wYm94Q2xpY2s6IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLmtpbGxFdmVudChlKTtcblxuICAgIERyb3Bib3guY2hvb3NlKHtcbiAgICAgIHN1Y2Nlc3M6ICAgICAgdGhpcy5fb25EYnhDaG9vc2VyU3VjY2VzcyxcbiAgICAgIG11bHRpc2VsZWN0OiAgZmFsc2UsXG4gICAgICBsaW5rVHlwZTogICAgIFwiZGlyZWN0XCIsXG4gICAgICBleHRlbnNpb25zOiAgIF8ubWFwKHRoaXMuX1VQTE9BREVSLmFjY2VwdEZpbGVUeXBlcywgZnVuY3Rpb24oZXh0KSB7IHJldHVybiAnLicgKyBleHQgfSlcbiAgICB9KTtcbiAgfSxcblxuICBfb25EYnhDaG9vc2VyU3VjY2VzczogZnVuY3Rpb24oZmlsZXMpIHtcbiAgICBpZiAoZmlsZXMgJiYgZmlsZXNbMF0pIHtcbiAgICAgIHRoaXMubW9kZWwuc2V0KHtcbiAgICAgICAgdHlwZTogJ3VybCcsXG4gICAgICAgIHZhbHVlOiBmaWxlc1swXS5saW5rLFxuICAgICAgICBzdGF0ZTogJ3VwbG9hZGluZydcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLm1vZGVsLnVwbG9hZCgpO1xuXG4gICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3N0YXRlJykgIT09IFwiZXJyb3JcIikge1xuICAgICAgICAvLyBSZW1vdmUgZXJyb3JzXG4gICAgICAgIHRoaXMuX2hpZGVGaWxlRXJyb3IoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3Nob3dGaWxlRXJyb3IoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbmNkYi5hZG1pbiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXVsnYWRtaW4nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddWydhZG1pbiddIDogbnVsbCk7XG52YXIgVXBsb2FkTW9kZWwgPSByZXF1aXJlKCcuL3VwbG9hZF9tb2RlbCcpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdBc3NldFBhbmUnLFxuXG4gIG9wdGlvbnM6IHtcbiAgICB0eXBlOiAndXJsJyxcbiAgICBhY2NlcHRTeW5jOiBmYWxzZSxcbiAgICBmaWxlRW5hYmxlZDogdHJ1ZSxcbiAgICBmb3JtVGVtcGxhdGU6ICcnLFxuICAgIGhlYWRlclRlbXBsYXRlOiAnJyxcbiAgICBmaWxlQXR0cnM6IHt9XG4gIH0sXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2tleXVwIC5qcy10ZXh0SW5wdXQnOiAnX29uVGV4dENoYW5nZWQnLFxuICAgICdzdWJtaXQgLmpzLWZvcm0nOiAnX29uU3VibWl0Rm9ybSdcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcblxuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMua2luZCA9IHRoaXMub3B0aW9ucy5raW5kO1xuXG4gICAgdGhpcy5jb2xsZWN0aW9uID0gdGhpcy5vcHRpb25zLmNvbGxlY3Rpb247XG5cbiAgICB0aGlzLl9zZXR1cE1vZGVsKCk7XG5cbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvbWFwL2ltYWdlX3BpY2tlci9maWxlX3VwbG9hZF90ZW1wbGF0ZScpO1xuXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGhpcy50ZW1wbGF0ZShfLmV4dGVuZCh0aGlzLm9wdGlvbnMsIHRoaXMubW9kZWwuYXR0cmlidXRlcykpXG4gICAgKTtcblxuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9zZXR1cE1vZGVsOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsID0gbmV3IFVwbG9hZE1vZGVsKHtcbiAgICAgIHR5cGU6IHRoaXMub3B0aW9ucy50eXBlLFxuICAgICAga2luZDogdGhpcy5vcHRpb25zLmtpbmRcbiAgICB9LCB7XG4gICAgICB1c2VySWQ6IHRoaXMudXNlci5nZXQoXCJpZFwiKVxuICAgIH0pO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOnN0YXRlJywgdGhpcy5fb25DaGFuZ2VTdGF0ZSwgdGhpcyk7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5maWxlRW5hYmxlZCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdGhpcy4kKCcuanMtZmlsZUlucHV0JykuYmluZCgnY2hhbmdlJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAodGhpcy5maWxlcyAmJiB0aGlzLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBzZWxmLl9vbkZpbGVDaGFuZ2VkKHRoaXMuZmlsZXMpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5faW5pdERyb3B6b25lKCk7XG4gICAgfVxuICB9LFxuXG4gIF9vblRleHRDaGFuZ2VkOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLiQoJy5qcy10ZXh0SW5wdXQnKS52YWwoKTtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICB0aGlzLl9oaWRlVGV4dEVycm9yKCk7XG4gICAgfVxuICB9LFxuXG4gIF9vblN1Ym1pdEZvcm06IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZSkgdGhpcy5raWxsRXZlbnQoZSk7XG5cbiAgICAvLyBVUkwgc3VibWl0XG4gICAgdmFyIHZhbHVlID0gdGhpcy4kKCcuanMtdGV4dElucHV0JykudmFsKCk7XG5cbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICB0aGlzLl9oaWRlVGV4dEVycm9yKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ2hhbmdlIGZpbGUgYXR0cmlidXRlcyA6U1xuICAgIHRoaXMudHJpZ2dlcigndXJsU2VsZWN0ZWQnLCB0aGlzKTtcblxuICAgIC8vIENoYW5nZSBtb2RlbFxuICAgIHRoaXMubW9kZWwuc2V0KHtcbiAgICAgIHR5cGU6ICd1cmwnLFxuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgc3RhdGU6ICdpZGxlJ1xuICAgIH0pO1xuXG4gICAgdGhpcy5tb2RlbC51cGxvYWQoKTtcblxuICAgIGlmICh0aGlzLm1vZGVsLmdldCgnc3RhdGUnKSAhPT0gXCJlcnJvclwiKSB7XG4gICAgICAvLyBSZW1vdmUgZXJyb3JzXG4gICAgICB0aGlzLl9oaWRlRmlsZUVycm9yKCk7XG4gICAgICB0aGlzLl9oaWRlVGV4dEVycm9yKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3Nob3dUZXh0RXJyb3IoKTtcbiAgICB9XG4gIH0sXG5cblxuICBfaW5pdERyb3B6b25lOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZWwgPSAkKCdodG1sJylbMF07IC8vIDooXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdGhpcy5kcmFnc3RlciA9IG5ldyBEcmFnc3RlcihlbCk7XG5cbiAgICAkKGVsKS5iaW5kKFwiZHJhZ3N0ZXI6ZW50ZXJcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgIHNlbGYuX3Nob3dEcm9wem9uZSgpO1xuICAgIH0pO1xuXG4gICAgJChlbCkuYmluZChcImRyYWdzdGVyOmxlYXZlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBzZWxmLl9oaWRlRHJvcHpvbmUoKTtcbiAgICB9KTtcblxuICAgIGlmIChlbC5kcm9wem9uZSkgeyAvLyBhdm9pZCBsb2FkaW5nIHRoZSBkcm9wem9uZSB0d2ljZVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZHJvcHpvbmUgPSBuZXcgRHJvcHpvbmUoZWwsIHtcbiAgICAgIHVybDogJzopJyxcbiAgICAgIGF1dG9Qcm9jZXNzUXVldWU6IGZhbHNlLFxuICAgICAgcHJldmlld3NDb250YWluZXI6IGZhbHNlXG4gICAgfSk7XG5cbiAgICB0aGlzLmRyb3B6b25lLm9uKCdkcmFnb3ZlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi5fc2hvd0Ryb3B6b25lKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmRyb3B6b25lLm9uKFwiZHJvcFwiLCBmdW5jdGlvbiAoZXYpIHtcbiAgICAgIHZhciBmaWxlcyA9IGV2LmRhdGFUcmFuc2Zlci5maWxlcztcbiAgICAgIHNlbGYuX29uRmlsZUNoYW5nZWQoZmlsZXMpO1xuICAgICAgc2VsZi5faGlkZURyb3B6b25lKCk7XG4gICAgfSk7XG4gIH0sXG5cbiAgX2Rlc3Ryb3lEcm9wem9uZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVsID0gJCgnaHRtbCcpWzBdOyAvLyA6KFxuXG4gICAgaWYgKHRoaXMuZHJhZ3N0ZXIpIHtcbiAgICAgIHRoaXMuZHJhZ3N0ZXIucmVtb3ZlTGlzdGVuZXJzKCk7XG4gICAgICB0aGlzLmRyYWdzdGVyLnJlc2V0KCk7XG4gICAgICAkKGVsKS51bmJpbmQoJ2RyYWdzdGVyOmVudGVyIGRyYWdzdGVyOmxlYXZlJyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZHJvcHpvbmUpIHtcbiAgICAgIHRoaXMuZHJvcHpvbmUuZGVzdHJveSgpO1xuICAgIH1cbiAgfSxcblxuICBfc2V0VmFsaWRGaWxlRXh0ZW5zaW9uczogZnVuY3Rpb24obGlzdCkge1xuICAgIHJldHVybiBSZWdFeHAoXCIoXFwufFxcLykoXCIgKyBsaXN0LmpvaW4oJ3wnKSArIFwiKSRcIiwgXCJpXCIpO1xuICB9LFxuXG4gIF9vbkZpbGVDaGFuZ2VkOiBmdW5jdGlvbihmaWxlcykge1xuXG4gICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgZmlsZXMgPSBmaWxlc1swXTtcbiAgICB9XG5cbiAgICB0aGlzLm1vZGVsLnNldCh7XG4gICAgICB0eXBlOiAnZmlsZScsXG4gICAgICB2YWx1ZTogZmlsZXNcbiAgICB9KTtcblxuICAgIGlmICh0aGlzLm1vZGVsLmdldCgnc3RhdGUnKSAhPT0gXCJlcnJvclwiKSB7XG4gICAgICB0aGlzLl9oaWRlRmlsZUVycm9yKCk7XG4gICAgICB0aGlzLm1vZGVsLnNldCgnc3RhdGUnLCAnc2VsZWN0ZWQnKTtcbiAgICAgIHRoaXMubW9kZWwudXBsb2FkKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3Nob3dGaWxlRXJyb3IoKTtcbiAgICB9XG4gIH0sXG5cbiAgX3Nob3dUZXh0RXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJCgnLkZvcm0taW5wdXRFcnJvcicpLmFkZENsYXNzKCdpcy12aXNpYmxlJyk7XG4gIH0sXG5cbiAgX2hpZGVUZXh0RXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJCgnLkZvcm0taW5wdXRFcnJvcicpLnJlbW92ZUNsYXNzKCdpcy12aXNpYmxlJyk7XG4gIH0sXG5cbiAgX3Nob3dEcm9wem9uZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKCcuRm9ybS11cGxvYWQnKS5hZGRDbGFzcygnaXMtZHJvcHBpbmcnKTtcbiAgICB0aGlzLl9oaWRlRmlsZUVycm9yKCk7XG4gIH0sXG5cbiAgX2hpZGVEcm9wem9uZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKCcuRm9ybS11cGxvYWQnKS5yZW1vdmVDbGFzcygnaXMtZHJvcHBpbmcnKTtcbiAgfSxcblxuICBfc2hvd0ZpbGVFcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdzdGF0ZScpID09PSBcImVycm9yXCIpIHtcbiAgICAgIHRoaXMuJCgnLmpzLWZpbGVFcnJvcicpXG4gICAgICAgIC50ZXh0KHRoaXMubW9kZWwuZ2V0KCdnZXRfZXJyb3JfdGV4dCcpLndoYXRfYWJvdXQpXG4gICAgICAgIC5zaG93KCk7XG4gICAgICB0aGlzLiQoJy5qcy1maWxlTGFiZWwnKS5oaWRlKCk7XG4gICAgICB0aGlzLiQoJy5qcy1maWxlQnV0dG9uJykuYWRkQ2xhc3MoJ0J1dHRvbi0tbmVnYXRpdmUnKTtcbiAgICB9XG4gIH0sXG5cbiAgX2hpZGVGaWxlRXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJCgnLmpzLWZpbGVFcnJvcicpLmhpZGUoKTtcbiAgICB0aGlzLiQoJy5qcy1maWxlTGFiZWwnKS5zaG93KCk7XG4gICAgdGhpcy4kKCcuanMtZmlsZUJ1dHRvbicpLnJlbW92ZUNsYXNzKCdCdXR0b24tLW5lZ2F0aXZlJyk7XG4gIH0sXG5cbiAgX29uU3RhdGVVcGxvYWRlZDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmZldGNoKCk7XG4gICAgdGhpcy5tb2RlbC5zZXRGcmVzaCh7IGtpbmQ6IHRoaXMua2luZCB9KTtcbiAgICB0aGlzLiQoXCIuanMtdGV4dElucHV0XCIpLnZhbChcIlwiKTtcbiAgfSxcblxuICBfb25TdGF0ZUVycm9yOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9zaG93RmlsZUVycm9yKCk7XG4gICAgdGhpcy4kKFwiLmpzLWZvcm1cIikuc2hvdygpO1xuICAgIHRoaXMudHJpZ2dlcihcImhpZGVfbG9hZGVyXCIsIHRoaXMpO1xuICAgIHRoaXMubW9kZWwuc2V0RnJlc2goeyBraW5kOiB0aGlzLmtpbmQgfSk7XG4gIH0sXG5cbiAgX29uQ2hhbmdlU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzdGF0ZSA9IHRoaXMubW9kZWwuZ2V0KCdzdGF0ZScpO1xuXG4gICAgaWYgKHN0YXRlID09PSAndXBsb2FkZWQnKSB7XG4gICAgICB0aGlzLl9vblN0YXRlVXBsb2FkZWQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHN0YXRlID09PSBcImVycm9yXCIpIHtcbiAgICAgICAgdGhpcy5fb25TdGF0ZUVycm9yKCk7XG4gICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAnaWRsZScgfHwgc3RhdGUgPT09IFwidXBsb2FkaW5nXCIgfHwgc3RhdGUgPT09IFwic2VsZWN0ZWRcIikge1xuICAgICAgICB0aGlzLiQoXCIuanMtZm9ybVwiKS5oaWRlKCk7XG4gICAgICAgIHRoaXMudHJpZ2dlcihcInNob3dfbG9hZGVyXCIsIHRoaXMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy4kKFwiLmpzLWZvcm1cIikuc2hvdygpO1xuICAgICAgICB0aGlzLnRyaWdnZXIoXCJoaWRlX2xvYWRlclwiLCB0aGlzKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgY2xlYW46IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2Rlc3Ryb3lEcm9wem9uZSgpO1xuICAgIHRoaXMuJCgnLmpzLWZpbGVJbnB1dCcpLnVuYmluZCgnY2hhbmdlJyk7XG4gICAgdGhpcy5lbGRlcignY2xlYW4nKTtcbiAgfVxuXG59KTtcbiIsInZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIF9URVhUUzoge1xuICAgIG9rOiAgICAgICAgICAge1xuICAgICAgc2ltcGxlX2ljb25zOiBfdCgnU2V0IGltYWdlJyksXG4gICAgICBwaW5faWNvbnM6ICAgIF90KCdTZXQgaW1hZ2UnKSxcbiAgICAgIG1ha2lfaWNvbnM6ICAgX3QoJ1NldCBpbWFnZScpLFxuICAgICAgeW91cl9pY29uczogICBfdCgnU2V0IGltYWdlJyksXG4gICAgICB1cGxvYWRfZmlsZTogIF90KCdVcGxvYWQgaW1hZ2UnKSxcbiAgICAgIGRyb3Bib3g6ICAgICAgX3QoJ1VwbG9hZCBpbWFnZScpLFxuICAgICAgYm94OiAgICAgIF90KCdVcGxvYWQgaW1hZ2UnKVxuICAgIH1cbiAgfSxcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2sgLmpzLW9rJzogJ19maW5pc2gnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgIHRoaXMuX3RlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvbWFwL2ltYWdlX3BpY2tlci9mb290ZXJfdGVtcGxhdGUnKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuXG4gICAgdmFyIGFjdGlvbiA9IHRoaXMuX1RFWFRTLm9rW3RoaXMubW9kZWwuZ2V0KCdwYW5lJyldIHx8IFwiU2V0IGltYWdlXCI7XG4gICAgdmFyIG9wdGlvbnMgPSBfLmV4dGVuZCh0aGlzLm1vZGVsLmF0dHJpYnV0ZXMsIHsgYWN0aW9uOiAgYWN0aW9uIH0pO1xuICAgIHZhciAkZWwgPSAkKHRoaXMuX3RlbXBsYXRlKG9wdGlvbnMpKTtcblxuICAgIHRoaXMuJGVsLmh0bWwoJGVsKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOmRpc2NsYWltZXInLCB0aGlzLl91cGRhdGVGb290ZXJJbmZvLCB0aGlzKTtcbiAgfSxcblxuICBfdXBkYXRlRm9vdGVySW5mbzogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuZmluZChcIi5qcy1mb290ZXItaW5mb1wiKS5odG1sKHRoaXMubW9kZWwuZ2V0KFwiZGlzY2xhaW1lclwiKSk7XG4gIH0sXG5cbiAgX2ZpbmlzaDogZnVuY3Rpb24oZSkge1xuICAgIHRoaXMua2lsbEV2ZW50KGUpO1xuXG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwic3VibWl0X2VuYWJsZWRcIikpIHtcbiAgICAgIHRoaXMudHJpZ2dlcihcImZpbmlzaFwiLCB0aGlzKTtcbiAgICB9XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy1pdGVtJzogICAgICAgJ19vbkl0ZW1DbGljaycsXG4gICAgJ2NsaWNrIC5qcy15b3VyLWljb25zJzogJ19vbllvdXJJY29uc0NsaWNrJ1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwgPSB0aGlzLm9wdGlvbnMubW9kZWw7XG4gICAgdGhpcy5raW5kICA9IHRoaXMub3B0aW9ucy5raW5kO1xuICAgIHRoaXMuY29sbGVjdGlvbiA9IHRoaXMub3B0aW9ucy5jb2xsZWN0aW9uO1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9tYXAvaW1hZ2VfcGlja2VyL25hdmlnYXRpb25fdGVtcGxhdGUnKTtcblxuICAgIHRoaXMuX3ByZVJlbmRlcigpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIC8vIEl0IGlzIG5lY2Vzc2FyeSB0byBhZGQgdHdvIHN0YXRpYyBlbGVtZW50cyBiZWNhdXNlXG4gIC8vIHRoZXkgY2FuJ3QgYmUgcmVtb3ZlZC9yZXBsYWNlZCB1c2luZyByZW5kZXIgbWV0aG9kXG4gIC8vIGVhY2ggdGltZSBhIGNoYW5nZSAoaW4gYSBtb2RlbCBvciBhIGNvbGxlY3Rpb24pIGhhcHBlbnMuXG4gIC8vIFRoaXMgaXMgZHVlIHRvIHRoZSBiZWhhdmlvdXIgb2YgdGhlIENTUyBhbmltYXRpb25zLlxuICBfcHJlUmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgJHVJbm5lciA9ICQoJzxkaXY+JykuYWRkQ2xhc3MoJ3UtaW5uZXInKTtcbiAgICB2YXIgJGZpbHRlcnNJbm5lciA9ICQoJzxkaXY+JykuYWRkQ2xhc3MoJ0ZpbHRlcnMtaW5uZXInKTtcbiAgICB0aGlzLiRlbC5hcHBlbmQoJHVJbm5lci5hcHBlbmQoJGZpbHRlcnNJbm5lcikpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24obSwgYykge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuXG4gICAgdGhpcy4kKCcuRmlsdGVycy1pbm5lcicpLmh0bWwoXG4gICAgICB0aGlzLnRlbXBsYXRlKHtcbiAgICAgIGRyb3Bib3hfZW5hYmxlZDogdGhpcy5tb2RlbC5nZXQoXCJkcm9wYm94X2VuYWJsZWRcIiksXG4gICAgICBib3hfZW5hYmxlZDogdGhpcy5tb2RlbC5nZXQoXCJib3hfZW5hYmxlZFwiKSxcbiAgICAgIHBhbmU6IHRoaXMubW9kZWwuZ2V0KCdwYW5lJyksXG4gICAgICBraW5kOiB0aGlzLmtpbmRcbiAgICB9KSk7XG5cbiAgICBpZiAodGhpcy5jb2xsZWN0aW9uLndoZXJlKHsga2luZDogdGhpcy5raW5kIH0pLmxlbmd0aCA+IDApIHtcbiAgICAgIHZhciB0eXBlID0gXCJ5b3VyX2ljb25zXCI7XG4gICAgICB0aGlzLiRlbC5maW5kKCdbZGF0YS10eXBlPVwiJyArIHR5cGUgKyAnXCJdJykucmVtb3ZlQ2xhc3MoXCJpcy1kaXNhYmxlZFwiKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpwYW5lJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOnBhbmUnLCB0aGlzLl9lbmFibGVGaWx0ZXIsIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5tb2RlbCk7XG4gIH0sXG5cbiAgX29uWW91ckljb25zQ2xpY2s6IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAodGhpcy5jb2xsZWN0aW9uLndoZXJlKHsga2luZDogdGhpcy5raW5kIH0pLmxlbmd0aCA+IDApIHtcbiAgICAgIHZhciB0eXBlID0gJChlLnRhcmdldCkuZGF0YShcInR5cGVcIilcbiAgICAgIHRoaXMubW9kZWwuc2V0KCdwYW5lJywgdHlwZSk7XG4gICAgfVxuICB9LFxuXG4gIF9vbkl0ZW1DbGljazogZnVuY3Rpb24oZSkge1xuICAgIHZhciB0eXBlID0gJChlLnRhcmdldCkuZGF0YShcInR5cGVcIilcbiAgICB0aGlzLm1vZGVsLnNldCgncGFuZScsIHR5cGUpO1xuICB9LFxuXG4gIF9lbmFibGVGaWx0ZXI6IGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgdHlwZSA9IHRoaXMubW9kZWwuZ2V0KCdwYW5lJyk7XG4gICAgdmFyICRlbCA9IHRoaXMuJGVsLmZpbmQoJ1tkYXRhLXR5cGU9XCInICsgdHlwZSArICdcIl0nKTtcbiAgICAkZWwucmVtb3ZlQ2xhc3MoXCJpcy1kaXNhYmxlZFwiKTtcbiAgfVxufSk7XG5cblxuXG4iLCJ2YXIgQXNzZXRzSXRlbVZpZXcgPSByZXF1aXJlKCcuL2Fzc2V0c19pdGVtX3ZpZXcnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBBc3NldHNJdGVtVmlldy5leHRlbmQoe1xuXG4gIGV2ZW50czoge1xuICAgICdjbGljayc6ICdfb25DbGljaydcbiAgfSxcblxuICBfZGVsZXRlQXNzZXQ6IGZ1bmN0aW9uKCkge30sXG4gIF9vcGVuRHJvcGRvd246IGZ1bmN0aW9uKCkge31cblxufSk7XG4iLCJ2YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBVdGlscyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXVsnVXRpbHMnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddWydVdGlscyddIDogbnVsbCk7XG52YXIgbW9tZW50ID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ21vbWVudCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnbW9tZW50J10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xuXG4vKipcbiAqIE1vZGVsIHRoYXQgbGV0IHVzZXIgdXBsb2FkIGZpbGVzIHRvIG91ciBlbmRwb2ludHMuXG4gKlxuICogTk9URTogdGhpcyBtb2RlbCBleHRlbmRzIEJhY2tib25lLk1vZGVsIGluc3RlYWQgb2YgY2RiLmNvcmUuTW9kZWwsIGJlY2F1c2UgaXQncyByZXF1aXJlZCBmb3IgdGhlXG4gKiB2ZW5kb3IvYmFja2JvbmUtbW9kZWwtZmlsZS11cGxvYWQuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcblxuICB1cmw6IGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgIHZhciB2ZXJzaW9uID0gY2RiLmNvbmZpZy51cmxWZXJzaW9uKCdhc3NldCcsIG1ldGhvZCk7XG4gICAgcmV0dXJuICcvYXBpLycgKyB2ZXJzaW9uICsgJy91c2Vycy8nICsgdGhpcy51c2VySWQgKyAnL2Fzc2V0cydcbiAgfSxcblxuICBmaWxlQXR0cmlidXRlOiAnZmlsZW5hbWUnLFxuXG4gIGRlZmF1bHRzOiB7XG4gICAgdHlwZTogJycsXG4gICAgdmFsdWU6ICcnLFxuICAgIGludGVydmFsOiAwLFxuICAgIHByb2dyZXNzOiAwLFxuICAgIHN0YXRlOiAnaWRsZScsXG4gICAgb3B0aW9uOiAnJ1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKHZhbCwgb3B0cykge1xuICAgIHRoaXMudXNlciA9IG9wdHMgJiYgb3B0cy51c2VyO1xuXG4gICAgaWYgKCFvcHRzLnVzZXJJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCd1c2VySWQgaXMgcmVxdWlyZWQnKTtcbiAgICB9XG5cbiAgICB0aGlzLnVzZXJJZCA9IG9wdHMudXNlcklkO1xuXG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gICAgdGhpcy5fdmFsaWRhdGUodGhpcy5hdHRyaWJ1dGVzLCB7IHZhbGlkYXRlOiB0cnVlIH0pO1xuICB9LFxuXG4gIGlzVmFsaWRUb1VwbG9hZDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCd2YWx1ZScpICYmIHRoaXMuZ2V0KCdzdGF0ZScpICE9PSAnZXJyb3InO1xuICB9LFxuXG4gIHNldEZyZXNoOiBmdW5jdGlvbihhdHRyaWJ1dGVzKSB7XG4gICAgdGhpcy5jbGVhcigpO1xuICAgIHRoaXMuc2V0KGF0dHJpYnV0ZXMpO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuYmluZCgncHJvZ3Jlc3MnLCBmdW5jdGlvbihwcm9ncmVzcykge1xuICAgICAgdGhpcy5zZXQoe1xuICAgICAgICBwcm9ncmVzczogcHJvZ3Jlc3MqMTAwLFxuICAgICAgICBzdGF0ZTogJ3VwbG9hZGluZydcbiAgICAgIH0pO1xuICAgIH0sIHRoaXMpO1xuXG4gICAgdGhpcy5iaW5kKCdjaGFuZ2U6dmFsdWUnLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLmdldCgnc3RhdGUnKSA9PT0gXCJlcnJvclwiKSB7XG4gICAgICAgIHRoaXMuc2V0KHsgc3RhdGU6ICdpZGxlJyB9KVxuICAgICAgICB0aGlzLnVuc2V0KCdnZXRfZXJyb3JfdGV4dCcsIHsgc2lsZW50OiB0cnVlIH0pO1xuICAgICAgfVxuICAgIH0sIHRoaXMpO1xuXG4gICAgdGhpcy5iaW5kKCdlcnJvciBpbnZhbGlkJywgZnVuY3Rpb24obSwgZCkge1xuICAgICAgdGhpcy5zZXQoe1xuICAgICAgICBzdGF0ZTogJ2Vycm9yJyxcbiAgICAgICAgZXJyb3JfY29kZTogKGQgJiYgZC5lcnJvcl9jb2RlKSB8fCAnJyxcbiAgICAgICAgZ2V0X2Vycm9yX3RleHQ6IHtcbiAgICAgICAgICB0aXRsZTogJ0ludmFsaWQgaW1wb3J0JyxcbiAgICAgICAgICB3aGF0X2Fib3V0OiAoZCAmJiBkLm1zZykgfHwgJydcbiAgICAgICAgfVxuICAgICAgfSwgeyBzaWxlbnQ6IHRydWUgfSk7XG4gICAgICAvLyBXZSBuZWVkIHRoaXMsIGlmIG5vdCB2YWxpZGF0ZSB3aWxsIHJ1biBhZ2FpbiBhbmQgYWdhaW4gYW5kIGFnYWluLi4uIDooXG4gICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgIH0sIHRoaXMpO1xuICB9LFxuXG4gIHZhbGlkYXRlOiBmdW5jdGlvbihhdHRycykge1xuICAgIGlmICghYXR0cnMpIHJldHVybjtcblxuICAgIGlmIChhdHRycy50eXBlID09PSBcImZpbGVcIikge1xuICAgICAgLy8gTnVtYmVyIG9mIGZpbGVzXG4gICAgICBpZiAoYXR0cnMudmFsdWUgJiYgYXR0cnMudmFsdWUubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbXNnOiBcIlVuZm9ydHVuYXRlbHkgb25seSBvbmUgZmlsZSBpcyBhbGxvd2VkIHBlciB1cGxvYWRcIlxuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBGaWxlIGV4dGVuc2lvblxuICAgICAgdmFyIG5hbWUgPSBhdHRycy52YWx1ZS5uYW1lO1xuICAgICAgdmFyIGV4dCA9IG5hbWUuc3Vic3RyKG5hbWUubGFzdEluZGV4T2YoJy4nKSArIDEpO1xuICAgICAgaWYgKGV4dCkge1xuICAgICAgICBleHQgPSBleHQudG9Mb3dlckNhc2UoKTtcbiAgICAgIH1cbiAgICAgIGlmICghXy5jb250YWlucyhbXCJqcGdcIiwgXCJwbmdcIiwgXCJnaWZcIiwgXCJzdmdcIl0sIGV4dCkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtc2c6IFwiVW5mb3J0dW5hdGVseSB0aGlzIGZpbGUgZXh0ZW5zaW9uIGlzIG5vdCBhbGxvd2VkXCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChhdHRycy50eXBlID09PSBcInVybFwiKSB7XG4gICAgICAvLyBWYWxpZCBVUkw/XG4gICAgICBpZiAoIVV0aWxzLmlzVVJMKGF0dHJzLnZhbHVlKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1zZzogXCJVbmZvcnR1bmF0ZWx5IHRoZSBVUkwgcHJvdmlkZWQgaXMgbm90IHZhbGlkXCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICB9LFxuXG4gIGlzVmFsaWQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgndmFsdWUnKSAmJiB0aGlzLmdldCgnc3RhdGUnKSAhPT0gXCJlcnJvclwiXG4gIH0sXG5cbiAgdXBsb2FkOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgIGtpbmQ6IHRoaXMuZ2V0KCdraW5kJylcbiAgICB9O1xuXG4gICAgaWYgKHRoaXMuZ2V0KCd0eXBlJykgPT09IFwiZmlsZVwiKSB7XG4gICAgICBvcHRpb25zLmZpbGVuYW1lID0gdGhpcy5nZXQoJ3ZhbHVlJyk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmdldCgndHlwZScpID09PSBcInVybFwiKSB7XG4gICAgICBvcHRpb25zLnVybCA9IHRoaXMuZ2V0KCd2YWx1ZScpO1xuICAgIH1cblxuICAgIHRoaXMueGhyID0gdGhpcy5zYXZlKG9wdGlvbnMsIHtcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKG0pIHtcbiAgICAgICAgbS5zZXQoJ3N0YXRlJywgJ3VwbG9hZGVkJyk7XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKG0sIG1zZykge1xuXG4gICAgICAgIHZhciBtZXNzYWdlID0gJ1VuZm9ydHVuYXRlbHkgdGhlcmUgd2FzIGEgY29ubmVjdGlvbiBlcnJvcic7XG5cbiAgICAgICAgaWYgKG1zZyAmJiBtc2cuc3RhdHVzID09PSA0MjkpIHtcbiAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBKU09OLnBhcnNlKG1zZy5yZXNwb25zZVRleHQpO1xuICAgICAgICAgIG1lc3NhZ2UgPSByZXNwb25zZS5lcnJvcjtcbiAgICAgICAgfSBlbHNlIGlmIChtc2cgJiYgbXNnLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgdmFyIHJlc3BvbnNlID0gSlNPTi5wYXJzZShtc2cucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICBtZXNzYWdlID0gcmVzcG9uc2UuZXJyb3I7XG4gICAgICAgIH1cblxuICAgICAgICBzZWxmLnNldCh7XG4gICAgICAgICAgc3RhdGU6ICdlcnJvcicsXG4gICAgICAgICAgZ2V0X2Vycm9yX3RleHQ6IHsgdGl0bGU6ICdUaGVyZSB3YXMgYW4gZXJyb3InLCB3aGF0X2Fib3V0OiBtZXNzYWdlIH1cbiAgICAgICAgfSk7XG5cbiAgICAgIH0sXG4gICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGRlbGV0ZSBzZWxmLnhocjtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBzdG9wVXBsb2FkOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy54aHIpIHRoaXMueGhyLmFib3J0KCk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5jZGIuYWRtaW4gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ11bJ2FkbWluJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXVsnYWRtaW4nXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgQXNzZXRzVmlldyA9IHJlcXVpcmUoJy4vYXNzZXRzX3ZpZXcnKTtcbnZhciBBc3NldHNJdGVtVmlldyA9IHJlcXVpcmUoJy4vYXNzZXRzX2l0ZW1fdmlldycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFzc2V0c1ZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdBc3NldFBhbmUgQXNzZXRQYW5lLXVzZXJJY29ucycsXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbCA9IHRoaXMub3B0aW9ucy5tb2RlbDtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvbWFwL2ltYWdlX3BpY2tlci9hc3NldHNfdGVtcGxhdGUnKTtcblxuICAgIHRoaXMuY29sbGVjdGlvbi5iaW5kKCdhZGQgcmVtb3ZlIHJlc2V0JywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICB9LFxuXG4gIF9yZW5kZXJBc3NldHM6IGZ1bmN0aW9uKCkge1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBpdGVtcyA9IHRoaXMuY29sbGVjdGlvbi53aGVyZSh7IGtpbmQ6IHRoaXMub3B0aW9ucy5raW5kIH0pO1xuXG4gICAgXyhpdGVtcykuZWFjaChmdW5jdGlvbihtZGwpIHtcbiAgICAgIHZhciBpdGVtID0gbmV3IEFzc2V0c0l0ZW1WaWV3KHtcbiAgICAgICAgY2xhc3NOYW1lOiAnQXNzZXRJdGVtIEFzc2V0SXRlbS1Vc2VyJyxcbiAgICAgICAgbW9kZWw6IG1kbFxuICAgICAgfSk7XG4gICAgICBpdGVtLmJpbmQoJ3NlbGVjdGVkJywgc2VsZi5fc2VsZWN0SXRlbSwgc2VsZik7XG5cbiAgICAgIHNlbGYuJCgndWwnKS5hcHBlbmQoaXRlbS5yZW5kZXIoKS5lbCk7XG4gICAgICBzZWxmLmFkZFZpZXcoaXRlbSk7XG4gICAgfSk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcbnZhciBJbWFnZVBpY2tlck5hdmlnYXRpb25WaWV3ID0gcmVxdWlyZSgnLi9pbWFnZV9waWNrZXIvbmF2aWdhdGlvbl92aWV3Jyk7XG52YXIgRm9vdGVyVmlldyA9IHJlcXVpcmUoJy4vaW1hZ2VfcGlja2VyL2Zvb3Rlcl92aWV3Jyk7XG52YXIgQXNzZXRzVmlldyA9IHJlcXVpcmUoJy4vaW1hZ2VfcGlja2VyL2Fzc2V0c192aWV3Jyk7XG52YXIgVXNlckljb25zVmlldyA9IHJlcXVpcmUoJy4vaW1hZ2VfcGlja2VyL3VzZXJfaWNvbnNfdmlldycpO1xudmFyIFVwbG9hZFZpZXcgPSByZXF1aXJlKCcuL2ltYWdlX3BpY2tlci9maWxlX3VwbG9hZF92aWV3Jyk7XG52YXIgRHJvcGJveFZpZXcgPSByZXF1aXJlKCcuL2ltYWdlX3BpY2tlci9kcm9wYm94X3ZpZXcnKTtcbnZhciBCb3hWaWV3ID0gcmVxdWlyZSgnLi9pbWFnZV9waWNrZXIvYm94X3ZpZXcnKTtcbnZhciBtYWtpSWNvbnMgPSByZXF1aXJlKCcuL2ltYWdlX3BpY2tlci9kYXRhL21ha2lfaWNvbnMnKTtcbnZhciBwYXR0ZXJucyA9IHJlcXVpcmUoJy4vaW1hZ2VfcGlja2VyL2RhdGEvcGF0dGVybnMnKTtcbnZhciBwaW5NYXBzID0gcmVxdWlyZSgnLi9pbWFnZV9waWNrZXIvZGF0YS9waW5fbWFwcycpO1xudmFyIHNpbXBsZWljb24gPSByZXF1aXJlKCcuL2ltYWdlX3BpY2tlci9kYXRhL3NpbXBsZWljb24nKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfZmFjdG9yeScpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZScpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VEaWFsb2cuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdEaWFsb2cgSW1hZ2VQaWNrZXInLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG5cbiAgICB0aGlzLl92YWxpZGF0ZSgpO1xuXG4gICAgdGhpcy5raW5kID0gdGhpcy5vcHRpb25zLmtpbmQ7XG4gICAgdGhpcy5tb2RlbCA9IG5ldyBjZGIuY29yZS5Nb2RlbCh7XG4gICAgICBkaXNjbGFpbWVyOiAnJyxcbiAgICAgIGRyb3Bib3hfZW5hYmxlZDogISFjZGIuY29uZmlnLmdldCgnZHJvcGJveF9hcGlfa2V5JyksXG4gICAgICBib3hfZW5hYmxlZDogISFjZGIuY29uZmlnLmdldCgnYm94X2FwaV9rZXknKSxcbiAgICAgIHN1Ym1pdF9lbmFibGVkOiBmYWxzZVxuICAgIH0pO1xuXG4gICAgdGhpcy5jb2xsZWN0aW9uID0gbmV3IGNkYi5hZG1pbi5Bc3NldHMoW10sIHtcbiAgICAgIHVzZXI6IHRoaXMub3B0aW9ucy51c2VyXG4gICAgfSk7XG5cbiAgICB0aGlzLl90ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL21hcC9pbWFnZV9waWNrZXJfdGVtcGxhdGUnKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICB0aGlzLl9vbkNoYW5nZVBhbmUoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcbiAgICBCYXNlRGlhbG9nLnByb3RvdHlwZS5yZW5kZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLiQoJy5jb250ZW50JykuYWRkQ2xhc3MoJ0RpYWxvZy1jb250ZW50LS1leHBhbmRlZCcpO1xuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHRoaXMuX2luaXRBc3NldHMoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEFzc2V0czogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY29sbGVjdGlvbi5iaW5kKCdhZGQgcmVtb3ZlIHJlc2V0JywgdGhpcy5fb25Bc3NldHNGZXRjaGVkLCB0aGlzKTtcbiAgICB0aGlzLmNvbGxlY3Rpb24uZmV0Y2goKTtcbiAgfSxcblxuICBfc2hvd0xvYWRlcjogZnVuY3Rpb24gKCkge1xuICAgIHZhciBsb2FkZXIgPSB0aGlzLl9jb250ZW50UGFuZS5nZXRQYW5lKCdsb2FkZXInKTtcbiAgICBpZiAobG9hZGVyKSB7XG4gICAgICBsb2FkZXIuc2hvdygpO1xuICAgIH1cbiAgfSxcblxuICBfaGlkZUxvYWRlcjogZnVuY3Rpb24gKCkge1xuICAgIHZhciBsb2FkZXIgPSB0aGlzLl9jb250ZW50UGFuZS5nZXRQYW5lKCdsb2FkZXInKTtcbiAgICBpZiAobG9hZGVyKSB7XG4gICAgICBsb2FkZXIuaGlkZSgpO1xuICAgIH1cbiAgfSxcblxuICBfc2hvd1VwbG9hZExvYWRlcjogZnVuY3Rpb24gKCkge1xuICAgIHZhciBsb2FkZXIgPSB0aGlzLl9jb250ZW50UGFuZS5nZXRQYW5lKCd1cGxvYWRfbG9hZGVyJyk7XG5cbiAgICBpZiAobG9hZGVyKSB7XG4gICAgICBsb2FkZXIuc2hvdygpO1xuICAgIH1cbiAgfSxcblxuICBfaGlkZVVwbG9hZExvYWRlcjogZnVuY3Rpb24gKCkge1xuICAgIHZhciBsb2FkZXIgPSB0aGlzLl9jb250ZW50UGFuZS5nZXRQYW5lKCd1cGxvYWRfbG9hZGVyJyk7XG4gICAgaWYgKGxvYWRlcikge1xuICAgICAgbG9hZGVyLmhpZGUoKTtcbiAgICB9XG4gIH0sXG5cbiAgX29uQXNzZXRzRmV0Y2hlZDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX2hpZGVMb2FkZXIoKTtcblxuICAgIHZhciBpdGVtcyA9IHRoaXMuY29sbGVjdGlvbi53aGVyZSh7IGtpbmQ6IHRoaXMua2luZCB9KTtcblxuICAgIGlmIChpdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGlmICh0aGlzLmtpbmQgPT09ICdtYXJrZXInKSB7XG4gICAgICAgIHRoaXMubW9kZWwuc2V0KCdwYW5lJywgJ3NpbXBsZV9pY29ucycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ3BhbmUnLCAncGF0dGVybnMnKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tb2RlbC5zZXQoJ3BhbmUnLCAneW91cl9pY29ucycpO1xuICAgIH1cbiAgfSxcblxuICAvLyBpbXBsZW1lbnRzIGNkYi51aS5jb21tb24uRGlhbG9nLnByb3RvdHlwZS5yZW5kZXJcbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5fdGVtcGxhdGUoeyBraW5kOiB0aGlzLmtpbmQgfSk7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX3JlbmRlckNvbnRlbnRQYW5lKCk7XG4gICAgdGhpcy5fcmVuZGVyTmF2aWdhdGlvbigpO1xuICAgIHRoaXMuX3JlbmRlclRhYlBhbmUoKTtcblxuICAgIHRoaXMuX3JlbmRlckxvYWRlcigpO1xuICAgIHRoaXMuX3JlbmRlclVwbG9hZExvYWRlcigpO1xuXG4gICAgaWYgKHRoaXMua2luZCA9PT0gJ21hcmtlcicpIHtcbiAgICAgIHRoaXMuX3JlbmRlclNpbXBsZWljb25QYW5lKCk7XG4gICAgICB0aGlzLl9yZW5kZXJQaW5JY29uc1BhbmUoKTtcbiAgICAgIHRoaXMuX3JlbmRlck1ha2lzUGFuZSgpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5raW5kID09PSAncGF0dGVybicpIHtcbiAgICAgIHRoaXMuX3JlbmRlclBhdHRlcm5QYW5lKCk7XG4gICAgfVxuXG4gICAgdGhpcy5fcmVuZGVyVXNlckljb25zUGFuZSgpO1xuICAgIHRoaXMuX3JlbmRlckZpbGVQYW5lKCk7XG4gICAgdGhpcy5fcmVuZGVyRHJvcGJveFBhbmUoKTtcbiAgICB0aGlzLl9yZW5kZXJCb3hQYW5lKCk7XG5cbiAgICB0aGlzLl9yZW5kZXJGb290ZXIoKTtcbiAgICB0aGlzLl9jb250ZW50UGFuZS5hY3RpdmUoJ2xvYWRlcicpO1xuICB9LFxuXG4gIF9yZW5kZXJGb290ZXI6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9mb290ZXJWaWV3ID0gbmV3IEZvb3RlclZpZXcoe1xuICAgICAgbW9kZWw6IHRoaXMubW9kZWxcbiAgICB9KTtcblxuICAgIHRoaXMuX2Zvb3RlclZpZXcuYmluZCgnZmluaXNoJywgdGhpcy5fb2ssIHRoaXMpO1xuICAgIHRoaXMuJCgnLmpzLWZvb3RlcicpLmFwcGVuZCh0aGlzLl9mb290ZXJWaWV3LnJlbmRlcigpLmVsKTtcblxuICAgIHRoaXMuYWRkVmlldyh0aGlzLl9mb290ZXJWaWV3KTtcbiAgfSxcblxuICBfcmVuZGVyVGFiUGFuZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudGFiUGFuZSA9IG5ldyBjZGIudWkuY29tbW9uLlRhYlBhbmUoe1xuICAgICAgZWw6IHRoaXMuJCgnLkFzc2V0c0NvbnRlbnQnKVxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRWaWV3KHRoaXMudGFiUGFuZSk7XG4gIH0sXG5cbiAgX3JlbmRlckNvbnRlbnRQYW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5fY29udGVudFBhbmUgPSBuZXcgY2RiLnVpLmNvbW1vbi5UYWJQYW5lKHtcbiAgICAgIGVsOiB0aGlzLiQoJy5qcy1jb250ZW50LWNvbnRhaW5lcicpXG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fY29udGVudFBhbmUpO1xuICAgIHRoaXMuX2NvbnRlbnRQYW5lLmFjdGl2ZSh0aGlzLm1vZGVsLmdldCgnY29udGVudFBhbmUnKSk7XG4gIH0sXG5cbiAgX3JlbmRlck5hdmlnYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbmF2aWdhdGlvblZpZXcgPSBuZXcgSW1hZ2VQaWNrZXJOYXZpZ2F0aW9uVmlldyh7XG4gICAgICBlbDogdGhpcy4kKCcuanMtbmF2aWdhdGlvbicpLFxuICAgICAga2luZDogdGhpcy5raW5kLFxuICAgICAgY29sbGVjdGlvbjogdGhpcy5jb2xsZWN0aW9uLFxuICAgICAgdXNlcjogdGhpcy5vcHRpb25zLnVzZXIsXG4gICAgICBtb2RlbDogdGhpcy5tb2RlbFxuICAgIH0pO1xuXG4gICAgbmF2aWdhdGlvblZpZXcucmVuZGVyKCk7XG5cbiAgICB0aGlzLmFkZFZpZXcobmF2aWdhdGlvblZpZXcpO1xuICB9LFxuXG4gIF9yZW5kZXJQYW5lOiBmdW5jdGlvbiAobmFtZSwgcGFuZSkge1xuICAgIHBhbmUuYmluZCgnZmlsZUNob3NlbicsIHRoaXMuX29uRmlsZUNob3NlbiwgdGhpcyk7XG4gICAgcGFuZS5yZW5kZXIoKTtcbiAgICB0aGlzLl9hZGRQYW5lKG5hbWUsIHBhbmUpO1xuICB9LFxuXG4gIF9yZW5kZXJVcGxvYWRMb2FkZXI6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9hZGRUYWIoJ3VwbG9hZF9sb2FkZXInLFxuICAgICAgVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9sb2FkaW5nJywge1xuICAgICAgICB0aXRsZTogJ1VwbG9hZGluZyBhc3NldOKApicsXG4gICAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgICB9KVxuICAgICk7XG4gIH0sXG5cbiAgX3JlbmRlckxvYWRlcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX2FkZFRhYignbG9hZGVyJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycsIHtcbiAgICAgICAgdGl0bGU6ICdMb2FkaW5nIGFzc2V0c+KApicsXG4gICAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgICB9KVxuICAgICk7XG4gIH0sXG5cbiAgX3JlbmRlclBhdHRlcm5QYW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHBhbmUgPSBuZXcgQXNzZXRzVmlldyh7XG4gICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgIGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvbixcbiAgICAgIGtpbmQ6IHRoaXMua2luZCxcbiAgICAgIGljb25zOiBwYXR0ZXJucy5pY29ucyxcbiAgICAgIGZvbGRlcjogJ3BhdHRlcm5zJyxcbiAgICAgIHNpemU6ICcnXG4gICAgfSk7XG5cbiAgICB0aGlzLl9yZW5kZXJQYW5lKCdwYXR0ZXJucycsIHBhbmUpO1xuICB9LFxuXG4gIF9yZW5kZXJTaW1wbGVpY29uUGFuZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBwYW5lID0gbmV3IEFzc2V0c1ZpZXcoe1xuICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb24sXG4gICAgICBraW5kOiB0aGlzLmtpbmQsXG4gICAgICBpY29uczogc2ltcGxlaWNvbi5pY29ucyxcbiAgICAgIGRpc2NsYWltZXI6IHNpbXBsZWljb24uZGlzY2xhaW1lcixcbiAgICAgIGZvbGRlcjogJ3NpbXBsZWljb24nLFxuICAgICAgc2l6ZTogJydcbiAgICB9KTtcbiAgICB0aGlzLl9yZW5kZXJQYW5lKCdzaW1wbGVfaWNvbnMnLCBwYW5lKTtcbiAgfSxcblxuICBfcmVuZGVyTWFraXNQYW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHBhbmUgPSBuZXcgQXNzZXRzVmlldyh7XG4gICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgIGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvbixcbiAgICAgIGtpbmQ6IHRoaXMua2luZCxcbiAgICAgIGljb25zOiBtYWtpSWNvbnMuaWNvbnMsXG4gICAgICBkaXNjbGFpbWVyOiBtYWtpSWNvbnMuZGlzY2xhaW1lcixcbiAgICAgIGZvbGRlcjogJ21ha2ktaWNvbnMnLFxuICAgICAgc2l6ZTogJzE4J1xuICAgIH0pO1xuXG4gICAgdGhpcy5fcmVuZGVyUGFuZSgnbWFraV9pY29ucycsIHBhbmUpO1xuICB9LFxuXG4gIF9yZW5kZXJVc2VySWNvbnNQYW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHBhbmUgPSBuZXcgVXNlckljb25zVmlldyh7XG4gICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgIGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvbixcbiAgICAgIGtpbmQ6IHRoaXMua2luZCxcbiAgICAgIGZvbGRlcjogJ3lvdXItaWNvbnMnXG4gICAgfSk7XG5cbiAgICB0aGlzLl9yZW5kZXJQYW5lKCd5b3VyX2ljb25zJywgcGFuZSk7XG4gIH0sXG5cbiAgX3JlbmRlclBpbkljb25zUGFuZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBwYW5lID0gbmV3IEFzc2V0c1ZpZXcoe1xuICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb24sXG4gICAgICBraW5kOiB0aGlzLmtpbmQsXG4gICAgICBpY29uczogcGluTWFwcy5pY29ucyxcbiAgICAgIGRpc2NsYWltZXI6IHBpbk1hcHMuZGlzY2xhaW1lcixcbiAgICAgIGZvbGRlcjogJ3Bpbi1tYXBzJyxcbiAgICAgIHNpemU6ICcnXG4gICAgfSk7XG5cbiAgICB0aGlzLl9yZW5kZXJQYW5lKCdwaW5faWNvbnMnLCBwYW5lKTtcbiAgfSxcblxuICBfcmVuZGVyRmlsZVBhbmU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcGFuZSA9IG5ldyBVcGxvYWRWaWV3KHtcbiAgICAgIGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvbixcbiAgICAgIGtpbmQ6IHRoaXMua2luZCxcbiAgICAgIHVzZXI6IHRoaXMub3B0aW9ucy51c2VyXG4gICAgfSk7XG5cbiAgICBwYW5lLmJpbmQoJ3ZhbHVlQ2hhbmdlJywgdGhpcy5fb25GaWxlQ2hvc2VuLCB0aGlzKTtcbiAgICBwYW5lLmJpbmQoJ3Nob3dfbG9hZGVyJywgdGhpcy5fc2hvd1VwbG9hZExvYWRlciwgdGhpcyk7XG4gICAgcGFuZS5iaW5kKCdoaWRlX2xvYWRlcicsIHRoaXMuX2hpZGVVcGxvYWRMb2FkZXIsIHRoaXMpO1xuICAgIHRoaXMuX3JlbmRlclBhbmUoJ3VwbG9hZF9maWxlJywgcGFuZSk7XG4gIH0sXG5cbiAgX3JlbmRlckRyb3Bib3hQYW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdkcm9wYm94X2VuYWJsZWQnKSkge1xuICAgICAgdmFyIHBhbmUgPSBuZXcgRHJvcGJveFZpZXcoe1xuICAgICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgICAgY29sbGVjdGlvbjogdGhpcy5jb2xsZWN0aW9uLFxuICAgICAgICBraW5kOiB0aGlzLmtpbmQsXG4gICAgICAgIHVzZXI6IHRoaXMub3B0aW9ucy51c2VyXG4gICAgICB9KTtcblxuICAgICAgcGFuZS5iaW5kKCd2YWx1ZUNoYW5nZScsIHRoaXMuX29uRmlsZUNob3NlbiwgdGhpcyk7XG4gICAgICBwYW5lLmJpbmQoJ3Nob3dfbG9hZGVyJywgdGhpcy5fc2hvd1VwbG9hZExvYWRlciwgdGhpcyk7XG4gICAgICBwYW5lLmJpbmQoJ2hpZGVfbG9hZGVyJywgdGhpcy5faGlkZVVwbG9hZExvYWRlciwgdGhpcyk7XG4gICAgICB0aGlzLl9yZW5kZXJQYW5lKCdkcm9wYm94JywgcGFuZSk7XG4gICAgfVxuICB9LFxuXG4gIF9yZW5kZXJCb3hQYW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdib3hfZW5hYmxlZCcpKSB7XG4gICAgICB2YXIgcGFuZSA9IG5ldyBCb3hWaWV3KHtcbiAgICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICAgIGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvbixcbiAgICAgICAga2luZDogdGhpcy5raW5kLFxuICAgICAgICB1c2VyOiB0aGlzLm9wdGlvbnMudXNlclxuICAgICAgfSk7XG5cbiAgICAgIHBhbmUuYmluZCgndmFsdWVDaGFuZ2UnLCB0aGlzLl9vbkZpbGVDaG9zZW4sIHRoaXMpO1xuICAgICAgcGFuZS5iaW5kKCdzaG93X2xvYWRlcicsIHRoaXMuX3Nob3dVcGxvYWRMb2FkZXIsIHRoaXMpO1xuICAgICAgcGFuZS5iaW5kKCdoaWRlX2xvYWRlcicsIHRoaXMuX2hpZGVVcGxvYWRMb2FkZXIsIHRoaXMpO1xuICAgICAgdGhpcy5fcmVuZGVyUGFuZSgnYm94JywgcGFuZSk7XG4gICAgfVxuICB9LFxuXG4gIF9hZGRQYW5lOiBmdW5jdGlvbiAobmFtZSwgdmlldykge1xuICAgIHRoaXMudGFiUGFuZS5hZGRUYWIobmFtZSwgdmlldywge1xuICAgICAgYWN0aXZlOiB0aGlzLm1vZGVsLmdldCgncGFuZScpID09PSBuYW1lXG4gICAgfSk7XG4gIH0sXG5cbiAgX2FkZFRhYjogZnVuY3Rpb24gKG5hbWUsIHZpZXcpIHtcbiAgICB0aGlzLl9jb250ZW50UGFuZS5hZGRUYWIobmFtZSwgdmlldy5yZW5kZXIoKSk7XG4gICAgdGhpcy5hZGRWaWV3KHZpZXcpO1xuICB9LFxuXG4gIF92YWxpZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcy5vcHRpb25zLnVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3VzZXIgaXMgcmVxdWlyZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMub3B0aW9ucy5raW5kKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2tpbmQgc2hvdWxkIGJlIHBhc3NlZCcpO1xuICAgIH1cbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gQnVnIHdpdGggYmluZGluZy4uLiBkbyBub3Qgd29yayB3aXRoIHRoZSB1c3VhbCBvbmUgZm9yIHNvbWUgcmVhc29uIDooXG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6cGFuZScsIHRoaXMuX29uQ2hhbmdlUGFuZS5iaW5kKHRoaXMpKTtcbiAgfSxcblxuICBfb25DaGFuZ2VQYW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMudGFiUGFuZSkge1xuICAgICAgdGhpcy50YWJQYW5lLmFjdGl2ZSh0aGlzLm1vZGVsLmdldCgncGFuZScpKTtcblxuICAgICAgdGhpcy5tb2RlbC5zZXQoJ3N1Ym1pdF9lbmFibGVkJywgZmFsc2UpO1xuICAgICAgdmFyIGFjdGl2ZVBhbmUgPSB0aGlzLnRhYlBhbmUuZ2V0QWN0aXZlUGFuZSgpO1xuXG4gICAgICBpZiAoYWN0aXZlUGFuZSkge1xuICAgICAgICB0aGlzLm1vZGVsLnNldCgnZGlzY2xhaW1lcicsIGFjdGl2ZVBhbmUub3B0aW9ucy5kaXNjbGFpbWVyKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgX29rOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy50cmlnZ2VyKCdmaWxlQ2hvc2VuJywgdGhpcy5tb2RlbC5nZXQoJ3ZhbHVlJykpO1xuICAgIHRoaXMuY2xvc2UoKTtcbiAgfSxcblxuICBfb25GaWxlQ2hvc2VuOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tb2RlbC5zZXQoJ3N1Ym1pdF9lbmFibGVkJywgdHJ1ZSk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcblxuLyoqXG4gKiBTY3JhdGNoIG1vZGFsXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIGV2ZW50czogY2RiLmNvcmUuVmlldy5leHRlbmRFdmVudHMoe1xuICAgIFwiY2xpY2sgLmpzLW9wdGlvblwiIDogXCJfb25PcHRpb25DbGlja1wiLFxuICAgIFwiY2xpY2sgLmpzLXNraXBcIiAgIDogXCJfb25Ta2lwQ2xpY2tcIlxuICB9KSxcblxuICBvcHRpb25zOiB7XG4gICAgc2tpcERpc2FibGVkOiBmYWxzZVxuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcblxuICAgIGlmICghdGhpcy5vcHRpb25zLnRhYmxlKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCd0YWJsZSBpcyByZXF1aXJlZCcpO1xuICAgIH1cblxuICAgIHRoaXMudGFibGUgPSB0aGlzLm9wdGlvbnMudGFibGU7XG4gICAgdGhpcy5fdGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9tYXAvc2NyYXRjaF92aWV3X3RlbXBsYXRlJyk7XG5cbiAgfSxcblxuICAvLyBpbXBsZW1lbnRzIGNkYi51aS5jb21tb24uRGlhbG9nLnByb3RvdHlwZS5yZW5kZXJcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcbiAgICBCYXNlRGlhbG9nLnByb3RvdHlwZS5yZW5kZXIuY2FsbCh0aGlzKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICAvLyBpbXBsZW1lbnRzIGNkYi51aS5jb21tb24uRGlhbG9nLnByb3RvdHlwZS5yZW5kZXJcbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl90ZW1wbGF0ZSh7XG4gICAgICBuYW1lOiB0aGlzLnRhYmxlLmdldChcIm5hbWVcIiksXG4gICAgICBza2lwRGlzYWJsZWQ6IHRoaXMub3B0aW9ucy5za2lwRGlzYWJsZWQgXG4gICAgfSk7XG4gIH0sXG5cbiAgX29uU2tpcENsaWNrOiBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZSk7XG4gICAgdGhpcy5jbG9zZSgpO1xuICAgIHRoaXMudHJpZ2dlcihcInNraXBcIiwgdGhpcyk7XG4gIH0sXG5cbiAgX29uT3B0aW9uQ2xpY2s6IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLmtpbGxFdmVudChlKTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gICAgdGhpcy50cmlnZ2VyKFwibmV3R2VvbWV0cnlcIiwgJChlLnRhcmdldCkuY2xvc2VzdCgnLmpzLW9wdGlvbicpLmRhdGEoXCJ0eXBlXCIpKTtcbiAgfVxuXG59KTtcbiIsInZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIENob29zZUtleUNvbHVtbnNWaWV3ID0gcmVxdWlyZSgnLi9jaG9vc2Vfa2V5X2NvbHVtbnNfdmlldycpO1xudmFyIFNlbGVjdENvbHVtbnMgPSByZXF1aXJlKCcuL3NlbGVjdF9jb2x1bW5zX21vZGVsJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBJTlNUUlVDVElPTlNfU0FGRV9IVE1MOiAnU2VsZWN0IHRoZSBkYXRhc2V0IG9uIHRoZSByaWdodCB0aGF0IHlvdSB3YW50IHRvIG1lcmdlIHRoZSBsZWZ0IHdpdGguICcgK1xuICAgICdZb3UgY2FuIG9ubHkgbWVyZ2UgZGF0YXNldHMgYnkgam9pbmluZyBieSBjb2x1bW5zIG9mIHRoZSBzYW1lIHR5cGUgKGUuZy4gbnVtYmVyIHRvIGEgbnVtYmVyKS4nLFxuXG4gIGRlZmF1bHRzOiB7XG4gICAgdXNlcjogdW5kZWZpbmVkLFxuICAgIGlzUmVhZHlGb3JOZXh0U3RlcDogZmFsc2UsXG4gICAgZXhjbHVkZUNvbHVtbnM6IFtdLFxuICAgIGxlZnRUYWJsZTogdW5kZWZpbmVkLFxuICAgIGxlZnRDb2x1bW5zOiB1bmRlZmluZWQsXG4gICAgcmlnaHRUYWJsZURhdGE6IHVuZGVmaW5lZCxcbiAgICByaWdodENvbHVtbnM6IHVuZGVmaW5lZFxuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2luaXRDb2x1bW5zKCk7XG4gIH0sXG5cbiAgY3JlYXRlVmlldzogZnVuY3Rpb24oKSB7XG4gICAgLy8gUmVzZXQgc3RhdGVcbiAgICB0aGlzLnNldCgnZ290b05leHRTdGVwJywgZmFsc2UpO1xuICAgIHZhciBsZWZ0Q29sdW1ucyA9IHRoaXMuZ2V0KCdsZWZ0Q29sdW1ucycpO1xuICAgIGxlZnRDb2x1bW5zLmVhY2goZnVuY3Rpb24obSkge1xuICAgICAgbS51bnNldCgnc2VsZWN0ZWQnKTtcbiAgICB9KTtcbiAgICB0aGlzLmdldCgncmlnaHRDb2x1bW5zJykucmVzZXQoKTsgLy8gY29sdW1ucyBhcmUgZmV0Y2hlZCBieSB2aWV3XG4gICAgdGhpcy5fcmVzZXRTb3J0aW5nKGxlZnRDb2x1bW5zKTtcbiAgICB0aGlzLl9yZXNldFNvcnRpbmcodGhpcy5nZXQoJ3JpZ2h0Q29sdW1ucycpKTtcblxuICAgIHJldHVybiBuZXcgQ2hvb3NlS2V5Q29sdW1uc1ZpZXcoe1xuICAgICAgbW9kZWw6IHRoaXNcbiAgICB9KTtcbiAgfSxcblxuICBjaGFuZ2VSaWdodFRhYmxlOiBmdW5jdGlvbih0YWJsZURhdGEpIHtcbiAgICB0aGlzLmdldCgncmlnaHRDb2x1bW5zJykucmVzZXQoKTtcbiAgICB0aGlzLnNldCgncmlnaHRUYWJsZURhdGEnLCB0YWJsZURhdGEpO1xuXG4gICAgLy8gVE9ETzogZXh0cmFjdGVkIGZyb20gb2xkIGNvZGUsIGNkYi5hZG1pbi5UYWJsZUNvbHVtblNlbGVjdG9yLl9nZXRDb2x1bW5zLFxuICAgIC8vICAgaXNudCB0aGVyZSBzb21lIGJldHRlciB3YXkgdG8gZ2V0IHRoZSBzY2hlbWEvY29sdW1ucz9cbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiBjZGIuY29uZmlnLnByZWZpeFVybCgpICsgJy9hcGkvdjEvdGFibGVzLycgKyB0YWJsZURhdGEuaWQsXG4gICAgICBkYXRhVHlwZTogJ2pzb25wJyxcbiAgICAgIHN1Y2Nlc3M6IHRoaXMuX29uRmV0Y2hlZENvbHVtbnMuYmluZCh0aGlzKVxuICAgIH0pO1xuICB9LFxuXG4gIF9vbkZldGNoZWRDb2x1bW5zOiBmdW5jdGlvbihyZXN1bHRzKSB7XG4gICAgdmFyIGZpbHRlcmVkQ29sdW1ucyA9IHRoaXMuX2ZpbHRlckNvbHVtbnMocmVzdWx0cy5zY2hlbWEpO1xuICAgIHRoaXMuZ2V0KCdyaWdodENvbHVtbnMnKS5yZXNldChmaWx0ZXJlZENvbHVtbnMpO1xuICAgIHZhciBzZWxlY3RlZExlZnRDb2x1bW4gPSB0aGlzLnNlbGVjdGVkSXRlbUZvcignbGVmdENvbHVtbnMnKTtcbiAgICBpZiAoc2VsZWN0ZWRMZWZ0Q29sdW1uKSB7XG4gICAgICB0aGlzLmRpc2FibGVSaWdodENvbHVtbnNOb3RNYXRjaGluZ1R5cGUoc2VsZWN0ZWRMZWZ0Q29sdW1uLmdldCgndHlwZScpKTtcbiAgICB9XG4gIH0sXG5cbiAgZGlzYWJsZVJpZ2h0Q29sdW1uc05vdE1hdGNoaW5nVHlwZTogZnVuY3Rpb24obGVmdEtleUNvbHVtblR5cGUpIHtcbiAgICB0aGlzLmdldCgncmlnaHRDb2x1bW5zJykuZWFjaChmdW5jdGlvbihjb2x1bW4pIHtcbiAgICAgIHZhciBzaG91bGREaXNhYmxlID0gY29sdW1uLmdldCgndHlwZScpICE9PSBsZWZ0S2V5Q29sdW1uVHlwZTtcbiAgICAgIGlmIChzaG91bGREaXNhYmxlICYmIGNvbHVtbi5nZXQoJ3NlbGVjdGVkJykpIHtcbiAgICAgICAgLy8gRG9uJ3QgbGVhdmUgdGhlIGNvbHVtbiBzZWxlY3RlZCBpZiBzaG91bGQgYmUgZGlzYWJsZWRcbiAgICAgICAgY29sdW1uLnNldCgnc2VsZWN0ZWQnLCBmYWxzZSk7XG4gICAgICB9XG4gICAgICBjb2x1bW4uc2V0KCdkaXNhYmxlZCcsIHNob3VsZERpc2FibGUpO1xuICAgIH0pO1xuICB9LFxuXG4gIGFzc2VydElmUmVhZHlGb3JOZXh0U3RlcDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGlzUmVhZHkgPSAhISh0aGlzLnNlbGVjdGVkSXRlbUZvcignbGVmdENvbHVtbnMnKSAmJlxuICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1Gb3IoJ3JpZ2h0Q29sdW1ucycpICYmXG4gICAgICAgICAgICAgICAgICB0aGlzLmdldCgncmlnaHRUYWJsZURhdGEnKSk7XG4gICAgdGhpcy5zZXQoJ2lzUmVhZHlGb3JOZXh0U3RlcCcsIGlzUmVhZHkpO1xuICB9LFxuXG4gIG5leHRTdGVwOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IubmV4dFN0ZXAoe1xuICAgICAgdXNlcjogdGhpcy5nZXQoJ3VzZXInKSxcbiAgICAgIGxlZnRUYWJsZTogdGhpcy5nZXQoJ2xlZnRUYWJsZScpLFxuICAgICAgbGVmdENvbHVtbnM6IHRoaXMuZ2V0KCdsZWZ0Q29sdW1ucycpLFxuICAgICAgbGVmdEtleUNvbHVtbjogdGhpcy5zZWxlY3RlZEl0ZW1Gb3IoJ2xlZnRDb2x1bW5zJykuY2xvbmUoKSxcbiAgICAgIHJpZ2h0S2V5Q29sdW1uOiB0aGlzLnNlbGVjdGVkSXRlbUZvcigncmlnaHRDb2x1bW5zJykuY2xvbmUoKSxcbiAgICAgIHJpZ2h0Q29sdW1uczogdGhpcy5nZXQoJ3JpZ2h0Q29sdW1ucycpLFxuICAgICAgcmlnaHRUYWJsZURhdGE6IHRoaXMuZ2V0KCdyaWdodFRhYmxlRGF0YScpXG4gICAgfSk7XG4gIH0sXG5cbiAgc2VsZWN0ZWRJdGVtRm9yOiBmdW5jdGlvbihjb2xsZWN0aW9uTmFtZSkge1xuICAgIHJldHVybiB0aGlzLmdldChjb2xsZWN0aW9uTmFtZSkuZmluZChmdW5jdGlvbihjb2x1bW4pIHtcbiAgICAgIHJldHVybiBjb2x1bW4uZ2V0KCdzZWxlY3RlZCcpO1xuICAgIH0pO1xuICB9LFxuXG4gIF9pbml0Q29sdW1uczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGZpbHRlcmVkTGVmdENvbHVtbnMgPSB0aGlzLl9maWx0ZXJDb2x1bW5zKHRoaXMuZ2V0KCdsZWZ0VGFibGUnKS5nZXQoJ3NjaGVtYScpKTtcbiAgICB0aGlzLnNldCgnbGVmdENvbHVtbnMnLCBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbihmaWx0ZXJlZExlZnRDb2x1bW5zKSk7XG4gICAgdGhpcy5zZXQoJ3JpZ2h0Q29sdW1ucycsIG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKFtdKSk7XG4gIH0sXG5cbiAgX2ZpbHRlckNvbHVtbnM6IGZ1bmN0aW9uKHRhYmxlU2NoZW1hKSB7XG4gICAgdmFyIGV4Y2x1ZGVDb2x1bW5zID0gdGhpcy5nZXQoJ2V4Y2x1ZGVDb2x1bW5zJyk7XG5cbiAgICByZXR1cm4gXy5jaGFpbih0YWJsZVNjaGVtYSlcbiAgICAgIC5tYXAoZnVuY3Rpb24oY29sdW1uRGF0YSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC8vIFRPRE86IHdoeSBkb24ndCB3ZSB1c2UgYSBwcm9wZXIgbW9kZWwgZm9yIHNjaGVtYSwgdG8gcHJvdmlkZSBjb252ZW5pZW50IG1ldGhvZCB0byBnZXQgY29sdW1ucyBhcyBhIGNvbGxlY3Rpb24gYWxyZWFkeT9cbiAgICAgICAgICBuYW1lOiBjb2x1bW5EYXRhWzBdLFxuICAgICAgICAgIHR5cGU6IGNvbHVtbkRhdGFbMV1cbiAgICAgICAgfTtcbiAgICAgIH0pXG4gICAgICAucmVqZWN0KGZ1bmN0aW9uKGNvbHVtbikge1xuICAgICAgICByZXR1cm4gXy5jb250YWlucyhleGNsdWRlQ29sdW1ucywgY29sdW1uLm5hbWUpO1xuICAgICAgfSlcbiAgICAgIC52YWx1ZSgpO1xuICB9LFxuXG4gIF9yZXNldFNvcnRpbmc6IGZ1bmN0aW9uKGNvbHVtbnMpIHtcbiAgICAvLyBNYXkgYmVlbiBzZXQgb24gbmV4dCBzdGVwLCBzbyByZXNldCBzb3J0ZXJzIGlmIGdvaW5nIGJhY2s6XG4gICAgY29sdW1ucy5jb21wYXJhdG9yID0gZnVuY3Rpb24oY29sdW1uKSB7XG4gICAgICByZXR1cm4gY29sdW1uLmdldCgnbmFtZScpO1xuICAgIH07XG4gICAgY29sdW1ucy5zb3J0KCk7XG4gIH1cblxufSwge1xuICBoZWFkZXI6IHtcbiAgICBpY29uOiAnQ0RCLUljb25Gb250LXBsYXknLFxuICAgIHRpdGxlOiAnQ2hvb3NlIG1lcmdlIGNvbHVtbidcbiAgfSxcbiAgbmV4dFN0ZXA6IFNlbGVjdENvbHVtbnNcbn0pO1xuIiwidmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG52YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBDb2x1bW5zU2VsZWN0b3JWaWV3ID0gcmVxdWlyZSgnLi4vY29sdW1uc19zZWxlY3Rvcl92aWV3Jyk7XG52YXIgVGFibGVzU2VsZWN0b3JWaWV3ID0gcmVxdWlyZSgnLi4vdGFibGVzX3NlbGVjdG9yX3ZpZXcnKTtcbnZhciBGb290ZXJWaWV3ID0gcmVxdWlyZSgnLi4vZm9vdGVyX3ZpZXcnKTtcbnZhciBGb290ZXJJbmZvVmlldyA9IHJlcXVpcmUoJy4vZm9vdGVyX2luZm9fdmlldycpO1xuXG4vKipcbiAqIFZpZXcgdG8gY2hvb3NlIHRoZSBrZXkgY29sdW1ucyAoYW5kIGltcGxpY2l0bHkgdGhlIHJpZ2h0IHRhYmxlKS5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgJGVsID0gJChcbiAgICAgIHRoaXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL21lcmdlX2RhdGFzZXRzL2NvbHVtbl9tZXJnZS9jaG9vc2Vfa2V5X2NvbHVtbnMnKSh7XG4gICAgICAgIGxlZnRUYWJsZU5hbWU6IHRoaXMubW9kZWwuZ2V0KCdsZWZ0VGFibGUnKS5nZXQoJ25hbWUnKVxuICAgICAgfSlcbiAgICApO1xuICAgICRlbC5maW5kKCcuanMtbGVmdC10YWJsZScpLmFwcGVuZCh0aGlzLl9sZWZ0VGFibGVDb21ib1ZpZXcucmVuZGVyKCkuJGVsKTtcbiAgICAkZWwuZmluZCgnLmpzLWxlZnQtY29sdW1ucycpLmFwcGVuZCh0aGlzLl9sZWZ0Q29sdW1uc1ZpZXcucmVuZGVyKCkuJGVsKTtcbiAgICAkZWwuZmluZCgnLmpzLXJpZ2h0LXRhYmxlcycpLmFwcGVuZCh0aGlzLl9yaWdodFRhYmxlU2VsZWN0b3JWaWV3LnJlbmRlcigpLiRlbCk7XG4gICAgJGVsLmZpbmQoJy5qcy1yaWdodC1jb2x1bW5zJykuYXBwZW5kKHRoaXMuX3JpZ2h0Q29sdW1uc1ZpZXcucmVuZGVyKCkuJGVsKTtcbiAgICAkZWwuYXBwZW5kKHRoaXMuX2Zvb3RlclZpZXcucmVuZGVyKCkuJGVsKTtcbiAgICB0aGlzLiRlbC5odG1sKCRlbCk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbGVmdFRhYmxlTmFtZSA9IHRoaXMubW9kZWwuZ2V0KCdsZWZ0VGFibGUnKS5nZXQoJ25hbWUnKTtcblxuICAgIHRoaXMuX2xlZnRUYWJsZUNvbWJvVmlldyA9IG5ldyBjZGIuZm9ybXMuQ29tYm8oe1xuICAgICAgY2xhc3NOYW1lOiAnU2VsZWN0JyxcbiAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICBkaXNhYmxlZDogdHJ1ZSxcbiAgICAgIGV4dHJhOiBbbGVmdFRhYmxlTmFtZV1cbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fbGVmdFRhYmxlQ29tYm9WaWV3KTtcblxuICAgIHRoaXMuX2xlZnRDb2x1bW5zVmlldyA9IG5ldyBDb2x1bW5zU2VsZWN0b3JWaWV3KHtcbiAgICAgIGNvbGxlY3Rpb246IHRoaXMubW9kZWwuZ2V0KCdsZWZ0Q29sdW1ucycpLFxuICAgICAgZXhjbHVkZUZpbHRlcjogdGhpcy5fY29sdW1uc0V4Y2x1ZGVGaWx0ZXIsXG4gICAgICBzZWxlY3RvclR5cGU6ICdyYWRpbydcbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fbGVmdENvbHVtbnNWaWV3KTtcblxuICAgIHRoaXMuX3JpZ2h0VGFibGVTZWxlY3RvclZpZXcgPSBuZXcgVGFibGVzU2VsZWN0b3JWaWV3KHtcbiAgICAgIGV4Y2x1ZGVGaWx0ZXI6IGZ1bmN0aW9uKHZpcykge1xuICAgICAgICByZXR1cm4gdmlzLmdldCgnbmFtZScpID09PSBsZWZ0VGFibGVOYW1lO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLl9yaWdodFRhYmxlU2VsZWN0b3JWaWV3KTtcblxuICAgIHRoaXMuX3JpZ2h0Q29sdW1uc1ZpZXcgPSBuZXcgQ29sdW1uc1NlbGVjdG9yVmlldyh7XG4gICAgICBjb2xsZWN0aW9uOiB0aGlzLm1vZGVsLmdldCgncmlnaHRDb2x1bW5zJyksXG4gICAgICBleGNsdWRlRmlsdGVyOiB0aGlzLl9jb2x1bW5zRXhjbHVkZUZpbHRlcixcbiAgICAgIHNlbGVjdG9yVHlwZTogJ3JhZGlvJyxcbiAgICAgIGxvYWRpbmc6ICdkYXRhc2V0cydcbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fcmlnaHRDb2x1bW5zVmlldyk7XG5cbiAgICB0aGlzLl9mb290ZXJWaWV3ID0gbmV3IEZvb3RlclZpZXcoe1xuICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICBpbmZvVmlldzogbmV3IEZvb3RlckluZm9WaWV3KHtcbiAgICAgICAgbW9kZWw6IHRoaXMubW9kZWxcbiAgICAgIH0pXG4gICAgfSk7XG4gICAgdGhpcy5hZGRWaWV3KHRoaXMuX2Zvb3RlclZpZXcpO1xuICB9LFxuXG4gIF9jb2x1bW5zRXhjbHVkZUZpbHRlcjogZnVuY3Rpb24oY29sdW1uKSB7XG4gICAgcmV0dXJuIGNvbHVtbi5nZXQoJ25hbWUnKSA9PT0gJ3RoZV9nZW9tJztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbGVmdENvbHVtbnMgPSB0aGlzLm1vZGVsLmdldCgnbGVmdENvbHVtbnMnKTtcbiAgICBsZWZ0Q29sdW1ucy5iaW5kKCdjaGFuZ2U6c2VsZWN0ZWQnLCB0aGlzLl9vbkNoYW5nZVNlbGVjdGVkTGVmdENvbHVtbiwgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbChsZWZ0Q29sdW1ucyk7XG5cbiAgICB2YXIgcmlnaHRDb2x1bW5zID0gdGhpcy5tb2RlbC5nZXQoJ3JpZ2h0Q29sdW1ucycpO1xuICAgIHJpZ2h0Q29sdW1ucy5iaW5kKCdjaGFuZ2U6c2VsZWN0ZWQnLCB0aGlzLl9vbkNoYW5nZVNlbGVjdGVkUmlnaHRDb2x1bW4sIHRoaXMpO1xuICAgIHJpZ2h0Q29sdW1ucy5iaW5kKCdyZXNldCcsIHRoaXMuX2Fzc2VydElmUmVhZHlGb3JOZXh0U3RlcCwgdGhpcyk7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbChyaWdodENvbHVtbnMpO1xuXG4gICAgdmFyIHJpZ2h0VGFibGVzTW9kZWwgPSB0aGlzLl9yaWdodFRhYmxlU2VsZWN0b3JWaWV3Lm1vZGVsO1xuICAgIHJpZ2h0VGFibGVzTW9kZWwuYmluZCgnY2hhbmdlOnRhYmxlRGF0YScsIHRoaXMuX29uQ2hhbmdlUmlnaHRUYWJsZURhdGEsIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwocmlnaHRUYWJsZXNNb2RlbCk7XG4gIH0sXG5cbiAgX29uQ2hhbmdlU2VsZWN0ZWRMZWZ0Q29sdW1uOiBmdW5jdGlvbihtLCBpc1NlbGVjdGVkKSB7XG4gICAgaWYgKGlzU2VsZWN0ZWQpIHtcbiAgICAgIHRoaXMubW9kZWwuZGlzYWJsZVJpZ2h0Q29sdW1uc05vdE1hdGNoaW5nVHlwZShtLmdldCgndHlwZScpKTtcbiAgICB9XG4gICAgdGhpcy5fYXNzZXJ0SWZSZWFkeUZvck5leHRTdGVwKCk7XG4gIH0sXG5cbiAgX29uQ2hhbmdlU2VsZWN0ZWRSaWdodENvbHVtbjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fYXNzZXJ0SWZSZWFkeUZvck5leHRTdGVwKCk7XG4gIH0sXG5cbiAgX2Fzc2VydElmUmVhZHlGb3JOZXh0U3RlcDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5hc3NlcnRJZlJlYWR5Rm9yTmV4dFN0ZXAoKTtcbiAgfSxcblxuICBfb25DaGFuZ2VSaWdodFRhYmxlRGF0YTogZnVuY3Rpb24obW9kZWwsIHRhYmxlRGF0YSkge1xuICAgIHRoaXMuX3JpZ2h0Q29sdW1uc1ZpZXcubW9kZWwuc2V0KCdsb2FkaW5nJywgJ2NvbHVtbnMnKTtcbiAgICB0aGlzLm1vZGVsLmNoYW5nZVJpZ2h0VGFibGUodGFibGVEYXRhKTtcbiAgfVxuXG59KTtcbiIsInZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQ2hvb3NlS2V5Q29sdW1uc01vZGVsID0gcmVxdWlyZSgnLi9jaG9vc2Vfa2V5X2NvbHVtbnNfbW9kZWwnKTtcblxuLyoqXG4gKiBFbnRyeSBwb2ludCBtb2RlbCB0aGF0IHJlcHJlc2VudHMgdGhlIG1lcmdlIGZsYXZvciBvZiBkb2luZyBhIGNvbHVtbiBtZXJnZS5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIElMTFVTVFJBVElPTl9JQ09OX1RZUEU6ICdJbGx1c3RyYXRpb25JY29uLS1hbGVydCcsXG4gIElDT046ICdDREItSWNvbkZvbnQtbWVyZ2VDb2x1bW5zJyxcbiAgVElUTEU6ICdDb2x1bW4gam9pbicsXG4gIERFU0M6ICdNZXJnZSB0d28gZGF0YXNldHMgYmFzZWQgb24gYSBzaGFyZWQgdmFsdWUgKGV4LiBJU08gY29kZXMgaW4gYm90aCBkYXRhc2V0cyknLFxuXG4gIGRlZmF1bHRzOiB7XG4gICAgdXNlcjogdW5kZWZpbmVkLFxuICAgIHRhYmxlOiB1bmRlZmluZWQsXG4gICAgZXhjbHVkZUNvbHVtbnM6IFtdXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oYXR0cnMpIHtcbiAgICBpZiAoIWF0dHJzLnRhYmxlKSB0aHJvdyBuZXcgRXJyb3IoJ3RhYmxlIGlzIHJlcXVpcmVkJyk7XG4gICAgaWYgKCFhdHRycy5leGNsdWRlQ29sdW1ucyB8fCBfLmlzRW1wdHkoYXR0cnMuZXhjbHVkZUNvbHVtbnMpKSBjZGIubG9nLmVycm9yKCdleGNsdWRlQ29sdW1ucyB3YXMgZW1wdHknKTtcbiAgfSxcblxuICBpc0F2YWlsYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgLy8gTmVlZCBhdCBsZWFzdCBvbmUgbW9yZSBjb2x1bW4gdGhhbiB0aGVfZ2VvbSB0byBkbyBhIGNvbHVtbiBtZXJnZVxuICAgIHJldHVybiBfLmNoYWluKHRoaXMuZ2V0KCd0YWJsZScpLmdldCgnc2NoZW1hJykpXG4gICAgICAubWFwKHRoaXMuX2NvbHVtbkRhdGFOYW1lKVxuICAgICAgLmRpZmZlcmVuY2UodGhpcy5nZXQoJ2V4Y2x1ZGVDb2x1bW5zJykpXG4gICAgICAuYW55KHRoaXMuX2lzbnRUaGVHZW9tTmFtZSlcbiAgICAgIC52YWx1ZSgpO1xuICB9LFxuXG4gIF9jb2x1bW5EYXRhTmFtZTogZnVuY3Rpb24oY29sdW1uRGF0YSkge1xuICAgIHJldHVybiBjb2x1bW5EYXRhWzBdOyAvL25hbWVcbiAgfSxcblxuICBfaXNudFRoZUdlb21OYW1lOiBmdW5jdGlvbihjb2x1bW5OYW1lKSB7XG4gICAgcmV0dXJuIGNvbHVtbk5hbWUgIT09ICd0aGVfZ2VvbSc7XG4gIH0sXG5cbiAgZmlyc3RTdGVwOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IENob29zZUtleUNvbHVtbnNNb2RlbCh7XG4gICAgICB1c2VyOiB0aGlzLmdldCgndXNlcicpLFxuICAgICAgbGVmdFRhYmxlOiB0aGlzLmdldCgndGFibGUnKSxcbiAgICAgIGV4Y2x1ZGVDb2x1bW5zOiB0aGlzLmdldCgnZXhjbHVkZUNvbHVtbnMnKVxuICAgIH0pO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogVmlldyB0byBpbmRpY2F0ZSB0aGUgc2VsZWN0ZWQga2V5IGNvbHVtbnMgcmVsYXRpb25zaGlwLlxuICogU2hhcmVkIGZvciBib3RoIHN0ZXAgMSBhbmQgMlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBsZWZ0S2V5Q29sdW1uID0gdGhpcy5tb2RlbC5nZXQoJ2xlZnRLZXlDb2x1bW4nKTtcbiAgICB2YXIgcmlnaHRLZXlDb2x1bW4gPSB0aGlzLm1vZGVsLmdldCgncmlnaHRLZXlDb2x1bW4nKTtcbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGhpcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvY29sdW1uX21lcmdlL2Zvb3Rlcl9pbmZvJykoe1xuICAgICAgICBsZWZ0S2V5Q29sdW1uTmFtZTogbGVmdEtleUNvbHVtbiA/IGxlZnRLZXlDb2x1bW4uZ2V0KCduYW1lJykgOiAnJyxcbiAgICAgICAgcmlnaHRLZXlDb2x1bW5OYW1lOiByaWdodEtleUNvbHVtbiA/IHJpZ2h0S2V5Q29sdW1uLmdldCgnbmFtZScpIDogJydcbiAgICAgIH0pXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5tb2RlbC5zZWxlY3RlZEl0ZW1Gb3IpIHtcbiAgICAgIHZhciBsZWZ0Q29sdW1ucyA9IHRoaXMubW9kZWwuZ2V0KCdsZWZ0Q29sdW1ucycpO1xuICAgICAgbGVmdENvbHVtbnMuYmluZCgnY2hhbmdlOnNlbGVjdGVkJywgdGhpcy5fb25DaGFuZ2VMZWZ0Q29sdW1uLCB0aGlzKTtcbiAgICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwobGVmdENvbHVtbnMpO1xuXG4gICAgICB2YXIgcmlnaHRDb2x1bW5zID0gdGhpcy5tb2RlbC5nZXQoJ3JpZ2h0Q29sdW1ucycpO1xuICAgICAgcmlnaHRDb2x1bW5zLmJpbmQoJ2NoYW5nZTpzZWxlY3RlZCcsIHRoaXMuX29uQ2hhbmdlUmlnaHRDb2x1bW4sIHRoaXMpO1xuICAgICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbChyaWdodENvbHVtbnMpO1xuICAgIH1cbiAgfSxcblxuICBfb25DaGFuZ2VMZWZ0Q29sdW1uOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbSA9IHRoaXMubW9kZWwuc2VsZWN0ZWRJdGVtRm9yKCdsZWZ0Q29sdW1ucycpO1xuICAgIHRoaXMuJCgnLmpzLWxlZnQta2V5LWNvbHVtbicpLnRleHQobSA/IG0uZ2V0KCduYW1lJykgOiAnJyk7XG4gIH0sXG5cbiAgX29uQ2hhbmdlUmlnaHRDb2x1bW46IGZ1bmN0aW9uKCkge1xuICAgIHZhciBtID0gdGhpcy5tb2RlbC5zZWxlY3RlZEl0ZW1Gb3IoJ3JpZ2h0Q29sdW1ucycpO1xuICAgIHRoaXMuJCgnLmpzLXJpZ2h0LWtleS1jb2x1bW4nKVxuICAgICAgLnRleHQobSA/IG0uZ2V0KCduYW1lJykgOiAnJylcbiAgICAgIC50b2dnbGVDbGFzcygnaXMtcGxhY2Vob2xkZXInLCAhbSk7XG4gIH1cblxufSk7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcblxuLy8gVXNlZCBmb3IgYm90aCBsZWZ0IGFuZCByaWdodCB0YWJsZVxudmFyIHNlbGVjdENvbHVtbiA9IGZ1bmN0aW9uKHRhYmxlTmFtZSwgb3RoZXJUYWJsZU5hbWUsIGNvbHVtbk5hbWUpIHtcbiAgaWYgKGNvbHVtbk5hbWUgPT09ICd0aGVfZ2VvbScpIHtcbiAgICByZXR1cm4gW1xuICAgICAgJ0NBU0UgV0hFTiAnICsgdGFibGVOYW1lICsgJy4nICsgY29sdW1uTmFtZSArICcgSVMgTlVMTCBUSEVOJyxcbiAgICAgIG90aGVyVGFibGVOYW1lICsgJy4nICsgY29sdW1uTmFtZSxcbiAgICAgICdFTFNFJyxcbiAgICAgIHRhYmxlTmFtZSArICcuJyArIGNvbHVtbk5hbWUsXG4gICAgICAnRU5EIEFTJyxcbiAgICAgICAgY29sdW1uTmFtZVxuICAgIF07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFsgdGFibGVOYW1lICsgJy4nICsgY29sdW1uTmFtZSBdO1xuICB9XG59O1xuXG4vLyBTUUwgcXVlcnkgYXMgdGFrZW4gZnJvbSBvbGQgY29kZSwgY2RiLmFkbWluLk1lcmdlVGFibGVzRGlhbG9nXG4vLyBDbGVhbmVkIHVwIHRvIHJlbW92ZSBub2lzZSBhbmQgYXZvaWQgc3RyaW5nIGNvbmNhdGVuYXRpb24gdG8gYmUgbW9yZSBsZWdpYmxlLlxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihkKSB7XG4gIHZhciBsZWZ0VGFibGVOYW1lID0gZC5sZWZ0VGFibGVOYW1lO1xuICB2YXIgbGVmdENvbHVtbnNOYW1lcyA9IGQubGVmdENvbHVtbnNOYW1lcztcbiAgdmFyIGxlZnRLZXlDb2x1bW5OYW1lID0gZC5sZWZ0S2V5Q29sdW1uTmFtZTtcbiAgdmFyIGxlZnRLZXlDb2x1bW5UeXBlID0gZC5sZWZ0S2V5Q29sdW1uVHlwZTtcblxuICB2YXIgcmlnaHRUYWJsZU5hbWUgPSBkLnJpZ2h0VGFibGVOYW1lO1xuICB2YXIgcmlnaHRDb2x1bW5zTmFtZXMgPSBkLnJpZ2h0Q29sdW1uc05hbWVzO1xuICB2YXIgcmlnaHRLZXlDb2x1bW5OYW1lID0gZC5yaWdodEtleUNvbHVtbk5hbWU7XG4gIHZhciByaWdodEtleUNvbHVtblR5cGUgPSBkLnJpZ2h0S2V5Q29sdW1uVHlwZTtcblxuICAvLyBBZGQgbGVmdCB0YWJsZSBjb2x1bW5zXG4gIHZhciBzcWwgPSBbJ1NFTEVDVCddO1xuICB2YXIgc2VsZWN0cyA9IF8ubWFwKGxlZnRDb2x1bW5zTmFtZXMsIGZ1bmN0aW9uKGNvbHVtbk5hbWUpIHtcbiAgICByZXR1cm4gc2VsZWN0Q29sdW1uKGxlZnRUYWJsZU5hbWUsIHJpZ2h0VGFibGVOYW1lLCBjb2x1bW5OYW1lKS5qb2luKCcgJyk7XG4gIH0pO1xuXG4gIC8vIEFkZCByaWdodCB0YWJsZSBjb2x1bW5zXG4gIHNlbGVjdHMucHVzaC5hcHBseShzZWxlY3RzLFxuICAgIF8ubWFwKHJpZ2h0Q29sdW1uc05hbWVzLCBmdW5jdGlvbihjb2x1bW5OYW1lKSB7XG4gICAgICB2YXIgY29sU1FMID0gc2VsZWN0Q29sdW1uKHJpZ2h0VGFibGVOYW1lLCBsZWZ0VGFibGVOYW1lLCBjb2x1bW5OYW1lKTtcblxuICAgICAgdmFyIGlzQ29sdW1uUHJlc2VudEluTGVmdFRhYmxlID0gXy5hbnkobGVmdENvbHVtbnNOYW1lcywgZnVuY3Rpb24obGVmdENvbHVtbk5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGNvbHVtbk5hbWUgPT09IGxlZnRDb2x1bW5OYW1lO1xuICAgICAgfSk7XG4gICAgICBpZiAoaXNDb2x1bW5QcmVzZW50SW5MZWZ0VGFibGUpIHtcbiAgICAgICAgY29sU1FMID0gY29sU1FMLmNvbmNhdCgnQVMgJyArIHJpZ2h0VGFibGVOYW1lICsgJ18nICsgY29sdW1uTmFtZSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjb2xTUUwuam9pbignICcpO1xuICAgIH0pXG4gICk7XG5cbiAgLy8gTWFrZSBzdXJlIGFsbCBzZWxlY3QgZmllbGRzIGFyZSBjb21tYSBzZXBhcmF0ZWRcbiAgc3FsLnB1c2goXy5mbGF0dGVuKHNlbGVjdHMpLmpvaW4oJywgJykpO1xuXG4gIC8vIExFRlQgSk9JTlxuICBzcWwucHVzaCgnRlJPTSAnICsgbGVmdFRhYmxlTmFtZSArICcgRlVMTCBPVVRFUiBKT0lOICcgKyByaWdodFRhYmxlTmFtZSArICcgT04nKTtcblxuICAvLyBKT0lOIEZJRUxEXG4gIGlmIChsZWZ0S2V5Q29sdW1uVHlwZSA9PT0gJ3N0cmluZycgJiYgcmlnaHRLZXlDb2x1bW5UeXBlID09PSAnc3RyaW5nJykge1xuICAgIHNxbC5wdXNoKFxuICAgICAgJ0xPV0VSKFRSSU0oJyArIGxlZnRUYWJsZU5hbWUgKyAnLicgKyBsZWZ0S2V5Q29sdW1uTmFtZSArICcpKScsXG4gICAgICAnPScsXG4gICAgICAnTE9XRVIoVFJJTSgnICsgcmlnaHRUYWJsZU5hbWUgKyAnLicgKyByaWdodEtleUNvbHVtbk5hbWUgKyAnKSknXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICBzcWwucHVzaChcbiAgICAgIGxlZnRUYWJsZU5hbWUgKyAnLicgKyBsZWZ0S2V5Q29sdW1uTmFtZSxcbiAgICAgICc9JyxcbiAgICAgIHJpZ2h0VGFibGVOYW1lICsgJy4nICsgcmlnaHRLZXlDb2x1bW5OYW1lXG4gICAgKTtcbiAgfVxuXG4gIHJldHVybiBzcWwuam9pbignICcpO1xufTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIFNlbGVjdENvbHVtbnNWaWV3ID0gcmVxdWlyZSgnLi9zZWxlY3RfY29sdW1uc192aWV3Jyk7XG52YXIgZ2VuZXJhdGVDb2x1bW5NZXJnZVNRTCA9IHJlcXVpcmUoJy4vZ2VuZXJhdGVfY29sdW1uX21lcmdlX3NxbCcpO1xudmFyIE1lcmdlTW9kZWwgPSByZXF1aXJlKCcuLi9tZXJnZV9zdGVwX21vZGVsJyk7XG5cbi8qKlxuICogVmlldyBmb3IgMm5kIHN0ZXAgb2YgYSBjb2x1bW4gbWVyZ2UsIHdoZXJlIHRoZSB1c2VyIHNob3VsZCBzZWxlY3QgdGhlIGNvbHVtbiBmaWVsZHMgdG8gbWVyZ2VcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIElOU1RSVUNUSU9OU19TQUZFX0hUTUw6ICdDaG9vc2Ugb3RoZXIgY29sdW1ucyB5b3Ugd2FudCBpbiB5b3VyIGRhdGFzZXQuJyxcblxuICBkZWZhdWx0czoge1xuICAgIHVzZXI6IHVuZGVmaW5lZCxcbiAgICBpc1JlYWR5Rm9yTmV4dFN0ZXA6IHRydWUsXG4gICAgbGVmdFRhYmxlOiB1bmRlZmluZWQsXG4gICAgbGVmdEtleUNvbHVtbjogdW5kZWZpbmVkLFxuICAgIGxlZnRDb2x1bW5zOiB1bmRlZmluZWQsXG4gICAgcmlnaHRUYWJsZURhdGE6IHVuZGVmaW5lZCxcbiAgICByaWdodENvbHVtbnM6IHVuZGVmaW5lZCxcbiAgICByaWdodEtleUNvbHVtbjogdW5kZWZpbmVkXG4gIH0sXG5cbiAgY3JlYXRlVmlldzogZnVuY3Rpb24oKSB7XG4gICAgLy8gUmVzZXQgc3RhdGVcbiAgICB0aGlzLnNldCgnZ290b05leHRTdGVwJywgZmFsc2UpO1xuICAgIHRoaXMuX3Jlc2V0Q29sdW1ucyh0aGlzLmdldCgnbGVmdENvbHVtbnMnKSwgZnVuY3Rpb24oY29sdW1uKSB7XG4gICAgICBjb2x1bW4uc2V0KCdzZWxlY3RlZCcsIHRydWUpO1xuICAgIH0pO1xuICAgIHRoaXMuX3Jlc2V0Q29sdW1ucyh0aGlzLmdldCgncmlnaHRDb2x1bW5zJyksIGZ1bmN0aW9uKGNvbHVtbikge1xuICAgICAgaWYgKGNvbHVtbi5nZXQoJ25hbWUnKSAhPT0gJ3RoZV9nZW9tJykge1xuICAgICAgICBjb2x1bW4uc2V0KCdzZWxlY3RlZCcsIHRydWUpO1xuICAgICAgfVxuICAgICAgY29sdW1uLnNldCgnZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmV3IFNlbGVjdENvbHVtbnNWaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzXG4gICAgfSk7XG4gIH0sXG5cbiAgb25seUFsbG93T25lU2VsZWN0ZWRUaGVHZW9tQ29sdW1uOiBmdW5jdGlvbihjb2x1bW4sIGlzU2VsZWN0ZWQpIHtcbiAgICBpZiAoY29sdW1uLmdldCgnbmFtZScpICE9PSAndGhlX2dlb20nKSByZXR1cm47XG5cbiAgICB2YXIgbGVmdENvbHVtbiA9IHRoaXMuX3RoZUdlb21Db2x1bW5Gb3IoJ2xlZnRDb2x1bW5zJyk7XG4gICAgdmFyIHJpZ2h0Q29sdW1uID0gdGhpcy5fdGhlR2VvbUNvbHVtbkZvcigncmlnaHRDb2x1bW5zJyk7XG5cbiAgICBpZiAoY29sdW1uID09PSBsZWZ0Q29sdW1uKSB7XG4gICAgICBsZWZ0Q29sdW1uLnNldCgnc2VsZWN0ZWQnLCBpc1NlbGVjdGVkKTtcbiAgICAgIHJpZ2h0Q29sdW1uLnNldCgnc2VsZWN0ZWQnLCAhaXNTZWxlY3RlZCk7XG4gICAgfSBlbHNlIGlmIChjb2x1bW4gPT09IHJpZ2h0Q29sdW1uKSB7XG4gICAgICBsZWZ0Q29sdW1uLnNldCgnc2VsZWN0ZWQnLCAhaXNTZWxlY3RlZCk7XG4gICAgICByaWdodENvbHVtbi5zZXQoJ3NlbGVjdGVkJywgaXNTZWxlY3RlZCk7XG4gICAgfVxuICB9LFxuXG4gIG5leHRTdGVwOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbGVmdEtleUNvbHVtbiA9IHRoaXMuZ2V0KCdsZWZ0S2V5Q29sdW1uJyk7XG4gICAgdmFyIHJpZ2h0S2V5Q29sdW1uID0gdGhpcy5nZXQoJ3JpZ2h0S2V5Q29sdW1uJyk7XG5cbiAgICB2YXIgc3FsID0gZ2VuZXJhdGVDb2x1bW5NZXJnZVNRTCh7XG4gICAgICBsZWZ0VGFibGVOYW1lOiB0aGlzLmdldCgnbGVmdFRhYmxlJykuZ2V0KCduYW1lJyksXG4gICAgICBsZWZ0S2V5Q29sdW1uTmFtZTogbGVmdEtleUNvbHVtbi5nZXQoJ25hbWUnKSxcbiAgICAgIGxlZnRLZXlDb2x1bW5UeXBlOiBsZWZ0S2V5Q29sdW1uLmdldCgndHlwZScpLFxuICAgICAgbGVmdENvbHVtbnNOYW1lczogdGhpcy5fc2VsZWN0ZWRDb2x1bW5zTmFtZXNGb3IoJ2xlZnRDb2x1bW5zJyksXG4gICAgICByaWdodFRhYmxlTmFtZTogdGhpcy5nZXQoJ3JpZ2h0VGFibGVEYXRhJykubmFtZSxcbiAgICAgIHJpZ2h0S2V5Q29sdW1uTmFtZTogcmlnaHRLZXlDb2x1bW4uZ2V0KCduYW1lJyksXG4gICAgICByaWdodEtleUNvbHVtblR5cGU6IHJpZ2h0S2V5Q29sdW1uLmdldCgndHlwZScpLFxuICAgICAgcmlnaHRDb2x1bW5zTmFtZXM6IHRoaXMuX3NlbGVjdGVkQ29sdW1uc05hbWVzRm9yKCdyaWdodENvbHVtbnMnKVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yLm5leHRTdGVwKHtcbiAgICAgIHVzZXI6IHRoaXMuZ2V0KCd1c2VyJyksXG4gICAgICB0YWJsZU5hbWU6IHRoaXMuZ2V0KCdsZWZ0VGFibGUnKS5nZXQoJ25hbWUnKSxcbiAgICAgIHNxbDogc3FsXG4gICAgfSk7XG4gIH0sXG5cbiAgX3NlbGVjdGVkQ29sdW1uc05hbWVzRm9yOiBmdW5jdGlvbihjb2xsZWN0aW9uTmFtZSkge1xuICAgIHJldHVybiB0aGlzLmdldChjb2xsZWN0aW9uTmFtZSlcbiAgICAgIC5jaGFpbigpXG4gICAgICAuZmlsdGVyKGZ1bmN0aW9uKGNvbHVtbikge1xuICAgICAgICByZXR1cm4gY29sdW1uLmdldCgnc2VsZWN0ZWQnKTtcbiAgICAgIH0pLlxuICAgICAgbWFwKGZ1bmN0aW9uKGNvbHVtbikge1xuICAgICAgICByZXR1cm4gY29sdW1uLmdldCgnbmFtZScpO1xuICAgICAgfSlcbiAgICAgIC52YWx1ZSgpO1xuICB9LFxuXG4gIF90aGVHZW9tQ29sdW1uRm9yOiBmdW5jdGlvbih3aGljaCkge1xuICAgIHJldHVybiB0aGlzLmdldCh3aGljaCkuZmluZChmdW5jdGlvbihjb2x1bW4pIHtcbiAgICAgIHJldHVybiBjb2x1bW4uZ2V0KCduYW1lJykgPT09ICd0aGVfZ2VvbSc7XG4gICAgfSk7XG4gIH0sXG5cbiAgX3Jlc2V0Q29sdW1uczogZnVuY3Rpb24oY29sdW1ucywgZWFjaFJlc2V0KSB7XG4gICAgY29sdW1ucy5jb21wYXJhdG9yID0gZnVuY3Rpb24oY29sdW1uKSB7XG4gICAgICB2YXIgY29sdW1uTmFtZSA9IGNvbHVtbi5nZXQoJ25hbWUnKTtcbiAgICAgIHJldHVybiBjb2x1bW5OYW1lID09PSAndGhlX2dlb20nID8gJzAwMDAwJyA6IGNvbHVtbk5hbWU7XG4gICAgfTtcbiAgICBjb2x1bW5zLmVhY2goZWFjaFJlc2V0LCB0aGlzKTtcbiAgICBjb2x1bW5zLnNvcnQoKTtcbiAgfVxuXG59LCB7XG4gIGhlYWRlcjoge1xuICAgIGljb246ICdDREItSWNvbkZvbnQtd2l6YXJkJyxcbiAgICB0aXRsZTogJ0Nob29zZSB0aGUgcmVzdCB0byBhZGQnXG4gIH0sXG4gIG5leHRTdGVwOiBNZXJnZU1vZGVsXG59KTtcbiIsInZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQ29sdW1uc1NlbGVjdG9yVmlldyA9IHJlcXVpcmUoJy4uL2NvbHVtbnNfc2VsZWN0b3JfdmlldycpO1xudmFyIFN0aWNreUhlYWRlclZpZXcgPSByZXF1aXJlKCcuLi9zdGlja3lfaGVhZGVyX3ZpZXcnKTtcbnZhciBGb290ZXJWaWV3ID0gcmVxdWlyZSgnLi4vZm9vdGVyX3ZpZXcnKTtcbnZhciBGb290ZXJJbmZvVmlldyA9IHJlcXVpcmUoJy4vZm9vdGVyX2luZm9fdmlldycpO1xuXG4vKipcbiAqIFZpZXcgdG8gc2VsZWN0IHRoZSBjb2x1bW5zIHRvIG1lcmdlLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9pbml0Vmlld3MoKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciAkZWwgPSAkKFxuICAgICAgdGhpcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvY29sdW1uX21lcmdlL3NlbGVjdF9jb2x1bW5zJykoe1xuICAgICAgICBsZWZ0S2V5Q29sdW1uOiB0aGlzLm1vZGVsLmdldCgnbGVmdEtleUNvbHVtbicpLFxuICAgICAgICByaWdodEtleUNvbHVtbjogdGhpcy5tb2RlbC5nZXQoJ3JpZ2h0S2V5Q29sdW1uJylcbiAgICAgIH0pXG4gICAgKTtcbiAgICAkZWwuZmluZCgnLmpzLXN0aWNreS1oZWFkZXInKS5hcHBlbmQodGhpcy5fc3RpY2t5SGVhZGVyVmlldy5yZW5kZXIoKS4kZWwpO1xuICAgICRlbC5maW5kKCcuanMtbGVmdC10YWJsZScpLmFwcGVuZCh0aGlzLl9sZWZ0VGFibGVDb21ib1ZpZXcucmVuZGVyKCkuJGVsKTtcbiAgICAkZWwuZmluZCgnLmpzLWxlZnQtY29sdW1ucycpLmFwcGVuZCh0aGlzLl9sZWZ0Q29sdW1uc1ZpZXcucmVuZGVyKCkuJGVsKTtcbiAgICAkZWwuZmluZCgnLmpzLXJpZ2h0LXRhYmxlJykuYXBwZW5kKHRoaXMuX3JpZ2h0VGFibGVDb21ib1ZpZXcucmVuZGVyKCkuJGVsKTtcbiAgICAkZWwuZmluZCgnLmpzLXJpZ2h0LWNvbHVtbnMnKS5hcHBlbmQodGhpcy5fcmlnaHRDb2x1bW5zVmlldy5yZW5kZXIoKS4kZWwpO1xuICAgICRlbC5hcHBlbmQodGhpcy5fZm9vdGVyVmlldy5yZW5kZXIoKS4kZWwpO1xuICAgIHRoaXMuJGVsLmh0bWwoJGVsKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIG9uQ2hhbmdlS2V5Q29sdW1uc1Zpc2libGl0eTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fc3RpY2t5SGVhZGVyVmlldy4kZWwuc2xpZGVUb2dnbGUoMjAwKTtcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9zdGlja3lIZWFkZXJWaWV3ID0gbmV3IFN0aWNreUhlYWRlclZpZXcoe1xuICAgICAgbGVmdEtleUNvbHVtbjogdGhpcy5tb2RlbC5nZXQoJ2xlZnRLZXlDb2x1bW4nKSxcbiAgICAgIHJpZ2h0S2V5Q29sdW1uOiB0aGlzLm1vZGVsLmdldCgncmlnaHRLZXlDb2x1bW4nKVxuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLl9zdGlja3lIZWFkZXJWaWV3KTtcblxuICAgIHRoaXMuX2xlZnRUYWJsZUNvbWJvVmlldyA9IG5ldyBjZGIuZm9ybXMuQ29tYm8oe1xuICAgICAgY2xhc3NOYW1lOiAnU2VsZWN0JyxcbiAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICBkaXNhYmxlZDogdHJ1ZSxcbiAgICAgIGV4dHJhOiBbdGhpcy5tb2RlbC5nZXQoJ2xlZnRUYWJsZScpLmdldCgnbmFtZScpXVxuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLl9sZWZ0VGFibGVDb21ib1ZpZXcpO1xuXG4gICAgdGhpcy5fbGVmdENvbHVtbnNWaWV3ID0gbmV3IENvbHVtbnNTZWxlY3RvclZpZXcoe1xuICAgICAgY29sbGVjdGlvbjogdGhpcy5tb2RlbC5nZXQoJ2xlZnRDb2x1bW5zJyksXG4gICAgICBzZWxlY3RvclR5cGU6ICdzd2l0Y2gnXG4gICAgfSk7XG4gICAgdGhpcy5hZGRWaWV3KHRoaXMuX2xlZnRDb2x1bW5zVmlldyk7XG5cbiAgICB0aGlzLl9yaWdodFRhYmxlQ29tYm9WaWV3ID0gbmV3IGNkYi5mb3Jtcy5Db21ibyh7XG4gICAgICBjbGFzc05hbWU6ICdTZWxlY3QnLFxuICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgZXh0cmE6IFt0aGlzLm1vZGVsLmdldCgncmlnaHRUYWJsZURhdGEnKS5uYW1lXVxuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLl9yaWdodFRhYmxlQ29tYm9WaWV3KTtcblxuICAgIHRoaXMuX3JpZ2h0Q29sdW1uc1ZpZXcgPSBuZXcgQ29sdW1uc1NlbGVjdG9yVmlldyh7XG4gICAgICBjb2xsZWN0aW9uOiB0aGlzLm1vZGVsLmdldCgncmlnaHRDb2x1bW5zJyksXG4gICAgICBzZWxlY3RvclR5cGU6ICdzd2l0Y2gnXG4gICAgfSk7XG4gICAgdGhpcy5hZGRWaWV3KHRoaXMuX3JpZ2h0Q29sdW1uc1ZpZXcpO1xuXG4gICAgdGhpcy5fZm9vdGVyVmlldyA9IG5ldyBGb290ZXJWaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLFxuICAgICAgbmV4dExhYmVsOiAnTWVyZ2UgZGF0YXNldHMnLFxuICAgICAgaW5mb1ZpZXc6IG5ldyBGb290ZXJJbmZvVmlldyh7XG4gICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsXG4gICAgICB9KVxuICAgIH0pO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLl9mb290ZXJWaWV3KTtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmdldCgnbGVmdENvbHVtbnMnKS5iaW5kKCdjaGFuZ2U6c2VsZWN0ZWQnLCB0aGlzLl9vbkNoYW5nZVNlbGVjdGVkQ29sdW1uLCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMubW9kZWwuZ2V0KCdsZWZ0Q29sdW1ucycpKTtcblxuICAgIHRoaXMubW9kZWwuZ2V0KCdyaWdodENvbHVtbnMnKS5iaW5kKCdjaGFuZ2U6c2VsZWN0ZWQnLCB0aGlzLl9vbkNoYW5nZVNlbGVjdGVkQ29sdW1uLCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMubW9kZWwuZ2V0KCdyaWdodENvbHVtbnMnKSk7XG4gIH0sXG5cbiAgX29uQ2hhbmdlU2VsZWN0ZWRDb2x1bW46IGZ1bmN0aW9uKGNvbHVtbiwgaXNTZWxlY3RlZCkge1xuICAgIHRoaXMubW9kZWwub25seUFsbG93T25lU2VsZWN0ZWRUaGVHZW9tQ29sdW1uKGNvbHVtbiwgaXNTZWxlY3RlZCk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcblxuLyoqXG4gKiBWaWV3IHRvIHNlbGVjdCBvbmUgb3IgbXVsdGlwbGUgY29sdW1ucy5cbiAqICAtIEZvciBvbmx5IGFsbG93aW5nIHNlbGVjdGluZyBvbmUgc2V0IHNlbGVjdG9yVHlwZSB0byAncmFkaW8nXG4gKiAgLSBGb3IgYWxsb3dpbmcgbXVsdGlwbGUgc2VsZWN0aW9ucyBzZXQgc2VsZWN0b3JUeXBlIHRvICdzd2l0Y2gnXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ0xpc3Qtcm93JyxcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2snOiAnX29uQ2xpY2snLFxuICAgICdtb3VzZWVudGVyJzogJ19vbk1vdXNlRW50ZXInLFxuICAgICdtb3VzZWxlYXZlJzogJ19vbk1vdXNlTGVhdmUnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMuc2VsZWN0b3JUeXBlKSB0aHJvdyBuZXcgRXJyb3IoJ3NlbGVjdG9yVHlwZSBpcyByZXF1aXJlZCcpO1xuXG4gICAgdGhpcy5tb2RlbCA9IG5ldyBjZGIuY29yZS5Nb2RlbCh7XG4gICAgICB0eXBlOiB0aGlzLm9wdGlvbnMuc2VsZWN0b3JUeXBlXG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbHVtbiA9IHRoaXMub3B0aW9ucy5jb2x1bW47XG5cbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9jb2x1bW5fc2VsZWN0b3InKSh7XG4gICAgICAgIHNlbGVjdG9yVHlwZTogdGhpcy5tb2RlbC5nZXQoJ3R5cGUnKSxcbiAgICAgICAgY29sdW1uTmFtZTogdGhpcy5jb2x1bW4uZ2V0KCduYW1lJyksXG4gICAgICAgIGNvbHVtblR5cGU6IHRoaXMuY29sdW1uLmdldCgndHlwZScpXG4gICAgICB9KVxuICAgICk7XG5cbiAgICBpZiAoIXRoaXMuX3Rvb2x0aXApIHtcbiAgICAgIHRoaXMuX3Rvb2x0aXAgPSBuZXcgY2RiLmNvbW1vbi5UaXBzeVRvb2x0aXAoe1xuICAgICAgICBlbDogdGhpcy5lbCxcbiAgICAgICAgb2Zmc2V0OiAtMjAsXG4gICAgICAgIHRyaWdnZXI6ICdtYW51YWwnLFxuICAgICAgICBmYWxsYmFjazogJ1lvdXIgY29sdW1uIHR5cGUgaXMgbm90IGNvbXBhdGlibGUgd2l0aCB0aGUgY29sdW1uIHlvdSBoYXZlIHNlbGVjdGVkIGluIHRoZSBsZWZ0IGNvbHVtbidcbiAgICAgIH0pO1xuICAgICAgdGhpcy5hZGRWaWV3KHRoaXMuX3Rvb2x0aXApO1xuICAgIH1cblxuICAgIHRoaXMuX29uQ2hhbmdlU2VsZWN0ZWQodGhpcy5jb2x1bW4sIHRoaXMuY29sdW1uLmdldCgnc2VsZWN0ZWQnKSk7XG4gICAgdGhpcy5fb25DaGFuZ2VEaXNhYmxlZCh0aGlzLmNvbHVtbiwgdGhpcy5jb2x1bW4uZ2V0KCdkaXNhYmxlZCcpKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY29sdW1uLmJpbmQoJ2NoYW5nZTpzZWxlY3RlZCcsIHRoaXMuX29uQ2hhbmdlU2VsZWN0ZWQsIHRoaXMpO1xuICAgIHRoaXMuY29sdW1uLmJpbmQoJ2NoYW5nZTpkaXNhYmxlZCcsIHRoaXMuX29uQ2hhbmdlRGlzYWJsZWQsIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5jb2x1bW4pO1xuICB9LFxuXG4gIF9vbkNoYW5nZVNlbGVjdGVkOiBmdW5jdGlvbihjb2x1bW4sIGlzU2VsZWN0ZWQpIHtcbiAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3R5cGUnKSA9PT0gJ3JhZGlvJykge1xuICAgICAgdGhpcy4kZWwudG9nZ2xlQ2xhc3MoJ2lzLXNlbGVjdGVkJywgISFpc1NlbGVjdGVkKTtcbiAgICB9XG4gICAgdGhpcy4kKCcuanMtcmFkaW8nKS50b2dnbGVDbGFzcygnaXMtY2hlY2tlZCcsICEhaXNTZWxlY3RlZCk7XG4gICAgdGhpcy4kKCcuanMtc3dpdGNoJykucHJvcCgnY2hlY2tlZCcsICEhaXNTZWxlY3RlZCk7XG4gIH0sXG5cbiAgX29uQ2hhbmdlRGlzYWJsZWQ6IGZ1bmN0aW9uKGNvbHVtbiwgaXNEaXNhYmxlZCkge1xuICAgIGlzRGlzYWJsZWQgPSAhIWlzRGlzYWJsZWQ7XG4gICAgdGhpcy4kZWwudG9nZ2xlQ2xhc3MoJ2lzLWRpc2FibGVkJywgaXNEaXNhYmxlZCk7XG4gIH0sXG5cbiAgX29uQ2xpY2s6IGZ1bmN0aW9uKGV2KSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZXYpO1xuICAgIGlmICghdGhpcy5faXNEaXNhYmxlZCgpKSB7XG4gICAgICB2YXIgaW52ZXJzZVNlbGVjdGVkVmFsID0gIXRoaXMuY29sdW1uLmdldCgnc2VsZWN0ZWQnKTtcblxuICAgICAgLy8gcmFkaW8gYnV0dG9ucyBjYW4gb25seSBiZSBzZWxlY3RlZCwgdW5zZWxlY3Rpb24gb2Ygb3RoZXIgaXRlbXMgc2hvdWxkIGJlIGhhbmRsZWQgYnkgY29sbGVjdGlvbi9wYXJlbnRcbiAgICAgIGlmIChpbnZlcnNlU2VsZWN0ZWRWYWwgfHwgdGhpcy5tb2RlbC5nZXQoJ3R5cGUnKSAhPT0gJ3JhZGlvJykge1xuICAgICAgICB0aGlzLmNvbHVtbi5zZXQoJ3NlbGVjdGVkJywgaW52ZXJzZVNlbGVjdGVkVmFsKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgX29uTW91c2VFbnRlcjogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX2lzRGlzYWJsZWQoKSkge1xuICAgICAgdGhpcy5fdG9vbHRpcC5zaG93VGlwc3koKTtcbiAgICB9XG4gIH0sXG5cbiAgX29uTW91c2VMZWF2ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fdG9vbHRpcC5oaWRlVGlwc3koKTtcbiAgfSxcblxuICBfaXNEaXNhYmxlZDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuY29sdW1uLmdldCgnZGlzYWJsZWQnKTtcbiAgfVxuXG59KTtcbiIsInZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQ29sdW1uU2VsZWN0b3JWaWV3ID0gcmVxdWlyZSgnLi9jb2x1bW5fc2VsZWN0b3JfdmlldycpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZScpO1xuXG4vKipcbiAqIFZpZXcgdG8gc2VsZWN0IGFuIGluZGl2aWR1YWwgY29sdW1uLlxuICogVGhlIHNlbGVjdG9yIHR5cGUgaXMgcGFzc2VkIHRvIHRoZSBjaGlsZCB2aWV3IG9mIGNsYXNzIENvbHVtblNlbGVjdG9yVmlldy5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgY2xhc3NOYW1lOiAnTGlzdCcsXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy1zZWxlY3QtYWxsJzogJ19vbkNsaWNrU2VsZWN0QWxsJyxcbiAgICAnY2xpY2snOiAna2lsbEV2ZW50J1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwgPSBuZXcgY2RiLmNvcmUuTW9kZWwoe1xuICAgICAgc2hvd1NlbGVjdEFsbFRvZ2dsZTogdGhpcy5vcHRpb25zLnNlbGVjdG9yVHlwZSA9PT0gJ3N3aXRjaCcgfHwgZmFsc2UsXG4gICAgICBlbmZvcmNlU2luZ2xlU2VsZWN0ZWQ6IHRoaXMub3B0aW9ucy5zZWxlY3RvclR5cGUgPT09ICdyYWRpbycgfHwgZmFsc2UsXG4gICAgICBsb2FkaW5nOiB0aGlzLm9wdGlvbnMubG9hZGluZ1xuICAgIH0pO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy4kZWwuaHRtbCgnJyk7XG5cbiAgICBpZiAodGhpcy5jb2xsZWN0aW9uLmxlbmd0aCA+IDApIHtcbiAgICAgIHZhciBjaGFpbiA9IHRoaXMuY29sbGVjdGlvbi5jaGFpbigpO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5leGNsdWRlRmlsdGVyKSB7XG4gICAgICAgIGNoYWluID0gY2hhaW4ucmVqZWN0KHRoaXMub3B0aW9ucy5leGNsdWRlRmlsdGVyKTtcbiAgICAgIH1cbiAgICAgIGNoYWluLmVhY2godGhpcy5fYWRkQ29sdW1uU2VsZWN0b3JWaWV3LCB0aGlzKTtcblxuICAgICAgdGhpcy5fcmVuZGVyU2VsZWN0QWxsVG9nZ2xlKCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLm1vZGVsLmdldCgnbG9hZGluZycpKSB7XG4gICAgICB0aGlzLl9yZW5kZXJMb2FkaW5nKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX3JlbmRlckxvYWRpbmc6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vdGVtcGxhdGVzL2xvYWRpbmcnKSh7XG4gICAgICAgIHRpdGxlOiAnRmV0Y2hpbmcgJyArIHRoaXMubW9kZWwuZ2V0KCdsb2FkaW5nJyksXG4gICAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgICB9KVxuICAgICk7XG4gIH0sXG5cbiAgX2FkZENvbHVtblNlbGVjdG9yVmlldzogZnVuY3Rpb24obW9kZWwpIHtcbiAgICB2YXIgdmlldyA9IG5ldyBDb2x1bW5TZWxlY3RvclZpZXcoXG4gICAgICBfLmNoYWluKHtcbiAgICAgICAgY29sdW1uOiBtb2RlbFxuICAgICAgfSlcbiAgICAgIC5leHRlbmQodGhpcy5vcHRpb25zKVxuICAgICAgLm9taXQoWydlbCcsICdjb2xsZWN0aW9uJ10pXG4gICAgICAudmFsdWUoKVxuICAgICk7XG4gICAgdGhpcy5hZGRWaWV3KHZpZXcpO1xuICAgIHRoaXMuJGVsLmFwcGVuZCh2aWV3LnJlbmRlcigpLiRlbCk7XG4gIH0sXG5cbiAgX3JlbmRlclNlbGVjdEFsbFRvZ2dsZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdzaG93U2VsZWN0QWxsVG9nZ2xlJykpIHtcbiAgICAgIHRoaXMuJGVsLmFwcGVuZChcbiAgICAgICAgdGhpcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvY29sdW1uc19zZWxlY3Rvcl90b2dnbGVfYWxsJykoe1xuICAgICAgICAgIGFyZUFsbFNlbGVjdGVkOiB0aGlzLl9hcmVBbGxTZWxlY3RlZCgpXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNvbGxlY3Rpb24uYmluZCgncmVzZXQnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmJpbmQoJ2NoYW5nZTpzZWxlY3RlZCcsIHRoaXMuX29uQ2hhbmdlU2VsZWN0ZWQsIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5jb2xsZWN0aW9uKTtcblxuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOmxvYWRpbmcnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gIH0sXG5cbiAgX29uQ2hhbmdlU2VsZWN0ZWQ6IGZ1bmN0aW9uKG1vZGVsLCBpc1NlbGVjdGVkKSB7XG4gICAgaWYgKGlzU2VsZWN0ZWQgJiYgdGhpcy5tb2RlbC5nZXQoJ2VuZm9yY2VTaW5nbGVTZWxlY3RlZCcpKSB7XG4gICAgICB0aGlzLl91bnNlbGVjdEFsbEV4Y2VwdChtb2RlbCk7XG4gICAgICB0aGlzLmNvbGxlY3Rpb24uc29ydCgpO1xuICAgICAgdGhpcy5yZW5kZXIoKTsgLy8gdG8gcmUtcmVuZGVyIHdpdGggbmV3IHNvcnQgb3JkZXJcbiAgICB9XG4gICAgdGhpcy4kKCcuanMtc2VsZWN0LWFsbCBpbnB1dCcpLnByb3AoJ2NoZWNrZWQnLCB0aGlzLl9hcmVBbGxTZWxlY3RlZCgpKTtcbiAgfSxcblxuICBfdW5zZWxlY3RBbGxFeGNlcHQ6IGZ1bmN0aW9uKGV4Y2VwdGlvbk1vZGVsKSB7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmVhY2goZnVuY3Rpb24obSkge1xuICAgICAgaWYgKG0gIT09IGV4Y2VwdGlvbk1vZGVsKSB7XG4gICAgICAgIG0uc2V0KCdzZWxlY3RlZCcsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBfb25DbGlja1NlbGVjdEFsbDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGludmVydGVkQWxsU2VsZWN0ZWQgPSAhdGhpcy5fYXJlQWxsU2VsZWN0ZWQoKTtcbiAgICB0aGlzLmNvbGxlY3Rpb24uY2hhaW4oKVxuICAgIC5yZWplY3QoZnVuY3Rpb24obSkge1xuICAgICAgcmV0dXJuIG0uZ2V0KCdkaXNhYmxlZCcpO1xuICAgIH0pXG4gICAgLmVhY2goZnVuY3Rpb24obSkge1xuICAgICAgbS5zZXQoJ3NlbGVjdGVkJywgaW52ZXJ0ZWRBbGxTZWxlY3RlZCk7XG4gICAgfSk7XG4gIH0sXG5cbiAgX2FyZUFsbFNlbGVjdGVkOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5jb2xsZWN0aW9uLmFsbChmdW5jdGlvbihtKSB7XG4gICAgICByZXR1cm4gbS5nZXQoJ3NlbGVjdGVkJyk7XG4gICAgfSk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcblxuLyoqXG4gKiBWaWV3IHRoYXQgcmVwcmVzZW50cyB0aGUgZm9vdGVyLlxuICogTWF5IGNvbnRhaW4gYW4gYWRkaXRpb25hbCBpbmZvIHZpZXcgd2l0aCBtb3JlIHN0YXRlIGRldGFpbHMgZGVwZW5kaW5nIG9uIGNvbnRleHQuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtbmV4dCc6ICdfb25DbGlja05leHQnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5pbmZvVmlldykge1xuICAgICAgdGhpcy5hZGRWaWV3KHRoaXMub3B0aW9ucy5pbmZvVmlldyk7XG4gICAgfVxuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIHRoaXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL21lcmdlX2RhdGFzZXRzL2Zvb3RlcicpKHtcbiAgICAgICAgbmV4dExhYmVsOiB0aGlzLm9wdGlvbnMubmV4dExhYmVsIHx8ICduZXh0IHN0ZXAnXG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5fb25DaGFuZ2VJc1JlYWR5Rm9yTmV4dFN0ZXAodGhpcy5tb2RlbCwgdGhpcy5tb2RlbC5nZXQoJ2lzUmVhZHlGb3JOZXh0U3RlcCcpKTtcbiAgICB0aGlzLl9tYXliZVJlbmRlckluZm9WaWV3KCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX21heWJlUmVuZGVySW5mb1ZpZXc6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuaW5mb1ZpZXcpIHtcbiAgICAgIHRoaXMuJCgnLmpzLWluZm8nKS5hcHBlbmQodGhpcy5vcHRpb25zLmluZm9WaWV3LnJlbmRlcigpLiRlbCk7XG4gICAgfVxuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOmlzUmVhZHlGb3JOZXh0U3RlcCcsIHRoaXMuX29uQ2hhbmdlSXNSZWFkeUZvck5leHRTdGVwLCB0aGlzKTtcbiAgfSxcblxuICBfb25DaGFuZ2VJc1JlYWR5Rm9yTmV4dFN0ZXA6IGZ1bmN0aW9uKG1vZGVsLCBpc1JlYWR5KSB7XG4gICAgdGhpcy4kKCcuanMtbmV4dCcpLnRvZ2dsZUNsYXNzKCdpcy1kaXNhYmxlZCcsICFpc1JlYWR5KTtcbiAgfSxcblxuICBfb25DbGlja05leHQ6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm1vZGVsLmdldCgnaXNSZWFkeUZvck5leHRTdGVwJykpIHtcbiAgICAgIHRoaXMubW9kZWwuc2V0KCdnb3RvTmV4dFN0ZXAnLCB0cnVlKTtcbiAgICB9XG4gIH1cblxufSk7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBCYWNrYm9uZSA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydCYWNrYm9uZSddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnQmFja2JvbmUnXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQ29sdW1uTWVyZ2VNb2RlbCA9IHJlcXVpcmUoJy4vY29sdW1uX21lcmdlL2NvbHVtbl9tZXJnZV9tb2RlbCcpO1xudmFyIFNwYXRpYWxNZXJnZU1vZGVsID0gcmVxdWlyZSgnLi9zcGF0aWFsX21lcmdlL3NwYXRpYWxfbWVyZ2VfbW9kZWwnKTtcblxuLyoqXG4gKiBWaWV3IG1vZGVsIGZvciBtZXJnZSBkYXRhc2V0cyB2aWV3LlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgZXhjbHVkZUNvbHVtbnM6IFtcbiAgICAnY2FydG9kYl9pZCcsXG4gICAgJ2NyZWF0ZWRfYXQnLFxuICAgICd1cGRhdGVkX2F0JyxcbiAgICAndGhlX2dlb21fd2VibWVyY2F0b3InLFxuICAgICdjYXJ0b2RiX2dlb3JlZl9zdGF0dXMnXG4gIF0sXG5cbiAgZGVmYXVsdHM6IHtcbiAgICBtZXJnZUZsYXZvcnM6IHVuZGVmaW5lZCwgLy8gQ29sbGVjdGlvbiwgY3JlYXRlZCB3aXRoIG1vZGVsXG4gICAgcHJldlN0ZXBzOiBbXSxcbiAgICBjdXJyZW50U3RlcDogdW5kZWZpbmVkLFxuICAgIHRhYmxlOiB1bmRlZmluZWQsXG4gICAgdXNlcjogdW5kZWZpbmVkXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oYXR0cnMpIHtcbiAgICBpZiAoIWF0dHJzLnRhYmxlKSB0aHJvdyBuZXcgRXJyb3IoJ3RhYmxlIGlzIHJlcXVpcmVkJyk7XG4gICAgaWYgKCFhdHRycy51c2VyKSB0aHJvdyBuZXcgRXJyb3IoJ3VzZXIgaXMgcmVxdWlyZWQnKTtcblxuICAgIHZhciBkYXRhID0ge1xuICAgICAgdXNlcjogdGhpcy5nZXQoJ3VzZXInKSxcbiAgICAgIHRhYmxlOiB0aGlzLmdldCgndGFibGUnKSxcbiAgICAgIGV4Y2x1ZGVDb2x1bW5zOiB0aGlzLmV4Y2x1ZGVDb2x1bW5zXG4gICAgfTtcbiAgICB0aGlzLnNldCgnbWVyZ2VGbGF2b3JzJywgbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oW1xuICAgICAgbmV3IENvbHVtbk1lcmdlTW9kZWwoZGF0YSksXG4gICAgICBuZXcgU3BhdGlhbE1lcmdlTW9kZWwoZGF0YSlcbiAgICBdKSk7XG4gIH0sXG5cbiAgaGVhZGVyU3RlcHM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzdGVwcyA9IFtdO1xuXG4gICAgdmFyIGN1cnJlbnRTdGVwID0gdGhpcy5nZXQoJ2N1cnJlbnRTdGVwJyk7XG4gICAgdmFyIGZpcnN0U3RlcCA9IHRoaXMuZ2V0KCdwcmV2U3RlcHMnKVswXSB8fCBjdXJyZW50U3RlcDtcbiAgICB2YXIgaXNGaW5pc2hlZCA9IHRydWU7XG4gICAgaWYgKGZpcnN0U3RlcCkge1xuICAgICAgdmFyIE1vZGVsID0gZmlyc3RTdGVwLmNvbnN0cnVjdG9yO1xuICAgICAgd2hpbGUgKE1vZGVsKSB7XG4gICAgICAgIGlmIChNb2RlbC5oZWFkZXIpIHtcbiAgICAgICAgICB2YXIgaXNDdXJyZW50ID0gTW9kZWwgPT09IGN1cnJlbnRTdGVwLmNvbnN0cnVjdG9yO1xuICAgICAgICAgIGlmIChpc0N1cnJlbnQpIHtcbiAgICAgICAgICAgIGlzRmluaXNoZWQgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc3RlcHMucHVzaChcbiAgICAgICAgICAgIF8uZXh0ZW5kKHtcbiAgICAgICAgICAgICAgaXNGaW5pc2hlZDogaXNGaW5pc2hlZCxcbiAgICAgICAgICAgICAgaXNDdXJyZW50OiBpc0N1cnJlbnRcbiAgICAgICAgICAgIH0sIE1vZGVsLmhlYWRlcilcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgTW9kZWwgPSBNb2RlbCA9PT0gTW9kZWwubmV4dFN0ZXAgPyB1bmRlZmluZWQgOiBNb2RlbC5uZXh0U3RlcDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc3RlcHM7XG4gIH0sXG5cbiAgZ290b05leHRTdGVwOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgY3VycmVudFN0ZXAgPSB0aGlzLmdldCgnY3VycmVudFN0ZXAnKTtcbiAgICB2YXIgbmV4dFN0ZXAgPSBjdXJyZW50U3RlcC5uZXh0U3RlcCgpO1xuICAgIHRoaXMuc2V0KHtcbiAgICAgIHByZXZTdGVwczogdGhpcy5nZXQoJ3ByZXZTdGVwcycpLmNvbmNhdChjdXJyZW50U3RlcCksXG4gICAgICBjdXJyZW50U3RlcDogbmV4dFN0ZXBcbiAgICB9KTtcbiAgfSxcblxuICBnb3RvUHJldlN0ZXA6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0KCdjdXJyZW50U3RlcCcsIHRoaXMuZ2V0KCdwcmV2U3RlcHMnKS5wb3AoKSk7XG4gIH1cblxufSk7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xudmFyIEJhc2VEaWFsb2cgPSByZXF1aXJlKCcuLi8uLi92aWV3cy9iYXNlX2RpYWxvZy92aWV3LmpzJyk7XG52YXIgTWVyZ2VEYXRhc2V0c01vZGVsID0gcmVxdWlyZSgnLi9tZXJnZV9kYXRhc2V0c19tb2RlbC5qcycpO1xudmFyIE1lcmdlRmxhdm9yVmlldyA9IHJlcXVpcmUoJy4vbWVyZ2VfZmxhdm9yX3ZpZXcnKTtcblxuLyoqXG4qIFNob3dzIGEgZGlhbG9nIHRvIHN0YXJ0IG1lcmdpbmcgdHdvIHRhYmxlc1xuKiAgbmV3IE1lcmdlRGF0YXNldHNEaWFsb2coe1xuKiAgICBtb2RlbDogdGFibGVcbiogIH0pXG4qIE1pZ3JhdGVkIGZyb20gb2xkIGNvZGUuXG4qL1xubW9kdWxlLmV4cG9ydHMgPSBCYXNlRGlhbG9nLmV4dGVuZCh7XG5cbiAgZXZlbnRzOiBCYXNlRGlhbG9nLmV4dGVuZEV2ZW50cyh7XG4gICAgJ2NsaWNrIC5qcy1iYWNrJzogJ19vbkJhY2tDbGljaydcbiAgfSksXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5vcHRpb25zLmNsZWFuX29uX2hpZGUgPSB0cnVlO1xuICAgIHRoaXMub3B0aW9ucy5lbnRlcl90b19jb25maXJtID0gZmFsc2U7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuXG4gICAgdGhpcy5tb2RlbCA9IG5ldyBNZXJnZURhdGFzZXRzTW9kZWwoe1xuICAgICAgdGFibGU6IHRoaXMub3B0aW9ucy50YWJsZSxcbiAgICAgIHVzZXI6IHRoaXMub3B0aW9ucy51c2VyXG4gICAgfSk7XG5cbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICAvKipcbiAgICogQG92ZXJyaWRlIEJhc2VEaWFsb2cucHJvdG90eXBlLnJlbmRlclxuICAgKi9cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBCYXNlRGlhbG9nLnByb3RvdHlwZS5yZW5kZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB0aGlzLiQoJy5jb250ZW50JykuYWRkQ2xhc3MoJ0RpYWxvZy1jb250ZW50V3JhcHBlcicpO1xuXG4gICAgLy8gTGV0IHRoZSBjdXJyZW50IHN0ZXAgdmlldyBrbm93IHdoZW4gdGhlIHNjcm9sbCBoYXMgY3Jvc3NlZCB0aGUgZXhwZWN0ZWQgdGhyZXNob2xkIGZvciB0aGUga2V5IGNvbHVtbnMgdG8gYmUgdmlzaWJsZVxuICAgIHRoaXMuJCgnLmpzLXNjcm9sbCcpLm9mZignc2Nyb2xsJyk7XG4gICAgaWYgKHRoaXMuX3N0ZXBWaWV3ICYmIHRoaXMuX3N0ZXBWaWV3Lm9uQ2hhbmdlS2V5Q29sdW1uc1Zpc2libGl0eSkge1xuICAgICAgdGhpcy5fYXJlS2V5Q29sdW1uc1Zpc2libGUgPSB0cnVlO1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdGhpcy4kKCcuanMtc2Nyb2xsJykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgIHZhciBhcmVLZXlDb2x1bW5zVmlzaWJsZSA9IGV2LnRhcmdldC5zY3JvbGxUb3AgPD0gMTc1O1xuICAgICAgICBpZiAoYXJlS2V5Q29sdW1uc1Zpc2libGUgIT09IHNlbGYuX2FyZUtleUNvbHVtbnNWaXNpYmxlKSB7XG4gICAgICAgICAgc2VsZi5fYXJlS2V5Q29sdW1uc1Zpc2libGUgPSBhcmVLZXlDb2x1bW5zVmlzaWJsZTtcbiAgICAgICAgICBzZWxmLl9zdGVwVmlldy5vbkNoYW5nZUtleUNvbHVtbnNWaXNpYmxpdHkoYXJlS2V5Q29sdW1uc1Zpc2libGUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICByZW5kZXJfY29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdmFyICRlbDtcbiAgICB2YXIgZGVmYXVsdFRlbXBsYXRlID0gdGhpcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvbWVyZ2VfZGF0YXNldHNfY29udGVudCcpO1xuXG4gICAgdmFyIGN1cnJlbnRTdGVwID0gdGhpcy5tb2RlbC5nZXQoJ2N1cnJlbnRTdGVwJyk7XG4gICAgaWYgKGN1cnJlbnRTdGVwKSB7XG4gICAgICB2YXIgJHN0ZXAgPSB0aGlzLl8kcmVuZGVyZWRTdGVwKGN1cnJlbnRTdGVwKTtcbiAgICAgIGlmIChjdXJyZW50U3RlcC5nZXQoJ3NraXBEZWZhdWx0VGVtcGxhdGUnKSkge1xuICAgICAgICAvLyBSZW5kZXIgdGhlIHZpZXcgYXMgY29udGVudCB3L28gd3JhcHBpbmcgaXQgaW4gdGhlIGRlZmF1bHQgdGVtcGxhdGVcbiAgICAgICAgcmV0dXJuICRzdGVwO1xuICAgICAgfVxuXG4gICAgICAkZWwgPSAkKGRlZmF1bHRUZW1wbGF0ZSh7XG4gICAgICAgIGN1cnJlbnRTdGVwOiBjdXJyZW50U3RlcCxcbiAgICAgICAgaGVhZGVyU3RlcHM6IHRoaXMubW9kZWwuaGVhZGVyU3RlcHMoKVxuICAgICAgfSkpO1xuICAgICAgJGVsLmZpbmQoJy5qcy1kZXRhaWxzJykuYXBwZW5kKCRzdGVwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGVsID0gJChkZWZhdWx0VGVtcGxhdGUoe1xuICAgICAgICBjdXJyZW50U3RlcDogdW5kZWZpbmVkXG4gICAgICB9KSk7XG4gICAgICB2YXIgJG1lcmdlRmxhdm9yc0xpc3QgPSAkZWwuZmluZCgnLmpzLWZsYXZvcnMnKTtcbiAgICAgICRtZXJnZUZsYXZvcnNMaXN0LmFwcGVuZC5hcHBseSgkbWVyZ2VGbGF2b3JzTGlzdCwgdGhpcy5fJHJlbmRlcmVkTWVyZ2VGbGF2b3JzKCkpO1xuICAgIH1cblxuICAgIHJldHVybiAkZWw7XG4gIH0sXG5cbiAgXyRyZW5kZXJlZE1lcmdlRmxhdm9yczogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwuZ2V0KCdtZXJnZUZsYXZvcnMnKVxuICAgICAgLm1hcChmdW5jdGlvbihtb2RlbCkge1xuICAgICAgICB2YXIgdmlldyA9IG5ldyBNZXJnZUZsYXZvclZpZXcoe1xuICAgICAgICAgIG1vZGVsOiBtb2RlbFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hZGRWaWV3KHZpZXcpO1xuICAgICAgICByZXR1cm4gdmlldy5yZW5kZXIoKS4kZWw7XG4gICAgICB9LCB0aGlzKTtcbiAgfSxcblxuICBfb25DaGFuZ2VTZWxlY3RlZE1lcmdlRmxhdm9yOiBmdW5jdGlvbihtb2RlbCwgd2FzU2VsZWN0ZWQpIHtcbiAgICAvLyBPbmx5IGNoYW5nZSB0byBuZXh0IHN0ZXAgaWYgdGhlcmUncyBvbmUgc2VsZWN0ZWRcbiAgICBpZiAod2FzU2VsZWN0ZWQpIHtcbiAgICAgIC8vIHJlc2V0IHNlbGVjdGVkIHN0YXRlLCBzbyBpZi93aGVuIHVzZXIgZ29lcyBiYWNrIHRvIHN0YXJ0IHZpZXcgY2FuIHNlbGVjdCBhZ2FpblxuICAgICAgbW9kZWwudW5zZXQoJ3NlbGVjdGVkJyk7XG5cbiAgICAgIC8vIFNldCBuZXcgY3VycmVudCBzdGVwXG4gICAgICB2YXIgZmlyc3RTdGVwID0gbW9kZWwuZmlyc3RTdGVwKCk7XG4gICAgICB0aGlzLm1vZGVsLnNldCgnY3VycmVudFN0ZXAnLCBmaXJzdFN0ZXApO1xuXG4gICAgICAvLyBFdmVudCB0cmFja2luZyBcIlVzZSB2aXN1YWwgbWVyZ2VcIlxuICAgICAgY2RiLmdvZC50cmlnZ2VyKCdtZXRyaWNzJywgJ3Zpc3VhbF9tZXJnZScsIHtcbiAgICAgICAgZW1haWw6IHdpbmRvdy51c2VyX2RhdGEuZW1haWxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbWVyZ2VGbGF2b3JzID0gdGhpcy5tb2RlbC5nZXQoJ21lcmdlRmxhdm9ycycpO1xuICAgIG1lcmdlRmxhdm9ycy5iaW5kKCdjaGFuZ2U6c2VsZWN0ZWQnLCB0aGlzLl9vbkNoYW5nZVNlbGVjdGVkTWVyZ2VGbGF2b3IsIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwobWVyZ2VGbGF2b3JzKTtcblxuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOmN1cnJlbnRTdGVwJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICB9LFxuXG4gIF9vbkNoYW5nZUdvdG9OZXh0U3RlcDogZnVuY3Rpb24obW9kZWwsIGlzVHJ1ZSkge1xuICAgIGlmIChpc1RydWUpIHtcbiAgICAgIHRoaXMubW9kZWwuZ290b05leHRTdGVwKCk7XG4gICAgfVxuICB9LFxuXG4gIF8kcmVuZGVyZWRTdGVwOiBmdW5jdGlvbihzdGVwKSB7XG4gICAgLy8gQ2xlYW4gdXAgcHJldiBzdGVwLCBpZiB0aGVyZSBpcyBhbnlcbiAgICBpZiAodGhpcy5fc3RlcFZpZXcpIHtcbiAgICAgIHRoaXMuX3N0ZXBWaWV3LmNsZWFuKCk7XG4gICAgICB0aGlzLnJlbW92ZVZpZXcodGhpcy5fc3RlcFZpZXcpO1xuXG4gICAgICB0aGlzLl9zdGVwTW9kZWwudW5iaW5kKCdjaGFuZ2U6Z290b05leHRTdGVwJyk7XG4gICAgICB0aGlzLl9tb2RlbHMgPSBfLndpdGhvdXQodGhpcy5fbW9kZWxzLCB0aGlzLl9zdGVwTW9kZWwpOyAvLyBUT0RPOiB3aHkgbm8gdGhpcy5yZW1vdmVfcmVsYXRlZF9tb2RlbD9cbiAgICB9XG5cbiAgICB0aGlzLl9zdGVwTW9kZWwgPSBzdGVwO1xuICAgIHRoaXMuX3N0ZXBNb2RlbC5iaW5kKCdjaGFuZ2U6Z290b05leHRTdGVwJywgdGhpcy5fb25DaGFuZ2VHb3RvTmV4dFN0ZXAsIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodGhpcy5fc3RlcE1vZGVsKTtcblxuICAgIHRoaXMuX3N0ZXBWaWV3ID0gc3RlcC5jcmVhdGVWaWV3KCk7XG4gICAgdGhpcy5fc3RlcFZpZXcuYmluZCgnY2xpY2tlZE5leHQnLCB0aGlzLl9vbkNsaWNrTmV4dCwgdGhpcyk7XG4gICAgdGhpcy5hZGRWaWV3KHRoaXMuX3N0ZXBWaWV3KTtcbiAgICByZXR1cm4gdGhpcy5fc3RlcFZpZXcucmVuZGVyKCkuJGVsO1xuICB9LFxuXG4gIF9vbkNsaWNrTmV4dDogZnVuY3Rpb24oZSkge1xuICAgIHRoaXMua2lsbEV2ZW50KGUpO1xuICAgIHRoaXMubW9kZWwuZ290b05leHRTdGVwKCk7XG4gIH0sXG5cbiAgX29uQmFja0NsaWNrOiBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZSk7XG4gICAgdGhpcy5tb2RlbC5nb3RvUHJldlN0ZXAoKTtcbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgY2xhc3NOYW1lOiAnT3B0aW9uQ2FyZCBPcHRpb25DYXJkLS1ibG9ja3knLFxuXG4gIGV2ZW50czoge1xuICAgICdjbGljayc6ICdfb25DbGljaydcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9tZXJnZV9mbGF2b3InKSh7XG4gICAgICAgIGlsbHVzdHJhdGlvbkljb25UeXBlOiB0aGlzLm1vZGVsLklMTFVTVFJBVElPTl9JQ09OX1RZUEUsXG4gICAgICAgIGljb246IHRoaXMubW9kZWwuSUNPTixcbiAgICAgICAgdGl0bGU6IHRoaXMubW9kZWwuVElUTEUsXG4gICAgICAgIGRlc2M6IHRoaXMubW9kZWwuREVTQ1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgaWYgKCF0aGlzLm1vZGVsLmlzQXZhaWxhYmxlKCkpIHtcbiAgICAgIHRoaXMuJGVsLmFkZENsYXNzKCdpcy1kaXNhYmxlZCcpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9vbkNsaWNrOiBmdW5jdGlvbihldikge1xuICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICBpZiAodGhpcy5tb2RlbC5pc0F2YWlsYWJsZSgpKSB7XG4gICAgICB0aGlzLm1vZGVsLnNldCgnc2VsZWN0ZWQnLCB0cnVlKTtcbiAgICB9XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgTWVyZ2VTdGVwVmlldyA9IHJlcXVpcmUoJy4vbWVyZ2Vfc3RlcF92aWV3Jyk7XG5cbi8qKlxuICogTGFzdCBzdGVwIGluIHRoZSBtZXJnZSBmbG93cywgbWFuYWdlZCB0aGUgYWN0dWFsIG1lcmdlIGZsb3dcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIGRlZmF1bHRzOiB7XG4gICAgc2tpcERlZmF1bHRUZW1wbGF0ZTogdHJ1ZSxcbiAgICB1c2VyOiB1bmRlZmluZWQsXG4gICAgdGFibGVOYW1lOiAnJyxcbiAgICBzcWw6IHVuZGVmaW5lZFxuICB9LFxuXG4gIGNyZWF0ZVZpZXc6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgTWVyZ2VTdGVwVmlldyh7XG4gICAgICBtb2RlbDogdGhpc1xuICAgIH0pO1xuICB9XG5cbn0pO1xuIiwidmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgJCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WyckJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyckJ10gOiBudWxsKTtcbnZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZS5qcycpO1xudmFyIEVycm9yRGV0YWlsc1ZpZXcgPSByZXF1aXJlKCcuLi8uLi92aWV3cy9lcnJvcl9kZXRhaWxzX3ZpZXcnKTtcblxuLyoqXG4gKiBWaWV3IGZvciB0aGUgbGFzdCBzdGVwIG9mIGFsbCBtZXJnZSBraW5kcywgY3JlYXRlcyB0aGUgYWN0dWFsIG1lcmdlZCB0YWJsZS5cbiAqIFRPRE86IHRha2VuIGZyb20gb2xkIGNvZGUsIGNkYi5hZG1pbi5NZXJnZVRhYmxlRGlhbG9nLm1lcmdlLCBjb3VsZCB0aGlzIGJlIGRvbmUgaW4gYSBiZXR0ZXIgd2F5P1xuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICBfLmJpbmRBbGwodGhpcywgJ19vbk1lcmdlU3VjY2VzcycsICdfb25NZXJnZUVycm9yJyk7XG4gICAgdGhpcy5fc3RhcnRNZXJnZSgpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIHRoaXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycpKHtcbiAgICAgICAgdGl0bGU6ICdNZXJnaW5nIGRhdGFzZXRzIGFuZCBnZW5lcmF0aW5nIHRoZSBuZXcgb25l4oCmJyxcbiAgICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICAgIH0pXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfc3RhcnRNZXJnZTogZnVuY3Rpb24oKSB7XG4gICAgLy8gVE9ETzogdGFrZW4gZnJvbSBvbGQgY29kZSwgY2RiLmFkbWluLk1lcmdlVGFibGVEaWFsb2cubWVyZ2VcbiAgICAvLyAgIGNvdWxkIHRoaXMgYmUgZG9uZSBpbiBhIGJldHRlciB3YXk/XG4gICAgJC5hamF4KHtcbiAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgIHVybDogY2RiLmNvbmZpZy5wcmVmaXhVcmwoKSArICcvYXBpL3YxL2ltcG9ydHMnLFxuICAgICAgZGF0YToge1xuICAgICAgICB0YWJsZV9uYW1lOiB0aGlzLm1vZGVsLmdldCgndGFibGVOYW1lJykgKyAnX21lcmdlJyxcbiAgICAgICAgc3FsOiB0aGlzLm1vZGVsLmdldCgnc3FsJylcbiAgICAgIH0sXG4gICAgICBzdWNjZXNzOiB0aGlzLl9vbk1lcmdlU3VjY2VzcyxcbiAgICAgIGVycm9yOiB0aGlzLl9vbk1lcmdlRXJyb3JcbiAgICB9KTtcbiAgfSxcblxuICBfb25NZXJnZVN1Y2Nlc3M6IGZ1bmN0aW9uKHIpIHtcbiAgICB2YXIgaW1wID0gdGhpcy5pbXBvcnRhdGlvbiA9IG5ldyBjZGIuYWRtaW4uSW1wb3J0KHtcbiAgICAgIGl0ZW1fcXVldWVfaWQ6IHIuaXRlbV9xdWV1ZV9pZFxuICAgIH0pO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwoaW1wKTtcblxuICAgIC8vIEJpbmQgY29tcGxldGUgZXZlbnRcbiAgICBpbXAuYmluZCgnaW1wb3J0Q29tcGxldGUnLCBmdW5jdGlvbigpIHtcbiAgICAgIGltcC51bmJpbmQoKTtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gY2RiLmNvbmZpZy5wcmVmaXhVcmwoKSArIFwiL3RhYmxlcy9cIiArIChpbXAuZ2V0KFwidGFibGVfbmFtZVwiKSB8fCBpbXAuZ2V0KFwidGFibGVfaWRcIikpICsgXCIvXCI7XG4gICAgfSwgdGhpcyk7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgaW1wLmJpbmQoJ2ltcG9ydEVycm9yJywgZnVuY3Rpb24oZSkge1xuICAgICAgc2VsZi5fc2hvd0Vycm9yKFxuICAgICAgICBlLmF0dHJpYnV0ZXMuZXJyb3JfY29kZSxcbiAgICAgICAgZS5hdHRyaWJ1dGVzLmdldF9lcnJvcl90ZXh0LnRpdGxlLFxuICAgICAgICBlLmF0dHJpYnV0ZXMuZ2V0X2Vycm9yX3RleHQud2hhdF9hYm91dCxcbiAgICAgICAgZS5hdHRyaWJ1dGVzLml0ZW1fcXVldWVfaWRcbiAgICAgICk7XG4gICAgfSwgdGhpcyk7XG4gICAgaW1wLnBvbGxDaGVjaygpO1xuICB9LFxuXG4gIF9vbk1lcmdlRXJyb3I6IGZ1bmN0aW9uKGUpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5fc2hvd0Vycm9yKFxuICAgICAgICBlLmF0dHJpYnV0ZXMuZXJyb3JfY29kZSxcbiAgICAgICAgZS5hdHRyaWJ1dGVzLmdldF9lcnJvcl90ZXh0LnRpdGxlLFxuICAgICAgICBlLmF0dHJpYnV0ZXMuZ2V0X2Vycm9yX3RleHQud2hhdF9hYm91dCxcbiAgICAgICAgZS5hdHRyaWJ1dGVzLml0ZW1fcXVldWVfaWRcbiAgICAgICk7XG4gICAgfSBjYXRjaChlcnIpIHtcbiAgICAgIHRoaXMuX3Nob3dFcnJvcignOTk5OTknLCAnVW5rbm93bicsICcnKTtcbiAgICB9XG4gIH0sXG5cbiAgLy9TaG93IHRoZSBlcnJvciB3aGVuIGR1cGxpY2F0aW9uIGZhaWxzXG4gIF9zaG93RXJyb3I6IGZ1bmN0aW9uKG51bWJlciwgdGl0bGUsIHdoYXRfYWJvdXQsIGl0ZW1fcXVldWVfaWQpIHtcbiAgICB2YXIgdmlldyA9IG5ldyBFcnJvckRldGFpbHNWaWV3KHtcbiAgICAgIGVycjoge1xuICAgICAgICBlcnJvcl9jb2RlOiBudW1iZXIsXG4gICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgd2hhdF9hYm91dDogd2hhdF9hYm91dCxcbiAgICAgICAgaXRlbV9xdWV1ZV9pZDogaXRlbV9xdWV1ZV9pZFxuICAgICAgfSxcbiAgICAgIHVzZXI6IHRoaXMubW9kZWwuZ2V0KCd1c2VyJylcbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodmlldyk7XG4gICAgdGhpcy4kZWwuaHRtbCh2aWV3LnJlbmRlcigpLmVsKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIFNwYXRpYWxNZXJnZVZpZXcgPSByZXF1aXJlKCcuL3NwYXRpYWxfbWVyZ2VfdmlldycpO1xudmFyIE1lcmdlTW9kZWwgPSByZXF1aXJlKCcuLi9tZXJnZV9zdGVwX21vZGVsJyk7XG52YXIgZ2VuZXJhdGVTcGF0aWFsTWVyZ2VTUUwgPSByZXF1aXJlKCcuL2dlbmVyYXRlX3NwYXRpYWxfbWVyZ2Vfc3FsJyk7XG5cbi8qKlxuICogU3RlcCAyIGZvciBhIHNwYXRpYWwgbWVyZ2UsIHNlbGVjdCBtZXJnZSBtZXRob2QgYW5kIHJpZ2h0IGNvbHVtbi5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIElOU1RSVUNUSU9OU19TQUZFX0hUTUw6ICdDYWxjdWxhdGUgdGhlIGludGVyc2VjdGluZyBnZW9zcGF0aWFsIHJlY29yZHMgYmV0d2VlbiB0d28gZGF0YXNldHMgKGV4LiBwb2ludHMgaW4gcG9seWdvbnMpLjxici8+JyArXG4gICAgXCJZb3UnbGwgbmVlZCB0byBkZWNpZGUgdGhlIG9wZXJhdGlvbiB0byBwZXJmb3JtIGhlcmUuXCIsXG5cbiAgZGVmYXVsdHM6IHtcbiAgICBpc1JlYWR5Rm9yTmV4dFN0ZXA6IGZhbHNlLFxuICAgIHVzZXI6IHVuZGVmaW5lZCxcbiAgICBtZXJnZU1ldGhvZHM6IHVuZGVmaW5lZCxcbiAgICBsZWZ0VGFibGU6IHVuZGVmaW5lZCxcbiAgICBsZWZ0S2V5Q29sdW1uOiB1bmRlZmluZWQsXG4gICAgbGVmdENvbHVtbnM6IHVuZGVmaW5lZCxcbiAgICByaWdodFRhYmxlRGF0YTogdW5kZWZpbmVkLFxuICAgIHJpZ2h0S2V5Q29sdW1uOiB1bmRlZmluZWQsXG4gICAgcmlnaHRDb2x1bW5zOiB1bmRlZmluZWRcbiAgfSxcblxuICBjcmVhdGVWaWV3OiBmdW5jdGlvbigpIHtcbiAgICAvLyBSZXNldCBzdGF0ZVxuICAgIHRoaXMuc2V0KCdnb3RvTmV4dFN0ZXAnLCBmYWxzZSk7XG4gICAgdGhpcy5nZXQoJ21lcmdlTWV0aG9kcycpLmVhY2goZnVuY3Rpb24obSkge1xuICAgICAgbS5zZXQoJ2Rpc2FibGVkJywgIXRoaXMuaXNDb3VudE1lcmdlTWV0aG9kKG0pKTtcbiAgICB9LCB0aGlzKTtcbiAgICB0aGlzLmdldCgncmlnaHRDb2x1bW5zJykuY29tcGFyYXRvciA9IGZ1bmN0aW9uKGNvbHVtbikge1xuICAgICAgcmV0dXJuIGNvbHVtbi5nZXQoJ25hbWUnKTsgLy8gc29ydCBhbHBoYWJldGljYWxseVxuICAgIH07XG5cbiAgICByZXR1cm4gbmV3IFNwYXRpYWxNZXJnZVZpZXcoe1xuICAgICAgbW9kZWw6IHRoaXNcbiAgICB9KTtcbiAgfSxcblxuICBzZWxlY3RlZE1lcmdlTWV0aG9kOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ21lcmdlTWV0aG9kcycpLmZpbmQodGhpcy5faXNTZWxlY3RlZENvbHVtbik7XG4gIH0sXG5cbiAgc2VsZWN0ZWRSaWdodE1lcmdlQ29sdW1uOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3JpZ2h0Q29sdW1ucycpLmZpbmQodGhpcy5faXNTZWxlY3RlZENvbHVtbik7XG4gIH0sXG5cbiAgY2hhbmdlZFJpZ2h0TWVyZ2VDb2x1bW46IGZ1bmN0aW9uKG5ld0NvbHVtbikge1xuICAgIHRoaXMuX3VwZGF0ZU1lcmdlTWV0aG9kcyhuZXdDb2x1bW4pO1xuICAgIHRoaXMuX2Fzc2VydElmUmVhZHlGb3JOZXh0U3RlcCgpO1xuICB9LFxuXG4gIGNoYW5nZWRTZWxlY3RlZE1lcmdlTWV0aG9kOiBmdW5jdGlvbihuZXdNZXJnZU1ldGhvZCkge1xuICAgIHZhciBjID0gdGhpcy5nZXQoJ21lcmdlTWV0aG9kcycpLmNoYWluKCkud2l0aG91dChuZXdNZXJnZU1ldGhvZCk7XG4gICAgYy5lYWNoKHRoaXMuX2Rlc2VsZWN0KTsgLy9hbGwgYnV0IHRoZSBuZXcgc2VsZWN0ZWQgbWVyZ2UgbWV0aG9kXG5cbiAgICBpZiAodGhpcy5pc0NvdW50TWVyZ2VNZXRob2QobmV3TWVyZ2VNZXRob2QpKSB7XG4gICAgICBjLmVhY2godGhpcy5fZW5hYmxlKTsgLy9lbmFibGUgYWxsLCBzbyB0aGUgdXNlciBjYW4gXCJnbyBiYWNrXCIgdG8gc2VlIGF2YWlsYWJsZSBjb2x1bW5zIGZvciBBVkcvU1VNIG1lcmdlIG1ldGhvZHNcbiAgICAgIHRoaXMuZ2V0KCdyaWdodENvbHVtbnMnKS5lYWNoKHRoaXMuX2Rlc2VsZWN0KTsgLy8gcmVzZXQgcHJldiBzZWxlY3Rpb24gaWYgYW55XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIElmIG5vdCBhIGNvdW50IG1lZ2UgbWV0aG9kIHVwZGF0ZSBzdGF0ZSBiYXNlZCBvbiBjdXJyZW50IHNlbGVjdGlvbiBvZiBtZXJnZSBjb2x1bW4uXG4gICAgICB0aGlzLl91cGRhdGVNZXJnZU1ldGhvZHModGhpcy5zZWxlY3RlZFJpZ2h0TWVyZ2VDb2x1bW4oKSk7XG4gICAgfVxuXG4gICAgdGhpcy5fYXNzZXJ0SWZSZWFkeUZvck5leHRTdGVwKCk7XG4gIH0sXG5cbiAgX3VwZGF0ZU1lcmdlTWV0aG9kczogZnVuY3Rpb24obmV3Q29sdW1uKSB7XG4gICAgLy8gRWFjaCBtZXJnZSBtZXRob2Qgc2hvdWxkIGtub3cgaG93IGl0IHNob3VsZCByZW5kZXIgYmFzZWQgb24gc2VsZWN0ZWQgbWVyZ2UgY29sdW1uXG4gICAgdGhpcy5nZXQoJ21lcmdlTWV0aG9kcycpLmVhY2goZnVuY3Rpb24obSkge1xuICAgICAgbS5jaGFuZ2VkTWVyZ2VDb2x1bW4obmV3Q29sdW1uKTtcbiAgICB9KTtcbiAgfSxcblxuICBpc0NvdW50TWVyZ2VNZXRob2Q6IGZ1bmN0aW9uKG0pIHtcbiAgICByZXR1cm4gbSAmJiBtLk5BTUUgPT09ICdjb3VudCc7XG4gIH0sXG5cbiAgbmV4dFN0ZXA6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvci5uZXh0U3RlcCh7XG4gICAgICB1c2VyOiB0aGlzLmdldCgndXNlcicpLFxuICAgICAgdGFibGVOYW1lOiB0aGlzLmdldCgnbGVmdFRhYmxlJykuZ2V0KCduYW1lJyksXG4gICAgICBzcWw6IHRoaXMuX3NxbEZvck1lcmdlTWV0aG9kKClcbiAgICB9KTtcbiAgfSxcblxuICBfZGVzZWxlY3Q6IGZ1bmN0aW9uKG0pIHtcbiAgICBtLnNldCgnc2VsZWN0ZWQnLCBmYWxzZSk7XG4gIH0sXG5cbiAgX2Rpc2FibGU6IGZ1bmN0aW9uKG0pIHtcbiAgICBtLnNldCgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgfSxcblxuICBfZW5hYmxlOiBmdW5jdGlvbihtKSB7XG4gICAgbS5zZXQoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICB9LFxuXG4gIF9hc3NlcnRJZlJlYWR5Rm9yTmV4dFN0ZXA6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBtZXJnZU1ldGhvZCA9IHRoaXMuc2VsZWN0ZWRNZXJnZU1ldGhvZCgpO1xuICAgIHZhciBpc1JlYWR5ID0gbWVyZ2VNZXRob2QgJiYgKFxuICAgICAgICB0aGlzLmlzQ291bnRNZXJnZU1ldGhvZChtZXJnZU1ldGhvZCkgfHxcbiAgICAgICAgKCFtZXJnZU1ldGhvZC5nZXQoJ2Rpc2FibGVkJykgJiYgdGhpcy5zZWxlY3RlZFJpZ2h0TWVyZ2VDb2x1bW4oKSlcbiAgICAgICk7XG4gICAgdGhpcy5zZXQoJ2lzUmVhZHlGb3JOZXh0U3RlcCcsIGlzUmVhZHkpO1xuICB9LFxuXG4gIF9zcWxGb3JNZXJnZU1ldGhvZDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHJpZ2h0VGFibGVOYW1lID0gdGhpcy5nZXQoJ3JpZ2h0VGFibGVEYXRhJykubmFtZTtcbiAgICB2YXIgbWVyZ2VNZXRob2QgPSB0aGlzLnNlbGVjdGVkTWVyZ2VNZXRob2QoKTtcbiAgICB2YXIgc2VsZWN0ZWRNZXJnZUNvbHVtbiA9IHRoaXMuc2VsZWN0ZWRSaWdodE1lcmdlQ29sdW1uKCk7XG4gICAgdmFyIHNlbGVjdENsYXVzZSA9IG1lcmdlTWV0aG9kLnNxbFNlbGVjdENsYXVzZShyaWdodFRhYmxlTmFtZSwgc2VsZWN0ZWRNZXJnZUNvbHVtbiA/IHNlbGVjdGVkTWVyZ2VDb2x1bW4uZ2V0KCduYW1lJykgOiAnJyk7XG5cbiAgICByZXR1cm4gZ2VuZXJhdGVTcGF0aWFsTWVyZ2VTUUwoe1xuICAgICAgbGVmdFRhYmxlTmFtZTogdGhpcy5nZXQoJ2xlZnRUYWJsZScpLmdldCgnbmFtZScpLFxuICAgICAgbGVmdENvbHVtbnNOYW1lczogdGhpcy5fc2VsZWN0ZWRMZWZ0Q29sdW1uc05hbWVzKCksXG4gICAgICByaWdodFRhYmxlTmFtZTogcmlnaHRUYWJsZU5hbWUsXG4gICAgICBzZWxlY3RDbGF1c2U6IHNlbGVjdENsYXVzZSxcbiAgICAgIGludGVyc2VjdFR5cGU6IG1lcmdlTWV0aG9kLk5BTUVcbiAgICB9KTtcbiAgfSxcblxuICBfc2VsZWN0ZWRMZWZ0Q29sdW1uc05hbWVzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2xlZnRDb2x1bW5zJylcbiAgICAuZmlsdGVyKHRoaXMuX2lzU2VsZWN0ZWRDb2x1bW4pXG4gICAgLm1hcChmdW5jdGlvbihtKSB7XG4gICAgICByZXR1cm4gbS5nZXQoJ25hbWUnKTtcbiAgICB9KTtcbiAgfSxcblxuICBfaXNTZWxlY3RlZENvbHVtbjogZnVuY3Rpb24obSkge1xuICAgIHJldHVybiBtLmdldCgnc2VsZWN0ZWQnKTtcbiAgfVxuXG59LCB7XG4gIGhlYWRlcjoge1xuICAgIGljb246ICdDREItSWNvbkZvbnQtd2l6YXJkJyxcbiAgICB0aXRsZTogJ0Nob29zZSBtZXJnZSBjb2x1bW5zJ1xuICB9LFxuICBuZXh0U3RlcDogTWVyZ2VNb2RlbFxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG52YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBTdW1NZXJnZU1ldGhvZCA9IHJlcXVpcmUoJy4vbWVyZ2VfbWV0aG9kcy9zdW1fbWVyZ2VfbWV0aG9kJyk7XG52YXIgQVZHTWVyZ2VNZXRob2QgPSByZXF1aXJlKCcuL21lcmdlX21ldGhvZHMvYXZnX21lcmdlX21ldGhvZCcpO1xudmFyIENvdW50TWVyZ2VNZXRob2QgPSByZXF1aXJlKCcuL21lcmdlX21ldGhvZHMvY291bnRfbWVyZ2VfbWV0aG9kJyk7XG52YXIgU3BhdGlhbE1lcmdlVmlldyA9IHJlcXVpcmUoJy4vc3BhdGlhbF9tZXJnZV92aWV3Jyk7XG52YXIgQ2hvb3NlTWVyZ2VNZXRob2QgPSByZXF1aXJlKCcuL2Nob29zZV9tZXJnZV9tZXRob2RfbW9kZWwnKTtcblxuLyoqXG4gKiBGaXJzdCBzdGVwIGZvciBhIHNwYXRpYWwgbWVyZ2UgLSBzZWxlY3QgYSBkYXRhc2V0IHRhYmxlLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgSU5TVFJVQ1RJT05TX1NBRkVfSFRNTDogJ0NhbGN1bGF0ZSB0aGUgaW50ZXJzZWN0aW5nIGdlb3NwYXRpYWwgcmVjb3JkcyBiZXR3ZWVuIHR3byBkYXRhc2V0cyAoZXguIHBvaW50cyBpbiBwb2x5Z29ucykuPGJyLz4nICtcbiAgICBcIllvdSdsbCBuZWVkIHRvIGRlY2lkZSB0aGUgb3BlcmF0aW9uIHRvIHBlcmZvcm0gaGVyZS5cIixcblxuICBkZWZhdWx0czoge1xuICAgIHVzZXI6IHVuZGVmaW5lZCxcbiAgICBsZWZ0VGFibGU6IHVuZGVmaW5lZCxcbiAgICBleGNsdWRlQ29sdW1uczogdW5kZWZpbmVkLFxuICAgIGxlZnRLZXlDb2x1bW46IHVuZGVmaW5lZCxcbiAgICBsZWZ0Q29sdW1uczogdW5kZWZpbmVkLFxuICAgIG1lcmdlTWV0aG9kczogdW5kZWZpbmVkLFxuXG4gICAgcmlnaHRUYWJsZURhdGE6IHVuZGVmaW5lZCxcbiAgICByaWdodENvbHVtbnM6IHVuZGVmaW5lZFxuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKGF0dHJzKSB7XG4gICAgaWYgKCFhdHRycy5sZWZ0VGFibGUpIHRocm93IG5ldyBFcnJvcignbGVmdFRhYmxlIGlzIHJlcXVpcmVkJyk7XG4gICAgaWYgKCFhdHRycy5leGNsdWRlQ29sdW1ucyB8fCBfLmlzRW1wdHkoYXR0cnMuZXhjbHVkZUNvbHVtbnMpKSBjZGIubG9nLmVycm9yKCdleGNsdWRlQ29sdW1ucyB3YXMgZW1wdHknKTtcbiAgICB0aGlzLl9pbml0Q29sdW1ucygpO1xuICAgIHRoaXMuX2luaXRMZWZ0S2V5Q29sdW1uKCk7XG4gICAgdGhpcy5faW5pdE1lcmdlTWV0aG9kcygpO1xuICB9LFxuXG4gIGNyZWF0ZVZpZXc6IGZ1bmN0aW9uKCkge1xuICAgIC8vIFJlc2V0IHN0YXRlXG4gICAgdGhpcy5zZXQoe1xuICAgICAgZ290b05leHRTdGVwOiBmYWxzZSxcbiAgICAgIHJpZ2h0VGFibGVEYXRhOiB1bmRlZmluZWRcbiAgICB9KTtcbiAgICB0aGlzLmdldCgnbWVyZ2VNZXRob2RzJykuZWFjaChmdW5jdGlvbihtKSB7XG4gICAgICBtLnNldCh7XG4gICAgICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICAgICAgZGlzYWJsZWQ6IHRydWVcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHRoaXMuZ2V0KCdyaWdodENvbHVtbnMnKS5yZXNldCgpO1xuXG4gICAgcmV0dXJuIG5ldyBTcGF0aWFsTWVyZ2VWaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzXG4gICAgfSk7XG4gIH0sXG5cbiAgYXNzZXJ0SWZSZWFkeUZvck5leHRTdGVwOiBmdW5jdGlvbigpIHtcbiAgICAvLyBBbHdheXMgcmV0dXJuIGZhbHNlLCBnb2VzIHRvIG5leHQgc3RlcCBpbXBsaWNpdGx5IG9uIHNlbGVjdGluZyB0YWJsZVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICBmZXRjaFJpZ2h0Q29sdW1uczogZnVuY3Rpb24odGFibGVEYXRhKSB7XG4gICAgdGhpcy5zZXQoJ3JpZ2h0VGFibGVEYXRhJywgdGFibGVEYXRhKTtcbiAgICAvLyBUT0RPOiBleHRyYWN0ZWQgZnJvbSBvbGQgY29kZSwgY2RiLmFkbWluLlRhYmxlQ29sdW1uU2VsZWN0b3IuX2dldENvbHVtbnMsXG4gICAgLy8gICBpc250IHRoZXJlIHNvbWUgYmV0dGVyIHdheSB0byBnZXQgdGhlIHNjaGVtYS9jb2x1bW5zP1xuICAgICQuYWpheCh7XG4gICAgICB1cmw6IGNkYi5jb25maWcucHJlZml4VXJsKCkgKyAnL2FwaS92MS90YWJsZXMvJyArIHRhYmxlRGF0YS5pZCxcbiAgICAgIGRhdGFUeXBlOiAnanNvbnAnLFxuICAgICAgc3VjY2VzczogdGhpcy5fb25GZXRjaGVkUmlnaHRDb2x1bW5zLmJpbmQodGhpcylcbiAgICB9KTtcbiAgfSxcblxuICBuZXh0U3RlcDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yLm5leHRTdGVwKHtcbiAgICAgIHVzZXI6IHRoaXMuZ2V0KCd1c2VyJyksXG4gICAgICBtZXJnZU1ldGhvZHM6IHRoaXMuZ2V0KCdtZXJnZU1ldGhvZHMnKSxcbiAgICAgIGxlZnRUYWJsZTogdGhpcy5nZXQoJ2xlZnRUYWJsZScpLFxuICAgICAgbGVmdEtleUNvbHVtbjogdGhpcy5nZXQoJ2xlZnRLZXlDb2x1bW4nKSxcbiAgICAgIGxlZnRDb2x1bW5zOiB0aGlzLmdldCgnbGVmdENvbHVtbnMnKSxcbiAgICAgIHJpZ2h0VGFibGVEYXRhOiB0aGlzLmdldCgncmlnaHRUYWJsZURhdGEnKSxcbiAgICAgIHJpZ2h0S2V5Q29sdW1uOiB0aGlzLl9yaWdodEtleUNvbHVtbigpLFxuICAgICAgcmlnaHRDb2x1bW5zOiB0aGlzLmdldCgncmlnaHRDb2x1bW5zJylcbiAgICB9KTtcbiAgfSxcblxuICBfaW5pdENvbHVtbnM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBmaWx0ZXJlZExlZnRDb2x1bW5zID0gdGhpcy5fZmlsdGVyQ29sdW1ucyh0aGlzLmdldCgnbGVmdFRhYmxlJykuZ2V0KCdzY2hlbWEnKSk7XG4gICAgdGhpcy5zZXQoJ2xlZnRDb2x1bW5zJywgbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oZmlsdGVyZWRMZWZ0Q29sdW1ucykpO1xuICAgIHRoaXMuc2V0KCdyaWdodENvbHVtbnMnLCBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbigpKTtcbiAgfSxcblxuICBfaW5pdE1lcmdlTWV0aG9kczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIG1lcmdlTWV0aG9kcyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKFtcbiAgICAgIG5ldyBTdW1NZXJnZU1ldGhvZCgpLFxuICAgICAgbmV3IENvdW50TWVyZ2VNZXRob2QoKSxcbiAgICAgIG5ldyBBVkdNZXJnZU1ldGhvZCgpXG4gICAgXSk7XG4gICAgdGhpcy5zZXQoJ21lcmdlTWV0aG9kcycsIG1lcmdlTWV0aG9kcyk7XG4gIH0sXG5cbiAgX2ZpbHRlckNvbHVtbnM6IGZ1bmN0aW9uKHRhYmxlU2NoZW1hKSB7XG4gICAgdmFyIGV4Y2x1ZGVDb2x1bW5zID0gdGhpcy5nZXQoJ2V4Y2x1ZGVDb2x1bW5zJyk7XG5cbiAgICByZXR1cm4gXy5jaGFpbih0YWJsZVNjaGVtYSlcbiAgICAgIC5tYXAodGhpcy5fY29sdW1uRGF0YVRvQ29sdW1uKVxuICAgICAgLnJlamVjdChmdW5jdGlvbihjb2x1bW4pIHtcbiAgICAgICAgcmV0dXJuIF8uY29udGFpbnMoZXhjbHVkZUNvbHVtbnMsIGNvbHVtbi5uYW1lKTtcbiAgICAgIH0pXG4gICAgICAudmFsdWUoKTtcbiAgfSxcblxuICBfY29sdW1uRGF0YVRvQ29sdW1uOiBmdW5jdGlvbihjb2x1bW5EYXRhKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8vIFRPRE86IHdoeSBkb24ndCB3ZSB1c2UgYSBwcm9wZXIgbW9kZWwgZm9yIHNjaGVtYSwgdG8gcHJvdmlkZSBjb252ZW5pZW50IG1ldGhvZCB0byBnZXQgY29sdW1ucyBhcyBhIGNvbGxlY3Rpb24gYWxyZWFkeT9cbiAgICAgIG5hbWU6IGNvbHVtbkRhdGFbMF0sXG4gICAgICB0eXBlOiBjb2x1bW5EYXRhWzFdXG4gICAgfTtcbiAgfSxcblxuICBfaW5pdExlZnRLZXlDb2x1bW46IGZ1bmN0aW9uKCkge1xuICAgIHZhciB0aGVHZW9tQ29sdW1uID0gdGhpcy5nZXQoJ2xlZnRDb2x1bW5zJykuZmluZCh0aGlzLl9pc0NvbHVtblRoZUdlb20pO1xuICAgIHRoaXMuc2V0KCdsZWZ0S2V5Q29sdW1uJywgdGhlR2VvbUNvbHVtbi5jbG9uZSgpKTtcbiAgfSxcblxuICBfb25GZXRjaGVkUmlnaHRDb2x1bW5zOiBmdW5jdGlvbihyZXN1bHRzKSB7XG4gICAgdmFyIGZpbHRlcmVkQ29sdW1ucyA9IHRoaXMuX2ZpbHRlckNvbHVtbnMocmVzdWx0cy5zY2hlbWEpO1xuICAgIHRoaXMuZ2V0KCdyaWdodENvbHVtbnMnKS5yZXNldChmaWx0ZXJlZENvbHVtbnMsIHsgc2lsZW50OiB0cnVlIH0pOyAvLyBoYW5kbGVkIGluIG5leHQgc3RlcFxuICAgIHRoaXMuc2V0KCdnb3RvTmV4dFN0ZXAnLCB0cnVlKTtcbiAgfSxcblxuICBfcmlnaHRLZXlDb2x1bW46IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgncmlnaHRDb2x1bW5zJylcbiAgICAgIC5maW5kKHRoaXMuX2lzQ29sdW1uVGhlR2VvbSlcbiAgICAgIC5jbG9uZSgpO1xuICB9LFxuXG4gIF9pc0NvbHVtblRoZUdlb206IGZ1bmN0aW9uKGNvbHVtbikge1xuICAgIHJldHVybiBjb2x1bW4uZ2V0KCduYW1lJykgPT09ICd0aGVfZ2VvbSc7XG4gIH1cblxufSwge1xuICBoZWFkZXI6IHtcbiAgICBpY29uOiAnQ0RCLUljb25Gb250LXBsYXknLFxuICAgIHRpdGxlOiAnQ2hvb3NlIGRhdGFzZXQgdG8gbWVyZ2UnXG4gIH0sXG4gIG5leHRTdGVwOiBDaG9vc2VNZXJnZU1ldGhvZFxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcblxuLyoqXG4gKiBWaWV3IHRvIGluZGljYXRlIHRoZSBzZWxlY3RlZCBrZXkgY29sdW1ucyByZWxhdGlvbnNoaXAgYW5kIG1lcmdlIG1ldGhvZCByZWxhdGlvbnNoaXAuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHJpZ2h0Q29sdW1ucyA9IHRoaXMubW9kZWwuZ2V0KCdyaWdodENvbHVtbnMnKTtcbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGhpcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3MvbWVyZ2VfZGF0YXNldHMvc3BhdGlhbF9tZXJnZS9mb290ZXJfaW5mbycpKHtcbiAgICAgICAgbGVmdFRhYmxlTmFtZTogdGhpcy5tb2RlbC5nZXQoJ2xlZnRUYWJsZScpLmdldCgnbmFtZScpLFxuICAgICAgICByaWdodENvbHVtbk5hbWU6IHJpZ2h0Q29sdW1ucyA/IHJpZ2h0Q29sdW1ucy5nZXQoJ25hbWUnKSA6ICcnXG4gICAgICB9KVxuICAgICk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHJpZ2h0Q29sdW1ucyA9IHRoaXMubW9kZWwuZ2V0KCdyaWdodENvbHVtbnMnKTtcbiAgICByaWdodENvbHVtbnMuYmluZCgnY2hhbmdlOnNlbGVjdGVkJywgdGhpcy5fdXBkYXRlUGllY2VzLCB0aGlzKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHJpZ2h0Q29sdW1ucyk7XG5cbiAgICB2YXIgbWVyZ2VNZXRob2RzID0gdGhpcy5tb2RlbC5nZXQoJ21lcmdlTWV0aG9kcycpO1xuICAgIG1lcmdlTWV0aG9kcy5iaW5kKCdjaGFuZ2U6c2VsZWN0ZWQnLCB0aGlzLl91cGRhdGVQaWVjZXMsIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwobWVyZ2VNZXRob2RzKTtcbiAgfSxcblxuICBfdXBkYXRlUGllY2VzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZWN0ZWRNZXJnTWV0aG9kID0gdGhpcy5tb2RlbC5zZWxlY3RlZE1lcmdlTWV0aG9kKCk7XG4gICAgdGhpcy4kKCcuanMtbWVyZ2UtbWV0aG9kLW5hbWUnKS50ZXh0KHNlbGVjdGVkTWVyZ01ldGhvZCA/IHNlbGVjdGVkTWVyZ01ldGhvZC5OQU1FIDogJycpO1xuXG4gICAgaWYgKHRoaXMubW9kZWwuaXNDb3VudE1lcmdlTWV0aG9kKHNlbGVjdGVkTWVyZ01ldGhvZCkpIHtcbiAgICAgIHRoaXMuX2NoYW5nZVJpZ2h0UGllY2UodGhpcy5tb2RlbC5nZXQoJ3JpZ2h0VGFibGVEYXRhJykubmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBtID0gdGhpcy5tb2RlbC5zZWxlY3RlZFJpZ2h0TWVyZ2VDb2x1bW4oKTtcbiAgICAgIHRoaXMuX2NoYW5nZVJpZ2h0UGllY2UobSA/IG0uZ2V0KCduYW1lJykgOiAnJyk7XG4gICAgfVxuICB9LFxuXG4gIF9jaGFuZ2VSaWdodFBpZWNlOiBmdW5jdGlvbih0ZXh0KSB7XG4gICAgdGhpcy4kKCcuanMtcmlnaHQnKVxuICAgICAgLnRleHQodGV4dCB8fCAnJylcbiAgICAgIC50b2dnbGVDbGFzcygnaXMtcGxhY2Vob2xkZXInLCAhdGV4dCk7XG4gIH1cblxufSk7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcblxuLy8gU1FMIHF1ZXJ5IGFzIHRha2VuIGZyb20gb2xkIGNvZGUsIGNkYi5hZG1pbi5NZXJnZVRhYmxlc0RpYWxvZ1xuLy8gQ2xlYW5lZCB1cCB0byByZW1vdmUgbm9pc2UgYW5kIGF2b2lkIHN0cmluZyBjb25jYXRlbmF0aW9uIHRvIGJlIG1vcmUgbGVnaWJsZS5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZCkge1xuICB2YXIgbGVmdFRhYmxlTmFtZSA9IGQubGVmdFRhYmxlTmFtZTtcbiAgdmFyIGxlZnRDb2x1bW5zTmFtZXMgPSBkLmxlZnRDb2x1bW5zTmFtZXM7XG4gIHZhciByaWdodFRhYmxlTmFtZSA9IGQucmlnaHRUYWJsZU5hbWU7XG4gIHZhciBzZWxlY3RDbGF1c2UgPSBkLnNlbGVjdENsYXVzZTtcbiAgdmFyIGludGVyc2VjdFR5cGUgPSBkLmludGVyc2VjdFR5cGU7XG5cbiAgdmFyIHNxbCA9IFsnU0VMRUNUJyxcbiAgICBsZWZ0VGFibGVOYW1lICsgJy5jYXJ0b2RiX2lkLCcsXG4gICAgbGVmdFRhYmxlTmFtZSArICcudGhlX2dlb21fd2VibWVyY2F0b3IsJyxcbiAgICBsZWZ0VGFibGVOYW1lICsgJy50aGVfZ2VvbSwnXG4gIF07XG5cbiAgXy5lYWNoKGxlZnRDb2x1bW5zTmFtZXMsIGZ1bmN0aW9uKGNvbHVtbk5hbWUpIHtcbiAgICBpZiAoY29sdW1uTmFtZSAhPT0gJ3RoZV9nZW9tJykge1xuICAgICAgc3FsLnB1c2gobGVmdFRhYmxlTmFtZSArICcuJyArIGNvbHVtbk5hbWUgKyAnLCcpO1xuICAgIH1cbiAgfSk7XG5cbiAgc3FsLnB1c2goXG4gICAgJyhTRUxFQ1QgJyArIHNlbGVjdENsYXVzZSArICcgRlJPTSAnICsgcmlnaHRUYWJsZU5hbWUsXG4gICAgICAnV0hFUkUgU1RfSW50ZXJzZWN0cygnICsgbGVmdFRhYmxlTmFtZSArICcudGhlX2dlb20sICcgKyByaWdodFRhYmxlTmFtZSArICcudGhlX2dlb20pJyxcbiAgICAnKSBBUyBpbnRlcnNlY3RfJyArIGludGVyc2VjdFR5cGUsXG4gICAgJ0ZST00gJyArIGxlZnRUYWJsZU5hbWVcbiAgKTtcblxuICByZXR1cm4gc3FsLmpvaW4oJyAnKTtcbn07XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcblxuLyoqXG4gKiBWaWV3IHRvIHJlbmRlciBhIGluZGl2aWR1YWwgbWVyZ2UgbWV0aG9kLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdUYWJMaW5rIFRhYkxpbmstLXBvc2l0aXZlIFRhYkxpbmstLXRleHRDZW50ZXJVcGNhc2UnLFxuXG4gIGV2ZW50czoge1xuICAgICdob3Zlcic6ICdfb25Ib3ZlcicsXG4gICAgJ21vdXNlb3V0JzogJ19vbk1vdXNlT3V0JyxcbiAgICAnY2xpY2snOiAnX29uQ2xpY2snXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXNEaXNhYmxlZCA9IHRoaXMubW9kZWwuZ2V0KCdkaXNhYmxlZCcpO1xuXG4gICAgdGhpcy4kZWxcbiAgICAgIC50ZXh0KHRoaXMubW9kZWwuTkFNRSlcbiAgICAgIC50b2dnbGVDbGFzcygnZGlzYWJsZWQnLCBpc0Rpc2FibGVkKVxuICAgICAgLnRvZ2dsZUNsYXNzKCdzZWxlY3RlZCcsIHRoaXMubW9kZWwuZ2V0KCdzZWxlY3RlZCcpICYmICFpc0Rpc2FibGVkKTtcblxuICAgIGlmIChpc0Rpc2FibGVkKSB7XG4gICAgICB0aGlzLl90b29sdGlwVmlldygpLnNob3coKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfdG9vbHRpcFZpZXc6IGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy5fdG9vbHRpcCkge1xuICAgICAgdGhpcy5fdG9vbHRpcCA9IG5ldyBjZGIuY29tbW9uLlRpcHN5VG9vbHRpcCh7XG4gICAgICAgIGVsOiB0aGlzLiRlbCxcbiAgICAgICAgdHJpZ2dlcjogJ21hbnVhbCcsXG4gICAgICAgIHRpdGxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAvLyBGb3Igbm93IHRoZXJlJ3Mgb25seSBvbmUgcmVhc29uIHdoeSBhIG1lcmdlIG1ldGhvZCB3b3VsZCBiZSBkaXNhYmxlZCwgc28gaW5saW5lIGl0IGhlcmUuXG4gICAgICAgICAgLy8gSWYgdGhlcmUgYXJlIG1vcmUgbWV0aG9kcyBzZXQgdGhlIHJlYXNvbiBhcyBhbiBhdHRyIG9uIHRoZSBtb2RlbCBpbnN0ZWFkLCBhbmQgdXBkYXRlIHRoYXQgYXR0ciBiYXNlZCBvbiBzdGF0ZVxuICAgICAgICAgIHJldHVybiAnU2VsZWN0IGEgY29sdW1uIG9mIHR5cGUgbnVtYmVyIHRvIHVzZSB0aGlzIG1lcmdlIG1ldGhvZCc7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5hZGRWaWV3KHRoaXMuX3Rvb2x0aXApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fdG9vbHRpcDtcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpzZWxlY3RlZCcsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpkaXNhYmxlZCcsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgfSxcblxuICBfb25Ib3ZlcjogZnVuY3Rpb24oZXYpIHtcbiAgICB0aGlzLmtpbGxFdmVudChldik7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdkaXNhYmxlZCcpKSB7XG4gICAgICB0aGlzLl90b29sdGlwLnNob3dUaXBzeSgpO1xuICAgIH1cbiAgfSxcblxuICBfb25Nb3VzZU91dDogZnVuY3Rpb24oZXYpIHtcbiAgICB0aGlzLmtpbGxFdmVudChldik7XG4gICAgaWYgKHRoaXMuX3Rvb2x0aXApIHtcbiAgICAgIHRoaXMuX3Rvb2x0aXAuaGlkZVRpcHN5KCk7XG4gICAgfVxuICB9LFxuXG4gIF9vbkNsaWNrOiBmdW5jdGlvbihldikge1xuICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICBpZiAoIXRoaXMubW9kZWwuZ2V0KCdkaXNhYmxlZCcpKSB7XG4gICAgICB0aGlzLm1vZGVsLnNldCgnc2VsZWN0ZWQnLCB0cnVlKTtcbiAgICB9XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcblxuLyoqXG4gKiBNZXJnZSBtZXRob2QgdG8gY3JlYXRlIFNRTCBxdWVyeSBmb3IgZG9pbmcgYSBzcGF0aWFsIEFWRy5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5Nb2RlbC5leHRlbmQoe1xuXG4gIE5BTUU6ICdhdmcnLFxuXG4gIGRlZmF1bHRzOiB7XG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIHNlbGVjdGVkOiBmYWxzZVxuICB9LFxuXG4gIGNoYW5nZWRNZXJnZUNvbHVtbjogZnVuY3Rpb24obmV3TWVyZ2VDb2x1bW4pIHtcbiAgICB2YXIgc2hvdWxkRGlzYWJsZSA9ICFuZXdNZXJnZUNvbHVtbiB8fCBuZXdNZXJnZUNvbHVtbi5nZXQoJ3R5cGUnKSAhPT0gJ251bWJlcic7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgZGlzYWJsZWQ6IHNob3VsZERpc2FibGUsXG4gICAgICBzZWxlY3RlZDogdGhpcy5nZXQoJ3NlbGVjdGVkJykgJiYgIXNob3VsZERpc2FibGVcbiAgICB9KTtcbiAgfSxcblxuICBzcWxTZWxlY3RDbGF1c2U6IGZ1bmN0aW9uKHRhYmxlTmFtZSwgY29sdW1uTmFtZSkge1xuICAgIHJldHVybiAnQVZHKCcgKyB0YWJsZU5hbWUgKyAnLicgKyBjb2x1bW5OYW1lICsgJyknO1xuICB9XG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqIE1lcmdlIG1ldGhvZCB0byBjcmVhdGUgU1FMIHF1ZXJ5IGZvciBkb2luZyBhIHNwYXRpYWwgY291bnQuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBOQU1FOiAnY291bnQnLFxuXG4gIGRlZmF1bHRzOiB7XG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIHNlbGVjdGVkOiBmYWxzZVxuICB9LFxuXG4gIGNoYW5nZWRNZXJnZUNvbHVtbjogZnVuY3Rpb24obmV3TWVyZ2VDb2x1bW4pIHtcbiAgfSxcblxuICBzcWxTZWxlY3RDbGF1c2U6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAnQ09VTlQoKiknO1xuICB9XG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqIE1lcmdlIG1ldGhvZCB0byBjcmVhdGUgU1FMIHF1ZXJ5IGZvciBkb2luZyBhIHNwYXRpYWwgc3VtLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgTkFNRTogJ3N1bScsXG5cbiAgZGVmYXVsdHM6IHtcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgc2VsZWN0ZWQ6IGZhbHNlXG4gIH0sXG5cbiAgY2hhbmdlZE1lcmdlQ29sdW1uOiBmdW5jdGlvbihuZXdNZXJnZUNvbHVtbikge1xuICAgIHZhciBzaG91bGREaXNhYmxlID0gIW5ld01lcmdlQ29sdW1uIHx8IG5ld01lcmdlQ29sdW1uLmdldCgndHlwZScpICE9PSAnbnVtYmVyJztcbiAgICB0aGlzLnNldCh7XG4gICAgICBkaXNhYmxlZDogc2hvdWxkRGlzYWJsZSxcbiAgICAgIHNlbGVjdGVkOiB0aGlzLmdldCgnc2VsZWN0ZWQnKSAmJiAhc2hvdWxkRGlzYWJsZVxuICAgIH0pO1xuICB9LFxuXG4gIHNxbFNlbGVjdENsYXVzZTogZnVuY3Rpb24odGFibGVOYW1lLCBjb2x1bW5OYW1lKSB7XG4gICAgcmV0dXJuICdTVU0oJyArIHRhYmxlTmFtZSArICcuJyArIGNvbHVtbk5hbWUgKyAnKSc7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBDaG9vc2VSaWdodERhdGFzZXRNb2RlbCA9IHJlcXVpcmUoJy4vY2hvb3NlX3JpZ2h0X2RhdGFzZXRfbW9kZWwnKTtcblxuLyoqXG4gKiBFbnRyeSBwb2ludCBtb2RlbCB0aGF0IHJlcHJlc2VudHMgdGhlIG1lcmdlIGZsYXZvciBvZiBkb2luZyBhIHNwYXRpYWwgbWVyZ2UuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBJTExVU1RSQVRJT05fSUNPTl9UWVBFOiAnSWxsdXN0cmF0aW9uSWNvbi0tcm95YWwnLFxuICBJQ09OOiAnQ0RCLUljb25Gb250LW1lcmdlU3BhdGlhbCcsXG4gIFRJVExFOiAnU3BhdGlhbCBqb2luJyxcbiAgREVTQzogJ01lYXN1cmUgdGhlIG51bWJlciBvZiBpbnRlc2VjdGluZyByZWNvcmRzIGJldHdlZW4gdHdvIGRhdGFzZXRzIChleC4gY291bnQgcG9pbnQgaW5zaWRlIHBvbHlnb25zKScsXG5cbiAgZGVmYXVsdHM6IHtcbiAgICB1c2VyOiB1bmRlZmluZWQsXG4gICAgdGFibGU6IHVuZGVmaW5lZCxcbiAgICBleGNsdWRlQ29sdW1uczogW11cbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbihhdHRycykge1xuICAgIGlmICghYXR0cnMudXNlcikgdGhyb3cgbmV3IEVycm9yKCd1c2VyIGlzIHJlcXVpcmVkJyk7XG4gICAgaWYgKCFhdHRycy50YWJsZSkgdGhyb3cgbmV3IEVycm9yKCd0YWJsZSBpcyByZXF1aXJlZCcpO1xuICAgIGlmICghYXR0cnMuZXhjbHVkZUNvbHVtbnMgfHwgXy5pc0VtcHR5KGF0dHJzLmV4Y2x1ZGVDb2x1bW5zKSkgY2RiLmxvZy5lcnJvcignZXhjbHVkZUNvbHVtbnMgd2FzIGVtcHR5Jyk7XG4gIH0sXG5cbiAgaXNBdmFpbGFibGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIGZpcnN0U3RlcDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBDaG9vc2VSaWdodERhdGFzZXRNb2RlbCh7XG4gICAgICB1c2VyOiB0aGlzLmdldCgndXNlcicpLFxuICAgICAgbGVmdFRhYmxlOiB0aGlzLmdldCgndGFibGUnKSxcbiAgICAgIGV4Y2x1ZGVDb2x1bW5zOiB0aGlzLmdldCgnZXhjbHVkZUNvbHVtbnMnKVxuICAgIH0pO1xuICB9XG5cbn0pO1xuIiwidmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIENvbHVtbnNTZWxlY3RvclZpZXcgPSByZXF1aXJlKCcuLi9jb2x1bW5zX3NlbGVjdG9yX3ZpZXcnKTtcbnZhciBUYWJsZXNTZWxlY3RvclZpZXcgPSByZXF1aXJlKCcuLi90YWJsZXNfc2VsZWN0b3JfdmlldycpO1xudmFyIE1lcmdlTWV0aG9kVmlldyA9IHJlcXVpcmUoJy4vbWVyZ2VfbWV0aG9kX3ZpZXcnKTtcbnZhciBTdGlja3lIZWFkZXJWaWV3ID0gcmVxdWlyZSgnLi4vc3RpY2t5X2hlYWRlcl92aWV3Jyk7XG52YXIgRm9vdGVyVmlldyA9IHJlcXVpcmUoJy4uL2Zvb3Rlcl92aWV3Jyk7XG52YXIgRm9vdGVySW5mb1ZpZXcgPSByZXF1aXJlKCcuL2Zvb3Rlcl9pbmZvX3ZpZXcnKTtcblxuLyoqXG4gKiBTaGFyZWQgdmlldyBmb3IgYm90aCBzdGVwcyBvZiBkb2luZyBhIHNwYXRpYWwgbWVyZ2UsIHNpbmNlIHRoZXkgYXJlIGVzc2VudGlhbGx5IHRoZSBzYW1lXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGhhc1NlbGVjdGVkUmlnaHRUYWJsZSA9IHRoaXMuX2hhc1NlbGVjdGVkUmlnaHRUYWJsZSgpO1xuXG4gICAgdmFyICRlbCA9ICQoXG4gICAgICB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9zcGF0aWFsX21lcmdlL3NwYXRpYWxfbWVyZ2UnKSh7XG4gICAgICAgIGxlZnRLZXlDb2x1bW46IHRoaXMubW9kZWwuZ2V0KCdsZWZ0S2V5Q29sdW1uJyksXG4gICAgICAgIGhhc1NlbGVjdGVkUmlnaHRUYWJsZTogaGFzU2VsZWN0ZWRSaWdodFRhYmxlLFxuICAgICAgICByaWdodEtleUNvbHVtbjogdGhpcy5tb2RlbC5nZXQoJ3JpZ2h0S2V5Q29sdW1uJyksXG4gICAgICAgIHJpZ2h0Q29sdW1uczogdGhpcy5tb2RlbC5nZXQoJ3JpZ2h0Q29sdW1ucycpXG4gICAgICB9KVxuICAgICk7XG5cbiAgICAkZWwuZmluZCgnLmpzLWxlZnQtdGFibGUnKS5hcHBlbmQodGhpcy5fbGVmdFRhYmxlQ29tYm9WaWV3LnJlbmRlcigpLiRlbCk7XG4gICAgJGVsLmZpbmQoJy5qcy1sZWZ0LWNvbHVtbnMnKS5hcHBlbmQodGhpcy5fbGVmdENvbHVtbnNWaWV3LnJlbmRlcigpLiRlbCk7XG4gICAgJGVsLmZpbmQoJy5qcy1yaWdodC1jb2x1bW5zJykuYXBwZW5kKHRoaXMuX3JpZ2h0Q29sdW1uc1ZpZXcucmVuZGVyKCkuJGVsKTtcbiAgICAkZWwuYXBwZW5kKHRoaXMuX2Zvb3RlclZpZXcucmVuZGVyKCkuJGVsKTtcblxuICAgIGlmIChoYXNTZWxlY3RlZFJpZ2h0VGFibGUpIHtcbiAgICAgICRlbC5maW5kKCcuanMtc3RpY2t5LWhlYWRlcicpLmFwcGVuZCh0aGlzLl9zdGlja3lIZWFkZXJWaWV3LnJlbmRlcigpLiRlbCk7XG4gICAgICAkZWwuZmluZCgnLmpzLXJpZ2h0LXRhYmxlJykuYXBwZW5kKHRoaXMuX3JpZ2h0VGFibGVDb21ib1ZpZXcucmVuZGVyKCkuJGVsKTtcbiAgICAgIHRoaXMuX3JlbmRlck1lcmdlTWV0aG9kcygkZWwuZmluZCgnLmpzLW1lcmdlLW1ldGhvZHMnKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICRlbC5maW5kKCcuanMtcmlnaHQtdGFibGVzJykuYXBwZW5kKHRoaXMuX3JpZ2h0VGFibGVzU2VsZWN0b3JWaWV3LnJlbmRlcigpLiRlbCk7XG4gICAgfVxuXG4gICAgdGhpcy4kZWwuaHRtbCgkZWwpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgb25DaGFuZ2VLZXlDb2x1bW5zVmlzaWJsaXR5OiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5faGFzU2VsZWN0ZWRSaWdodFRhYmxlKCkpIHtcbiAgICAgIHRoaXMuX3N0aWNreUhlYWRlclZpZXcuJGVsLnNsaWRlVG9nZ2xlKDIwMCk7XG4gICAgfVxuICB9LFxuXG4gIF9oYXNTZWxlY3RlZFJpZ2h0VGFibGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBfLmlzT2JqZWN0KHRoaXMubW9kZWwuZ2V0KCdyaWdodFRhYmxlRGF0YScpKTtcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9sZWZ0VGFibGVDb21ib1ZpZXcgPSBuZXcgY2RiLmZvcm1zLkNvbWJvKHtcbiAgICAgIGNsYXNzTmFtZTogJ1NlbGVjdCcsXG4gICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgZGlzYWJsZWQ6IHRydWUsXG4gICAgICBleHRyYTogW3RoaXMubW9kZWwuZ2V0KCdsZWZ0VGFibGUnKS5nZXQoJ25hbWUnKV1cbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fbGVmdFRhYmxlQ29tYm9WaWV3KTtcblxuICAgIHRoaXMuX2xlZnRDb2x1bW5zVmlldyA9IG5ldyBDb2x1bW5zU2VsZWN0b3JWaWV3KHtcbiAgICAgIGNvbGxlY3Rpb246IHRoaXMubW9kZWwuZ2V0KCdsZWZ0Q29sdW1ucycpLFxuICAgICAgZXhjbHVkZUZpbHRlcjogdGhpcy5fY29sdW1uc0V4Y2x1ZGVGaWx0ZXIsXG4gICAgICBzZWxlY3RvclR5cGU6ICdzd2l0Y2gnXG4gICAgfSk7XG4gICAgdGhpcy5hZGRWaWV3KHRoaXMuX2xlZnRDb2x1bW5zVmlldyk7XG5cbiAgICB2YXIgZm9vdGVySW5mb1ZpZXc7IC8vIG9ubHkgc2V0IGZvciAybmQgc3RlcFxuICAgIHZhciByaWdodFRhYmxlRGF0YSA9IHRoaXMubW9kZWwuZ2V0KCdyaWdodFRhYmxlRGF0YScpO1xuICAgIGlmIChyaWdodFRhYmxlRGF0YSkge1xuICAgICAgdGhpcy5fc3RpY2t5SGVhZGVyVmlldyA9IG5ldyBTdGlja3lIZWFkZXJWaWV3KHtcbiAgICAgICAgbGVmdEtleUNvbHVtbjogdGhpcy5tb2RlbC5nZXQoJ2xlZnRLZXlDb2x1bW4nKSxcbiAgICAgICAgcmlnaHRLZXlDb2x1bW46IHRoaXMubW9kZWwuZ2V0KCdyaWdodEtleUNvbHVtbicpLFxuICAgICAgICBhZGRSYWRpb1BsYWNlaG9sZGVyOiB0cnVlXG4gICAgICB9KTtcbiAgICAgIHRoaXMuYWRkVmlldyh0aGlzLl9zdGlja3lIZWFkZXJWaWV3KTtcblxuICAgICAgdGhpcy5fcmlnaHRUYWJsZUNvbWJvVmlldyA9IG5ldyBjZGIuZm9ybXMuQ29tYm8oe1xuICAgICAgICBjbGFzc05hbWU6ICdTZWxlY3QnLFxuICAgICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgICBkaXNhYmxlZDogdHJ1ZSxcbiAgICAgICAgZXh0cmE6IFt0aGlzLm1vZGVsLmdldCgncmlnaHRUYWJsZURhdGEnKS5uYW1lXVxuICAgICAgfSk7XG4gICAgICB0aGlzLmFkZFZpZXcodGhpcy5fcmlnaHRUYWJsZUNvbWJvVmlldyk7XG4gICAgICBmb290ZXJJbmZvVmlldyA9IG5ldyBGb290ZXJJbmZvVmlldyh7XG4gICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsXG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9yaWdodFRhYmxlc1NlbGVjdG9yVmlldyA9IG5ldyBUYWJsZXNTZWxlY3RvclZpZXcoe1xuICAgICAgICBleGNsdWRlRmlsdGVyOiB0aGlzLl9yaWdodFRhYmxlc0V4Y2x1ZGVGaWx0ZXIuYmluZCh0aGlzKSxcbiAgICAgICAgaW5pdGlhbE9wdGlvbjoge1xuICAgICAgICAgIGxhYmVsOiByaWdodFRhYmxlRGF0YSA/IHJpZ2h0VGFibGVEYXRhLm5hbWUgOiAnU2VsZWN0IGRhdGFzZXQnXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5hZGRWaWV3KHRoaXMuX3JpZ2h0VGFibGVzU2VsZWN0b3JWaWV3KTtcbiAgICB9XG5cbiAgICB0aGlzLl9yaWdodENvbHVtbnNWaWV3ID0gbmV3IENvbHVtbnNTZWxlY3RvclZpZXcoe1xuICAgICAgY29sbGVjdGlvbjogdGhpcy5tb2RlbC5nZXQoJ3JpZ2h0Q29sdW1ucycpLFxuICAgICAgZXhjbHVkZUZpbHRlcjogdGhpcy5fY29sdW1uc0V4Y2x1ZGVGaWx0ZXIsXG4gICAgICBzZWxlY3RvclR5cGU6ICdyYWRpbydcbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fcmlnaHRDb2x1bW5zVmlldyk7XG5cbiAgICB0aGlzLl9tZXJnZU1ldGhvZFZpZXdzID0gdGhpcy5tb2RlbC5nZXQoJ21lcmdlTWV0aG9kcycpLm1hcCh0aGlzLl9jcmVhdGVNZXJnZU1ldGhvZFZpZXcsIHRoaXMpO1xuXG4gICAgdGhpcy5fZm9vdGVyVmlldyA9IG5ldyBGb290ZXJWaWV3KHtcbiAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLFxuICAgICAgbmV4dExhYmVsOiByaWdodFRhYmxlRGF0YSA/ICdNZXJnZSBkYXRhc2V0cycgOiB1bmRlZmluZWQsXG4gICAgICBpbmZvVmlldzogZm9vdGVySW5mb1ZpZXdcbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fZm9vdGVyVmlldyk7XG4gIH0sXG5cbiAgX2NyZWF0ZU1lcmdlTWV0aG9kVmlldzogZnVuY3Rpb24obSkge1xuICAgIHZhciB2aWV3ID0gbmV3IE1lcmdlTWV0aG9kVmlldyh7IG1vZGVsOiBtIH0pO1xuICAgIHRoaXMuYWRkVmlldyh2aWV3KTtcbiAgICByZXR1cm4gdmlldztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcmlnaHRDb2x1bW5zID0gdGhpcy5tb2RlbC5nZXQoJ3JpZ2h0Q29sdW1ucycpO1xuICAgIHJpZ2h0Q29sdW1ucy5iaW5kKCdjaGFuZ2U6c2VsZWN0ZWQnLCB0aGlzLl9vbkNoYW5nZVNlbGVjdGVkUmlnaHRDb2x1bW4sIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwocmlnaHRDb2x1bW5zKTtcblxuICAgIHZhciBtZXJnZU1ldGhvZHMgPSB0aGlzLm1vZGVsLmdldCgnbWVyZ2VNZXRob2RzJyk7XG4gICAgaWYgKG1lcmdlTWV0aG9kcykge1xuICAgICAgbWVyZ2VNZXRob2RzLmJpbmQoJ2NoYW5nZTpzZWxlY3RlZCcsIHRoaXMuX29uQ2hhbmdlU2VsZWN0ZWRNZXJnZU1ldGhvZCwgdGhpcyk7XG4gICAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKG1lcmdlTWV0aG9kcyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX3JpZ2h0VGFibGVzU2VsZWN0b3JWaWV3KSB7XG4gICAgICB0aGlzLl9yaWdodFRhYmxlc1NlbGVjdG9yVmlldy5tb2RlbC5iaW5kKCdjaGFuZ2U6dGFibGVEYXRhJywgdGhpcy5fb25DaGFuZ2VSaWdodFRhYmxlRGF0YSwgdGhpcyk7XG4gICAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMuX3JpZ2h0VGFibGVzU2VsZWN0b3JWaWV3Lm1vZGVsKTtcbiAgICB9XG4gIH0sXG5cbiAgX29uQ2hhbmdlUmlnaHRUYWJsZURhdGE6IGZ1bmN0aW9uKG0sIHRhYmxlRGF0YSkge1xuICAgIHRoaXMuX3JpZ2h0Q29sdW1uc1ZpZXcubW9kZWwuc2V0KCdsb2FkaW5nJywgJ2NvbHVtbnMnKTtcbiAgICB0aGlzLm1vZGVsLmZldGNoUmlnaHRDb2x1bW5zKHRhYmxlRGF0YSk7XG4gIH0sXG5cbiAgX29uQ2hhbmdlU2VsZWN0ZWRSaWdodENvbHVtbjogZnVuY3Rpb24obSwgaXNTZWxlY3RlZCkge1xuICAgIGlmIChpc1NlbGVjdGVkKSB7XG4gICAgICB0aGlzLm1vZGVsLmNoYW5nZWRSaWdodE1lcmdlQ29sdW1uKG0pO1xuICAgIH1cbiAgfSxcblxuICBfb25DaGFuZ2VTZWxlY3RlZE1lcmdlTWV0aG9kOiBmdW5jdGlvbihtLCBpc1NlbGVjdGVkKSB7XG4gICAgaWYgKCFpc1NlbGVjdGVkKSByZXR1cm47XG5cbiAgICB0aGlzLm1vZGVsLmNoYW5nZWRTZWxlY3RlZE1lcmdlTWV0aG9kKG0pO1xuXG4gICAgdmFyIGlzQ291bnRNZXJnZU1ldGhvZCA9IHRoaXMubW9kZWwuaXNDb3VudE1lcmdlTWV0aG9kKG0pO1xuICAgIHRoaXMuJCgnLmpzLWNvdW50LW1lcmdlLW1ldGhvZC1pbmZvJykudG9nZ2xlKGlzQ291bnRNZXJnZU1ldGhvZCk7XG4gICAgdGhpcy4kKCcuanMtcmlnaHQtY29sdW1ucycpLnRvZ2dsZSghaXNDb3VudE1lcmdlTWV0aG9kKTtcbiAgfSxcblxuICBfcmVuZGVyTWVyZ2VNZXRob2RzOiBmdW5jdGlvbigkdGFyZ2V0KSB7XG4gICAgJHRhcmdldC5hcHBlbmQuYXBwbHkoJHRhcmdldCwgdGhpcy5fJHJlbmRlcmVkTWVyZ2VNZXRob2RWaWV3cygpKTtcbiAgfSxcblxuICBfJHJlbmRlcmVkTWVyZ2VNZXRob2RWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIF8ubWFwKHRoaXMuX21lcmdlTWV0aG9kVmlld3MsIGZ1bmN0aW9uKHZpZXcpIHtcbiAgICAgIHJldHVybiB2aWV3LnJlbmRlcigpLiRlbDtcbiAgICB9KTtcbiAgfSxcblxuICBfY29sdW1uc0V4Y2x1ZGVGaWx0ZXI6IGZ1bmN0aW9uKGNvbHVtbikge1xuICAgIHJldHVybiBjb2x1bW4uZ2V0KCduYW1lJykgPT09ICd0aGVfZ2VvbSc7XG4gIH0sXG5cbiAgX3JpZ2h0VGFibGVzRXhjbHVkZUZpbHRlcjogZnVuY3Rpb24odmlzKSB7XG4gICAgcmV0dXJuIHZpcy5nZXQoJ25hbWUnKSA9PT0gdGhpcy5tb2RlbC5nZXQoJ2xlZnRUYWJsZScpLmdldCgnbmFtZScpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogU3RpY2t5IGhlYWRlciwgc2hvdWxkIGJlIGRpc3BsYXllZCB3aGVuIHRoZSBrZXkgY29sdW1ucyBnb2VzIG91dCBvZiB2aWV3XG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ01lcmdlRGF0YXNldHMtc3RpY2t5SGVhZGVyJyxcbiAgYXR0cmlidXRlczoge1xuICAgIHN0eWxlOiAnZGlzcGxheTogbm9uZSdcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBsZWZ0S2V5Q29sdW1uID0gdGhpcy5vcHRpb25zLmxlZnRLZXlDb2x1bW47XG4gICAgdmFyIHJpZ2h0S2V5Q29sdW1uID0gdGhpcy5vcHRpb25zLnJpZ2h0S2V5Q29sdW1uO1xuXG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIHRoaXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL21lcmdlX2RhdGFzZXRzL3N0aWNreV9oZWFkZXInKSh7XG4gICAgICAgIGxlZnRDb2x1bW5OYW1lOiBsZWZ0S2V5Q29sdW1uLmdldCgnbmFtZScpLFxuICAgICAgICBsZWZ0Q29sdW1uVHlwZTogbGVmdEtleUNvbHVtbi5nZXQoJ3R5cGUnKSxcbiAgICAgICAgcmlnaHRDb2x1bW5OYW1lOiByaWdodEtleUNvbHVtbi5nZXQoJ25hbWUnKSxcbiAgICAgICAgcmlnaHRDb2x1bW5UeXBlOiByaWdodEtleUNvbHVtbi5nZXQoJ3R5cGUnKSxcbiAgICAgICAgYWRkUmFkaW9QbGFjZWhvbGRlcjogdGhpcy5vcHRpb25zLmFkZFJhZGlvUGxhY2Vob2xkZXJcbiAgICAgIH0pXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxufSk7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqIFZpZXcgdG8gc2VsZWN0IGEgdGFibGUuIGV4dGVuZHMgdGhlIGNkYi5hZG1pbi5Db21ibyB0byBoYW5kbGUgdGhlIHRhYmxlcyBmZXRjaCBhbmQgc2ltaWxhci5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuZm9ybXMuQ29tYm8uZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdTZWxlY3QnLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMub3B0aW9ucy53aWR0aCA9ICcxMDAlJztcbiAgICB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgPSB0cnVlO1xuICAgIHRoaXMub3B0aW9ucy5leHRyYSA9IFt0aGlzLl9pbml0aWFsT3B0aW9uRGF0YUl0ZW0oKSB8fCAnTG9hZGluZyB0YWJsZXPigKYnXTtcbiAgICB0aGlzLm9wdGlvbnMuZXhjbHVkZUZpbHRlciA9IHRoaXMub3B0aW9ucy5leGNsdWRlRmlsdGVyIHx8IGZ1bmN0aW9uKCkge307XG5cbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy5tb2RlbCA9IHRoaXMubW9kZWwgfHwgbmV3IGNkYi5jb3JlLk1vZGVsKCk7XG5cbiAgICB0aGlzLl9pbml0VmlzdWFsaXphdGlvbnMoKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICB0aGlzLl9mZXRjaFRhYmxlcygpO1xuICB9LFxuXG4gIF9mb3JtYXRSZXN1bHQ6IGZ1bmN0aW9uKHN0YXRlKSB7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHN0YXRlKTtcbiAgfSxcblxuICBfaW5pdFZpc3VhbGl6YXRpb25zOiBmdW5jdGlvbigpIHtcbiAgICAvLyBUYWtlbiBmcm9tIG9sZCBjb2RlLCBjZGIuYWRtaW4uVGFibGVDb2x1bW5TZWxlY3Rvci5fZ2V0VGFibGVzXG4gICAgdmFyIHZpc3VhbGl6YXRpb25zID0gbmV3IGNkYi5hZG1pbi5WaXN1YWxpemF0aW9ucygpO1xuICAgIHZpc3VhbGl6YXRpb25zLm9wdGlvbnMuc2V0KHtcbiAgICAgIHR5cGU6ICd0YWJsZScsXG4gICAgICBwZXJfcGFnZTogMTAwMDAwLFxuICAgICAgdGFibGVfZGF0YTogZmFsc2VcbiAgICB9KTtcbiAgICB0aGlzLm1vZGVsLnNldCgndmlzdWFsaXphdGlvbnMnLCB2aXN1YWxpemF0aW9ucyk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5iaW5kKCdjaGFuZ2UnLCB0aGlzLl9vbkNoYW5nZU9wdGlvbiwgdGhpcyk7XG5cbiAgICB2YXIgdmlzdWFsaXphdGlvbnMgPSB0aGlzLm1vZGVsLmdldCgndmlzdWFsaXphdGlvbnMnKTtcbiAgICB2aXN1YWxpemF0aW9ucy5iaW5kKCdyZXNldCcsIHRoaXMuX29uUmVzZXRUYWJsZXMsIHRoaXMpO1xuICAgIHRoaXMuYWRkX3JlbGF0ZWRfbW9kZWwodmlzdWFsaXphdGlvbnMpO1xuICB9LFxuXG4gIF9mZXRjaFRhYmxlczogZnVuY3Rpb24oKSB7XG4gICAgLy8gVGFrZW4gZnJvbSBvbGQgY29kZSwgY2RiLmFkbWluLlRhYmxlQ29sdW1uU2VsZWN0b3IuX2dldFRhYmxlc1xuICAgIHRoaXMubW9kZWwuZ2V0KCd2aXN1YWxpemF0aW9ucycpLmZldGNoKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgbzoge1xuICAgICAgICAgIHVwZGF0ZWRfYXQ6ICdkZXNjJ1xuICAgICAgICB9LFxuICAgICAgICBleGNsdWRlX3Jhc3RlcjogdHJ1ZVxuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIF9vblJlc2V0VGFibGVzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgPSBmYWxzZTtcblxuICAgIHZhciBmaWx0ZXJlZFZpc3VhbGl6YXRpb25zID0gdGhpcy5tb2RlbC5nZXQoJ3Zpc3VhbGl6YXRpb25zJykucmVqZWN0KHRoaXMub3B0aW9ucy5leGNsdWRlRmlsdGVyKTtcbiAgICB2YXIgbmV3RGF0YSA9IF8ubWFwKGZpbHRlcmVkVmlzdWFsaXphdGlvbnMsIHRoaXMuX3Zpc1RvQ29tYm9EYXRhSXRlbSwgdGhpcyk7XG5cbiAgICAvLyBQcmVwZW5kIGluaXRpYWwgaXRlbSB0byBuZXcgZGF0YSwgaWYgdGhlcmUncyBvbmVcbiAgICB2YXIgaW5pdGlhbEl0ZW0gPSB0aGlzLl9pbml0aWFsT3B0aW9uRGF0YUl0ZW0oKTtcbiAgICBpZiAoaW5pdGlhbEl0ZW0pIHtcbiAgICAgIG5ld0RhdGEudW5zaGlmdChpbml0aWFsSXRlbSk7XG4gICAgfVxuICAgIHRoaXMudXBkYXRlRGF0YShuZXdEYXRhKTtcblxuICAgIC8vIHByZS1zZWxlY3QgMXN0IGl0ZW0sIHVubGVzcyB0aGVyZSdzIGFuIGluaXRpYWxPcHRpb25cbiAgICB2YXIgZmlyc3RGaWx0ZXJlZFZpcyA9IGZpbHRlcmVkVmlzdWFsaXphdGlvbnNbMF07XG4gICAgaWYgKCFpbml0aWFsSXRlbSAmJiBmaXJzdEZpbHRlcmVkVmlzKSB7XG4gICAgICB0aGlzLl9vbkNoYW5nZU9wdGlvbihmaXJzdEZpbHRlcmVkVmlzLmlkKTtcbiAgICB9XG4gIH0sXG5cbiAgX3Zpc1RvQ29tYm9EYXRhSXRlbTogZnVuY3Rpb24odmlzKSB7XG4gICAgLy8gcmVxdWlyZWQgZGF0YSBmb3JtYXQgZm9yIGFuIG9wdGlvbiBmb3IgdGhlIGNkYi5hZG1pbi5jb21ib+KAplxuICAgIHJldHVybiB0aGlzLl9jb21ib0RhdGFJdGVtKHZpcy5nZXQoJ25hbWUnKSwgdmlzLmlkKTtcbiAgfSxcblxuICBfaW5pdGlhbE9wdGlvbkRhdGFJdGVtOiBmdW5jdGlvbigpIHtcbiAgICBpZiAoXy5pc09iamVjdCh0aGlzLm9wdGlvbnMuaW5pdGlhbE9wdGlvbikpIHtcbiAgICAgIHZhciBvYmogPSB0aGlzLm9wdGlvbnMuaW5pdGlhbE9wdGlvbjtcbiAgICAgIC8vIHJlcXVpcmVkIGRhdGEgZm9ybWF0IGZvciBhbiBvcHRpb24gZm9yIHRoZSBjZGIuYWRtaW4uY29tYm/igKZcbiAgICAgIHJldHVybiB0aGlzLl9jb21ib0RhdGFJdGVtKG9iai5sYWJlbCwgb2JqLnZhbHVlKTtcbiAgICB9XG4gIH0sXG5cbiAgX2NvbWJvRGF0YUl0ZW06IGZ1bmN0aW9uKGxhYmVsLCB2YWx1ZSkge1xuICAgIHJldHVybiBbbGFiZWwsIHZhbHVlXTtcbiAgfSxcblxuICBfb25DaGFuZ2VPcHRpb246IGZ1bmN0aW9uKHZpc0lkKSB7XG4gICAgdmFyIHZpcyA9IHRoaXMubW9kZWwuZ2V0KCd2aXN1YWxpemF0aW9ucycpLmdldCh2aXNJZCk7XG4gICAgdGhpcy5tb2RlbC5zZXQoJ3RhYmxlRGF0YScsIHZpcyA/IHZpcy5nZXQoJ3RhYmxlJykgOiB1bmRlZmluZWQpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBVdGlscyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXVsnVXRpbHMnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddWydVdGlscyddIDogbnVsbCk7XG52YXIgUGVjYW4gPSByZXF1aXJlKCdjYXJ0b2RiLXBlY2FuJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIF9DQVJEX1dJRFRIOiAyODgsXG4gIF9DQVJEX0hFSUdIVDogMTcwLFxuICBfVEFCU19QRVJfUk9XOiAzLFxuICBfR0VUX0JCT1hfRlJPTV9USEVfR0VPTTogdHJ1ZSxcblxuICB0YWdOYW1lOiBcImxpXCIsXG4gIGNsYXNzTmFtZTogXCJHYWxsZXJ5TGlzdC1pdGVtIE1hcHNMaXN0LWl0ZW0ganMtY2FyZFwiLFxuXG4gIGV2ZW50czoge1xuICAgIFwiY2xpY2sgXCI6IFwiX29uQ2xpY2tcIlxuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9wZWNhbi9jYXJkJyk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3JjID0gdGhpcy5vcHRpb25zLnVybCArIFwiP2FwaV9rZXk9XCIgKyB0aGlzLm9wdGlvbnMuYXBpX2tleTtcblxuICAgIHZhciB3aXphcmROYW1lID0gdGhpcy5tb2RlbC5nZXQoXCJ2aXN1YWxpemF0aW9uVHlwZVwiKS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMubW9kZWwuZ2V0KFwidmlzdWFsaXphdGlvblR5cGVcIikuc2xpY2UoMSk7XG5cbiAgICB2YXIgbnVsbF9jb3VudCA9ICsodGhpcy5tb2RlbC5nZXQoXCJudWxsX3JhdGlvXCIpICogdGhpcy5tb2RlbC5nZXQoXCJjb3VudFwiKSkudG9GaXhlZCgyKTtcbiAgICB2YXIgcHJldHR5TnVsbENvdW50ID0gVXRpbHMuZm9ybWF0TnVtYmVyKG51bGxfY291bnQpO1xuXG4gICAgdGhpcy4kZWwuaHRtbChcbiAgICAgIHRoaXMudGVtcGxhdGUoe1xuICAgICAgY29sdW1uOiB0aGlzLm1vZGVsLmdldChcImNvbHVtblwiKSxcbiAgICAgIHdpemFyZDogd2l6YXJkTmFtZSxcbiAgICAgIG1ldGFkYXRhOiB0aGlzLm1vZGVsLmdldChcIm1ldGFkYXRhXCIpLFxuICAgICAgbnVsbF9jb3VudDogcHJldHR5TnVsbENvdW50LFxuICAgICAgd2VpZ2h0OiB0aGlzLm1vZGVsLmdldChcIndlaWdodFwiKVxuICAgIH0pKTtcblxuICAgIGlmICh0aGlzLm1vZGVsLmdldChcInZpc3VhbGl6YXRpb25UeXBlXCIpID09PSBcImNob3JvcGxldGhcIikge1xuICAgICAgdGhpcy5fYWRkSGlzdG9ncmFtKCk7XG4gICAgfVxuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICBpbWcub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgY2RiLmxvZy5pbmZvKFwiZXJyb3IgbG9hZGluZyB0aGUgaW1hZ2UgZm9yIFwiICsgc2VsZi5tb2RlbC5nZXQoXCJjb2x1bW5cIikpO1xuICAgIH07XG4gICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi4kKFwiLmpzLWxvYWRlclwiKS5oaWRlKCk7XG4gICAgICBzZWxmLiQoXCIuanMtaGVhZGVyXCIpLmFwcGVuZCgnPGltZyBjbGFzcz1cIk1hcENhcmQtcHJldmlld1wiIHNyYz1cIicgKyBzcmMgKyAnXCIgLz4nKTtcbiAgICAgIHNlbGYuJChcImltZ1wiKS5zaG93KCk7XG4gICAgfTtcblxuICAgIGltZy5zcmMgPSBzcmM7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfb25DbGljazogZnVuY3Rpb24oZSkge1xuICAgIHRoaXMua2lsbEV2ZW50KGUpO1xuICAgIHRoaXMudHJpZ2dlcihcImNsaWNrXCIsIHRoaXMubW9kZWwsIHRoaXMpO1xuICB9LFxuXG4gIF9hZGRIaXN0b2dyYW06IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkYXRhID0gdGhpcy5tb2RlbC5nZXQoXCJjYXRfaGlzdFwiKS5zbGljZSgwLCA3KTtcbiAgICBkYXRhID0gXy5zb3J0QnkoZGF0YSwgZnVuY3Rpb24oZCl7IHJldHVybiBkWzBdOyB9KTtcbiAgICB2YXIgcmFtcE5hbWUgPSBQZWNhbi5nZXRNZXRob2RQcm9wZXJ0aWVzKHRoaXMubW9kZWwuYXR0cmlidXRlcykubmFtZTtcblxuICAgIHZhciB3aWR0aCA9IDM3O1xuICAgIHZhciBoZWlnaHQgPSAxMTtcbiAgICB2YXIgbWluSGVpZ2h0ID0gMjtcblxuICAgIHZhciB4ID0gZDMuc2NhbGUub3JkaW5hbCgpXG4gICAgICAgIC5yYW5nZVJvdW5kQmFuZHMoWzAsIHdpZHRoXSwgLjEpO1xuXG4gICAgdmFyIHkgPSBkMy5zY2FsZS5saW5lYXIoKVxuICAgICAgICAucmFuZ2UoW2hlaWdodCwgMF0pO1xuXG4gICAgdmFyIHhBeGlzID0gZDMuc3ZnLmF4aXMoKVxuICAgICAgICAuc2NhbGUoeClcbiAgICAgICAgLm9yaWVudChcImJvdHRvbVwiKTtcblxuICAgIHZhciBzdmcgPSBkMy5zZWxlY3QodGhpcy4kKFwiLmpzLWdyYXBoXCIpWzBdKS5hcHBlbmQoXCJzdmdcIilcbiAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aClcbiAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0KVxuICAgICAgLmFwcGVuZChcImdcIik7XG5cbiAgICB4LmRvbWFpbihkYXRhLm1hcChmdW5jdGlvbihkKSB7IHJldHVybiBkWzBdOyB9KSk7XG4gICAgeS5kb21haW4oWzAsIGQzLm1heChkYXRhLCBmdW5jdGlvbihkKSB7IHJldHVybiBkWzFdOyB9KV0pO1xuXG4gICAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInggYXhpc1wiKVxuICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgaGVpZ2h0ICsgXCIpXCIpXG4gICAgICAgIC5jYWxsKHhBeGlzKTtcblxuICAgIHN2Zy5zZWxlY3RBbGwoXCIuYmFyXCIpXG4gICAgICAgIC5kYXRhKGRhdGEpXG4gICAgICAuZW50ZXIoKS5hcHBlbmQoXCJyZWN0XCIpXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLCBmdW5jdGlvbihkLCBpKSB7XG4gICAgICAgICAgcmV0dXJuIGNkYi5hZG1pbi5jb2xvcl9yYW1wc1tyYW1wTmFtZV1bN11baV07XG4gICAgICAgIH0pXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJIaXN0b2dyYW1HcmFwaC1iYXJcIilcbiAgICAgICAgLmF0dHIoJ2RhdGEtdGl0bGUnLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgcmV0dXJuIFV0aWxzLmZvcm1hdE51bWJlcihkWzFdKVxuICAgICAgICB9KVxuICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geChkWzBdKTsgfSlcbiAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCA0KVxuICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgIHZhciB2YWx1ZSA9IGhlaWdodCAtIHkoZFsxXSk7XG4gICAgICAgICAgdmFyIHlQb3MgPSB5KGRbMV0pO1xuICAgICAgICAgIHJldHVybiB2YWx1ZSA8IG1pbkhlaWdodCA/IChoZWlnaHQgLSBtaW5IZWlnaHQpIDogeVBvcztcbiAgICAgICAgfSlcbiAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgIHZhciB2YWx1ZSA9IGhlaWdodCAtIHkoZFsxXSk7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlIDwgbWluSGVpZ2h0ID8gbWluSGVpZ2h0IDogdmFsdWU7XG4gICAgICAgIH0pXG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIFV0aWxzID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydVdGlscyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ1V0aWxzJ10gOiBudWxsKTtcbnZhciBQZWNhbiA9IHJlcXVpcmUoJ2NhcnRvZGItcGVjYW4nKTtcbnZhciBCYXNlRGlhbG9nID0gcmVxdWlyZSgnLi4vLi4vdmlld3MvYmFzZV9kaWFsb2cvdmlldycpO1xudmFyIFZpZXdGYWN0b3J5ID0gcmVxdWlyZSgnLi4vLi4vdmlld19mYWN0b3J5Jyk7XG52YXIgcmFuZG9tUXVvdGUgPSByZXF1aXJlKCcuLi8uLi92aWV3X2hlbHBlcnMvcmFuZG9tX3F1b3RlJyk7XG52YXIgUGVjYW5DYXJkID0gcmVxdWlyZSgnLi9wZWNhbl9jYXJkJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIF9DQVJEX01BUkdJTjogMjAsXG4gIF9DQVJEX1dJRFRIOiAyODgsXG4gIF9DQVJEX0hFSUdIVDogMTcwLFxuICBfU1RST0tFX1BYX0xJTUlUOiAwLjA0LFxuICBfVEFCU19QRVJfUk9XOiAzLFxuICBfR0VUX0JCT1hfRlJPTV9USEVfR0VPTTogdHJ1ZSxcbiAgX0RFRkFVTFRfQkFTRU1BUF9URU1QTEFURTogXCJodHRwOi8ve3N9LmJhc2VtYXBzLmNhcnRvY2RuLmNvbS9saWdodF9hbGwve3p9L3t4fS97eX0ucG5nXCIsXG4gIF9TVVBQT1JURURfQkFTRU1BUFM6IFtcImxpZ2h0X2FsbFwiLCBcImRhcmtfYWxsXCIsIFwibGlnaHRfbm9sYWJlbHNcIiwgXCJkYXJrX25vbGFiZWxzXCIsIFwiYmFzZS1hbnRpcXVlXCIsIFwiYmFzZS1mbGF0Ymx1ZVwiLCBcInRvbmVyXCIsIFwid2F0ZXJjb2xvclwiXSxcblxuICBldmVudHM6IEJhc2VEaWFsb2cuZXh0ZW5kRXZlbnRzKHtcbiAgICBcImNsaWNrIC5qcy1nb1ByZXZcIjogXCJfcHJldlBhZ2VcIixcbiAgICBcImNsaWNrIC5qcy1nb05leHRcIjogXCJfbmV4dFBhZ2VcIixcbiAgICBcImNsaWNrIC5qcy1za2lwXCIgIDogXCJjYW5jZWxcIlxuICB9KSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG5cbiAgICBpZiAoIXRoaXMub3B0aW9ucy52aXMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigndmlzIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLm9wdGlvbnMudXNlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCd1c2VyIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgdGhpcy5jb2x1bW5zID0gdGhpcy5vcHRpb25zLmNvbGxlY3Rpb247XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbCh0aGlzLmNvbGxlY3Rpb24pO1xuXG4gICAgdGhpcy5faW5pdE1vZGVscygpO1xuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICB9LFxuXG4gIHJlbmRlcl9jb250ZW50OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fcGFuZXMuZ2V0QWN0aXZlUGFuZSgpLnJlbmRlcigpLmVsO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgQmFzZURpYWxvZy5wcm90b3R5cGUucmVuZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2luaXRNb2RlbHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwgPSBuZXcgY2RiLmNvcmUuTW9kZWwoeyBwYWdlOiAxLCBtYXhQYWdlczogMCB9KTtcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcblxuICAgIF8uYmluZEFsbCh0aGlzLCBcIl9hZGRDYXJkXCIsIFwiX2dlbmVyYXRlVGh1bWJuYWlsXCIsIFwiX3JlZnJlc2hNYXBMaXN0XCIsIFwiX3NldFdpemFyZFByb3BlcnRpZXNcIik7XG5cbiAgICB0aGlzLnZpcyAgID0gdGhpcy5vcHRpb25zLnZpcztcbiAgICB0aGlzLm1hcCAgID0gdGhpcy52aXMubWFwO1xuICAgIHRoaXMudXNlciAgPSB0aGlzLm9wdGlvbnMudXNlcjtcblxuICAgIHRoaXMuX3BhbmVzID0gbmV3IGNkYi51aS5jb21tb24uVGFiUGFuZSh7XG4gICAgICBlbDogdGhpcy5lbFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRWaWV3KHRoaXMuX3BhbmVzKTtcblxuICAgIHRoaXMuX3BhbmVzLmFkZFRhYigndmlzJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL3BlY2FuL3RlbXBsYXRlJywge1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdhcHBseWluZycsXG4gICAgICBWaWV3RmFjdG9yeS5jcmVhdGVCeVRlbXBsYXRlKCdjb21tb24vdGVtcGxhdGVzL2xvYWRpbmcnLCB7XG4gICAgICAgIHRpdGxlOiAnQXBwbHlpbmcgc3R5bGXigKYnLFxuICAgICAgICBxdW90ZTogcmFuZG9tUXVvdGUoKVxuICAgICAgfSlcbiAgICApO1xuXG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdsb2FkaW5nJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycsIHtcbiAgICAgICAgdGl0bGU6ICdMb2FkaW5nIHByZXZpZXdz4oCmJyxcbiAgICAgICAgcXVvdGU6IHJhbmRvbVF1b3RlKClcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIHRoaXMuX2dldEJCb3goKTtcbiAgICB0aGlzLl9zZW5kT3BlblN0YXRzKCk7XG4gICAgdGhpcy5fbG9hZENhcmRzKCk7XG5cbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZTpwYWdlJywgdGhpcy5fbW92ZVRhYnNOYXZpZ2F0aW9uLCB0aGlzKTtcbiAgICB0aGlzLl9wYW5lcy5iaW5kKCd0YWJFbmFibGVkJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuICB9LFxuXG4gIF9nZXRCQm94OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNvbHVtbnMuZWFjaChmdW5jdGlvbihjb2x1bW4pIHtcbiAgICAgIGlmIChjb2x1bW4uZ2V0KFwiY29sdW1uXCIpID09PSBcInRoZV9nZW9tXCIpIHtcbiAgICAgICAgdGhpcy5iYm94ID0gY29sdW1uLmdldChcImJib3hcIik7XG4gICAgICB9XG4gICAgfSwgdGhpcyk7XG4gIH0sXG5cbiAgX2xvYWRDYXJkczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jb2x1bW5zLmVhY2godGhpcy5fbG9hZENhcmQsIHRoaXMpO1xuICB9LFxuXG4gIF9sb2FkQ2FyZDogZnVuY3Rpb24oY29sdW1uKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgaWYgKGNvbHVtbi5nZXQoXCJzdWNjZXNzXCIpKSB7XG4gICAgICB0aGlzLl9nZW5lcmF0ZVRodW1ibmFpbChjb2x1bW4sIGZ1bmN0aW9uKGVycm9yLCB1cmwpIHtcbiAgICAgICAgaWYgKCFlcnJvcikge1xuICAgICAgICAgIHNlbGYuX2FkZENhcmQodXJsLCBjb2x1bW4pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNkYi5sb2cuZXJyb3IoZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgX3NlbmRBcHBsaWVkU3RhdHM6IGZ1bmN0aW9uKCkge1xuICAgIGNkYi5nb2QudHJpZ2dlcignbWV0cmljcycsICdhcHBsaWVkX3BlY2FuJywge1xuICAgICAgZW1haWw6IHdpbmRvdy51c2VyX2RhdGEuZW1haWxcbiAgICB9KTtcbiAgfSxcblxuICBfc2VuZE9wZW5TdGF0czogZnVuY3Rpb24oKSB7XG4gICAgY2RiLmdvZC50cmlnZ2VyKCdtZXRyaWNzJywgJ29wZW5fcGVjYW5fbGlzdCcsIHtcbiAgICAgIGVtYWlsOiB3aW5kb3cudXNlcl9kYXRhLmVtYWlsXG4gICAgfSk7XG4gIH0sXG5cbiAgX3NraXA6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBsYXllcklEID0gdGhpcy52aXMuZ2V0KFwiYWN0aXZlX2xheWVyX2lkXCIpO1xuICAgIHZhciBuYW1lO1xuICAgIHZhciBhY3RpdmVMYXllciAgPSB0aGlzLnZpcy5tYXAubGF5ZXJzLndoZXJlKHsgaWQ6IGxheWVySUQgfSk7XG5cbiAgICBpZiAoYWN0aXZlTGF5ZXIpIHtcbiAgICAgIG5hbWUgPSBhY3RpdmVMYXllclswXS50YWJsZS5nZXQoXCJuYW1lXCIpO1xuICAgIH1cblxuICAgIHZhciBza2lwUGVuY2FuRGlhbG9nID0gJ3BlY2FuXycgKyB0aGlzLm9wdGlvbnMudXNlci5nZXQoXCJ1c2VybmFtZVwiKSArIFwiX1wiICsgbmFtZTtcbiAgICBsb2NhbFN0b3JhZ2Vbc2tpcFBlbmNhbkRpYWxvZ10gPSB0cnVlO1xuICB9LFxuXG4gIF9uZXh0UGFnZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBhZ2UgPSB0aGlzLm1vZGVsLmdldCgncGFnZScpO1xuICAgIHZhciBtYXhQYWdlcyA9IHRoaXMubW9kZWwuZ2V0KCdtYXhQYWdlcycpO1xuXG4gICAgaWYgKHBhZ2UgPCBtYXhQYWdlcykge1xuICAgICAgdGhpcy5tb2RlbC5zZXQoJ3BhZ2UnLCBwYWdlICsgMSk7XG4gICAgfVxuICB9LFxuXG4gIF9wcmV2UGFnZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBhZ2UgPSB0aGlzLm1vZGVsLmdldCgncGFnZScpO1xuICAgIGlmIChwYWdlID4gMSkge1xuICAgICAgdGhpcy5tb2RlbC5zZXQoJ3BhZ2UnLCBwYWdlIC0gMSk7XG4gICAgfVxuICB9LFxuXG4gIF9tb3ZlVGFic05hdmlnYXRpb246IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwYWdlID0gdGhpcy5tb2RlbC5nZXQoJ3BhZ2UnKTtcbiAgICB2YXIgcm93V2lkdGggPSA5NjA7XG5cbiAgICB2YXIgcCA9IHJvd1dpZHRoICogKHBhZ2UgLSAxKTtcbiAgICB0aGlzLiQoJy5qcy1tYXAtbGlzdCcpLmNzcygnbWFyZ2luLWxlZnQnLCAnLScgKyBwICsgJ3B4Jyk7XG4gICAgdGhpcy5fcmVmcmVzaE5hdmlnYXRpb24oKTtcbiAgfSxcblxuICBfcmVmcmVzaE5hdmlnYXRpb246IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwYWdlID0gdGhpcy5tb2RlbC5nZXQoJ3BhZ2UnKTtcbiAgICB2YXIgbWF4UGFnZXMgPSB0aGlzLm1vZGVsLmdldCgnbWF4UGFnZXMnKTtcblxuICAgIHRoaXMuJCgnLmpzLWdvUHJldicpWyBwYWdlID4gMSA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnIF0oJ2lzLWRpc2FibGVkJyk7XG4gICAgdGhpcy4kKCcuanMtZ29OZXh0JylbIHBhZ2UgPCBtYXhQYWdlcyA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnIF0oJ2lzLWRpc2FibGVkJyk7XG4gIH0sXG5cbiAgX2hpZGVOYXZpZ2F0aW9uOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoJy5qcy1uYXZpZ2F0aW9uJykuYWRkQ2xhc3MoXCJpcy1oaWRkZW5cIik7XG4gIH0sXG5cbiAgX3NldHVwQ1NTOiBmdW5jdGlvbihjc3MsIGdlb21ldHJ5VHlwZSkge1xuICAgIHZhciByb3dfY291bnQgPSB0aGlzLm9wdGlvbnMudmlzLnRhYmxlTWV0YWRhdGEoKS5nZXQoXCJyb3dfY291bnRcIik7XG4gICAgdmFyIHJlbW92ZVN0cm9rZUluZGV4ID0gcm93X2NvdW50IC8gKHRoaXMuX0NBUkRfV0lEVEggKiB0aGlzLl9DQVJEX0hFSUdIVCk7XG4gICAgdmFyIHJlbW92ZVN0cm9rZSA9IChyZW1vdmVTdHJva2VJbmRleCA+IHRoaXMuX1NUUk9LRV9QWF9MSU1JVCk7XG5cbiAgICBpZiAoZ2VvbWV0cnlUeXBlICE9PSBcImxpbmVcIiAmJiByZW1vdmVTdHJva2UpIHtcbiAgICAgIGNzcyA9IGNzcy5yZXBsYWNlKFwibWFya2VyLWxpbmUtd2lkdGg6IDE7XCIsIFwibWFya2VyLWxpbmUtd2lkdGg6IDAuNztcIik7XG4gICAgICBjc3MgPSBjc3MucmVwbGFjZShcIm1hcmtlci13aWR0aDogMTA7XCIsIFwibWFya2VyLXdpZHRoOiA3O1wiKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY3NzO1xuICB9LFxuXG4gIF9zZXR1cFRlbXBsYXRlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgdGVtcGxhdGUgPSB0aGlzLm1hcC5nZXRMYXllckF0KDApLmdldChcInVybFRlbXBsYXRlXCIpO1xuXG4gICAgaWYgKHRlbXBsYXRlKSB7XG4gICAgICB2YXIgc3VwcG9ydGVkQmFzZW1hcCA9IF8uZmluZCh0aGlzLl9TVVBQT1JURURfQkFTRU1BUFMsIGZ1bmN0aW9uKGJhc2VtYXApIHtcbiAgICAgICAgcmV0dXJuIHRlbXBsYXRlLmluZGV4T2YoYmFzZW1hcCkgIT09IC0xXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoIXRlbXBsYXRlIHx8ICFzdXBwb3J0ZWRCYXNlbWFwKSB7XG4gICAgICB0ZW1wbGF0ZSA9IHRoaXMuX0RFRkFVTFRfQkFTRU1BUF9URU1QTEFURTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGVtcGxhdGU7XG4gIH0sXG5cbiAgX2dlbmVyYXRlTGF5ZXJEZWZpbml0aW9uOiBmdW5jdGlvbihjb2x1bW4pIHtcblxuICAgIHZhciB0eXBlID0gY29sdW1uLmdldChcInZpc3VhbGl6YXRpb25UeXBlXCIpO1xuICAgIHZhciBzcWwgPSBjb2x1bW4uZ2V0KFwic3FsXCIpO1xuICAgIHZhciBjc3MgPSB0aGlzLl9zZXR1cENTUyhjb2x1bW4uZ2V0KFwiY3NzXCIpLCBjb2x1bW4uZ2V0KFwiZ2VvbWV0cnlUeXBlXCIpKTtcblxuICAgIHZhciBhcGlfa2V5ICA9IHRoaXMudXNlci5nZXQoXCJhcGlfa2V5XCIpO1xuICAgIHZhciBtYXBzX2FwaV90ZW1wbGF0ZSA9IGNkYi5jb25maWcuZ2V0KCdtYXBzX2FwaV90ZW1wbGF0ZScpO1xuXG4gICAgdmFyIHRlbXBsYXRlID0gdGhpcy5fc2V0dXBUZW1wbGF0ZSgpO1xuXG4gICAgdmFyIGxheWVyRGVmaW5pdGlvbiA9IHtcbiAgICAgIHVzZXJfbmFtZTogdXNlcl9kYXRhLnVzZXJuYW1lLFxuICAgICAgbWFwc19hcGlfdGVtcGxhdGU6IG1hcHNfYXBpX3RlbXBsYXRlLFxuICAgICAgYXBpX2tleTogYXBpX2tleSxcbiAgICAgIGxheWVyczogW3tcbiAgICAgICAgdHlwZTogXCJodHRwXCIsXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICB1cmxUZW1wbGF0ZTogdGVtcGxhdGUsXG4gICAgICAgICAgc3ViZG9tYWluczogWyBcImFcIiwgXCJiXCIsIFwiY1wiIF1cbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICB0eXBlOiBcImNhcnRvZGJcIixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIHNxbDogc3FsLFxuICAgICAgICAgIGNhcnRvY3NzOiBjc3MsXG4gICAgICAgICAgY2FydG9jc3NfdmVyc2lvbjogXCIyLjEuMVwiXG4gICAgICAgIH1cbiAgICAgIH1dXG4gICAgfTtcblxuICAgIGlmICh0eXBlID09PSBcInRvcnF1ZVwiIHx8IHR5cGUgPT09IFwiaGVhdG1hcFwiKXtcbiAgICAgIGxheWVyRGVmaW5pdGlvbi5sYXllcnNbMV0gPSB7XG4gICAgICAgIHR5cGU6IFwidG9ycXVlXCIsXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBzcWw6IHNxbCxcbiAgICAgICAgICBjYXJ0b2NzczogY3NzLFxuICAgICAgICAgIGNhcnRvY3NzX3ZlcnNpb246IFwiMi4xLjFcIlxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGxheWVyRGVmaW5pdGlvbjtcbiAgfSxcblxuICBfZ2VuZXJhdGVUaHVtYm5haWw6IGZ1bmN0aW9uKGNvbHVtbiwgY2FsbGJhY2spIHtcblxuICAgIHZhciBsYXllckRlZmluaXRpb24gPSB0aGlzLl9nZW5lcmF0ZUxheWVyRGVmaW5pdGlvbihjb2x1bW4pO1xuXG4gICAgdmFyIG9uSW1hZ2VSZWFkeSA9IGZ1bmN0aW9uKGVycm9yLCB1cmwpIHtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVycm9yLCB1cmwpO1xuICAgIH07XG5cbiAgICB2YXIgdGhlX2dlb20gPSB0aGlzLmNvbHVtbnMuZmluZChmdW5jdGlvbihjb2x1bW4pIHtcbiAgICAgIHJldHVybiBjb2x1bW4uZ2V0KFwiY29sdW1uXCIpID09PSAndGhlX2dlb20nXG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5iYm94ICYmIHRoaXMuX0dFVF9CQk9YX0ZST01fVEhFX0dFT00pIHtcbiAgICAgIGNkYi5JbWFnZShsYXllckRlZmluaXRpb24pLnNpemUodGhpcy5fQ0FSRF9XSURUSCwgdGhpcy5fQ0FSRF9IRUlHSFQpLmJib3godGhpcy5iYm94KS5nZXRVcmwob25JbWFnZVJlYWR5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2RiLkltYWdlKGxheWVyRGVmaW5pdGlvbikuc2l6ZSh0aGlzLl9DQVJEX1dJRFRILCB0aGlzLl9DQVJEX0hFSUdIVCkuem9vbSh0aGlzLm1hcC5nZXQoXCJ6b29tXCIpKS5jZW50ZXIodGhpcy5tYXAuZ2V0KFwiY2VudGVyXCIpKS5nZXRVcmwob25JbWFnZVJlYWR5KTtcbiAgICB9XG5cbiAgfSxcblxuICBfYWRkQ2FyZDogZnVuY3Rpb24odXJsLCBjb2x1bW4pIHtcblxuICAgIHZhciBjYXJkID0gbmV3IFBlY2FuQ2FyZCh7XG4gICAgICB1cmw6IHVybCxcbiAgICAgIHVybFRlbXBsYXRlOiB0aGlzLm1hcC5nZXRMYXllckF0KDApLmdldChcInVybFRlbXBsYXRlXCIpLFxuICAgICAgYXBpX2tleTogdGhpcy51c2VyLmdldChcImFwaV9rZXlcIiksXG4gICAgICBtb2RlbDogY29sdW1uXG4gICAgfSk7XG5cbiAgICBjYXJkLmJpbmQoXCJjbGlja1wiLCB0aGlzLl9vbkNhcmRDbGljaywgdGhpcyk7XG4gICAgY2FyZC5yZW5kZXIoKTtcblxuICAgIHRoaXMuX3BhbmVzLmFjdGl2ZSgndmlzJyk7XG5cbiAgICBpZiAodGhpcy5fZ2V0U3VjY2Vzc0NvbHVtbnMoKS5sZW5ndGggPCAzKSB7XG4gICAgICB0aGlzLiQoXCIuanMtbWFwLWxpc3RcIikuYWRkQ2xhc3MoXCJpcy0tY2VudGVyZWRcIik7XG4gICAgfVxuXG4gICAgaWYgKGNvbHVtbi5nZXQoXCJ2aXN1YWxpemF0aW9uVHlwZVwiKSA9PT0gJ2hlYXRtYXAnIHx8IGNvbHVtbi5nZXQoXCJ2aXN1YWxpemF0aW9uVHlwZVwiKSA9PT0gJ3RvcnF1ZScpIHtcbiAgICAgIHRoaXMuJChcIi5qcy1tYXAtbGlzdFwiKS5wcmVwZW5kKGNhcmQuJGVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy4kKFwiLmpzLW1hcC1saXN0XCIpLmFwcGVuZChjYXJkLiRlbCk7XG4gICAgfVxuXG4gICAgdGhpcy5fcmVmcmVzaE1hcExpc3QoY2FyZC4kZWwpO1xuICAgIHRoaXMuX3JlZnJlc2hOYXZpZ2F0aW9uKCk7XG4gIH0sXG5cbiAgX3JlZnJlc2hNYXBMaXN0OiBmdW5jdGlvbigkZWwpIHtcbiAgICB2YXIgdyA9ICRlbC53aWR0aCgpO1xuICAgIHZhciBsID0gdGhpcy4kKFwiLmpzLWNhcmRcIikubGVuZ3RoO1xuICAgIHRoaXMuJChcIi5qcy1tYXAtbGlzdFwiKS53aWR0aCh3ICogbCArIChsIC0gMSkgKiB0aGlzLl9DQVJEX01BUkdJTik7XG4gICAgdGhpcy5tb2RlbC5zZXQoJ21heFBhZ2VzJywgTWF0aC5jZWlsKHRoaXMuJCgnLmpzLWNhcmQnKS5zaXplKCkgLyB0aGlzLl9UQUJTX1BFUl9ST1cpKTtcbiAgfSxcblxuICBfZ2V0U3VjY2Vzc0NvbHVtbnM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmNvbHVtbnMuZmlsdGVyKGZ1bmN0aW9uKGMpIHsgcmV0dXJuIGMuZ2V0KFwic3VjY2Vzc1wiKX0pO1xuICB9LFxuXG4gIF9iaW5kRGF0YUxheWVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmxheWVyLndpemFyZF9wcm9wZXJ0aWVzLnVuYmluZChcImxvYWRcIiwgdGhpcy5fc2V0V2l6YXJkUHJvcGVydGllcywgdGhpcyk7XG4gICAgdGhpcy5sYXllci53aXphcmRfcHJvcGVydGllcy5iaW5kKFwibG9hZFwiLCB0aGlzLl9zZXRXaXphcmRQcm9wZXJ0aWVzLCB0aGlzKTtcbiAgfSxcblxuICBfZ2V0UHJvcGVydGllczogZnVuY3Rpb24oY29sdW1uKSB7XG5cbiAgICB2YXIgcHJvcGVydHkgPSBjb2x1bW4uZ2V0KFwiY29sdW1uXCIpO1xuICAgIHZhciB3aXphcmQgPSB0aGlzLl9nZXRXaXphcmROYW1lKGNvbHVtbi5nZXQoXCJ2aXN1YWxpemF0aW9uVHlwZVwiKSk7XG5cbiAgICB2YXIgcHJvcGVydGllcyA9IHsgcHJvcGVydHk6IHByb3BlcnR5IH07XG5cbiAgICBpZiAod2l6YXJkID09PSBcImNhdGVnb3J5XCIpIHtcbiAgICAgIHJldHVybiB0aGlzLl9nZXRDYXRlZ29yaWVzUHJvcGVydGllcyhwcm9wZXJ0aWVzKTtcbiAgICB9IGVsc2UgaWYgKHdpemFyZCA9PT0gJ2Nob3JvcGxldGgnKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZ2V0Q2hvcm9wbGV0aFByb3BlcnRpZXMocHJvcGVydGllcyk7XG4gICAgfSBlbHNlIGlmKHdpemFyZCA9PT0gXCJoZWF0bWFwXCIpIHtcbiAgICAgIHJldHVybiB0aGlzLl9nZXRIZWF0bWFwUHJvcGVydGllcyhwcm9wZXJ0aWVzKTtcbiAgICB9XG5cbiAgfSxcblxuICBfb25DYXJkQ2xpY2s6IGZ1bmN0aW9uKGNvbHVtbikge1xuICAgIHRoaXMuX3BhbmVzLmFjdGl2ZSgnYXBwbHlpbmcnKTtcbiAgICB0aGlzLm1vZGVsLnNldChcImNvbHVtblwiLCBjb2x1bW4pO1xuXG4gICAgdGhpcy5fc2tpcCgpO1xuXG4gICAgdGhpcy5sYXllciA9IHRoaXMuX2dldERhdGFMYXllcigpO1xuXG4gICAgdGhpcy5fc2VuZEFwcGxpZWRTdGF0cygpO1xuXG4gICAgdmFyIHdpemFyZCA9IHRoaXMuX2dldFdpemFyZE5hbWUoY29sdW1uLmdldChcInZpc3VhbGl6YXRpb25UeXBlXCIpKTtcbiAgICB2YXIgcHJvcGVydGllcyA9IHRoaXMuX2dldFByb3BlcnRpZXMoY29sdW1uKTtcblxuICAgIHRoaXMuX2JpbmREYXRhTGF5ZXIoKTtcbiAgICB0aGlzLmxheWVyLndpemFyZF9wcm9wZXJ0aWVzLmFjdGl2ZSh3aXphcmQsIHByb3BlcnRpZXMpO1xuICB9LFxuXG4gIF9nZXRXaXphcmROYW1lOiBmdW5jdGlvbihuYW1lKXtcbiAgICB2YXIgbWFwcGluZ3MgPSB7XCJoZWF0bWFwXCI6IFwidG9ycXVlX2hlYXRcIn07XG4gICAgcmV0dXJuIG1hcHBpbmdzW25hbWVdIHx8IG5hbWU7XG4gIH0sXG5cbiAgX2dldERhdGFMYXllcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMubWFwLmxheWVycy5nZXREYXRhTGF5ZXJzKClbMF07XG4gIH0sXG5cbiAgX3NldFdpemFyZFByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgeyAvLyBUT0RPOiBoYWNrLCB3ZSBzaG91bGQgZmluZCBhIHdheSB0byByZW1vdmUgdGhpc1xuICAgIHZhciBwcm9wZXJ0aWVzID0gdGhpcy5fZ2V0UHJvcGVydGllcyh0aGlzLm1vZGVsLmdldChcImNvbHVtblwiKSk7XG4gICAgdGhpcy5sYXllci53aXphcmRfcHJvcGVydGllcy51bmJpbmQoXCJsb2FkXCIsIHRoaXMuX3NldFdpemFyZFByb3BlcnRpZXMsIHRoaXMpO1xuICAgIGlmIChwcm9wZXJ0aWVzKSB7XG4gICAgICB0aGlzLmxheWVyLndpemFyZF9wcm9wZXJ0aWVzLnNldChwcm9wZXJ0aWVzKTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZSgpO1xuICB9LFxuXG4gIF9nZXRDaG9yb3BsZXRoUHJvcGVydGllczogZnVuY3Rpb24ocHJvcGVydGllcykge1xuICAgIHZhciBjb2x1bW4gPSB0aGlzLm1vZGVsLmdldChcImNvbHVtblwiKTtcblxuICAgIHZhciBwcm9wZXJ0eSA9IGNvbHVtbi5nZXQoXCJjb2x1bW5cIik7XG4gICAgdmFyIHR5cGUgICAgID0gY29sdW1uLmdldChcInR5cGVcIik7XG4gICAgdmFyIGRpc3QgICAgID0gY29sdW1uLmdldChcImRpc3RfdHlwZVwiKTtcbiAgICB2YXIgc3RhdHMgICAgPSBjb2x1bW4uZ2V0KFwic3RhdHNcIik7XG5cbiAgICBwcm9wZXJ0aWVzLnFmdW5jdGlvbiAgPSB0aGlzLl9nZXRRRnVuY3Rpb24oZGlzdCk7XG4gICAgcHJvcGVydGllcy5jb2xvcl9yYW1wID0gUGVjYW4uZ2V0TWV0aG9kUHJvcGVydGllcyhzdGF0cykubmFtZTtcblxuICAgIHJldHVybiBwcm9wZXJ0aWVzO1xuICB9LFxuXG4gIF9nZXRDYXRlZ29yaWVzUHJvcGVydGllczogZnVuY3Rpb24ocHJvcGVydGllcykge1xuICAgIHZhciBjb2x1bW4gPSB0aGlzLm1vZGVsLmdldChcImNvbHVtblwiKTtcbiAgICBwcm9wZXJ0aWVzLm1ldGFkYXRhICAgPSBjb2x1bW4uZ2V0KFwibWV0YWRhdGFcIik7XG4gICAgcHJvcGVydGllcy5jYXRlZ29yaWVzID0gY29sdW1uLmdldChcIm1ldGFkYXRhXCIpO1xuICAgIHJldHVybiBwcm9wZXJ0aWVzO1xuICB9LFxuXG4gIF9nZXRIZWF0bWFwUHJvcGVydGllczogZnVuY3Rpb24ocHJvcGVydGllcyl7XG4gICAgcHJvcGVydGllcy5wcm9wZXJ0eSA9IFwiY2FydG9kYl9pZFwiO1xuICAgIHByb3BlcnRpZXNbXCJ0b3JxdWUtcmVzb2x1dGlvblwiXSA9IDI7XG4gICAgcmV0dXJuIHByb3BlcnRpZXM7XG4gIH0sXG5cbiAgX2dldFFGdW5jdGlvbjogZnVuY3Rpb24oZGlzdCkge1xuICAgIHZhciBxZnVuY3Rpb24gPSBcIkplbmtzXCI7XG5cbiAgICBpZiAoZGlzdCA9PT0gJ0wnIHx8IGRpc3QgPT0gJ0onKSB7XG4gICAgICBxZnVuY3Rpb24gPSBcIkhlYWRzL1RhaWxzXCI7XG4gICAgfSBlbHNlIGlmIChkaXN0ID09PSAnQScgfHwgZGlzdCA9PSAnVScpIHtcbiAgICAgIHFmdW5jdGlvbiA9IFwiSmVua3NcIjtcbiAgICB9IGVsc2UgaWYgKGRpc3QgPT09ICdGJykge1xuICAgICAgcWZ1bmN0aW9uID0gXCJRdWFudGlsZVwiOyAvLyB3ZSBjb3VsZCB1c2UgJ0VxdWFsIEludGVydmFsJyB0b29cbiAgICB9XG4gICAgcmV0dXJuIHFmdW5jdGlvbjtcbiAgfSxcblxuICBfa2V5ZG93bjogZnVuY3Rpb24oZSkge1xuICAgIGlmIChlLmtleUNvZGUgPT09ICQudWkua2V5Q29kZS5MRUZUKSB7XG4gICAgICB0aGlzLl9wcmV2UGFnZSgpO1xuICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSAkLnVpLmtleUNvZGUuUklHSFQpIHtcbiAgICAgIHRoaXMuX25leHRQYWdlKCk7XG4gICAgfVxuICAgIEJhc2VEaWFsb2cucHJvdG90eXBlLl9rZXlkb3duLmNhbGwodGhpcywgZSk7XG4gIH0sXG5cbiAgY2xlYW46IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLmxheWVyKSB7XG4gICAgICB0aGlzLmxheWVyLndpemFyZF9wcm9wZXJ0aWVzLnVuYmluZChcImxvYWRcIiwgdGhpcy5fc2V0V2l6YXJkUHJvcGVydGllcywgdGhpcyk7XG4gICAgfVxuXG4gICAgQmFzZURpYWxvZy5wcm90b3R5cGUuY2xlYW4uY2FsbCh0aGlzKTtcbiAgfSxcblxuICBjYW5jZWw6IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLmtpbGxFdmVudChlKTtcbiAgICB0aGlzLm1vZGVsLnNldCgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgICB0aGlzLl9za2lwKCk7XG4gICAgdGhpcy5lbGRlcignY2FuY2VsJyk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBVdGlscyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXVsnVXRpbHMnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddWydVdGlscyddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfZmFjdG9yeScpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZScpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBfTUFYX1JPV1M6IDEwMDAwMCxcbiAgX01BWF9DT0xTOiA2MCxcbiAgX0VYQ0xVREVEX0NPTFVNTlM6IFtcbiAgICAnY2FydG9kYl9pZCcsICdsYXQnLCAnbG9uJywgJ2xuZycsICdsb25nJywgJ2xhdGl0dWRlJywgJ2xvbmdpdHVkZScsICdsb25naXR1ZGVudW1iZXInLCdsYXRpdHVkZW51bWJlcicsIFxuICAgICdtaW5sYXQnLCAnbWF4bGF0JywgJ21pbmxvbicsICdtYXhsb24nLCAnbWlubG5nJywgJ21heGxuZycsICdjZW50ZXJfbGF0JywgJ2NlbnRlcmxhdCcsICdjZW50ZXJfbG9uJywgJ2NlbnRlcmxvbicsXG4gICAgJ2xhdGRkJywgJ2xvbmdkZCcsICdzaGFwZV9sZW5ndGgnLCAnc2hhcGVfYXJlYScsICdvYmplY3RpZCcsICdpZCcsICdjcmVhdGVkX2F0JywgJ3VwZGF0ZWRfYXQnLFxuICAgICdpc28yJywgJ2lzbzMnLCAneCcsICd5JywgJ3hfY29vcmQnLCAneV9jb29yZCcsICd4Y29vcmQnLCAneWNvb3JkJywgJ2Nvb3JkX3gnLCAnY29vcmRfeScsICdjb29yZHgnLCAnY29vcmR5JywgXG4gICAgJ2NhcnRvZGJfZ2VvcmVmX3N0YXR1cycsJ3NjYWxlcmFuaycsICdzdHJva3dlaWcnLCAnY291bnRyeScsICdzdGF0ZScsICdhcmVhX3Nxa20nLCAncmVnaW9uJywgJ3N1YnJlZ2lvbicsICdmdW5jc3RhdCcsXG4gICAgJ2NsYXNzZnAnLCAnY291bnR5X2ZpcCcsICdjb3VudHknLCAnYWxhbmQxMCdcbiAgXSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG5cbiAgICBpZiAoIXRoaXMub3B0aW9ucy50YWJsZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCd0YWJsZSBpcyByZXF1aXJlZCcpO1xuICAgIH1cblxuICAgIHRoaXMuX2luaXRNb2RlbHMoKTtcbiAgICB0aGlzLl9pbml0Vmlld3MoKTtcbiAgfSxcblxuICBfY2hlY2s6IGZ1bmN0aW9uKCkge1xuXG4gICAgdmFyIGlzR2VvcmVmZXJlbmNlZCA9IHRoaXMub3B0aW9ucy50YWJsZS5pc0dlb3JlZmVyZW5jZWQoKTtcblxuICAgIHZhciB0YWJsZURhdGEgICAgID0gdGhpcy5vcHRpb25zLnRhYmxlLmRhdGEoKTtcbiAgICB2YXIgZ2VvbWV0cnlUeXBlcyA9IHRhYmxlRGF0YS50YWJsZSAmJiB0YWJsZURhdGEudGFibGUuZ2V0KFwiZ2VvbWV0cnlfdHlwZXNcIik7XG4gICAgdmFyIGhhc0dlb21ldHJpZXMgPSBnZW9tZXRyeVR5cGVzICYmIGdlb21ldHJ5VHlwZXMubGVuZ3RoID4gMCA/IHRydWUgOiBmYWxzZTtcblxuICAgIHZhciByb3dfY291bnQgICAgID0gdGFibGVEYXRhLnRhYmxlLmdldChcInJvd3NfY291bnRlZFwiKTtcbiAgICB2YXIgaGFzUm93cyAgICAgICA9IHJvd19jb3VudCA+IDAgJiYgcm93X2NvdW50IDwgdGhpcy5fTUFYX1JPV1M7XG5cbiAgICB2YXIgY29sX2NvdW50ID0gXyh0aGlzLnF1ZXJ5X3NjaGVtYSkuc2l6ZSgpO1xuICAgIHZhciBoYXNDb2x1bW5zID0gY29sX2NvdW50ID4gMCAmJiBjb2xfY291bnQgPCB0aGlzLl9NQVhfQ09MUztcblxuICAgIHJldHVybiBpc0dlb3JlZmVyZW5jZWQgJiYgaGFzR2VvbWV0cmllcyAmJiBoYXNSb3dzICYmIGhhc0NvbHVtbnM7XG4gIH0sXG5cbiAgX2luaXRNb2RlbHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY29sdW1ucyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG4gICAgdGhpcy5tb2RlbCA9IG5ldyBjZGIuY29yZS5Nb2RlbCh7IHBhZ2U6IDEsIG1heFBhZ2VzOiAwIH0pO1xuICB9LFxuXG4gIF9pbml0Vmlld3M6IGZ1bmN0aW9uKCkge1xuXG4gICAgdGhpcy50YWJsZSA9IHRoaXMub3B0aW9ucy50YWJsZTtcbiAgICB0aGlzLnF1ZXJ5X3NjaGVtYSA9IHRoaXMudGFibGUuZGF0YSgpLnF1ZXJ5X3NjaGVtYTtcbiAgICB0aGlzLmJhY2tncm91bmRQb2xsaW5nTW9kZWwgPSB0aGlzLm9wdGlvbnMuYmFja2dyb3VuZFBvbGxpbmdNb2RlbDtcblxuICAgIGlmICh0aGlzLl9jaGVjaygpICYmIHRoaXMuYmFja2dyb3VuZFBvbGxpbmdNb2RlbC5jYW5BZGRBbmFseXNpcygpKSB7XG4gICAgICB0aGlzLl9zZXR1cENvbHVtbnMoKTtcbiAgICAgIHRoaXMuX3N0YXJ0KCk7XG4gICAgfVxuICB9LFxuXG4gIF9nZXRTaW1wbGlmaWVkR2VvbWV0cnlUeXBlOiBmdW5jdGlvbihnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0X211bHRpcG9seWdvbjogJ3BvbHlnb24nLFxuICAgICAgc3RfcG9seWdvbjogJ3BvbHlnb24nLFxuICAgICAgc3RfbXVsdGlsaW5lc3RyaW5nOiAnbGluZScsXG4gICAgICBzdF9saW5lc3RyaW5nOiAnbGluZScsXG4gICAgICBzdF9tdWx0aXBvaW50OiAncG9pbnQnLFxuICAgICAgc3RfcG9pbnQ6ICdwb2ludCdcbiAgICB9W2cudG9Mb3dlckNhc2UoKV07XG4gIH0sXG5cbiAgX2dldEdlb21ldHJ5VHlwZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGdlb21ldHJ5VHlwZXMgPSB0aGlzLnRhYmxlLmRhdGEoKS50YWJsZS5nZXQoXCJnZW9tZXRyeV90eXBlc1wiKTtcbiAgICByZXR1cm4gdGhpcy5fZ2V0U2ltcGxpZmllZEdlb21ldHJ5VHlwZShnZW9tZXRyeVR5cGVzWzBdKTtcbiAgfSxcblxuICBfc3RhcnQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjb2x1bW5zID0gdGhpcy5jb2x1bW5zLm1hcChmdW5jdGlvbihjb2x1bW4pIHtcbiAgICAgIHJldHVybiB7IHRhYmxlX2lkOiB0aGlzLnRhYmxlLmlkLCBjb2x1bW46IGNvbHVtbi5nZXQoXCJuYW1lXCIpLCBnZW9tZXRyeV90eXBlOiBjb2x1bW4uZ2V0KFwiZ2VvbWV0cnlfdHlwZVwiKSB9O1xuICAgIH0sIHRoaXMpO1xuXG4gICAgdGhpcy5iYWNrZ3JvdW5kUG9sbGluZ01vZGVsLmFkZEFuYWx5c2lzKGNvbHVtbnMpO1xuICB9LFxuXG4gIF9zZXR1cENvbHVtbnM6IGZ1bmN0aW9uKCkge1xuICAgIF8odGhpcy5xdWVyeV9zY2hlbWEpLmVhY2goZnVuY3Rpb24odHlwZSwgbmFtZSkge1xuICAgICAgaWYgKCFfLmluY2x1ZGUodGhpcy5fRVhDTFVERURfQ09MVU1OUywgbmFtZSkpIHtcbiAgICAgICAgdGhpcy5jb2x1bW5zLmFkZCh7IG5hbWU6IG5hbWUuY29uY2F0KFwiXCIpLCBnZW9tZXRyeV90eXBlOiB0aGlzLl9nZXRHZW9tZXRyeVR5cGUoKSB9KTtcbiAgICAgIH1cbiAgICB9LCB0aGlzKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqIFZpZXcgbW9kZWwgZm9yIGFuIG9wdGlvbiB0aGF0IG1heSBiZSBkaXNhYmxlZCBkdWUgdG8gVmlzJyBwcml2YWN5IGJlaW5nIHNldCB0byBwcml2YXRlLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgaXNEaXNhYmxlZDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdpc1ByaXZhY3lQcml2YXRlJyk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogVmlldyB0byBoYW5kbGUgdGhlIHZpc3VhbCByZXByZXNlbnRhdGlvbiBvZiBhIHB1Ymxpc2ggb3B0aW9uLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdPcHRpb25DYXJkIE9wdGlvbkNhcmQtLXN0YXRpYycsXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIGlucHV0JzogJ19vbkNsaWNrSW5wdXQnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgIHRoaXMuX3RlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSh0aGlzLm1vZGVsLmdldCgndGVtcGxhdGUnKSk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcblxuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLl90ZW1wbGF0ZSh7XG4gICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsXG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy4kZWwudG9nZ2xlQ2xhc3MoJ2lzLWRpc2FibGVkJywgISF0aGlzLm1vZGVsLmlzRGlzYWJsZWQoKSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgfSxcblxuICBfb25DbGlja0lucHV0OiBmdW5jdGlvbihldikge1xuICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICB0aGlzLiQoJ2lucHV0Jykuc2VsZWN0KCk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG52YXIgQmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKTtcbnZhciBCYXNlRGlhbG9nID0gcmVxdWlyZSgnLi4vLi4vdmlld3MvYmFzZV9kaWFsb2cvdmlldycpO1xudmFyIE9wdGlvblZpZXcgPSByZXF1aXJlKCcuL3B1Ymxpc2hfb3B0aW9uX3ZpZXcnKTtcbnZhciBWaWV3TW9kZWwgPSByZXF1aXJlKCcuL29wdGlvbnMvdmlld19tb2RlbCcpO1xuXG4vKipcbiAqIERlbGV0ZSBpdGVtcyBkaWFsb2dcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBCYXNlRGlhbG9nLmV4dGVuZCh7XG5cbiAgZXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gXy5leHRlbmQoe30sIEJhc2VEaWFsb2cucHJvdG90eXBlLmV2ZW50cywge1xuICAgICAgJ2NsaWNrIC5qcy1jaGFuZ2UtcHJpdmFjeSc6ICdfb3BlblByaXZhY3lEaWFsb2cnXG4gICAgfSk7XG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgIGlmICghdGhpcy5tb2RlbCkgdGhyb3cgbmV3IEVycm9yKCdtb2RlbCAodmlzKSBpcyByZXF1aXJlZCcpO1xuICAgIGlmICghdGhpcy5vcHRpb25zLnVzZXIpIHRocm93IG5ldyBFcnJvcigndXNlciBpcyByZXF1aXJlZCcpO1xuICAgIHRoaXMuX2luaXRPcHRpb25zKCk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEBpbXBsZW1lbnRzIGNkYi51aS5jb21tb24uRGlhbG9nLnByb3RvdHlwZS5yZW5kZXJfY29udGVudFxuICAgKi9cbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuXG4gICAgdmFyICRlbCA9ICQoXG4gICAgICBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9wdWJsaXNoL3B1Ymxpc2gnKSh7XG4gICAgICB9KVxuICAgICk7XG5cbiAgICB0aGlzLl9vcHRpb25zLmVhY2goZnVuY3Rpb24obW9kZWwpIHtcbiAgICAgIHZhciB2aWV3ID0gbmV3IE9wdGlvblZpZXcoe1xuICAgICAgICBtb2RlbDogbW9kZWxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5hZGRWaWV3KHZpZXcpO1xuICAgICAgJGVsLmZpbmQoJy5qcy1wdWJsaXNoLW9wdGlvbnMnKS5hcHBlbmQodmlldy5yZW5kZXIoKS5lbCk7XG4gICAgfSwgdGhpcyk7XG5cbiAgICAvLyBFdmVudCB0cmFja2luZyBcIlB1Ymxpc2hlZCB2aXN1YWxpemF0aW9uXCJcbiAgICBjZGIuZ29kLnRyaWdnZXIoJ21ldHJpY3MnLCAncHVibGlzaGVkX3Zpc3VhbGl6YXRpb24nLCB7XG4gICAgICBlbWFpbDogd2luZG93LnVzZXJfZGF0YS5lbWFpbFxuICAgIH0pO1xuXG4gICAgcmV0dXJuICRlbDtcbiAgfSxcblxuICBfaW5pdE9wdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgIC8vIFB1YmxpYyBVUkwgb3B0aW9uXG4gICAgdGhpcy5fb3B0aW9ucyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG4gICAgdGhpcy5fcHVibGljVXJsT3B0aW9uID0gbmV3IFZpZXdNb2RlbCh7XG4gICAgICB0ZW1wbGF0ZTogJ2NvbW1vbi9kaWFsb2dzL3B1Ymxpc2gvb3B0aW9ucy9wdWJsaWNfdXJsJ1xuICAgIH0pO1xuICAgIHRoaXMuX29wdGlvbnMuYWRkKHRoaXMuX3B1YmxpY1VybE9wdGlvbik7XG5cbiAgICAvLyBFbWJlZCBvcHRpb25cbiAgICB0aGlzLl9lbWJlZE9wdGlvbiA9IG5ldyBWaWV3TW9kZWwoe1xuICAgICAgdGVtcGxhdGU6ICdjb21tb24vZGlhbG9ncy9wdWJsaXNoL29wdGlvbnMvZW1iZWQnLFxuICAgICAgZW1iZWRVUkw6IHRoaXMubW9kZWwuZW1iZWRVUkwoKVxuICAgIH0pO1xuICAgIHRoaXMuX29wdGlvbnMuYWRkKHRoaXMuX2VtYmVkT3B0aW9uKTtcblxuICAgIC8vIENhcnRvREIuanMgb3B0aW9uXG4gICAgdGhpcy5fb3B0aW9ucy5hZGQoXG4gICAgICBuZXcgVmlld01vZGVsKHtcbiAgICAgICAgdGVtcGxhdGU6ICdjb21tb24vZGlhbG9ncy9wdWJsaXNoL29wdGlvbnMvY2RiJyxcbiAgICAgICAgdml6anNvblVSTDogdGhpcy5tb2RlbC52aXpqc29uVVJMKClcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIHRoaXMuX3VwZGF0ZU9wdGlvbnNXaXRoTmV3UHJpdmFjeSgpO1xuICB9LFxuXG4gIF91cGRhdGVPcHRpb25zV2l0aE5ld1ByaXZhY3k6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBpc1ByaXZhdGUgPSB0aGlzLm1vZGVsLmdldCgncHJpdmFjeScpID09PSAnUFJJVkFURSc7XG5cbiAgICB0aGlzLl9wdWJsaWNVcmxPcHRpb24uc2V0KCdpc1ByaXZhY3lQcml2YXRlJywgaXNQcml2YXRlKTtcbiAgICB0aGlzLl9lbWJlZE9wdGlvbi5zZXQoJ2lzUHJpdmFjeVByaXZhdGUnLCBpc1ByaXZhdGUpO1xuXG4gICAgaWYgKCFpc1ByaXZhdGUpIHtcbiAgICAgIHZhciBwdWJsaWNVUkwgPSB0aGlzLm1vZGVsLnB1YmxpY1VSTCgpO1xuICAgICAgdGhpcy5fcHVibGljVXJsT3B0aW9uLnNldCh7XG4gICAgICAgIHVybDogcHVibGljVVJMXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6cHJpdmFjeScsIHRoaXMuX3VwZGF0ZU9wdGlvbnNXaXRoTmV3UHJpdmFjeSwgdGhpcyk7XG4gIH0sXG5cbiAgX29wZW5Qcml2YWN5RGlhbG9nOiBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZSk7XG5cbiAgICB2YXIgcHJpdmFjeU1vZGFsID0gbmV3IGNkYi5lZGl0b3IuQ2hhbmdlUHJpdmFjeVZpZXcoe1xuICAgICAgdmlzOiB0aGlzLm1vZGVsLCAvL3Zpc1xuICAgICAgdXNlcjogdGhpcy5vcHRpb25zLnVzZXIsXG4gICAgICBjbGVhbl9vbl9oaWRlOiB0cnVlLFxuICAgICAgZW50ZXJfdG9fY29uZmlybTogdHJ1ZVxuICAgIH0pO1xuXG4gICAgLy8gRG8gbm90IHJlbW92ZSB0aGlzIGRpYWxvZyBidXQga2VlcCBpdCB1bnRpbCByZXR1cm5pbmdcbiAgICB2YXIgb3JpZ2luYWxDbGVhbk9uSGlkZVZhbHVlID0gdGhpcy5vcHRpb25zLmNsZWFuX29uX2hpZGU7XG4gICAgdGhpcy5vcHRpb25zLmNsZWFuX29uX2hpZGUgPSBmYWxzZTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gICAgcHJpdmFjeU1vZGFsLmFwcGVuZFRvQm9keSgpO1xuXG4gICAgLy8gUmV0dXJuIHRvIHRoaXMgdmlldyB3aGVuIGRvbmVcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIG9uQ2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgIHByaXZhY3lNb2RhbC51bmJpbmQoJ2hpZGUnLCBvbkNsb3NlKTtcbiAgICAgIHNlbGYub3B0aW9ucy5jbGVhbl9vbl9oaWRlID0gb3JpZ2luYWxDbGVhbk9uSGlkZVZhbHVlO1xuICAgICAgc2VsZi5zaG93KCk7XG4gICAgICBwcml2YWN5TW9kYWwuY2xvc2UoKTtcbiAgICB9O1xuICAgIHByaXZhY3lNb2RhbC5iaW5kKCdoaWRlJywgb25DbG9zZSk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBCYXNlRGlhbG9nID0gcmVxdWlyZSgnLi4vLi4vdmlld3MvYmFzZV9kaWFsb2cvdmlldycpO1xudmFyIFZpZXdGYWN0b3J5ID0gcmVxdWlyZSgnLi4vLi4vdmlld19mYWN0b3J5Jyk7XG52YXIgcmFuZG9tUXVvdGUgPSByZXF1aXJlKCcuLi8uLi92aWV3X2hlbHBlcnMvcmFuZG9tX3F1b3RlJyk7XG52YXIgbW9tZW50ID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ21vbWVudCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnbW9tZW50J10gOiBudWxsKTtcblxubW9kdWxlLmV4cG9ydHMgPSBCYXNlRGlhbG9nLmV4dGVuZCh7XG5cbiAgX0ZPUk1BVDogJ3BuZycsXG5cbiAgZXZlbnRzOiBCYXNlRGlhbG9nLmV4dGVuZEV2ZW50cyh7XG4gICAgJ2NsaWNrIC5qcy1mb3JtYXQnOiAnX29uQ2xpY2tGb3JtYXQnLFxuICAgICdrZXl1cCAuanMtdGV4dElucHV0JzogJ19vbktleVVwJyxcbiAgICAnZm9jdXMgLmpzLXRleHRJbnB1dCc6ICdfb25Gb2N1cycsXG4gICAgJ2JsdXIgLmpzLXRleHRJbnB1dCc6ICdfb25CbHVyJ1xuICB9KSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG5cbiAgICB0aGlzLm9wdGlvbnMgPSBfLmRlZmF1bHRzKHRoaXMub3B0aW9ucywgeyBmb3JtYXQ6IHRoaXMuX0ZPUk1BVCB9KTtcbiAgICB0aGlzLm1vZGVsID0gbmV3IGNkYi5jb3JlLk1vZGVsKHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy5tYXBWaWV3ID0gdGhpcy5vcHRpb25zLm1hcFZpZXc7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vZGlhbG9ncy9zdGF0aWNfaW1hZ2UvYWR2YW5jZWRfZXhwb3J0X3ZpZXcnKSh0aGlzLm1vZGVsLmF0dHJpYnV0ZXMpO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwub24oJ2NoYW5nZTpmb3JtYXQnLCB0aGlzLl9vbkNoYW5nZUZvcm1hdCwgdGhpcyk7XG4gIH0sXG5cbiAgX29uS2V5VXA6IGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgdmFsdWUgPSArJChlLnRhcmdldCkudmFsKCk7XG4gICAgJChlLnRhcmdldCkucGFyZW50KCkudG9nZ2xlQ2xhc3MoJ2hhcy1lcnJvcicsICEoXy5pc051bWJlcih2YWx1ZSkgJiYgdmFsdWUgPiAxMCkpO1xuICB9LFxuXG4gIF9vbkZvY3VzOiBmdW5jdGlvbihlKSB7XG4gICAgJChlLnRhcmdldCkucGFyZW50KCkuYWRkQ2xhc3MoJ2lzLWZvY3VzZWQnKTtcbiAgfSxcblxuICBfb25CbHVyOiBmdW5jdGlvbihlKSB7XG4gICAgJChlLnRhcmdldCkucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2lzLWZvY3VzZWQnKTtcbiAgfSxcblxuICBfb25DaGFuZ2VGb3JtYXQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJCgnLmpzLXJhZGlvQnV0dG9uJykucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcbiAgICB0aGlzLiQoJy5qcy0nICsgdGhpcy5tb2RlbC5nZXQoJ2Zvcm1hdCcpKS5hZGRDbGFzcygnaXMtY2hlY2tlZCcpO1xuICB9LFxuXG4gIF9vbkNsaWNrRm9ybWF0OiBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZSk7XG4gICAgdmFyICRlbCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5qcy1mb3JtYXQnKTtcbiAgICB0aGlzLm1vZGVsLnNldCgnZm9ybWF0JywgJGVsLmRhdGEoJ2Zvcm1hdCcpKTtcbiAgfSxcblxuICBfZ2V0Qm91bmRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbncgPSB0aGlzLm1hcFZpZXcucGl4ZWxUb0xhdExvbihbdGhpcy5vcHRpb25zLnggKyB0aGlzLm9wdGlvbnMud2lkdGgsIHRoaXMub3B0aW9ucy55XSk7XG4gICAgdmFyIHN3ID0gdGhpcy5tYXBWaWV3LnBpeGVsVG9MYXRMb24oW3RoaXMub3B0aW9ucy54LCB0aGlzLm9wdGlvbnMueSArIHRoaXMub3B0aW9ucy5oZWlnaHRdKTtcbiAgICByZXR1cm4gW1tzdy5sYXQsIHN3LmxuZ10sIFtudy5sYXQsIG53LmxuZ11dO1xuICB9LFxuXG4gIF9vazogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHdpZHRoID0gK3RoaXMuJCgnLmpzLXdpZHRoJykudmFsKCk7XG4gICAgdmFyIGhlaWdodCA9ICt0aGlzLiQoJy5qcy1oZWlnaHQnKS52YWwoKTtcbiAgICB2YXIgZm9ybWF0ID0gdGhpcy5tb2RlbC5nZXQoJ2Zvcm1hdCcpO1xuICAgIHZhciBib3VuZHMgPSB0aGlzLl9nZXRCb3VuZHMoKTtcblxuICAgIHRoaXMudHJpZ2dlcignZ2VuZXJhdGVfaW1hZ2UnLCB7IHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQsIGJvdW5kczogYm91bmRzLCBmb3JtYXQ6IGZvcm1hdCB9KTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcbnZhciBWaWV3RmFjdG9yeSA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfZmFjdG9yeScpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZScpO1xudmFyIG1vbWVudCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydtb21lbnQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ21vbWVudCddIDogbnVsbCk7XG5cbm1vZHVsZS5leHBvcnRzID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIGV2ZW50czogQmFzZURpYWxvZy5leHRlbmRFdmVudHMoe1xuICAgICdjbGljayAuanMtaW5wdXQnOiAnX29uSW5wdXRDbGljaycsXG4gICAgJ2NsaWNrIC5qcy1vcGVuLWltYWdlJzogJ2Nsb3NlJ1xuICB9KSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy5faW5pdFZpZXdzKCk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9wYW5lcy5nZXRBY3RpdmVQYW5lKCkucmVuZGVyKCkuZWw7XG4gIH0sXG5cbiAgX2luaXRWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy52aXMgPSB0aGlzLm9wdGlvbnMudmlzO1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMuY29sdW1uID0gdGhpcy5vcHRpb25zLmNvbHVtbjtcblxuICAgIHRoaXMuX3BhbmVzID0gbmV3IGNkYi51aS5jb21tb24uVGFiUGFuZSh7XG4gICAgICBlbDogdGhpcy5lbFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRWaWV3KHRoaXMuX3BhbmVzKTtcblxuICAgIHRoaXMuX3BhbmVzLmFkZFRhYignbG9hZGluZycsXG4gICAgICBWaWV3RmFjdG9yeS5jcmVhdGVCeVRlbXBsYXRlKCdjb21tb24vdGVtcGxhdGVzL2xvYWRpbmcnLCB7XG4gICAgICAgIHRpdGxlOiAnR2VuZXJhdGluZyBpbWFnZScsXG4gICAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdmYWlsJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvZmFpbCcsIHtcbiAgICAgICAgbXNnOiAnQ291bGQgbm90IGdlbmVyYXRlIGltYWdlJ1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdsb2FkaW5nJyk7XG4gIH0sXG5cbiAgbG9hZFVSTDogZnVuY3Rpb24odXJsKSB7XG4gICAgdGhpcy5fc2hvd1Jlc3VsdCh7IGRpc3BsYXllZExpbms6IHVybCwgZmlsZW5hbWU6IHVybCwgY29udGVudDogdXJsLCB0eXBlOiAndXJsJyB9KTtcbiAgfSxcblxuICBfZ2VuZXJhdGVJbWFnZUZpbGVuYW1lOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZmlsZW5hbWUgPSAodGhpcy52aXMuZ2V0KCduYW1lJykgKyAnIGJ5ICcgKyB0aGlzLnVzZXIubmFtZU9yVXNlcm5hbWUoKSArICcgJyArIG1vbWVudChuZXcgRGF0ZSgpKS5mb3JtYXQoJ01NIEREIFlZWVkgaGggbW0gc3MnKSk7XG4gICAgcmV0dXJuIGZpbGVuYW1lLnJlcGxhY2UoLyAvZywgJ18nKS50b0xvd2VyQ2FzZSgpO1xuICB9LFxuXG4gIGdlbmVyYXRlSW1hZ2U6IGZ1bmN0aW9uKHVybCkge1xuICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uKHVybCkge1xuICAgICAgdmFyIGZpbGVuYW1lID0gdGhpcy5fZ2VuZXJhdGVJbWFnZUZpbGVuYW1lKCk7XG4gICAgICB0aGlzLl9zaG93UmVzdWx0KHtcbiAgICAgICAgY29udGVudDogdXJsLFxuICAgICAgICB0eXBlOiAndXJsJyxcbiAgICAgICAgZGlzcGxheWVkTGluazogZmlsZW5hbWUgKyAnLicgKyB0aGlzLm9wdGlvbnMuZm9ybWF0LFxuICAgICAgICBmaWxlbmFtZTogZmlsZW5hbWVcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBpZiAoY2RiLmNvbmZpZy5nZXQoJ3N0YXRpY19pbWFnZV91cGxvYWRfZW5kcG9pbnQnKSkge1xuICAgICAgY2FsbGJhY2sgPSB0aGlzLl9leHBvcnRJbWFnZTtcbiAgICB9XG5cbiAgICB0aGlzLl9sb2FkTWFwSW1hZ2UodXJsLCBjYWxsYmFjay5iaW5kKHRoaXMpKTtcbiAgfSxcblxuICBfc2hvd1Jlc3VsdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHRoaXMuX3BhbmVzLmFkZFRhYigncmVzdWx0JyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi9kaWFsb2dzL3N0YXRpY19pbWFnZS9leHBvcnRfaW1hZ2VfcmVzdWx0X3ZpZXcnLCB7XG4gICAgICAgIGNvbHVtbjogdGhpcy5jb2x1bW4sXG4gICAgICAgIHJlc3BvbnNlOiBvcHRpb25zXG4gICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5fcGFuZXMuYWN0aXZlKCdyZXN1bHQnKTtcbiAgICB0aGlzLnRyaWdnZXIoJ2ZpbmlzaCcsIHRoaXMpO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3BhbmVzLmJpbmQoJ3RhYkVuYWJsZWQnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gIH0sXG5cbiAgLyogTG9hZCBmaXJzdCB0aGUgbWFwIGltYWdlIGFuZCB0aGVuIG1lcmdlIHdpdGggdGhlIG92ZXJsYXlzIHJlbmRlcmVkIGZyb250ZW5kIHNpZGUgKi9cbiAgX2xvYWRNYXBJbWFnZTogZnVuY3Rpb24odXJsLCBjYWxsYmFjaykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgbWFwSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICBtYXBJbWFnZS5jcm9zc09yaWdpbiA9ICdBbm9ueW1vdXMnO1xuICAgIG1hcEltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi5fbWVyZ2VBbm5vdGF0aW9ucyhtYXBJbWFnZSwgY2FsbGJhY2spO1xuICAgIH07XG4gICAgbWFwSW1hZ2Uuc3JjID0gdXJsO1xuICB9LFxuXG4gIF9leHBvcnRJbWFnZTogZnVuY3Rpb24oYmFzZTY0SW1hZ2UpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHZpcyA9IHRoaXMub3B0aW9ucy52aXM7XG4gICAgLy8gaW4gY2FzZSBhIGltYWdlIHVwbG9hZGluZyBlbmRwb2ludCBpcyBzZXQgcG9zdCB0aGUgaW1hZ2UgdXJsIHRoZXJlXG4gICAgLy8gYW5kIHNob3cgdGhlIGh0bWwgcGF5bG9hZCB0byB0aGUgdXNlclxuICAgICQuYWpheCh7XG4gICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICB1cmw6IGNkYi5jb25maWcuZ2V0KCdzdGF0aWNfaW1hZ2VfdXBsb2FkX2VuZHBvaW50JyksXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGJhc2U2NGltYWdlOiBiYXNlNjRJbWFnZSxcbiAgICAgICAgbmFtZTogdmlzLmdldCgnbmFtZScpLFxuICAgICAgICB2aXN1YWxpemF0aW9uX3V1aWQ6IHZpcy5nZXQoJ2lkJyksXG4gICAgICAgIGRlc2NyaXB0aW9uOiB2aXMuZ2V0KCdkZXNjcmlwdGlvbicpXG4gICAgICB9LFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24oY29udGVudCkge1xuICAgICAgICBzZWxmLl9zaG93UmVzdWx0KHsgY29udGVudDogY29udGVudCwgdHlwZTogJ2h0bWwnIH0pO1xuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICBjZGIuZWRpdG9yLlZpZXdGYWN0b3J5LmNyZWF0ZURpYWxvZ0J5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvZmFpbCcsIHsgbXNnOiBlcnJvci5lcnJvcnMgfSlcbiAgICAgICAgLnJlbmRlcigpLmFwcGVuZFRvQm9keSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIF9tZXJnZUFubm90YXRpb25zOiBmdW5jdGlvbihtYXBJbWFnZSwgY2FsbGJhY2spIHtcbiAgICB2YXIgeCA9IHRoaXMub3B0aW9ucy54O1xuICAgIHZhciB5ID0gdGhpcy5vcHRpb25zLnk7XG4gICAgdmFyIHdpZHRoID0gdGhpcy5vcHRpb25zLndpZHRoO1xuICAgIHZhciBoZWlnaHQgPSB0aGlzLm9wdGlvbnMuaGVpZ2h0O1xuICAgIHZhciBmb3JtYXQgPSB0aGlzLm9wdGlvbnMuZm9ybWF0O1xuXG4gICAgaWYgKGZvcm1hdCA9PT0gJ2pwZycpIHtcbiAgICAgIGZvcm1hdCA9ICdqcGVnJztcbiAgICB9XG5cbiAgICB2YXIgaW1hZ2VQcm94eVVSTCA9IGNkYi5jb25maWcuZ2V0KCd1cmxfcHJlZml4JykgKyAnL2FwaS92MS9pbWFnZV9wcm94eSc7XG5cbiAgICBodG1sMmNhbnZhcygkKCcuY2FydG9kYi1tYXAnKVswXSwge1xuICAgICAgYWxsb3dUYWludDogZmFsc2UsIC8vIGRvbid0IGFsbG93IG5vbiBjb3JzIGltYWdlcyB0YWludCB0aGUgY2FudmFzXG4gICAgICB0YWludFRlc3Q6IHRydWUsXG4gICAgICAvLyB1c2VDT1JTOiB0cnVlLFxuICAgICAgcHJveHk6IHtcbiAgICAgICAgdXJsOiBpbWFnZVByb3h5VVJMLFxuICAgICAgICBhcGlfa2V5OiB0aGlzLm9wdGlvbnMudXNlci5nZXQoJ2FwaV9rZXknKVxuICAgICAgfSxcbiAgICAgIGJhY2tncm91bmQ6IHVuZGVmaW5lZCwgLy8gZm9yIHRyYW5zcGFyZW50XG4gICAgICAvLyB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBmcm9tIGh0bWwyY2FudmFzIGJlZm9yZSB0aGUgc2NyZWVuc2hvdCBpcyB0YWtlblxuICAgICAgLy8gZmlyc3QgcGFyYW1ldGVyIGlzIGEgY2xvbmUgb2YgdGhlIGN1cnJlbnQgRE9NXG4gICAgICBvbmNsb25lOiBmdW5jdGlvbihjbG9uZWREb20pIHtcbiAgICAgICAgdmFyIGRvYyA9ICQoY2xvbmVkRG9tKTtcbiAgICAgICAgLy8gcmVtb3ZlIGFsbCB0aGUgZWxlbWVudHMgYnV0IGFubm9udGF0aW9ucywgdGV4dCBhbmQgaW1hZ2VcbiAgICAgICAgLy8gaWYgb3RoZXIgZWxlbWVudHMgYXJlIHByZXNlbnQgaXQncyBsaWtlbHkgeW91IGdldCBhIHRhaW50ZWQgY2FudmFzIGJlY2F1c2VcbiAgICAgICAgLy8gaW1hZ2VzIG5vdCBsb2FkZWQgd2l0aCBjb3JzIGVuYWJsZWRcbiAgICAgICAgZG9jLmZpbmQoJy5jYXJ0b2RiLW1hcCA+IGRpdjpub3QoLmFubm90YXRpb24sIC50ZXh0LCAuaW1hZ2UsIC5FeHBvcnRJbWFnZVZpZXcpJykucmVtb3ZlKCk7XG4gICAgICAgIGRvYy5maW5kKCcuRXhwb3J0SW1hZ2VWaWV3JykuYWRkQ2xhc3MoJ2lzLWV4cG9ydGFibGUnKTtcbiAgICAgICAgLy8gZGVmYXVsdCBiYWNrZ3JvdW5kIGNvbG9yIGZvciBsZWFmbGV0IGlzIGdyYXksIHNldCB0byB0cmFuc3BhcmVudCBzbyB0aGUgaW1hZ2VcbiAgICAgICAgLy8gY2FuIGJlIHJlbmRlcmVkIG9uIHRvcCBvZiBtYXAgaW1hZ2VcbiAgICAgICAgZG9jLmZpbmQoJy5jYXJ0b2RiLW1hcCcpLmNzcygnYmFja2dyb3VuZC1jb2xvcicsICd0cmFuc3BhcmVudCcpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0sXG4gICAgICBvbnJlbmRlcmVkOiBmdW5jdGlvbihvdmVybGF5c0NhbnZhcykge1xuICAgICAgICB2YXIgZmluYWxDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgICAgZmluYWxDYW52YXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgZmluYWxDYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICB2YXIgY3R4ID0gZmluYWxDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgLy8gbWFwIGltYWdlIGFscmVhZCBoYXMgdGhlIGZpbmFsIGltYWdlIHNpemUgc28gcmVuZGVyIGZyb20gdGhlIHRvcCxsZWZ0XG4gICAgICAgIGN0eC5kcmF3SW1hZ2UobWFwSW1hZ2UsIDAsIDApO1xuICAgICAgICAvLyBvdmVybGF5IGNhbnZhcyByZW5kZXJzIHRoZSBmdWxsIG1hcCBzaXplIHNvIGNyb3AgaXRcbiAgICAgICAgY3R4LmRyYXdJbWFnZShvdmVybGF5c0NhbnZhcywgeCwgeSwgd2lkdGgsIGhlaWdodCwgMCwgMCwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgIGNhbGxiYWNrKGZpbmFsQ2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvJyArIGZvcm1hdCkpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIG9rOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH0sXG5cbiAgX29uSW5wdXRDbGljazogZnVuY3Rpb24oZSkge1xuICAgICQoZS50YXJnZXQpLmZvY3VzKCkuc2VsZWN0KCk7XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogU3luYyBpbnRlcnZhbFxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICB0YWdOYW1lOiBcImxpXCIsXG5cbiAgY2xhc3NOYW1lOiBcIk1vZGFsLWxpc3RGb3JtSXRlbVwiLFxuXG4gIGV2ZW50czoge1xuICAgIFwiY2xpY2tcIjogXCJfb25DbGlja1wiXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fc2V0dXBNb2RlbCgpO1xuICAgIHRoaXMuX3RlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3Mvc3luY19kYXRhc2V0L2ludGVydmFsX3RlbXBsYXRlJyk7XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcbiAgICB0aGlzLiRlbC5odG1sKHRoaXMuX3RlbXBsYXRlKHRoaXMubW9kZWwuYXR0cmlidXRlcykpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlOmNoZWNrZWQnLCB0aGlzLl9vblRvZ2dsZUNoZWNrZWQsIHRoaXMpO1xuICB9LFxuXG4gIF9zZXR1cE1vZGVsOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsID0gdGhpcy5vcHRpb25zLm1vZGVsO1xuICAgIHRoaXMubW9kZWwuc2V0KCdpZCcsIHRoaXMuY2lkKTtcbiAgfSxcblxuICBfb25DbGljazogZnVuY3Rpb24oZSkge1xuICAgIHRoaXMua2lsbEV2ZW50KGUpO1xuXG4gICAgaWYgKCF0aGlzLm1vZGVsLmdldChcImRpc2FibGVkXCIpKSB7XG4gICAgICB0aGlzLm1vZGVsLnNldChcImNoZWNrZWRcIiwgdHJ1ZSk7XG4gICAgICB0aGlzLnRyaWdnZXIoXCJjaGVja2VkXCIsIHRoaXMubW9kZWwsIHRoaXMpO1xuICAgIH1cbiAgfSxcblxuICBfb25Ub2dnbGVDaGVja2VkOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnJlbmRlcigpO1xuICB9XG59KTtcbiIsInZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyIEJhY2tib25lID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ0JhY2tib25lJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydCYWNrYm9uZSddIDogbnVsbCk7XG52YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBCYXNlRGlhbG9nID0gcmVxdWlyZSgnLi4vLi4vdmlld3MvYmFzZV9kaWFsb2cvdmlldycpO1xudmFyIEludGVydmFsVmlldyA9IHJlcXVpcmUoJy4vaW50ZXJ2YWxfdmlldycpO1xudmFyIHJhbmRvbVF1b3RlID0gcmVxdWlyZSgnLi4vLi4vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZScpO1xuXG4vKipcbiAqIFN5bmMgbW9kYWxcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBCYXNlRGlhbG9nLmV4dGVuZCh7XG5cbiAgX0lOVEVSVkFMUzogW1xuICAgIHsgbmFtZTogJ0V2ZXJ5IGhvdXInLCB0aW1lOiA2MCAqIDYwLCB0eXBlOiAnaG91cmx5JywgaWZfZXh0ZXJuYWxfc291cmNlOiBmYWxzZSB9LFxuICAgIHsgbmFtZTogJ0V2ZXJ5IGRheScsIHRpbWU6IDYwICogNjAgKiAyNCwgdHlwZTogJ2RhaWx5JywgaWZfZXh0ZXJuYWxfc291cmNlOiBmYWxzZSB9LFxuICAgIHsgbmFtZTogJ0V2ZXJ5IHdlZWsnLCB0aW1lOiA2MCAqIDYwICogMjQgKiA3LCB0eXBlOiAnd2Vla2x5JywgaWZfZXh0ZXJuYWxfc291cmNlOiBmYWxzZSB9LFxuICAgIHsgbmFtZTogJ0V2ZXJ5IG1vbnRoJywgdGltZTogNjAgKiA2MCAqIDI0ICogMzAsIHR5cGU6ICdtb250aGx5JywgaWZfZXh0ZXJuYWxfc291cmNlOiB0cnVlIH0sXG4gICAgeyBuYW1lOiAnTmV2ZXInLCB0aW1lOiAwLCB0eXBlOiAnbmV2ZXInLCBpZl9leHRlcm5hbF9zb3VyY2U6IHRydWUgfVxuICBdLFxuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtY2FuY2VsJzogJ19jYW5jZWwnLFxuICAgICdjbGljayAuanMtY29uZmlybSc6ICdfb2snXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMudGFibGUpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3RhYmxlIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcblxuICAgIHRoaXMubW9kZWwgPSBuZXcgY2RiLmNvcmUuTW9kZWwoe1xuICAgICAgb3B0aW9uOiAnaW50ZXJ2YWwnLFxuICAgICAgc3RhdGU6ICdwcmVmZXRjaGluZycsXG4gICAgICB3YWl0OiB0cnVlIC8vIGF3YWl0IGFjayBiZWZvcmUgY2hhbmdpbmcgbW9kZWxcbiAgICB9KTtcbiAgICB0aGlzLnRhYmxlID0gdGhpcy5vcHRpb25zLnRhYmxlO1xuXG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG5cbiAgICAvLyBQcmVmZXRjaFxuICAgIHRoaXMudGFibGUuZmV0Y2goe1xuICAgICAgc3VjY2VzczogdGhpcy5fb25GZXRjaGVkVGFibGUuYmluZCh0aGlzKSxcbiAgICAgIGVycm9yOiB0aGlzLl9zZXR0ZXJGb3JEZWZhdWx0RXJyb3JTdGF0ZSgpXG4gICAgfSk7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6c3RhdGUnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gIH0sXG5cbiAgLy8gaW1wbGVtZW50cyBjZGIudWkuY29tbW9uLkRpYWxvZy5wcm90b3R5cGUucmVuZGVyXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgQmFzZURpYWxvZy5wcm90b3R5cGUucmVuZGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5faW5pdEludGVydmFscygpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIC8vIGltcGxlbWVudHMgY2RiLnVpLmNvbW1vbi5EaWFsb2cucHJvdG90eXBlLnJlbmRlclxuICByZW5kZXJfY29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgc3dpdGNoICh0aGlzLm1vZGVsLmdldCgnc3RhdGUnKSkge1xuICAgICAgY2FzZSAncHJlZmV0Y2hpbmcnOlxuICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyTG9hZGluZygnQ2hlY2tpbmcgc3luY2hyb25pemF0aW9uJyk7XG4gICAgICBjYXNlICdlcnJvcic6XG4gICAgICAgIHJldHVybiB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vdGVtcGxhdGVzL2ZhaWwnKSh7IG1zZzogJycgfSk7XG4gICAgICBjYXNlICdzYXZpbmcnOlxuICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyTG9hZGluZygnU2F2aW5n4oCmJyk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRUZW1wbGF0ZSgnY29tbW9uL2RpYWxvZ3Mvc3luY19kYXRhc2V0L3N5bmNfZGF0YXNldCcpKHtcbiAgICAgICAgICBzZXJ2aWNlOiB0aGlzLl9zZXJ2aWNlTmFtZSgpLFxuICAgICAgICAgIHVybDogdGhpcy5fc2VydmljZVVSTCgpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBfb25GZXRjaGVkVGFibGU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuc2V0KHtcbiAgICAgIHN0YXRlOiAnaWRsZScsXG4gICAgICBpbnRlcnZhbDogdGhpcy50YWJsZS5zeW5jaHJvbml6YXRpb24uZ2V0KCdpbnRlcnZhbCcpXG4gICAgfSk7XG4gIH0sXG5cbiAgX3JlbmRlckxvYWRpbmc6IGZ1bmN0aW9uKHRpdGxlKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycpKHtcbiAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgIHF1b3RlOiByYW5kb21RdW90ZSgpXG4gICAgfSk7XG4gIH0sXG5cbiAgX3NlcnZpY2VVUkw6IGZ1bmN0aW9uKCkge1xuICAgIC8vIERvZXMgaXQgY29tZSBmcm9tIGEgZGF0YXNvdXJjZSBzZXJ2aWNlIChEcm9wYm94LCBHRHJpdmUsIC4uLik/XG4gICAgaWYgKHRoaXMudGFibGUuc3luY2hyb25pemF0aW9uLmdldCgnc2VydmljZV9uYW1lJykgfHwgdGhpcy50YWJsZS5zeW5jaHJvbml6YXRpb24uZ2V0KCdzZXJ2aWNlX2l0ZW1faWQnKSkge1xuICAgICAgcmV0dXJuIHRoaXMudGFibGUuc3luY2hyb25pemF0aW9uLmdldCgnc2VydmljZV9pdGVtX2lkJyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnRhYmxlLnN5bmNocm9uaXphdGlvbi5nZXQoJ3VybCcpO1xuICB9LFxuXG4gIF9zZXJ2aWNlTmFtZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5hbWUgPSB0aGlzLnRhYmxlLnN5bmNocm9uaXphdGlvbi5nZXQoJ3NlcnZpY2VfbmFtZScpO1xuICAgIGlmIChuYW1lICYmIF8uaXNTdHJpbmcobmFtZSkpIHtcbiAgICAgIHJldHVybiBjZGIuVXRpbHMuY2FwaXRhbGl6ZShuYW1lKTtcbiAgICB9XG4gIH0sXG5cbiAgX2luaXRJbnRlcnZhbHM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2ludGVydmFscyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG5cbiAgICB2YXIgZnJvbUV4dGVybmFsU291cmNlID0gdGhpcy50YWJsZS5zeW5jaHJvbml6YXRpb24uZnJvbV9leHRlcm5hbF9zb3VyY2U7XG5cbiAgICBfLmVhY2godGhpcy5fSU5URVJWQUxTLCBmdW5jdGlvbihpbnRlcnZhbCkge1xuICAgICAgdmFyIGRpc2FibGVkID0gZnJvbUV4dGVybmFsU291cmNlICYmICFpbnRlcnZhbC5pZl9leHRlcm5hbF9zb3VyY2U7XG5cbiAgICAgIHRoaXMuX2ludGVydmFscy5hZGQoe1xuICAgICAgICBuYW1lOiBpbnRlcnZhbC5uYW1lLFxuICAgICAgICBpbnRlcnZhbDogaW50ZXJ2YWwudGltZSxcbiAgICAgICAgY2hlY2tlZDogdGhpcy50YWJsZS5zeW5jaHJvbml6YXRpb24uZ2V0KFwiaW50ZXJ2YWxcIikgPT09IGludGVydmFsLnRpbWUsXG4gICAgICAgIGRpc2FibGVkOiBkaXNhYmxlZFxuICAgICAgfSk7XG4gICAgfSwgdGhpcyk7XG5cbiAgICB0aGlzLl9pbnRlcnZhbHMuZWFjaChmdW5jdGlvbihpbnRlcnZhbCkge1xuICAgICAgdmFyIHZpZXcgPSBuZXcgSW50ZXJ2YWxWaWV3KHsgbW9kZWw6IGludGVydmFsIH0pO1xuICAgICAgdmlldy5iaW5kKFwiY2hlY2tlZFwiLCB0aGlzLl9vbkludGVydmFsQ2hlY2tlZCwgdGhpcyk7XG4gICAgICB0aGlzLiQoXCIuanMtaW50ZXJ2YWxzXCIpLmFwcGVuZCh2aWV3LnJlbmRlcigpLiRlbCk7XG4gICAgICB0aGlzLmFkZFZpZXcodmlldyk7XG4gICAgfSwgdGhpcyk7XG4gIH0sXG5cbiAgX29uSW50ZXJ2YWxDaGVja2VkOiBmdW5jdGlvbihpbnRlcnZhbCkge1xuICAgIHRoaXMuX2ludGVydmFscy5lYWNoKGZ1bmN0aW9uKGkpIHtcbiAgICAgIGlmIChpbnRlcnZhbC5nZXQoXCJpbnRlcnZhbFwiKSAhPT0gaS5nZXQoXCJpbnRlcnZhbFwiKSkge1xuICAgICAgICBpLnNldChcImNoZWNrZWRcIiwgZmFsc2UpO1xuICAgICAgfVxuICAgIH0sIHRoaXMpO1xuICB9LFxuXG4gIF9nZXRTZWxlY3RlZEludGVydmFsOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5faW50ZXJ2YWxzLmZpbmQoZnVuY3Rpb24oaW50ZXJ2YWwpIHtcbiAgICAgIHJldHVybiBpbnRlcnZhbC5nZXQoXCJjaGVja2VkXCIpXG4gICAgfSk7XG4gIH0sXG5cbiAgX2FkZFRhYjogZnVuY3Rpb24obmFtZSwgdmlldykge1xuICAgIHRoaXMuX2NvbnRlbnRQYW5lLmFkZFRhYihuYW1lLCB2aWV3LnJlbmRlcigpKTtcbiAgICB0aGlzLmFkZFZpZXcodmlldyk7XG4gIH0sXG5cbiAgb2s6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxlY3RlZEludGVydmFsID0gdGhpcy5fZ2V0U2VsZWN0ZWRJbnRlcnZhbCgpO1xuXG4gICAgaWYgKHNlbGVjdGVkSW50ZXJ2YWwpIHtcbiAgICAgIHRoaXMubW9kZWwuc2V0KCdzdGF0ZScsICdzYXZpbmcnKTtcbiAgICAgIHZhciBjYWxsYmFja3MgPSB7XG4gICAgICAgIHN1Y2Nlc3M6IHRoaXMuY2xvc2UuYmluZCh0aGlzKSxcbiAgICAgICAgZXJyb3I6IHRoaXMuX3NldHRlckZvckRlZmF1bHRFcnJvclN0YXRlKClcbiAgICAgIH07XG5cbiAgICAgIHZhciBpbnRlcnZhbCA9IHNlbGVjdGVkSW50ZXJ2YWwuZ2V0KCdpbnRlcnZhbCcpO1xuICAgICAgaWYgKGludGVydmFsKSB7XG4gICAgICAgIHRoaXMudGFibGUuc3luY2hyb25pemF0aW9uLnNhdmUoe1xuICAgICAgICAgIGludGVydmFsOiBpbnRlcnZhbFxuICAgICAgICB9LCBjYWxsYmFja3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy50YWJsZS5zeW5jaHJvbml6YXRpb24uZGVzdHJveShjYWxsYmFja3MpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9LFxuXG4gIF9zZXR0ZXJGb3JEZWZhdWx0RXJyb3JTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwuc2V0LmJpbmQodGhpcy5tb2RlbCwgJ3N0YXRlJywgJ2Vycm9yJyk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBFZGl0RmllbGRWaWV3ID0gcmVxdWlyZSgnLi4vZWRpdF9maWVsZF92aWV3Jyk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xuXG4vKipcbiAqICBCb29sZWFuIGZpZWxkXG4gKiAgXG4gKiAgQ2hvb3NpbmcgYmV0d2VlbiB0cnVlLCBmYWxzZSBvciBudWxsXG4gKlxuICogIG5ldyBCb29sZWFuRmllbGRWaWV3KHtcbiAqICAgIG1vZGVsOiBuZXcgRWRpdEZpZWxkTW9kZWwoeyBhdHRyaWJ1dGU6ICdjb2x1bW4nLCB2YWx1ZTogJ3BhY28nIH0pLFxuICogICAgb3B0aW9uOiBmYWxzZVxuICogIH0pXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBFZGl0RmllbGRWaWV3LmV4dGVuZCh7XG5cbiAgb3B0aW9uczoge1xuICAgIHRlbXBsYXRlOiAnY29tbW9uL2VkaXRfZmllbGRzL2Jvb2xlYW5fZmllbGQvYm9vbGVhbl9maWVsZCdcbiAgfSxcblxuICBldmVudHM6IHtcbiAgICAnY2xpY2sgLmpzLXRydWUnOiAnX29uVHJ1ZUNsaWNrJyxcbiAgICAnY2xpY2sgLmpzLWZhbHNlJzogJ19vbkZhbHNlQ2xpY2snLFxuICAgICdjbGljayAuanMtbnVsbCc6ICdfb25OdWxsQ2xpY2snXG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2UnLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gIH0sXG5cbiAgX29uVHJ1ZUNsaWNrOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLnNldCgndmFsdWUnLCB0cnVlKTtcbiAgfSxcblxuICBfb25GYWxzZUNsaWNrOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLnNldCgndmFsdWUnLCBmYWxzZSk7XG4gIH0sXG5cbiAgX29uTnVsbENsaWNrOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLnNldCgndmFsdWUnLCBudWxsKTtcbiAgfVxuXG59KVxuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgRWRpdEZpZWxkVmlldyA9IHJlcXVpcmUoJy4uL2VkaXRfZmllbGRfdmlldycpO1xudmFyIERhdGVQaWNrZXJWaWV3ID0gcmVxdWlyZSgnLi9kYXRlX3BpY2tlci9kYXRlX3BpY2tlcl92aWV3Jyk7XG52YXIgVGltZUlucHV0VmlldyA9IHJlcXVpcmUoJy4vdGltZV9pbnB1dC90aW1lX2lucHV0X3ZpZXcnKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG5cbi8qKlxuICogIERhdGUgZmllbGRcbiAqICBcbiAqICBQbGFjZSB0byBjaGFuZ2UgYSBkYXRlIHZhbHVlXG4gKlxuICogIG5ldyBEYXRlRmllbGRWaWV3KHtcbiAqICAgIG1vZGVsOiBuZXcgRWRpdEZpZWxkTW9kZWwoeyB0eXBlOiAnZGF0ZScsIGF0dHJpYnV0ZTogJ2NvbHVtbicsIHZhbHVlOiAncGFjbycgfSksXG4gKiAgICBvcHRpb246IGZhbHNlXG4gKiAgfSlcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IEVkaXRGaWVsZFZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdFZGl0RmllbGQgRWRpdEZpZWxkLS13aXRoQm9yZGVyIEVkaXRGaWVsZC0td2l0aFNlcGFyYXRvcicsXG5cbiAgb3B0aW9uczoge1xuICAgIHNob3dUaW1lOiB0cnVlLFxuICAgIHNob3dHTVQ6IGZhbHNlLFxuICAgIHRpbWV6b25lOiAnWicgLy8gSW4gUG9zdGdyZVNRTCAnWicgaXMgdGhlIHNhbWUgYXMgKzAwOjAwXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcbiAgICB0aGlzLl9pbml0Vmlld3MoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICAvLyBEYXRlIHBpY2tlclxuICAgIHRoaXMuZGF0ZVBpY2tlciA9IG5ldyBEYXRlUGlja2VyVmlldyh7XG4gICAgICBtb2RlbDogdGhpcy5tb2RlbFxuICAgIH0pO1xuXG4gICAgdGhpcy5kYXRlUGlja2VyLmJpbmQoJ29uRGF0ZUNoYW5nZScsIHRoaXMuX3NldERhdGUsIHRoaXMpO1xuICAgIHRoaXMuJGVsLmFwcGVuZCh0aGlzLmRhdGVQaWNrZXIucmVuZGVyKCkuZWwpO1xuICAgIHRoaXMuYWRkVmlldyh0aGlzLmRhdGVQaWNrZXIpO1xuICAgICBcbiAgICAvLyBUaW1lIGlucHV0XG4gICAgaWYgKHRoaXMub3B0aW9ucy5zaG93VGltZSkge1xuICAgICAgdGhpcy50aW1lSW5wdXQgPSBuZXcgVGltZUlucHV0Vmlldyh7XG4gICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsXG4gICAgICB9KTtcblxuICAgICAgdGhpcy4kZWwuYXBwZW5kKHRoaXMudGltZUlucHV0LnJlbmRlcigpLmVsKTtcbiAgICAgIHRoaXMudGltZUlucHV0LmJpbmQoJ29uVGltZUNoYW5nZScsIHRoaXMuX3NldFRpbWUsIHRoaXMpO1xuICAgICAgdGhpcy50aW1lSW5wdXQuYmluZCgnb25TdWJtaXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyKCdvblN1Ym1pdCcsIHRoaXMubW9kZWwsIHRoaXMpO1xuICAgICAgfSwgdGhpcyk7XG4gICAgICB0aGlzLmFkZFZpZXcodGhpcy50aW1lSW5wdXQpO1xuICAgIH1cbiAgfSxcblxuICBfc2V0VGltZTogZnVuY3Rpb24odGltZSkge1xuICAgIHZhciBvbGREYXRlID0gbW9tZW50KHRoaXMubW9kZWwuZ2V0KCd2YWx1ZScpKTtcbiAgICB2YXIgbmV3RGF0ZSA9IG1vbWVudChuZXcgRGF0ZSgpKTtcbiAgICB2YXIgZGF0ZTtcblxuICAgIGlmIChvbGREYXRlLmlzVmFsaWQoKSkge1xuICAgICAgb2xkRGF0ZVxuICAgICAgICAuaG91cihuZXdEYXRlLmhvdXIoKSlcbiAgICAgICAgLm1pbnV0ZXMobmV3RGF0ZS5taW51dGVzKCkpXG4gICAgICAgIC5zZWNvbmRzKG5ld0RhdGUuc2Vjb25kcygpKTtcbiAgICAgIGRhdGUgPSBvbGREYXRlLmZvcm1hdCgnWVlZWS1NTS1ERFQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGF0ZSA9IG5ld0RhdGUuZm9ybWF0KCdZWVlZLU1NLUREVCcpO1xuICAgIH1cblxuICAgIHRoaXMubW9kZWwuc2V0KCd2YWx1ZScsIGRhdGUgKyB0aW1lICsgdGhpcy5vcHRpb25zLnRpbWV6b25lKTtcbiAgfSxcblxuICBfc2V0RGF0ZTogZnVuY3Rpb24oZGF0ZSkge1xuICAgIHZhciBvbGREYXRlID0gbW9tZW50KHRoaXMubW9kZWwuZ2V0KCd2YWx1ZScpKTtcbiAgICB2YXIgbmV3RGF0ZSA9IG1vbWVudChkYXRlKTtcbiAgICB2YXIgZGF0ZVN0cjtcblxuICAgIGlmIChvbGREYXRlLmlzVmFsaWQoKSkge1xuICAgICAgb2xkRGF0ZVxuICAgICAgICAubW9udGgobmV3RGF0ZS5tb250aCgpKVxuICAgICAgICAuZGF0ZShuZXdEYXRlLmRhdGUoKSlcbiAgICAgICAgLnllYXIobmV3RGF0ZS55ZWFyKCkpO1xuICAgICAgZGF0ZVN0ciA9IG9sZERhdGUuZm9ybWF0KCdZWVlZLU1NLUREVEhIOm1tOnNzJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRhdGVTdHIgPSBuZXdEYXRlLmZvcm1hdCgnWVlZWS1NTS1ERFRISDptbTpzcycpO1xuICAgIH1cblxuICAgIHRoaXMubW9kZWwuc2V0KCd2YWx1ZScsIGRhdGVTdHIgKyB0aGlzLm9wdGlvbnMudGltZXpvbmUpO1xuICB9XG5cbn0pXG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG52YXIgbW9tZW50ID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ21vbWVudCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnbW9tZW50J10gOiBudWxsKTtcblxuLyoqXG4gKiBEcm9wZG93biBmb3IgYSBjYWxlbmRhciBzZWxlY3Rvci5cbiAqIFVzZXMgdGhlIERhdGVQaWNrZXIgcGx1Z2luIGludGVybmFsbHkgdG8gcmVuZGVyIHRoZSBjYWxlbmRhciBhbmQgdmlldyBiZWhhdmlvdXIuXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuYWRtaW4uRHJvcGRvd25NZW51LmV4dGVuZCh7XG5cbiAgY2xhc3NOYW1lOiAnRHJvcGRvd24nLFxuXG4gIC8vIGRlZmF1bHRzLCB1c2VkIGZvclxuICBvcHRpb25zOiB7XG4gICAgZmxhdDogdHJ1ZSxcbiAgICBkYXRlOiAnMjAwOC0wNy0wMScsXG4gICAgY3VycmVudDogJzIwMDgtMDctMzEnLFxuICAgIGNhbGVuZGFyczogMSxcbiAgICBzdGFydHM6IDFcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMubW9kZWwpIHRocm93IG5ldyBFcnJvcignbW9kZWwgaXMgcmVxdWlyZWQnKTtcbiAgICB0aGlzLmVsZGVyKCdpbml0aWFsaXplJyk7XG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9lZGl0X2ZpZWxkcy9kYXRlX2ZpZWxkL2RhdGVfcGlja2VyL2NhbGVuZGFyX2Ryb3Bkb3duJyk7XG4gICAgdGhpcy5faW5pdERlZmF1bHRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGhpcy50ZW1wbGF0ZSh7XG4gICAgICAgIGluaXRpYWxEYXRlU3RyOiBtb21lbnQodGhpcy5tb2RlbC5nZXQoJ3ZhbHVlJykpLmZvcm1hdCgnWVlZWS1NTS1ERCcpXG4gICAgICB9KVxuICAgICk7XG5cbiAgICBjZGIuZ29kLmJpbmQoJ2Nsb3NlRGlhbG9ncycsIHRoaXMuaGlkZSwgdGhpcyk7XG4gICAgJCgnYm9keScpLmFwcGVuZCh0aGlzLmVsKTtcbiAgICB0aGlzLl9pbml0Q2FsZW5kYXIoKTsgLy8gbXVzdCBiZSBjYWxsZWQgYWZ0ZXIgZWxlbWVudCBpcyBhZGRlZCB0byBib2R5IVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgY2xlYW46IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuXyRjYWxlbmRhcigpLkRhdGVQaWNrZXJIaWRlKCk7XG4gICAgY2RiLmFkbWluLkRyb3Bkb3duTWVudS5wcm90b3R5cGUuY2xlYW4uY2FsbCh0aGlzKTtcbiAgfSxcblxuICBfaW5pdERlZmF1bHRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgdXRjID0gbmV3IERhdGUoKS5nZXRUaW1lem9uZU9mZnNldCgpO1xuICAgIHZhciB0b2RheSA9IG1vbWVudChuZXcgRGF0ZSgpKS51dGNPZmZzZXQodXRjKS5mb3JtYXQoJ1lZWVktTU0tREQnKTtcbiAgICB0aGlzLm9wdGlvbnMuZGF0ZSA9IHRoaXMubW9kZWwuZ2V0KCd2YWx1ZScpICYmIG1vbWVudCh0aGlzLm1vZGVsLmdldCgndmFsdWUnKSkuZm9ybWF0KCdZWVlZLU1NLUREJykgfHwgdG9kYXk7XG4gICAgdGhpcy5vcHRpb25zLmN1cnJlbnQgPSB0aGlzLm9wdGlvbnMuZGF0ZTtcbiAgfSxcblxuICAvLyBzaG91bGQgbm90IGJlIGNhbGxlZCB1bnRpbCBlbGVtZW50IGlzIGxvY2F0ZWQgaW4gZG9jdW1lbnRcbiAgX2luaXRDYWxlbmRhcjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuXyRjYWxlbmRhcigpLkRhdGVQaWNrZXIoXG4gICAgICBfLmV4dGVuZCh0aGlzLm9wdGlvbnMsIHRoaXMubW9kZWwuYXR0cmlidXRlcywge1xuICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24oZm9ybWF0dGVkLCBkYXRlKSB7XG4gICAgICAgICAgc2VsZi50cmlnZ2VyKCdvbkRhdGVTZWxlY3RlZCcsIGRhdGUsIHRoaXMpO1xuICAgICAgICAgIHNlbGYuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG4gIH0sXG5cbiAgXyRjYWxlbmRhcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuJCgnLmpzLWNhbGVuZGFyJyk7XG4gIH1cblxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG52YXIgbW9tZW50ID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ21vbWVudCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnbW9tZW50J10gOiBudWxsKTtcbnZhciBDYWxlbmRhckRyb3Bkb3duID0gcmVxdWlyZSgnLi9jYWxlbmRhcl9kcm9wZG93bl92aWV3LmpzJyk7XG5cbi8qKlxuICogRGF0ZSBwaWNrZXIgZm9yIGEgc2luZ2xlIGRhdGUuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmFkbWluLkRyb3Bkb3duTWVudS5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ0RhdGVQaWNrZXInLFxuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtZGF0ZS1waWNrZXInOiAnX29uQ2xpY2tEYXRlQnRuJ1xuICB9LFxuXG4gIG9wdGlvbnM6IHtcbiAgICB2ZXJ0aWNhbF9wb3NpdGlvbjogJ2Rvd24nLFxuICAgIHRpY2s6ICdjZW50ZXInLFxuICAgIGRhdGVGb3JtYXQ6ICdZWVlZLU1NLUREJ1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkYXRlID0gdGhpcy5tb2RlbC5nZXQoJ3ZhbHVlJykgfHwgbmV3IERhdGUoKTtcblxuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vZWRpdF9maWVsZHMvZGF0ZV9maWVsZC9kYXRlX3BpY2tlci9kYXRlX3BpY2tlcicpKHtcbiAgICAgICAgcmVhZE9ubHk6IHRoaXMubW9kZWwuZ2V0KCdyZWFkT25seScpLFxuICAgICAgICBkYXRlOiBtb21lbnQoZGF0ZSkuZm9ybWF0KHRoaXMub3B0aW9ucy5kYXRlRm9ybWF0KVxuICAgICAgfSlcbiAgICApO1xuXG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdyZWFkT25seScpKSB7XG4gICAgICB0aGlzLnVuZGVsZWdhdGVFdmVudHMoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgfSxcblxuICBfb25DbGlja0RhdGVCdG46IGZ1bmN0aW9uKGV2KSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZXYpO1xuXG4gICAgLy8gQmVoYXZlIGxpa2UgYSB0b2dnbGVcbiAgICBpZiAodGhpcy5fY2FsZW5kYXIpIHtcbiAgICAgIHRoaXMuX2Rlc3Ryb3lDYWxlbmRhckRyb3Bkb3duKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2NhbGVuZGFyID0gbmV3IENhbGVuZGFyRHJvcGRvd24oXG4gICAgICAgIF8uZXh0ZW5kKHRoaXMub3B0aW9ucywge1xuICAgICAgICAgIHRhcmdldDogJChldi50YXJnZXQpLmNsb3Nlc3QoJ2J1dHRvbicpLFxuICAgICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgICAgdGhpcy5hZGRWaWV3KHRoaXMuX2NhbGVuZGFyKTtcbiAgICAgIHRoaXMuX2NhbGVuZGFyLnJlbmRlcigpO1xuICAgICAgdGhpcy5fY2FsZW5kYXIub24oJ29uRHJvcGRvd25IaWRkZW4nLCB0aGlzLl9kZXN0cm95Q2FsZW5kYXJEcm9wZG93biwgdGhpcyk7XG4gICAgICB0aGlzLl9jYWxlbmRhci5vbignb25EYXRlU2VsZWN0ZWQnLCBmdW5jdGlvbihkYXRlKSB7XG4gICAgICAgIHRoaXMudHJpZ2dlcignb25EYXRlQ2hhbmdlJywgZGF0ZSwgdGhpcyk7XG4gICAgICB9LCB0aGlzKTtcbiAgICAgIHRoaXMuX2NhbGVuZGFyLm9wZW4oKTtcbiAgICB9XG4gIH0sXG5cbiAgX2Rlc3Ryb3lDYWxlbmRhckRyb3Bkb3duOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9jYWxlbmRhci5vcHRpb25zLnRhcmdldC51bmJpbmQoJ2NsaWNrJywgdGhpcy5fY2FsZW5kYXIuX2hhbmRsZUNsaWNrKTtcbiAgICB0aGlzLl9jYWxlbmRhci5jbGVhbigpO1xuICAgIHRoaXMuX2NhbGVuZGFyID0gbnVsbDtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG5cbi8qKlxuICogIFRpbWUgaW5wdXQgZm9yIGRhdGUgZmllbGRcbiAqICBcbiAqICBQbGFjZSB0byBjaGFuZ2UgaG91cnMsIG1pbnV0ZXMgYW5kIHNlY29uZHNcbiAqICBmb3IgdGhlIGRhdGUgZmllbGQuXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuVmlldy5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ1RpbWVJbnB1dCcsXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2tleWRvd24gLmpzLWlucHV0JzogJ19vbktleURvd24nLFxuICAgICdrZXl1cCAuanMtaW5wdXQnOiAnX29uS2V5VXAnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi9lZGl0X2ZpZWxkcy9kYXRlX2ZpZWxkL3RpbWVfaW5wdXQvdGltZV9pbnB1dCcpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGRhdGUgPSB0aGlzLm1vZGVsLmdldCgndmFsdWUnKSB8fCBuZXcgRGF0ZSgpO1xuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0aGlzLnRlbXBsYXRlKHtcbiAgICAgICAgcmVhZE9ubHk6IHRoaXMubW9kZWwuZ2V0KCdyZWFkT25seScpLFxuICAgICAgICB0aW1lOiBtb21lbnQoZGF0ZSkuZm9ybWF0KCdISDptbTpzcycpXG4gICAgICB9KVxuICAgIClcblxuICAgIGlmICh0aGlzLm1vZGVsLmdldCgncmVhZE9ubHknKSkge1xuICAgICAgdGhpcy51bmRlbGVnYXRlRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX29uS2V5RG93bjogZnVuY3Rpb24oZXYpIHtcbiAgICBpZiAoZXYua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLnRyaWdnZXIoJ29uU3VibWl0JywgdGhpcyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9LFxuXG4gIF9vbktleVVwOiBmdW5jdGlvbihldikge1xuICAgIHZhciB2YWx1ZSA9ICQoZXYudGFyZ2V0KS52YWwoKTtcbiAgICB0aGlzLnRyaWdnZXIoJ29uVGltZUNoYW5nZScsIHZhbHVlLCB0aGlzKTtcbiAgfVxuXG59KVxuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgbW9tZW50ID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ21vbWVudCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnbW9tZW50J10gOiBudWxsKTtcblxuLyoqXG4gKiAgRGVmYXVsdCBtb2RlbCBmb3IgZWFjaCBmaWVsZCBtb2RlbFxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgZGVmYXVsdHM6IHtcbiAgICBhdHRyaWJ1dGU6ICcnLFxuICAgIHZhbHVlOiAnJyxcbiAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICByZWFkT25seTogZmFsc2VcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAvLyBWYWxpZGF0aW9uIGNvbnRyb2wgdmFyaWFibGVcbiAgICB0aGlzLnZhbGlkYXRpb25FcnJvciA9ICcnO1xuICAgIHRoaXMuYmluZCgndmFsaWQnLCBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMudmFsaWRhdGlvbkVycm9yID0gJyc7XG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy5iaW5kKCdlcnJvcicsIGZ1bmN0aW9uKG0sIGVycm9yKSB7XG4gICAgICB0aGlzLnZhbGlkYXRpb25FcnJvciA9IGVycm9yO1xuICAgIH0pO1xuICB9LFxuXG4gIF92YWxpZGF0ZTogZnVuY3Rpb24oYXR0cnMsIG9wdGlvbnMpIHtcbiAgICB2YXIgdmFsaWQgPSBjZGIuY29yZS5Nb2RlbC5wcm90b3R5cGUuX3ZhbGlkYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgaWYgKHZhbGlkKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ3ZhbGlkJylcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9LFxuXG4gIHZhbGlkYXRlOiBmdW5jdGlvbihhdHRycykge1xuICAgIGlmICghYXR0cnMpIHJldHVybjtcblxuICAgIHZhciB2YWwgPSBhdHRycy52YWx1ZTtcbiAgICB2YXIgdHlwZSA9IGF0dHJzLnR5cGU7XG5cbiAgICBpZiAoYXR0cnMudHlwZSA9PT0gXCJudW1iZXJcIikge1xuICAgICAgdmFyIHBhdHRlcm4gPSAvXihcXCt8LSk/KD86WzAtOV0rfFswLTldKlxcLlswLTldKykkLztcbiAgICAgIGlmICh2YWwgJiYgIXBhdHRlcm4udGVzdCh2YWwpKSB7XG4gICAgICAgIHJldHVybiBcIkludmFsaWQgbnVtYmVyXCJcbiAgICAgIH0gIFxuICAgIH1cblxuICAgIGlmICh0eXBlID09PSBcImJvb2xlYW5cIikge1xuICAgICAgaWYgKHZhbCAhPT0gbnVsbCAmJiB2YWwgIT09IHRydWUgJiYgdmFsICE9PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gXCJJbnZhbGlkIGJvb2xlYW5cIlxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0eXBlID09PSBcImRhdGVcIikge1xuICAgICAgaWYgKHZhbCAmJiAhbW9tZW50KHZhbCkuaXNWYWxpZCgpKSB7XG4gICAgICAgIHJldHVybiBcIkludmFsaWQgZGF0ZVwiXG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIGdldEVycm9yOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy52YWxpZGF0aW9uRXJyb3I7XG4gIH0sXG5cbiAgaXNWYWxpZDogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLnZhbGlkYXRlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuICF0aGlzLnZhbGlkYXRlKHRoaXMuYXR0cmlidXRlcykgJiYgdGhpcy52YWxpZGF0aW9uRXJyb3IgPT09IFwiXCI7XG4gIH1cblxufSlcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqICBDb21tb24gZWRpdCBmaWVsZCB2aWV3XG4gKiAgXG4gKi9cblxuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdFZGl0RmllbGQnLFxuXG4gIG9wdGlvbnM6IHtcbiAgICB0ZW1wbGF0ZTogJ2NvbW1vbi9lZGl0X2ZpZWxkcy9lZGl0X2ZpZWxkJyxcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMubW9kZWwpIHtcbiAgICAgIHRoaXMubW9kZWwgPSBuZXcgY2RiLmNvcmUuTW9kZWwoeyB2YWx1ZTogJycgfSk7XG4gICAgfVxuICAgIGlmICh0aGlzLm9wdGlvbnMudGVtcGxhdGUpIHtcbiAgICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKHRoaXMub3B0aW9ucy50ZW1wbGF0ZSk7ICBcbiAgICB9XG4gICAgdGhpcy5faW5pdEJpbmRzKCk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGhpcy50ZW1wbGF0ZShcbiAgICAgICAgXy5leHRlbmQoXG4gICAgICAgICAgdGhpcy5vcHRpb25zLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IHRoaXMubW9kZWwuZ2V0KCd0eXBlJyksXG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5tb2RlbC5nZXQoJ3ZhbHVlJyksXG4gICAgICAgICAgICBhdHRyaWJ1dGU6IHRoaXMubW9kZWwuZ2V0KCdhdHRyaWJ1dGUnKSxcbiAgICAgICAgICAgIHJlYWRPbmx5OiB0aGlzLm1vZGVsLmdldCgncmVhZE9ubHknKSAgICBcbiAgICAgICAgICB9XG4gICAgICAgIClcbiAgICAgIClcbiAgICApO1xuXG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdyZWFkT25seScpKSB7XG4gICAgICB0aGlzLnVuZGVsZWdhdGVFdmVudHMoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfaW5pdEJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2Vycm9yIHZhbGlkJywgdGhpcy5fc2V0RmllbGRTdHlsZSwgdGhpcyk7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2U6cmVhZE9ubHknLCB0aGlzLnJlbmRlciwgdGhpcyk7XG4gIH0sXG5cbiAgX3NldEZpZWxkU3R5bGU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsWyB0aGlzLm1vZGVsLmdldEVycm9yKCkgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10oJ2lzLWludmFsaWQnKTtcbiAgfSxcblxuICBfaGFzU3VibWl0OiBmdW5jdGlvbihldikge1xuICAgIGlmICghZXYpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignZXZlbnQgbmVlZGVkIHRvIGNoZWNrIGlmIHVzZXIgaGFzIHN1Ym1pdHRlZCBmcm9tIHRoZSBpbnB1dCcpO1xuICAgIH1cblxuICAgIHZhciB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTtcbiAgICB2YXIgaXNNYWMgPSAvbWFjIG9zLy50ZXN0KHVhKTtcblxuICAgIHJldHVybiAoIChpc01hYyAmJiBldi5tZXRhS2V5KSB8fCAoIWlzTWFjICYmIGV2LmN0cmxLZXkpICkgJiYgZXYua2V5Q29kZSA9PT0gMTM7XG4gIH0sXG5cbiAgaXNWYWxpZDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwuaXNWYWxpZCgpO1xuICB9XG5cbn0pOyIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIEVkaXRGaWVsZFZpZXcgPSByZXF1aXJlKCcuLi9lZGl0X2ZpZWxkX3ZpZXcnKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG5cbi8qKlxuICogIE51bWJlciBmaWVsZFxuICogIFxuICogIFBsYWNlIHRvIGFkZC9lZGl0IG51bWJlciBlZGl0aW9uc1xuICogIC0gSXQgYWNjZXB0cyBhIG51bWJlciBtb2RlbCB3aXRoIHthdHRyaWJ1dGU6ICdjb2x1bScsIHZhbHVlOiAnaGVsbG8nfS5cbiAqXG4gKiAgbmV3IE51bWJlckZpZWxkVmlldyh7XG4gKiAgICBtb2RlbDogbmV3IE51bWJlckZpZWxkTW9kZWwoeyBhdHRyaWJ1dGU6ICdjb2x1bW4nLCB2YWx1ZTogJ3BhY28nIH0pLFxuICogICAgb3B0aW9uOiBmYWxzZVxuICogIH0pXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBFZGl0RmllbGRWaWV3LmV4dGVuZCh7XG5cbiAgb3B0aW9uczoge1xuICAgIHRlbXBsYXRlOiAnY29tbW9uL2VkaXRfZmllbGRzL251bWJlcl9maWVsZC9udW1iZXJfZmllbGQnXG4gIH0sXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2tleWRvd24gLmpzLWlucHV0JzogJ19vbktleURvd24nLFxuICAgICdrZXl1cCAuanMtaW5wdXQnOiAnX29uS2V5VXAnXG4gIH0sXG5cbiAgX2hhc1N1Ym1pdDogZnVuY3Rpb24oZXYpIHtcbiAgICBpZiAoIWV2KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2V2ZW50IG5lZWRlZCB0byBjaGVjayBpZiB1c2VyIGhhcyBzdWJtaXR0ZWQgZnJvbSB0aGUgaW5wdXQnKTtcbiAgICB9XG4gICAgcmV0dXJuIGV2LmtleUNvZGUgPT09IDEzXG4gIH0sXG5cbiAgX29uS2V5RG93bjogZnVuY3Rpb24oZXYpIHtcbiAgICBpZiAodGhpcy5faGFzU3VibWl0KGV2KSAmJiB0aGlzLm1vZGVsLmlzVmFsaWQoKSkge1xuICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMudHJpZ2dlcignb25TdWJtaXQnLCB0aGlzLm1vZGVsLCB0aGlzKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sXG5cbiAgX29uS2V5VXA6IGZ1bmN0aW9uKGV2KSB7XG4gICAgaWYgKHRoaXMuX2hhc1N1Ym1pdChldikgJiYgdGhpcy5tb2RlbC5pc1ZhbGlkKCkpIHtcbiAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIHZhbHVlID0gJChldi50YXJnZXQpLnZhbCgpO1xuICAgIC8vIE51bGwgdmFsdWVzIGFyZSB2YWxpZCBmb3IgbnVtYmVyIHR5cGVcbiAgICBpZiAodmFsdWUgPT09IFwiXCIpIHtcbiAgICAgIHZhbHVlID0gbnVsbDtcbiAgICB9XG4gICAgdGhpcy5tb2RlbC5zZXQoJ3ZhbHVlJywgdmFsdWUpO1xuICB9XG5cbn0pXG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBFZGl0RmllbGRWaWV3ID0gcmVxdWlyZSgnLi4vZWRpdF9maWVsZF92aWV3Jyk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xuXG4vKipcbiAqICBTdHJpbmcgZmllbGRcbiAqICBcbiAqICBQbGFjZSB0byBlZGl0IGFuZCBjYXB0dXJlIHN0cmluZyBlZGl0aW9uc1xuICogIC0gSXQgYWNjZXB0cyBhIGRlZmF1bHQgbW9kZWwgd2l0aCB7YXR0cmlidXRlOiAnY29sdW0nLCB2YWx1ZTogJ2hlbGxvJ30uXG4gKlxuICogIG5ldyBTdHJpbmdGaWVsZFZpZXcoe1xuICogICAgbW9kZWw6IG5ldyBFZGl0RmllbGRNb2RlbCh7IGF0dHJpYnV0ZTogJ2NvbHVtbicsIHZhbHVlOiAncGFjbycgfSksXG4gKiAgICBvcHRpb246IGZhbHNlXG4gKiAgfSlcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IEVkaXRGaWVsZFZpZXcuZXh0ZW5kKHtcblxuICBvcHRpb25zOiB7XG4gICAgdGVtcGxhdGU6ICdjb21tb24vZWRpdF9maWVsZHMvc3RyaW5nX2ZpZWxkL3N0cmluZ19maWVsZCcsXG4gICAgYXV0b1Jlc2l6ZTogdHJ1ZVxuICB9LFxuXG4gIGV2ZW50czoge1xuICAgICdrZXlkb3duIC5qcy10ZXh0YXJlYSc6ICdfb25LZXlEb3duJyxcbiAgICAna2V5dXAgLmpzLXRleHRhcmVhJzogICdfb25LZXlVcCdcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZWxkZXIoJ3JlbmRlcicpO1xuXG4gICAgLy8gSGFjayB0byByZXNpemUgY29ycmVjdGx5IHRoZSB0ZXh0YXJlYVxuICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b1Jlc2l6ZSkge1xuICAgICAgdGhpcy5fcmVzaXplKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX29uS2V5RG93bjogZnVuY3Rpb24oZXYpIHtcbiAgICBpZiAodGhpcy5faGFzU3VibWl0KGV2KSkge1xuICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMudHJpZ2dlcignb25TdWJtaXQnLCB0aGlzLm1vZGVsLCB0aGlzKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sXG5cbiAgX29uS2V5VXA6IGZ1bmN0aW9uKGV2KSB7XG4gICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICB2YXIgdmFsdWUgPSAkKGV2LnRhcmdldCkudmFsKCk7XG4gICAgdGhpcy5tb2RlbC5zZXQoJ3ZhbHVlJywgdmFsdWUpO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5hdXRvUmVzaXplKSB7XG4gICAgICB0aGlzLl9yZXNpemUoKTtcbiAgICB9XG4gIH0sXG5cbiAgLy8gSGFjayBmdW5jdGlvbiB0byByZXNpemUgYXV0b21hdGlhbGx5IHRleHRhcmVhXG4gIF9yZXNpemU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciAkdGV4dGFyZWEgPSB0aGlzLiQoXCIuanMtdGV4dGFyZWFcIik7XG5cbiAgICAvLyBIZWxsbyBoYWNreSBib3lcbiAgICBpZiAoJHRleHRhcmVhKSB7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAkdGV4dGFyZWEuaGVpZ2h0KDIwKTtcbiAgICAgICAgJHRleHRhcmVhLmhlaWdodCgkdGV4dGFyZWFbMF0uc2Nyb2xsSGVpZ2h0IC0gMjIpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbn0pXG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbmNkYi5hZG1pbiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXVsnYWRtaW4nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddWydhZG1pbiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xuXG4vKiogXG4gKiAgT2xkIGZvcm0gc3Bpbm5lclxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcbiAgY2xhc3NOYW1lOiAnZm9ybS12aWV3IGZvcm1fc3Bpbm5lcicsXG5cbiAgZGVmYXVsdHM6IHtcbiAgICBtYXg6IDk5OTk5OTk5OTk5OSxcbiAgICBtaW46IC05OTk5OTk5OTk5OTksXG4gICAgaW5jOiAxLFxuICAgIHdpZHRoOiAyNSxcbiAgICBwYXR0ZXJuOiAvXi0/WzAtOV0rXFwuP1swLTldKiQvLFxuICAgIGRlYm91bmNlX3RpbWU6IDIwMFxuICB9LFxuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAucGx1cyc6ICdfcGx1cycsXG4gICAgJ2NsaWNrIC5taW51cyc6ICdfbWludXMnLFxuICAgICdrZXlwcmVzcyBpbnB1dC52YWx1ZSc6ICdfY2hlY2tJbnB1dFByZXNzJyxcbiAgICAna2V5ZG93biBpbnB1dC52YWx1ZSc6ICdfY2hlY2tJbnB1dFByZXNzJyxcbiAgICAna2V5dXAgaW5wdXQudmFsdWUnOiAnX2NoZWNrSW5wdXRVcCcsXG4gICAgJ2NoYW5nZSAudmFsdWUnOiAnX2NoZWNrVmFsdWVDaGFuZ2UnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgXy5iaW5kQWxsKHRoaXMsICdfZmlyZUNoYW5nZScsICdfY2hlY2tOdW1iZXInKTtcbiAgICB0aGlzLnByb3BlcnR5ID0gdGhpcy5vcHRpb25zLnByb3BlcnR5O1xuICAgIHRoaXMubW9kZWwuYmluZCgnY2hhbmdlJywgdGhpcy5yZW5kZXIsIHRoaXMpO1xuXG4gICAgLy8gQ2hlY2sgcGF0dGVybiwgaWYgaXQgaXMgZW1wdHkgb3Igbm90IHZhbGlkLFxuICAgIC8vIGRlbGV0ZSB0aGUgb3B0aW9uIGJlZm9yZSBleHRlbmRpbmcgZGVmYXVsdHNcbiAgICBpZiAoIXRoaXMub3B0aW9ucy5wYXR0ZXJuIHx8XG4gICAgICAgIHR5cGVvZiB0aGlzLm9wdGlvbnMucGF0dGVybiAhPT0gXCJvYmplY3RcIiB8fFxuICAgICAgICAodHlwZW9mIHRoaXMub3B0aW9ucy5wYXR0ZXJuID09PSBcIm9iamVjdFwiICYmICF0aGlzLm9wdGlvbnMucGF0dGVybi50ZXN0KVxuICAgICAgKVxuICAgIHtcbiAgICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMucGF0dGVybjtcbiAgICB9XG5cbiAgICBfLmRlZmF1bHRzKHRoaXMub3B0aW9ucywgdGhpcy5kZWZhdWx0cyk7XG5cbiAgICBpZih0aGlzLm9wdGlvbnMuZGVib3VuY2VfdGltZSA+IDApIHtcbiAgICAgIHRoaXMuX2ZpcmVDaGFuZ2UgPSBfLmRlYm91bmNlKHRoaXMuX2ZpcmVDaGFuZ2UsIHRoaXMub3B0aW9ucy5kZWJvdW5jZV90aW1lKTtcbiAgICB9XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbihwcm9wKSB7XG4gICAgdmFyIHZhbHVlID0gdGhpcy5vcHRpb25zLmluaXRWYWx1ZSB8fCB0aGlzLm1vZGVsLmdldCh0aGlzLnByb3BlcnR5KTtcblxuICAgIGlmIChwcm9wICYmIF8uaXNOdW1iZXIocHJvcCkpIHtcbiAgICAgIHZhbHVlID0gcHJvcDtcbiAgICB9XG5cbiAgICB0aGlzLiRlbC5odG1sKCc8aW5wdXQgY2xhc3M9XCJ2YWx1ZVwiICcgKyAodGhpcy5vcHRpb25zLmRpc2FibGVkID8gJ3JlYWRvbmx5JyA6ICcnKSArICcgdmFsdWU9XCJcIiBzdHlsZT1cIndpZHRoOicgKyAodGhpcy5vcHRpb25zLndpZHRoKSArICdweCFpbXBvcnRhbnRcIi8+PGEgaHJlZj1cIiNcIiBjbGFzcz1cInBsdXNcIj4rPC9hPjxhIGhyZWY9XCIjXCIgY2xhc3M9XCJtaW51c1wiPi08L2E+Jyk7XG4gICAgdGhpcy4kKCcudmFsdWUnKS52YWwodmFsdWUpO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5kaXNhYmxlZCkge1xuICAgICAgdGhpcy51bmRlbGVnYXRlRXZlbnRzKCk7XG4gICAgICB0aGlzLiRlbFxuICAgICAgLmFkZENsYXNzKCdkaXNhYmxlZCcpXG4gICAgICAuZmluZCgnYScpLmJpbmQoJ2NsaWNrJywgdGhpcy5raWxsRXZlbnQpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9maXJlQ2hhbmdlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmNoYW5nZSgpO1xuICB9LFxuXG4gIF9jaGFuZ2VWYWx1ZTogZnVuY3Rpb24oYSkge1xuICAgIHRoaXMubW9kZWwuc2V0KGEsIHsgc2lsZW50OiB0cnVlIH0pO1xuICAgIHRoaXMuX2ZpcmVDaGFuZ2UoKTtcbiAgfSxcblxuICBpbmM6IGZ1bmN0aW9uKGMpIHtcbiAgICB2YXIgYSA9IHt9O1xuICAgIHZhciB2ID0gYVt0aGlzLnByb3BlcnR5XSA9IHRoaXMubW9kZWwuZ2V0KHRoaXMucHJvcGVydHkpICsgYztcbiAgICB2ID0gYVt0aGlzLnByb3BlcnR5XSA9IE1hdGgubWluKHRoaXMub3B0aW9ucy5tYXgsIHYudG9GaXhlZD8gdi50b0ZpeGVkKDEpOiAxKnYpO1xuICAgIGFbdGhpcy5wcm9wZXJ0eV0gPSBNYXRoLm1heCh0aGlzLm9wdGlvbnMubWluLCB2KTtcbiAgICB0aGlzLl9jaGFuZ2VWYWx1ZShhKTtcbiAgICAvLyBkb24ndCB3YWl0IHRvIGJlIG5vdGlmaWVkIGJ5IG1vZGVsLCByZW5kZXIgYXMgZmFzdCBhcyB0aGUgdXNlciBjaGFuZ2VzIHRoZSB2YWx1ZVxuICAgIHRoaXMucmVuZGVyKGFbdGhpcy5wcm9wZXJ0eV0pO1xuICB9LFxuXG4gIF9wbHVzOiBmdW5jdGlvbihlKSB7XG4gICAgZSAmJiBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdGhpcy5pbmModGhpcy5vcHRpb25zLmluYyk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIF9taW51czogZnVuY3Rpb24oZSkge1xuICAgIGUgJiYgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuaW5jKC10aGlzLm9wdGlvbnMuaW5jKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG5cbiAgX2NoZWNrTnVtYmVyOiBmdW5jdGlvbihudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLnBhdHRlcm4udGVzdChudW1iZXIpO1xuICB9LFxuXG4gIF9jaGVja0lucHV0UHJlc3M6IGZ1bmN0aW9uKGV2KSB7XG4gICAgdmFyIG5ld0NoYXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGV2LmNoYXJDb2RlKTtcblxuICAgIGlmKG5ld0NoYXIgPT0gJy0nIHx8IG5ld0NoYXIgPT0gJy4nIHx8IDEqbmV3Q2hhciAhPT0gTmFOKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSxcblxuICBfY2hlY2tJbnB1dFVwOiBmdW5jdGlvbihldikge1xuICAgIHRoaXMudmFsdWU/IG51bGwgOiB0aGlzLnZhbHVlID0gdGhpcy5tb2RlbC5nZXQodGhpcy5wcm9wZXJ0eSk7XG4gICAgdmFyIG51bWJlciA9ICQoZXYudGFyZ2V0KS52YWwoKTtcblxuICAgIC8vIElmIGl0IGlzIGFuIEVOVEVSIC0+IHNhdmVzIVxuICAgIGlmIChldi5rZXlDb2RlID09PSAxMykge1xuICAgICAgdGhpcy5fc2F2ZVZhbHVlKGV2KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBJZiBub3QsIGNoZWNrIHRoZSBrZXlcbiAgICBpZiAoIXRoaXMuX2NoZWNrTnVtYmVyKG51bWJlcikgJiYgbnVtYmVyICE9ICctJyAmJiBudW1iZXIgIT0gJycpIHtcbiAgICAgIHRoaXMuJGVsLmZpbmQoXCJpbnB1dC52YWx1ZVwiKS52YWwodGhpcy52YWx1ZSk7XG4gICAgICAvLyBldi5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIC8vIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmKG51bWJlciAhPSAnLScgJiYgbnVtYmVyICE9ICcnKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSAkKGV2LnRhcmdldCkudmFsKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIF9jaGVja1ZhbHVlQ2hhbmdlOiBmdW5jdGlvbihldikge1xuICAgIHZhciBudW1iZXIgPSAkKGV2LnRhcmdldCkudmFsKCk7XG4gICAgbnVtYmVyID0gKG51bWJlciA9PSAnJyB8fCBudW1iZXIgPT0gJy0nKT8gMCA6IDEqbnVtYmVyXG4gICAgaWYgKCF0aGlzLl9jaGVja051bWJlcihudW1iZXIpKSB7XG4gICAgICB0aGlzLiRlbC5maW5kKFwiaW5wdXQudmFsdWVcIikudmFsKHRoaXMudmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zYXZlVmFsdWUoZXYpO1xuICAgICAgdGhpcy52YWx1ZSA9ICQoZXYudGFyZ2V0KS52YWwoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgX3NhdmVWYWx1ZTogZnVuY3Rpb24oZXYpIHtcbiAgICB2YXIgYSA9IHt9O1xuICAgIHZhciB2YWwgPSB0aGlzLiRlbC5maW5kKFwiaW5wdXQudmFsdWVcIikudmFsKClcbiAgICB2YXIgYmFzZU51bWJlciA9ICh0aGlzLm9wdGlvbnMubWluIDwgMCAmJiB0aGlzLm9wdGlvbnMubWF4ID4gMCk/XG4gICAgICAwOlxuICAgICAgdGhpcy5vcHRpb25zLm1pbjtcblxuICAgIHZhciBudW1iZXIgPSAodmFsID09ICcnIHx8IHZhbCA9PSAnLScpID8gYmFzZU51bWJlciA6IDEqdmFsO1xuXG4gICAgdGhpcy4kZWwuZmluZChcImlucHV0LnZhbHVlXCIpLnZhbChudW1iZXIpO1xuXG4gICAgYVt0aGlzLnByb3BlcnR5XSA9IG51bWJlcjtcbiAgICB0aGlzLm1vZGVsLnNldChhKTtcblxuICAgIGNkYi5nb2QudHJpZ2dlcihcImNsb3NlRGlhbG9nc1wiKTtcbiAgfVxuXG59KTsiLCJ2YXIgQmFzZURpYWxvZyA9IHJlcXVpcmUoJy4uL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcblxuLyoqXG4gKiAgRGlhbG9nIGZvciBkcm9wIGFjdGlvbnMgdXNpbmcgbWFtdWZhc1xuICpcbiAqL1xuXG5cbm1vZHVsZS5leHBvcnRzID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ0RpYWxvZyBpcy1vcGVuaW5nIE1hbXVmYXNEaWFsb2cnLFxuXG4gIG92ZXJyaWRlRGVmYXVsdHM6IHtcbiAgICB0ZW1wbGF0ZV9uYW1lOiAnY29tbW9uL3ZpZXdzL2Jhc2VfZGlhbG9nL3RlbXBsYXRlJyxcbiAgICB0cmlnZ2VyRGlhbG9nRXZlbnRzOiBmYWxzZVxuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VEaWFsb2cucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB0aGlzLnRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSgnY29tbW9uL21hbXVmYXNfaW1wb3J0L21hbXVmYXNfaW1wb3J0X2RpYWxvZycpO1xuICB9LFxuXG4gIHJlbmRlcl9jb250ZW50OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy50ZW1wbGF0ZSgpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbGRlcigncmVuZGVyJyk7XG4gICAgdGhpcy4kKCcuRGlhbG9nLWNvbnRlbnQnKS5hZGRDbGFzcygnRGlhbG9nLWNvbnRlbnQtLWV4cGFuZGVkJyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgaGlkZTogZnVuY3Rpb24oKSB7XG4gICAgQmFzZURpYWxvZy5wcm90b3R5cGUuaGlkZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIHRoaXMudHJpZ2dlcignaGlkZScpO1xuICAgIHRoaXMuX3NldEJvZHlGb3JEaWFsb2dNb2RlKCdyZW1vdmUnKVxuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgTWFtdWZhc0RpYWxvZyA9IHJlcXVpcmUoJy4vbWFtdWZhc19pbXBvcnRfZGlhbG9nX3ZpZXcnKTtcblxuLyoqXG4gKiAgQmlnIG1hbXVmYXMgdG8gaW1wb3J0IGZpbGVzXG4gKiAgdXNpbmcgZHJhZyBhbmQgZHJvcFxuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLm9wdGlvbnMudXNlcjtcbiAgICB0aGlzLm1vZGVsID0gbmV3IGNkYi5jb3JlLk1vZGVsKHsgdmlzaWJsZTogZmFsc2UgfSk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBfY3JlYXRlRHJhZ3N0ZXI6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLmRyYWdzdGVyKSB7XG4gICAgICB0aGlzLl9kZXN0cm95RHJhZ3N0ZXIoKTtcbiAgICB9XG4gICAgdGhpcy5kcmFnc3RlciA9IG5ldyBEcmFnc3Rlcih0aGlzLiRlbFswXSk7XG4gIH0sXG5cbiAgX2NyZWF0ZURyb3B6b25lOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5kcm9wem9uZSkge1xuICAgICAgdGhpcy5fZGVzdHJveURyb3B6b25lKCk7XG4gICAgfVxuICAgIHRoaXMuZHJvcHpvbmUgPSBuZXcgRHJvcHpvbmUodGhpcy4kZWxbMF0sIHtcbiAgICAgIHVybDogJzopJyxcbiAgICAgIGF1dG9Qcm9jZXNzUXVldWU6IGZhbHNlLFxuICAgICAgcHJldmlld3NDb250YWluZXI6IGZhbHNlXG4gICAgfSk7XG4gIH0sXG5cbiAgX2Rlc3Ryb3lEcmFnc3RlcjogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuZHJhZ3N0ZXIpIHtcbiAgICAgIHRoaXMuZHJhZ3N0ZXIucmVtb3ZlTGlzdGVuZXJzKCk7XG4gICAgICB0aGlzLmRyYWdzdGVyLnJlc2V0KCk7XG4gICAgICBkZWxldGUgdGhpcy5kcmFnc3RlcjtcbiAgICB9XG4gIH0sXG5cbiAgX2Rlc3Ryb3lEcm9wem9uZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuZHJvcHpvbmUpIHtcbiAgICAgIHRoaXMuZHJvcHpvbmUuZGVzdHJveSgpO1xuICAgICAgZGVsZXRlIHRoaXMuZHJvcHpvbmU7XG4gICAgfVxuICB9LFxuXG4gIF9pbml0QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgbWFtdWZhcyA9IG5ldyBNYW11ZmFzRGlhbG9nKHsgY2xlYW5fb25faGlkZTogdHJ1ZSB9KTtcblxuICAgIHRoaXMuJGVsLm9uKCBcImRyYWdzdGVyOmVudGVyXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBtYW11ZmFzLmFwcGVuZFRvQm9keSgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy4kZWwub24oIFwiZHJhZ3N0ZXI6bGVhdmVcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgIG1hbXVmYXMuaGlkZSgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5kcm9wem9uZS5vbihcImRyb3BcIiwgZnVuY3Rpb24gKGV2KSB7XG4gICAgICBzZWxmLmRyYWdzdGVyLmRyYWdsZWF2ZShldik7XG4gICAgICBtYW11ZmFzLmhpZGUoKTtcbiAgICAgIHNlbGYuZHJvcHpvbmUucmVtb3ZlRmlsZShldik7XG5cbiAgICAgIHZhciBmaWxlcyA9IGV2LmRhdGFUcmFuc2Zlci5maWxlcztcbiAgICAgIGlmIChmaWxlcyAmJiBmaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGlmIChmaWxlcy5sZW5ndGggPT09IDEpIHsgZmlsZXMgPSBmaWxlc1swXSB9XG4gICAgICAgIGNkYi5nb2QudHJpZ2dlcignZmlsZURyb3BwZWQnLCBmaWxlcywgdGhpcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgX3JlbW92ZUJpbmRzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5vZmYoXCJkcmFnc3RlcjplbnRlclwiKTtcbiAgICB0aGlzLiRlbC5vZmYoXCJkcmFnc3RlcjpsZWF2ZVwiKTtcbiAgfSxcblxuICBlbmFibGU6IGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy5tb2RlbC5nZXQoJ3Zpc2libGUnKSkge1xuICAgICAgdGhpcy5fY3JlYXRlRHJhZ3N0ZXIoKTtcbiAgICAgIHRoaXMuX2NyZWF0ZURyb3B6b25lKCk7XG4gICAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICAgIHRoaXMubW9kZWwuc2V0KCd2aXNpYmxlJywgdHJ1ZSk7XG4gICAgfVxuICB9LFxuXG4gIGRpc2FibGU6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm1vZGVsLmdldCgndmlzaWJsZScpKSB7XG4gICAgICB0aGlzLl9yZW1vdmVCaW5kcygpO1xuICAgICAgdGhpcy5fZGVzdHJveURyYWdzdGVyKCk7XG4gICAgICB0aGlzLl9kZXN0cm95RHJvcHpvbmUoKTtcbiAgICAgIHRoaXMubW9kZWwuc2V0KCd2aXNpYmxlJywgZmFsc2UpO1xuICAgIH1cbiAgfSxcblxuICBjbGVhbjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fcmVtb3ZlQmluZHMoKTtcbiAgICB0aGlzLmVsZGVyKCdjbGVhbicpO1xuICB9XG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqIE1vZGVsIHJlcHJlc2VudGluZyB0aGUgcXVlcnkgc3RyaW5nIHBhcmFtcyBmb3IgYSBcInBhZ2VkIHNlYXJjaFwiIG9mIGEgY29sbGVjdGlvbiAobWF0Y2hpbmcgdGhlIHNlcnZlci1zaWRlIEFQSXMpLlxuICpcbiAqIEBleGFtcGxlIHVzYWdlXG4gKiAgIHZhciBQYWdlZFNlYXJjaCA9IHJlcXVpcmUoJ2NvbW1vbi9wYWdlZF9zZWFyY2hfbW9kZWwnKTtcbiAqICAgcGFnZWRTZWFyY2ggPSBuZXcgUGFnZWRTZWFyY2goeyDigKYgfSlcbiAqICAgcGFnZWRTZWFyY2guZmV0Y2goY29sbGVjdGlvbikgLy8gPT4ganFYSFIsIEdFVCAvY29sbGVjdGlvbi8xMjM/cGFnZT0xJnBlcl9wYWdlMjBcbiAqICAgcGFnZWRTZWFyY2guc2V0KHsgcGFnZTogMiwgcGVyX3BhZ2U6IDEwLCBxOiAndGVzdCcgfSk7XG4gKiAgIHBhZ2VkU2VhcmNoLmZldGNoKGNvbGxlY3Rpb24pIC8vID0+IEdFVCAvY29sbGVjdGlvbi8xMjM/cGFnZT0yJnBlcl9wYWdlMTAmcT10ZXN0XG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBkZWZhdWx0czoge1xuICAgIHBlcl9wYWdlOiAyMCxcbiAgICBwYWdlOiAxXG4gICAgLy8gb3JkZXI6ICduYW1lJ1xuICAgIC8vIHE6ICcnLFxuICB9LFxuXG4gIGZldGNoOiBmdW5jdGlvbihjb2xsZWN0aW9uKSB7XG4gICAgY29sbGVjdGlvbi50cmlnZ2VyKCdmZXRjaGluZycpO1xuICAgIHJldHVybiBjb2xsZWN0aW9uLmZldGNoKHtcbiAgICAgIGRhdGE6IHRoaXMuYXR0cmlidXRlc1xuICAgIH0pO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogIEdldCBvYXV0aCB1cmwgZnJvbSB0aGUgc2VydmljZSByZXF1ZXN0ZWRcbiAqXG4gKiAgLSBJdCBuZWVkcyBhIGRhdGFzb3VyY2UgbmFtZSBvciBpdCB3b24ndCB3b3JrLlxuICpcbiAqICBuZXcgY2RiLmFkbWluLlNlcnZpY2UoeyBkYXRhc291cmNlX25hbWU6ICdkcm9wYm94JyB9KVxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBfREFUQVNPVVJDRV9OQU1FOiAnZHJvcGJveCcsXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oYXR0cnMsIG9wdHMpIHtcbiAgICBpZiAob3B0cy5kYXRhc291cmNlX25hbWUpIHtcbiAgICAgIHRoaXMuX0RBVEFTT1VSQ0VfTkFNRSA9IG9wdHMuZGF0YXNvdXJjZV9uYW1lO1xuICAgIH1cbiAgfSxcblxuICB1cmw6IGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgIHZhciB2ZXJzaW9uID0gY2RiLmNvbmZpZy51cmxWZXJzaW9uKCdpbXBvcnRzX3NlcnZpY2UnLCBtZXRob2QpO1xuICAgIHJldHVybiAnL2FwaS8nICsgdmVyc2lvbiArICcvaW1wb3J0cy9zZXJ2aWNlLycgKyB0aGlzLl9EQVRBU09VUkNFX05BTUUgKyAnL2F1dGhfdXJsJ1xuICB9LFxuXG4gIHBhcnNlOiBmdW5jdGlvbihyKSB7XG4gICAgcmV0dXJuIHJcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqICBNb2RlbCB0byBjaGVjayBpZiBvQXV0aCB0b2tlbiBpcyB2YWxpZCBvciBub3RcbiAqXG4gKiAgLSBJdCBuZWVkcyBhIGRhdGFzb3VyY2UgbmFtZSBvciBpdCB3b24ndCB3b3JrLlxuICpcbiAqICBuZXcgU2VydmljZVRva2VuKHsgZGF0YXNvdXJjZV9uYW1lOiAnZHJvcGJveCcgfSlcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG5cbiAgX0RBVEFTT1VSQ0VfTkFNRTogJ2Ryb3Bib3gnLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKGF0dHJzLCBvcHRzKSB7XG4gICAgaWYgKG9wdHMuZGF0YXNvdXJjZV9uYW1lKSB7XG4gICAgICB0aGlzLl9EQVRBU09VUkNFX05BTUUgPSBvcHRzLmRhdGFzb3VyY2VfbmFtZTtcbiAgICB9XG4gIH0sXG5cbiAgdXJsOiBmdW5jdGlvbihtZXRob2QpIHtcbiAgICB2YXIgdmVyc2lvbiA9IGNkYi5jb25maWcudXJsVmVyc2lvbignaW1wb3J0c19zZXJ2aWNlJywgbWV0aG9kKTtcbiAgICByZXR1cm4gJy9hcGkvJyArIHZlcnNpb24gKyAnL2ltcG9ydHMvc2VydmljZS8nICsgdGhpcy5fREFUQVNPVVJDRV9OQU1FICsgJy90b2tlbl92YWxpZCdcbiAgfSxcblxuICBwYXJzZTogZnVuY3Rpb24ocikge1xuICAgIHJldHVybiByXG4gIH1cblxufSk7XG4iLCJ2YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIEJhc2VEaWFsb2cgPSByZXF1aXJlKCcuL3ZpZXdzL2Jhc2VfZGlhbG9nL3ZpZXcnKTtcblxuLyoqXG4gKiBDb252ZW5pZW50IGZhY3RvcnkgdG8gY3JlYXRlIHZpZXdzIHdpdGhvdXQgaGF2aW5nIHRvIGNyZWF0ZSBuZXcgZmlsZXMuXG4gKi9cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gIGNyZWF0ZURpYWxvZ0J5VGVtcGxhdGU6IGZ1bmN0aW9uKHRlbXBsYXRlT3JTdHIsIHRlbXBsYXRlRGF0YSwgZGlhbG9nT3B0aW9ucykge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZURpYWxvZ0J5Vmlldyh0aGlzLmNyZWF0ZUJ5VGVtcGxhdGUodGVtcGxhdGVPclN0ciwgdGVtcGxhdGVEYXRhKSwgZGlhbG9nT3B0aW9ucyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEByZXR1cm4ge09iamVjdH0gaW5zdGFuY2Ugb2YgY2RiLmNvcmUuVmlldywgd2hpY2ggdGFrZXMgdHdvIHBhcmFtcyBvZiB0ZW1wbGF0ZSBhbmQgdGVtcGxhdGVEYXRhXG4gICAqL1xuICBjcmVhdGVCeVRlbXBsYXRlOiBmdW5jdGlvbih0ZW1wbGF0ZU9yU3RyLCB0ZW1wbGF0ZURhdGEsIHZpZXdPcHRzKSB7XG4gICAgdmFyIHRlbXBsYXRlID0gXy5pc1N0cmluZyh0ZW1wbGF0ZU9yU3RyKSA/IGNkYi50ZW1wbGF0ZXMuZ2V0VGVtcGxhdGUodGVtcGxhdGVPclN0cikgOiB0ZW1wbGF0ZU9yU3RyO1xuXG4gICAgdmFyIHZpZXcgPSBuZXcgY2RiLmNvcmUuVmlldyh2aWV3T3B0cyk7XG4gICAgdmlldy5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICAgIHRlbXBsYXRlKHRlbXBsYXRlRGF0YSlcbiAgICAgICk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgcmV0dXJuIHZpZXc7XG4gIH0sXG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSB2aWV3IHRoYXQgaG9sZHMgYSBsaXN0IG9mIHZpZXdzIHRvIGJlIHJlbmRlcmVkLlxuICAgKiBAcGFyYW0ge0FycmF5fSBsaXN0IG9mIFZpZXcgb2JqZWN0LCBpLmUuIGhhdmUgYSByZW5kZXIgbWV0aG9kLCAkZWwsIGFuZCBjbGVhbiBtZXRob2QuXG4gICAqIEBwYXJhbSB7T2JqZWN0LHVuZGVmaW5lZH0gdmlld09wdHMgdmlldyBvcHRpb25zLCAuZS5nIHtjbGFzc05hbWU6ICdXaGF0ZXZlcid9XG4gICAqIEByZXR1cm4ge09iamVjdH0gQSB2aWV3XG4gICAqL1xuICBjcmVhdGVCeUxpc3Q6IGZ1bmN0aW9uKHZpZXdzLCB2aWV3T3B0cykge1xuICAgIHZhciBsaXN0VmlldyA9IG5ldyBjZGIuY29yZS5WaWV3KHZpZXdPcHRzKTtcbiAgICBsaXN0Vmlldy5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuY2xlYXJTdWJWaWV3cygpO1xuICAgICAgXy5lYWNoKHZpZXdzLCBmdW5jdGlvbih2aWV3KSB7XG4gICAgICAgIHRoaXMuYWRkVmlldyh2aWV3KTtcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKHZpZXcucmVuZGVyKCkuJGVsKTtcbiAgICAgIH0sIHRoaXMpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICByZXR1cm4gbGlzdFZpZXc7XG4gIH0sXG5cbiAgY3JlYXRlRGlhbG9nQnlWaWV3OiBmdW5jdGlvbihjb250ZW50VmlldywgZGlhbG9nT3B0aW9ucykge1xuXG4gICAgdmFyIG9wdGlvbnMgPSBfLmV4dGVuZCh7IGNsZWFuX29uX2hpZGU6IHRydWUsIGVudGVyX3RvX2NvbmZpcm06IHRydWUgfSwgZGlhbG9nT3B0aW9ucyk7XG5cbiAgICByZXR1cm4gbmV3IChCYXNlRGlhbG9nLmV4dGVuZCh7XG4gICAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgICAgICB0aGlzLmFkZFZpZXcoY29udGVudFZpZXcpO1xuICAgICAgfSxcblxuICAgICAgcmVuZGVyX2NvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gY29udGVudFZpZXcucmVuZGVyKCkuZWw7XG4gICAgICB9XG4gICAgfSkpKG9wdGlvbnMpO1xuICB9XG59O1xuIiwidmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG5cbi8qKlxuICogQ2hlY2sgaWYgTGludXggdXNlciB1c2VkIHJpZ2h0L21pZGRsZSBjbGljayBhdCB0aGUgdGltZSBvZiB0aGUgZXZlbnRcbiAqXG4gKiBAcGFyYW0gZXYge0V2ZW50fVxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIGlzTGludXhNaWRkbGVPclJpZ2h0Q2xpY2soZXYpIHtcbiAgcmV0dXJuIGV2LndoaWNoID09PSAyIHx8IGV2LndoaWNoID09PSAzO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIE1hYyB1c2VyIHVzZWQgQ01EIGtleSBhdCB0aGUgdGltZSBvZiB0aGUgZXZlbnQgTWFjIHVzZXIgdXNlZCBDTUQga2V5IGF0IHRoZSB0aW1lIG9mIHRoZSBldmVudC5cbiAqXG4gKiBAcGFyYW0gZXYge0V2ZW50fVxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIGlzTWFjQ21kS2V5UHJlc3NlZChldikge1xuICByZXR1cm4gZXYubWV0YUtleTtcbn1cblxuZnVuY3Rpb24gaXNDdHJsS2V5UHJlc3NlZChldikge1xuICByZXR1cm4gZXYuY3RybEtleTtcbn1cblxuLyoqXG4gKiBDbGljayBoYW5kbGVyIGZvciBhIGNhcnRvZGIuanMgdmlldywgdG8gbmF2aWdhdGUgZXZlbnQgdGFyZ2V0J3MgaHJlZiBVUkwgdGhyb3VnaCB0aGUgdmlldydzIHJvdXRlci5uYXZpZ2F0ZSBtZXRob2QuXG4gKlxuICogVGhlIGRlZmF1bHQgYmVoYXZpb3IgaXM6XG4gKiBVbmxlc3MgY21kL2N0cmwga2V5cyBhcmUgcHJlc3NlZCBpdCB3aWxsIGNhbmNlbCB0aGUgZGVmYXVsdCBsaW5rIGJlaGF2aW9yIGFuZCBpbnN0ZWFkIG5hdmlnYXRlIHRvIHRoZSBVUkwgc2V0IGluIHRoZVxuICogdGFyZ2V0J3MgaHJlZiBhdHRyaWJ1dGUuXG4gKlxuICogUHJlcmVxdWlzaXRpZXM6XG4gKiAgLSB2aWV3IGhhcyBhIHRoaXMucm91dGVyIGluc3RhbmNlLlxuICpcbiAqIEV4YW1wbGUgb2YgaG93IHRvIHVzZTpcbiAqICAgLSBJbiBhIHRlbXBsYXRlOlxuICogICAgIDxhIGhyZWY9XCIvc29tZS91cmlcIiBpZD1cIiNteS1saW5rXCIgLi4uXG4gKiAgICAgPGEgaHJlZj1cIi9zcGVjaWFsL3VyaVwiIGlkPVwiI215LXNwZWNpYWwtbGlua1wiIC4uLlxuICpcbiAqICAgLSBJbiB0aGUgdmlldyBmaWxlOlxuICogICAgIHZhciBuYXZpZ2F0ZVRocm91Z2hSb3V0ZXIgPSByZXF1aXJlKCcuLi8uLi9jb21tb24vdmlld19oZWxwZXJzL25hdmlnYXRlVGhyb3VnaFJvdXRlcicpO1xuICogICAgIG1vZHVsZS5leHBvcnRzID0gbmV3IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcbiAqICAgICAgIGV2ZW50czoge1xuICogICAgICAgICAnY2xpY2sgYSNteS1saW5rJzogbmF2aWdhdGVUaHJvdWdoUm91dGVyXG4gKiAgICAgICAgICdjbGljayBhI215LXNwZWNpYWwtbGluayc6IHRoaXMuX215Q3VzdG9tUm91dGVcbiAqICAgICAgIH1cbiAqXG4gKiAgICAgICBfbXlDdXN0b21Sb3V0ZTogZnVuY3Rpb24oZXYpIHtcbiAqICAgICAgICAgLy8gSGVyZSB5b3UgY2FuIGRvIHlvdSBjdXN0b20gbG9naWMgYmVmb3JlL2FmdGVyIHRoZSByb3V0aW5nLCBlLmcuOlxuICogICAgICAgICBjb25zb2xlLmxvZygnYmVmb3JlIGNoYW5naW5nIHJvdXRlJyk7XG4gKiAgICAgICAgIG5hdmlnYXRlVGhyb3VnaFJvdXRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICogICAgICAgICBjb25zb2xlLmxvZygnYWZ0ZXIgY2hhbmdpbmcgcm91dGUnKTtcbiAqICAgICAgIH1cbiAqXG4gKiBAcGFyYW0gZXYge0V2ZW50fVxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGV2KSB7XG4gIC8vIFdlIGFsd2F5cyBraWxsIHRoZSBkZWZhdWx0IGJlaGF2aW91ciBvZiB0aGUgZXZlbnQsIHNpbmNlIGNvbnRhaW5lciBhcm91bmQgdmlldyBtaWdodCBoYXZlIG90aGVyIGNsaWNrIGJlaGF2aW9yLlxuICAvLyBJbiBjYXNlIG9mIGEgY21kL2N0cmwgY2xpY2sgYnkgYW4gdXNlci5cbiAgdGhpcy5raWxsRXZlbnQoZXYpO1xuICB2YXIgdXJsID0gJChldi50YXJnZXQpLmNsb3Nlc3QoJ2EnKS5hdHRyKCdocmVmJyk7XG5cbiAgaWYgKCF1cmwpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoIWlzTGludXhNaWRkbGVPclJpZ2h0Q2xpY2soZXYpICYmICFpc01hY0NtZEtleVByZXNzZWQoZXYpKSB7XG4gICAgKHRoaXMucm91dGVyIHx8IHRoaXMub3B0aW9ucy5yb3V0ZXIpLm5hdmlnYXRlKHVybCwgeyB0cmlnZ2VyOiB0cnVlIH0pO1xuICB9IGVsc2UgaWYgKGlzQ3RybEtleVByZXNzZWQoZXYpIHx8IGlzTWFjQ21kS2V5UHJlc3NlZChldikpIHtcbiAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnKTtcbiAgfVxufTtcbiIsInZhciBwbHVyYWxpemVTdHIgPSBmdW5jdGlvbihzaW5ndWxhciwgcGx1cmFsLCBjb3VudCkge1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuICAgIC8vIEJhY2t3YXJkIGNvbXBhYmlsaXR5IHdpdGggcHJldiB1c2FnZXMsIHJldHJvZml0IHRvIHRoZSBuZXcgcGFyYW1zIHNpZ25hdHVyZVxuICAgIC8vIHBsdXJhbGl6ZVN0cignZm9vYmFyJyAsIDMpIC8vID0+IGZvb2JhcnNcbiAgICByZXR1cm4gcGx1cmFsaXplU3RyLmNhbGwodGhpcywgYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMF0gKyAncycsIGFyZ3VtZW50c1sxXSk7XG4gIH1cblxuICByZXR1cm4gY291bnQgPT09IDEgPyBzaW5ndWxhciA6IHBsdXJhbDtcbn07XG5cbnBsdXJhbGl6ZVN0ci5wcmVmaXhXaXRoQ291bnQgPSBmdW5jdGlvbihzaW5ndWxhciwgcGx1cmFsLCBjb3VudCkge1xuICByZXR1cm4gcGx1cmFsaXplU3RyKFxuICAgICcxICcgKyBzaW5ndWxhciwgLy8gZS5nLiAxIGl0ZW1cbiAgICBjb3VudCArICcgJyArIHBsdXJhbCwgLy8gZS5nLiAxMjMgaXRlbXNcbiAgICBjb3VudFxuICApO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHBsdXJhbGl6ZVN0cjtcbiIsIi8qKlxuICogUmFuZG9tIHF1b3RlXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XG5cbiAgdmFyIHRlbXBsYXRlICA9IF8udGVtcGxhdGUoJzxwIGNsYXNzPVwiQ0RCLVRleHQgQ0RCLVNpemUtbWVkaXVtIHUtYWx0VGV4dENvbG9yXCI+XCI8JT0gcXVvdGUgJT5cIjwvcD48JSBpZiAoYXV0aG9yKSB7ICU+PHAgY2xhc3M9XCJDREItVGV4dCBDREItU2l6ZS1tZWRpdW0gdS1hbHRUZXh0Q29sb3IgdS10U3BhY2VcIj48ZW0+4oCTIDwlLSBhdXRob3IgJT48L2VtPjwvcD48JSB9ICU+Jyk7XG5cbiAgdmFyIHF1b3RlcyA9IFtcbiAgICB7IHF1b3RlOiBcIkdlb2dyYXBoZXJzIG5ldmVyIGdldCBsb3N0LiBUaGV5IGp1c3QgZG8gYWNjaWRlbnRhbCBmaWVsZCB3b3JrLlwiLCBhdXRob3I6IFwiTmljaG9sYXMgQ2hyaXNtYW5cIiB9LFxuICAgIHsgcXVvdGU6IFwiR2VvZ3JhcGh5IGlzIGp1c3QgcGh5c2ljcyBzbG93ZWQgZG93biwgd2l0aCBhIGNvdXBsZSBvZiB0cmVlcyBzdHVjayBpbiBpdC5cIiwgYXV0aG9yOiBcIlRlcnJ5IFByYXRjaGV0dFwiIH0sXG4gICAgeyBxdW90ZTogXCJOb3QgYWxsIHRob3NlIHdobyB3YW5kZXIgYXJlIGxvc3QuXCIsIGF1dGhvcjogXCJKLiBSLiBSLiBUb2xraWVuXCIgfSxcbiAgICB7IHF1b3RlOiBcIkluIHRoYXQgRW1waXJlLCB0aGUgQXJ0IG9mIENhcnRvZ3JhcGh5IGF0dGFpbmVkIHN1Y2ggUGVyZmVjdGlvbiB0aGF0IHRoZSBtYXAgb2YgYSBzaW5nbGUgUHJvdmluY2Ugb2NjdXBpZWQgdGhlIGVudGlyZXR5IG9mIGEgQ2l0eS5cIiwgYXV0aG9yOiBcIkpvcmdlIEx1aXMgQm9yZ2VzXCIgfSxcbiAgICB7IHF1b3RlOiBcIlggbWFya3MgdGhlIHNwb3RcIiwgYXV0aG9yOiBcIkluZGlhbmEgSm9uZXNcIiB9LFxuICAgIHsgcXVvdGU6IFwiSXQncyB0dXJ0bGVzIGFsbCB0aGUgd2F5IGRvd24uXCIsIGF1dGhvcjogbnVsbCB9LFxuICAgIHsgcXVvdGU6IFwiUmVtZW1iZXI6IG5vIG1hdHRlciB3aGVyZSB5b3UgZ28sIHRoZXJlIHlvdSBhcmUuXCIsIGF1dGhvcjogbnVsbCB9LFxuICAgIHsgcXVvdGU6IFwiV2l0aG91dCBnZW9ncmFwaHksIHlvdSdyZSBub3doZXJlIVwiLCBhdXRob3I6IFwiSmltbXkgQnVmZmV0dFwiIH0sXG4gICAgeyBxdW90ZTogXCJvdXIgZWFydGggaXMgYSBnbG9iZSAvIHdob3NlIHN1cmZhY2Ugd2UgcHJvYmUgLzxiciAvPm5vIG1hcCBjYW4gcmVwbGFjZSBoZXIgLyBidXQganVzdCB0cnkgdG8gdHJhY2UgaGVyXCIsIGF1dGhvcjogXCJTdGV2ZSBXYXRlcm1hblwiIH0sXG4gICAgeyBxdW90ZTogXCJFdmVyeXRoaW5nIGhhcHBlbnMgc29tZXdoZXJlLlwiLCBhdXRob3I6IFwiRG9jdG9yIFdob1wiIH0sXG4gICAgeyBxdW90ZTogXCJBIG1hcCBpcyB0aGUgZ3JlYXRlc3Qgb2YgYWxsIGVwaWMgcG9lbXMuIEl0cyBsaW5lcyBhbmQgY29sb3JzIHNob3cgdGhlIHJlYWxpemF0aW9uIG9mIGdyZWF0IGRyZWFtcy5cIiwgYXV0aG9yOiBcIkdpbGJlcnQgSC4gR3Jvc3Zlbm9yXCIgfSxcbiAgICB7IHF1b3RlOiBcIkV2ZXJ5dGhpbmcgaXMgcmVsYXRlZCB0byBldmVyeXRoaW5nIGVsc2UsPGJyIC8+YnV0IG5lYXIgdGhpbmdzIGFyZSBtb3JlIHJlbGF0ZWQgdGhhbiBkaXN0YW50IHRoaW5ncy5cIiwgYXV0aG9yOiBcIlRvYmxlcidzIGZpcnN0IGxhdyBvZiBnZW9ncmFwaHlcIiB9LFxuICAgIHsgcXVvdGU6IFwiSGljIFN1bnQgRHJhY29uZXNcIiwgYXV0aG9yOiBudWxsIH0sXG4gICAgeyBxdW90ZTogXCJIZXJlIGJlIGRyYWdvbnNcIiwgYXV0aG9yOiBudWxsIH0sXG4gICAgeyBxdW90ZTogXCJTdGFuZCBpbiB0aGUgcGxhY2Ugd2hlcmUgeW91IGxpdmUgLyBOb3cgZmFjZSBOb3J0aCAvPGJyLz5UaGluayBhYm91dCBkaXJlY3Rpb24gLyBXb25kZXIgd2h5IHlvdSBoYXZlbid0IGJlZm9yZVwiLCBhdXRob3I6IFwiUi5FLk1cIiB9LFxuICAgIHsgcXVvdGU6IFwiVGhlIHZpcnR1ZSBvZiBtYXBzLCB0aGV5IHNob3cgd2hhdCBjYW4gYmUgZG9uZSB3aXRoIGxpbWl0ZWQgc3BhY2UsIHRoZXkgZm9yZXNlZSB0aGF0IGV2ZXJ5dGhpbmcgY2FuIGhhcHBlbiB0aGVyZWluLlwiLCBhdXRob3I6IFwiSm9zw6kgU2FyYW1hZ29cIiB9XG4gIF07XG5cbiAgdmFyIHIgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAocXVvdGVzLmxlbmd0aCAtIDEpKTtcblxuICByZXR1cm4gdGVtcGxhdGUocXVvdGVzW3JdKTtcbn07XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xudmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XG5cbnZhciBCYXNlRGlhbG9nID0gY2RiLnVpLmNvbW1vbi5EaWFsb2c7XG5cbi8qKlxuICogQWJzdHJhY3QgdmlldyBmb3IgYSBkaWFsb2csIGEga2luZCBvZiB2aWV3IHRoYXQgdGFrZXMgdXAgdGhlIGZ1bGwgc2NyZWVuIG92ZXJsYXlpbmcgYW55IHByZXZpb3VzIGNvbnRlbnQuXG4gKlxuICogVG8gYmUgZXh0ZW5kZWQgZm9yIGEgc3BlY2lmaWMgdXNlLWNhc2UuXG4gKiBJdCBpbmhlcml0cyBmcm9tIENhcnRvREIuanMnIERpYWxvZyB2aWV3IHNvIGhhcyBzb21lIHBhcnRpY3VsYXIgYmVoYXZpb3IvY29udmVudGlvbiBvZiBob3cgdG8gYmUgdXNlZCwgc2VlIGV4YW1wbGVcbiAqXG4gKiBFeGFtcGxlIG9mIGhvdyB0byB1c2U6XG4gKiAgIC8vIEV4dGVuZCB0aGlzIHZpZXdcbiAqICAgdmFyIE15RGlhbG9nID0gQmFzZURpYWxvZy5leHRlbmQoe1xuICogICAgIHJlbmRlcl9jb250ZW50OiBmdW5jdGlvbigpIHtcbiAqICAgICAgIHJldHVybiAnSGVsbG8gd29ybGQhJztcbiAqICAgICB9XG4gKiAgIH0pO1xuICpcbiAqICAgLy8gQ3JlYXRlIGluc3RhbmNlIG9iamVjdC5cbiAqICAgdmFyIGRpYWxvZyA9IG5ldyBNeURpYWxvZygpO1xuICpcbiAqICAgLy8gVG8gcmVuZGVyICYgc2hvdyBpbml0aWFsbHkgKG9ubHkgdG8gYmUgY2FsbGVkIG9uY2UpOlxuICogICBkaWFsb2cuYXBwZW5kVG9Cb2R5KCk7XG4gKi9cbm1vZHVsZS5leHBvcnRzID0gQmFzZURpYWxvZy5leHRlbmQoe1xuXG4gIGNsYXNzTmFtZTogJ0RpYWxvZyBpcy1vcGVuaW5nJyxcblxuICBvdmVycmlkZURlZmF1bHRzOiB7XG4gICAgdGVtcGxhdGVfbmFtZTogJ2NvbW1vbi92aWV3cy9iYXNlX2RpYWxvZy90ZW1wbGF0ZScsXG4gICAgdHJpZ2dlckRpYWxvZ0V2ZW50czogdHJ1ZVxuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIC8vIE92ZXJyaWRlIGRlZmF1bHRzIG9mIHBhcmVudFxuICAgIF8uZGVmYXVsdHModGhpcy5vcHRpb25zLCB0aGlzLm92ZXJyaWRlRGVmYXVsdHMpO1xuICAgIHRoaXMuZWxkZXIoJ2luaXRpYWxpemUnKTtcbiAgICB0aGlzLmJpbmQoJ3Nob3cnLCB0aGlzLl9zZXRCb2R5Rm9yRGlhbG9nTW9kZS5iaW5kKHRoaXMsICdhZGQnKSk7XG4gICAgdGhpcy5iaW5kKCdoaWRlJywgdGhpcy5fc2V0Qm9keUZvckRpYWxvZ01vZGUuYmluZCh0aGlzLCAncmVtb3ZlJykpO1xuICB9LFxuXG4gIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VEaWFsb2cucHJvdG90eXBlLnNob3cuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB0aGlzLnRyaWdnZXIoJ3Nob3cnKTtcbiAgICBpZiAodGhpcy5vcHRpb25zLnRyaWdnZXJEaWFsb2dFdmVudHMpIHtcbiAgICAgIGNkYi5nb2QudHJpZ2dlcignZGlhbG9nT3BlbmVkJyk7XG4gICAgfVxuICAgIHRoaXMuJGVsLnJlbW92ZUNsYXNzKCdpcy1jbG9zaW5nJyk7XG5cbiAgICAvLyBCbHVyIGN1cnJlbnQgZWxlbWVudCAoZS5nLiBhIDxhPiB0YWcgdGhhdCB3YXMgY2xpY2tlZCB0byBvcGVuIHRoaXMgd2luZG93KVxuICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7XG4gICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKTtcbiAgICB9XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBCYXNlRGlhbG9nLnByb3RvdHlwZS5yZW5kZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB0aGlzLiQoJy5jb250ZW50JykuYWRkQ2xhc3MoJ2lzLW5ld0NvbnRlbnQnKTtcblxuICAgIGlmICh0aGlzLl9pc1N0aWNreSgpKSB7XG4gICAgICB0aGlzLiRlbC5hZGRDbGFzcygnaXMtc3RpY2t5Jyk7XG4gICAgfVxuXG4gICAgdGhpcy5zaG93KCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2lzU3RpY2t5OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5zdGlja3k7XG4gIH0sXG5cbiAgY2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2NhbmNlbCh1bmRlZmluZWQsIHRydWUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBAb3ZlcnJpZGUgY2RiLnVpLmNvbW1vbi5EaWFsb2cucHJvdG90eXBlLm9wZW4gZm9yIGFuaW1hdGVkIG9wZW5pbmdcbiAgICovXG4gIG9wZW46IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VEaWFsb2cucHJvdG90eXBlLm9wZW4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB0aGlzLnNob3coKTtcbiAgfSxcblxuICAvKipcbiAgICogQG92ZXJyaWRlIGNkYi51aS5jb21tb24uRGlhbG9nLnByb3RvdHlwZS5oaWRlIHRvIGltcGxlbWVudCBhbmltYXRpb25cbiAgICovXG4gIGhpZGU6IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VEaWFsb2cucHJvdG90eXBlLmhpZGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB0aGlzLnRyaWdnZXIoJ2hpZGUnKTtcbiAgfSxcblxuICAvKipcbiAgICogQG92ZXJyaWRlIGNkYi51aS5jb21tb24uRGlhbG9nLnByb3RvdHlwZS5fY2FuY2VsIHRvIGltcGxlbWVudCBhbmltYXRpb24gdXBvbiBjbG9zaW5nIHRoZSBkaWFsb2cgYW5kIHRvIGhhbmRsZSBoaWRlIGV2ZW50LlxuICAgKi9cbiAgX2NhbmNlbDogZnVuY3Rpb24oZXYsIHNraXBDYW5jZWxDYWxsYmFjaykge1xuICAgIGlmIChldikgdGhpcy5raWxsRXZlbnQoZXYpO1xuXG4gICAgaWYgKHRoaXMuX2lzU3RpY2t5KCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLiRlbC5yZW1vdmVDbGFzcygnaXMtb3BlbmluZycpLmFkZENsYXNzKCdpcy1jbG9zaW5nJyk7XG5cbiAgICAvLyBVc2UgdGltZW91dCBpbnN0ZWFkIG9mIGV2ZW50IGxpc3RlbmVyIG9uIGFuaW1hdGlvbiBzaW5jZSB0aGUgZXZlbnQgdHJpZ2dlcmVkIGRpZmZlcnMgZGVwZW5kaW5nIG9uIGJyb3dzZXJcbiAgICAvLyBUaW1pbmcgd29uJ3QgcGVyaGFwcyBiZSAxMDAlIGFjY3VyYXRlIGJ1dCBpdCdzIGdvb2QgZW5vdWdoXG4gICAgLy8gVGhlIHRpbWVvdXQgc2hvdWxkIG1hdGNoIHRoZSAuRGlhbG9nLmlzLWNsb3NpbmcgYW5pbWF0aW9uIGR1cmF0aW9uLlxuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgLy8gZnJvbSBvcmlnaW5hbCBfY2FuY2VsXG4gICAgICBpZiAoc2VsZi5jYW5jZWwgJiYgIXNraXBDYW5jZWxDYWxsYmFjaykge1xuICAgICAgICBzZWxmLmNhbmNlbCgpO1xuICAgICAgfVxuICAgICAgQmFzZURpYWxvZy5wcm90b3R5cGUuaGlkZS5jYWxsKHNlbGYpO1xuICAgIH0sIDgwKTsgLy9tc1xuXG4gICAgLy8gVHJpZ2dlciBldmVudHMgaW1tZWRpYXRlbHksIGRvbid0IHdhaXQgZm9yIHRoZSB0aW1lb3V0IGFib3ZlXG4gICAgdGhpcy50cmlnZ2VyKCdoaWRlJyk7XG4gICAgaWYgKHRoaXMub3B0aW9ucy50cmlnZ2VyRGlhbG9nRXZlbnRzKSB7XG4gICAgICBjZGIuZ29kLnRyaWdnZXIoJ2RpYWxvZ0Nsb3NlZCcpO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogQG92ZXJyaWRlIGNkYi51aS5jb21tb24uRGlhbG9nLnByb3RvdHlwZS5fb2sgdG8gbm90IGhpZGUgZGlhbG9nIGJ5IGRlZmF1bHQgaWYgdGhlcmUncyBhbiBvayBtZXRob2QgZGVmaW5lZC5cbiAgICovXG4gIF9vazogZnVuY3Rpb24oZXYpIHtcbiAgICB0aGlzLmtpbGxFdmVudChldik7XG4gICAgaWYgKHRoaXMub2spIHtcbiAgICAgIHRoaXMub2soKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfSxcblxuICBfc2V0Qm9keUZvckRpYWxvZ01vZGU6IGZ1bmN0aW9uKGFjdGlvbikge1xuICAgICQoJ2JvZHknKVthY3Rpb24gKyAnQ2xhc3MnXSgnaXMtaW5EaWFsb2cnKTtcbiAgfVxuXG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XG5jZGIuYWRtaW4gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ11bJ2FkbWluJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXVsnYWRtaW4nXSA6IG51bGwpO1xudmFyIG1vbWVudCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydtb21lbnQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ21vbWVudCddIDogbnVsbCk7XG52YXIgU3Bpbm5lciA9IHJlcXVpcmUoJy4uLy4uL2Zvcm1zL3NwaW5uZXInKTtcblxuXG4vKipcbiAqIEN1c3RvbSBwaWNlciBmb3IgYSBkYXRlcyByYW5nZS5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgX01BWF9SQU5HRTogMzAsXG4gIF9GT1VSX0hPVVJTOiB7IGFtb3VudDogNCwgdW5pdDogJ2hvdXJzJyB9LFxuICBfT05FX0RBWTogeyBhbW91bnQ6IDEsIHVuaXQ6ICdkYXknIH0sXG4gIF9PTkVfV0VFSzogeyBhbW91bnQ6IDEsIHVuaXQ6ICd3ZWVrJyB9LFxuXG4gIGNsYXNzTmFtZTogJ0RhdGVQaWNrZXInLFxuXG4gIG9wdGlvbnM6IHtcbiAgICBmbGF0OiB0cnVlLFxuICAgIGRhdGU6IFsnMjAwOC0wNy0zMScsICcyMDA4LTA3LTMxJ10sXG4gICAgY3VycmVudDogJzIwMDgtMDctMzEnLFxuICAgIGNhbGVuZGFyczogMixcbiAgICBtb2RlOiAncmFuZ2UnLFxuICAgIHN0YXJ0czogMVxuICB9LFxuXG4gIGV2ZW50czoge1xuICAgICdjbGljayAuanMtZGF0ZXMnOiAnX3RvZ2dsZUNhbGVuZGFyJyxcbiAgICAnY2xpY2sgLmpzLWZvdXJIb3Vycyc6IGZ1bmN0aW9uICgpIHsgdGhpcy5fc2V0UHJldmlvdXNUaW1lKHRoaXMuX0ZPVVJfSE9VUlMpOyB9LFxuICAgICdjbGljayAuanMtb25lRGF5JzogZnVuY3Rpb24gKCkgeyB0aGlzLl9zZXRQcmV2aW91c1RpbWUodGhpcy5fT05FX0RBWSk7IH0sXG4gICAgJ2NsaWNrIC5qcy1vbmVXZWVrJzogZnVuY3Rpb24gKCkgeyB0aGlzLl9zZXRQcmV2aW91c1RpbWUodGhpcy5fT05FX1dFRUspOyB9XG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGlzRGlzYWJsZWQgPSAodGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5kaXNhYmxlZCkgPyB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgOiBmYWxzZTtcblxuICAgIC8vIEdlbmVyYXRlIG1vZGVsXG4gICAgdGhpcy5tb2RlbCA9IG5ldyBjZGIuY29yZS5Nb2RlbCh7XG4gICAgICBmcm9tRGF0ZTogJycsXG4gICAgICBmcm9tSG91cjogMCxcbiAgICAgIGZyb21NaW46ICAwLFxuICAgICAgdG9EYXRlOiAnJyxcbiAgICAgIHRvSG91cjogMjMsXG4gICAgICB0b01pbjogIDU5LFxuICAgICAgdXNlcl90aW1lem9uZTogMCwgLy8gRXhwbGFpbmVkIGFzIEdNVCswXG4gICAgICBkaXNhYmxlZDogaXNEaXNhYmxlZFxuICAgIH0pO1xuXG4gICAgdGhpcy50ZW1wbGF0ZSA9IHRoaXMub3B0aW9ucy50ZW1wbGF0ZSB8fCBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vdmlld3MvZGF0ZV9waWNrZXJzL2RhdGVzX3JhbmdlJyk7XG5cbiAgICB0aGlzLl9pbml0QmluZHMoKTtcbiAgICB0aGlzLl9zZXRUb2RheSgpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdGhpcy5jbGVhclN1YlZpZXdzKCk7XG4gICAgdGhpcy4kZWwuZW1wdHkoKTsgICAgXG5cbiAgICB0aGlzLiRlbC5hcHBlbmQoXG4gICAgICB0aGlzLnRlbXBsYXRlKFxuICAgICAgICBfLmV4dGVuZChcbiAgICAgICAgICB0aGlzLm1vZGVsLmF0dHJpYnV0ZXMsXG4gICAgICAgICAgeyBtYXhfZGF5czogdGhpcy5fTUFYX1JBTkdFIH1cbiAgICAgICAgKVxuICAgICAgKVxuICAgICk7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi5faW5pdENhbGVuZGFyKCk7XG4gICAgICBzZWxmLl9oaWRlQ2FsZW5kYXIoKTtcbiAgICAgIHNlbGYuX2luaXRUaW1lcnMoKTtcbiAgICB9LCAxMDApO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgXy5iaW5kQWxsKHRoaXMsICdfb25EYXRlc0NoYW5nZScsICdfb25Eb2N1bWVudENsaWNrJyk7XG5cbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZScsIHRoaXMuX3NldFZhbHVlcywgdGhpcyk7XG4gICAgdGhpcy5tb2RlbC5iaW5kKCdjaGFuZ2UnLCB0aGlzLl9vblZhbHVlc0NoYW5nZSwgdGhpcyk7XG5cbiAgICAvLyBPdXRzaWRlIGNsaWNrXG4gICAgJChkb2N1bWVudCkuYmluZCgnY2xpY2snLCB0aGlzLl9vbkRvY3VtZW50Q2xpY2spO1xuICB9LFxuXG4gIF9kZXN0cm95QmluZHM6IGZ1bmN0aW9uKCkge1xuICAgICQoZG9jdW1lbnQpLnVuYmluZCgnY2xpY2snLCB0aGlzLl9vbkRvY3VtZW50Q2xpY2spO1xuICB9LFxuXG4gIF9mb3JtYXR0ZWREYXRlOiBmdW5jdGlvbiAod2hpY2gpIHtcbiAgICByZXR1cm4gd2hpY2ggKyAnICcgK1xuICAgICAgJzxzdHJvbmc+JyArXG4gICAgICAgIHRoaXMubW9kZWwuZ2V0KHdoaWNoICsgJ0RhdGUnKSArICcgJyArXG4gICAgICAgIChjZGIuVXRpbHMucGFkKHRoaXMubW9kZWwuZ2V0KHdoaWNoICsgJ0hvdXInKSwgMikgKyAnOicgKyBjZGIuVXRpbHMucGFkKHRoaXMubW9kZWwuZ2V0KHdoaWNoICsgJ01pbicpLCAyKSkgK1xuICAgICAgJzwvc3Ryb25nPic7XG4gIH0sXG5cbiAgX3NldFZhbHVlczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRleHQgPSAnQ2hvb3NlIHlvdXIgZGF0ZXMnO1xuICAgIHZhciBkYXRhID0gdGhpcy5tb2RlbC5hdHRyaWJ1dGVzO1xuXG4gICAgaWYgKGRhdGEuZnJvbURhdGUgJiYgZGF0YS50b0RhdGUpIHtcbiAgICAgIHZhciBjYWxlbmRhckljb24gPSAnPGkgY2xhc3M9XCJDREItSWNvbkZvbnQgQ0RCLUljb25Gb250LWNhbGVuZGFyIERhdGVQaWNrZXItZGF0ZXNJY29uXCI+PC9pPic7XG4gICAgICB0ZXh0ID0gdGhpcy5fZm9ybWF0dGVkRGF0ZSgnZnJvbScpICsgJyAnICsgdGhpcy5fZm9ybWF0dGVkRGF0ZSgndG8nKSArIGNhbGVuZGFySWNvbjtcbiAgICB9XG5cbiAgICB0aGlzLiQoJy5EYXRlUGlja2VyLWRhdGVzJykuaHRtbCh0ZXh0KTtcbiAgfSxcblxuICBfc2V0VG9kYXk6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkYXRlc1VUQyA9IHRoaXMubW9kZWwuZ2V0KCd1c2VyX3RpbWV6b25lJyk7XG4gICAgdmFyIHRvZGF5ID0gbW9tZW50KCkudXRjKGRhdGVzVVRDKTtcbiAgICB2YXIgcHJldmlvdXMgPSBtb21lbnQoKS51dGMoZGF0ZXNVVEMpLnN1YnRyYWN0KCh0aGlzLl9NQVhfUkFOR0UgLSAxKSwgJ2RheXMnKTtcbiAgICB0aGlzLm9wdGlvbnMuZGF0ZSA9IFtwcmV2aW91cy5mb3JtYXQoXCJZWVlZLU1NLUREXCIpLCB0b2RheS5mb3JtYXQoXCJZWVlZLU1NLUREXCIpXTtcbiAgICB0aGlzLm9wdGlvbnMuY3VycmVudCA9IHRvZGF5LmZvcm1hdChcIllZWVktTU0tRERcIik7XG4gICAgdGhpcy5fc2V0TW9kZWxGcm9tUHJldmlvdXMocHJldmlvdXMpO1xuICB9LFxuXG4gIF9pbml0Q2FsZW5kYXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxlY3RvciA9ICcuRGF0ZVBpY2tlci1jYWxlbmRhcic7XG5cbiAgICAvLyBDYW4ndCBpbml0aWFsaXplIGNhbGVuZGFyIGlmIG5vdCBhbHJlYWR5IHByZXNlbnQgaW4gZG9jdW1lbnQuLi4gYXZvaWQgZXJyb3JzIGJlaW5nIHRocm93blxuICAgIGlmICghZG9jdW1lbnQuYm9keS5jb250YWlucyh0aGlzLiQoc2VsZWN0b3IpWzBdKSkgcmV0dXJuO1xuXG4gICAgdGhpcy5jYWxlbmRhciA9IHRoaXMuJChzZWxlY3RvcikuRGF0ZVBpY2tlcihcbiAgICAgIF8uZXh0ZW5kKHRoaXMub3B0aW9ucywge1xuICAgICAgICBvbkNoYW5nZTogdGhpcy5fb25EYXRlc0NoYW5nZSxcbiAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uKGQpIHsgLy8gRGlzYWJsZSBmdXR1cmUgZGF0ZXMgYW5kIGRhdGVzIDwgMzAgZGF5cyBhZ29cblxuICAgICAgICAgIHZhciBkYXRlID0gZC52YWx1ZU9mKCk7XG4gICAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgICB2YXIgdGhpcnR5RGF5c0FnbyA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgdGhpcnR5RGF5c0Fnby5zZXREYXRlKG5vdy5nZXREYXRlKCkgLSAzMCk7XG5cbiAgICAgICAgICByZXR1cm4gKGRhdGUgPCB0aGlydHlEYXlzQWdvKSB8fCAoZGF0ZSA+IG5vdykgPyB7IGRpc2FibGVkOiB0cnVlIH0gOiAnJ1xuXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcbiAgfSxcblxuICBfb25EYXRlc0NoYW5nZTogZnVuY3Rpb24oZm9ybWF0dGVkLCBkYXRlcykge1xuXG4gICAgLy8gQ2hlY2sgaWYgc2VsZWN0ZWQgZGF0ZXMgaGF2ZSBtb3JlIHRoYW4gMzAgZGF5c1xuICAgIHZhciBzdGFydCA9IG1vbWVudChmb3JtYXR0ZWRbMF0pO1xuICAgIHZhciBlbmQgPSBtb21lbnQoZm9ybWF0dGVkWzFdKTtcblxuICAgIGlmIChNYXRoLmFicyhzdGFydC5kaWZmKGVuZCwgJ2RheXMnKSkgPiB0aGlzLl9NQVhfUkFOR0UpIHtcbiAgICAgIGZvcm1hdHRlZFsxXSA9IG1vbWVudChmb3JtYXR0ZWRbMF0pLmFkZCgnZGF5cycsIHRoaXMuX01BWF9SQU5HRSkuZm9ybWF0KFwiWVlZWS1NTS1ERFwiKTtcbiAgICAgIHRoaXMuJCgnLkRhdGVQaWNrZXItY2FsZW5kYXInKS5EYXRlUGlja2VyU2V0RGF0ZShbZm9ybWF0dGVkWzBdLCBmb3JtYXR0ZWRbMV1dKTtcbiAgICB9XG5cbiAgICB0aGlzLm1vZGVsLnNldCh7XG4gICAgICBmcm9tRGF0ZTogZm9ybWF0dGVkWzBdLFxuICAgICAgdG9EYXRlOiAgIGZvcm1hdHRlZFsxXVxuICAgIH0pXG4gIH0sXG5cbiAgX2hpZGVDYWxlbmRhcjogZnVuY3Rpb24oZSkge1xuICAgIGlmIChlKSB0aGlzLmtpbGxFdmVudChlKTtcbiAgICB0aGlzLiQoJy5EYXRlUGlja2VyLWRyb3Bkb3duJykuaGlkZSgpO1xuICB9LFxuXG4gIF90b2dnbGVDYWxlbmRhcjogZnVuY3Rpb24oZXYpIHtcbiAgICBpZiAoZXYpIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICB0aGlzLiQoJy5EYXRlUGlja2VyLWRyb3Bkb3duJykudG9nZ2xlKCk7XG4gIH0sXG5cbiAgX3NldFByZXZpb3VzVGltZTogZnVuY3Rpb24gKHRpbWVTcGFuKSB7XG4gICAgdmFyIHByZXZpb3VzID0gbW9tZW50KCkudXRjKDApLnN1YnRyYWN0KHRpbWVTcGFuLmFtb3VudCwgdGltZVNwYW4udW5pdCk7XG4gICAgdGhpcy5fc2V0TW9kZWxGcm9tUHJldmlvdXMocHJldmlvdXMpO1xuICAgIHRoaXMuX3NldERhdGVwaWNrZXJGcm9tUHJldmlvdXMocHJldmlvdXMpO1xuICAgIHRoaXMuY2xvc2VDYWxlbmRhcigpO1xuICB9LFxuXG4gIF9zZXRNb2RlbEZyb21QcmV2aW91czogZnVuY3Rpb24ocHJldmlvdXMpIHtcbiAgICB2YXIgdG9kYXkgPSBtb21lbnQoKS51dGMoMCk7XG5cbiAgICB0aGlzLm1vZGVsLnNldCh7XG4gICAgICBmcm9tRGF0ZTogcHJldmlvdXMuZm9ybWF0KCdZWVlZLU1NLUREJyksXG4gICAgICBmcm9tSG91cjogcGFyc2VJbnQocHJldmlvdXMuZm9ybWF0KCdIJykpLFxuICAgICAgZnJvbU1pbjogIHBhcnNlSW50KHByZXZpb3VzLmZvcm1hdCgnbScpKSxcbiAgICAgIHRvRGF0ZTogdG9kYXkuZm9ybWF0KCdZWVlZLU1NLUREJyksXG4gICAgICB0b0hvdXI6IHBhcnNlSW50KHRvZGF5LmZvcm1hdCgnSCcpKSxcbiAgICAgIHRvTWluOiAgcGFyc2VJbnQodG9kYXkuZm9ybWF0KCdtJykpXG4gICAgfSk7XG4gIH0sXG5cbiAgX3NldERhdGVwaWNrZXJGcm9tUHJldmlvdXM6IGZ1bmN0aW9uKHByZXZpb3VzKSB7XG4gICAgdmFyIHRvZGF5ID0gbW9tZW50KCkudXRjKDApOyAgICBcbiAgICB0aGlzLiQoJy5EYXRlUGlja2VyLWNhbGVuZGFyJykuRGF0ZVBpY2tlclNldERhdGUoWyBwcmV2aW91cy5mb3JtYXQoJ1lZWVktTU0tREQnKSAsIHRvZGF5LmZvcm1hdCgnWVlZWS1NTS1ERCcpIF0pO1xuICB9LFxuXG4gIF9pbml0VGltZXJzOiBmdW5jdGlvbigpIHtcbiAgICAvLyAnRnJvbScgZGl2XG4gICAgdmFyICRmcm9tID0gdGhpcy4kKCcuRGF0ZVBpY2tlci10aW1lcnNGcm9tJyk7XG5cbiAgICAvLyBGcm9tIGhvdXJcbiAgICB2YXIgZnJvbUhvdXIgPSBuZXcgU3Bpbm5lcih7XG4gICAgICBtb2RlbDogICAgdGhpcy5tb2RlbCxcbiAgICAgIHByb3BlcnR5OiAnZnJvbUhvdXInLFxuICAgICAgbWluOiAgICAgIDAsXG4gICAgICBtYXg6ICAgICAgMjMsXG4gICAgICBpbmM6ICAgICAgMSxcbiAgICAgIHdpZHRoOiAgICAxNSxcbiAgICAgIHBhdHRlcm46ICAvXihbMTJdP1xcZHswLDF9fDNbMDFdezAsMn0pJC8sXG4gICAgICBkZWJvdW5jZV90aW1lOiAwXG4gICAgfSk7XG5cbiAgICAkZnJvbS5maW5kKCcuRGF0ZVBpY2tlci10aW1lcnNIb3VyJykuYXBwZW5kKGZyb21Ib3VyLnJlbmRlcigpLmVsKTtcbiAgICB0aGlzLmFkZFZpZXcoZnJvbUhvdXIpO1xuXG4gICAgLy8gRnJvbSBtaW5cbiAgICB2YXIgZnJvbU1pbiA9IG5ldyBTcGlubmVyKHtcbiAgICAgIG1vZGVsOiAgICB0aGlzLm1vZGVsLFxuICAgICAgcHJvcGVydHk6ICdmcm9tTWluJyxcbiAgICAgIG1pbjogICAgICAwLFxuICAgICAgbWF4OiAgICAgIDU5LFxuICAgICAgaW5jOiAgICAgIDEsXG4gICAgICB3aWR0aDogICAgMTUsXG4gICAgICBwYXR0ZXJuOiAgL14oWzEyMzQ1XT9cXGR7MCwxfSkkLyxcbiAgICAgIGRlYm91bmNlX3RpbWU6IDBcbiAgICB9KTtcblxuICAgICRmcm9tLmZpbmQoJy5EYXRlUGlja2VyLXRpbWVyc01pbicpLmFwcGVuZChmcm9tTWluLnJlbmRlcigpLmVsKTtcbiAgICB0aGlzLmFkZFZpZXcoZnJvbU1pbik7XG5cblxuICAgIC8vICdUbycgZGl2XG4gICAgdmFyICR0byA9IHRoaXMuJCgnLkRhdGVQaWNrZXItdGltZXJzVG8nKTtcblxuICAgIC8vIFRvIGhvdXJcbiAgICB2YXIgdG9Ib3VyID0gbmV3IFNwaW5uZXIoe1xuICAgICAgbW9kZWw6ICAgIHRoaXMubW9kZWwsXG4gICAgICBwcm9wZXJ0eTogJ3RvSG91cicsXG4gICAgICBtaW46ICAgICAgMCxcbiAgICAgIG1heDogICAgICAyMyxcbiAgICAgIGluYzogICAgICAxLFxuICAgICAgd2lkdGg6ICAgIDE1LFxuICAgICAgcGF0dGVybjogIC9eKFsxMl0/XFxkezAsMX18M1swMV17MCwyfSkkLyxcbiAgICAgIGRlYm91bmNlX3RpbWU6IDBcbiAgICB9KTtcblxuICAgICR0by5maW5kKCcuRGF0ZVBpY2tlci10aW1lcnNIb3VyJykuYXBwZW5kKHRvSG91ci5yZW5kZXIoKS5lbCk7XG4gICAgdGhpcy5hZGRWaWV3KHRvSG91cik7XG5cbiAgICAvLyBUbyBtaW5cbiAgICB2YXIgdG9NaW4gPSBuZXcgU3Bpbm5lcih7XG4gICAgICBtb2RlbDogICAgdGhpcy5tb2RlbCxcbiAgICAgIHByb3BlcnR5OiAndG9NaW4nLFxuICAgICAgbWluOiAgICAgIDAsXG4gICAgICBtYXg6ICAgICAgNTksXG4gICAgICBpbmM6ICAgICAgMSxcbiAgICAgIHdpZHRoOiAgICAxNSxcbiAgICAgIHBhdHRlcm46ICAvXihbMTIzNDVdP1xcZHswLDF9KSQvLFxuICAgICAgZGVib3VuY2VfdGltZTogMFxuICAgIH0pO1xuXG4gICAgJHRvLmZpbmQoJy5EYXRlUGlja2VyLXRpbWVyc01pbicpLmFwcGVuZCh0b01pbi5yZW5kZXIoKS5lbCk7XG4gICAgdGhpcy5hZGRWaWV3KHRvTWluKTtcbiAgfSxcblxuICBfb25WYWx1ZXNDaGFuZ2U6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudHJpZ2dlcignY2hhbmdlRGF0ZScsIHRoaXMubW9kZWwudG9KU09OKCksIHRoaXMpO1xuICB9LFxuXG4gIGdldERhdGVzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbC50b0pTT04oKTtcbiAgfSxcblxuICBjbG9zZUNhbGVuZGFyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoJy5EYXRlUGlja2VyLWRyb3Bkb3duJykuaGlkZSgpO1xuICB9LFxuXG4gIF9vbkRvY3VtZW50Q2xpY2s6IGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgJGVsID0gJChlLnRhcmdldCk7XG5cbiAgICBpZiAoJGVsLmNsb3Nlc3QoJy5EYXRlUGlja2VyJykubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLmNsb3NlQ2FsZW5kYXIoKTtcbiAgICB9XG4gIH0sXG5cbiAgY2xlYW46IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX2Rlc3Ryb3lCaW5kcygpO1xuICAgIHRoaXMuY2xvc2VDYWxlbmRhcigpO1xuICAgIHRoaXMuJCgnLkRhdGVQaWNrZXItY2FsZW5kYXInKS5EYXRlUGlja2VySGlkZSgpO1xuICAgIGNkYi5jb3JlLlZpZXcucHJvdG90eXBlLmNsZWFuLmNhbGwodGhpcyk7XG4gIH1cblxufSlcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqIEVycm9yIGRldGFpbHMgdmlldywgdG8gYmUgdXNlZCB0b2dldGhlciB3aXRoIGFuIGVycm9yIG9iamVjdCBmcm9tIGFuIGltcG9ydCBtb2RlbC5cbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgX1RFTVBMQVRFUzoge1xuICAgIDgwMDE6ICdjb21tb24vdmlld3Mvc2l6ZV9lcnJvcl9kZXRhaWxzX3VwZ3JhZGVfdGVtcGxhdGUnLFxuICAgIDgwMDU6ICdjb21tb24vdmlld3MvbGF5ZXJzX2Vycm9yX2RldGFpbHNfdXBncmFkZV90ZW1wbGF0ZScsXG4gICAgZGVmYXVsdDogJ2NvbW1vbi92aWV3cy9lcnJvcl9kZXRhaWxzJ1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudXNlciA9IHRoaXMub3B0aW9ucy51c2VyO1xuICAgIHRoaXMuZXJyID0gdGhpcy5vcHRpb25zLmVycjtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIC8vIFByZXZlbnRpbmcgcHJvYmxlbXMgY2hlY2tpbmcgaWYgdGhlIGVycm9yX2NvZGUgaXMgYSBudW1iZXIgb3IgYSBzdHJpbmdcbiAgICAvLyB3ZSBtYWtlIHRoZSBjb21wYXJpc2lvbiB3aXRoIG9ubHkgZG91YmxlID0uXG4gICAgdmFyIGVycm9yQ29kZSA9IHRoaXMuZXJyLmVycm9yX2NvZGUgJiYgcGFyc2VJbnQodGhpcy5lcnIuZXJyb3JfY29kZSk7XG4gICAgdmFyIHVwZ3JhZGVVcmwgPSBjZGIuY29uZmlnLmdldCgndXBncmFkZV91cmwnKTtcbiAgICB2YXIgdXNlckNhblVwZ3JhZGUgPSB1cGdyYWRlVXJsICYmICFjZGIuY29uZmlnLmdldCgnY2FydG9kYl9jb21faG9zdGVkJykgJiYgKCF0aGlzLnVzZXIuaXNJbnNpZGVPcmcoKSB8fCB0aGlzLnVzZXIuaXNPcmdPd25lcigpKTtcbiAgICB2YXIgdGVtcGxhdGVQYXRoID0gdGhpcy5fVEVNUExBVEVTWydkZWZhdWx0J107XG4gICAgdmFyIG9yaWdpbmFsVXJsID0gdGhpcy5lcnIub3JpZ2luYWxfdXJsO1xuICAgIHZhciBodHRwUmVzcG9uc2VDb2RlID0gdGhpcy5lcnIuaHR0cF9yZXNwb25zZV9jb2RlO1xuICAgIHZhciBodHRwUmVzcG9uc2VDb2RlTWVzc2FnZSA9IHRoaXMuZXJyLmh0dHBfcmVzcG9uc2VfY29kZV9tZXNzYWdlO1xuXG4gICAgaWYgKHVzZXJDYW5VcGdyYWRlICYmIHRoaXMuX1RFTVBMQVRFU1tlcnJvckNvZGVdKSB7XG4gICAgICB0ZW1wbGF0ZVBhdGggPSB0aGlzLl9URU1QTEFURVNbZXJyb3JDb2RlXTtcbiAgICB9XG5cbiAgICB2YXIgdGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKHRlbXBsYXRlUGF0aCk7XG5cbiAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgdGVtcGxhdGUoe1xuICAgICAgICBlcnJvckNvZGU6IGVycm9yQ29kZSxcbiAgICAgICAgdGl0bGU6IHRoaXMuZXJyLnRpdGxlLFxuICAgICAgICB0ZXh0OiB0aGlzLmVyci53aGF0X2Fib3V0LFxuICAgICAgICBpdGVtUXVldWVJZDogdGhpcy5lcnIuaXRlbV9xdWV1ZV9pZCxcbiAgICAgICAgb3JpZ2luYWxVcmw6IG9yaWdpbmFsVXJsLFxuICAgICAgICBodHRwUmVzcG9uc2VDb2RlOiBodHRwUmVzcG9uc2VDb2RlLFxuICAgICAgICBodHRwUmVzcG9uc2VDb2RlTWVzc2FnZTogaHR0cFJlc3BvbnNlQ29kZU1lc3NhZ2UsXG4gICAgICAgIHVzZXJDYW5VcGdyYWRlOiB1c2VyQ2FuVXBncmFkZSxcbiAgICAgICAgc2hvd1RyaWFsOiB0aGlzLnVzZXIuY2FuU3RhcnRUcmlhbCgpLFxuICAgICAgICB1cGdyYWRlVXJsOiB1cGdyYWRlVXJsXG4gICAgICB9KVxuICAgICk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG59KTtcbiIsInZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xudmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcblxuLyoqXG4gKiAgTWFwQ2FyZCBwcmV2aWV3c1xuICpcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBvcHRpb25zOiB7XG4gICAgd2lkdGg6IDMwMCxcbiAgICBoZWlnaHQ6IDE3MCxcbiAgICBwcml2YWN5OiAnUFVCTElDJyxcbiAgICB1c2VybmFtZTogJycsXG4gICAgdmlzSWQ6ICcnLFxuICAgIG1hcHNBcGlSZXNvdXJjZTogJycsXG4gICAgY2xhc3NOYW1lOiAnJyxcbiAgICBhdXRoVG9rZW5zOiBbXVxuICB9LFxuXG4gIF9URU1QTEFURVM6IHtcbiAgICAvLyBVc2luZyA8JT0gJT4gaW5zdGVhZCBvZiA8JS0gJT4gYmVjYXVzZSBpZiBub3QgLyBjaGFyYWN0ZXJzIChmb3IgZXhhbXBsZSkgd2lsbCBiZSBlc2NhcGVkXG4gICAgcmVndWxhcjogJzwlLSBwcm90b2NvbCAlPjovLzwlPSBtYXBzQXBpUmVzb3VyY2UgJT4vYXBpL3YxL21hcC9zdGF0aWMvbmFtZWQvPCUtIHRwbCAlPi88JS0gd2lkdGggJT4vPCUtIGhlaWdodCAlPi5wbmc8JT0gYXV0aFRva2VucyAlPicsXG4gICAgY2RuOiAnPCUtIHByb3RvY29sICU+Oi8vPCUtIGNkbiAlPi88JS0gdXNlcm5hbWUgJT4vYXBpL3YxL21hcC9zdGF0aWMvbmFtZWQvPCUtIHRwbCAlPi88JS0gd2lkdGggJT4vPCUtIGhlaWdodCAlPi5wbmc8JT0gYXV0aFRva2VucyAlPidcbiAgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICBfLmVhY2goWyd2aXNJZCcsICdtYXBzQXBpUmVzb3VyY2UnLCAndXNlcm5hbWUnXSwgZnVuY3Rpb24obmFtZSkge1xuICAgICAgaWYgKCF0aGlzLm9wdGlvbnNbbmFtZV0pIHtcbiAgICAgICAgY29uc29sZS5sb2cobmFtZSArICcgaXMgcmVxdWlyZWQgZm9yIFN0YXRpYyBNYXAgaW5zdGFudGlhdGlvbicpO1xuICAgICAgfVxuICAgIH0sIHRoaXMpO1xuICB9LFxuXG4gIGxvYWQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3N0YXJ0TG9hZGVyKCk7XG4gICAgdGhpcy5fbG9hZEZyb21WaXNJZCgpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2dlbmVyYXRlSW1hZ2VUZW1wbGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICd0cGxfJyArIHRoaXMub3B0aW9ucy52aXNJZC5yZXBsYWNlKC8tL2csICdfJyk7XG4gIH0sXG5cbiAgX2xvYWRGcm9tVmlzSWQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwcm90b2NvbCA9IHRoaXMuX2lzSFRUUFMoKSA/ICdodHRwcyc6ICdodHRwJztcbiAgICB2YXIgY2RuQ29uZmlnID0gY2RiLmNvbmZpZy5nZXQoJ2Nkbl91cmwnKTtcbiAgICB2YXIgdGVtcGxhdGUgPSBfLnRlbXBsYXRlKGNkbkNvbmZpZyA/IHRoaXMuX1RFTVBMQVRFU1snY2RuJ10gOiB0aGlzLl9URU1QTEFURVNbJ3JlZ3VsYXInXSk7XG5cbiAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgIHByb3RvY29sOiBwcm90b2NvbCxcbiAgICAgIHVzZXJuYW1lOiB0aGlzLm9wdGlvbnMudXNlcm5hbWUsXG4gICAgICBtYXBzQXBpUmVzb3VyY2U6IHRoaXMub3B0aW9ucy5tYXBzQXBpUmVzb3VyY2UsXG4gICAgICB0cGw6IHRoaXMuX2dlbmVyYXRlSW1hZ2VUZW1wbGF0ZSgpLFxuICAgICAgd2lkdGg6IHRoaXMub3B0aW9ucy53aWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5vcHRpb25zLmhlaWdodCxcbiAgICAgIGF1dGhUb2tlbnM6IHRoaXMuX2dlbmVyYXRlQXV0aFRva2Vuc1BhcmFtcygpXG4gICAgfTtcblxuICAgIGlmIChjZG5Db25maWcpIHtcbiAgICAgIG9wdGlvbnMgPSBfLmV4dGVuZChvcHRpb25zLCB7IGNkbjogY2RuQ29uZmlnW3Byb3RvY29sXSB9KTtcbiAgICB9XG5cbiAgICB2YXIgdXJsID0gdGVtcGxhdGUob3B0aW9ucyk7XG5cbiAgICB0aGlzLl9sb2FkSW1hZ2Uoe30sIHVybCk7XG4gIH0sXG5cbiAgX2dlbmVyYXRlQXV0aFRva2Vuc1BhcmFtczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBhdXRoVG9rZW5zID0gdGhpcy5vcHRpb25zLmF1dGhUb2tlbnM7XG4gICAgaWYgKGF1dGhUb2tlbnMgJiYgYXV0aFRva2Vucy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gJz8nICsgXy5tYXAoYXV0aFRva2VucywgZnVuY3Rpb24gKHQpIHsgcmV0dXJuICdhdXRoX3Rva2VuPScgKyB0OyB9KS5qb2luKCcmJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG4gIH0sXG5cbiAgX2lzSFRUUFM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBsb2NhdGlvbi5wcm90b2NvbC5pbmRleE9mKFwiaHR0cHNcIikgPT09IDA7XG4gIH0sXG5cbiAgbG9hZFVSTDogZnVuY3Rpb24odXJsKSB7XG4gICAgdmFyICRpbWcgPSAkKCc8aW1nIGNsYXNzPVwiTWFwQ2FyZC1wcmV2aWV3XCIgc3JjPVwiJyArIHVybCArICdcIiAvPicpO1xuICAgIHRoaXMuJGVsLmFwcGVuZCgkaW1nKTtcblxuICAgIGlmICh0aGlzLm9wdGlvbnMuY2xhc3NOYW1lKSB7XG4gICAgICAkaW1nLmFkZENsYXNzKHRoaXMub3B0aW9ucy5jbGFzc05hbWUpO1xuICAgIH1cblxuICAgICRpbWcuZmFkZUluKDI1MCk7XG4gIH0sXG5cbiAgc2hvd0Vycm9yOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9vbkVycm9yKCk7XG4gIH0sXG5cbiAgX3N0YXJ0TG9hZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5hZGRDbGFzcyhcImlzLWxvYWRpbmdcIik7XG4gIH0sXG5cbiAgX3N0b3BMb2FkZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLnJlbW92ZUNsYXNzKFwiaXMtbG9hZGluZ1wiKTtcbiAgfSxcblxuICBfb25TdWNjZXNzOiBmdW5jdGlvbih1cmwpIHtcbiAgICB0aGlzLl9zdG9wTG9hZGVyKCk7XG4gICAgdGhpcy5sb2FkVVJMKHVybCk7XG4gICAgdGhpcy50cmlnZ2VyKFwibG9hZGVkXCIsIHVybCk7XG4gIH0sXG5cbiAgX29uRXJyb3I6IGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgdGhpcy5fc3RvcExvYWRlcigpO1xuICAgIHRoaXMuJGVsLmFkZENsYXNzKFwiaGFzLWVycm9yXCIpO1xuICAgIHZhciAkZXJyb3IgPSAkKCc8ZGl2IGNsYXNzPVwiTWFwQ2FyZC1lcnJvclwiIC8+Jyk7XG4gICAgdGhpcy4kZWwuYXBwZW5kKCRlcnJvcik7XG4gICAgJGVycm9yLmZhZGVJbigyNTApO1xuICAgIHRoaXMudHJpZ2dlcihcImVycm9yXCIpO1xuICB9LFxuXG4gIF9sb2FkSW1hZ2U6IGZ1bmN0aW9uKGVycm9yLCB1cmwpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGltZyAgPSBuZXcgSW1hZ2UoKTtcblxuICAgIGltZy5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLl9vbkVycm9yKGVycm9yKTtcbiAgICB9O1xuXG4gICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi5fb25TdWNjZXNzKHVybCk7XG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICBpbWcuc3JjID0gdXJsO1xuICAgIH0gY2F0Y2goZXJyKSB7XG4gICAgICB0aGlzLl9vbkVycm9yKGVycik7XG4gICAgfVxuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xudmFyIFV0aWxzID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddWydVdGlscyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ11bJ1V0aWxzJ10gOiBudWxsKTtcbnZhciBQYWdpbmF0aW9uTW9kZWwgPSByZXF1aXJlKCcuLi9wYWdpbmF0aW9uL21vZGVsJyk7XG52YXIgcmFuZG9tUXVvdGUgPSByZXF1aXJlKCcuLi8uLi92aWV3X2hlbHBlcnMvcmFuZG9tX3F1b3RlJyk7XG52YXIgVmlld0ZhY3RvcnkgPSByZXF1aXJlKCcuLi8uLi92aWV3X2ZhY3RvcnknKTtcbnZhciBQYWdpbmF0aW9uVmlldyA9IHJlcXVpcmUoJy4uL3BhZ2luYXRpb24vdmlldycpO1xuXG4vKipcbiAqIFZpZXcgdG8gcmVuZGVyIGEgc2VhcmNoYWJsZS9wYWdlYWJsZSBjb2xsZWN0aW9uLlxuICogQWxzbyBhbGxvd3MgdG8gZmlsdGVyL3NlYXJjaCBsaXN0LlxuICogU2V0IHtpc1VzZWRJbkRpYWxvZzogdHJ1ZX0gaW4gdmlldyBvcHRzIGlmIGludGVuZGVkIHRvIGJlIHVzZWQgaW4gYSBkaWFsb2csIHRvIGhhdmUgcHJvcGVyIGNsYXNzZXMgdG8gcG9zaXRpb24gdmlld3NcbiAqIHByb3Blcmx5LlxuICpcbiAqIC0gY29sbGVjdGlvbiBpcyBhIGNvbGxlY3Rpb24gd2hpY2ggaGFzIGEgUGFnZWRTZWFyY2hNb2RlbC5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIC5qcy1zZWFyY2gtbGluayc6ICdfb25TZWFyY2hDbGljaycsXG4gICAgJ2NsaWNrIC5qcy1jbGVhbi1zZWFyY2gnOiAnX29uQ2xlYW5TZWFyY2hDbGljaycsXG4gICAgJ2tleWRvd24gLmpzLXNlYXJjaC1pbnB1dCc6ICdfb25LZXlEb3duJyxcbiAgICAnc3VibWl0IC5qcy1zZWFyY2gtZm9ybSc6ICdraWxsRXZlbnQnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgXy5lYWNoKFsnY29sbGVjdGlvbicsICdwYWdlZFNlYXJjaE1vZGVsJywgJ2NyZWF0ZUxpc3RWaWV3J10sIGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIGlmICghdGhpcy5vcHRpb25zW25hbWVdKSB0aHJvdyBuZXcgRXJyb3IobmFtZSArICcgaXMgcmVxdWlyZWQnKTtcbiAgICB9LCB0aGlzKTtcbiAgICB0aGlzLmNvbGxlY3Rpb24gPSB0aGlzLm9wdGlvbnMuY29sbGVjdGlvbjtcbiAgICB0aGlzLm9wdGlvbnMubm9SZXN1bHRzID0gdGhpcy5vcHRpb25zLm5vUmVzdWx0cyB8fCB7fVxuXG4gICAgdmFyIHBhcmFtcyA9IHRoaXMub3B0aW9ucy5wYWdlZFNlYXJjaE1vZGVsO1xuICAgIHRoaXMucGFnaW5hdGlvbk1vZGVsID0gbmV3IFBhZ2luYXRpb25Nb2RlbCh7XG4gICAgICBjdXJyZW50X3BhZ2U6IHBhcmFtcy5nZXQoJ3BhZ2UnKSxcbiAgICAgIHRvdGFsX2NvdW50OiB0aGlzLmNvbGxlY3Rpb24udG90YWxDb3VudCgpIHx8IDAsXG4gICAgICBwZXJfcGFnZTogcGFyYW1zLmdldCgncGVyX3BhZ2UnKVxuICAgIH0pO1xuXG4gICAgdGhpcy5lbGRlcignaW5pdGlhbGl6ZScpO1xuICAgIHRoaXMuX2luaXRCaW5kcygpO1xuICAgIHRoaXMub3B0aW9ucy5wYWdlZFNlYXJjaE1vZGVsLmZldGNoKHRoaXMuY29sbGVjdGlvbik7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFyU3ViVmlld3MoKTtcblxuICAgIHRoaXMuX3JlbmRlckNvbnRlbnQoXG4gICAgICB0aGlzLmdldFRlbXBsYXRlKCdjb21tb24vdmlld3MvcGFnZWRfc2VhcmNoL3BhZ2VkX3NlYXJjaCcpKHtcbiAgICAgICAgdGhpbkZpbHRlcnM6IHRoaXMub3B0aW9ucy50aGluRmlsdGVycyxcbiAgICAgICAgcTogdGhpcy5vcHRpb25zLnBhZ2VkU2VhcmNoTW9kZWwuZ2V0KCdxJylcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIHRoaXMuX2luaXRWaWV3cygpO1xuICAgIHRoaXMuXyRjbGVhblNlYXJjaEJ0bigpLmhpZGUoKTtcbiAgICB0aGlzLl9yZW5kZXJFeHRyYUZpbHRlcnMoKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9yZW5kZXJFeHRyYUZpbHRlcnM6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZmlsdGVyc0V4dHJhc1ZpZXcgJiYgdGhpcy5vcHRpb25zLmZpbHRlcnNFeHRyYXNWaWV3KSB7XG4gICAgICB0aGlzLiQoJy5qcy1maWx0ZXJzJykuYXBwZW5kKHRoaXMub3B0aW9ucy5maWx0ZXJzRXh0cmFzVmlldy5yZW5kZXIoKS5lbCk7XG4gICAgfVxuICB9LFxuXG4gIF9yZW5kZXJDb250ZW50OiBmdW5jdGlvbihodG1sKSB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5pc1VzZWRJbkRpYWxvZykge1xuICAgICAgaHRtbCA9IHRoaXMuZ2V0VGVtcGxhdGUoJ2NvbW1vbi92aWV3cy9wYWdlZF9zZWFyY2gvcGFnZWRfc2VhcmNoX2RpYWxvZ193cmFwcGVyJykoe1xuICAgICAgICBodG1sVG9XcmFwOiBodG1sXG4gICAgICB9KVxuICAgIH1cbiAgICB0aGlzLiRlbC5odG1sKGh0bWwpO1xuXG4gICAgLy8gTmVlZHMgdG8gYmUgY2FsbGVkIGFmdGVyICRlbCBodG1sIGNoYW5nZWQ6XG4gICAgaWYgKHRoaXMub3B0aW9ucy5pc1VzZWRJbkRpYWxvZykge1xuICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ0RpYWxvZy1leHBhbmRlZFN1YkNvbnRlbnQnKTtcbiAgICAgIHRoaXMuXyR0YWJQYW5lKCkuYWRkQ2xhc3MoJ0RpYWxvZy1ib2R5SW5uZXJFeHBhbmRlZFdpdGhTdWJGb290ZXInKTtcbiAgICB9XG4gIH0sXG5cbiAgX2luaXRCaW5kczogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jb2xsZWN0aW9uLmJpbmQoJ2ZldGNoaW5nJywgZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLl90b2dnbGVDbGVhblNlYXJjaEJ0bigpO1xuICAgICAgdGhpcy5fYWN0aXZhdGVQYW5lKCdsb2FkaW5nJyk7XG4gICAgfSwgdGhpcyk7XG5cbiAgICB0aGlzLmNvbGxlY3Rpb24uYmluZCgnZXJyb3InLCBmdW5jdGlvbihlKSB7XG4gICAgICAvLyBPbGQgcmVxdWVzdHMgY2FuIGJlIHN0b3BwZWQsIHNvIGFib3J0ZWQgcmVxdWVzdHMgYXJlIG5vdFxuICAgICAgLy8gY29uc2lkZXJlZCBhcyBhbiBlcnJvclxuICAgICAgaWYgKCFlIHx8IChlICYmIGUuc3RhdHVzVGV4dCAhPT0gXCJhYm9ydFwiKSkge1xuICAgICAgICB0aGlzLl9hY3RpdmF0ZVBhbmUoJ2Vycm9yJyk7XG4gICAgICB9XG4gICAgICB0aGlzLl90b2dnbGVDbGVhblNlYXJjaEJ0bigpO1xuICAgIH0sIHRoaXMpO1xuXG4gICAgdGhpcy5jb2xsZWN0aW9uLmJpbmQoJ3Jlc2V0JywgZnVuY3Rpb24oY29sbGVjdGlvbikge1xuICAgICAgdGhpcy5wYWdpbmF0aW9uTW9kZWwuc2V0KHtcbiAgICAgICAgdG90YWxfY291bnQ6IHRoaXMuY29sbGVjdGlvbi50b3RhbENvdW50KCksXG4gICAgICAgIGN1cnJlbnRfcGFnZTogdGhpcy5vcHRpb25zLnBhZ2VkU2VhcmNoTW9kZWwuZ2V0KCdwYWdlJylcbiAgICAgIH0pO1xuICAgICAgdGhpcy5fYWN0aXZhdGVQYW5lKHRoaXMuY29sbGVjdGlvbi50b3RhbENvdW50KCkgPiAwID8gJ2xpc3QnIDogJ25vX3Jlc3VsdHMnKTtcbiAgICAgIHRoaXMuX3RvZ2dsZUNsZWFuU2VhcmNoQnRuKCk7XG4gICAgfSwgdGhpcyk7XG5cbiAgICB0aGlzLnBhZ2luYXRpb25Nb2RlbC5iaW5kKCdjaGFuZ2U6Y3VycmVudF9wYWdlJywgZnVuY3Rpb24obWRsLCBuZXdQYWdlKSB7XG4gICAgICB0aGlzLm9wdGlvbnMucGFnZWRTZWFyY2hNb2RlbC5zZXQoJ3BhZ2UnLCBuZXdQYWdlKTtcbiAgICAgIHRoaXMub3B0aW9ucy5wYWdlZFNlYXJjaE1vZGVsLmZldGNoKHRoaXMuY29sbGVjdGlvbik7XG4gICAgfSwgdGhpcyk7XG5cbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMub3B0aW9ucy5wYWdlZFNlYXJjaE1vZGVsKTtcbiAgICB0aGlzLmFkZF9yZWxhdGVkX21vZGVsKHRoaXMuY29sbGVjdGlvbik7XG4gICAgdGhpcy5hZGRfcmVsYXRlZF9tb2RlbCh0aGlzLnBhZ2luYXRpb25Nb2RlbCk7XG4gIH0sXG5cbiAgX3RvZ2dsZUNsZWFuU2VhcmNoQnRuOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl8kY2xlYW5TZWFyY2hCdG4oKS50b2dnbGUoISF0aGlzLm9wdGlvbnMucGFnZWRTZWFyY2hNb2RlbC5nZXQoJ3EnKSlcbiAgfSxcblxuICBfaW5pdFZpZXdzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9wYW5lcyA9IG5ldyBjZGIudWkuY29tbW9uLlRhYlBhbmUoe1xuICAgICAgZWw6IHRoaXMuXyR0YWJQYW5lKClcbiAgICB9KTtcbiAgICB0aGlzLmFkZFZpZXcodGhpcy5fcGFuZXMpO1xuXG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdsaXN0JyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5TGlzdChbXG4gICAgICAgIHRoaXMuX2NyZWF0ZUxpc3RWaWV3KCksXG4gICAgICAgIG5ldyBQYWdpbmF0aW9uVmlldyh7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnQ0RCLVRleHQgQ0RCLVNpemUtbWVkaXVtIFBhZ2luYXRpb24gUGFnaW5hdGlvbi0tc2hhcmVMaXN0JyxcbiAgICAgICAgICBtb2RlbDogdGhpcy5wYWdpbmF0aW9uTW9kZWxcbiAgICAgICAgfSlcbiAgICAgIF0pXG4gICAgKTtcblxuICAgIHRoaXMuX3BhbmVzLmFkZFRhYignZXJyb3InLFxuICAgICAgVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9mYWlsJywge1xuICAgICAgICBtc2c6ICcnXG4gICAgICB9KVxuICAgICk7XG5cbiAgICB0aGlzLl9wYW5lcy5hZGRUYWIoJ25vX3Jlc3VsdHMnLFxuICAgICAgVmlld0ZhY3RvcnkuY3JlYXRlQnlUZW1wbGF0ZSgnY29tbW9uL3RlbXBsYXRlcy9ub19yZXN1bHRzJywge1xuICAgICAgICBpY29uOiB0aGlzLm9wdGlvbnMubm9SZXN1bHRzLmljb24gfHwgJ0NEQi1JY29uRm9udC1kZWZhdWx0VXNlcicsXG4gICAgICAgIHRpdGxlOiB0aGlzLm9wdGlvbnMubm9SZXN1bHRzLnRpdGxlIHx8ICdPaCEgTm8gcmVzdWx0cycsXG4gICAgICAgIG1zZzogdGhpcy5vcHRpb25zLm5vUmVzdWx0cy5tc2cgfHwgJ1VuZm9ydHVuYXRlbHkgd2UgY291bGQgbm90IGZpbmQgYW55dGhpbmcgd2l0aCB0aGVzZSBwYXJhbWV0ZXJzJ1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgdGhpcy5fcGFuZXMuYWRkVGFiKCdsb2FkaW5nJyxcbiAgICAgIFZpZXdGYWN0b3J5LmNyZWF0ZUJ5VGVtcGxhdGUoJ2NvbW1vbi90ZW1wbGF0ZXMvbG9hZGluZycsIHtcbiAgICAgICAgdGl0bGU6ICdTZWFyY2hpbmcnLFxuICAgICAgICBxdW90ZTogcmFuZG9tUXVvdGUoKVxuICAgICAgfSlcbiAgICApO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5wYWdlZFNlYXJjaE1vZGVsLmdldCgncScpKSB7XG4gICAgICB0aGlzLl9mb2N1c1NlYXJjaElucHV0KCk7XG4gICAgfVxuXG4gICAgdGhpcy5fYWN0aXZhdGVQYW5lKHRoaXMuX2Nob29zZUFjdGl2ZVBhbmVOYW1lKHRoaXMuY29sbGVjdGlvbi50b3RhbENvdW50KCkpKTtcbiAgfSxcblxuICBfY3JlYXRlTGlzdFZpZXc6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB2aWV3ID0gdGhpcy5vcHRpb25zLmNyZWF0ZUxpc3RWaWV3KCk7XG4gICAgaWYgKHZpZXcgaW5zdGFuY2VvZiBjZGIuY29yZS5WaWV3KSB7XG4gICAgICByZXR1cm4gdmlldztcbiAgICB9IGVsc2Uge1xuICAgICAgY2RiLmxvZy5lcnJvcignY3JlYXRlTGlzdFZpZXcgZnVuY3Rpb24gbXVzdCByZXR1cm4gYSB2aWV3Jyk7XG4gICAgICAvLyBmYWxsYmFjayBmb3IgdmlldyB0byBub3QgZmFpbCBtaXNlcmFibHlcbiAgICAgIHJldHVybiBuZXcgY2RiLmNvcmUuVmlldygpO1xuICAgIH1cbiAgfSxcblxuICBfYWN0aXZhdGVQYW5lOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgLy8gT25seSBjaGFuZ2UgYWN0aXZlIHBhbmUgaWYgdGhlIHBhbmVzIGlzIGFjdHVhbGx5IGluaXRpYWxpemVkXG4gICAgaWYgKHRoaXMuX3BhbmVzICYmIHRoaXMuX3BhbmVzLnNpemUoKSA+IDApIHtcbiAgICAgIC8vIGV4cGxpY2l0IHJlbmRlciByZXF1aXJlZCwgc2luY2UgdGFicGFuZSBkb2Vzbid0IGRvIGl0XG4gICAgICB0aGlzLl9wYW5lcy5hY3RpdmUobmFtZSkucmVuZGVyKCk7XG4gICAgfVxuICB9LFxuXG4gIF9jaG9vc2VBY3RpdmVQYW5lTmFtZTogZnVuY3Rpb24odG90YWxDb3VudCkge1xuICAgIGlmICh0b3RhbENvdW50ID09PSAwKSB7XG4gICAgICByZXR1cm4gJ25vX3Jlc3VsdHMnO1xuICAgIH0gZWxzZSBpZiAodG90YWxDb3VudCA+IDApIHtcbiAgICAgIHJldHVybiAnbGlzdCc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAnbG9hZGluZyc7XG4gICAgfVxuICB9LFxuXG4gIF9mb2N1c1NlYXJjaElucHV0OiBmdW5jdGlvbigpIHtcbiAgICAvLyBhbHNvIHNlbGVjdHMgdGhlIGN1cnJlbnQgc2VhcmNoIHN0ciBvbiB0aGUgZm9jdXNcbiAgICB0aGlzLl8kc2VhcmNoSW5wdXQoKS5mb2N1cygpLnZhbCh0aGlzLl8kc2VhcmNoSW5wdXQoKS52YWwoKSk7XG4gIH0sXG5cbiAgX29uU2VhcmNoQ2xpY2s6IGZ1bmN0aW9uKGV2KSB7XG4gICAgdGhpcy5raWxsRXZlbnQoZXYpO1xuICAgIHRoaXMuXyRzZWFyY2hJbnB1dCgpLmZvY3VzKCk7XG4gIH0sXG5cbiAgX29uQ2xlYW5TZWFyY2hDbGljazogZnVuY3Rpb24oZXYpIHtcbiAgICB0aGlzLmtpbGxFdmVudChldik7XG4gICAgdGhpcy5fY2xlYW5TZWFyY2goKTtcbiAgfSxcblxuICBfb25LZXlEb3duOiBmdW5jdGlvbihldikge1xuICAgIHZhciBlbnRlclByZXNzZWQgPSAoZXYua2V5Q29kZSA9PSAkLnVpLmtleUNvZGUuRU5URVIpO1xuICAgIHZhciBlc2NhcGVQcmVzc2VkID0gKGV2LmtleUNvZGUgPT0gJC51aS5rZXlDb2RlLkVTQ0FQRSk7XG4gICAgaWYgKGVudGVyUHJlc3NlZCkge1xuICAgICAgdGhpcy5raWxsRXZlbnQoZXYpO1xuICAgICAgdGhpcy5fc3VibWl0U2VhcmNoKCk7XG4gICAgfSBlbHNlIGlmIChlc2NhcGVQcmVzc2VkKSB7XG4gICAgICB0aGlzLmtpbGxFdmVudChldik7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnBhZ2VkU2VhcmNoTW9kZWwuZ2V0KCdxJykpIHtcbiAgICAgICAgdGhpcy5fY2xlYW5TZWFyY2goKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgX3N1Ym1pdFNlYXJjaDogZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuX21ha2VOZXdTZWFyY2goVXRpbHMuc3RyaXBIVE1MKHRoaXMuXyRzZWFyY2hJbnB1dCgpLnZhbCgpLnRyaW0oKSkpO1xuICB9LFxuXG4gIF9jbGVhblNlYXJjaDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fJHNlYXJjaElucHV0KCkudmFsKCcnKTtcbiAgICB0aGlzLl9tYWtlTmV3U2VhcmNoKCk7XG4gIH0sXG5cbiAgX21ha2VOZXdTZWFyY2g6IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgdGhpcy5vcHRpb25zLnBhZ2VkU2VhcmNoTW9kZWwuc2V0KHtcbiAgICAgIHE6IHF1ZXJ5LFxuICAgICAgcGFnZTogMVxuICAgIH0pO1xuICAgIHRoaXMub3B0aW9ucy5wYWdlZFNlYXJjaE1vZGVsLmZldGNoKHRoaXMuY29sbGVjdGlvbik7XG4gIH0sXG5cbiAgXyRzZWFyY2hJbnB1dDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuJCgnLmpzLXNlYXJjaC1pbnB1dCcpO1xuICB9LFxuXG4gIF8kY2xlYW5TZWFyY2hCdG46IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLiQoJy5qcy1jbGVhbi1zZWFyY2gnKTtcbiAgfSxcblxuICBfJHRhYlBhbmU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLiQoJy5qcy10YWItcGFuZScpO1xuICB9XG5cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcblxuLyoqXG4gKiBWaWV3IG1vZGVsIGludGVuZGVkIHRvIGJlIHJlc3BvbnNpYmxlIGZvciBwYWdpbmF0aW9uIGxvZ2ljLCBhbmQgdG8gYmUgdXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoIGEgUGFnaW5hdGlvbiB2aWV3LlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLk1vZGVsLmV4dGVuZCh7XG4gIGRlZmF1bHRzOiB7XG4gICAgdG90YWxfY291bnQ6ICAgICAgICAgIDAsXG4gICAgcGVyX3BhZ2U6ICAgICAgICAgICAgIDEwLFxuICAgIGN1cnJlbnRfcGFnZTogICAgICAgICAxLFxuICAgIGRpc3BsYXlfY291bnQ6ICAgICAgICA1LFxuICAgIGV4dHJhc19kaXNwbGF5X2NvdW50OiAxLFxuICAgIHVybF90bzogICAgICAgICAgICAgICB1bmRlZmluZWRcbiAgfSxcblxuICBwYWdlc0NvdW50OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gTWF0aC5tYXgoXG4gICAgICAgIE1hdGguY2VpbChcbiAgICAgICAgICB0aGlzLmdldCgndG90YWxfY291bnQnKSAvIHRoaXMuZ2V0KCdwZXJfcGFnZScpXG4gICAgICAgICksIDEpO1xuICB9LFxuXG4gIGlzQ3VycmVudFBhZ2U6IGZ1bmN0aW9uKHBhZ2UpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2N1cnJlbnRfcGFnZScpID09PSBwYWdlO1xuICB9LFxuXG4gIHNob3VsZEJlVmlzaWJsZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBhZ2VzQ291bnQgPSB0aGlzLnBhZ2VzQ291bnQoKTtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3RvdGFsX2NvdW50JykgPiAwICYmIHBhZ2VzQ291bnQgPiAxICYmIHRoaXMuZ2V0KCdjdXJyZW50X3BhZ2UnKSA8PSBwYWdlc0NvdW50O1xuICB9LFxuXG4gIHVybFRvOiBmdW5jdGlvbihwYWdlKSB7XG4gICAgaWYgKHRoaXMuaGFzVXJsKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldCgndXJsX3RvJykocGFnZSk7XG4gICAgfVxuICB9LFxuXG4gIGhhc1VybDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB0aGlzLmdldCgndXJsX3RvJykgPT09ICdmdW5jdGlvbic7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldCB0aGUgcGFnZXMgdGhhdCBhcmUgZXhwZWN0ZWQgdG8gYmUgZGlzcGxheWVkLlxuICAgKiBUaGUgY3VycmVudCBwYWdlIHdpbGwgYmUgaW4gdGhlIG1pZGRsZSBvZiB0aGUgcmV0dXJuZWQgc2VxdWVuY2UuXG4gICAqXG4gICAqIEByZXR1cm5zIHtudW1iZXJbXX0gYSBzZXF1ZW5jZSBvZiBOdW1iZXJzXG4gICAqL1xuICBwYWdlc1RvRGlzcGxheTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHJhbmdlU3RhcnQ7XG5cbiAgICBpZiAodGhpcy5faW5Mb3dSYW5nZSgpKSB7XG4gICAgICByYW5nZVN0YXJ0ID0gMTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuX2luSGlnaFJhbmdlKCkpIHtcbiAgICAgIHJhbmdlU3RhcnQgPSB0aGlzLmdldCgnY3VycmVudF9wYWdlJykgLSB0aGlzLl9zdGFydE9mZnNldCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBTb21ld2hlcmUgYmV0d2VlbiB0aGUgbG93IGFuZCBoaWdoIGJvdW5kYXJ5XG4gICAgICByYW5nZVN0YXJ0ID0gdGhpcy5wYWdlc0NvdW50KCkgLSB0aGlzLmdldCgnZGlzcGxheV9jb3VudCcpICsgMTtcbiAgICB9XG4gICAgcmFuZ2VTdGFydCA9IE1hdGgubWF4KHJhbmdlU3RhcnQsIDEpO1xuXG4gICAgcmV0dXJuIHRoaXMuX3dpdGhFeHRyYVBhZ2VzKFxuICAgICAgXy5yYW5nZShyYW5nZVN0YXJ0LCB0aGlzLl9yYW5nZUVuZChyYW5nZVN0YXJ0KSlcbiAgICApO1xuICB9LFxuXG4gIF93aXRoRXh0cmFQYWdlczogZnVuY3Rpb24ocGFnZXNSZWxhdGl2ZVRvQ3VycmVudFBhZ2UpIHtcbiAgICB2YXIgbGFzdFBhZ2UgPSB0aGlzLnBhZ2VzQ291bnQoKTtcbiAgICB2YXIgZXh0cmFDb3VudCA9IHRoaXMuZ2V0KCdleHRyYXNfZGlzcGxheV9jb3VudCcpO1xuICAgIHZhciBleHRyYVN0YXJ0UGFnZXMgPSBfLnJhbmdlKDEsIGV4dHJhQ291bnQgKyAxKTtcbiAgICB2YXIgZXh0cmFFbmRQYWdlcyA9IF8ucmFuZ2UobGFzdFBhZ2UgLSBleHRyYUNvdW50ICsgMSwgbGFzdFBhZ2UgKyAxKTtcblxuICAgIHZhciBzdGFydFBhZ2VzRGlmZiA9IHBhZ2VzUmVsYXRpdmVUb0N1cnJlbnRQYWdlWzBdIC0gZXh0cmFTdGFydFBhZ2VzLnNsaWNlKC0xKVswXTtcbiAgICBpZiAoc3RhcnRQYWdlc0RpZmYgPT09IDIpIHtcbiAgICAgIC8vIFRoZXJlIGlzIG9ubHkgb25lIG1pc3NpbmcgcGFnZSBpbiB0aGUgZ2FwLCBzbyBhZGQgaXRcbiAgICAgIGV4dHJhU3RhcnRQYWdlcy5wdXNoKHBhZ2VzUmVsYXRpdmVUb0N1cnJlbnRQYWdlWzBdIC0gMSk7XG4gICAgfSBlbHNlIGlmIChzdGFydFBhZ2VzRGlmZiA+IDIpIHtcbiAgICAgIC8vIFRoZXJlIGFyZSBtb3JlIGhpZGRlbiBwYWdlcyBhdCBsb3cgcmFuZ2UsIGFkZCBwYWRkaW5nIGF0IGVuZFxuICAgICAgZXh0cmFTdGFydFBhZ2VzLnB1c2goLTEpO1xuICAgIH1cblxuICAgIHZhciBlbmRQYWdlc0RpZmYgPSBleHRyYUVuZFBhZ2VzWzBdIC0gcGFnZXNSZWxhdGl2ZVRvQ3VycmVudFBhZ2Uuc2xpY2UoLTEpO1xuICAgIGlmIChlbmRQYWdlc0RpZmYgPT09IDIpIHtcbiAgICAgIC8vIFRoZXJlIGlzIG9ubHkgb25lIG1pc3NpbmcgcGFnZSBpbiB0aGUgZ2FwLCBzbyBhZGQgaXRcbiAgICAgIGV4dHJhRW5kUGFnZXMudW5zaGlmdChleHRyYUVuZFBhZ2VzWzBdIC0gMSk7XG4gICAgfSBpZiAoZW5kUGFnZXNEaWZmID4gMikge1xuICAgICAgLy8gVGhlcmUgYXJlIG1vcmUgaGlkZGVuIHBhZ2VzIGF0IGhpZ2ggcmFuZ2UsIGFkZCBwYWRkaW5nIGF0IGJlZ2lubmluZ1xuICAgICAgZXh0cmFFbmRQYWdlcy51bnNoaWZ0KC0yKTtcbiAgICB9XG5cbiAgICByZXR1cm4gXy51bmlvbihleHRyYVN0YXJ0UGFnZXMsIHBhZ2VzUmVsYXRpdmVUb0N1cnJlbnRQYWdlLCBleHRyYUVuZFBhZ2VzKTtcbiAgfSxcblxuICBfaW5Mb3dSYW5nZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdjdXJyZW50X3BhZ2UnKSA8IHRoaXMuX3N0YXJ0T2Zmc2V0KCk7XG4gIH0sXG5cbiAgX2luSGlnaFJhbmdlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2N1cnJlbnRfcGFnZScpIDwgdGhpcy5faGlnaEJvdW5kYXJ5KCk7XG4gIH0sXG5cbiAgX2hpZ2hCb3VuZGFyeTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMucGFnZXNDb3VudCgpIC0gdGhpcy5fc3RhcnRPZmZzZXQoKTtcbiAgfSxcblxuICBfc3RhcnRPZmZzZXQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBNYXRoLmZsb29yKHRoaXMuZ2V0KCdkaXNwbGF5X2NvdW50JykgLyAyKTtcbiAgfSxcblxuICBfcmFuZ2VFbmQ6IGZ1bmN0aW9uKHJhbmdlU3RhcnQpIHtcbiAgICAvLyBJZiB3ZSBhcmUgdG9vIGNsb3NlIHRvIHRoZSByYW5nZSBlbmQgdGhlbiBjYXAgdG8gdGhlIHBhZ2VzIGNvdW50LlxuICAgIHJldHVybiBNYXRoLm1pbihyYW5nZVN0YXJ0ICsgdGhpcy5nZXQoJ2Rpc3BsYXlfY291bnQnKSwgdGhpcy5wYWdlc0NvdW50KCkgKyAxKTtcbiAgfVxufSk7XG4iLCJ2YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpO1xudmFyIG5hdmlnYXRlVGhyb3VnaFJvdXRlciA9IHJlcXVpcmUoJy4uLy4uL3ZpZXdfaGVscGVycy9uYXZpZ2F0ZV90aHJvdWdoX3JvdXRlcicpO1xuXG4vKipcbiAqIFJlc3BvbnNpYmxlIGZvciBwYWdpbmF0aW9uLlxuICpcbiAqIEV4cGVjdGVkIHRvIGJlIGNyZWF0ZWQgd2l0aCBhIHBhZ2luYXRpb24gbW9kZWwsIHNlZSB0aGUgbW9kZWwgZm9yIGF2YWlsYWJsZSBwYXJhbXMsIGhlcmUgd2UgY3JlYXRlIHcvIHRoZSBtaW5pbXVtOlxuICogICBuZXcgUGFnaW5hdGlvblZpZXcoe1xuICogICAgIG1vZGVsOiBuZXcgUGFnaW5hdGlvbk1vZGVsKHtcbiAqICAgICAgIC8vIENvbXB1bHNvcnk6XG4gKiAgICAgICB1cmxUbzogIGZ1bmN0aW9uKHBhZ2UpIHsgcmV0dXJuICcvP3BhZ2U9JysgcGFnZSB9LFxuXG4gICAgICAgICAvLyBPcHRpb25hbCwgdG8gcm91dGVyIGNsaWNrcyBvbiA8YT4gdGFncyB0aHJvdWdoIHJvdXRlci5uYXZpZ2F0ZSBieSBkZWZhdWx0XG4gKiAgICAgICByb3V0ZXI6IG5ldyBSb3V0ZXIoLi4uKVxuICogICAgIH0pXG4gKiAgIH0pO1xuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNkYi5jb3JlLlZpZXcuZXh0ZW5kKHtcblxuICBjbGFzc05hbWU6ICdQYWdpbmF0aW9uIENEQi1UZXh0IENEQi1TaXplLW1lZGl1bScsXG5cbiAgZXZlbnRzOiB7XG4gICAgJ2NsaWNrIGEnOiAnX3BhZ2luYXRlJ1xuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudGVtcGxhdGUgPSBjZGIudGVtcGxhdGVzLmdldFRlbXBsYXRlKCdjb21tb24vdmlld3MvcGFnaW5hdGlvbi90ZW1wbGF0ZScpO1xuICAgIHRoaXMucm91dGVyID0gdGhpcy5vcHRpb25zLnJvdXRlcjtcblxuICAgIGlmICh0aGlzLnJvdXRlciAmJiAhdGhpcy5tb2RlbC5oYXNVcmwoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdzaW5jZSByb3V0ZXIgaXMgc2V0IHRoZSBtb2RlbCBtdXN0IGhhdmUgYSB1cmwgbWV0aG9kIHNldCB0b28nKTtcbiAgICB9XG5cbiAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZScsIHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLm1vZGVsLnNob3VsZEJlVmlzaWJsZSgpKSB7XG4gICAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgICB0aGlzLnRlbXBsYXRlKHtcbiAgICAgICAgICBtOiB0aGlzLm1vZGVsLFxuICAgICAgICAgIHBhZ2VzQ291bnQ6IHRoaXMubW9kZWwucGFnZXNDb3VudCgpLFxuICAgICAgICAgIGN1cnJlbnRQYWdlOiB0aGlzLm1vZGVsLmdldCgnY3VycmVudF9wYWdlJylcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICB0aGlzLiRlbC5hZGRDbGFzcyh0aGlzLmNsYXNzTmFtZSk7XG4gICAgICB0aGlzLmRlbGVnYXRlRXZlbnRzKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuJGVsLmh0bWwoJycpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9wYWdpbmF0ZTogZnVuY3Rpb24oZXYpIHtcbiAgICBpZiAodGhpcy5yb3V0ZXIpIHtcbiAgICAgIG5hdmlnYXRlVGhyb3VnaFJvdXRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMubW9kZWwuaGFzVXJsKCkpIHtcbiAgICAgIHRoaXMua2lsbEV2ZW50KGV2KTtcbiAgICB9XG5cbiAgICB2YXIgcGFnZSA9ICQoZXYudGFyZ2V0KS5kYXRhKCdwYWdlJyk7XG4gICAgdGhpcy5tb2RlbC5zZXQoJ2N1cnJlbnRfcGFnZScsIHBhZ2UpO1xuICB9XG59KTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xuXG4vKipcbiAqIEVycm9yIGRldGFpbHMgdmlldywgdG8gYmUgdXNlZCB0b2dldGhlciB3aXRoIGFuIGVycm9yIG9iamVjdCBmcm9tIGFuIGltcG9ydCBtb2RlbC5cbiAqXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjZGIuY29yZS5WaWV3LmV4dGVuZCh7XG4gIF9URU1QTEFURVM6IHtcbiAgICAncGFydGlhbF9pbXBvcnQnOiAnY29tbW9uL3ZpZXdzL3BhcnRpYWxfaW1wb3J0X2RldGFpbHMnLFxuICAgICd0b29fbWFueV9maWxlcyc6ICdjb21tb24vdmlld3MvdG9vX21hbnlfZmlsZXNfZGV0YWlscycsXG4gICAgJ3Rvb19tYW55X3Jvd3NfY29ubmVjdGlvbic6ICdjb21tb24vdmlld3MvdG9vX21hbnlfcm93c19jb25uZWN0aW9uX2RldGFpbHMnXG4gIH0sXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy53YXJuaW5ncyA9IHRoaXMub3B0aW9ucy53YXJuaW5ncztcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB3YXJuaW5ncyA9IHRoaXMud2FybmluZ3M7XG5cbiAgICB2YXIgdGVtcGxhdGVfZmlsZV9rZXkgPSB0aGlzLl9nZXRUZW1wbGF0ZUtleSh3YXJuaW5ncyk7XG4gICAgdmFyIHRlbXBsYXRlID0gY2RiLnRlbXBsYXRlcy5nZXRUZW1wbGF0ZSh0aGlzLl9URU1QTEFURVNbdGVtcGxhdGVfZmlsZV9rZXldKTtcblxuICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICB0ZW1wbGF0ZSh7XG4gICAgICAgIHdhcm5pbmdzOiB3YXJuaW5nc1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgX2dldFRlbXBsYXRlS2V5OiBmdW5jdGlvbih3YXJuaW5ncykge1xuICAgIC8vIFdlIGhhdmUgd2FybmluZ3MgcHJlY2VkZW5jZSBiZXR3ZWVuIG1heCBsYXllcnMgYW4gbWF4IHRhYmxlcyBwZXIgaW1wb3J0LlxuICAgIC8vIEZvciBleGFtcGxlLCBvbmUgaW1wb3J0IGNvdWxkIHJlYWNoIHRoZSBsaW1pdCBvZiBsYXllcnMgYW4gdGFibGVzIGF0IHRoZVxuICAgIC8vIHNhbWUgdGltZS5cbiAgICBpZiAod2FybmluZ3MudXNlcl9tYXhfbGF5ZXJzICYmIHdhcm5pbmdzLm1heF90YWJsZXNfcGVyX2ltcG9ydCkge1xuICAgICAgcmV0dXJuICh3YXJuaW5ncy51c2VyX21heF9sYXllcnMgPCB3YXJuaW5ncy5tYXhfdGFibGVzX3Blcl9pbXBvcnQpID8gJ3BhcnRpYWxfaW1wb3J0JyA6ICd0b29fbWFueV9maWxlcydcbiAgICB9IGVsc2UgaWYgKHdhcm5pbmdzLnVzZXJfbWF4X2xheWVycykge1xuICAgICAgcmV0dXJuICdwYXJ0aWFsX2ltcG9ydCc7XG4gICAgfSBlbHNlIGlmICh3YXJuaW5ncy5tYXhfdGFibGVzX3Blcl9pbXBvcnQpIHtcbiAgICAgIHJldHVybiAndG9vX21hbnlfZmlsZXMnO1xuICAgIH0gZWxzZSBpZiAod2FybmluZ3MubWF4X3Jvd3NfcGVyX2Nvbm5lY3Rpb24pIHtcbiAgICAgIHJldHVybiAndG9vX21hbnlfcm93c19jb25uZWN0aW9uJztcbiAgICB9XG4gIH1cbn0pO1xuIiwidmFyIGNkYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydjZGInXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2NkYiddIDogbnVsbCk7XG5cbi8qKlxuICogTW9kZWwgdGhhdCBlbmNhcHN1bGF0ZXMgcGFyYW1zIGZvciBmZXRjaGluZyBkYXRhIGluIGEgY2RiLmFkbWluLlZpc3VhbGl6YXRpb25zIGNvbGxlY3Rpb24uXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY2RiLmNvcmUuTW9kZWwuZXh0ZW5kKHtcblxuICBkZWZhdWx0czoge1xuICAgIGNvbnRlbnRfdHlwZTogICAnJyxcbiAgICBwYWdlOiAgICAgICAgICAgMSxcbiAgICBxOiAgICAgICAgICAgICAgJycsXG4gICAgdGFnOiAgICAgICAgICAgICcnLFxuICAgIGNhdGVnb3J5OiAgICAgICAnJyxcbiAgICBzaGFyZWQ6ICAgICAgICAgJ25vJyxcbiAgICBsb2NrZWQ6ICAgICAgICAgZmFsc2UsXG4gICAgbGlicmFyeTogICAgICAgIGZhbHNlLFxuICAgIG9yZGVyOiAgICAgICAgICAndXBkYXRlZF9hdCcsXG4gICAgZGVlcEluc2lnaHRzOiAgIGZhbHNlXG4gIH0sXG5cbiAgaXNTZWFyY2hpbmc6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgncScpIHx8IHRoaXMuZ2V0KCd0YWcnKTtcbiAgfSxcblxuICBpc0RhdGFzZXRzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2NvbnRlbnRfdHlwZScpID09PSAnZGF0YXNldHMnO1xuICB9LFxuXG4gIGlzTWFwczogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdjb250ZW50X3R5cGUnKSA9PT0gJ21hcHMnO1xuICB9LFxuXG4gIGlzRGVlcEluc2lnaHRzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5pc01hcHMoKSAmJiB0aGlzLmdldCgnZGVlcEluc2lnaHRzJyk7XG4gIH1cbn0pO1xuIiwiLy8gTm90IGEgdW5pcXVlIGVudHJ5IGZpbGUsIGJ1dCBkZXBlbmRlbmNpZXMgcmVxdWlyZWQgZm9yIG9sZCB0YWJsZS5qcyBidW5kbGUsIHRvIHJldHJvZml0IG5ld2VyIGJyb3dzZXJpZnkgZmlsZXMgdG8gYmVcbi8vIHVzYWJsZSBpbiBhIG5vbi1icm93c2VyaWZpZWQgYnVuZGxlXG4vL1xuLy8gRXhwZWN0ZWQgdG8gYmUgbG9hZGVkIGFmdGVyIGNkYi5qcyBidXQgYmVmb3JlIHRhYmxlLmpzXG52YXIgY2RiID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2NkYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnY2RiJ10gOiBudWxsKTtcbmNkYi5lZGl0b3IgPSB7XG4gIENyZWF0ZVZpc0ZpcnN0VmlldzogcmVxdWlyZSgnLi9jb21tb24vZGlhbG9ncy9jcmVhdGVfdmlzX2ZpcnN0L2NyZWF0ZV92aXNfZmlyc3RfdmlldycpLFxuICBJbXBvcnRzQ29sbGVjdGlvbjogcmVxdWlyZSgnLi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL21vZGVscy9pbXBvcnRzX2NvbGxlY3Rpb24nKSxcbiAgR2VvY29kaW5nTW9kZWw6IHJlcXVpcmUoJy4vY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy9tb2RlbHMvZ2VvY29kaW5nX21vZGVsJyksXG4gIExvbkxhdEdlb2NvZGluZ01vZGVsOiByZXF1aXJlKCcuL2NvbW1vbi9iYWNrZ3JvdW5kX3BvbGxpbmcvbW9kZWxzL2xvbl9sYXRfZ2VvY29kaW5nX21vZGVsJyksXG4gIEJhY2tncm91bmRQb2xsaW5nTW9kZWw6IHJlcXVpcmUoJy4vZWRpdG9yL2JhY2tncm91bmRfcG9sbGluZ19tb2RlbCcpLFxuICBJbWFnZVBpY2tlclZpZXc6IHJlcXVpcmUoJy4vY29tbW9uL2RpYWxvZ3MvbWFwL2ltYWdlX3BpY2tlcl92aWV3JyksXG4gIEJhY2tncm91bmRQb2xsaW5nVmlldzogcmVxdWlyZSgnLi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL2JhY2tncm91bmRfcG9sbGluZ192aWV3JyksXG4gIEFkZExheWVyVmlldzogcmVxdWlyZSgnLi9jb21tb24vZGlhbG9ncy9tYXAvYWRkX2xheWVyX3ZpZXcnKSxcbiAgU3luY1ZpZXc6IHJlcXVpcmUoJy4vY29tbW9uL2RpYWxvZ3Mvc3luY19kYXRhc2V0L3N5bmNfZGF0YXNldF92aWV3JyksXG4gIFNjcmF0Y2hWaWV3OiByZXF1aXJlKCcuL2NvbW1vbi9kaWFsb2dzL21hcC9zY3JhdGNoX3ZpZXcnKSxcbiAgQWRkTGF5ZXJNb2RlbDogcmVxdWlyZSgnLi9jb21tb24vZGlhbG9ncy9tYXAvYWRkX2xheWVyX21vZGVsJyksXG4gIEZlYXR1cmVEYXRhVmlldzogcmVxdWlyZSgnLi9jb21tb24vZGlhbG9ncy9mZWF0dXJlX2RhdGEvZmVhdHVyZV9kYXRhX2RpYWxvZ192aWV3JyksXG5cbiAgQ2hhbmdlUHJpdmFjeVZpZXc6IHJlcXVpcmUoJy4vY29tbW9uL2RpYWxvZ3MvY2hhbmdlX3ByaXZhY3kvY2hhbmdlX3ByaXZhY3lfdmlldycpLFxuICBFZGl0VmlzTWV0YWRhdGFWaWV3OiByZXF1aXJlKCcuL2NvbW1vbi9kaWFsb2dzL2VkaXRfdmlzX21ldGFkYXRhL2VkaXRfdmlzX21ldGFkYXRhX2RpYWxvZ192aWV3JyksXG5cbiAgRGVsZXRlSXRlbXNWaWV3OiByZXF1aXJlKCcuL2NvbW1vbi9kaWFsb2dzL2RlbGV0ZV9pdGVtc192aWV3JyksXG4gIERlbGV0ZUl0ZW1zVmlld01vZGVsOiByZXF1aXJlKCcuL2NvbW1vbi9kaWFsb2dzL2RlbGV0ZV9pdGVtc192aWV3X21vZGVsJyksXG4gIERlbGV0ZUxheWVyVmlldzogcmVxdWlyZSgnLi9jb21tb24vZGlhbG9ncy9kZWxldGVfbGF5ZXIvZGVsZXRlX2xheWVyX3ZpZXcnKSxcbiAgRGVsZXRlQ29sdW1uVmlldzogcmVxdWlyZSgnLi9jb21tb24vZGlhbG9ncy9kZWxldGVfY29sdW1uL2RlbGV0ZV9jb2x1bW5fdmlldycpLFxuICBEZWxldGVSb3dWaWV3OiByZXF1aXJlKCcuL2NvbW1vbi9kaWFsb2dzL2RlbGV0ZV9yb3cvZGVsZXRlX3Jvd192aWV3JyksXG5cbiAgRXhwb3J0SW1hZ2VSZXN1bHRWaWV3OiByZXF1aXJlKCcuL2NvbW1vbi9kaWFsb2dzL3N0YXRpY19pbWFnZS9leHBvcnRfaW1hZ2VfcmVzdWx0X3ZpZXcnKSxcblxuICBBZHZhbmNlZEV4cG9ydFZpZXc6IHJlcXVpcmUoJy4vY29tbW9uL2RpYWxvZ3Mvc3RhdGljX2ltYWdlL2FkdmFuY2VkX2V4cG9ydF92aWV3JyksXG5cbiAgUHVibGlzaFZpZXc6IHJlcXVpcmUoJy4vY29tbW9uL2RpYWxvZ3MvcHVibGlzaC9wdWJsaXNoX3ZpZXcnKSxcblxuICBDaGFuZ2VMb2NrVmlld01vZGVsOiByZXF1aXJlKCcuL2NvbW1vbi9kaWFsb2dzL2NoYW5nZV9sb2NrL2NoYW5nZV9sb2NrX3ZpZXdfbW9kZWwnKSxcbiAgQ2hhbmdlTG9ja1ZpZXc6IHJlcXVpcmUoJy4vY29tbW9uL2RpYWxvZ3MvY2hhbmdlX2xvY2svY2hhbmdlX2xvY2tfdmlldycpLFxuXG4gIEJ1aWxkZXJGZWF0dXJlc1dhcm5pbmdEaWFsb2c6IHJlcXVpcmUoJy4vY29tbW9uL2RpYWxvZ3MvYnVpbGRlcl9mZWF0dXJlc193YXJuaW5nL2J1aWxkZXJfZmVhdHVyZXNfd2FybmluZ192aWV3JyksXG5cbiAgUGVjYW5WaWV3OiByZXF1aXJlKCcuL2NvbW1vbi9kaWFsb2dzL3BlY2FuL3BlY2FuX3ZpZXcnKSxcblxuICBEdXBsaWNhdGVWaXNWaWV3OiByZXF1aXJlKCcuL2NvbW1vbi9kaWFsb2dzL2R1cGxpY2F0ZV92aXNfdmlldycpLFxuICBEdXBsaWNhdGVEYXRhc2V0VmlldzogcmVxdWlyZSgnLi9jb21tb24vZGlhbG9ncy9kdXBsaWNhdGVfZGF0YXNldF92aWV3JyksXG5cbiAgRXhwb3J0VmlldzogcmVxdWlyZSgnLi9jb21tb24vZGlhbG9ncy9leHBvcnQvZXhwb3J0X3ZpZXcnKSxcblxuICBNZXJnZURhdGFzZXRzVmlldzogcmVxdWlyZSgnLi9jb21tb24vZGlhbG9ncy9tZXJnZV9kYXRhc2V0cy9tZXJnZV9kYXRhc2V0c192aWV3JyksXG4gIEdlb3JlZmVyZW5jZVZpZXc6IHJlcXVpcmUoJy4vY29tbW9uL2RpYWxvZ3MvZ2VvcmVmZXJlbmNlL2dlb3JlZmVyZW5jZV92aWV3JyksXG5cbiAgTGltaXRzUmVhY2hWaWV3OiByZXF1aXJlKCcuL2NvbW1vbi9kaWFsb2dzL2xpbWl0c19yZWFjaC9saW1pdHNfcmVhY2hlZF92aWV3JyksXG5cbiAgTWFtdWZhc0ltcG9ydFZpZXc6IHJlcXVpcmUoJy4vY29tbW9uL21hbXVmYXNfaW1wb3J0L21hbXVmYXNfaW1wb3J0X3ZpZXcnKSxcblxuICBBZGRDdXN0b21CYXNlbWFwVmlldzogcmVxdWlyZSgnLi9jb21tb24vZGlhbG9ncy9hZGRfY3VzdG9tX2Jhc2VtYXAvYWRkX2N1c3RvbV9iYXNlbWFwX3ZpZXcnKSxcbiAgVmlld0ZhY3Rvcnk6IHJlcXVpcmUoJy4vY29tbW9uL3ZpZXdfZmFjdG9yeScpLFxuICByYW5kb21RdW90ZTogcmVxdWlyZSgnLi9jb21tb24vdmlld19oZWxwZXJzL3JhbmRvbV9xdW90ZS5qcycpLFxuXG4gIEV4cG9ydE1hcFZpZXc6IHJlcXVpcmUoJy4vY29tbW9uL2RpYWxvZ3MvZXhwb3J0X21hcC9leHBvcnRfbWFwX3ZpZXcnKVxufTtcbiIsInZhciBjZGIgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snY2RiJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydjZGInXSA6IG51bGwpO1xudmFyIEltcG9ydHNDb2xsZWN0aW9uID0gcmVxdWlyZSgnLi4vY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy9tb2RlbHMvaW1wb3J0c19jb2xsZWN0aW9uJyk7XG52YXIgR2VvY29kaW5nc0NvbGxlY3Rpb24gPSByZXF1aXJlKCcuLi9jb21tb24vYmFja2dyb3VuZF9wb2xsaW5nL21vZGVscy9nZW9jb2RpbmdzX2NvbGxlY3Rpb24nKTtcbnZhciBCYWNrZ3JvdW5kUG9sbGluZ01vZGVsID0gcmVxdWlyZSgnLi4vY29tbW9uL2JhY2tncm91bmRfcG9sbGluZy9iYWNrZ3JvdW5kX3BvbGxpbmdfbW9kZWwnKTtcblxuXG4vKipcbiAqICBCYWNrZ3JvdW5kIGltcG9ydGVyIG1vZGVsIGZvciB0aGUgZWRpdG9yIGNvbnRleHQuXG4gKlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gQmFja2dyb3VuZFBvbGxpbmdNb2RlbC5leHRlbmQoe1xuXG4gIGFkZEltcG9ydEl0ZW06IGZ1bmN0aW9uKG1kbCkge1xuICAgIGlmICghbWRsKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnVzZXIuY2FuQWRkTGF5ZXJUbyh0aGlzLnZpcy5tYXApKSB7XG4gICAgICBtZGwuc2V0RXJyb3Ioe1xuICAgICAgICBlcnJvcl9jb2RlOiA4MDA1LFxuICAgICAgICBnZXRfZXJyb3JfdGV4dDoge1xuICAgICAgICAgIHRpdGxlOiBcIk1heCBsYXllcnMgcGVyIG1hcCByZWFjaGVkXCIsXG4gICAgICAgICAgd2hhdF9hYm91dDogXCJZb3UgY2FuJ3QgYWRkIG1vcmUgbGF5ZXJzIHRvIHlvdXIgbWFwLiBQbGVhc2UgdXBncmFkZSB5b3VyIGFjY291bnQuXCJcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5pbXBvcnRzQ29sbGVjdGlvbi5hZGQobWRsKTtcbiAgfSxcblxuICBfb25JbXBvcnRzU3RhdGVDaGFuZ2U6IGZ1bmN0aW9uKGltcG9ydHNNb2RlbCkge1xuICAgIGlmIChpbXBvcnRzTW9kZWwuaGFzQ29tcGxldGVkKCkpIHtcbiAgICAgIHRoaXMudHJpZ2dlcignaW1wb3J0Q29tcGxldGVkJywgaW1wb3J0c01vZGVsLCB0aGlzKTtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHRoaXMudmlzLm1hcC5hZGRDYXJ0b2RiTGF5ZXJGcm9tVGFibGUoaW1wb3J0c01vZGVsLmltcC5nZXQoJ3RhYmxlX25hbWUnKSwgdGhpcy51c2VyLmdldCgndXNlcm5hbWUnKSwge1xuICAgICAgICB2aXM6IHRoaXMudmlzLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAvLyBsYXllcnMgbmVlZCB0byBiZSBzYXZlZCBiZWNhdXNlIHRoZSBvcmRlciBtYXkgY2hhbmdlZFxuICAgICAgICAgIHNlbGYudmlzLm1hcC5sYXllcnMuc2F2ZUxheWVycygpO1xuICAgICAgICAgIC8vIERvbid0IHJlbW92ZSBpbXBvcnQgaXRlbSBpZiBpdCBpcyBUd2l0dGVyIHR5cGVcbiAgICAgICAgICB2YXIgc2VydmljZU5hbWUgPSBpbXBvcnRzTW9kZWwuZ2V0KCd1cGxvYWQnKS5zZXJ2aWNlX25hbWU7XG4gICAgICAgICAgdmFyIHR3aXR0ZXJJbXBvcnQgPSBzZXJ2aWNlTmFtZSAmJiBzZXJ2aWNlTmFtZSA9PT0gXCJ0d2l0dGVyX3NlYXJjaFwiO1xuICAgICAgICAgIGlmICghdHdpdHRlckltcG9ydCkge1xuICAgICAgICAgICAgc2VsZi5pbXBvcnRzQ29sbGVjdGlvbi5yZW1vdmUoaW1wb3J0c01vZGVsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBzZWxmLnRyaWdnZXIoJ2ltcG9ydExheWVyRmFpbCcsICdGYWlsZWQgdG8gYWRkIHRoZSBjb25uZWN0ZWQgZGF0YXNldCBhcyBhIGxheWVyIHRvIHRoaXMgbWFwJyk7XG4gICAgICAgICAgc2VsZi5pbXBvcnRzQ29sbGVjdGlvbi5yZW1vdmUoaW1wb3J0c01vZGVsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIF9vbkdlb2NvZGluZ3NTdGF0ZUNoYW5nZTogZnVuY3Rpb24oZ2VvY29kaW5nTW9kZWwpIHtcbiAgICBpZiAoZ2VvY29kaW5nTW9kZWwuaGFzQ29tcGxldGVkKCkpIHtcbiAgICAgIHRoaXMudHJpZ2dlcignZ2VvY29kaW5nQ29tcGxldGVkJywgZ2VvY29kaW5nTW9kZWwsIHRoaXMpO1xuICAgIH1cbiAgICBpZiAoZ2VvY29kaW5nTW9kZWwuaGFzRmFpbGVkKCkpIHtcbiAgICAgIHRoaXMudHJpZ2dlcignZ2VvY29kaW5nRmFpbGVkJywgZ2VvY29kaW5nTW9kZWwsIHRoaXMpO1xuICAgIH1cbiAgfSxcblxuICBfb25BbmFseXNpc1N0YXRlQ2hhbmdlOiBmdW5jdGlvbihtZGwsIGNvbGxlY3Rpb24pIHt9XG5cbn0pO1xuIiwidmFyIGdlb0F0dHIgPSByZXF1aXJlKCcuL2NhcnRvY3NzL2dldC1nZW8tYXR0cicpO1xudmFyIGdldERlZmF1bHRDU1NGb3JHZW9tZXRyeVR5cGUgPSByZXF1aXJlKCcuL2NhcnRvY3NzL2dldC1kZWZhdWx0LWNzcy1mb3ItZ2VvbWV0cnktdHlwZScpO1xudmFyIHJhbXBzID0gcmVxdWlyZSgnLi9jYXJ0b2Nzcy9jb2xvci1yYW1wcycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgY2hvcm9wbGV0aDogZnVuY3Rpb24ocXVhcnRpbGVzLCB0YWJsZU5hbWUsIHByb3AsIGdlb21ldHJ5VHlwZSwgcmFtcCkge1xuICAgIHZhciBhdHRyID0gZ2VvQXR0cihnZW9tZXRyeVR5cGUpO1xuICAgIHZhciB0YWJsZUlEID0gJyMnICsgdGFibGVOYW1lO1xuXG4gICAgdmFyIGRlZmF1bHRDU1MgPSBnZXREZWZhdWx0Q1NTRm9yR2VvbWV0cnlUeXBlKGdlb21ldHJ5VHlwZSk7XG4gICAgdmFyIGNzcyA9IFwiLyoqIGNob3JvcGxldGggdmlzdWFsaXphdGlvbiAqL1xcblxcblwiICsgdGFibGVJRCArIFwiIHtcXG4gIFwiICsgYXR0ciArIFwiOiBcIiArIHJhbXBbMF0gKyBcIjtcXG5cIiArIGRlZmF1bHRDU1Muam9pbihcIlxcblwiKSArIFwiXFxufVxcblwiO1xuXG4gICAgZm9yICh2YXIgaSA9IHF1YXJ0aWxlcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgaWYgKHF1YXJ0aWxlc1tpXSAhPT0gdW5kZWZpbmVkICYmIHF1YXJ0aWxlc1tpXSAhPSBudWxsKSB7XG4gICAgICAgIGNzcyArPSBcIlxcblwiICsgdGFibGVJRCArIFwiW1wiICsgcHJvcCArIFwiIDw9IFwiICsgcXVhcnRpbGVzW2ldICsgXCJdIHtcXG5cIjtcbiAgICAgICAgY3NzICs9ICcgICcgKyBhdHRyICArICc6JyArIHJhbXBbaV0gKyBcIjtcXG59XCJcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNzcztcbiAgfSxcblxuICBjYXRlZ29yeU1ldGFkYXRhOiBmdW5jdGlvbihjYXRzLCBvcHRpb25zKSB7XG4gICAgdmFyIG1ldGFkYXRhID0gW107XG5cbiAgICB2YXIgcmFtcCA9IChvcHRpb25zICYmIG9wdGlvbnMucmFtcCkgPyBvcHRpb25zLnJhbXAgOiByYW1wcy5jYXRlZ29yeTtcbiAgICB2YXIgdHlwZSA9IG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlID8gb3B0aW9ucy50eXBlIDogJ3N0cmluZyc7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBjYXQgPSBjYXRzW2ldO1xuICAgICAgaWYgKGkgPCAxMCAmJiBjYXQgIT09IHVuZGVmaW5lZCAmJiAoKHR5cGUgPT09ICdzdHJpbmcnICYmIGNhdCAhPSBudWxsKSB8fCAodHlwZSAhPT0gJ3N0cmluZycpKSkge1xuICAgICAgICBtZXRhZGF0YS5wdXNoKHtcbiAgICAgICAgICB0aXRsZTogY2F0LFxuICAgICAgICAgIHRpdGxlX3R5cGU6IHR5cGUsXG4gICAgICAgICAgdmFsdWVfdHlwZTogJ2NvbG9yJyxcbiAgICAgICAgICBjb2xvcjogcmFtcFtpXVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY2F0cy5sZW5ndGggPiAxMCkge1xuICAgICAgbWV0YWRhdGEucHVzaCh7XG4gICAgICAgIHRpdGxlOiAnT3RoZXJzJyxcbiAgICAgICAgdmFsdWVfdHlwZTogJ2NvbG9yJyxcbiAgICAgICAgZGVmYXVsdDogdHJ1ZSxcbiAgICAgICAgY29sb3I6IHJhbXBbcmFtcC5sZW5ndGggLSAxXVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1ldGFkYXRhO1xuICB9LFxuXG4gIGNhdGVnb3J5OiBmdW5jdGlvbihjYXRzLCB0YWJsZU5hbWUsIHByb3AsIGdlb21ldHJ5VHlwZSwgb3B0aW9ucykge1xuICAgIHZhciBhdHRyID0gZ2VvQXR0cihnZW9tZXRyeVR5cGUpO1xuICAgIHZhciB0YWJsZUlEID0gJyMnICsgdGFibGVOYW1lO1xuICAgIHZhciByYW1wID0gcmFtcHMuY2F0ZWdvcnk7XG4gICAgdmFyIG5hbWUsIHZhbHVlO1xuXG4gICAgdmFyIHR5cGUgPSBvcHRpb25zICYmIG9wdGlvbnMudHlwZSA/IG9wdGlvbnMudHlwZSA6ICdzdHJpbmcnO1xuICAgIHZhciByYW1wID0gKG9wdGlvbnMgJiYgb3B0aW9ucy5yYW1wKSA/IG9wdGlvbnMucmFtcCA6IHJhbXBzLmNhdGVnb3J5O1xuXG4gICAgdmFyIGRlZmF1bHRDU1MgPSBnZXREZWZhdWx0Q1NTRm9yR2VvbWV0cnlUeXBlKGdlb21ldHJ5VHlwZSk7XG5cbiAgICB2YXIgY3NzID0gXCIvKiogY2F0ZWdvcnkgdmlzdWFsaXphdGlvbiAqL1xcblxcblwiICsgdGFibGVJRCArIFwiIHtcXG4gIFwiICsgYXR0ciArIFwiOiBcIiArIHJhbXBbMF0gKyBcIjtcXG5cIiArIGRlZmF1bHRDU1Muam9pbihcIlxcblwiKSArIFwiXFxufVxcblwiO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYXRzLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgIHZhciBjYXQgPSBjYXRzW2ldO1xuXG4gICAgICBpZiAodHlwZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgbmFtZSA9IGNhdC5yZXBsYWNlKC9cXG4vZywnXFxcXG4nKS5yZXBsYWNlKC9cXFwiL2csIFwiXFxcXFxcXCJcIik7XG4gICAgICAgIHZhbHVlID0gXCJcXFwiXCIgKyBuYW1lICsgXCJcXFwiXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZSA9IGNhdDtcbiAgICAgIH1cblxuICAgICAgaWYgKGkgPCAxMCAmJiBjYXQgIT09IHVuZGVmaW5lZCAmJiAoKHR5cGUgPT09ICdzdHJpbmcnICYmIGNhdCAhPSBudWxsKSB8fCAodHlwZSAhPT0gJ3N0cmluZycpKSkge1xuICAgICAgICBjc3MgKz0gXCJcXG5cIiArIHRhYmxlSUQgKyAnWycgKyBwcm9wICsgJz0nICsgdmFsdWUgKyBcIl0ge1xcblwiO1xuICAgICAgICBjc3MgKz0gJyAgJyArIGF0dHIgICsgJzonICsgcmFtcFtpXSArIFwiO1xcbn1cIlxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjYXRzLmxlbmd0aCA+IDEwKSB7XG4gICAgICBjc3MgKz0gXCJcXG5cIiArIHRhYmxlSUQgKyBcIntcXG5cIjtcbiAgICAgIGNzcyArPSAnICAnICsgYXR0ciAgKyAnOiAnICsgcmFtcFtyYW1wLmxlbmd0aCAtIDFdKyBcIjtcXG59XCJcbiAgICB9XG5cbiAgICByZXR1cm4gY3NzO1xuICB9LFxuXG4gIHRvcnF1ZTogZnVuY3Rpb24oc3RhdHMsIHRhYmxlTmFtZSwgb3B0aW9ucyl7XG4gICAgdmFyIHRhYmxlSUQgPSAnIycgKyB0YWJsZU5hbWU7XG4gICAgdmFyIGFnZ0Z1bmN0aW9uID0gJ2NvdW50KGNhcnRvZGJfaWQpJztcbiAgICB2YXIgY3NzID0gW1xuICAgICAgICAnLyoqIHRvcnF1ZSB2aXN1YWxpemF0aW9uICovJyxcbiAgICAgICAgJ01hcCB7JyxcbiAgICAgICAgJyAgLXRvcnF1ZS10aW1lLWF0dHJpYnV0ZTogJyArIHN0YXRzLmNvbHVtbiArICc7JyxcbiAgICAgICAgJyAgLXRvcnF1ZS1hZ2dyZWdhdGlvbi1mdW5jdGlvbjogXCJjb3VudChjYXJ0b2RiX2lkKVwiOycsXG4gICAgICAgICcgIC10b3JxdWUtZnJhbWUtY291bnQ6ICcgKyBzdGF0cy5zdGVwcyArICc7JyxcbiAgICAgICAgJyAgLXRvcnF1ZS1hbmltYXRpb24tZHVyYXRpb246IDEwOycsXG4gICAgICAgICcgIC10b3JxdWUtcmVzb2x1dGlvbjogMjsnLFxuICAgICAgICAnfScsXG4gICAgICAgIHRhYmxlSUQgKyAnIHsnLFxuICAgICAgICAnICBtYXJrZXItd2lkdGg6IDM7JyxcbiAgICAgICAgJyAgbWFya2VyLWZpbGwtb3BhY2l0eTogMC44OycsXG4gICAgICAgICcgIG1hcmtlci1maWxsOiAjMEYzQjgyOyAnLFxuICAgICAgICAnICBjb21wLW9wOiBcImxpZ2h0ZW5cIjsgJyxcbiAgICAgICAgJyAgW2ZyYW1lLW9mZnNldCA9IDFdIHsgbWFya2VyLXdpZHRoOiAxMDsgbWFya2VyLWZpbGwtb3BhY2l0eTogMC4wNTt9JyxcbiAgICAgICAgJyAgW2ZyYW1lLW9mZnNldCA9IDJdIHsgbWFya2VyLXdpZHRoOiAxNTsgbWFya2VyLWZpbGwtb3BhY2l0eTogMC4wMjt9JyxcbiAgICAgICAgJ30nXG4gICAgXTtcbiAgICBjc3MgPSBjc3Muam9pbihcIlxcblwiKTtcblxuICAgIHJldHVybiBjc3M7XG5cbiAgfSxcblxuICBidWJibGU6IGZ1bmN0aW9uKHF1YXJ0aWxlcywgdGFibGVOYW1lLCBwcm9wKSB7XG4gICAgdmFyIHRhYmxlSUQgPSAnIycgKyB0YWJsZU5hbWU7XG4gICAgdmFyIGNzcyA9IFwiLyoqIGJ1YmJsZSB2aXN1YWxpemF0aW9uICovXFxuXFxuXCIgKyB0YWJsZUlEICsgXCIge1xcblwiO1xuICAgIGNzcyArPSBnZXREZWZhdWx0Q1NTRm9yR2VvbWV0cnlUeXBlKCdwb2ludCcpLmpvaW4oXCJcXG5cIik7XG4gICAgY3NzICs9IFwiXFxubWFya2VyLWZpbGw6ICNGRjVDMDA7XCI7XG4gICAgY3NzICs9IFwiXFxufVxcblxcblwiO1xuXG4gICAgdmFyIG1pbiA9IDEwO1xuICAgIHZhciBtYXggPSAzMDtcblxuICAgIHZhciB2YWx1ZXMgPSBbXTtcblxuICAgIHZhciBOUE9JTlMgPSAxMDtcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgTlBPSU5TOyArK2kpIHtcbiAgICAgIHZhciB0ID0gaS8oTlBPSU5TLTEpO1xuICAgICAgdmFsdWVzLnB1c2gobWluICsgdCoobWF4IC0gbWluKSk7XG4gICAgfVxuXG4gICAgLy8gZ2VuZXJhdGUgY2FydG9cbiAgICBmb3IodmFyIGkgPSBOUE9JTlMgLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgaWYocXVhcnRpbGVzW2ldICE9PSB1bmRlZmluZWQgJiYgcXVhcnRpbGVzW2ldICE9IG51bGwpIHtcbiAgICAgICAgY3NzICs9IFwiXFxuI1wiICsgdGFibGVOYW1lICsgJyBbICcgKyBwcm9wICsgJyA8PSAnICsgcXVhcnRpbGVzW2ldICsgXCJdIHtcXG5cIlxuICAgICAgICBjc3MgKz0gJyAgIG1hcmtlci13aWR0aDogJyArIHZhbHVlc1tpXS50b0ZpeGVkKDEpICsgXCI7XFxufVwiXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjc3M7XG4gIH0sXG5cbiAgaGVhdG1hcDogZnVuY3Rpb24oc3RhdHMsIHRhYmxlTmFtZSwgb3B0aW9ucyl7XG4gICAgdmFyIHRhYmxlSUQgPSAnIycgKyB0YWJsZU5hbWU7XG4gICAgdmFyIGNzcyA9IFtcbiAgICAgICAgJy8qKiBoZWF0bWFwIHZpc3VhbGl6YXRpb24gKi8nLFxuICAgICAgICAnTWFwIHsnLFxuICAgICAgICAnICAtdG9ycXVlLXRpbWUtYXR0cmlidXRlOiBcImNhcnRvZGJfaWRcIjsnLFxuICAgICAgICAnICAtdG9ycXVlLWFnZ3JlZ2F0aW9uLWZ1bmN0aW9uOiBcImNvdW50KGNhcnRvZGJfaWQpXCI7JyxcbiAgICAgICAgJyAgLXRvcnF1ZS1mcmFtZS1jb3VudDogMTsnLFxuICAgICAgICAnICAtdG9ycXVlLWFuaW1hdGlvbi1kdXJhdGlvbjogMTA7JyxcbiAgICAgICAgJyAgLXRvcnF1ZS1yZXNvbHV0aW9uOiAyOycsXG4gICAgICAgICd9JyxcbiAgICAgICAgdGFibGVJRCArICcgeycsXG4gICAgICAgICcgIG1hcmtlci13aWR0aDogMTA7JyxcbiAgICAgICAgJyAgbWFya2VyLWZpbGwtb3BhY2l0eTogMC40OycsXG4gICAgICAgICcgIG1hcmtlci1maWxsOiAjMEYzQjgyOyAnLFxuICAgICAgICAnICBjb21wLW9wOiBcImxpZ2h0ZW5cIjsgJyxcbiAgICAgICAgJyAgaW1hZ2UtZmlsdGVyczogY29sb3JpemUtYWxwaGEoYmx1ZSwgY3lhbiwgbGlnaHRncmVlbiwgeWVsbG93ICwgb3JhbmdlLCByZWQpOycsXG4gICAgICAgICcgIG1hcmtlci1maWxlOiB1cmwoaHR0cDovL3MzLmFtYXpvbmF3cy5jb20vY29tLmNhcnRvZGIuYXNzZXRzLnN0YXRpYy9hbHBoYW1hcmtlci5wbmcpOycsXG4gICAgICAgICd9J1xuICAgIF07XG4gICAgY3NzID0gY3NzLmpvaW4oXCJcXG5cIik7XG4gICAgcmV0dXJuIGNzcztcbiAgfVxufTtcbiIsIm1vZHVsZS5leHBvcnRzID0ge1xuICBib29sOiBbJyMyMjlBMDAnLCAnI0Y4NEY0MCcsICcjREREREREJ10sXG4gIGdyZWVuOiAgWycjRURGOEZCJywgJyNEN0ZBRjQnLCAnI0NDRUNFNicsICcjNjZDMkE0JywgJyM0MUFFNzYnLCAnIzIzOEI0NScsICcjMDA1ODI0J10sXG4gIGJsdWU6ICBbJyNGRkZGQ0MnLCAnI0M3RTlCNCcsICcjN0ZDREJCJywgJyM0MUI2QzQnLCAnIzFEOTFDMCcsICcjMjI1RUE4JywgJyMwQzJDODQnXSxcbiAgcGluazogWycjRjFFRUY2JywgJyNENEI5REEnLCAnI0M5OTRDNycsICcjREY2NUIwJywgJyNFNzI5OEEnLCAnI0NFMTI1NicsICcjOTEwMDNGJ10sXG4gIGJsYWNrOiAgWycjRjdGN0Y3JywgJyNEOUQ5RDknLCAnI0JEQkRCRCcsICcjOTY5Njk2JywgJyM3MzczNzMnLCAnIzUyNTI1MicsICcjMjUyNTI1J10sXG4gIHJlZDogIFsnI0ZGRkZCMicsICcjRkVEOTc2JywgJyNGRUIyNEMnLCAnI0ZEOEQzQycsICcjRkM0RTJBJywgJyNFMzFBMUMnLCAnI0IxMDAyNiddLFxuICBjYXRlZ29yeTogWycjQTZDRUUzJywgJyMxRjc4QjQnLCAnI0IyREY4QScsICcjMzNBMDJDJywgJyNGQjlBOTknLCAnI0UzMUExQycsICcjRkRCRjZGJywgJyNGRjdGMDAnLCAnI0NBQjJENicsICcjNkEzRDlBJywgJyNEREREREQnXSxcbiAgZGl2ZXJnZW50OiBbJyMwMDgwRkYnLCAnIzQwQTBGRicsICcjN0ZCRkZGJywgJyNGRkYyQ0MnLCAnI0ZGQTZBNicsICcjRkY3QTdBJywgJyNGRjRENEQnXVxufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZ2VvbWV0cnlUeXBlKSB7XG4gIGlmIChnZW9tZXRyeVR5cGUgPT09ICdwb2x5Z29uJykge1xuICAgIHJldHVybiBbXG4gICAgICAncG9seWdvbi1vcGFjaXR5OiAwLjc7JyxcbiAgICAgICdsaW5lLWNvbG9yOiAjRkZGOycsXG4gICAgICAnbGluZS13aWR0aDogMC41OycsXG4gICAgICAnbGluZS1vcGFjaXR5OiAxOydcbiAgICBdO1xuICB9IGVsc2UgaWYgKGdlb21ldHJ5VHlwZSA9PT0gJ2xpbmUnKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgICdsaW5lLXdpZHRoOiAyOycsXG4gICAgICAnbGluZS1vcGFjaXR5OiAwLjc7J1xuICAgIF07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFtcbiAgICAgICdtYXJrZXItZmlsbC1vcGFjaXR5OiAwLjk7JyxcbiAgICAgICdtYXJrZXItbGluZS1jb2xvcjogI0ZGRjsnLFxuICAgICAgJ21hcmtlci1saW5lLXdpZHRoOiAxOycsXG4gICAgICAnbWFya2VyLWxpbmUtb3BhY2l0eTogMTsnLFxuICAgICAgJ21hcmtlci1wbGFjZW1lbnQ6IHBvaW50OycsXG4gICAgICAnbWFya2VyLXR5cGU6IGVsbGlwc2U7JyxcbiAgICAgICdtYXJrZXItd2lkdGg6IDEwOycsXG4gICAgICAnbWFya2VyLWFsbG93LW92ZXJsYXA6IHRydWU7J1xuICAgIF07XG4gIH1cbn07XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGdlb21ldHJ5VHlwZSkge1xuICByZXR1cm4ge1xuICAgIFwibGluZVwiOiAnbGluZS1jb2xvcicsXG4gICAgJ3BvbHlnb24nOiBcInBvbHlnb24tZmlsbFwiLFxuICAgICdwb2ludCc6IFwibWFya2VyLWZpbGxcIlxuICB9W2dlb21ldHJ5VHlwZV07XG59O1xuIiwiXG4vKipcbiAqIExpa2UgXy5kZWZhdWx0cywgYnV0IGFsc28gYXBwbGllcyB0byBkZWVwIG9iamVjdCBzdHJ1Y3R1cmUuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGN1c3RvbXNcbiAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0c1xuICogQHJldHVybiB7T2JqZWN0fVxuICovXG52YXIgZGVlcERlZmF1bHRzID0gZnVuY3Rpb24oY3VzdG9tcywgZGVmYXVsdHMpIHtcbiAgdmFyIG1lbW8gPSB7fTtcblxuICBmb3IgKHZhciBrZXkgaW4gZGVmYXVsdHMpIHtcbiAgICBpZiAoZGVmYXVsdHMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgdmFyIGRlZmF1bHRzSXRlbSA9IGRlZmF1bHRzW2tleV07XG4gICAgICB2YXIgY3VzdG9tc0l0ZW07XG5cbiAgICAgIGlmICh0eXBlb2YgY3VzdG9tcyA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgY3VzdG9tc0l0ZW0gPSBjdXN0b21zW2tleV07XG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgZGVmYXVsdHNJdGVtID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgY3VzdG9tc0l0ZW0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgIC8vIGJvdGggZGVmYXVsdHNJdGVtIGFuZCBjdXN0b21zSXRlbSBhcmUgb2JqZWNzLCBnbyBkb3duIG9uZSBsZXZlbCwgc2V0IHJldHVybmVkIHJlc3VsdCBhcyB2YWx1ZSBmb3Iga2V5XG4gICAgICAgIG1lbW9ba2V5XSA9IGRlZXBEZWZhdWx0cyhjdXN0b21zSXRlbSwgZGVmYXVsdHNJdGVtKTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGRlZmF1bHRzSXRlbSAhPT0gJ29iamVjdCcgJiYgY3VzdG9tc0l0ZW0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBtZW1vW2tleV0gPSBjdXN0b21zSXRlbTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1lbW9ba2V5XSA9IGRlZmF1bHRzSXRlbTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gbWVtbyB8fCB7fTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZGVlcERlZmF1bHRzO1xuIiwidmFyIHJhbXBzID0gcmVxdWlyZSgnLi9jYXJ0b2Nzcy9jb2xvci1yYW1wcy5qcycpO1xuXG4vLyBUT0RPOiBvbmx5IHJlcXVpcmUgdGhlIG5lY2Vzc2FyeSBwYXJhbXNcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oc3RhdHMpIHtcbiAgdmFyIG1ldGhvZDtcbiAgdmFyIHJhbXAgPSByYW1wcy5ibHVlO1xuICB2YXIgbmFtZSA9ICdibHVlJztcblxuICBpZiAoWydBJywnVSddLmluZGV4T2Yoc3RhdHMuZGlzdF90eXBlKSAhPSAtMSkgeyAvLyBhcHBseSBkaXZlcmdlbnQgc2NoZW1lXG4gICAgbWV0aG9kID0gc3RhdHMuamVua3M7XG5cbiAgICBpZiAoc3RhdHMubWluIDwgMCAmJiBzdGF0cy5tYXggPiAwKXtcbiAgICAgIHJhbXAgPSByYW1wcy5kaXZlcmdlbnQ7XG4gICAgICBuYW1lID0gJ3NwZWN0cnVtMic7XG4gICAgfVxuICB9IGVsc2UgaWYgKHN0YXRzLmRpc3RfdHlwZSA9PT0gJ0YnKSB7XG4gICAgbWV0aG9kID0gc3RhdHMuZXF1YWxpbnQ7XG4gICAgcmFtcCA9IHJhbXBzLnJlZDtcbiAgICBuYW1lID0gJ3JlZCc7XG4gIH0gZWxzZSBpZiAoc3RhdHMuZGlzdF90eXBlID09PSAnSicpIHtcbiAgICBtZXRob2QgPSBzdGF0cy5oZWFkdGFpbHM7XG4gICAgcmFtcCA9IHJhbXBzLmJsdWU7XG4gICAgbmFtZSA9ICdibHVlJztcbiAgfSBlbHNlIHtcbiAgICBtZXRob2QgPSBzdGF0cy5oZWFkdGFpbHM7XG4gICAgcmFtcCA9IHJhbXBzLnJlZDtcbiAgICBuYW1lID0gJ3JlZCc7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIG5hbWU6IG5hbWUsXG4gICAgcmFtcDogcmFtcCxcbiAgICBtZXRob2Q6IG1ldGhvZFxuICB9O1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZGlzdFR5cGUpIHtcbiAgcmV0dXJuIHtcbiAgICBVOiAwLjksXG4gICAgQTogMC45LFxuICAgIEw6IDAuNyxcbiAgICBKOiAwLjcsXG4gICAgUzogMC41LFxuICAgIEY6IDAuM1xuICB9W2Rpc3RUeXBlXTtcbn07XG4iLCJ2YXIgcmFtcHMgPSByZXF1aXJlKCcuL2NhcnRvY3NzL2NvbG9yLXJhbXBzJyk7XG52YXIgZ2V0V2VpZ2h0RnJvbVNoYXBlID0gcmVxdWlyZSgnLi9nZXQtd2VpZ2h0LWZyb20tc2hhcGUnKTtcbnZhciBnZXRNZXRob2RQcm9wZXJ0aWVzID0gcmVxdWlyZSgnLi9nZXQtbWV0aG9kLXByb3BlcnRpZXMnKTtcbnZhciBkZWVwRGVmYXVsdHMgPSByZXF1aXJlKCcuL2RlZXAtZGVmYXVsdHMnKTtcbnZhciBDU1MgPSByZXF1aXJlKCcuL2NhcnRvY3NzJyk7XG5cbi8qKlxuICogR2V0IG1ldGFkYXRhIHRvIHJlbmRlciBhIENhcnRvREIgbWFwICh2aXN1YWxpemF0aW9uKSBmcm9tIGEgc2V0IG9mIGdpdmVuIHRhYmxlIGFuZCBjb2x1bW4gZGF0YSwgc2VlIHBhcmFtcy5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyBoYXNoIHdpdGggZm9sbG93aW5nIGtleXM6XG4gKiAgIC0gdGFibGVOYW1lOiB7U3RyaW5nfVxuICogICAtIGNvbHVtbjoge09iamVjdH0gaGFzaCB3aXRoIGZvbGxvd2luZyBrZXlzOlxuICogICAgIC0gc3RhdHM6IHtPYmplY3R9IHN0YXRzIGFzIGdpdmVuIGZyb20gYSBkZXNjcmliZSBjYWxsIG9uIGEgU1FMIEFQSS5cbiAqICAgICAtIGdlb21ldHJ5VHlwZToge1N0cmluZ30gZS5nLiAncG9pbnRzJywgJ3BvbHlnb24nIG9yIHNpbWlsYXIuXG4gKiAgICAgLSBiYm94OiB7QXJyYXlbQXJyYXldfSBlLmcuIFtbMC4wLCAwLjFdLCBbMS4wLCAxLjFdXVxuICogICAtIGRlcGVuZGVuY2llczoge09iamVjdH0gaGFzaCB3aXRoIGZvbGxvd2luZyBrZXlzOlxuICogICAgIC0gdW5kZXJzY29yZToge09iamVjdH0gb25seSB1c2VkIGZvciBzb21lIGNvbHVtbiB0eXBlcyB0aG91Z2gsIGUuZy4gbnVtYmVyLCBzdHJpbmdcbiAqICAgLSB0aHJlc2hvbGRzOiB7T2JqZWN0fSBTZWUgbGlzdCBpbiBjb2RlXG4gKiBAcmV0dXJuIHtPYmplY3R9XG4gKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob3B0cykge1xuICB2YXIgXyA9IG9wdHMuZGVwZW5kZW5jaWVzLnVuZGVyc2NvcmU7XG4gIHZhciB0YWJsZU5hbWUgPSBvcHRzLnRhYmxlTmFtZTtcblxuICB2YXIgdGhyZXNob2xkcyA9IGRlZXBEZWZhdWx0cyhvcHRzLnRocmVzaG9sZHMsIHtcbiAgICBudW1iZXI6IHtcbiAgICAgIGZvckJ1YmJsZU1hcDoge1xuICAgICAgICBtaW5DYWxjV2VpZ2h0OiAwLjUsXG4gICAgICAgIG1heFN0YXRzQ291bnQ6IDIwMFxuICAgICAgfSxcbiAgICAgIGZvckNhdGVnb3J5T3JCdWJibGVNYXA6IHtcbiAgICAgICAgbWluU3RhdHNXZWlnaHQ6IDAuNSxcbiAgICAgICAgZGlzdGluY3RQZXJjZW50YWdlOiAyNSxcbiAgICAgICAgZm9yQ2F0ZWdvcnk6IHtcbiAgICAgICAgICBtYXhEaXN0aW5jdFBlcmNlbnRhZ2U6IDFcbiAgICAgICAgfSxcbiAgICAgICAgZm9yQnViYmxlOiB7XG4gICAgICAgICAgbWluRGlzdGluY3RQZXJjZW50YWdlOiAxXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHZhciBjb2x1bW4gPSBvcHRzLmNvbHVtbjtcbiAgdmFyIGdlb21ldHJ5VHlwZSA9IGNvbHVtbi5nZW9tZXRyeVR5cGU7XG4gIHZhciBzdGF0cyA9IGNvbHVtbi5zdGF0cztcbiAgdmFyIGNvbHVtbk5hbWUgPSBzdGF0cy5jb2x1bW47XG5cbiAgdmFyIHZpc3VhbGl6YXRpb25UeXBlID0gJ2Nob3JvcGxldGgnO1xuICB2YXIgY3NzID0gbnVsbDtcbiAgdmFyIHR5cGUgPSBzdGF0cy50eXBlO1xuICB2YXIgbWV0YWRhdGEgPSBbXTtcbiAgdmFyIGRpc3RpbmN0UGVyY2VudGFnZSA9IChzdGF0cy5kaXN0aW5jdCAvIHN0YXRzLmNvdW50KSAqIDEwMDtcblxuICBpZiAodHlwZSA9PT0gJ251bWJlcicpIHtcbiAgICB2YXIgY2FsY1dlaWdodCA9IChzdGF0cy53ZWlnaHQgKyBnZXRXZWlnaHRGcm9tU2hhcGUoc3RhdHMuZGlzdF90eXBlKSkgLyAyO1xuXG4gICAgaWYgKGNhbGNXZWlnaHQgPj0gdGhyZXNob2xkcy5udW1iZXIuZm9yQnViYmxlTWFwLm1pbkNhbGNXZWlnaHQpIHtcbiAgICAgIHZhciB2aXNGdW5jdGlvbiA9IENTUy5jaG9yb3BsZXRoO1xuICAgICAgdmFyIHByb3BlcnRpZXMgPSBnZXRNZXRob2RQcm9wZXJ0aWVzKHN0YXRzKTtcblxuICAgICAgaWYgKHN0YXRzLmNvdW50IDwgdGhyZXNob2xkcy5udW1iZXIuZm9yQnViYmxlTWFwLm1heFN0YXRzQ291bnQgJiYgZ2VvbWV0cnlUeXBlID09PSAncG9pbnQnKXtcbiAgICAgICAgdmlzdWFsaXphdGlvblR5cGUgPSAnYnViYmxlJztcbiAgICAgICAgdmlzRnVuY3Rpb24gPSBDU1MuYnViYmxlO1xuICAgICAgfVxuXG4gICAgICBjc3MgPSB2aXNGdW5jdGlvbihwcm9wZXJ0aWVzLm1ldGhvZCwgdGFibGVOYW1lLCBjb2x1bW5OYW1lLCBnZW9tZXRyeVR5cGUsIHByb3BlcnRpZXMucmFtcCk7XG5cbiAgICB9IGVsc2UgaWYgKHN0YXRzLndlaWdodCA+IHRocmVzaG9sZHMubnVtYmVyLmZvckNhdGVnb3J5T3JCdWJibGVNYXAubWluU3RhdHNXZWlnaHQgfHwgZGlzdGluY3RQZXJjZW50YWdlIDwgdGhyZXNob2xkcy5udW1iZXIuZm9yQ2F0ZWdvcnlPckJ1YmJsZU1hcC5tYXhEaXN0aW5jdFBlcmNlbnRhZ2UpIHtcbiAgICAgIGlmIChkaXN0aW5jdFBlcmNlbnRhZ2UgPCB0aHJlc2hvbGRzLm51bWJlci5mb3JDYXRlZ29yeU9yQnViYmxlTWFwLmZvckNhdGVnb3J5Lm1heERpc3RpbmN0UGVyY2VudGFnZSkge1xuICAgICAgICB2aXN1YWxpemF0aW9uVHlwZSA9ICdjYXRlZ29yeSc7XG5cbiAgICAgICAgdmFyIGNhdHMgPSBzdGF0cy5jYXRfaGlzdDtcbiAgICAgICAgY2F0cyA9IF8uc29ydEJ5KGNhdHMsIGZ1bmN0aW9uKGNhdCkgeyByZXR1cm4gY2F0WzFdOyB9KS5yZXZlcnNlKCkuc2xpY2UoMCwgcmFtcHMuY2F0ZWdvcnkubGVuZ3RoKTtcbiAgICAgICAgY2F0cyA9IF8uc29ydEJ5KGNhdHMsIGZ1bmN0aW9uKGNhdCkgeyByZXR1cm4gY2F0WzBdOyB9KTtcbiAgICAgICAgY2F0cyA9IGNhdHMubWFwKGZ1bmN0aW9uKHIpIHsgcmV0dXJuIHJbMF07IH0pO1xuXG4gICAgICAgIGNzcyA9IENTUy5jYXRlZ29yeShjYXRzLCB0YWJsZU5hbWUsIGNvbHVtbk5hbWUsIGdlb21ldHJ5VHlwZSwgeyB0eXBlOiB0eXBlIH0pO1xuICAgICAgICBtZXRhZGF0YSA9IENTUy5jYXRlZ29yeU1ldGFkYXRhKGNhdHMsIHsgdHlwZTogdHlwZSB9KTtcblxuICAgICAgfSBlbHNlIGlmIChkaXN0aW5jdFBlcmNlbnRhZ2UgPj0gdGhyZXNob2xkcy5udW1iZXIuZm9yQ2F0ZWdvcnlPckJ1YmJsZU1hcC5mb3JCdWJibGUubWluRGlzdGluY3RQZXJjZW50YWdlKSB7XG5cbiAgICAgICAgdmFyIHZpc0Z1bmN0aW9uID0gQ1NTLmNob3JvcGxldGg7XG5cbiAgICAgICAgaWYgKGdlb21ldHJ5VHlwZSA9PT0gJ3BvaW50Jyl7XG4gICAgICAgICAgdmlzdWFsaXphdGlvblR5cGUgPSAnYnViYmxlJztcbiAgICAgICAgICB2aXNGdW5jdGlvbiA9IENTUy5idWJibGU7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcHJvcGVydGllcyA9IGdldE1ldGhvZFByb3BlcnRpZXMoc3RhdHMpO1xuICAgICAgICBjc3MgPSB2aXNGdW5jdGlvbihwcm9wZXJ0aWVzLm1ldGhvZCwgdGFibGVOYW1lLCBjb2x1bW5OYW1lLCBnZW9tZXRyeVR5cGUsIHByb3BlcnRpZXMucmFtcCk7XG4gICAgICB9XG4gICAgfVxuXG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3N0cmluZycpIHtcbiAgICB2aXN1YWxpemF0aW9uVHlwZSA9ICdjYXRlZ29yeSc7XG5cbiAgICB2YXIgY2F0cyA9IHN0YXRzLmhpc3Q7XG4gICAgY2F0cyA9IF8uc29ydEJ5KGNhdHMsIGZ1bmN0aW9uKGNhdCkgeyByZXR1cm4gY2F0WzFdOyB9KS5yZXZlcnNlKCkuc2xpY2UoMCwgcmFtcHMuY2F0ZWdvcnkubGVuZ3RoKTtcbiAgICBjYXRzID0gXy5zb3J0QnkoY2F0cywgZnVuY3Rpb24oY2F0KSB7IHJldHVybiBjYXRbMF07IH0pO1xuICAgIGNhdHMgPSBjYXRzLm1hcChmdW5jdGlvbihyKSB7IHJldHVybiByWzBdOyB9KTtcblxuICAgIGNzcyA9IENTUy5jYXRlZ29yeShjYXRzLCB0YWJsZU5hbWUsIGNvbHVtbk5hbWUsIGdlb21ldHJ5VHlwZSk7XG4gICAgbWV0YWRhdGEgPSBDU1MuY2F0ZWdvcnlNZXRhZGF0YShjYXRzKTtcblxuICB9IGVsc2UgaWYgKHR5cGUgPT09ICdkYXRlJykge1xuICAgIHZpc3VhbGl6YXRpb25UeXBlID0gJ3RvcnF1ZSc7XG4gICAgY3NzID0gQ1NTLnRvcnF1ZShzdGF0cywgdGFibGVOYW1lKTtcblxuICB9IGVsc2UgaWYgKHR5cGUgPT09ICdib29sZWFuJykge1xuICAgIHZpc3VhbGl6YXRpb25UeXBlID0gJ2NhdGVnb3J5JztcbiAgICB2YXIgcmFtcCA9IHJhbXBzLmJvb2w7XG4gICAgdmFyIGNhdHMgPSBbJ3RydWUnLCAnZmFsc2UnLCBudWxsXTtcbiAgICB2YXIgb3B0aW9ucyA9IHsgdHlwZTogdHlwZSwgcmFtcDogcmFtcCB9O1xuICAgIGNzcyA9IENTUy5jYXRlZ29yeShjYXRzLCB0YWJsZU5hbWUsIGNvbHVtbk5hbWUsIGdlb21ldHJ5VHlwZSwgb3B0aW9ucyk7XG4gICAgbWV0YWRhdGEgPSBDU1MuY2F0ZWdvcnlNZXRhZGF0YShjYXRzLCBvcHRpb25zKTtcblxuICB9IGVsc2UgaWYgKHN0YXRzLnR5cGUgPT09ICdnZW9tJykge1xuICAgIHZpc3VhbGl6YXRpb25UeXBlID0gJ2hlYXRtYXAnO1xuICAgIGNzcyA9IENTUy5oZWF0bWFwKHN0YXRzLCB0YWJsZU5hbWUsIG9wdGlvbnMpO1xuICB9XG5cbiAgdmFyIHByb3BlcnRpZXMgPSB7XG4gICAgZ2VvbWV0cnlUeXBlOiBnZW9tZXRyeVR5cGUsXG4gICAgY29sdW1uOiBjb2x1bW5OYW1lLFxuICAgIGJib3g6IGNvbHVtbi5iYm94LFxuICAgIHR5cGU6IHR5cGUsXG4gICAgdmlzdWFsaXphdGlvblR5cGU6IHZpc3VhbGl6YXRpb25UeXBlXG4gIH07XG5cbiAgaWYgKGNzcykge1xuICAgIHByb3BlcnRpZXMuY3NzID0gY3NzO1xuICB9IGVsc2Uge1xuICAgIHByb3BlcnRpZXMuY3NzID0gbnVsbDtcbiAgICBwcm9wZXJ0aWVzLndlaWdodCA9IC0xMDA7XG4gIH1cblxuICBpZiAoc3RhdHMpIHtcbiAgICBwcm9wZXJ0aWVzLnN0YXRzID0gc3RhdHM7XG4gIH1cblxuICBpZiAobWV0YWRhdGEpIHtcbiAgICBwcm9wZXJ0aWVzLm1ldGFkYXRhID0gbWV0YWRhdGE7XG4gIH1cblxuICByZXR1cm4gcHJvcGVydGllcztcbn07XG4iLCJ2YXIgZ2V0V2VpZ2h0RnJvbVNoYXBlID0gcmVxdWlyZSgnLi9nZXQtd2VpZ2h0LWZyb20tc2hhcGUnKTtcbnZhciBkZWVwRGVmYXVsdHMgPSByZXF1aXJlKCcuL2RlZXAtZGVmYXVsdHMnKTtcblxudmFyIGFuYWx5emVNZXRob2RzID0ge1xuICBnZW9tOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgdmFyIHN0YXRzID0gZGF0YS5zdGF0cztcbiAgICByZXR1cm4gZGF0YS5pc1BvaW50R2VvbWV0cnlUeXBlICYmIHN0YXRzLmNsdXN0ZXJfcmF0ZSAqIHN0YXRzLmRlbnNpdHkgPj0gZGF0YS50aHJlc2hvbGRzLmdlb20ubWluU3RhdHNEZW5zaXR5O1xuICB9LFxuXG4gIHN0cmluZzogZnVuY3Rpb24oZGF0YSkge1xuICAgIHJldHVybiBkYXRhLnN0YXRzLndlaWdodCA+PSBkYXRhLnRocmVzaG9sZHMuc3RyaW5nLm1pbldlaWdodDtcbiAgfSxcblxuICBudW1iZXI6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICB2YXIgc3RhdHMgPSBkYXRhLnN0YXRzO1xuICAgIHZhciBkaXN0aW5jdFBlcmNlbnRhZ2UgPSAoc3RhdHMuZGlzdGluY3QgLyBzdGF0cy5jb3VudCkgKiAxMDA7XG4gICAgdmFyIGNhbGNXZWlnaHQgPSAoc3RhdHMud2VpZ2h0ICsgZ2V0V2VpZ2h0RnJvbVNoYXBlKHN0YXRzLmRpc3RfdHlwZSkpIC8gMjtcbiAgICByZXR1cm4gc3RhdHMud2VpZ2h0ID49IGRhdGEudGhyZXNob2xkcy5udW1iZXIubWluV2VpZ2h0ICYmXG4gICAgICAoXG4gICAgICAgIGNhbGNXZWlnaHQgPj0gZGF0YS50aHJlc2hvbGRzLm51bWJlci5taW5DYWxjV2VpZ2h0IHx8XG4gICAgICAgIHN0YXRzLndlaWdodCA+IGRhdGEudGhyZXNob2xkcy5udW1iZXIubWluV2VpZ2h0SWZOb090aGVyQXBwbGllcyB8fFxuICAgICAgICBkaXN0aW5jdFBlcmNlbnRhZ2UgPCBkYXRhLnRocmVzaG9sZHMubnVtYmVyLm1heERpc3RpbmN0UGVyY2VudGFnZVxuICAgICAgKTtcbiAgfSxcblxuICBib29sZWFuOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgcmV0dXJuIGRhdGEuc3RhdHMubnVsbF9yYXRpbyA8PSBkYXRhLnRocmVzaG9sZHMuYm9vbGVhbi5tYXhOdWxsUmF0aW87XG4gIH0sXG5cbiAgZGF0ZTogZnVuY3Rpb24oZGF0YSkge1xuICAgIHJldHVybiBkYXRhLmlzUG9pbnRHZW9tZXRyeVR5cGUgJiYgZGF0YS5zdGF0cy5udWxsX3JhdGlvIDw9IGRhdGEudGhyZXNob2xkcy5kYXRlLm1heE51bGxSYXRpbztcbiAgfVxufTtcblxuLyoqXG4gKiBDaGVjayB3ZXRoZXIgdGhlIGdpdmVuIHN0YXRzIGlzIGVub3VnaCB0byBtYWtlIGd1ZXNzZXMgZm9yIHBlY2FuIG1hcHMuXG4gKiBAcGFyYW0ge09iamVjdH0gc3RhdHMgUmVzdWx0cyBmcm9tIGEgZGVzY3JpYmUgY2FsbCBvbiBhIHRhYmxlIGNvbHVtbi5cbiAqICAgQSBzdGF0cyBvYmplY3QgdGhhdCBsYWNrcyBhbnkgcmVsZXZhbnQgc3RhdGlzdGljcyB3aWxsIG1vc3QgbGlrZWx5IHlpZWxkIGEgZmFsc2UuXG4gKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlIGlmIGdvb2QgZW5vdWdoXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZGF0YSkge1xuICB2YXIgaXNHb29kRW5vdWdoID0gZmFsc2U7XG4gIHZhciBkYXRhID0gZGF0YSB8fCB7fTtcblxuICBkYXRhLnRocmVzaG9sZHMgPSBkZWVwRGVmYXVsdHMoZGF0YS50aHJlc2hvbGRzLCB7XG4gICAgZ2VvbToge1xuICAgICAgbWluU3RhdHNEZW5zaXR5OiAwLjFcbiAgICB9LFxuICAgIHN0cmluZzoge1xuICAgICAgbWluV2VpZ2h0OiAwLjhcbiAgICB9LFxuICAgIG51bWJlcjoge1xuICAgICAgbWluV2VpZ2h0OiAwLjEsXG4gICAgICBtaW5DYWxjV2VpZ2h0OiAwLjUsXG4gICAgICBtYXhEaXN0aW5jdFBlcmNlbnRhZ2U6IDI1LFxuICAgICAgbWluV2VpZ2h0SWZOb090aGVyQXBwbGllczogMC41XG4gICAgfSxcbiAgICBib29sZWFuOiB7XG4gICAgICBtYXhOdWxsUmF0aW86IDAuNzVcbiAgICB9LFxuICAgIGRhdGU6IHtcbiAgICAgIG1heE51bGxSYXRpbzogMC43NVxuICAgIH1cbiAgfSk7XG5cbiAgaWYgKGRhdGEgJiYgZGF0YS5zdGF0cykge1xuICAgIHZhciBtZXRob2QgPSBhbmFseXplTWV0aG9kc1tkYXRhLnN0YXRzLnR5cGVdO1xuICAgIGlmICh0eXBlb2YgbWV0aG9kID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBpc0dvb2RFbm91Z2ggPSBtZXRob2QuY2FsbCh0aGlzLCBkYXRhKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gaXNHb29kRW5vdWdoO1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0ge1xuICBoYXNFbm91Z2hUb0d1ZXNzOiByZXF1aXJlKCcuL2hhcy1lbm91Z2gtdG8tZ3Vlc3MnKSxcbiAgZ3Vlc3NNYXA6IHJlcXVpcmUoJy4vZ3Vlc3MtbWFwJyksXG4gIGdldFdlaWdodEZyb21TaGFwZTogcmVxdWlyZSgnLi9nZXQtd2VpZ2h0LWZyb20tc2hhcGUnKSxcbiAgZ2V0TWV0aG9kUHJvcGVydGllczogcmVxdWlyZSgnLi9nZXQtbWV0aG9kLXByb3BlcnRpZXMnKVxufTtcbiIsIihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7XG4gIHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDpcbiAgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKCdxdWV1ZScsIGZhY3RvcnkpIDpcbiAgKGdsb2JhbC5xdWV1ZSA9IGZhY3RvcnkoKSk7XG59KHRoaXMsIGZ1bmN0aW9uICgpIHsgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBzbGljZSA9IFtdLnNsaWNlO1xuXG4gIGZ1bmN0aW9uIG5vb3AoKSB7fVxuXG4gIHZhciBub2Fib3J0ID0ge307XG4gIHZhciBzdWNjZXNzID0gW251bGxdO1xuICBmdW5jdGlvbiBuZXdRdWV1ZShjb25jdXJyZW5jeSkge1xuICAgIGlmICghKGNvbmN1cnJlbmN5ID49IDEpKSB0aHJvdyBuZXcgRXJyb3I7XG5cbiAgICB2YXIgcSxcbiAgICAgICAgdGFza3MgPSBbXSxcbiAgICAgICAgcmVzdWx0cyA9IFtdLFxuICAgICAgICB3YWl0aW5nID0gMCxcbiAgICAgICAgYWN0aXZlID0gMCxcbiAgICAgICAgZW5kZWQgPSAwLFxuICAgICAgICBzdGFydGluZywgLy8gaW5zaWRlIGEgc3luY2hyb25vdXMgdGFzayBjYWxsYmFjaz9cbiAgICAgICAgZXJyb3IsXG4gICAgICAgIGNhbGxiYWNrID0gbm9vcCxcbiAgICAgICAgY2FsbGJhY2tBbGwgPSB0cnVlO1xuXG4gICAgZnVuY3Rpb24gc3RhcnQoKSB7XG4gICAgICBpZiAoc3RhcnRpbmcpIHJldHVybjsgLy8gbGV0IHRoZSBjdXJyZW50IHRhc2sgY29tcGxldGVcbiAgICAgIHdoaWxlIChzdGFydGluZyA9IHdhaXRpbmcgJiYgYWN0aXZlIDwgY29uY3VycmVuY3kpIHtcbiAgICAgICAgdmFyIGkgPSBlbmRlZCArIGFjdGl2ZSxcbiAgICAgICAgICAgIHQgPSB0YXNrc1tpXSxcbiAgICAgICAgICAgIGogPSB0Lmxlbmd0aCAtIDEsXG4gICAgICAgICAgICBjID0gdFtqXTtcbiAgICAgICAgdFtqXSA9IGVuZChpKTtcbiAgICAgICAgLS13YWl0aW5nLCArK2FjdGl2ZSwgdGFza3NbaV0gPSBjLmFwcGx5KG51bGwsIHQpIHx8IG5vYWJvcnQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZW5kKGkpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbihlLCByKSB7XG4gICAgICAgIGlmICghdGFza3NbaV0pIHRocm93IG5ldyBFcnJvcjsgLy8gZGV0ZWN0IG11bHRpcGxlIGNhbGxiYWNrc1xuICAgICAgICAtLWFjdGl2ZSwgKytlbmRlZCwgdGFza3NbaV0gPSBudWxsO1xuICAgICAgICBpZiAoZXJyb3IgIT0gbnVsbCkgcmV0dXJuOyAvLyBvbmx5IHJlcG9ydCB0aGUgZmlyc3QgZXJyb3JcbiAgICAgICAgaWYgKGUgIT0gbnVsbCkge1xuICAgICAgICAgIGFib3J0KGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdHNbaV0gPSByO1xuICAgICAgICAgIGlmICh3YWl0aW5nKSBzdGFydCgpO1xuICAgICAgICAgIGVsc2UgaWYgKCFhY3RpdmUpIG5vdGlmeSgpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFib3J0KGUpIHtcbiAgICAgIGVycm9yID0gZTsgLy8gaWdub3JlIG5ldyB0YXNrcyBhbmQgc3F1ZWxjaCBhY3RpdmUgY2FsbGJhY2tzXG4gICAgICB3YWl0aW5nID0gTmFOOyAvLyBzdG9wIHF1ZXVlZCB0YXNrcyBmcm9tIHN0YXJ0aW5nXG4gICAgICBub3RpZnkoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBub3RpZnkoKSB7XG4gICAgICBpZiAoZXJyb3IgIT0gbnVsbCkgY2FsbGJhY2soZXJyb3IpO1xuICAgICAgZWxzZSBpZiAoY2FsbGJhY2tBbGwpIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgZWxzZSBjYWxsYmFjay5hcHBseShudWxsLCBzdWNjZXNzLmNvbmNhdChyZXN1bHRzKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHEgPSB7XG4gICAgICBkZWZlcjogZnVuY3Rpb24oZikge1xuICAgICAgICBpZiAoY2FsbGJhY2sgIT09IG5vb3ApIHRocm93IG5ldyBFcnJvcjtcbiAgICAgICAgdmFyIHQgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgICAgIHQucHVzaChmKTtcbiAgICAgICAgKyt3YWl0aW5nLCB0YXNrcy5wdXNoKHQpO1xuICAgICAgICBzdGFydCgpO1xuICAgICAgICByZXR1cm4gcTtcbiAgICAgIH0sXG4gICAgICBhYm9ydDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChlcnJvciA9PSBudWxsKSB7XG4gICAgICAgICAgdmFyIGkgPSBlbmRlZCArIGFjdGl2ZSwgdDtcbiAgICAgICAgICB3aGlsZSAoLS1pID49IDApICh0ID0gdGFza3NbaV0pICYmIHQuYWJvcnQgJiYgdC5hYm9ydCgpO1xuICAgICAgICAgIGFib3J0KG5ldyBFcnJvcihcImFib3J0XCIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcTtcbiAgICAgIH0sXG4gICAgICBhd2FpdDogZnVuY3Rpb24oZikge1xuICAgICAgICBpZiAoY2FsbGJhY2sgIT09IG5vb3ApIHRocm93IG5ldyBFcnJvcjtcbiAgICAgICAgY2FsbGJhY2sgPSBmLCBjYWxsYmFja0FsbCA9IGZhbHNlO1xuICAgICAgICBpZiAoIXdhaXRpbmcgJiYgIWFjdGl2ZSkgbm90aWZ5KCk7XG4gICAgICAgIHJldHVybiBxO1xuICAgICAgfSxcbiAgICAgIGF3YWl0QWxsOiBmdW5jdGlvbihmKSB7XG4gICAgICAgIGlmIChjYWxsYmFjayAhPT0gbm9vcCkgdGhyb3cgbmV3IEVycm9yO1xuICAgICAgICBjYWxsYmFjayA9IGYsIGNhbGxiYWNrQWxsID0gdHJ1ZTtcbiAgICAgICAgaWYgKCF3YWl0aW5nICYmICFhY3RpdmUpIG5vdGlmeSgpO1xuICAgICAgICByZXR1cm4gcTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gcXVldWUoY29uY3VycmVuY3kpIHtcbiAgICByZXR1cm4gbmV3UXVldWUoYXJndW1lbnRzLmxlbmd0aCA/ICtjb25jdXJyZW5jeSA6IEluZmluaXR5KTtcbiAgfVxuXG4gIHF1ZXVlLnZlcnNpb24gPSBcIjEuMi4xXCI7XG5cbiAgcmV0dXJuIHF1ZXVlO1xuXG59KSk7Il19
